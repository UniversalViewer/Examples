var requirejs,require,define;!function(global){function commentReplace(e,t,n,i){return i||""}function isFunction(e){return"[object Function]"===ostring.call(e)}function isArray(e){return"[object Array]"===ostring.call(e)}function each(e,t){if(e){var n;for(n=0;n<e.length&&(!e[n]||!t(e[n],n,e));n+=1);}}function eachReverse(e,t){if(e){var n;for(n=e.length-1;n>-1&&(!e[n]||!t(e[n],n,e));n-=1);}}function hasProp(e,t){return hasOwn.call(e,t)}function getOwn(e,t){return hasProp(e,t)&&e[t]}function eachProp(e,t){var n;for(n in e)if(hasProp(e,n)&&t(e[n],n))break}function mixin(e,t,n,i){return t&&eachProp(t,function(t,o){(n||!hasProp(e,o))&&(!i||"object"!=typeof t||!t||isArray(t)||isFunction(t)||t instanceof RegExp?e[o]=t:(e[o]||(e[o]={}),mixin(e[o],t,n,i)))}),e}function bind(e,t){return function(){return t.apply(e,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(e){throw e}function getGlobal(e){if(!e)return e;var t=global;return each(e.split("."),function(e){t=t[e]}),t}function makeError(e,t,n,i){var o=new Error(t+"\nhttp://requirejs.org/docs/errors.html#"+e);return o.requireType=e,o.requireModules=i,n&&(o.originalError=n),o}function newContext(e){function t(e){var t,n;for(t=0;t<e.length;t++)if(n=e[t],"."===n)e.splice(t,1),t-=1;else if(".."===n){if(0===t||1===t&&".."===e[2]||".."===e[t-1])continue;t>0&&(e.splice(t-1,2),t-=2)}}function n(e,n,i){var o,r,s,a,u,l,c,h,p,d,f,g,v=n&&n.split("/"),_=T.map,m=_&&_["*"];if(e&&(e=e.split("/"),c=e.length-1,T.nodeIdCompat&&jsSuffixRegExp.test(e[c])&&(e[c]=e[c].replace(jsSuffixRegExp,"")),"."===e[0].charAt(0)&&v&&(g=v.slice(0,v.length-1),e=g.concat(e)),t(e),e=e.join("/")),i&&_&&(v||m)){s=e.split("/");e:for(a=s.length;a>0;a-=1){if(l=s.slice(0,a).join("/"),v)for(u=v.length;u>0;u-=1)if(r=getOwn(_,v.slice(0,u).join("/")),r&&(r=getOwn(r,l))){h=r,p=a;break e}!d&&m&&getOwn(m,l)&&(d=getOwn(m,l),f=a)}!h&&d&&(h=d,p=f),h&&(s.splice(0,p,h),e=s.join("/"))}return o=getOwn(T.pkgs,e),o?o:e}function i(e){isBrowser&&each(scripts(),function(t){return t.getAttribute("data-requiremodule")===e&&t.getAttribute("data-requirecontext")===y.contextName?(t.parentNode.removeChild(t),!0):void 0})}function o(e){var t=getOwn(T.paths,e);return t&&isArray(t)&&t.length>1?(t.shift(),y.require.undef(e),y.makeRequire(null,{skipMap:!0})([e]),!0):void 0}function r(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function s(e,t,i,o){var s,a,u,l,c=null,h=t?t.name:null,p=e,d=!0,f="";return e||(d=!1,e="_@r"+(R+=1)),l=r(e),c=l[0],e=l[1],c&&(c=n(c,h,o),a=getOwn(x,c)),e&&(c?f=a&&a.normalize?a.normalize(e,function(e){return n(e,h,o)}):-1===e.indexOf("!")?n(e,h,o):e:(f=n(e,h,o),l=r(f),c=l[0],f=l[1],i=!0,s=y.nameToUrl(f))),u=!c||a||i?"":"_unnormalized"+(L+=1),{prefix:c,name:f,parentMap:t,unnormalized:!!u,url:s,originalName:p,isDefine:d,id:(c?c+"!"+f:f)+u}}function a(e){var t=e.id,n=getOwn(O,t);return n||(n=O[t]=new y.Module(e)),n}function u(e,t,n){var i=e.id,o=getOwn(O,i);!hasProp(x,i)||o&&!o.defineEmitComplete?(o=a(e),o.error&&"error"===t?n(o.error):o.on(t,n)):"defined"===t&&n(x[i])}function l(e,t){var n=e.requireModules,i=!1;t?t(e):(each(n,function(t){var n=getOwn(O,t);n&&(n.error=e,n.events.error&&(i=!0,n.emit("error",e)))}),i||req.onError(e))}function c(){globalDefQueue.length&&(each(globalDefQueue,function(e){var t=e[0];"string"==typeof t&&(y.defQueueMap[t]=!0),w.push(e)}),globalDefQueue=[])}function h(e){delete O[e],delete A[e]}function p(e,t,n){var i=e.map.id;e.error?e.emit("error",e.error):(t[i]=!0,each(e.depMaps,function(i,o){var r=i.id,s=getOwn(O,r);!s||e.depMatched[o]||n[r]||(getOwn(t,r)?(e.defineDep(o,x[r]),e.check()):p(s,t,n))}),n[i]=!0)}function d(){var e,t,n=1e3*T.waitSeconds,r=n&&y.startTime+n<(new Date).getTime(),s=[],a=[],u=!1,c=!0;if(!m){if(m=!0,eachProp(A,function(e){var n=e.map,l=n.id;if(e.enabled&&(n.isDefine||a.push(e),!e.error))if(!e.inited&&r)o(l)?(t=!0,u=!0):(s.push(l),i(l));else if(!e.inited&&e.fetched&&n.isDefine&&(u=!0,!n.prefix))return c=!1}),r&&s.length)return e=makeError("timeout","Load timeout for modules: "+s,null,s),e.contextName=y.contextName,l(e);c&&each(a,function(e){p(e,{},{})}),r&&!t||!u||!isBrowser&&!isWebWorker||I||(I=setTimeout(function(){I=0,d()},50)),m=!1}}function f(e){hasProp(x,e[0])||a(s(e[0],null,!0)).init(e[1],e[2])}function g(e,t,n,i){e.detachEvent&&!isOpera?i&&e.detachEvent(i,t):e.removeEventListener(n,t,!1)}function v(e){var t=e.currentTarget||e.srcElement;return g(t,y.onScriptLoad,"load","onreadystatechange"),g(t,y.onScriptError,"error"),{node:t,id:t&&t.getAttribute("data-requiremodule")}}function _(){var e;for(c();w.length;){if(e=w.shift(),null===e[0])return l(makeError("mismatch","Mismatched anonymous define() module: "+e[e.length-1]));f(e)}y.defQueueMap={}}var m,E,y,b,I,T={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},O={},A={},C={},w=[],x={},S={},P={},R=1,L=1;return b={require:function(e){return e.require?e.require:e.require=y.makeRequire(e.map)},exports:function(e){return e.usingExports=!0,e.map.isDefine?e.exports?x[e.map.id]=e.exports:e.exports=x[e.map.id]={}:void 0},module:function(e){return e.module?e.module:e.module={id:e.map.id,uri:e.map.url,config:function(){return getOwn(T.config,e.map.id)||{}},exports:e.exports||(e.exports={})}}},E=function(e){this.events=getOwn(C,e.id)||{},this.map=e,this.shim=getOwn(T.shim,e.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},E.prototype={init:function(e,t,n,i){i=i||{},this.inited||(this.factory=t,n?this.on("error",n):this.events.error&&(n=bind(this,function(e){this.emit("error",e)})),this.depMaps=e&&e.slice(0),this.errback=n,this.inited=!0,this.ignore=i.ignore,i.enabled||this.enabled?this.enable():this.check())},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(!this.fetched){this.fetched=!0,y.startTime=(new Date).getTime();var e=this.map;return this.shim?void y.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return e.prefix?this.callPlugin():this.load()})):e.prefix?this.callPlugin():this.load()}},load:function(){var e=this.map.url;S[e]||(S[e]=!0,y.load(this.map.id,e))},check:function(){if(this.enabled&&!this.enabling){var e,t,n=this.map.id,i=this.depExports,o=this.exports,r=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(r)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)try{o=y.execCb(n,r,i,o)}catch(s){e=s}else o=y.execCb(n,r,i,o);if(this.map.isDefine&&void 0===o&&(t=this.module,t?o=t.exports:this.usingExports&&(o=this.exports)),e)return e.requireMap=this.map,e.requireModules=this.map.isDefine?[this.map.id]:null,e.requireType=this.map.isDefine?"define":"require",l(this.error=e)}else o=r;if(this.exports=o,this.map.isDefine&&!this.ignore&&(x[n]=o,req.onResourceLoad)){var a=[];each(this.depMaps,function(e){a.push(e.normalizedMap||e)}),req.onResourceLoad(y,this.map,a)}h(n),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else hasProp(y.defQueueMap,n)||this.fetch()}},callPlugin:function(){var e=this.map,t=e.id,i=s(e.prefix);this.depMaps.push(i),u(i,"defined",bind(this,function(i){var o,r,c,p=getOwn(P,this.map.id),d=this.map.name,f=this.map.parentMap?this.map.parentMap.name:null,g=y.makeRequire(e.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(i.normalize&&(d=i.normalize(d,function(e){return n(e,f,!0)})||""),r=s(e.prefix+"!"+d,this.map.parentMap),u(r,"defined",bind(this,function(e){this.map.normalizedMap=r,this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),c=getOwn(O,r.id),void(c&&(this.depMaps.push(r),this.events.error&&c.on("error",bind(this,function(e){this.emit("error",e)})),c.enable()))):p?(this.map.url=y.nameToUrl(p),void this.load()):(o=bind(this,function(e){this.init([],function(){return e},null,{enabled:!0})}),o.error=bind(this,function(e){this.inited=!0,this.error=e,e.requireModules=[t],eachProp(O,function(e){0===e.map.id.indexOf(t+"_unnormalized")&&h(e.map.id)}),l(e)}),o.fromText=bind(this,function(n,i){var r=e.name,u=s(r),c=useInteractive;i&&(n=i),c&&(useInteractive=!1),a(u),hasProp(T.config,t)&&(T.config[r]=T.config[t]);try{req.exec(n)}catch(h){return l(makeError("fromtexteval","fromText eval for "+t+" failed: "+h,h,[t]))}c&&(useInteractive=!0),this.depMaps.push(u),y.completeLoad(r),g([r],o)}),void i.load(e.name,g,o,T))})),y.enable(i,this),this.pluginMaps[i.id]=i},enable:function(){A[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(e,t){var n,i,o;if("string"==typeof e){if(e=s(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[t]=e,o=getOwn(b,e.id))return void(this.depExports[t]=o(this));this.depCount+=1,u(e,"defined",bind(this,function(e){this.undefed||(this.defineDep(t,e),this.check())})),this.errback?u(e,"error",bind(this,this.errback)):this.events.error&&u(e,"error",bind(this,function(e){this.emit("error",e)}))}n=e.id,i=O[n],hasProp(b,n)||!i||i.enabled||y.enable(e,this)})),eachProp(this.pluginMaps,bind(this,function(e){var t=getOwn(O,e.id);t&&!t.enabled&&y.enable(e,this)})),this.enabling=!1,this.check()},on:function(e,t){var n=this.events[e];n||(n=this.events[e]=[]),n.push(t)},emit:function(e,t){each(this.events[e],function(e){e(t)}),"error"===e&&delete this.events[e]}},y={config:T,contextName:e,registry:O,defined:x,urlFetched:S,defQueue:w,defQueueMap:{},Module:E,makeModuleMap:s,nextTick:req.nextTick,onError:l,configure:function(e){if(e.baseUrl&&"/"!==e.baseUrl.charAt(e.baseUrl.length-1)&&(e.baseUrl+="/"),"string"==typeof e.urlArgs){var t=e.urlArgs;e.urlArgs=function(e,n){return(-1===n.indexOf("?")?"?":"&")+t}}var n=T.shim,i={paths:!0,bundles:!0,config:!0,map:!0};eachProp(e,function(e,t){i[t]?(T[t]||(T[t]={}),mixin(T[t],e,!0,!0)):T[t]=e}),e.bundles&&eachProp(e.bundles,function(e,t){each(e,function(e){e!==t&&(P[e]=t)})}),e.shim&&(eachProp(e.shim,function(e,t){isArray(e)&&(e={deps:e}),!e.exports&&!e.init||e.exportsFn||(e.exportsFn=y.makeShimExports(e)),n[t]=e}),T.shim=n),e.packages&&each(e.packages,function(e){var t,n;e="string"==typeof e?{name:e}:e,n=e.name,t=e.location,t&&(T.paths[n]=e.location),T.pkgs[n]=e.name+"/"+(e.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(O,function(e,t){e.inited||e.map.unnormalized||(e.map=s(t,null,!0))}),(e.deps||e.callback)&&y.require(e.deps||[],e.callback)},makeShimExports:function(e){function t(){var t;return e.init&&(t=e.init.apply(global,arguments)),t||e.exports&&getGlobal(e.exports)}return t},makeRequire:function(t,o){function r(n,i,u){var c,h,p;return o.enableBuildCallback&&i&&isFunction(i)&&(i.__requireJsBuild=!0),"string"==typeof n?isFunction(i)?l(makeError("requireargs","Invalid require call"),u):t&&hasProp(b,n)?b[n](O[t.id]):req.get?req.get(y,n,t,r):(h=s(n,t,!1,!0),c=h.id,hasProp(x,c)?x[c]:l(makeError("notloaded",'Module name "'+c+'" has not been loaded yet for context: '+e+(t?"":". Use require([])")))):(_(),y.nextTick(function(){_(),p=a(s(null,t)),p.skipMap=o.skipMap,p.init(n,i,u,{enabled:!0}),d()}),r)}return o=o||{},mixin(r,{isBrowser:isBrowser,toUrl:function(e){var i,o=e.lastIndexOf("."),r=e.split("/")[0],s="."===r||".."===r;return-1!==o&&(!s||o>1)&&(i=e.substring(o,e.length),e=e.substring(0,o)),y.nameToUrl(n(e,t&&t.id,!0),i,!0)},defined:function(e){return hasProp(x,s(e,t,!1,!0).id)},specified:function(e){return e=s(e,t,!1,!0).id,hasProp(x,e)||hasProp(O,e)}}),t||(r.undef=function(e){c();var n=s(e,t,!0),o=getOwn(O,e);o.undefed=!0,i(e),delete x[e],delete S[n.url],delete C[e],eachReverse(w,function(t,n){t[0]===e&&w.splice(n,1)}),delete y.defQueueMap[e],o&&(o.events.defined&&(C[e]=o.events),h(e))}),r},enable:function(e){var t=getOwn(O,e.id);t&&a(e).enable()},completeLoad:function(e){var t,n,i,r=getOwn(T.shim,e)||{},s=r.exports;for(c();w.length;){if(n=w.shift(),null===n[0]){if(n[0]=e,t)break;t=!0}else n[0]===e&&(t=!0);f(n)}if(y.defQueueMap={},i=getOwn(O,e),!t&&!hasProp(x,e)&&i&&!i.inited){if(!(!T.enforceDefine||s&&getGlobal(s)))return o(e)?void 0:l(makeError("nodefine","No define call for "+e,null,[e]));f([e,r.deps||[],r.exportsFn])}d()},nameToUrl:function(e,t,n){var i,o,r,s,a,u,l,c=getOwn(T.pkgs,e);if(c&&(e=c),l=getOwn(P,e))return y.nameToUrl(l,t,n);if(req.jsExtRegExp.test(e))a=e+(t||"");else{for(i=T.paths,o=e.split("/"),r=o.length;r>0;r-=1)if(s=o.slice(0,r).join("/"),u=getOwn(i,s)){isArray(u)&&(u=u[0]),o.splice(0,r,u);break}a=o.join("/"),a+=t||(/^data\:|^blob\:|\?/.test(a)||n?"":".js"),a=("/"===a.charAt(0)||a.match(/^[\w\+\.\-]+:/)?"":T.baseUrl)+a}return T.urlArgs&&!/^blob\:/.test(a)?a+T.urlArgs(e,a):a},load:function(e,t){req.load(y,e,t)},execCb:function(e,t,n,i){return t.apply(i,n)},onScriptLoad:function(e){if("load"===e.type||readyRegExp.test((e.currentTarget||e.srcElement).readyState)){interactiveScript=null;var t=v(e);y.completeLoad(t.id)}},onScriptError:function(e){var t=v(e);if(!o(t.id)){var n=[];return eachProp(O,function(e,i){0!==i.indexOf("_@r")&&each(e.depMaps,function(e){return e.id===t.id?(n.push(i),!0):void 0})}),l(makeError("scripterror",'Script error for "'+t.id+(n.length?'", needed by: '+n.join(", "):'"'),e,[t.id]))}}},y.require=y.makeRequire(),y}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(e){return"interactive"===e.readyState?interactiveScript=e:void 0}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.2.0",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}"undefined"==typeof require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(e,t,n,i){var o,r,s=defContextName;return isArray(e)||"string"==typeof e||(r=e,isArray(t)?(e=t,t=n,n=i):e=[]),r&&r.context&&(s=r.context),o=getOwn(contexts,s),o||(o=contexts[s]=req.s.newContext(s)),r&&o.configure(r),o.require(e,t,n)},req.config=function(e){return req(e)},req.nextTick="undefined"!=typeof setTimeout?function(e){setTimeout(e,4)}:function(e){e()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(e){req[e]=function(){var t=contexts[defContextName];return t.require[e].apply(t,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(e,t,n){var i=e.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return i.type=e.scriptType||"text/javascript",i.charset="utf-8",i.async=!0,i},req.load=function(e,t,n){var i,o=e&&e.config||{};if(isBrowser)return i=req.createNode(o,t,n),i.setAttribute("data-requirecontext",e.contextName),i.setAttribute("data-requiremodule",t),!i.attachEvent||i.attachEvent.toString&&i.attachEvent.toString().indexOf("[native code")<0||isOpera?(i.addEventListener("load",e.onScriptLoad,!1),i.addEventListener("error",e.onScriptError,!1)):(useInteractive=!0,i.attachEvent("onreadystatechange",e.onScriptLoad)),i.src=n,o.onNodeCreated&&o.onNodeCreated(i,o,t,n),currentlyAddingScript=i,baseElement?head.insertBefore(i,baseElement):head.appendChild(i),currentlyAddingScript=null,i;if(isWebWorker)try{setTimeout(function(){},0),importScripts(n),e.completeLoad(t)}catch(r){e.onError(makeError("importscripts","importScripts failed for "+t+" at "+n,r,[t]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(e){return head||(head=e.parentNode),dataMain=e.getAttribute("data-main"),dataMain?(mainScript=dataMain,cfg.baseUrl||-1!==mainScript.indexOf("!")||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0):void 0}),define=function(e,t,n){var i,o;"string"!=typeof e&&(n=t,t=e,e=null),isArray(t)||(n=t,t=null),!t&&isFunction(n)&&(t=[],n.length&&(n.toString().replace(commentRegExp,commentReplace).replace(cjsRequireRegExp,function(e,n){t.push(n)}),t=(1===n.length?["require"]:["require","exports","module"]).concat(t))),useInteractive&&(i=currentlyAddingScript||getInteractiveScript(),i&&(e||(e=i.getAttribute("data-requiremodule")),o=contexts[i.getAttribute("data-requirecontext")])),o?(o.defQueue.push([e,t,n]),o.defQueueMap[e]=!0):globalDefQueue.push([e,t,n])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this),define("requireLib",function(){}),!function(){function e(e){this.message=e}var t="undefined"!=typeof exports?exports:self,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e.prototype=new Error,e.prototype.name="InvalidCharacterError",t.btoa||(t.btoa=function(t){for(var i,o,r=String(t),s=0,a=n,u="";r.charAt(0|s)||(a="=",s%1);u+=a.charAt(63&i>>8-s%1*8)){if(o=r.charCodeAt(s+=.75),o>255)throw new e("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");i=i<<8|o}return u}),t.atob||(t.atob=function(t){var i=String(t).replace(/=+$/,"");if(i.length%4==1)throw new e("'atob' failed: The string to be decoded is not correctly encoded.");for(var o,r,s=0,a=0,u="";r=i.charAt(a++);~r&&(o=s%4?64*o+r:r,s++%4)?u+=String.fromCharCode(255&o>>(-2*s&6)):0)r=n.indexOf(r);return u})}(),define("lib/base64.min.js",function(){}),window.browserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"Other",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"Unknown","Explorer"==this.browser&&"7"==this.version&&navigator.userAgent.match(/Trident/i)&&(this.version=this.searchVersionIE())},searchString:function(e){for(var t=0;t<e.length;t++){var n=e[t].string;if(this.versionSearchString=e[t].subString,-1!=n.indexOf(e[t].subString))return e[t].identity}},searchVersion:function(e){var t=e.indexOf(this.versionSearchString);if(-1!=t)return parseFloat(e.substring(t+this.versionSearchString.length+1))},searchVersionIE:function(){var e,t=navigator.userAgent.toString().toLowerCase(),n=/(trident)(?:.*rv:([\w.]+))?/.exec(t)||/(msie) ([\w.]+)/.exec(t)||["",null,-1];try{e=n[2].split(".")[0]}catch(i){e="unknown"}return e},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer"},{string:navigator.userAgent,subString:"Trident",identity:"Explorer"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.userAgent,subString:"Safari",identity:"Safari"},{string:navigator.userAgent,subString:"Opera",identity:"Opera"}]},window.browserDetect.init(),define("lib/browserdetect.js",function(){}),function(e){(jQuery.browser=jQuery.browser||{}).mobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|android|ipad|playbook|silk|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}(navigator.userAgent||navigator.vendor||window.opera),define("lib/detectmobilebrowser.js",function(){}),function(e){e(jQuery)}(function(e){if(e.support.cors||!e.ajaxTransport||!window.XDomainRequest)return e;var t=/^(https?:)?\/\//i,n=/^get|post$/i,i=new RegExp("^(//|"+location.protocol+")","i");return e.ajaxTransport("* text html xml json",function(o,r,s){if(o.crossDomain&&o.async&&n.test(o.type)&&t.test(o.url)&&i.test(o.url)){var a=null;return{send:function(t,n){var i="",s=(r.dataType||"").toLowerCase();a=new XDomainRequest,/^\d+$/.test(r.timeout)&&(a.timeout=r.timeout),a.ontimeout=function(){n(500,"timeout")},a.onload=function(){var t="Content-Length: "+a.responseText.length+"\r\nContent-Type: "+a.contentType,i={code:200,message:"success"},o={text:a.responseText};try{if("html"===s||/text\/html/i.test(a.contentType))o.html=a.responseText;else if("json"===s||"text"!==s&&/\/json/i.test(a.contentType))try{o.json=e.parseJSON(a.responseText)}catch(r){i.code=500,i.message="parseerror"}else if("xml"===s||"text"!==s&&/\/xml/i.test(a.contentType)){var u=new ActiveXObject("Microsoft.XMLDOM");u.async=!1;try{u.loadXML(a.responseText)}catch(r){u=void 0}if(!u||!u.documentElement||u.getElementsByTagName("parsererror").length)throw i.code=500,i.message="parseerror","Invalid XML: "+a.responseText;o.xml=u}}catch(l){throw l}finally{n(i.code,i.message,o,t)}},a.onprogress=function(){},a.onerror=function(){n(401,"error",{text:a.responseText})},r.data&&(i="string"===e.type(r.data)?r.data:e.param(r.data)),a.open(o.type,o.url),a.send(i)},abort:function(){a&&a.abort()}}}}),e}),define("lib/jquery.xdomainrequest.js",function(){}),window.Modernizr=function(e,t,n){function i(e){f.cssText=e}function o(e,t){return typeof e===t}function r(){l.input=function(n){for(var i=0,o=n.length;o>i;i++)E[n[i]]=n[i]in g;return E.list&&(E.list=!!t.createElement("datalist")&&!!e.HTMLDataListElement),E}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),l.inputtypes=function(e){for(var i,o,r,s=0,a=e.length;a>s;s++)g.setAttribute("type",o=e[s]),i="text"!==g.type,i&&(g.value=v,g.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(o)&&g.style.WebkitAppearance!==n?(h.appendChild(g),r=t.defaultView,i=r.getComputedStyle&&"textfield"!==r.getComputedStyle(g,null).WebkitAppearance&&0!==g.offsetHeight,h.removeChild(g)):/^(search|tel)$/.test(o)||(i=/^(url|email)$/.test(o)?g.checkValidity&&g.checkValidity()===!1:g.value!=v)),m[e[s]]=!!i;return m}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var s,a,u="2.8.3",l={},c=!0,h=t.documentElement,p="modernizr",d=t.createElement(p),f=d.style,g=t.createElement("input"),v=":)",_=({}.toString,{}),m={},E={},y=[],b=y.slice,I={}.hasOwnProperty;a=o(I,"undefined")||o(I.call,"undefined")?function(e,t){return t in e&&o(e.constructor.prototype[t],"undefined")}:function(e,t){return I.call(e,t)},Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;if("function"!=typeof t)throw new TypeError;var n=b.call(arguments,1),i=function(){if(this instanceof i){var o=function(){};o.prototype=t.prototype;var r=new o,s=t.apply(r,n.concat(b.call(arguments)));return Object(s)===s?s:r}return t.apply(e,n.concat(b.call(arguments)))};return i});for(var T in _)a(_,T)&&(s=T.toLowerCase(),l[s]=_[T](),y.push((l[s]?"":"no-")+s));return l.input||r(),l.addTest=function(e,t){if("object"==typeof e)for(var i in e)a(e,i)&&l.addTest(i,e[i]);else{if(e=e.toLowerCase(),l[e]!==n)return l;t="function"==typeof t?t():t,"undefined"!=typeof c&&c&&(h.className+=" "+(t?"":"no-")+e),l[e]=t}return l},i(""),d=g=null,l._version=u,h.className=h.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(c?" js "+y.join(" "):""),l}(this,this.document),function(e,t,n){function i(e){return"[object Function]"==v.call(e)}function o(e){return"string"==typeof e}function r(){}function s(e){return!e||"loaded"==e||"complete"==e||"uninitialized"==e}function a(){var e=_.shift();m=1,e?e.t?f(function(){("c"==e.t?p.injectCss:p.injectJs)(e.s,0,e.a,e.x,e.e,1)},0):(e(),a()):m=0}function u(e,n,i,o,r,u,l){function c(t){if(!d&&s(h.readyState)&&(E.r=d=1,!m&&a(),h.onload=h.onreadystatechange=null,t)){"img"!=e&&f(function(){b.removeChild(h)},50);for(var i in C[n])C[n].hasOwnProperty(i)&&C[n][i].onload()}}var l=l||p.errorTimeout,h=t.createElement(e),d=0,v=0,E={t:i,s:n,e:r,a:u,x:l};1===C[n]&&(v=1,C[n]=[]),"object"==e?h.data=n:(h.src=n,h.type=e),h.width=h.height="0",h.onerror=h.onload=h.onreadystatechange=function(){c.call(this,v)},_.splice(o,0,E),"img"!=e&&(v||2===C[n]?(b.insertBefore(h,y?null:g),f(c,l)):C[n].push(h))}function l(e,t,n,i,r){return m=0,t=t||"j",o(e)?u("c"==t?T:I,e,t,this.i++,n,i,r):(_.splice(this.i++,0,e),1==_.length&&a()),this}function c(){var e=p;return e.loader={load:l,i:0},e}var h,p,d=t.documentElement,f=e.setTimeout,g=t.getElementsByTagName("script")[0],v={}.toString,_=[],m=0,E="MozAppearance"in d.style,y=E&&!!t.createRange().compareNode,b=y?d:g.parentNode,d=e.opera&&"[object Opera]"==v.call(e.opera),d=!!t.attachEvent&&!d,I=E?"object":d?"script":"img",T=d?"script":I,O=Array.isArray||function(e){return"[object Array]"==v.call(e)},A=[],C={},w={timeout:function(e,t){return t.length&&(e.timeout=t[0]),e}};p=function(e){function t(e){var t,n,i,e=e.split("!"),o=A.length,r=e.pop(),s=e.length,r={url:r,origUrl:r,prefixes:e};for(n=0;s>n;n++)i=e[n].split("="),(t=w[i.shift()])&&(r=t(r,i));for(n=0;o>n;n++)r=A[n](r);return r}function s(e,o,r,s,a){var u=t(e),l=u.autoCallback;u.url.split(".").pop().split("?").shift(),u.bypass||(o&&(o=i(o)?o:o[e]||o[s]||o[e.split("/").pop().split("?")[0]]),u.instead?u.instead(e,o,r,s,a):(C[u.url]?u.noexec=!0:C[u.url]=1,r.load(u.url,u.forceCSS||!u.forceJS&&"css"==u.url.split(".").pop().split("?").shift()?"c":n,u.noexec,u.attrs,u.timeout),(i(o)||i(l))&&r.load(function(){c(),o&&o(u.origUrl,a,s),l&&l(u.origUrl,a,s),C[u.url]=2})))}function a(e,t){function n(e,n){if(e){if(o(e))n||(h=function(){var e=[].slice.call(arguments);p.apply(this,e),d()}),s(e,h,t,0,l);else if(Object(e)===e)for(u in a=function(){var t,n=0;for(t in e)e.hasOwnProperty(t)&&n++;return n}(),e)e.hasOwnProperty(u)&&(!n&&!--a&&(i(h)?h=function(){var e=[].slice.call(arguments);p.apply(this,e),d()}:h[u]=function(e){return function(){var t=[].slice.call(arguments);e&&e.apply(this,t),d()}}(p[u])),s(e[u],h,t,u,l))}else!n&&d()}var a,u,l=!!e.test,c=e.load||e.both,h=e.callback||r,p=h,d=e.complete||r;n(l?e.yep:e.nope,!!c),c&&n(c)}var u,l,h=this.yepnope.loader;if(o(e))s(e,0,h,0);else if(O(e))for(u=0;u<e.length;u++)l=e[u],o(l)?s(l,0,h,0):O(l)?p(l):Object(l)===l&&a(l,h);else Object(e)===e&&a(e,h)},p.addPrefix=function(e,t){w[e]=t},p.addFilter=function(e){A.push(e)},p.errorTimeout=1e4,null==t.readyState&&t.addEventListener&&(t.readyState="loading",t.addEventListener("DOMContentLoaded",h=function(){t.removeEventListener("DOMContentLoaded",h,0),t.readyState="complete"},0)),e.yepnope=c(),e.yepnope.executeStack=a,e.yepnope.injectJs=function(e,n,i,o,u,l){var c,h,d=t.createElement("script"),o=o||p.errorTimeout;d.src=e;for(h in i)d.setAttribute(h,i[h]);n=l?a:n||r,d.onreadystatechange=d.onload=function(){!c&&s(d.readyState)&&(c=1,n(),d.onload=d.onreadystatechange=null)},f(function(){c||(c=1,n(1))},o),u?d.onload():g.parentNode.insertBefore(d,g)},e.yepnope.injectCss=function(e,n,i,o,s,u){var l,o=t.createElement("link"),n=u?a:n||r;o.href=e,o.rel="stylesheet",o.type="text/css";for(l in i)o.setAttribute(l,i[l]);s||(g.parentNode.insertBefore(o,g),f(n,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))},Modernizr.addTest("cors",!!(window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest)),define("lib/modernizr.js",function(){});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),exjs;!function(e){e.version="0.5.1"}(exjs||(exjs={}));var exjs;!function(e){Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)})}(exjs||(exjs={}));var exjs;!function(e){var t=function(){function e(){}return e.prototype.getEnumerator=function(){return{moveNext:function(){return!1},current:void 0}},e.prototype.aggregate=function(e,t){for(var n=e,i=this.getEnumerator();i.moveNext();)n=t(n,i.current);return n},e.prototype.all=function(e){if(e)for(var t=this.getEnumerator(),n=0;t.moveNext();){if(!e(t.current,n))return!1;n++}return!0},e.prototype.any=function(e){for(var t=this.getEnumerator(),n=0;t.moveNext();){if(!e)return!0;if(e(t.current,n))return!0;n++}return!1},e.prototype.append=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Not implemented")},e.prototype.apply=function(e){throw new Error("Not implemented")},e.prototype.at=function(e){for(var t=this.getEnumerator(),n=0;t.moveNext();){if(n===e)return t.current;n++}},e.prototype.average=function(e){var t=0,n=0;e=e||function(e){if("number"!=typeof e)throw new Error("Object is not a number.");return e};for(var i=this.getEnumerator();i.moveNext();)n+=e(i.current),t++;return 0===t?0:n/t},e.prototype.concat=function(e){throw new Error("Not implemented")},e.prototype.count=function(e){for(var t=0,n=this.getEnumerator();n.moveNext();)e&&!e(n.current)||t++;return t},e.prototype.difference=function(e,t){return t=t||function(e,t){return e===t},e instanceof Array&&(e=e.en()),{intersection:this.intersect(e,t).toArray().en(),aNotB:this.except(e,t).toArray().en(),bNotA:e.except(this,t).toArray().en()}},e.prototype.distinct=function(e){throw new Error("Not implemented")},e.prototype.except=function(e,t){throw new Error("Not implemented")},e.prototype.first=function(e){for(var t=this.getEnumerator();t.moveNext();)if(!e||e(t.current))return t.current},e.prototype.firstIndex=function(e){for(var t=this.getEnumerator(),n=0;t.moveNext();n++)if(!e||e(t.current))return n;return-1},e.prototype.forEach=function(e){for(var t=this.getEnumerator();t.moveNext();)e(t.current);
},e.prototype.groupBy=function(e,t){throw new Error("Not implemented")},e.prototype.intersect=function(e,t){throw new Error("Not implemented")},e.prototype.join=function(e,t,n,i,o){throw new Error("Not implemented")},e.prototype.last=function(e){for(var t,n=this.getEnumerator();n.moveNext();)e&&!e(n.current)||(t=n.current);return t},e.prototype.lastIndex=function(e){for(var t=-1,n=this.getEnumerator(),i=0;n.moveNext();i++)e&&!e(n.current)||(t=i);return t},e.prototype.max=function(e){var t=this.getEnumerator();if(!t.moveNext())return 0;e=e||function(e){if("number"!=typeof e)throw new Error("Object is not a number.");return e};for(var n=e(t.current);t.moveNext();)n=Math.max(n,e(t.current));return n},e.prototype.min=function(e){var t=this.getEnumerator();if(!t.moveNext())return 0;e=e||function(e){if("number"!=typeof e)throw new Error("Object is not a number.");return e};for(var n=e(t.current);t.moveNext();)n=Math.min(n,e(t.current));return n},e.prototype.orderBy=function(e,t){throw new Error("Not implemented")},e.prototype.orderByDescending=function(e,t){throw new Error("Not implemented")},e.prototype.prepend=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Not implemented")},e.prototype.reverse=function(){throw new Error("Not implemented")},e.prototype.select=function(e){throw new Error("Not implemented")},e.prototype.selectMany=function(e){throw new Error("Not implemented")},e.prototype.skip=function(e){throw new Error("Not implemented")},e.prototype.skipWhile=function(e){throw new Error("Not implemented")},e.prototype.standardDeviation=function(e){var t=this.average(e),n=0,i=0;e=e||function(e){if("number"!=typeof e)throw new Error("Object is not a number.");return e};for(var o=this.getEnumerator();o.moveNext();){var r=e(o.current)-t;n+=r*r,i++}return Math.sqrt(n/i)},e.prototype.sum=function(e){var t=0;e=e||function(e){if("number"!=typeof e)throw new Error("Object is not a number.");return e};for(var n=this.getEnumerator();n.moveNext();)t+=e(n.current);return t},e.prototype.take=function(e){throw new Error("Not implemented")},e.prototype.takeWhile=function(e){throw new Error("Not implemented")},e.prototype.traverse=function(e){throw new Error("Not implemented")},e.prototype.traverseUnique=function(e,t){throw new Error("Not implemented")},e.prototype.toArray=function(){for(var e=[],t=this.getEnumerator();t.moveNext();)e.push(t.current);return e},e.prototype.toMap=function(e,t){throw new Error("Not implemented")},e.prototype.toList=function(){throw new Error("Not implemented")},e.prototype.union=function(e,t){throw new Error("Not implemented")},e.prototype.where=function(e){throw new Error("Not implemented")},e.prototype.zip=function(e,t){throw new Error("Not implemented")},e}();e.Enumerable=t}(exjs||(exjs={}));var exjs;!function(e){var t=function(){function t(e){this.size=0,this._keys=[],this._values=[];var t;if(e instanceof Array?t=e.en():e&&e.getEnumerator instanceof Function&&(t=e),t)for(var n=t.getEnumerator();n&&n.moveNext();)this.set(n.current[0],n.current[1])}return t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this.size=0},t.prototype["delete"]=function(e){var t=this._keys.indexOf(e);return t>-1&&(this._keys.splice(t,1),this._values.splice(t,1),this.size--,!0)},t.prototype.entries=function(){var t=this;return e.range(0,this.size).select(function(e){return[t._keys[e],t._values[e]]})},t.prototype.forEach=function(e,t){null==t&&(t=this);for(var n=0,i=this._keys,o=this._values,r=i.length;r>n;n++)e.call(t,o[n],i[n],this)},t.prototype.get=function(e){var t=this._keys.indexOf(e);return this._values[t]},t.prototype.has=function(e){return this._keys.indexOf(e)>-1},t.prototype.keys=function(){return this._keys.en()},t.prototype.set=function(e,t){var n=this._keys.indexOf(e);n>-1?this._values[n]=t:(this._keys.push(e),this._values.push(t),this.size++)},t.prototype.values=function(){return this._values.en()},t}();e.Map3=t,e.Enumerable.prototype.toMap=function(e,n){for(var i=new t,o=this.getEnumerator();o.moveNext();)i.set(e(o.current),n(o.current));return i},e.List&&(e.List.prototype.toMap=e.Enumerable.prototype.toMap)}(exjs||(exjs={})),function(e){e.Map||(e.Map=exjs.Map3)}("undefined"==typeof window?global:window);var exjs;!function(e){function t(t){var n=new e.Enumerable;return n.getEnumerator=function(){var e={current:void 0,moveNext:function(){return t(e)}};return e},n}e.anonymous=t}(exjs||(exjs={}));var exjs;!function(e){function t(e,t){var n,i,o=1,r={current:void 0,moveNext:function(){if(2>o){if(n=n||e.getEnumerator(),n.moveNext())return r.current=n.current,!0;o++}return i=i||t.en().getEnumerator(),i.moveNext()?(r.current=i.current,!0):(r.current=void 0,!1)}};return r}e.Enumerable.prototype.append=function(){for(var n=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];var r=new e.Enumerable;return r.getEnumerator=function(){return t(n,i)},r},e.List&&(e.List.prototype.append=e.Enumerable.prototype.append)}(exjs||(exjs={}));var exjs;!function(e){function t(e,t){var n,i=0,o={current:void 0,moveNext:function(){return n||(n=e.getEnumerator()),!!n.moveNext()&&(t(o.current=n.current,i),i++,!0)}};return o}e.Enumerable.prototype.apply=function(n){var i=this,o=new e.Enumerable;return o.getEnumerator=function(){return t(i,n)},o},e.List&&(e.List.prototype.apply=e.Enumerable.prototype.apply)}(exjs||(exjs={}));var exjs;!function(e){function t(e){var t=e.length,n={moveNext:void 0,current:void 0},i=-1;return n.moveNext=function(){return i++,i>=t?(n.current=void 0,!1):(n.current=e[i],!0)},n}function n(){return this&&Array.isArray(this)?new i(this):new e.Enumerable}var i=function(e){function n(n){var i=e.call(this)||this;return i.getEnumerator=function(){return t(n)},i.toArray=function(){return n.slice(0)},i}return __extends(n,e),n}(e.Enumerable);try{Object.defineProperty(Array.prototype,"en",{value:n,enumerable:!1,writable:!1,configurable:!1})}catch(e){Array.prototype.en=n}}(exjs||(exjs={}));var exjs;!function(e){function t(e,t){var n,i=!1,o={current:void 0,moveNext:function(){return n||(n=e.getEnumerator()),o.current=void 0,n.moveNext()?(o.current=n.current,!0):!i&&(i=!0,n=t.getEnumerator(),!!n.moveNext()&&(o.current=n.current,!0))}};return o}e.Enumerable.prototype.concat=function(n){var i=this,o=n instanceof Array?n.en():n,r=new e.Enumerable;return r.getEnumerator=function(){return t(i,o)},r},e.List&&(e.List.prototype.concat=e.Enumerable.prototype.concat)}(exjs||(exjs={}));var exjs;!function(e){function t(e,t){var n,i=[],o={current:void 0,moveNext:function(){if(n||(n=e.getEnumerator()),o.current=void 0,!t){for(;n.moveNext();)if(i.indexOf(n.current)<0)return i.push(o.current=n.current),!0;return!1}for(;n.moveNext();){for(var r=0,s=i.length,a=!1;s>r&&!a;r++)a=!!t(i[r],n.current);if(!a)return i.push(o.current=n.current),!0}return!1}};return o}e.Enumerable.prototype.distinct=function(n){var i=this,o=new e.Enumerable;return o.getEnumerator=function(){return t(i,n)},o},e.List&&(e.List.prototype.distinct=e.Enumerable.prototype.distinct)}(exjs||(exjs={}));var exjs;!function(e){function t(e,t,n){n=n||function(e,t){return e===t};var i,o={current:void 0,moveNext:function(){for(i||(i=e.getEnumerator()),o.current=void 0;i.moveNext();){for(var r=!1,s=t.getEnumerator();s.moveNext()&&!r;)r=n(i.current,s.current);if(!r)return o.current=i.current,!0}return!1}};return o}e.Enumerable.prototype.except=function(n,i){var o=this,r=n instanceof Array?n.en():n,s=new e.Enumerable;return s.getEnumerator=function(){return t(o,r,i)},s},e.List&&(e.List.prototype.except=e.Enumerable.prototype.except)}(exjs||(exjs={})),Function.prototype.fromJson=function(e,t){function n(e,t){if(null==e)return e;if(t instanceof Function)return t(e);if(t instanceof Array){if(t=t[0],!(t instanceof Function&&e instanceof Array))return;for(var n=[],i=0;i<e.length;i++)n.push(t(e[i]));return n}}var i=new this;if(null==e)return i;var o=[];for(var r in t){var s=n(e[r],t[r]);void 0!==s&&(i[r]=s,o.push(r))}for(var r in this.$jsonMappings)if(!(o.indexOf(r)>-1)){var s=n(e[r],this.$jsonMappings[r]);void 0!==s&&(i[r]=s,o.push(r))}for(var r in e)o.indexOf(r)>-1||(i[r]=e[r]);return i};var exjs;!function(e){function t(e,t,i){var o,r=0,s={current:void 0,moveNext:function(){return o||(o=n(e,t,i)),s.current=void 0,!(r>=o.length||(s.current=o[r],r++,0))}};return s}function n(e,t,n){n=n||function(e,t){return e===t};for(var o,r=[],s=[],a=e.getEnumerator();a.moveNext();){o=t(a.current);for(var u=-1,l=0,c=s.length;c>l;l++)if(n(o,s[l])){u=l;break}var h;0>u?(s.push(o),r.push(h=new i(o))):h=r[u],h._add(a.current)}return r}var i=function(e){function t(t){var n=e.call(this)||this;return n.key=t,n._arr=[],n.getEnumerator=function(){return n._arr.en().getEnumerator()},n}return __extends(t,e),t.prototype._add=function(e){this._arr.push(e)},t}(e.Enumerable);e.Enumerable.prototype.groupBy=function(n,i){var o=this,r=new e.Enumerable;return r.getEnumerator=function(){return t(o,n,i)},r},e.List&&(e.List.prototype.groupBy=e.Enumerable.prototype.groupBy)}(exjs||(exjs={}));var exjs;!function(e){function t(t,n,i){i=i||function(e,t){return e===t};var o,r={current:void 0,moveNext:function(){for(o||(o=e.en(t).distinct().getEnumerator()),r.current=void 0;o.moveNext();){for(var s=!1,a=n.getEnumerator();a.moveNext()&&!s;)s=i(o.current,a.current);if(s)return r.current=o.current,!0}return!1}};return r}e.Enumerable.prototype.intersect=function(n,i){var o=this,r=n instanceof Array?n.en():n,s=new e.Enumerable;return s.getEnumerator=function(){return t(o,r,i)},s},e.List&&(e.List.prototype.intersect=e.Enumerable.prototype.intersect)}(exjs||(exjs={}));var exjs;!function(e){function t(t,n,i,o,r,s){s=s||function(e,t){return e===t};var a,u,l=0,c={current:void 0,moveNext:function(){if(c.current=void 0,!a){if(a=t.getEnumerator(),!a.moveNext())return!1;u=e.en(n).toArray()}var h;do{for(;l<u.length;l++)if(h=u[l],s(i(a.current),o(h)))return l++,c.current=r(a.current,h),!0;l=0}while(a.moveNext());return!1}};return c}e.Enumerable.prototype.join=function(n,i,o,r,s){var a=this,u=n instanceof Array?n.en():n,l=new e.Enumerable;return l.getEnumerator=function(){return t(a,u,i,o,r,s)},l},e.List&&(e.List.prototype.join=e.Enumerable.prototype.join)}(exjs||(exjs={}));var exjs;!function(e){function t(){this.constructor=n}e.Enumerable.prototype.toList=function(){for(var e=new n,t=this.getEnumerator();t.moveNext();)e.push(t.current);return e};var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.toString=function(){throw new Error("Not implemented")},t.prototype.toLocaleString=function(){throw new Error("Not implemented")},t.prototype.pop=function(){throw new Error("Not implemented")},t.prototype.push=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Not implemented")},t.prototype.shift=function(){throw new Error("Not implemented")},t.prototype.slice=function(e,t){throw new Error("Not implemented")},t.prototype.sort=function(e){throw new Error("Not implemented")},t.prototype.splice=function(){throw new Error("Not implemented")},t.prototype.unshift=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];throw new Error("Not implemented")},t.prototype.indexOf=function(e,t){throw new Error("Not implemented")},t.prototype.lastIndexOf=function(e,t){throw new Error("Not implemented")},t.prototype.every=function(e,t){throw new Error("Not implemented")},t.prototype.some=function(e,t){throw new Error("Not implemented")},t.prototype.forEach=function(e,t){throw new Error("Not implemented")},t.prototype.map=function(e,t){throw new Error("Not implemented")},t.prototype.filter=function(e,t){throw new Error("Not implemented")},t.prototype.reduce=function(e,t){throw new Error("Not implemented")},t.prototype.reduceRight=function(e,t){throw new Error("Not implemented")},t.prototype.remove=function(e){throw new Error("Not implemented")},t.prototype.removeWhere=function(e){throw new Error("Not implemented")},t}(e.Enumerable);e.List=n;for(var i in Array)Array.hasOwnProperty(i)&&(n[i]=Array[i]);t.prototype=Array.prototype,n.prototype=new t;for(var o in e.Enumerable.prototype)"getEnumerator"!==o&&(n.prototype[o]=e.Enumerable.prototype[o]);n.prototype.getEnumerator=function(){var e=this,t=e.length,n={moveNext:void 0,current:void 0},i=-1;return n.moveNext=function(){return i++,i>=t?(n.current=void 0,!1):(n.current=e[i],!0)},n},n.prototype.remove=function(e){return this.removeWhere(function(t){return t===e}).any()},n.prototype.removeWhere=function(e){for(var t,n=[],i=this.length-1;i>=0;i--)t=this[i],e(t,i)===!0&&(this.splice(i,1),n.push(t));return n.en().reverse()}}(exjs||(exjs={}));var exjs;!function(e){function t(e,t,i,o){return new n(e,t,i,o)}var n=function(t){function n(e,n,i,o){var r=t.call(this)||this;r.Source=e,o=o||function(e,t){return e>t?1:t>e?-1:0};var s=i===!0?-1:1;return r.Sorter=function(e,t){return s*o(n(e),n(t))},r}return __extends(n,t),n.prototype.getEnumerator=function(){var t,n=this.Source,i=this.Sorter,o=0,r={current:void 0,moveNext:function(){return t||(t=e.en(n).toArray(),t.sort(i)),r.current=void 0,!(o>=t.length||(r.current=t[o],o++,0))}};return r},n.prototype.thenBy=function(e,t){return new i(this,e,!1,t)},n.prototype.thenByDescending=function(e,t){return new i(this,e,!0,t)},n}(e.Enumerable),i=function(e){function t(t,n,i,o){var r=e.call(this,t,n,i,o)||this,s=t.Sorter,a=r.Sorter;return r.Sorter=function(e,t){return s(e,t)||a(e,t)},r}return __extends(t,e),t}(n),o=e.Enumerable.prototype;o.orderBy=function(e,n){return t(this,e,!1,n)},o.orderByDescending=function(e,n){return t(this,e,!0,n)},e.List&&(e.List.prototype.orderBy=e.Enumerable.prototype.orderBy,e.List.prototype.orderByDescending=e.Enumerable.prototype.orderByDescending)}(exjs||(exjs={}));var exjs;!function(e){function t(e,t){var n,i,o=1,r={current:void 0,moveNext:function(){if(2>o){if(n=n||t.en().getEnumerator(),n.moveNext())return r.current=n.current,!0;o++}return i=i||e.getEnumerator(),i.moveNext()?(r.current=i.current,!0):(r.current=void 0,!1)}};return r}e.Enumerable.prototype.prepend=function(){for(var n=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];var r=new e.Enumerable;return r.getEnumerator=function(){return t(n,i)},r},e.List&&(e.List.prototype.prepend=e.Enumerable.prototype.prepend)}(exjs||(exjs={}));var exjs;!function(e){function t(e,t,n){var i=e-n,o={current:void 0,moveNext:function(){return i+=n,!(i>=t||(o.current=i,0))}};return o}function n(n,i,o){if(n=n||0,i=i||0,n>i)throw new Error("Start cannot be greater than end.");null==o&&(o=1);var r=new e.Enumerable;return r.getEnumerator=function(){return t(n,i,o)},r}e.range=n}(exjs||(exjs={}));var exjs;!function(e){function t(t){var n,i=0,o={current:void 0,moveNext:function(){return n||(n=e.en(t).toArray(),i=n.length),i--,o.current=n[i],i>=0}};return o}e.Enumerable.prototype.reverse=function(){var n=this,i=new e.Enumerable;return i.getEnumerator=function(){return t(n)},i},e.List&&(e.List.prototype.reverse=e.Enumerable.prototype.reverse)}(exjs||(exjs={}));var exjs;!function(e){function t(e,t){if(t=t||0,0===t)return Math.round(e);var n=Math.pow(10,t);return Math.round(e*n)/n}e.round=t}(exjs||(exjs={}));var exjs;!function(e){function t(e,t){var n,i=0,o={current:void 0,moveNext:function(){return n||(n=e.getEnumerator()),!!n.moveNext()&&(o.current=t(n.current,i),i++,!0)}};return o}function n(t,n){var i,o,r={current:void 0,moveNext:function(){for(r.current=void 0,i||(i=t.getEnumerator());!o||!o.moveNext();){if(!i.moveNext())return!1;o=e.selectorEnumerator(n(i.current))}return r.current=o.current,!0}};return r}e.Enumerable.prototype.select=function(n){var i=this,o=new e.Enumerable;return o.getEnumerator=function(){return t(i,n)},o},e.Enumerable.prototype.selectMany=function(t){var i=this,o=new e.Enumerable;return o.getEnumerator=function(){return n(i,t)},o},e.List&&(e.List.prototype.select=e.Enumerable.prototype.select,e.List.prototype.selectMany=e.Enumerable.prototype.selectMany)}(exjs||(exjs={}));var exjs;!function(e){function t(e){return Array.isArray(e)?e.en().getEnumerator():null!=e&&"function"==typeof e.getEnumerator?e.getEnumerator():null}e.selectorEnumerator=t}(exjs||(exjs={}));var exjs;!function(e){function t(e,t){var n,i={current:void 0,moveNext:function(){if(!n){n=e.getEnumerator();for(var o=0;t>o;o++)if(!n.moveNext())return!1}return n.moveNext()?(i.current=n.current,!0):(i.current=void 0,!1)}};return i}function n(e,t){var n,i={current:void 0,moveNext:function(){if(!n){n=e.getEnumerator();for(var o=0;n.moveNext();o++)if(!t(i.current=n.current,o))return!0;return i.current=void 0,!1}return n.moveNext()?(i.current=n.current,!0):(i.current=void 0,!1)}};return i}e.Enumerable.prototype.skip=function(n){var i=this,o=new e.Enumerable;return o.getEnumerator=function(){return t(i,n)},o},e.Enumerable.prototype.skipWhile=function(t){var i=this,o=new e.Enumerable;return o.getEnumerator=function(){return n(i,t)},o},e.List&&(e.List.prototype.skip=e.Enumerable.prototype.skip,e.List.prototype.skipWhile=e.Enumerable.prototype.skipWhile)}(exjs||(exjs={}));var exjs;!function(e){function t(e,t){var n,i=0,o={current:void 0,moveNext:function(){return n||(n=e.getEnumerator()),i++,!(i>t||(o.current=void 0,!n.moveNext()||(o.current=n.current,0)))}};return o}function n(e,t){var n,i=0,o={current:void 0,moveNext:function(){return n||(n=e.getEnumerator()),n.moveNext()&&t(n.current,i)?(i++,o.current=n.current,!0):(o.current=void 0,!1)}};return o}e.Enumerable.prototype.take=function(n){var i=this,o=new e.Enumerable;return o.getEnumerator=function(){return t(i,n)},o},e.Enumerable.prototype.takeWhile=function(t){var i=this,o=new e.Enumerable;return o.getEnumerator=function(){return n(i,t)},o},e.List&&(e.List.prototype.take=e.Enumerable.prototype.take,e.List.prototype.takeWhile=e.Enumerable.prototype.takeWhile)}(exjs||(exjs={}));var exjs;!function(e){function t(t,n){var i,o=!1,r=[],s={current:void 0,moveNext:function(){if(o){if(null==i)return!1;r.push(i),i=e.selectorEnumerator(n(s.current))}else i=t.getEnumerator(),o=!0;for(;!(i&&i.moveNext()||r.length<1);)i=r.pop();return s.current=null==i?void 0:i.current,void 0!==s.current}};return s}function n(t,n,i){var o,r=!1,s=[],a={current:void 0,moveNext:function(){if(r){if(null==o)return!1;s.push(o),o=e.selectorEnumerator(n(a.current))}else o=t.getEnumerator(),r=!0;do{for(;!(o&&o.moveNext()||s.length<1);)o=s.pop();a.current=null==o?void 0:o.current}while(i(a.current));return void 0!==a.current}};return a}e.Enumerable.prototype.traverse=function(n){var i=this,o=new e.Enumerable;return o.getEnumerator=function(){return t(i,n)},o},e.Enumerable.prototype.traverseUnique=function(t,i){var o=this,r=[],s=new e.Enumerable;return i?s.getEnumerator=function(){return n(o,t,function(e){return!!r.some(function(t){return i(e,t)})||(r.push(e),!1)})}:s.getEnumerator=function(){return n(o,t,function(e){return r.indexOf(e)>-1||(r.push(e),!1)})},s},e.List&&(e.List.prototype.traverse=e.Enumerable.prototype.traverse,e.List.prototype.traverseUnique=e.Enumerable.prototype.traverseUnique)}(exjs||(exjs={}));var exjs;!function(e){function t(t,n,i){i=i||function(e,t){return e===t};var o,r,s=[],a={current:void 0,moveNext:function(){if(o||(o=e.en(t).distinct().getEnumerator()),a.current=void 0,!r&&o.moveNext())return s.push(a.current=o.current),!0;for(r=r||e.en(n).distinct().getEnumerator();r.moveNext();){for(var u=0,l=!1,c=s.length;c>u&&!l;u++)l=i(s[u],r.current);if(!l)return a.current=r.current,!0}return!1}};return a}e.Enumerable.prototype.union=function(n,i){var o=this,r=n instanceof Array?n.en():n,s=new e.Enumerable;return s.getEnumerator=function(){return t(o,r,i)},s},e.List&&(e.List.prototype.union=e.Enumerable.prototype.union)}(exjs||(exjs={}));var exjs;!function(e){function t(e,t){var n,i={current:void 0,moveNext:function(){n||(n=e.getEnumerator());for(var o;n.moveNext();)if(t(o=n.current))return i.current=o,!0;return!1}};return i}e.Enumerable.prototype.where=function(n){var i=this,o=new e.Enumerable;return o.getEnumerator=function(){return t(i,n)},o},e.List&&(e.List.prototype.where=e.Enumerable.prototype.where)}(exjs||(exjs={}));var exjs;!function(e){function t(t){var i=new e.Enumerable;return i.getEnumerator=function(){return n(t)},i}function n(e){var t=e.getEnumerator(),n={current:void 0,moveNext:void 0};return n.moveNext=function(){return t.moveNext()?(n.current=t.current,!0):(n.current=void 0,!1)},n}e.en=t}(exjs||(exjs={}));var ex=exjs.en,exjs;!function(e){function t(e,t,n){var i,o,r={current:void 0,moveNext:function(){return i||(i=e.getEnumerator()),o||(o=t.getEnumerator()),r.current=void 0,!(!i.moveNext()||!o.moveNext()||(r.current=n(i.current,o.current),0))}};return r}e.Enumerable.prototype.zip=function(n,i){var o=this,r=n instanceof Array?n.en():n,s=new e.Enumerable;return s.getEnumerator=function(){return t(o,r,i)},s},e.List&&(e.List.prototype.zip=e.Enumerable.prototype.zip)}(exjs||(exjs={})),define("lib/ex.es3.min.js",function(){});var _Components;!function(e){var t=function(){function e(e){this.options=e,this.options.data=$.extend(this.data(),e.data)}return e.prototype._init=function(){return this._$element=$(this.options.target),this._$element.length?(this._$element.empty(),!0):(console.warn("element not found"),!1)},e.prototype.data=function(){return{}},e.prototype.on=function(e,t,n){var i=this._e||(this._e={});(i[e]||(i[e]=[])).push({fn:t,ctx:n})},e.prototype.fire=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var i=[].slice.call(arguments,1),o=((this._e||(this._e={}))[e]||[]).slice(),r=0,s=o.length;for(r;s>r;r++)o[r].fn.apply(o[r].ctx,i)},e.prototype._resize=function(){},e.prototype.set=function(e){},e}();e.BaseComponent=t}(_Components||(_Components={})),function(e){e._Components||(e._Components=_Components)}(window),define("lib/BaseComponent.js",function(){});var KeyCodes;!function(e){var t;!function(e){e.Backspace=8,e.Tab=9,e.Enter=13,e.Shift=16,e.Ctrl=17,e.Alt=18,e.PauseBreak=19,e.CapsLock=20,e.Escape=27,e.Spacebar=32,e.PageUp=33,e.PageDown=34,e.End=35,e.Home=36,e.LeftArrow=37,e.UpArrow=38,e.RightArrow=39,e.DownArrow=40,e.PrintScrn=44,e.Insert=45,e.Delete=46,e.Zero=48,e.One=49,e.Two=50,e.Three=51,e.Four=52,e.Five=53,e.Six=54,e.Seven=55,e.Eight=56,e.Nine=57,e.a=65,e.b=66,e.c=67,e.d=68,e.e=69,e.f=70,e.g=71,e.h=72,e.i=73,e.j=74,e.k=75,e.l=76,e.m=77,e.n=78,e.o=79,e.p=80,e.q=81,e.r=82,e.s=83,e.t=84,e.u=85,e.v=86,e.w=87,e.x=88,e.y=89,e.z=90,e.LeftWindowKey=91,e.RightWindowKey=92,e.SelectKey=93,e.Numpad0=96,e.Numpad1=97,e.Numpad2=98,e.Numpad3=99,e.Numpad4=100,e.Numpad5=101,e.Numpad6=102,e.Numpad7=103,e.Numpad8=104,e.Numpad9=105,e.Multiply=106,e.NumpadPlus=107,e.NumpadMinus=109,e.DecimalPoint=110,e.Divide=111,e.F1=112,e.F2=113,e.F3=114,e.F4=115,e.F5=116,e.F6=117,e.F7=118,e.F8=119,e.F9=120,e.F10=121,e.F11=122,e.F12=123,e.NumLock=144,e.ScrollLock=145,e.Semicolon=186,e.Equals=187,e.Comma=188,e.LessThan=188,e.Dash=189,e.Period=190,e.GreaterThan=190,e.ForwardSlash=191,e.QuestionMark=191,e.GraveAccent=192,e.Tilde=192,e.OpenCurlyBracket=219,e.OpenSquareBracket=219,e.BackSlash=220,e.VerticalPipe=220,e.CloseCurlyBracket=221,e.CloseSquareBracket=221,e.Quote=222,e.CommandFF=224}(t=e.KeyDown||(e.KeyDown={}))}(KeyCodes||(KeyCodes={})),function(e){var t;!function(e){e.Backspace=8,e.Enter=13,e.Spacebar=32,e.Hash=35,e.GraveAccent=39,e.DoubleQuote=34,e.Asterisk=42,e.Plus=43,e.Comma=44,e.Minus=45,e.Period=46,e.ForwardSlash=47,e.Zero=48,e.One=49,e.Two=50,e.Three=51,e.Four=52,e.Five=53,e.Six=54,e.Seven=55,e.Eight=56,e.Nine=57,e.Colon=58,e.Semicolon=59,e.LessThan=60,e.Equals=61,e.GreaterThan=62,e.QuestionMark=63,e.At=64,e.OpenSquareBracket=91,e.BackSlash=92,e.CloseSquareBracket=93,e.a=97,e.b=98,e.c=99,e.d=100,e.e=101,e.f=102,e.g=103,e.h=104,e.i=105,e.j=106,e.k=107,e.l=108,e.m=109,e.n=110,e.o=111,e.p=112,e.q=113,e.r=114,e.s=115,e.t=116,e.u=117,e.v=118,e.w=119,e.x=120,e.y=121,e.z=122,e.OpenCurlyBracket=123,e.VerticalPipe=124,e.CloseCurlyBracket=125,e.Tilde=126}(t=e.KeyPress||(e.KeyPress={}))}(KeyCodes||(KeyCodes={})),function(e){e.KeyCodes||(e.KeyCodes=KeyCodes)}(window),define("lib/KeyCodes.js",function(){});var HTTPStatusCode;!function(e){e.CONTINUE=100,e.SWITCHING_PROTOCOLS=101,e.PROCESSING=102,e.OK=200,e.CREATED=201,e.ACCEPTED=202,e.NON_AUTHORITATIVE_INFORMATION=203,e.NO_CONTENT=204,e.RESET_CONTENT=205,e.PARTIAL_CONTENT=206,e.MULTI_STATUS=207,e.MULTIPLE_CHOICES=300,e.MOVED_PERMANENTLY=301,e.MOVED_TEMPORARILY=302,e.SEE_OTHER=303,e.NOT_MODIFIED=304,e.USE_PROXY=305,e.TEMPORARY_REDIRECT=307,e.BAD_REQUEST=400,e.UNAUTHORIZED=401,e.PAYMENT_REQUIRED=402,e.FORBIDDEN=403,e.NOT_FOUND=404,e.METHOD_NOT_ALLOWED=405,e.NOT_ACCEPTABLE=406,e.PROXY_AUTHENTICATION_REQUIRED=407,e.REQUEST_TIME_OUT=408,e.CONFLICT=409,e.GONE=410,e.LENGTH_REQUIRED=411,e.PRECONDITION_FAILED=412,e.REQUEST_ENTITY_TOO_LARGE=413,e.REQUEST_URI_TOO_LARGE=414,e.UNSUPPORTED_MEDIA_TYPE=415,e.REQUESTED_RANGE_NOT_SATISFIABLE=416,e.EXPECTATION_FAILED=417,e.IM_A_TEAPOT=418,e.UNPROCESSABLE_ENTITY=422,e.LOCKED=423,e.FAILED_DEPENDENCY=424,e.UNORDERED_COLLECTION=425,e.UPGRADE_REQUIRED=426,e.PRECONDITION_REQUIRED=428,e.TOO_MANY_REQUESTS=429,e.REQUEST_HEADER_FIELDS_TOO_LARGE=431,e.INTERNAL_SERVER_ERROR=500,e.NOT_IMPLEMENTED=501,e.BAD_GATEWAY=502,e.SERVICE_UNAVAILABLE=503,e.GATEWAY_TIME_OUT=504,e.HTTP_VERSION_NOT_SUPPORTED=505,e.VARIANT_ALSO_NEGOTIATES=506,e.INSUFFICIENT_STORAGE=507,e.BANDWIDTH_LIMIT_EXCEEDED=509,e.NOT_EXTENDED=510,e.NETWORK_AUTHENTICATION_REQUIRED=511}(HTTPStatusCode||(HTTPStatusCode={})),function(e){e.HTTPStatusCode||(e.HTTPStatusCode=HTTPStatusCode)}(window),define("lib/HTTPStatusCode.js",function(){}),function(e){function t(){var n=this===document?e(this):e(this).contents();n.mousemove(function(e){jQuery.mlp={x:e.pageX,y:e.pageY}}),n.find("iframe").on("load",t)}e.fn.checkboxButton=function(t){return this.each(function(){var n=e(this);n.on("click",function(n){var i=n.target.tagName,o=e(this).find(":checkbox");"INPUT"!==i&&(n.preventDefault(),o.prop("checked",!o.prop("checked")));var r=o.is(":checked");t.call(this,r)})})},e.fn.disable=function(){return this.each(function(){var t=e(this);t.addClass("disabled"),t.data("tabindex",t.attr("tabindex")),t.removeAttr("tabindex")})},e.fn.ellipsis=function(t){return this.each(function(){var n=e(this),i=n.text();if(i.length>t){var o=i.substr(0,t);o=o.substr(0,Math.min(o.length,o.lastIndexOf(" "))),n.empty().html(o+"&hellip;")}})},e.fn.ellipsisFill=function(t){var n=!0;return t||(n=!1),this.each(function(){var i=e(this);n||(t=i.text()),i.empty();var o=e('<span title="'+t+'"></span>');if(i.append(o),i.css("overflow","hidden"),o.css("white-space","nowrap"),o.html(t),o.width()>i.width())for(var r=null;o.width()>i.width();){var s=o.html();if(s=s.substring(0,s.lastIndexOf(" "))+"&hellip;",s===r)break;o.html(s),r=s}})},e.fn.ellipsisHtmlFixed=function(t,n){return this.each(function(){var i=e(this),o=i.html(),r=e("<span></span>");if(r.html(i.html().replace(/\s[\s]*/g," ").trim()),!(r.text().trim().length<=t)){for(;r.text().trim().length>t;)r.removeLastWord(t);var s=r.html(),a=!1;i.toggle=function(){i.empty();var t=e('<a href="#" class="toggle"></a>');a?(i.html(o+" "),t.text("less"),t.switchClass("less","more")):(i.html(s+"&hellip; "),t.text("more"),t.switchClass("more","less")),t.one("click",function(e){e.preventDefault(),i.toggle()}),a=!a,i.append(t),n&&n()},i.toggle()}})},e.fn.enable=function(){return this.each(function(){var t=e(this);t.removeClass("disabled"),t.attr("tabindex",t.data("tabindex"))})},e.fn.equaliseHeight=function(t,n){var i=-1,o=Number.MAX_VALUE,r=[];t&&this.each(function(){e(this).height("auto")}),this.each(function(){var t=e(this).height();r.push(t),i=i>t?i:t,o=t>o?o:t});var s=i;if(n){r.sort(function(e,t){return e-t});var a=Math.floor(r.length/2);s=r.length%2?r[a]:(r[a-1]+r[a])/2}return this.each(function(){e(this).height(s)}),this},e.fn.getVisibleElementWithGreatestTabIndex=function(){var t=e(this),n=0,i=null;return t.find("*:visible[tabindex]").each(function(t,o){var r=e(o),s=parseInt(r.attr("tabindex"));s>n&&(n=s,i=r)}),i},e.fn.horizontalMargins=function(){var t=e(this);return parseInt(t.css("marginLeft"))+parseInt(t.css("marginRight"))},e.fn.leftMargin=function(){var t=e(this);return parseInt(t.css("marginLeft"))},e.fn.rightMargin=function(){var t=e(this);return parseInt(t.css("marginRight"))},e.fn.horizontalPadding=function(){var t=e(this);return parseInt(t.css("paddingLeft"))+parseInt(t.css("paddingRight"))},e.fn.leftPadding=function(){var t=e(this);return parseInt(t.css("paddingLeft"))},e.fn.rightPadding=function(){var t=e(this);return parseInt(t.css("paddingRight"))},e.mlp={x:0,y:0},e(t),e.fn.ismouseover=function(){var t=!1;return this.eq(0).each(function(){var n=e(this).is("iframe")?e(this).contents().find("body"):e(this),i=n.offset();t=i.left<=e.mlp.x&&i.left+n.outerWidth()>e.mlp.x&&i.top<=e.mlp.y&&i.top+n.outerHeight()>e.mlp.y}),t};var n,i=e.fn.on;e.fn.on=function(){var e=Array.apply(null,arguments),t=e[e.length-1];if(isNaN(t)||1===t&&e.pop())return i.apply(this,e);var o=e.pop(),r=e.pop();return e.push(function(){var e=this,t=arguments;clearTimeout(n),n=setTimeout(function(){r.apply(e,t)},o)}),i.apply(this,e)},e.fn.onEnter=function(t){return this.each(function(){var n=e(this);n.on("keyup",function(e){13===e.keyCode&&(e.preventDefault(),t())})})},e.fn.onPressed=function(t){return this.each(function(){var n=e(this);n.on("touchstart click",function(e){e.preventDefault(),t(e)}),n.on("keyup",function(e){13===e.keyCode&&(e.preventDefault(),t(e))})})},e.fn.removeLastWord=function(t,n){return void 0===t&&(t=8),void 0===n&&(n=0),this.each(function(){var i=e(this);if(i.contents().length>0){var o=i.contents().last();if(3===o[0].nodeType){var r=o.text().trim().split(" ");if(r.length>1)return r.splice(r.length-1,1),void(o[0].data=r.join(" "));if("undefined"!=typeof t&&1===r.length&&r[0].length>t)return void(o[0].data=r.join(" ").substring(0,t))}o.removeLastWord(t,n+1)}else n>0&&i.remove()})},e.fn.switchClass=function(t,n){return this.each(function(){e(this).removeClass(t).addClass(n)})},e.fn.targetBlank=function(){return this.each(function(){e(this).find("a").prop("target","_blank")})},e.fn.toggleExpandText=function(t,n,i,o){return this.each(function(){var r=e(this),s=r.html();if(!(t>s.length)){var a=!1,u=s.substr(0,t);u=u.substr(0,Math.min(u.length,u.lastIndexOf(" "))),r.toggle=function(){r.empty();var t=e('<a href="#" class="toggle"></a>');a?(r.html(s+"&nbsp;"),t.text(n),t.switchClass("less","more")):(r.html(u+"&nbsp;"),t.text(i),t.switchClass("more","less")),t.one("click",function(e){e.preventDefault(),r.toggle()}),a=!a,r.append(t),o&&o()},r.toggle()}})},e.fn.toggleExpandTextByLines=function(t,n,i,o){return this.each(function(){for(var r=e(this),s=r.html(),a=e('<span>&hellip; <a href="#" class="toggle more">morepad</a></span>'),u=[s],l=r.height();r.text().length>0;){r.removeLastWord();var c=r.html();r.append(a),l>r.height()&&(u.unshift(c),l=r.height()),a.remove()}if(u.length<=t)return void r.html(s);var h=u[t-1],p=!1;r.toggle=function(){r.empty();var t=e('<a href="#" class="toggle"></a>');p?(r.html(s+" "),t.text(n),t.switchClass("less","more")):(r.html(h+"&hellip; "),t.text(i),t.switchClass("more","less")),t.one("click",function(e){e.preventDefault(),r.toggle()}),p=!p,r.append(t),o&&o()},r.toggle()})},e.fn.toggleText=function(t,n){return this.each(function(){var i=e(this);i.text()===t?e(this).text(n):e(this).text(t)})},e.fn.updateAttr=function(t,n,i){return this.each(function(){var o=e(this),r=o.attr(t);r&&0===r.indexOf(n)&&(r=r.replace(n,i),o.attr(t,r))})},e.fn.verticalMargins=function(){var t=e(this);return parseInt(t.css("marginTop"))+parseInt(t.css("marginBottom"))},e.fn.verticalPadding=function(){var t=e(this);return parseInt(t.css("paddingTop"))+parseInt(t.css("paddingBottom"))}}(jQuery),define("lib/jquery-plugins.js",function(){}),function(e){var t=null;e.initPubSub=function(){t=e({})},e.subscribe=function(){t||e.initPubSub(),t.on.apply(t,arguments)},e.unsubscribe=function(){t||e.initPubSub(),t.off.apply(t,arguments)},e.disposePubSub=function(){t=null},e.publish=function(){t||e.initPubSub(),t.trigger.apply(t,arguments);
}}(jQuery),define("lib/ba-tiny-pubsub.js",function(){}),!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("manifesto",[],t):"object"==typeof exports?exports.manifesto=t():e.manifesto=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:i})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(t.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)t.d(i,o,function(t){return e[t]}.bind(null,o));return i},t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=7)}([function(e,t,n){"use strict";function i(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),i(n(9)),i(n(10)),i(n(11)),i(n(12)),i(n(13)),i(n(14)),i(n(15)),i(n(16)),i(n(17)),i(n(31)),i(n(32)),i(n(33)),i(n(34)),i(n(35)),i(n(38)),i(n(39)),i(n(40)),i(n(41)),i(n(42)),i(n(43)),i(n(44)),i(n(45)),i(n(46)),i(n(47)),i(n(48)),i(n(49)),i(n(50)),i(n(3))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.BOOKMARKING="oa:bookmarking",e.CLASSIFYING="oa:classifying",e.COMMENTING="oa:commenting",e.DESCRIBING="oa:describing",e.EDITING="oa:editing",e.HIGHLIGHTING="oa:highlighting",e.IDENTIFYING="oa:identifying",e.LINKING="oa:linking",e.MODERATING="oa:moderating",e.PAINTING="sc:painting",e.QUESTIONING="oa:questioning",e.REPLYING="oa:replying",e.TAGGING="oa:tagging",e.TRANSCRIBING="oad:transcribing"}(t.AnnotationMotivation||(t.AnnotationMotivation={})),function(e){e.AUTO_ADVANCE="auto-advance",e.CONTINUOUS="continuous",e.FACING_PAGES="facing-pages",e.HIDDEN="hidden",e.INDIVIDUALS="individuals",e.MULTI_PART="multi-part",e.NO_NAV="no-nav",e.NON_PAGED="non-paged",e.PAGED="paged",e.REPEAT="repeat",e.SEQUENCE="sequence",e.THUMBNAIL_NAV="thumbnail-nav",e.TOGETHER="together",e.UNORDERED="unordered"}(t.Behavior||(t.Behavior={})),function(e){e.CANVAS="canvas",e.CHOICE="choice",e.OA_CHOICE="oa:choice",e.CONTENT_AS_TEXT="contentastext",e.DATASET="dataset",e.DOCUMENT="document",e.IMAGE="image",e.MODEL="model",e.MOVING_IMAGE="movingimage",e.PDF="pdf",e.PHYSICAL_OBJECT="physicalobject",e.SOUND="sound",e.TEXT="text",e.TEXTUALBODY="textualbody",e.VIDEO="video"}(t.ExternalResourceType||(t.ExternalResourceType={})),function(e){e.ANNOTATION="annotation",e.CANVAS="canvas",e.COLLECTION="collection",e.MANIFEST="manifest",e.RANGE="range",e.SEQUENCE="sequence"}(t.IIIFResourceType||(t.IIIFResourceType={})),function(e){e.AUDIO_MP4="audio/mp4",e.CORTO="application/corto",e.DICOM="application/dicom",e.DRACO="application/draco",e.EPUB="application/epub+zip",e.GLB="model/gltf-binary",e.GLTF="model/gltf+json",e.IIIF_PRESENTATION_2='application/ld+json;profile="http://iiif.io/api/presentation/2/context.json"',e.IIIF_PRESENTATION_3='application/ld+json;profile="http://iiif.io/api/presentation/3/context.json"',e.JPG="image/jpeg",e.M3U8="application/vnd.apple.mpegurl",e.MP3="audio/mp3",e.MPEG_DASH="application/dash+xml",e.OBJ="text/plain",e.OPF="application/oebps-package+xml",e.PDF="application/pdf",e.PLY="application/ply",e.THREEJS="application/vnd.threejs+json",e.USDZ="model/vnd.usd+zip",e.VIDEO_MP4="video/mp4",e.WEBM="video/webm"}(t.MediaType||(t.MediaType={})),function(e){e.DOC="application/msword",e.DOCX="application/vnd.openxmlformats-officedocument.wordprocessingml.document",e.PDF="application/pdf"}(t.RenderingFormat||(t.RenderingFormat={})),function(e){e.IMAGE_0_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0",e.IMAGE_0_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1",e.IMAGE_0_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2",e.IMAGE_0_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0",e.IMAGE_0_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1",e.IMAGE_0_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2",e.IMAGE_1_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",e.IMAGE_1_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",e.IMAGE_1_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",e.IMAGE_1_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",e.IMAGE_1_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",e.IMAGE_1_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",e.IMAGE_1_LEVEL_0="http://iiif.io/api/image/1/level0.json",e.IMAGE_1_PROFILE_LEVEL_0="http://iiif.io/api/image/1/profiles/level0.json",e.IMAGE_1_LEVEL_1="http://iiif.io/api/image/1/level1.json",e.IMAGE_1_PROFILE_LEVEL_1="http://iiif.io/api/image/1/profiles/level1.json",e.IMAGE_1_LEVEL_2="http://iiif.io/api/image/1/level2.json",e.IMAGE_1_PROFILE_LEVEL_2="http://iiif.io/api/image/1/profiles/level2.json",e.IMAGE_2_LEVEL_0="http://iiif.io/api/image/2/level0.json",e.IMAGE_2_PROFILE_LEVEL_0="http://iiif.io/api/image/2/profiles/level0.json",e.IMAGE_2_LEVEL_1="http://iiif.io/api/image/2/level1.json",e.IMAGE_2_PROFILE_LEVEL_1="http://iiif.io/api/image/2/profiles/level1.json",e.IMAGE_2_LEVEL_2="http://iiif.io/api/image/2/level2.json",e.IMAGE_2_PROFILE_LEVEL_2="http://iiif.io/api/image/2/profiles/level2.json",e.AUTH_0_CLICK_THROUGH="http://iiif.io/api/auth/0/login/clickthrough",e.AUTH_0_LOGIN="http://iiif.io/api/auth/0/login",e.AUTH_0_LOGOUT="http://iiif.io/api/auth/0/logout",e.AUTH_0_RESTRICTED="http://iiif.io/api/auth/0/login/restricted",e.AUTH_0_TOKEN="http://iiif.io/api/auth/0/token",e.AUTH_1_CLICK_THROUGH="http://iiif.io/api/auth/1/clickthrough",e.AUTH_1_EXTERNAL="http://iiif.io/api/auth/1/external",e.AUTH_1_KIOSK="http://iiif.io/api/auth/1/kiosk",e.AUTH_1_LOGIN="http://iiif.io/api/auth/1/login",e.AUTH_1_LOGOUT="http://iiif.io/api/auth/1/logout",e.AUTH_1_PROBE="http://iiif.io/api/auth/1/probe",e.AUTH_1_TOKEN="http://iiif.io/api/auth/1/token",e.SEARCH_0="http://iiif.io/api/search/0/search",e.SEARCH_0_AUTO_COMPLETE="http://iiif.io/api/search/0/autocomplete",e.SEARCH_1="http://iiif.io/api/search/1/search",e.SEARCH_1_AUTO_COMPLETE="http://iiif.io/api/search/1/autocomplete",e.TRACKING_EXTENSIONS="http://universalviewer.io/tracking-extensions-profile",e.UI_EXTENSIONS="http://universalviewer.io/ui-extensions-profile",e.PRINT_EXTENSIONS="http://universalviewer.io/print-extensions-profile",e.SHARE_EXTENSIONS="http://universalviewer.io/share-extensions-profile",e.OTHER_MANIFESTATIONS="http://iiif.io/api/otherManifestations.json",e.IXIF="http://wellcomelibrary.org/ld/ixif/0/alpha.json"}(t.ServiceProfile||(t.ServiceProfile={})),function(e){e.BOTTOM_TO_TOP="bottom-to-top",e.LEFT_TO_RIGHT="left-to-right",e.RIGHT_TO_LEFT="right-to-left",e.TOP_TO_BOTTOM="top-to-bottom"}(t.ViewingDirection||(t.ViewingDirection={})),function(e){e.CONTINUOUS="continuous",e.INDIVIDUALS="individuals",e.NON_PAGED="non-paged",e.PAGED="paged",e.TOP="top"}(t.ViewingHint||(t.ViewingHint={}))},function(e,t,n){var i=n(21).Symbol;e.exports=i},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{u(i.next(e))}catch(e){r(e)}}function a(e){try{u(i["throw"](e))}catch(e){r(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}u((i=i.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){function n(e){return function(n){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(r=2&e[0]?o["return"]:e[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,e[1])).done)return r;switch(o=0,r&&(e=[2&e[0],r.value]),e[0]){case 0:case 1:r=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!r||e[1]>r[0]&&e[1]<r[3])){a.label=e[1];break}if(6===e[0]&&a.label<r[1]){a.label=r[1],r=e;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(e);break}r[2]&&a.ops.pop(),a.trys.pop();continue}e=t.call(n,a)}catch(n){e=[6,n],o=0}finally{i=r=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,n])}}var i,o,r,s,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(1),a=n(36);n(37);var u=function(){function e(){}return e.getMediaType=function(e){return(e=(e=e.toLowerCase()).split(";")[0]).trim()},e.getImageQuality=function(e){return e===s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1||e===s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2||e===s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_1||e===s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2||e===s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1||e===s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2||e===s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1||e===s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2||e===s.ServiceProfile.IMAGE_1_LEVEL_1||e===s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1||e===s.ServiceProfile.IMAGE_1_LEVEL_2||e===s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2?"native":"default"},e.getInexactLocale=function(e){return-1!==e.indexOf("-")?e.substr(0,e.indexOf("-")):e},e.getLocalisedValue=function(e,t){if(!Array.isArray(e))return e;for(var n=0;n<e.length;n++){var i=e[n];if(t===i["@language"])return i["@value"]}var o=t.substr(0,t.indexOf("-"));for(n=0;n<e.length;n++){var r=e[n];if(r["@language"]===o)return r["@value"]}return null},e.generateTreeNodeIds=function(t,n){var i;void 0===n&&(n=0),i=t.parentNode?t.parentNode.id+"-"+n:"0",t.id=i;for(var o=0;o<t.nodes.length;o++){var r=t.nodes[o];e.generateTreeNodeIds(r,o)}},e.normaliseType=function(e){return-1!==(e=(e||"").toLowerCase()).indexOf(":")?e.split(":")[1]:e},e.normaliseUrl=function(e){return-1!==(e=e.substr(e.indexOf("://"))).indexOf("#")&&(e=e.split("#")[0]),e},e.normalisedUrlsMatch=function(t,n){return e.normaliseUrl(t)===e.normaliseUrl(n)},e.isImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_PROFILE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_PROFILE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_PROFILE_LEVEL_2))},e.isLevel0ImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_PROFILE_LEVEL_0))},e.isLevel1ImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_PROFILE_LEVEL_1))},e.isLevel2ImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_PROFILE_LEVEL_2))},e.parseManifest=function(e,t){return r.Deserialiser.parse(e,t)},e.checkStatus=function(e){if(e.ok)return e;var t=new Error(e.statusText);return t.response=e,Promise.reject(t)},e.loadManifest=function(t){return new Promise(function(n,i){fetch(t).then(e.checkStatus).then(function(e){return e.json()}).then(function(e){n(e)})["catch"](function(e){i()})})},e.loadExternalResourcesAuth1=function(t,n,i,o,r,s,a,u){return new Promise(function(l,c){var h=t.map(function(t){return e.loadExternalResourceAuth1(t,n,i,o,r,s,a,u)});Promise.all(h).then(function(){l(t)})["catch"](function(e){c(e)})})},e.loadExternalResourceAuth1=function(t,n,r,s,u,l,c,h){return i(this,void 0,void 0,function(){var i;return o(this,function(o){switch(o.label){case 0:return[4,s(t)];case 1:return(i=o.sent())?[4,t.getData(i)]:[3,6];case 2:return o.sent(),t.status!==a.OK?[3,3]:[2,t];case 3:return[4,e.doAuthChain(t,n,r,u,l,c,h)];case 4:o.sent(),o.label=5;case 5:if(t.status===a.OK||t.status===a.MOVED_TEMPORARILY)return[2,t];throw e.createAuthorizationFailedError();case 6:return[4,t.getData()];case 7:return o.sent(),t.status!==a.MOVED_TEMPORARILY&&t.status!==a.UNAUTHORIZED?[3,9]:[4,e.doAuthChain(t,n,r,u,l,c,h)];case 8:o.sent(),o.label=9;case 9:if(t.status===a.OK||t.status===a.MOVED_TEMPORARILY)return[2,t];throw e.createAuthorizationFailedError()}})})},e.doAuthChain=function(t,n,r,s,u,l,c){return i(this,void 0,void 0,function(){var i,h,p,d,f,g,v,_;return o(this,function(o){switch(o.label){case 0:return t.isAccessControlled()?((i=t.externalService)&&(i.options=t.options),(h=t.kioskService)&&(h.options=t.options),(p=t.clickThroughService)&&(p.options=t.options),(d=t.loginService)&&(d.options=t.options),t.isResponseHandled||t.status!==a.MOVED_TEMPORARILY?[3,2]:[4,l(t)]):[2,t];case 1:return o.sent(),[2,t];case 2:return f=null,g=null,(f=i)?(g=f,[4,e.attemptResourceWithToken(t,r,f)]):[3,4];case 3:return o.sent(),[2,t];case 4:return(f=h)?(g=f,(v=n(f))?[4,s(v)]:[3,7]):[3,7];case 5:return o.sent(),[4,e.attemptResourceWithToken(t,r,f)];case 6:return o.sent(),[2,t];case 7:return(f=p)?(g=f,[4,u(t,f)]):[3,11];case 8:return(_=o.sent())?[4,s(_)]:[3,11];case 9:return o.sent(),[4,e.attemptResourceWithToken(t,r,f)];case 10:return o.sent(),[2,t];case 11:return(f=d)?(g=f,[4,u(t,f)]):[3,15];case 12:return(_=o.sent())?[4,s(_)]:[3,15];case 13:return o.sent(),[4,e.attemptResourceWithToken(t,r,f)];case 14:return o.sent(),[2,t];case 15:return g&&c(t,g),[2]}})})},e.attemptResourceWithToken=function(e,t,n){return i(this,void 0,void 0,function(){var i,r;return o(this,function(o){switch(o.label){case 0:return(i=n.getService(s.ServiceProfile.AUTH_1_TOKEN))?[4,t(e,i)]:[3,3];case 1:return(r=o.sent())&&r.accessToken?[4,e.getData(r)]:[3,3];case 2:return o.sent(),[2,e];case 3:return[2]}})})},e.loadExternalResourcesAuth09=function(t,n,i,o,r,s,a,u,l,c){return new Promise(function(h,p){var d=t.map(function(t){return e.loadExternalResourceAuth09(t,n,i,o,r,s,a,u,l,c)});Promise.all(d).then(function(){h(t)})["catch"](function(e){p(e)})})},e.loadExternalResourceAuth09=function(t,n,i,o,r,s,u,l,c,h){return new Promise(function(p,d){h&&h.pessimisticAccessControl?t.getData().then(function(){t.isAccessControlled()?t.clickThroughService?(p(i(t)),p(o(t))):r(t).then(function(){s(t,!0).then(function(n){t.getData(n).then(function(){p(c(t))})["catch"](function(t){d(e.createInternalServerError(t))})})["catch"](function(t){d(e.createInternalServerError(t))})})["catch"](function(t){d(e.createInternalServerError(t))}):p(t)})["catch"](function(t){d(e.createInternalServerError(t))}):l(t,n).then(function(h){h?t.getData(h).then(function(){t.status===a.OK?p(c(t)):e.authorize(t,n,i,o,r,s,u,l).then(function(){p(c(t))})["catch"](function(t){d(e.createAuthorizationFailedError())})})["catch"](function(t){d(e.createAuthorizationFailedError())}):e.authorize(t,n,i,o,r,s,u,l).then(function(){p(c(t))})["catch"](function(t){d(e.createAuthorizationFailedError())})})["catch"](function(t){d(e.createAuthorizationFailedError())})})},e.createError=function(e,t){var n=new Error;return n.message=t,n.name=String(e),n},e.createAuthorizationFailedError=function(){return e.createError(r.StatusCode.AUTHORIZATION_FAILED,"Authorization failed")},e.createRestrictedError=function(){return e.createError(r.StatusCode.RESTRICTED,"Restricted")},e.createInternalServerError=function(t){return e.createError(r.StatusCode.INTERNAL_SERVER_ERROR,t)},e.authorize=function(t,n,i,o,r,s,u,l){return new Promise(function(c,h){t.getData().then(function(){t.isAccessControlled()?l(t,n).then(function(l){l?t.getData(l).then(function(){t.status===a.OK?c(t):e.showAuthInteraction(t,n,i,o,r,s,u,c,h)})["catch"](function(t){h(e.createInternalServerError(t))}):s(t,!1).then(function(l){l?u(t,l,n).then(function(){t.getData(l).then(function(){t.status===a.OK?c(t):e.showAuthInteraction(t,n,i,o,r,s,u,c,h)})["catch"](function(t){h(e.createInternalServerError(t))})})["catch"](function(t){h(e.createInternalServerError(t))}):e.showAuthInteraction(t,n,i,o,r,s,u,c,h)})})["catch"](function(t){h(e.createInternalServerError(t))}):c(t)})})},e.showAuthInteraction=function(t,n,i,o,r,s,u,l,c){t.status!==a.MOVED_TEMPORARILY||t.isResponseHandled?t.clickThroughService&&!t.isResponseHandled?i(t).then(function(){s(t,!0).then(function(i){u(t,i,n).then(function(){t.getData(i).then(function(){l(t)})["catch"](function(t){c(e.createInternalServerError(t))})})["catch"](function(t){c(e.createInternalServerError(t))})})["catch"](function(t){c(e.createInternalServerError(t))})}):r(t).then(function(){s(t,!0).then(function(i){u(t,i,n).then(function(){t.getData(i).then(function(){l(t)})["catch"](function(t){c(e.createInternalServerError(t))})})["catch"](function(t){c(e.createInternalServerError(t))})})["catch"](function(t){c(e.createInternalServerError(t))})}):l(t)},e.getService=function(e,t){for(var n=this.getServices(e),i=0;i<n.length;i++){var o=n[i];if(o.getProfile()===t)return o}return null},e.getResourceById=function(t,n){return e.traverseAndFind(t.__jsonld,"@id",n)},e.traverseAndFind=function(t,n,i){if(t.hasOwnProperty(n)&&t[n]===i)return t;for(var o=0;o<Object.keys(t).length;o++)if("object"==typeof t[Object.keys(t)[o]]){var r=e.traverseAndFind(t[Object.keys(t)[o]],n,i);if(null!=r)return r}},e.getServices=function(e){var t,n=[];if(!(t=e.__jsonld?e.__jsonld.service:e.service))return n;Array.isArray(t)||(t=[t]);for(var i=0;i<t.length;i++){var o=t[i];if("string"==typeof o){var s=this.getResourceById(e.options.resource,o);s&&n.push(new r.Service(s.__jsonld||s,e.options))}else n.push(new r.Service(o,e.options))}return n},e.getTemporalComponent=function(e){var t=/t=([^&]+)/g.exec(e),n=null;return t&&t[1]&&(n=t[1].split(",")),n},e}();t.Utils=u},function(e,t,n){var i=n(19),o=n(20);e.exports=function r(e,t,n,s,a){var u=-1,l=e.length;for(n||(n=o),a||(a=[]);++u<l;){var c=e[u];t>0&&n(c)?t>1?r(c,t-1,n,s,a):i(a,c):s||(a[a.length]=c)}return a}},function(e,t){e.exports=function(e){return null!=e&&"object"==typeof e}},function(e,t,n){"use strict";n.r(t),t["default"]=function(e,t){return t=t||{},new Promise(function(n,i){var o=new XMLHttpRequest,r=[],s=[],a={},u=function(){return{ok:2==(o.status/100|0),statusText:o.statusText,status:o.status,url:o.responseURL,text:function(){return Promise.resolve(o.responseText)},json:function(){return Promise.resolve(JSON.parse(o.responseText))},blob:function(){return Promise.resolve(new Blob([o.response]))},clone:u,headers:{keys:function(){return r},entries:function(){return s},get:function(e){return a[e.toLowerCase()]},has:function(e){return e.toLowerCase()in a}}}};for(var l in o.open(t.method||"get",e,!0),o.onload=function(){o.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(e,t,n){r.push(t=t.toLowerCase()),s.push([t,n]),a[t]=a[t]?a[t]+","+n:n}),n(u())},o.onerror=i,o.withCredentials="include"==t.credentials,t.headers)o.setRequestHeader(l,t.headers[l]);o.send(t.body||null)})}},function(e,t,n){e.exports=n(8)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(0));var i=n(3);t.loadManifest=function(e){return i.Utils.loadManifest(e)},t.parseManifest=function(e,t){return i.Utils.parseManifest(e,t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.__jsonld=e,this.context=this.getProperty("context"),this.id=this.getProperty("id")}return e.prototype.getProperty=function(e){var t=null;return this.__jsonld&&((t=this.__jsonld[e])||(t=this.__jsonld["@"+e])),t},e}();t.JSONLDResource=i},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(1),a=function(e){function t(t,n){var i=e.call(this,t)||this;return i.options=n,i}return o(t,e),t.prototype.getIIIFResourceType=function(){return r.Utils.normaliseType(this.getProperty("type"))},t.prototype.getLabel=function(){var e=this.getProperty("label");return e?r.PropertyValue.parse(e,this.options.locale):new r.PropertyValue([],this.options.locale)},t.prototype.getDefaultLabel=function(){return this.getLabel().getValue(this.options.locale)},t.prototype.getMetadata=function(){var e=this.getProperty("metadata"),t=[];if(!e)return t;for(var n=0;n<e.length;n++){var i=e[n],o=new r.LabelValuePair(this.options.locale);o.parse(i),t.push(o)}return t},t.prototype.getRendering=function(e){for(var t=this.getRenderings(),n=0;n<t.length;n++){var i=t[n];if(i.getFormat()===e)return i}return null},t.prototype.getRenderings=function(){var e,t=[];if(!(e=this.__jsonld?this.__jsonld.rendering:this.rendering))return t;Array.isArray(e)||(e=[e]);for(var n=0;n<e.length;n++){var i=e[n];t.push(new r.Rendering(i,this.options))}return t},t.prototype.getService=function(e){return r.Utils.getService(this,e)},t.prototype.getServices=function(){return r.Utils.getServices(this)},t.prototype.getThumbnail=function(){var e=this.getProperty("thumbnail");return Array.isArray(e)&&(e=e[0]),e?new r.Thumbnail(e,this.options):null},t.prototype.isAnnotation=function(){return this.getIIIFResourceType()===s.IIIFResourceType.ANNOTATION},t.prototype.isCanvas=function(){return this.getIIIFResourceType()===s.IIIFResourceType.CANVAS},t.prototype.isCollection=function(){return this.getIIIFResourceType()===s.IIIFResourceType.COLLECTION},t.prototype.isManifest=function(){return this.getIIIFResourceType()===s.IIIFResourceType.MANIFEST},t.prototype.isRange=function(){return this.getIIIFResourceType()===s.IIIFResourceType.RANGE},t.prototype.isSequence=function(){return this.getIIIFResourceType()===s.IIIFResourceType.SEQUENCE},t}(r.JSONLDResource);t.ManifestResource=a},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=function(e){function t(t,n){return e.call(this,t,n)||this}return o(t,e),t.prototype.getFormat=function(){var e=this.getProperty("format");return e?e.toLowerCase():null},t.prototype.getResources=function(){var e=[];if(!this.__jsonld.resources)return e;for(var t=0;t<this.__jsonld.resources.length;t++){var n=this.__jsonld.resources[t],i=new r.Annotation(n,this.options);e.push(i)}return e},t.prototype.getType=function(){var e=this.getProperty("type");return e?r.Utils.normaliseType(e):null},t.prototype.getWidth=function(){return this.getProperty("width")},t.prototype.getHeight=function(){return this.getProperty("height")},t.prototype.getMaxWidth=function(){return this.getProperty("maxWidth")},t.prototype.getMaxHeight=function(){return this.getProperty("maxHeight")?null:this.getMaxWidth()},t}(r.ManifestResource);t.Resource=s},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(1),a=function(e){function t(t,n){var i=e.call(this,t,n)||this;i.index=-1,i.isLoaded=!1;var o={defaultLabel:"-",locale:"en-GB",resource:i,pessimisticAccessControl:!1};return i.options=Object.assign(o,n),i}return o(t,e),t.prototype.getAttribution=function(){var e=this.getProperty("attribution");return e?r.PropertyValue.parse(e,this.options.locale):new r.PropertyValue([],this.options.locale)},t.prototype.getDescription=function(){var e=this.getProperty("description");return e?r.PropertyValue.parse(e,this.options.locale):new r.PropertyValue([],this.options.locale)},t.prototype.getHomepage=function(){var e=this.getProperty("homepage");return e?"string"==typeof e?e:(Array.isArray(e)&&e.length&&(e=e[0]),e["@id"]||e.id):null},t.prototype.getIIIFResourceType=function(){return r.Utils.normaliseType(this.getProperty("type"))},t.prototype.getLogo=function(){var e=this.getProperty("logo");return e?"string"==typeof e?e:(Array.isArray(e)&&e.length&&(e=e[0]),e["@id"]||e.id):null},t.prototype.getLicense=function(){return r.Utils.getLocalisedValue(this.getProperty("license"),this.options.locale)},t.prototype.getNavDate=function(){return new Date(this.getProperty("navDate"))},t.prototype.getRelated=function(){return this.getProperty("related")},t.prototype.getSeeAlso=function(){return this.getProperty("seeAlso")},t.prototype.getTrackingLabel=function(){var e=this.getService(s.ServiceProfile.TRACKING_EXTENSIONS);return e?e.getProperty("trackingLabel"):""},t.prototype.getDefaultTree=function(){return this.defaultTree=new r.TreeNode("root"),this.defaultTree.data=this,this.defaultTree},t.prototype.getRequiredStatement=function(){var e=null,t=this.getProperty("requiredStatement");if(t)(e=new r.LabelValuePair(this.options.locale)).parse(t);else{var n=this.getAttribution();n&&((e=new r.LabelValuePair(this.options.locale)).value=n)}return e},t.prototype.isCollection=function(){return this.getIIIFResourceType()===s.IIIFResourceType.COLLECTION},t.prototype.isManifest=function(){return this.getIIIFResourceType()===s.IIIFResourceType.MANIFEST},t.prototype.load=function(){var e=this;return new Promise(function(t){if(e.isLoaded)t(e);else{var n=e.options;n.navDate=e.getNavDate();var i=e.__jsonld.id;i||(i=e.__jsonld["@id"]),r.Utils.loadManifest(i).then(function(i){e.parentLabel=e.getLabel().getValue(n.locale);var o=r.Deserialiser.parse(i,n);(e=Object.assign(e,o)).index=n.index,t(e)})}})},t}(r.ManifestResource);t.IIIFResource=a},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=function(e){function t(t,n){return e.call(this,t,n)||this}return o(t,e),t.prototype.getBody=function(){var e=[],t=this.getProperty("body");if(t)if(Array.isArray(t))for(var n=0;n<t.length;n++)if((s=t[n]).items)for(var i=0;i<s.items.length;i++){var o=s.items[i];e.push(new r.AnnotationBody(o,this.options))}else e.push(new r.AnnotationBody(s,this.options));else if(t.items)for(n=0;n<t.items.length;n++){var s=t.items[n];e.push(new r.AnnotationBody(s,this.options))}else e.push(new r.AnnotationBody(t,this.options));return e},t.prototype.getMotivation=function(){var e=this.getProperty("motivation");return e||null},t.prototype.getOn=function(){return this.getProperty("on")},t.prototype.getTarget=function(){return this.getProperty("target")},t.prototype.getResource=function(){return new r.Resource(this.getProperty("resource"),this.options)},t}(r.ManifestResource);t.Annotation=s},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=function(e){function t(t,n){return e.call(this,t,n)||this}return o(t,e),t.prototype.getFormat=function(){var e=this.getProperty("format");return e?r.Utils.getMediaType(e):null},t.prototype.getType=function(){return this.getProperty("type")?r.Utils.normaliseType(this.getProperty("type")):null},t.prototype.getWidth=function(){return this.getProperty("width")},t.prototype.getHeight=function(){return this.getProperty("height")},t}(r.ManifestResource);t.AnnotationBody=s},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=function(e){function t(t,n,i){var o=e.call(this,n)||this;return o.label=t,o.options=i,o}return o(t,e),t.prototype.getIIIFResourceType=function(){return r.Utils.normaliseType(this.getProperty("type"));
},t.prototype.getLabel=function(){return this.label},t.prototype.getResources=function(){var e=this;return this.getProperty("resources").map(function(t){return new r.Annotation(t,e.options)})},t.prototype.load=function(){var e=this;return new Promise(function(t,n){if(e.isLoaded)t(e);else{var i=e.__jsonld.id;i||(i=e.__jsonld["@id"]),r.Utils.loadManifest(i).then(function(n){e.__jsonld=n,e.context=e.getProperty("context"),e.id=e.getProperty("id"),e.isLoaded=!0,t(e)})["catch"](n)}})},t}(r.JSONLDResource);t.AnnotationList=s},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(t,n){return e.call(this,t,n)||this}return o(t,e),t.prototype.getItems=function(){return this.getProperty("items")},t}(n(0).ManifestResource);t.AnnotationPage=r},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),s=n(0),a=n(18),u=n(30),l=function(e){function t(t,n){return e.call(this,t,n)||this}return o(t,e),t.prototype.getCanonicalImageUri=function(e){var t,n=null,i="default",o=e;if(this.externalResource&&this.externalResource.data&&this.externalResource.data["@id"])n=this.externalResource.data["@id"],o||(o=this.externalResource.data.width),this.externalResource.data["@context"]&&(this.externalResource.data["@context"].indexOf("/1.0/context.json")>-1||this.externalResource.data["@context"].indexOf("/1.1/context.json")>-1||this.externalResource.data["@context"].indexOf("/1/context.json")>-1)&&(i="native");else{var r=this.getImages();if(r&&r.length){var a=r[0].getResource(),u=a.getServices();if(o||(o=a.getWidth()),u.length){var l=u[0];n=l.id,i=s.Utils.getImageQuality(l.getProfile())}else if(o===a.getWidth())return a.id}if(!n){var c=this.getProperty("thumbnail");if(c){if("string"==typeof c)return c;if(c["@id"])return c["@id"];if(c.length)return c[0].id}}}return t=o+",",n&&n.endsWith("/")&&(n=n.substr(0,n.length-1)),[n,"full",t,0,i+".jpg"].join("/")},t.prototype.getMaxDimensions=function(){var e,t=null;return this.externalResource&&this.externalResource.data&&this.externalResource.data.profile&&(e=this.externalResource.data.profile,Array.isArray(e)&&(e=e.filter(function(e){return e.maxWidth})[0])&&(t=new s.Size(e.maxWidth,e.maxHeight?e.maxHeight:e.maxWidth))),t},t.prototype.getContent=function(){var e=[],t=this.__jsonld.items||this.__jsonld.content;if(!t)return e;var n=null;if(t.length&&(n=new s.AnnotationPage(t[0],this.options)),!n)return e;for(var i=n.getItems(),o=0;o<i.length;o++){var r=i[o],a=new s.Annotation(r,this.options);e.push(a)}return e},t.prototype.getDuration=function(){return this.getProperty("duration")},t.prototype.getImages=function(){var e=[];if(!this.__jsonld.images)return e;for(var t=0;t<this.__jsonld.images.length;t++){var n=this.__jsonld.images[t],i=new s.Annotation(n,this.options);e.push(i)}return e},t.prototype.getIndex=function(){return this.getProperty("index")},t.prototype.getOtherContent=function(){var e=this,t=Array.isArray(this.getProperty("otherContent"))?this.getProperty("otherContent"):[this.getProperty("otherContent")],n=t.filter(function(e){return e&&(t=e["@type"],n="sc:AnnotationList","string"==typeof t&&"string"==typeof n&&t.toLowerCase()==t.toLowerCase());var t,n}).map(function(t,n){return new s.AnnotationList(t.label||"Annotation list "+n,t,e.options)}).map(function(e){return e.load()});return Promise.all(n)},t.prototype.getWidth=function(){return this.getProperty("width")},t.prototype.getHeight=function(){return this.getProperty("height")},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},Object.defineProperty(t.prototype,"imageResources",{get:function(){var e=this,n=u["default"]([this.getImages().map(function(e){return e.getResource()}),this.getContent().map(function(e){return e.getBody()})]);return a["default"](n.map(function(n){switch(n.getProperty("type").toLowerCase()){case r.ExternalResourceType.CHOICE:case r.ExternalResourceType.OA_CHOICE:return new t({images:a["default"]([n.getProperty("default"),n.getProperty("item")]).map(function(e){return{resource:e}})},e.options).getImages().map(function(e){return e.getResource()});default:return n}}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resourceAnnotations",{get:function(){return u["default"]([this.getImages(),this.getContent()])},enumerable:!0,configurable:!0}),t.prototype.resourceAnnotation=function(e){return this.resourceAnnotations.find(function(t){return t.getResource().id===e||a["default"](new Array(t.getBody())).some(function(t){return t.id===e})})},t.prototype.onFragment=function(e){var t=this.resourceAnnotation(e);if(t){var n=t.getProperty("on"),i=t.getProperty("target"),o=(n||i).match(/xywh=(.*)$/);if(o)return o[1].split(",").map(function(e){return parseInt(e,10)})}},Object.defineProperty(t.prototype,"iiifImageResources",{get:function(){return this.imageResources.filter(function(e){return e&&e.getServices()[0]&&e.getServices()[0].id})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageServiceIds",{get:function(){return this.iiifImageResources.map(function(e){return e.getServices()[0].id})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"aspectRatio",{get:function(){return this.getWidth()/this.getHeight()},enumerable:!0,configurable:!0}),t}(s.Resource);t.Canvas=l},function(e,t,n){var i=n(4);e.exports=function(e){return(null==e?0:e.length)?i(e,1):[]}},function(e,t){e.exports=function(e,t){for(var n=-1,i=t.length,o=e.length;++n<i;)e[o+n]=t[n];return e}},function(e,t,n){var i=n(2),o=n(24),r=n(29),s=i?i.isConcatSpreadable:void 0;e.exports=function(e){return r(e)||o(e)||!!(s&&e&&e[s])}},function(e,t,n){var i=n(22),o="object"==typeof self&&self&&self.Object===Object&&self,r=i||o||Function("return this")();e.exports=r},function(e,t,n){(function(t){var n="object"==typeof t&&t&&t.Object===Object&&t;e.exports=n}).call(this,n(23))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var i=n(25),o=n(5),r=Object.prototype,s=r.hasOwnProperty,a=r.propertyIsEnumerable,u=i(function(){return arguments}())?i:function(e){return o(e)&&s.call(e,"callee")&&!a.call(e,"callee")};e.exports=u},function(e,t,n){var i=n(26),o=n(5),r="[object Arguments]";e.exports=function(e){return o(e)&&i(e)==r}},function(e,t,n){var i=n(2),o=n(27),r=n(28),s="[object Null]",a="[object Undefined]",u=i?i.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?a:s:u&&u in Object(e)?o(e):r(e)}},function(e,t,n){var i=n(2),o=Object.prototype,r=o.hasOwnProperty,s=o.toString,a=i?i.toStringTag:void 0;e.exports=function(e){var t=r.call(e,a),n=e[a];try{e[a]=void 0;var i=!0}catch(e){}var o=s.call(e);return i&&(t?e[a]=n:delete e[a]),o}},function(e,t){var n=Object.prototype.toString;e.exports=function(e){return n.call(e)}},function(e,t){var n=Array.isArray;e.exports=n},function(e,t,n){var i=n(4),o=1/0;e.exports=function(e){return(null==e?0:e.length)?i(e,o):[]}},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),s=n(0),a=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.items=[],i._collections=null,i._manifests=null,t.__collection=i,i}return o(t,e),t.prototype.getCollections=function(){return this._collections?this._collections:this._collections=this.items.filter(function(e){return e.isCollection()})},t.prototype.getManifests=function(){return this._manifests?this._manifests:this._manifests=this.items.filter(function(e){return e.isManifest()})},t.prototype.getCollectionByIndex=function(e){for(var t,n=this.getCollections(),i=0;i<n.length;i++){var o=n[i];o.index===e&&(t=o)}if(t)return t.options.index=e,t.load();throw new Error("Collection index not found")},t.prototype.getManifestByIndex=function(e){for(var t,n=this.getManifests(),i=0;i<n.length;i++){var o=n[i];o.index===e&&(t=o)}if(t)return t.options.index=e,t.load();throw new Error("Manifest index not found")},t.prototype.getTotalCollections=function(){return this.getCollections().length},t.prototype.getTotalManifests=function(){return this.getManifests().length},t.prototype.getTotalItems=function(){return this.items.length},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?this.getProperty("viewingDirection"):r.ViewingDirection.LEFT_TO_RIGHT},t.prototype.getBehavior=function(){var e=this.getProperty("behavior");return Array.isArray(e)&&(e=e[0]),e||null},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t.prototype.getDefaultTree=function(){return e.prototype.getDefaultTree.call(this),this.defaultTree.data.type=s.Utils.normaliseType(s.TreeNodeType.COLLECTION),this._parseManifests(this),this._parseCollections(this),s.Utils.generateTreeNodeIds(this.defaultTree),this.defaultTree},t.prototype._parseManifests=function(e){if(e.getManifests()&&e.getManifests().length)for(var t=0;t<e.getManifests().length;t++){var n=e.getManifests()[t],i=n.getDefaultTree();i.label=n.parentLabel||n.getLabel().getValue(this.options.locale)||"manifest "+(t+1),i.navDate=n.getNavDate(),i.data.id=n.id,i.data.type=s.Utils.normaliseType(s.TreeNodeType.MANIFEST),e.defaultTree.addNode(i)}},t.prototype._parseCollections=function(e){if(e.getCollections()&&e.getCollections().length)for(var t=0;t<e.getCollections().length;t++){var n=e.getCollections()[t],i=n.getDefaultTree();i.label=n.parentLabel||n.getLabel().getValue(this.options.locale)||"collection "+(t+1),i.navDate=n.getNavDate(),i.data.id=n.id,i.data.type=s.Utils.normaliseType(s.TreeNodeType.COLLECTION),e.defaultTree.addNode(i)}},t}(s.IIIFResource);t.Collection=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.start=e,this.end=t}return e.prototype.getLength=function(){return this.end-this.start},e}();t.Duration=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=function(){function e(e){this.defaultLocale=e}return e.prototype.parse=function(e){this.resource=e,this.label=i.PropertyValue.parse(this.resource.label,this.defaultLocale),this.value=i.PropertyValue.parse(this.resource.value,this.defaultLocale)},e.prototype.getLabel=function(e){return null===this.label?null:(Array.isArray(e)&&!e.length&&(e=void 0),this.label.getValue(e||this.defaultLocale))},e.prototype.setLabel=function(e){null===this.label&&(this.label=new i.PropertyValue([])),this.label.setValue(e,this.defaultLocale)},e.prototype.getValue=function(e,t){return void 0===t&&(t="<br/>"),null===this.value?null:(Array.isArray(e)&&!e.length&&(e=void 0),this.value.getValue(e||this.defaultLocale,t))},e.prototype.getValues=function(e){return null===this.value?[]:(Array.isArray(e)&&!e.length&&(e=void 0),this.value.getValues(e||this.defaultLocale))},e.prototype.setValue=function(e){null===this.value&&(this.value=new i.PropertyValue([])),this.value.setValue(e,this.defaultLocale)},e}();t.LabelValuePair=o},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.getValue=function(e,t){return e.getValue(t,"<br/>")},t.getValues=function(e,t){return e.getValues(t)},t}(Array);t.LanguageMap=r},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),r=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;n>t;t++)e+=arguments[t].length;var i=Array(e),o=0;for(t=0;n>t;t++)for(var r=arguments[t],s=0,a=r.length;a>s;s++,o++)i[o]=r[s];return i};Object.defineProperty(t,"__esModule",{value:!0});var s=n(3),a=function(){function e(e,t,n){void 0===n&&(n="none"),Array.isArray(e)&&1===e.length?this._value=e[0]:this._value=e,"none"!==t&&"@none"!==t||(t=void 0),this._locale=t,this._defaultLocale=n}return e.parseV2Value=function(t,n){return"string"==typeof t?new e(t,void 0,n):t["@value"]?new e(t["@value"],t["@language"],n):null},Object.defineProperty(e.prototype,"value",{get:function(){return Array.isArray(this._value)?this._value.join("<br/>"):this._value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"locale",{get:function(){return void 0===this._locale?this._defaultLocale:this._locale},enumerable:!0,configurable:!0}),e.prototype.addValue=function(e){Array.isArray(this._value)||(this._value=[this._value]),Array.isArray(e)?this._value=this._value.concat(e):this._value.push(e)},e}();t.LocalizedValue=a;var u=function(e){function t(n,i){void 0===n&&(n=[]);var o=e.apply(this,n)||this;return o.__proto__=t.prototype,o._defaultLocale=i,o}return o(t,e),t.parse=function(e,n){if(!e)return new t([],n);if(Array.isArray(e)){var i=(o=e.map(function(e){return a.parseV2Value(e,n)}).filter(function(e){return null!==e})).reduce(function(e,t){var n=t._locale;return n||(n="none"),e[n]?e[n].addValue(t._value):e[n]=t,e},{});return new t(Object.values(i),n)}return"string"==typeof e?new t([new a(e,void 0,n)],n):e["@language"]?new t(null!==(o=a.parseV2Value(e))?[o]:[],n):new t(Object.keys(e).map(function(t){var i=e[t];if(!Array.isArray(i))throw new Error("A IIIF v3 localized property value must have an array as the value for a given language.");return new a(i,t,n)}),n);var o},t.prototype.getSuitableLocale=function(e){for(var t=r(this).map(function(e){return e._locale}).filter(function(e){return void 0!==e}),n=function(e){var n=t.find(function(t){return t===e});return n?{value:n}:void 0},i=0,o=e;i<o.length;i++){var a=n(o[i]);if("object"==typeof a)return a.value}for(var u=function(e){var n=t.find(function(t){return s.Utils.getInexactLocale(t)===s.Utils.getInexactLocale(e)});return n?{value:n}:void 0},l=0,c=e;l<c.length;l++){var h=u(c[l]);if("object"==typeof h)return h.value}},t.prototype.setValue=function(e,t){var n=void 0;if(t){var i=this.getSuitableLocale([t]);i&&(n=this.find(function(e){return e._locale===i}))}else n=this.find(function(e){return void 0===e._locale});n?n._value=e:this.push(new a(e,t,this._defaultLocale))},t.prototype.getValue=function(e,t){var n=this.getValues(e);return 0===n.length?null:t?n.join(t):n[0]},t.prototype.getValues=function(e){if(!this.length)return[];var t;if(t=e?Array.isArray(e)?e:[e]:[],1===this.length&&void 0===this[0]._locale){var n=this[0]._value;return Array.isArray(n)?n:[n]}var i=this.getSuitableLocale(t);if(i)return n=this.find(function(e){return e._locale===i})._value,Array.isArray(n)?n:[n];if(!this.find(function(e){return void 0===e._locale}))return n=this[0]._value,Array.isArray(n)?n:[n];var o=this.find(function(e){return void 0===e._locale});return o?Array.isArray(o._value)?o._value:[o._value]:[]},t}(Array);t.PropertyValue=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONTINUE=100,t.SWITCHING_PROTOCOLS=101,t.PROCESSING=102,t.OK=200,t.CREATED=201,t.ACCEPTED=202,t.NON_AUTHORITATIVE_INFORMATION=203,t.NO_CONTENT=204,t.RESET_CONTENT=205,t.PARTIAL_CONTENT=206,t.MULTI_STATUS=207,t.MULTIPLE_CHOICES=300,t.MOVED_PERMANENTLY=301,t.MOVED_TEMPORARILY=302,t.SEE_OTHER=303,t.NOT_MODIFIED=304,t.USE_PROXY=305,t.TEMPORARY_REDIRECT=307,t.BAD_REQUEST=400,t.UNAUTHORIZED=401,t.PAYMENT_REQUIRED=402,t.FORBIDDEN=403,t.NOT_FOUND=404,t.METHOD_NOT_ALLOWED=405,t.NOT_ACCEPTABLE=406,t.PROXY_AUTHENTICATION_REQUIRED=407,t.REQUEST_TIME_OUT=408,t.CONFLICT=409,t.GONE=410,t.LENGTH_REQUIRED=411,t.PRECONDITION_FAILED=412,t.REQUEST_ENTITY_TOO_LARGE=413,t.REQUEST_URI_TOO_LARGE=414,t.UNSUPPORTED_MEDIA_TYPE=415,t.REQUESTED_RANGE_NOT_SATISFIABLE=416,t.EXPECTATION_FAILED=417,t.IM_A_TEAPOT=418,t.UNPROCESSABLE_ENTITY=422,t.LOCKED=423,t.FAILED_DEPENDENCY=424,t.UNORDERED_COLLECTION=425,t.UPGRADE_REQUIRED=426,t.PRECONDITION_REQUIRED=428,t.TOO_MANY_REQUESTS=429,t.REQUEST_HEADER_FIELDS_TOO_LARGE=431,t.INTERNAL_SERVER_ERROR=500,t.NOT_IMPLEMENTED=501,t.BAD_GATEWAY=502,t.SERVICE_UNAVAILABLE=503,t.GATEWAY_TIME_OUT=504,t.HTTP_VERSION_NOT_SUPPORTED=505,t.VARIANT_ALSO_NEGOTIATES=506,t.INSUFFICIENT_STORAGE=507,t.BANDWIDTH_LIMIT_EXCEEDED=509,t.NOT_EXTENDED=510,t.NETWORK_AUTHENTICATION_REQUIRED=511},function(e,t,n){e.exports=window.fetch||(window.fetch=n(6)["default"]||n(6))},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),s=n(0),a=function(e){function t(t,n){var i=e.call(this,t,n)||this;if(i.index=0,i._allRanges=null,i.items=[],i._topRanges=[],i.__jsonld.structures&&i.__jsonld.structures.length)for(var o=i._getTopRanges(),r=0;r<o.length;r++){var s=o[r];i._parseRanges(s,String(r))}return i}return o(t,e),t.prototype.getPosterCanvas=function(){var e=this.getProperty("posterCanvas");return e&&(e=new s.Canvas(e,this.options)),e},t.prototype.getAccompanyingCanvas=function(){var e=this.getProperty("accompanyingCanvas");return e&&(e=new s.Canvas(e,this.options)),e},t.prototype.getBehavior=function(){var e=this.getProperty("behavior");return Array.isArray(e)&&(e=e[0]),e||null},t.prototype.getDefaultTree=function(){if(e.prototype.getDefaultTree.call(this),this.defaultTree.data.type=s.Utils.normaliseType(s.TreeNodeType.MANIFEST),!this.isLoaded)return this.defaultTree;var t=this.getTopRanges();return t.length&&t[0].getTree(this.defaultTree),s.Utils.generateTreeNodeIds(this.defaultTree),this.defaultTree},t.prototype._getTopRanges=function(){var e=[];if(this.__jsonld.structures&&this.__jsonld.structures.length){for(var t=0;t<this.__jsonld.structures.length;t++){var n=this.__jsonld.structures[t];n.viewingHint===r.ViewingHint.TOP&&e.push(n)}if(!e.length){var i={};i.ranges=this.__jsonld.structures,e.push(i)}}return e},t.prototype.getTopRanges=function(){return this._topRanges},t.prototype._getRangeById=function(e){if(this.__jsonld.structures&&this.__jsonld.structures.length)for(var t=0;t<this.__jsonld.structures.length;t++){var n=this.__jsonld.structures[t];if(n["@id"]===e||n.id===e)return n}return null},t.prototype._parseRanges=function(e,t,n){var i,o=null;if("string"==typeof e&&(o=e,e=this._getRangeById(o)),e){(i=new s.Range(e,this.options)).parentRange=n,i.path=t,n?n.items.push(i):this._topRanges.push(i);var r=e.items||e.members;if(r)for(var a=0;a<r.length;a++){var u=r[a];if(u["@type"]&&"sc:range"===u["@type"].toLowerCase()||u.type&&"range"===u.type.toLowerCase())this._parseRanges(u,t+"/"+a,i);else if(u["@type"]&&"sc:canvas"===u["@type"].toLowerCase()||u.type&&"canvas"===u.type.toLowerCase()){i.canvases||(i.canvases=[]);var l=u.id||u["@id"];i.canvases.push(l)}}else if(e.ranges)for(a=0;a<e.ranges.length;a++)this._parseRanges(e.ranges[a],t+"/"+a,i)}else console.warn("Range:",o,"does not exist")},t.prototype.getAllRanges=function(){if(null!=this._allRanges)return this._allRanges;this._allRanges=[];for(var e=this.getTopRanges(),t=function(t){var i=e[t];i.id&&n._allRanges.push(i);var o=function(e,t){e.add(t);var n=t.getRanges();return n.length?n.reduce(o,e):e},r=Array.from(i.getRanges().reduce(o,new Set));n._allRanges=n._allRanges.concat(r)},n=this,i=0;i<e.length;i++)t(i);return this._allRanges},t.prototype.getRangeById=function(e){for(var t=this.getAllRanges(),n=0;n<t.length;n++){var i=t[n];if(i.id===e)return i}return null},t.prototype.getRangeByPath=function(e){for(var t=this.getAllRanges(),n=0;n<t.length;n++){var i=t[n];if(i.path===e)return i}return null},t.prototype.getSequences=function(){if(this.items.length)return this.items;var e=this.__jsonld.mediaSequences||this.__jsonld.sequences;if(e)for(var t=0;t<e.length;t++){var n=e[t],i=new s.Sequence(n,this.options);this.items.push(i)}else this.__jsonld.items&&(i=new s.Sequence(this.__jsonld.items,this.options),this.items.push(i));return this.items},t.prototype.getSequenceByIndex=function(e){return this.getSequences()[e]},t.prototype.getTotalSequences=function(){return this.getSequences().length},t.prototype.getManifestType=function(){var e=this.getService(r.ServiceProfile.UI_EXTENSIONS);return e?e.getProperty("manifestType"):s.ManifestType.EMPTY},t.prototype.isMultiSequence=function(){return this.getTotalSequences()>1},t.prototype.isPagingEnabled=function(){var e=this.getViewingHint();if(e)return e===r.ViewingHint.PAGED;var t=this.getBehavior();return!!t&&t===r.Behavior.PAGED},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t}(s.IIIFResource);t.Manifest=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.EMPTY="",e.MANUSCRIPT="manuscript",e.MONOGRAPH="monograph"}(t.ManifestType||(t.ManifestType={}))},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(1),a=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i._ranges=null,i.canvases=null,i.items=[],i}return o(t,e),t.prototype.getCanvasIds=function(){return this.__jsonld.canvases?this.__jsonld.canvases:this.canvases?this.canvases:[]},t.prototype.getDuration=function(){if(this.canvases&&this.canvases.length){for(var e=[],t=[],n=0,i=this.canvases;n<i.length;n++)if(f=i[n]){var o=f.match(/(.*)#t=([0-9.]+),?([0-9.]+)?/)||[void 0,f],s=o[1],a=o[2],u=o[3];s&&(e.push(parseFloat(a)),t.push(parseFloat(u)))}if(e.length&&t.length)return new r.Duration(Math.min.apply(Math,e),Math.max.apply(Math,t))}else{e=[],t=[];for(var l=0,c=v=this.getRanges();l<c.length;l++)(_=c[l].getDuration())&&(e.push(_.start),t.push(_.end));if(e.length&&t.length)return new r.Duration(Math.min.apply(Math,e),Math.max.apply(Math,t))}var h,p;if(this.canvases&&this.canvases.length)for(var d=0;d<this.canvases.length;d++){var f=this.canvases[d],g=r.Utils.getTemporalComponent(f);g&&g.length>1&&(0===d&&(h=Number(g[0])),d===this.canvases.length-1&&(p=Number(g[1])))}else{var v=this.getRanges();for(d=0;d<v.length;d++){var _;(_=v[d].getDuration())&&(0===d&&(h=_.start),d===v.length-1&&(p=_.end))}}return void 0!==h&&void 0!==p?new r.Duration(h,p):void 0},t.prototype.getRanges=function(){return this._ranges?this._ranges:this._ranges=this.items.filter(function(e){return e.isRange()})},t.prototype.getBehavior=function(){var e=this.getProperty("behavior");return Array.isArray(e)&&(e=e[0]),e||null},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t.prototype.getTree=function(e){e.data=this,this.treeNode=e;var t=this.getRanges();if(t&&t.length)for(var n=0;n<t.length;n++){var i=t[n],o=new r.TreeNode;e.addNode(o),this._parseTreeNode(o,i)}return r.Utils.generateTreeNodeIds(e),e},t.prototype.spansTime=function(e){var t=this.getDuration();return!!(t&&e>=t.start&&e<=t.end)},t.prototype._parseTreeNode=function(e,t){e.label=t.getLabel().getValue(this.options.locale),e.data=t,e.data.type=r.Utils.normaliseType(r.TreeNodeType.RANGE),t.treeNode=e;var n=t.getRanges();if(n&&n.length)for(var i=0;i<n.length;i++){var o=n[i];if(o.getBehavior()!==s.Behavior.NO_NAV){var a=new r.TreeNode;e.addNode(a),this._parseTreeNode(a,o)}}},t}(r.ManifestResource);t.Range=a},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(t,n){return e.call(this,t,n)||this}return o(t,e),t.prototype.getFormat=function(){return this.getProperty("format")},t}(n(0).ManifestResource);t.Rendering=r},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),s=n(0),a=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.items=[],i._thumbnails=null,i}return o(t,e),t.prototype.getCanvases=function(){if(this.items.length)return this.items;var e=this.__jsonld.canvases||this.__jsonld.elements;if(e)for(var t=0;t<e.length;t++){var n=e[t];(i=new s.Canvas(n,this.options)).index=t,this.items.push(i)}else if(this.__jsonld)for(t=0;t<this.__jsonld.length;t++){var i;n=this.__jsonld[t],(i=new s.Canvas(n,this.options)).index=t,this.items.push(i)}return this.items},t.prototype.getCanvasById=function(e){for(var t=0;t<this.getTotalCanvases();t++){var n=this.getCanvasByIndex(t),i=s.Utils.normaliseUrl(n.id);if(s.Utils.normaliseUrl(e)===i)return n}return null},t.prototype.getCanvasByIndex=function(e){return this.getCanvases()[e]},t.prototype.getCanvasIndexById=function(e){for(var t=0;t<this.getTotalCanvases();t++)if(this.getCanvasByIndex(t).id===e)return t;return null},t.prototype.getCanvasIndexByLabel=function(e,t){e=e.trim(),isNaN(e)||(e=parseInt(e,10).toString(),t&&(e+="r"));for(var n,i,o,r=/(\d*)\D+(\d*)/,s=0;s<this.getTotalCanvases();s++){var a=this.getCanvasByIndex(s);if(a.getLabel().getValue(this.options.locale)===e)return s;if((n=r.exec(e))&&(i=n[1],(o=n[2])&&new RegExp("^"+i+"\\D+"+o+"$").test(a.getLabel().toString())))return s}return-1},t.prototype.getLastCanvasLabel=function(e){for(var t=this.getTotalCanvases()-1;t>=0;t--){var n=this.getCanvasByIndex(t).getLabel().getValue(this.options.locale);if(e){if(/^[a-zA-Z0-9]*$/.test(n))return n}else if(n)return n}return this.options.defaultLabel},t.prototype.getLastPageIndex=function(){return this.getTotalCanvases()-1},t.prototype.getNextPageIndex=function(e,t){var n;if(t){var i=this.getPagedIndices(e),o=this.getViewingDirection();n=o&&o===r.ViewingDirection.RIGHT_TO_LEFT?i[0]+1:i[i.length-1]+1}else n=e+1;return n>this.getLastPageIndex()?-1:n},t.prototype.getPagedIndices=function(e,t){var n=[];if(t){n=this.isFirstCanvas(e)||this.isLastCanvas(e)?[e]:e%2?[e,e+1]:[e-1,e];var i=this.getViewingDirection();i&&i===r.ViewingDirection.RIGHT_TO_LEFT&&(n=n.reverse())}else n.push(e);return n},t.prototype.getPrevPageIndex=function(e,t){var n;if(t){var i=this.getPagedIndices(e),o=this.getViewingDirection();n=o&&o===r.ViewingDirection.RIGHT_TO_LEFT?i[i.length-1]-1:i[0]-1}else n=e-1;return n},t.prototype.getStartCanvasIndex=function(){var e=this.getStartCanvas();if(e)for(var t=0;t<this.getTotalCanvases();t++)if(this.getCanvasByIndex(t).id===e)return t;return 0},t.prototype.getThumbs=function(e,t){for(var n=[],i=this.getTotalCanvases(),o=0;i>o;o++){var r=this.getCanvasByIndex(o),a=new s.Thumb(e,r);n.push(a)}return n},t.prototype.getThumbnails=function(){if(null!=this._thumbnails)return this._thumbnails;this._thumbnails=[];for(var e=this.getCanvases(),t=0;t<e.length;t++){var n=e[t].getThumbnail();n&&this._thumbnails.push(n)}return this._thumbnails},t.prototype.getStartCanvas=function(){return this.getProperty("startCanvas")},t.prototype.getTotalCanvases=function(){return this.getCanvases().length},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?this.getProperty("viewingDirection"):this.options.resource.getViewingDirection?this.options.resource.getViewingDirection():null},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t.prototype.isCanvasIndexOutOfRange=function(e){return e>this.getTotalCanvases()-1},t.prototype.isFirstCanvas=function(e){return 0===e},t.prototype.isLastCanvas=function(e){return e===this.getTotalCanvases()-1},t.prototype.isMultiCanvas=function(){return this.getTotalCanvases()>1},t.prototype.isPagingEnabled=function(){var e=this.getViewingHint();return!!e&&e===r.ViewingHint.PAGED},t.prototype.isTotalCanvasesEven=function(){return this.getTotalCanvases()%2==0},t}(s.ManifestResource);t.Sequence=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=function(){function e(){}return e.parse=function(e,t){return"string"==typeof e&&(e=JSON.parse(e)),this.parseJson(e,t)},e.parseJson=function(e,t){var n;if(t&&t.navDate&&!isNaN(t.navDate.getTime())&&(e.navDate=t.navDate.toString()),e["@type"])switch(e["@type"]){case"sc:Collection":n=this.parseCollection(e,t);break;case"sc:Manifest":n=this.parseManifest(e,t);break;default:return null}else switch(e.type){case"Collection":n=this.parseCollection(e,t);break;case"Manifest":n=this.parseManifest(e,t);break;default:return null}return n.isLoaded=!0,n},e.parseCollection=function(e,t){var n=new i.Collection(e,t);return t?(n.index=t.index||0,t.resource&&(n.parentCollection=t.resource.parentCollection)):n.index=0,this.parseCollections(n,t),this.parseManifests(n,t),this.parseItems(n,t),n},e.parseCollections=function(e,t){var n;if(e.__jsonld.collections?n=e.__jsonld.collections:e.__jsonld.items&&(n=e.__jsonld.items.filter(function(e){return"collection"===e.type.toLowerCase()})),n)for(var i=0;i<n.length;i++){t&&(t.index=i);var o=this.parseCollection(n[i],t);o.index=i,o.parentCollection=e,e.items.push(o)}},e.parseManifest=function(e,t){return new i.Manifest(e,t)},e.parseManifests=function(e,t){var n;if(e.__jsonld.manifests?n=e.__jsonld.manifests:e.__jsonld.items&&(n=e.__jsonld.items.filter(function(e){return"manifest"===e.type.toLowerCase()})),n)for(var i=0;i<n.length;i++){var o=this.parseManifest(n[i],t);o.index=i,o.parentCollection=e,e.items.push(o)}},e.parseItem=function(e,t){if(e["@type"]){if("sc:manifest"===e["@type"].toLowerCase())return this.parseManifest(e,t);if("sc:collection"===e["@type"].toLowerCase())return this.parseCollection(e,t)}else if(e.type){if("manifest"===e.type.toLowerCase())return this.parseManifest(e,t);if("collection"===e.type.toLowerCase())return this.parseCollection(e,t)}return null},e.parseItems=function(e,t){var n=e.__jsonld.members||e.__jsonld.items;if(n)for(var i=function(i){
t&&(t.index=i);var r=o.parseItem(n[i],t);return r?e.items.filter(function(e){return e.id===r.id})[0]?"continue":(r.index=i,r.parentCollection=e,void e.items.push(r)):{value:void 0}},o=this,r=0;r<n.length;r++){var s=i(r);if("object"==typeof s)return s.value}},e}();t.Deserialiser=o},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=function(e){function t(t,n){return e.call(this,t,n)||this}return o(t,e),t.prototype.getProfile=function(){var e=this.getProperty("profile");return e||(e=this.getProperty("dcterms:conformsTo")),Array.isArray(e)?e[0]:e},t.prototype.getConfirmLabel=function(){return r.Utils.getLocalisedValue(this.getProperty("confirmLabel"),this.options.locale)},t.prototype.getDescription=function(){return r.Utils.getLocalisedValue(this.getProperty("description"),this.options.locale)},t.prototype.getFailureDescription=function(){return r.Utils.getLocalisedValue(this.getProperty("failureDescription"),this.options.locale)},t.prototype.getFailureHeader=function(){return r.Utils.getLocalisedValue(this.getProperty("failureHeader"),this.options.locale)},t.prototype.getHeader=function(){return r.Utils.getLocalisedValue(this.getProperty("header"),this.options.locale)},t.prototype.getServiceLabel=function(){return r.Utils.getLocalisedValue(this.getProperty("label"),this.options.locale)},t.prototype.getInfoUri=function(){var e=this.id;return e.endsWith("/")||(e+="/"),e+="info.json"},t}(r.ManifestResource);t.Service=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e,t){this.width=e,this.height=t};t.Size=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.AUTHORIZATION_FAILED=1]="AUTHORIZATION_FAILED",e[e.FORBIDDEN=2]="FORBIDDEN",e[e.INTERNAL_SERVER_ERROR=3]="INTERNAL_SERVER_ERROR",e[e.RESTRICTED=4]="RESTRICTED"}(t.StatusCode||(t.StatusCode={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e,t){this.data=t,this.index=t.index,this.width=e;var n=t.getHeight()/t.getWidth();this.height=n?Math.floor(this.width*n):e,this.uri=t.getCanonicalImageUri(e),this.label=t.getLabel().getValue()};t.Thumb=i},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(t,n){return e.call(this,t,n)||this}return o(t,e),t}(n(0).Resource);t.Thumbnail=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=function(){function e(e,t){this.label=e,this.data=t||{},this.nodes=[]}return e.prototype.addNode=function(e){this.nodes.push(e),e.parentNode=this},e.prototype.isCollection=function(){return this.data.type===i.Utils.normaliseType(i.TreeNodeType.COLLECTION)},e.prototype.isManifest=function(){return this.data.type===i.Utils.normaliseType(i.TreeNodeType.MANIFEST)},e.prototype.isRange=function(){return this.data.type===i.Utils.normaliseType(i.TreeNodeType.RANGE)},e}();t.TreeNode=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.COLLECTION="collection",e.MANIFEST="manifest",e.RANGE="range"}(t.TreeNodeType||(t.TreeNodeType={}))}])}),define("lib/manifesto.js",function(){}),!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("manifold",[],t):"object"==typeof exports?exports.manifold=t():e.manifold=t()}(window,function(){return function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:i})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(t.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)t.d(i,o,function(t){return e[t]}.bind(null,o));return i},t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=15)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.BOOKMARKING="oa:bookmarking",e.CLASSIFYING="oa:classifying",e.COMMENTING="oa:commenting",e.DESCRIBING="oa:describing",e.EDITING="oa:editing",e.HIGHLIGHTING="oa:highlighting",e.IDENTIFYING="oa:identifying",e.LINKING="oa:linking",e.MODERATING="oa:moderating",e.PAINTING="sc:painting",e.QUESTIONING="oa:questioning",e.REPLYING="oa:replying",e.TAGGING="oa:tagging",e.TRANSCRIBING="oad:transcribing"}(t.AnnotationMotivation||(t.AnnotationMotivation={})),function(e){e.AUTO_ADVANCE="auto-advance",e.CONTINUOUS="continuous",e.FACING_PAGES="facing-pages",e.HIDDEN="hidden",e.INDIVIDUALS="individuals",e.MULTI_PART="multi-part",e.NO_NAV="no-nav",e.NON_PAGED="non-paged",e.PAGED="paged",e.REPEAT="repeat",e.SEQUENCE="sequence",e.THUMBNAIL_NAV="thumbnail-nav",e.TOGETHER="together",e.UNORDERED="unordered"}(t.Behavior||(t.Behavior={})),function(e){e.CANVAS="canvas",e.CHOICE="choice",e.OA_CHOICE="oa:choice",e.CONTENT_AS_TEXT="contentastext",e.DATASET="dataset",e.DOCUMENT="document",e.IMAGE="image",e.MODEL="model",e.MOVING_IMAGE="movingimage",e.PDF="pdf",e.PHYSICAL_OBJECT="physicalobject",e.SOUND="sound",e.TEXT="text",e.TEXTUALBODY="textualbody",e.VIDEO="video"}(t.ExternalResourceType||(t.ExternalResourceType={})),function(e){e.ANNOTATION="annotation",e.CANVAS="canvas",e.COLLECTION="collection",e.MANIFEST="manifest",e.RANGE="range",e.SEQUENCE="sequence"}(t.IIIFResourceType||(t.IIIFResourceType={})),function(e){e.AUDIO_MP4="audio/mp4",e.CORTO="application/corto",e.DICOM="application/dicom",e.DRACO="application/draco",e.EPUB="application/epub+zip",e.GLB="model/gltf-binary",e.GLTF="model/gltf+json",e.IIIF_PRESENTATION_2='application/ld+json;profile="http://iiif.io/api/presentation/2/context.json"',e.IIIF_PRESENTATION_3='application/ld+json;profile="http://iiif.io/api/presentation/3/context.json"',e.JPG="image/jpeg",e.M3U8="application/vnd.apple.mpegurl",e.MP3="audio/mp3",e.MPEG_DASH="application/dash+xml",e.OBJ="text/plain",e.OPF="application/oebps-package+xml",e.PDF="application/pdf",e.PLY="application/ply",e.THREEJS="application/vnd.threejs+json",e.USDZ="model/vnd.usd+zip",e.VIDEO_MP4="video/mp4",e.WEBM="video/webm"}(t.MediaType||(t.MediaType={})),function(e){e.DOC="application/msword",e.DOCX="application/vnd.openxmlformats-officedocument.wordprocessingml.document",e.PDF="application/pdf"}(t.RenderingFormat||(t.RenderingFormat={})),function(e){e.IMAGE_0_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0",e.IMAGE_0_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1",e.IMAGE_0_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2",e.IMAGE_0_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0",e.IMAGE_0_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1",e.IMAGE_0_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2",e.IMAGE_1_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",e.IMAGE_1_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",e.IMAGE_1_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",e.IMAGE_1_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",e.IMAGE_1_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",e.IMAGE_1_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",e.IMAGE_1_LEVEL_0="http://iiif.io/api/image/1/level0.json",e.IMAGE_1_PROFILE_LEVEL_0="http://iiif.io/api/image/1/profiles/level0.json",e.IMAGE_1_LEVEL_1="http://iiif.io/api/image/1/level1.json",e.IMAGE_1_PROFILE_LEVEL_1="http://iiif.io/api/image/1/profiles/level1.json",e.IMAGE_1_LEVEL_2="http://iiif.io/api/image/1/level2.json",e.IMAGE_1_PROFILE_LEVEL_2="http://iiif.io/api/image/1/profiles/level2.json",e.IMAGE_2_LEVEL_0="http://iiif.io/api/image/2/level0.json",e.IMAGE_2_PROFILE_LEVEL_0="http://iiif.io/api/image/2/profiles/level0.json",e.IMAGE_2_LEVEL_1="http://iiif.io/api/image/2/level1.json",e.IMAGE_2_PROFILE_LEVEL_1="http://iiif.io/api/image/2/profiles/level1.json",e.IMAGE_2_LEVEL_2="http://iiif.io/api/image/2/level2.json",e.IMAGE_2_PROFILE_LEVEL_2="http://iiif.io/api/image/2/profiles/level2.json",e.AUTH_0_CLICK_THROUGH="http://iiif.io/api/auth/0/login/clickthrough",e.AUTH_0_LOGIN="http://iiif.io/api/auth/0/login",e.AUTH_0_LOGOUT="http://iiif.io/api/auth/0/logout",e.AUTH_0_RESTRICTED="http://iiif.io/api/auth/0/login/restricted",e.AUTH_0_TOKEN="http://iiif.io/api/auth/0/token",e.AUTH_1_CLICK_THROUGH="http://iiif.io/api/auth/1/clickthrough",e.AUTH_1_EXTERNAL="http://iiif.io/api/auth/1/external",e.AUTH_1_KIOSK="http://iiif.io/api/auth/1/kiosk",e.AUTH_1_LOGIN="http://iiif.io/api/auth/1/login",e.AUTH_1_LOGOUT="http://iiif.io/api/auth/1/logout",e.AUTH_1_PROBE="http://iiif.io/api/auth/1/probe",e.AUTH_1_TOKEN="http://iiif.io/api/auth/1/token",e.SEARCH_0="http://iiif.io/api/search/0/search",e.SEARCH_0_AUTO_COMPLETE="http://iiif.io/api/search/0/autocomplete",e.SEARCH_1="http://iiif.io/api/search/1/search",e.SEARCH_1_AUTO_COMPLETE="http://iiif.io/api/search/1/autocomplete",e.TRACKING_EXTENSIONS="http://universalviewer.io/tracking-extensions-profile",e.UI_EXTENSIONS="http://universalviewer.io/ui-extensions-profile",e.PRINT_EXTENSIONS="http://universalviewer.io/print-extensions-profile",e.SHARE_EXTENSIONS="http://universalviewer.io/share-extensions-profile",e.OTHER_MANIFESTATIONS="http://iiif.io/api/otherManifestations.json",e.IXIF="http://wellcomelibrary.org/ld/ixif/0/alpha.json"}(t.ServiceProfile||(t.ServiceProfile={})),function(e){e.BOTTOM_TO_TOP="bottom-to-top",e.LEFT_TO_RIGHT="left-to-right",e.RIGHT_TO_LEFT="right-to-left",e.TOP_TO_BOTTOM="top-to-bottom"}(t.ViewingDirection||(t.ViewingDirection={})),function(e){e.CONTINUOUS="continuous",e.INDIVIDUALS="individuals",e.NON_PAGED="non-paged",e.PAGED="paged",e.TOP="top"}(t.ViewingHint||(t.ViewingHint={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONTINUE=100,t.SWITCHING_PROTOCOLS=101,t.PROCESSING=102,t.OK=200,t.CREATED=201,t.ACCEPTED=202,t.NON_AUTHORITATIVE_INFORMATION=203,t.NO_CONTENT=204,t.RESET_CONTENT=205,t.PARTIAL_CONTENT=206,t.MULTI_STATUS=207,t.MULTIPLE_CHOICES=300,t.MOVED_PERMANENTLY=301,t.MOVED_TEMPORARILY=302,t.SEE_OTHER=303,t.NOT_MODIFIED=304,t.USE_PROXY=305,t.TEMPORARY_REDIRECT=307,t.BAD_REQUEST=400,t.UNAUTHORIZED=401,t.PAYMENT_REQUIRED=402,t.FORBIDDEN=403,t.NOT_FOUND=404,t.METHOD_NOT_ALLOWED=405,t.NOT_ACCEPTABLE=406,t.PROXY_AUTHENTICATION_REQUIRED=407,t.REQUEST_TIME_OUT=408,t.CONFLICT=409,t.GONE=410,t.LENGTH_REQUIRED=411,t.PRECONDITION_FAILED=412,t.REQUEST_ENTITY_TOO_LARGE=413,t.REQUEST_URI_TOO_LARGE=414,t.UNSUPPORTED_MEDIA_TYPE=415,t.REQUESTED_RANGE_NOT_SATISFIABLE=416,t.EXPECTATION_FAILED=417,t.IM_A_TEAPOT=418,t.UNPROCESSABLE_ENTITY=422,t.LOCKED=423,t.FAILED_DEPENDENCY=424,t.UNORDERED_COLLECTION=425,t.UPGRADE_REQUIRED=426,t.PRECONDITION_REQUIRED=428,t.TOO_MANY_REQUESTS=429,t.REQUEST_HEADER_FIELDS_TOO_LARGE=431,t.INTERNAL_SERVER_ERROR=500,t.NOT_IMPLEMENTED=501,t.BAD_GATEWAY=502,t.SERVICE_UNAVAILABLE=503,t.GATEWAY_TIME_OUT=504,t.HTTP_VERSION_NOT_SUPPORTED=505,t.VARIANT_ALSO_NEGOTIATES=506,t.INSUFFICIENT_STORAGE=507,t.BANDWIDTH_LIMIT_EXCEEDED=509,t.NOT_EXTENDED=510,t.NETWORK_AUTHENTICATION_REQUIRED=511},function(e,t,n){"use strict";n.r(t);var i,o,r=function(){function e(e){this.__jsonld=e,this.context=this.getProperty("context"),this.id=this.getProperty("id")}return e.prototype.getProperty=function(e){var t=null;return this.__jsonld&&((t=this.__jsonld[e])||(t=this.__jsonld["@"+e])),t},e}(),s=n(0),a=(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),u=function(e){function t(t,n){var i=e.call(this,t)||this;return i.options=n,i}return a(t,e),t.prototype.getIIIFResourceType=function(){return $.normaliseType(this.getProperty("type"))},t.prototype.getLabel=function(){var e=this.getProperty("label");return e?F.parse(e,this.options.locale):new F([],this.options.locale)},t.prototype.getDefaultLabel=function(){return this.getLabel().getValue(this.options.locale)},t.prototype.getMetadata=function(){var e=this.getProperty("metadata"),t=[];if(!e)return t;for(var n=0;n<e.length;n++){var i=e[n],o=new P(this.options.locale);o.parse(i),t.push(o)}return t},t.prototype.getRendering=function(e){for(var t=this.getRenderings(),n=0;n<t.length;n++){var i=t[n];if(i.getFormat()===e)return i}return null},t.prototype.getRenderings=function(){var e,t=[];if(!(e=this.__jsonld?this.__jsonld.rendering:this.rendering))return t;Array.isArray(e)||(e=[e]);for(var n=0;n<e.length;n++){var i=e[n];t.push(new q(i,this.options))}return t},t.prototype.getService=function(e){return $.getService(this,e)},t.prototype.getServices=function(){return $.getServices(this)},t.prototype.getThumbnail=function(){var e=this.getProperty("thumbnail");return Array.isArray(e)&&(e=e[0]),e?new ie(e,this.options):null},t.prototype.isAnnotation=function(){return this.getIIIFResourceType()===s.IIIFResourceType.ANNOTATION},t.prototype.isCanvas=function(){return this.getIIIFResourceType()===s.IIIFResourceType.CANVAS},t.prototype.isCollection=function(){return this.getIIIFResourceType()===s.IIIFResourceType.COLLECTION},t.prototype.isManifest=function(){return this.getIIIFResourceType()===s.IIIFResourceType.MANIFEST},t.prototype.isRange=function(){return this.getIIIFResourceType()===s.IIIFResourceType.RANGE},t.prototype.isSequence=function(){return this.getIIIFResourceType()===s.IIIFResourceType.SEQUENCE},t}(r),l=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),c=function(e){function t(t,n){return e.call(this,t,n)||this}return l(t,e),t.prototype.getFormat=function(){var e=this.getProperty("format");return e?e.toLowerCase():null},t.prototype.getResources=function(){var e=[];if(!this.__jsonld.resources)return e;for(var t=0;t<this.__jsonld.resources.length;t++){var n=this.__jsonld.resources[t],i=new f(n,this.options);e.push(i)}return e},t.prototype.getType=function(){var e=this.getProperty("type");return e?$.normaliseType(e):null},t.prototype.getWidth=function(){return this.getProperty("width")},t.prototype.getHeight=function(){return this.getProperty("height")},t.prototype.getMaxWidth=function(){return this.getProperty("maxWidth")},t.prototype.getMaxHeight=function(){return this.getProperty("maxHeight")?null:this.getMaxWidth()},t}(u),h=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),p=function(e){function t(t,n){var i=e.call(this,t,n)||this;i.index=-1,i.isLoaded=!1;var o={defaultLabel:"-",locale:"en-GB",resource:i,pessimisticAccessControl:!1};return i.options=Object.assign(o,n),i}return h(t,e),t.prototype.getAttribution=function(){var e=this.getProperty("attribution");return e?F.parse(e,this.options.locale):new F([],this.options.locale)},t.prototype.getDescription=function(){var e=this.getProperty("description");return e?F.parse(e,this.options.locale):new F([],this.options.locale)},t.prototype.getHomepage=function(){var e=this.getProperty("homepage");return e?"string"==typeof e?e:(Array.isArray(e)&&e.length&&(e=e[0]),e["@id"]||e.id):null},t.prototype.getIIIFResourceType=function(){return $.normaliseType(this.getProperty("type"))},t.prototype.getLogo=function(){var e=this.getProperty("logo");return e?"string"==typeof e?e:(Array.isArray(e)&&e.length&&(e=e[0]),e["@id"]||e.id):null},t.prototype.getLicense=function(){return $.getLocalisedValue(this.getProperty("license"),this.options.locale)},t.prototype.getNavDate=function(){return new Date(this.getProperty("navDate"))},t.prototype.getRelated=function(){return this.getProperty("related")},t.prototype.getSeeAlso=function(){return this.getProperty("seeAlso")},t.prototype.getTrackingLabel=function(){var e=this.getService(s.ServiceProfile.TRACKING_EXTENSIONS);return e?e.getProperty("trackingLabel"):""},t.prototype.getDefaultTree=function(){return this.defaultTree=new oe("root"),this.defaultTree.data=this,this.defaultTree},t.prototype.getRequiredStatement=function(){var e=null,t=this.getProperty("requiredStatement");if(t)(e=new P(this.options.locale)).parse(t);else{var n=this.getAttribution();n&&((e=new P(this.options.locale)).value=n)}return e},t.prototype.isCollection=function(){return this.getIIIFResourceType()===s.IIIFResourceType.COLLECTION},t.prototype.isManifest=function(){return this.getIIIFResourceType()===s.IIIFResourceType.MANIFEST},t.prototype.load=function(){var e=this;return new Promise(function(t){if(e.isLoaded)t(e);else{var n=e.options;n.navDate=e.getNavDate();var i=e.__jsonld.id;i||(i=e.__jsonld["@id"]),$.loadManifest(i).then(function(i){e.parentLabel=e.getLabel().getValue(n.locale);var o=Y.parse(i,n);(e=Object.assign(e,o)).index=n.index,t(e)})}})},t}(u),d=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),f=function(e){function t(t,n){return e.call(this,t,n)||this}return d(t,e),t.prototype.getBody=function(){var e=[],t=this.getProperty("body");if(t)if(Array.isArray(t))for(var n=0;n<t.length;n++)if((r=t[n]).items)for(var i=0;i<r.items.length;i++){var o=r.items[i];e.push(new v(o,this.options))}else e.push(new v(r,this.options));else if(t.items)for(n=0;n<t.items.length;n++){var r=t.items[n];e.push(new v(r,this.options))}else e.push(new v(t,this.options));return e},t.prototype.getMotivation=function(){var e=this.getProperty("motivation");return e||null},t.prototype.getOn=function(){return this.getProperty("on")},t.prototype.getTarget=function(){return this.getProperty("target")},t.prototype.getResource=function(){return new c(this.getProperty("resource"),this.options)},t}(u),g=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),v=function(e){function t(t,n){return e.call(this,t,n)||this}return g(t,e),t.prototype.getFormat=function(){var e=this.getProperty("format");return e?$.getMediaType(e):null},t.prototype.getType=function(){return this.getProperty("type")?$.normaliseType(this.getProperty("type")):null},t.prototype.getWidth=function(){return this.getProperty("width")},t.prototype.getHeight=function(){return this.getProperty("height")},t}(u),_=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),m=function(e){function t(t,n,i){var o=e.call(this,n)||this;return o.label=t,o.options=i,o}return _(t,e),t.prototype.getIIIFResourceType=function(){return $.normaliseType(this.getProperty("type"))},t.prototype.getLabel=function(){return this.label},t.prototype.getResources=function(){var e=this;return this.getProperty("resources").map(function(t){return new f(t,e.options)})},t.prototype.load=function(){var e=this;return new Promise(function(t,n){if(e.isLoaded)t(e);else{var i=e.__jsonld.id;i||(i=e.__jsonld["@id"]),$.loadManifest(i).then(function(n){e.__jsonld=n,e.context=e.getProperty("context"),e.id=e.getProperty("id"),e.isLoaded=!0,t(e)})["catch"](n)}})},t}(r),E=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),y=function(e){function t(t,n){return e.call(this,t,n)||this}return E(t,e),t.prototype.getItems=function(){return this.getProperty("items")},t}(u),b=n(3),I=n.n(b),T=n(5),O=n.n(T),A=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),C=function(e){function t(t,n){return e.call(this,t,n)||this}return A(t,e),t.prototype.getCanonicalImageUri=function(e){var t,n=null,i="default",o=e;if(this.externalResource&&this.externalResource.data&&this.externalResource.data["@id"])n=this.externalResource.data["@id"],o||(o=this.externalResource.data.width),this.externalResource.data["@context"]&&(this.externalResource.data["@context"].indexOf("/1.0/context.json")>-1||this.externalResource.data["@context"].indexOf("/1.1/context.json")>-1||this.externalResource.data["@context"].indexOf("/1/context.json")>-1)&&(i="native");else{var r=this.getImages();if(r&&r.length){var s=r[0].getResource(),a=s.getServices();if(o||(o=s.getWidth()),a.length){var u=a[0];n=u.id,i=$.getImageQuality(u.getProfile())}else if(o===s.getWidth())return s.id}if(!n){var l=this.getProperty("thumbnail");if(l){if("string"==typeof l)return l;if(l["@id"])return l["@id"];if(l.length)return l[0].id}}}return t=o+",",n&&n.endsWith("/")&&(n=n.substr(0,n.length-1)),[n,"full",t,0,i+".jpg"].join("/")},t.prototype.getMaxDimensions=function(){var e,t=null;return this.externalResource&&this.externalResource.data&&this.externalResource.data.profile&&(e=this.externalResource.data.profile,Array.isArray(e)&&(e=e.filter(function(e){return e.maxWidth})[0])&&(t=new Z(e.maxWidth,e.maxHeight?e.maxHeight:e.maxWidth))),t},t.prototype.getContent=function(){var e=[],t=this.__jsonld.items||this.__jsonld.content;if(!t)return e;var n=null;if(t.length&&(n=new y(t[0],this.options)),!n)return e;for(var i=n.getItems(),o=0;o<i.length;o++){var r=i[o],s=new f(r,this.options);e.push(s)}return e},t.prototype.getDuration=function(){return this.getProperty("duration")},t.prototype.getImages=function(){var e=[];if(!this.__jsonld.images)return e;for(var t=0;t<this.__jsonld.images.length;t++){var n=this.__jsonld.images[t],i=new f(n,this.options);e.push(i)}return e},t.prototype.getIndex=function(){return this.getProperty("index")},t.prototype.getOtherContent=function(){var e=this,t=Array.isArray(this.getProperty("otherContent"))?this.getProperty("otherContent"):[this.getProperty("otherContent")],n=t.filter(function(e){return e&&(t=e["@type"],n="sc:AnnotationList","string"==typeof t&&"string"==typeof n&&t.toLowerCase()==t.toLowerCase());var t,n}).map(function(t,n){return new m(t.label||"Annotation list "+n,t,e.options)}).map(function(e){return e.load()});return Promise.all(n)},t.prototype.getWidth=function(){return this.getProperty("width")},t.prototype.getHeight=function(){return this.getProperty("height")},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},Object.defineProperty(t.prototype,"imageResources",{get:function(){var e=this,n=O()([this.getImages().map(function(e){return e.getResource()}),this.getContent().map(function(e){return e.getBody()})]);return I()(n.map(function(n){switch(n.getProperty("type").toLowerCase()){case s.ExternalResourceType.CHOICE:case s.ExternalResourceType.OA_CHOICE:return new t({images:I()([n.getProperty("default"),n.getProperty("item")]).map(function(e){return{resource:e}})},e.options).getImages().map(function(e){return e.getResource()});default:return n}}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resourceAnnotations",{get:function(){return O()([this.getImages(),this.getContent()])},enumerable:!0,configurable:!0}),t.prototype.resourceAnnotation=function(e){return this.resourceAnnotations.find(function(t){return t.getResource().id===e||I()(new Array(t.getBody())).some(function(t){return t.id===e})})},t.prototype.onFragment=function(e){var t=this.resourceAnnotation(e);if(t){var n=t.getProperty("on"),i=t.getProperty("target"),o=(n||i).match(/xywh=(.*)$/);if(o)return o[1].split(",").map(function(e){return parseInt(e,10)})}},Object.defineProperty(t.prototype,"iiifImageResources",{get:function(){return this.imageResources.filter(function(e){return e&&e.getServices()[0]&&e.getServices()[0].id})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageServiceIds",{get:function(){return this.iiifImageResources.map(function(e){return e.getServices()[0].id})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"aspectRatio",{get:function(){return this.getWidth()/this.getHeight()},enumerable:!0,configurable:!0}),t}(c),w=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),x=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.items=[],i._collections=null,i._manifests=null,t.__collection=i,i}return w(t,e),t.prototype.getCollections=function(){return this._collections?this._collections:this._collections=this.items.filter(function(e){return e.isCollection()})},t.prototype.getManifests=function(){return this._manifests?this._manifests:this._manifests=this.items.filter(function(e){return e.isManifest()})},t.prototype.getCollectionByIndex=function(e){for(var t,n=this.getCollections(),i=0;i<n.length;i++){var o=n[i];o.index===e&&(t=o)}if(t)return t.options.index=e,t.load();throw new Error("Collection index not found")},t.prototype.getManifestByIndex=function(e){for(var t,n=this.getManifests(),i=0;i<n.length;i++){var o=n[i];o.index===e&&(t=o)}if(t)return t.options.index=e,t.load();throw new Error("Manifest index not found")},t.prototype.getTotalCollections=function(){return this.getCollections().length},t.prototype.getTotalManifests=function(){return this.getManifests().length},t.prototype.getTotalItems=function(){return this.items.length},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?this.getProperty("viewingDirection"):s.ViewingDirection.LEFT_TO_RIGHT},t.prototype.getBehavior=function(){var e=this.getProperty("behavior");return Array.isArray(e)&&(e=e[0]),e||null},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t.prototype.getDefaultTree=function(){return e.prototype.getDefaultTree.call(this),this.defaultTree.data.type=$.normaliseType(ee.COLLECTION),this._parseManifests(this),this._parseCollections(this),$.generateTreeNodeIds(this.defaultTree),this.defaultTree},t.prototype._parseManifests=function(e){if(e.getManifests()&&e.getManifests().length)for(var t=0;t<e.getManifests().length;t++){var n=e.getManifests()[t],i=n.getDefaultTree();i.label=n.parentLabel||n.getLabel().getValue(this.options.locale)||"manifest "+(t+1),i.navDate=n.getNavDate(),i.data.id=n.id,i.data.type=$.normaliseType(ee.MANIFEST),e.defaultTree.addNode(i)}},t.prototype._parseCollections=function(e){if(e.getCollections()&&e.getCollections().length)for(var t=0;t<e.getCollections().length;t++){var n=e.getCollections()[t],i=n.getDefaultTree();i.label=n.parentLabel||n.getLabel().getValue(this.options.locale)||"collection "+(t+1),i.navDate=n.getNavDate(),i.data.id=n.id,i.data.type=$.normaliseType(ee.COLLECTION),e.defaultTree.addNode(i)}},t}(p),S=function(){function e(e,t){this.start=e,this.end=t}return e.prototype.getLength=function(){return this.end-this.start},e}(),P=function(){function e(e){this.defaultLocale=e}return e.prototype.parse=function(e){this.resource=e,this.label=F.parse(this.resource.label,this.defaultLocale),this.value=F.parse(this.resource.value,this.defaultLocale)},e.prototype.getLabel=function(e){return null===this.label?null:(Array.isArray(e)&&!e.length&&(e=void 0),this.label.getValue(e||this.defaultLocale))},e.prototype.setLabel=function(e){null===this.label&&(this.label=new F([])),this.label.setValue(e,this.defaultLocale)},e.prototype.getValue=function(e,t){return void 0===t&&(t="<br/>"),null===this.value?null:(Array.isArray(e)&&!e.length&&(e=void 0),this.value.getValue(e||this.defaultLocale,t))},e.prototype.getValues=function(e){return null===this.value?[]:(Array.isArray(e)&&!e.length&&(e=void 0),this.value.getValues(e||this.defaultLocale))},e.prototype.setValue=function(e){null===this.value&&(this.value=new F([])),this.value.setValue(e,this.defaultLocale)},e}(),R=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),L=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return R(t,e),t.getValue=function(e,t){return e.getValue(t,"<br/>")},t.getValues=function(e,t){return e.getValues(t)},t}(Array),N=n(1),D=(n(29),function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{u(i.next(e))}catch(e){r(e)}}function a(e){try{u(i["throw"](e))}catch(e){r(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}u((i=i.apply(e,t||[])).next())})}),M=function(e,t){function n(e){return function(n){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(r=2&e[0]?o["return"]:e[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,e[1])).done)return r;switch(o=0,r&&(e=[2&e[0],r.value]),e[0]){case 0:case 1:r=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!r||e[1]>r[0]&&e[1]<r[3])){a.label=e[1];break}if(6===e[0]&&a.label<r[1]){
a.label=r[1],r=e;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(e);break}r[2]&&a.ops.pop(),a.trys.pop();continue}e=t.call(n,a)}catch(n){e=[6,n],o=0}finally{i=r=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,n])}}var i,o,r,s,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},$=function(){function e(){}return e.getMediaType=function(e){return(e=(e=e.toLowerCase()).split(";")[0]).trim()},e.getImageQuality=function(e){return e===s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1||e===s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2||e===s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_1||e===s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2||e===s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1||e===s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2||e===s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1||e===s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2||e===s.ServiceProfile.IMAGE_1_LEVEL_1||e===s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1||e===s.ServiceProfile.IMAGE_1_LEVEL_2||e===s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2?"native":"default"},e.getInexactLocale=function(e){return-1!==e.indexOf("-")?e.substr(0,e.indexOf("-")):e},e.getLocalisedValue=function(e,t){if(!Array.isArray(e))return e;for(var n=0;n<e.length;n++){var i=e[n];if(t===i["@language"])return i["@value"]}var o=t.substr(0,t.indexOf("-"));for(n=0;n<e.length;n++){var r=e[n];if(r["@language"]===o)return r["@value"]}return null},e.generateTreeNodeIds=function(t,n){var i;void 0===n&&(n=0),i=t.parentNode?t.parentNode.id+"-"+n:"0",t.id=i;for(var o=0;o<t.nodes.length;o++){var r=t.nodes[o];e.generateTreeNodeIds(r,o)}},e.normaliseType=function(e){return-1!==(e=(e||"").toLowerCase()).indexOf(":")?e.split(":")[1]:e},e.normaliseUrl=function(e){return-1!==(e=e.substr(e.indexOf("://"))).indexOf("#")&&(e=e.split("#")[0]),e},e.normalisedUrlsMatch=function(t,n){return e.normaliseUrl(t)===e.normaliseUrl(n)},e.isImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_PROFILE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_PROFILE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_PROFILE_LEVEL_2))},e.isLevel0ImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_PROFILE_LEVEL_0))},e.isLevel1ImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_PROFILE_LEVEL_1))},e.isLevel2ImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_PROFILE_LEVEL_2))},e.parseManifest=function(e,t){return Y.parse(e,t)},e.checkStatus=function(e){if(e.ok)return e;var t=new Error(e.statusText);return t.response=e,Promise.reject(t)},e.loadManifest=function(t){return new Promise(function(n,i){fetch(t).then(e.checkStatus).then(function(e){return e.json()}).then(function(e){n(e)})["catch"](function(e){i()})})},e.loadExternalResourcesAuth1=function(t,n,i,o,r,s,a,u){return new Promise(function(l,c){var h=t.map(function(t){return e.loadExternalResourceAuth1(t,n,i,o,r,s,a,u)});Promise.all(h).then(function(){l(t)})["catch"](function(e){c(e)})})},e.loadExternalResourceAuth1=function(t,n,i,o,r,s,a,u){return D(this,void 0,void 0,function(){var l;return M(this,function(c){switch(c.label){case 0:return[4,o(t)];case 1:return(l=c.sent())?[4,t.getData(l)]:[3,6];case 2:return c.sent(),t.status!==N.OK?[3,3]:[2,t];case 3:return[4,e.doAuthChain(t,n,i,r,s,a,u)];case 4:c.sent(),c.label=5;case 5:if(t.status===N.OK||t.status===N.MOVED_TEMPORARILY)return[2,t];throw e.createAuthorizationFailedError();case 6:return[4,t.getData()];case 7:return c.sent(),t.status!==N.MOVED_TEMPORARILY&&t.status!==N.UNAUTHORIZED?[3,9]:[4,e.doAuthChain(t,n,i,r,s,a,u)];case 8:c.sent(),c.label=9;case 9:if(t.status===N.OK||t.status===N.MOVED_TEMPORARILY)return[2,t];throw e.createAuthorizationFailedError()}})})},e.doAuthChain=function(t,n,i,o,r,s,a){return D(this,void 0,void 0,function(){var u,l,c,h,p,d,f,g;return M(this,function(v){switch(v.label){case 0:return t.isAccessControlled()?((u=t.externalService)&&(u.options=t.options),(l=t.kioskService)&&(l.options=t.options),(c=t.clickThroughService)&&(c.options=t.options),(h=t.loginService)&&(h.options=t.options),t.isResponseHandled||t.status!==N.MOVED_TEMPORARILY?[3,2]:[4,s(t)]):[2,t];case 1:return v.sent(),[2,t];case 2:return p=null,d=null,(p=u)?(d=p,[4,e.attemptResourceWithToken(t,i,p)]):[3,4];case 3:return v.sent(),[2,t];case 4:return(p=l)?(d=p,(f=n(p))?[4,o(f)]:[3,7]):[3,7];case 5:return v.sent(),[4,e.attemptResourceWithToken(t,i,p)];case 6:return v.sent(),[2,t];case 7:return(p=c)?(d=p,[4,r(t,p)]):[3,11];case 8:return(g=v.sent())?[4,o(g)]:[3,11];case 9:return v.sent(),[4,e.attemptResourceWithToken(t,i,p)];case 10:return v.sent(),[2,t];case 11:return(p=h)?(d=p,[4,r(t,p)]):[3,15];case 12:return(g=v.sent())?[4,o(g)]:[3,15];case 13:return v.sent(),[4,e.attemptResourceWithToken(t,i,p)];case 14:return v.sent(),[2,t];case 15:return d&&a(t,d),[2]}})})},e.attemptResourceWithToken=function(e,t,n){return D(this,void 0,void 0,function(){var i,o;return M(this,function(r){switch(r.label){case 0:return(i=n.getService(s.ServiceProfile.AUTH_1_TOKEN))?[4,t(e,i)]:[3,3];case 1:return(o=r.sent())&&o.accessToken?[4,e.getData(o)]:[3,3];case 2:return r.sent(),[2,e];case 3:return[2]}})})},e.loadExternalResourcesAuth09=function(t,n,i,o,r,s,a,u,l,c){return new Promise(function(h,p){var d=t.map(function(t){return e.loadExternalResourceAuth09(t,n,i,o,r,s,a,u,l,c)});Promise.all(d).then(function(){h(t)})["catch"](function(e){p(e)})})},e.loadExternalResourceAuth09=function(t,n,i,o,r,s,a,u,l,c){return new Promise(function(h,p){c&&c.pessimisticAccessControl?t.getData().then(function(){t.isAccessControlled()?t.clickThroughService?(h(i(t)),h(o(t))):r(t).then(function(){s(t,!0).then(function(n){t.getData(n).then(function(){h(l(t))})["catch"](function(t){p(e.createInternalServerError(t))})})["catch"](function(t){p(e.createInternalServerError(t))})})["catch"](function(t){p(e.createInternalServerError(t))}):h(t)})["catch"](function(t){p(e.createInternalServerError(t))}):u(t,n).then(function(c){c?t.getData(c).then(function(){t.status===N.OK?h(l(t)):e.authorize(t,n,i,o,r,s,a,u).then(function(){h(l(t))})["catch"](function(t){p(e.createAuthorizationFailedError())})})["catch"](function(t){p(e.createAuthorizationFailedError())}):e.authorize(t,n,i,o,r,s,a,u).then(function(){h(l(t))})["catch"](function(t){p(e.createAuthorizationFailedError())})})["catch"](function(t){p(e.createAuthorizationFailedError())})})},e.createError=function(e,t){var n=new Error;return n.message=t,n.name=String(e),n},e.createAuthorizationFailedError=function(){return e.createError(j.AUTHORIZATION_FAILED,"Authorization failed")},e.createRestrictedError=function(){return e.createError(j.RESTRICTED,"Restricted")},e.createInternalServerError=function(t){return e.createError(j.INTERNAL_SERVER_ERROR,t)},e.authorize=function(t,n,i,o,r,s,a,u){return new Promise(function(l,c){t.getData().then(function(){t.isAccessControlled()?u(t,n).then(function(u){u?t.getData(u).then(function(){t.status===N.OK?l(t):e.showAuthInteraction(t,n,i,o,r,s,a,l,c)})["catch"](function(t){c(e.createInternalServerError(t))}):s(t,!1).then(function(u){u?a(t,u,n).then(function(){t.getData(u).then(function(){t.status===N.OK?l(t):e.showAuthInteraction(t,n,i,o,r,s,a,l,c)})["catch"](function(t){c(e.createInternalServerError(t))})})["catch"](function(t){c(e.createInternalServerError(t))}):e.showAuthInteraction(t,n,i,o,r,s,a,l,c)})})["catch"](function(t){c(e.createInternalServerError(t))}):l(t)})})},e.showAuthInteraction=function(t,n,i,o,r,s,a,u,l){t.status!==N.MOVED_TEMPORARILY||t.isResponseHandled?t.clickThroughService&&!t.isResponseHandled?i(t).then(function(){s(t,!0).then(function(i){a(t,i,n).then(function(){t.getData(i).then(function(){u(t)})["catch"](function(t){l(e.createInternalServerError(t))})})["catch"](function(t){l(e.createInternalServerError(t))})})["catch"](function(t){l(e.createInternalServerError(t))})}):r(t).then(function(){s(t,!0).then(function(i){a(t,i,n).then(function(){t.getData(i).then(function(){u(t)})["catch"](function(t){l(e.createInternalServerError(t))})})["catch"](function(t){l(e.createInternalServerError(t))})})["catch"](function(t){l(e.createInternalServerError(t))})}):u(t)},e.getService=function(e,t){for(var n=this.getServices(e),i=0;i<n.length;i++){var o=n[i];if(o.getProfile()===t)return o}return null},e.getResourceById=function(t,n){return e.traverseAndFind(t.__jsonld,"@id",n)},e.traverseAndFind=function(t,n,i){if(t.hasOwnProperty(n)&&t[n]===i)return t;for(var o=0;o<Object.keys(t).length;o++)if("object"==typeof t[Object.keys(t)[o]]){var r=e.traverseAndFind(t[Object.keys(t)[o]],n,i);if(null!=r)return r}},e.getServices=function(e){var t,n=[];if(!(t=e.__jsonld?e.__jsonld.service:e.service))return n;Array.isArray(t)||(t=[t]);for(var i=0;i<t.length;i++){var o=t[i];if("string"==typeof o){var r=this.getResourceById(e.options.resource,o);r&&n.push(new J(r.__jsonld||r,e.options))}else n.push(new J(o,e.options))}return n},e.getTemporalComponent=function(e){var t=/t=([^&]+)/g.exec(e),n=null;return t&&t[1]&&(n=t[1].split(",")),n},e}(),B=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),U=function(){for(var e=0,t=0,n=arguments.length;n>t;t++)e+=arguments[t].length;var i=Array(e),o=0;for(t=0;n>t;t++)for(var r=arguments[t],s=0,a=r.length;a>s;s++,o++)i[o]=r[s];return i},V=function(){function e(e,t,n){void 0===n&&(n="none"),Array.isArray(e)&&1===e.length?this._value=e[0]:this._value=e,"none"!==t&&"@none"!==t||(t=void 0),this._locale=t,this._defaultLocale=n}return e.parseV2Value=function(t,n){return"string"==typeof t?new e(t,void 0,n):t["@value"]?new e(t["@value"],t["@language"],n):null},Object.defineProperty(e.prototype,"value",{get:function(){return Array.isArray(this._value)?this._value.join("<br/>"):this._value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"locale",{get:function(){return void 0===this._locale?this._defaultLocale:this._locale},enumerable:!0,configurable:!0}),e.prototype.addValue=function(e){Array.isArray(this._value)||(this._value=[this._value]),Array.isArray(e)?this._value=this._value.concat(e):this._value.push(e)},e}(),F=function(e){function t(n,i){void 0===n&&(n=[]);var o=e.apply(this,n)||this;return o.__proto__=t.prototype,o._defaultLocale=i,o}return B(t,e),t.parse=function(e,n){if(!e)return new t([],n);if(Array.isArray(e)){var i=(o=e.map(function(e){return V.parseV2Value(e,n)}).filter(function(e){return null!==e})).reduce(function(e,t){var n=t._locale;return n||(n="none"),e[n]?e[n].addValue(t._value):e[n]=t,e},{});return new t(Object.values(i),n)}return"string"==typeof e?new t([new V(e,void 0,n)],n):e["@language"]?new t(null!==(o=V.parseV2Value(e))?[o]:[],n):new t(Object.keys(e).map(function(t){var i=e[t];if(!Array.isArray(i))throw new Error("A IIIF v3 localized property value must have an array as the value for a given language.");return new V(i,t,n)}),n);var o},t.prototype.getSuitableLocale=function(e){for(var t=U(this).map(function(e){return e._locale}).filter(function(e){return void 0!==e}),n=function(e){var n=t.find(function(t){return t===e});return n?{value:n}:void 0},i=0,o=e;i<o.length;i++){var r=n(o[i]);if("object"==typeof r)return r.value}for(var s=function(e){var n=t.find(function(t){return $.getInexactLocale(t)===$.getInexactLocale(e)});return n?{value:n}:void 0},a=0,u=e;a<u.length;a++){var l=s(u[a]);if("object"==typeof l)return l.value}},t.prototype.setValue=function(e,t){var n=void 0;if(t){var i=this.getSuitableLocale([t]);i&&(n=this.find(function(e){return e._locale===i}))}else n=this.find(function(e){return void 0===e._locale});n?n._value=e:this.push(new V(e,t,this._defaultLocale))},t.prototype.getValue=function(e,t){var n=this.getValues(e);return 0===n.length?null:t?n.join(t):n[0]},t.prototype.getValues=function(e){if(!this.length)return[];var t;if(t=e?Array.isArray(e)?e:[e]:[],1===this.length&&void 0===this[0]._locale){var n=this[0]._value;return Array.isArray(n)?n:[n]}var i=this.getSuitableLocale(t);if(i)return n=this.find(function(e){return e._locale===i})._value,Array.isArray(n)?n:[n];if(!this.find(function(e){return void 0===e._locale}))return n=this[0]._value,Array.isArray(n)?n:[n];var o=this.find(function(e){return void 0===e._locale});return o?Array.isArray(o._value)?o._value:[o._value]:[]},t}(Array),G=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),H=function(e){function t(t,n){var i=e.call(this,t,n)||this;if(i.index=0,i._allRanges=null,i.items=[],i._topRanges=[],i.__jsonld.structures&&i.__jsonld.structures.length)for(var o=i._getTopRanges(),r=0;r<o.length;r++){var s=o[r];i._parseRanges(s,String(r))}return i}return G(t,e),t.prototype.getPosterCanvas=function(){var e=this.getProperty("posterCanvas");return e&&(e=new C(e,this.options)),e},t.prototype.getAccompanyingCanvas=function(){var e=this.getProperty("accompanyingCanvas");return e&&(e=new C(e,this.options)),e},t.prototype.getBehavior=function(){var e=this.getProperty("behavior");return Array.isArray(e)&&(e=e[0]),e||null},t.prototype.getDefaultTree=function(){if(e.prototype.getDefaultTree.call(this),this.defaultTree.data.type=$.normaliseType(ee.MANIFEST),!this.isLoaded)return this.defaultTree;var t=this.getTopRanges();return t.length&&t[0].getTree(this.defaultTree),$.generateTreeNodeIds(this.defaultTree),this.defaultTree},t.prototype._getTopRanges=function(){var e=[];if(this.__jsonld.structures&&this.__jsonld.structures.length){for(var t=0;t<this.__jsonld.structures.length;t++){var n=this.__jsonld.structures[t];n.viewingHint===s.ViewingHint.TOP&&e.push(n)}if(!e.length){var i={};i.ranges=this.__jsonld.structures,e.push(i)}}return e},t.prototype.getTopRanges=function(){return this._topRanges},t.prototype._getRangeById=function(e){if(this.__jsonld.structures&&this.__jsonld.structures.length)for(var t=0;t<this.__jsonld.structures.length;t++){var n=this.__jsonld.structures[t];if(n["@id"]===e||n.id===e)return n}return null},t.prototype._parseRanges=function(e,t,n){var i,o=null;if("string"==typeof e&&(o=e,e=this._getRangeById(o)),e){(i=new W(e,this.options)).parentRange=n,i.path=t,n?n.items.push(i):this._topRanges.push(i);var r=e.items||e.members;if(r)for(var s=0;s<r.length;s++){var a=r[s];if(a["@type"]&&"sc:range"===a["@type"].toLowerCase()||a.type&&"range"===a.type.toLowerCase())this._parseRanges(a,t+"/"+s,i);else if(a["@type"]&&"sc:canvas"===a["@type"].toLowerCase()||a.type&&"canvas"===a.type.toLowerCase()){i.canvases||(i.canvases=[]);var u=a.id||a["@id"];i.canvases.push(u)}}else if(e.ranges)for(s=0;s<e.ranges.length;s++)this._parseRanges(e.ranges[s],t+"/"+s,i)}else console.warn("Range:",o,"does not exist")},t.prototype.getAllRanges=function(){if(null!=this._allRanges)return this._allRanges;this._allRanges=[];for(var e=this.getTopRanges(),t=function(t){var i=e[t];i.id&&n._allRanges.push(i);var o=function(e,t){e.add(t);var n=t.getRanges();return n.length?n.reduce(o,e):e},r=Array.from(i.getRanges().reduce(o,new Set));n._allRanges=n._allRanges.concat(r)},n=this,i=0;i<e.length;i++)t(i);return this._allRanges},t.prototype.getRangeById=function(e){for(var t=this.getAllRanges(),n=0;n<t.length;n++){var i=t[n];if(i.id===e)return i}return null},t.prototype.getRangeByPath=function(e){for(var t=this.getAllRanges(),n=0;n<t.length;n++){var i=t[n];if(i.path===e)return i}return null},t.prototype.getSequences=function(){if(this.items.length)return this.items;var e=this.__jsonld.mediaSequences||this.__jsonld.sequences;if(e)for(var t=0;t<e.length;t++){var n=e[t],i=new K(n,this.options);this.items.push(i)}else this.__jsonld.items&&(i=new K(this.__jsonld.items,this.options),this.items.push(i));return this.items},t.prototype.getSequenceByIndex=function(e){return this.getSequences()[e]},t.prototype.getTotalSequences=function(){return this.getSequences().length},t.prototype.getManifestType=function(){var e=this.getService(s.ServiceProfile.UI_EXTENSIONS);return e?e.getProperty("manifestType"):o.EMPTY},t.prototype.isMultiSequence=function(){return this.getTotalSequences()>1},t.prototype.isPagingEnabled=function(){var e=this.getViewingHint();if(e)return e===s.ViewingHint.PAGED;var t=this.getBehavior();return!!t&&t===s.Behavior.PAGED},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t}(p);!function(e){e.EMPTY="",e.MANUSCRIPT="manuscript",e.MONOGRAPH="monograph"}(o||(o={}));var j,k=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),W=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i._ranges=null,i.canvases=null,i.items=[],i}return k(t,e),t.prototype.getCanvasIds=function(){return this.__jsonld.canvases?this.__jsonld.canvases:this.canvases?this.canvases:[]},t.prototype.getDuration=function(){if(this.canvases&&this.canvases.length){for(var e=[],t=[],n=0,i=this.canvases;n<i.length;n++)if(d=i[n]){var o=d.match(/(.*)#t=([0-9.]+),?([0-9.]+)?/)||[void 0,d],r=o[1],s=o[2],a=o[3];r&&(e.push(parseFloat(s)),t.push(parseFloat(a)))}if(e.length&&t.length)return new S(Math.min.apply(Math,e),Math.max.apply(Math,t))}else{e=[],t=[];for(var u=0,l=g=this.getRanges();u<l.length;u++)(v=l[u].getDuration())&&(e.push(v.start),t.push(v.end));if(e.length&&t.length)return new S(Math.min.apply(Math,e),Math.max.apply(Math,t))}var c,h;if(this.canvases&&this.canvases.length)for(var p=0;p<this.canvases.length;p++){var d=this.canvases[p],f=$.getTemporalComponent(d);f&&f.length>1&&(0===p&&(c=Number(f[0])),p===this.canvases.length-1&&(h=Number(f[1])))}else{var g=this.getRanges();for(p=0;p<g.length;p++){var v;(v=g[p].getDuration())&&(0===p&&(c=v.start),p===g.length-1&&(h=v.end))}}return void 0!==c&&void 0!==h?new S(c,h):void 0},t.prototype.getRanges=function(){return this._ranges?this._ranges:this._ranges=this.items.filter(function(e){return e.isRange()})},t.prototype.getBehavior=function(){var e=this.getProperty("behavior");return Array.isArray(e)&&(e=e[0]),e||null},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t.prototype.getTree=function(e){e.data=this,this.treeNode=e;var t=this.getRanges();if(t&&t.length)for(var n=0;n<t.length;n++){var i=t[n],o=new oe;e.addNode(o),this._parseTreeNode(o,i)}return $.generateTreeNodeIds(e),e},t.prototype.spansTime=function(e){var t=this.getDuration();return!!(t&&e>=t.start&&e<=t.end)},t.prototype._parseTreeNode=function(e,t){e.label=t.getLabel().getValue(this.options.locale),e.data=t,e.data.type=$.normaliseType(ee.RANGE),t.treeNode=e;var n=t.getRanges();if(n&&n.length)for(var i=0;i<n.length;i++){var o=n[i];if(o.getBehavior()!==s.Behavior.NO_NAV){var r=new oe;e.addNode(r),this._parseTreeNode(r,o)}}},t}(u),z=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),q=function(e){function t(t,n){return e.call(this,t,n)||this}return z(t,e),t.prototype.getFormat=function(){return this.getProperty("format")},t}(u),X=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),K=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.items=[],i._thumbnails=null,i}return X(t,e),t.prototype.getCanvases=function(){if(this.items.length)return this.items;var e=this.__jsonld.canvases||this.__jsonld.elements;if(e)for(var t=0;t<e.length;t++){var n=e[t];(i=new C(n,this.options)).index=t,this.items.push(i)}else if(this.__jsonld)for(t=0;t<this.__jsonld.length;t++){var i;n=this.__jsonld[t],(i=new C(n,this.options)).index=t,this.items.push(i)}return this.items},t.prototype.getCanvasById=function(e){for(var t=0;t<this.getTotalCanvases();t++){var n=this.getCanvasByIndex(t),i=$.normaliseUrl(n.id);if($.normaliseUrl(e)===i)return n}return null},t.prototype.getCanvasByIndex=function(e){return this.getCanvases()[e]},t.prototype.getCanvasIndexById=function(e){for(var t=0;t<this.getTotalCanvases();t++)if(this.getCanvasByIndex(t).id===e)return t;return null},t.prototype.getCanvasIndexByLabel=function(e,t){e=e.trim(),isNaN(e)||(e=parseInt(e,10).toString(),t&&(e+="r"));for(var n,i,o,r=/(\d*)\D+(\d*)/,s=0;s<this.getTotalCanvases();s++){var a=this.getCanvasByIndex(s);if(a.getLabel().getValue(this.options.locale)===e)return s;if((n=r.exec(e))&&(i=n[1],(o=n[2])&&new RegExp("^"+i+"\\D+"+o+"$").test(a.getLabel().toString())))return s}return-1},t.prototype.getLastCanvasLabel=function(e){for(var t=this.getTotalCanvases()-1;t>=0;t--){var n=this.getCanvasByIndex(t).getLabel().getValue(this.options.locale);if(e){if(/^[a-zA-Z0-9]*$/.test(n))return n}else if(n)return n}return this.options.defaultLabel},t.prototype.getLastPageIndex=function(){return this.getTotalCanvases()-1},t.prototype.getNextPageIndex=function(e,t){var n;if(t){var i=this.getPagedIndices(e),o=this.getViewingDirection();n=o&&o===s.ViewingDirection.RIGHT_TO_LEFT?i[0]+1:i[i.length-1]+1}else n=e+1;return n>this.getLastPageIndex()?-1:n},t.prototype.getPagedIndices=function(e,t){var n=[];if(t){n=this.isFirstCanvas(e)||this.isLastCanvas(e)?[e]:e%2?[e,e+1]:[e-1,e];var i=this.getViewingDirection();i&&i===s.ViewingDirection.RIGHT_TO_LEFT&&(n=n.reverse())}else n.push(e);return n},t.prototype.getPrevPageIndex=function(e,t){var n;if(t){var i=this.getPagedIndices(e),o=this.getViewingDirection();n=o&&o===s.ViewingDirection.RIGHT_TO_LEFT?i[i.length-1]-1:i[0]-1}else n=e-1;return n},t.prototype.getStartCanvasIndex=function(){var e=this.getStartCanvas();if(e)for(var t=0;t<this.getTotalCanvases();t++)if(this.getCanvasByIndex(t).id===e)return t;return 0},t.prototype.getThumbs=function(e,t){for(var n=[],i=this.getTotalCanvases(),o=0;i>o;o++){var r=this.getCanvasByIndex(o),s=new te(e,r);n.push(s)}return n},t.prototype.getThumbnails=function(){if(null!=this._thumbnails)return this._thumbnails;this._thumbnails=[];for(var e=this.getCanvases(),t=0;t<e.length;t++){var n=e[t].getThumbnail();n&&this._thumbnails.push(n)}return this._thumbnails},t.prototype.getStartCanvas=function(){return this.getProperty("startCanvas")},t.prototype.getTotalCanvases=function(){return this.getCanvases().length},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?this.getProperty("viewingDirection"):this.options.resource.getViewingDirection?this.options.resource.getViewingDirection():null},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t.prototype.isCanvasIndexOutOfRange=function(e){return e>this.getTotalCanvases()-1},t.prototype.isFirstCanvas=function(e){return 0===e},t.prototype.isLastCanvas=function(e){return e===this.getTotalCanvases()-1},t.prototype.isMultiCanvas=function(){return this.getTotalCanvases()>1},t.prototype.isPagingEnabled=function(){var e=this.getViewingHint();return!!e&&e===s.ViewingHint.PAGED},t.prototype.isTotalCanvasesEven=function(){return this.getTotalCanvases()%2==0},t}(u),Y=function(){function e(){}return e.parse=function(e,t){return"string"==typeof e&&(e=JSON.parse(e)),this.parseJson(e,t)},e.parseJson=function(e,t){var n;if(t&&t.navDate&&!isNaN(t.navDate.getTime())&&(e.navDate=t.navDate.toString()),e["@type"])switch(e["@type"]){case"sc:Collection":n=this.parseCollection(e,t);break;case"sc:Manifest":n=this.parseManifest(e,t);break;default:return null}else switch(e.type){case"Collection":n=this.parseCollection(e,t);break;case"Manifest":n=this.parseManifest(e,t);break;default:return null}return n.isLoaded=!0,n},e.parseCollection=function(e,t){var n=new x(e,t);return t?(n.index=t.index||0,t.resource&&(n.parentCollection=t.resource.parentCollection)):n.index=0,this.parseCollections(n,t),this.parseManifests(n,t),this.parseItems(n,t),n},e.parseCollections=function(e,t){var n;if(e.__jsonld.collections?n=e.__jsonld.collections:e.__jsonld.items&&(n=e.__jsonld.items.filter(function(e){return"collection"===e.type.toLowerCase()})),n)for(var i=0;i<n.length;i++){t&&(t.index=i);var o=this.parseCollection(n[i],t);o.index=i,o.parentCollection=e,e.items.push(o)}},e.parseManifest=function(e,t){return new H(e,t)},e.parseManifests=function(e,t){var n;if(e.__jsonld.manifests?n=e.__jsonld.manifests:e.__jsonld.items&&(n=e.__jsonld.items.filter(function(e){return"manifest"===e.type.toLowerCase()})),n)for(var i=0;i<n.length;i++){var o=this.parseManifest(n[i],t);o.index=i,o.parentCollection=e,e.items.push(o)}},e.parseItem=function(e,t){if(e["@type"]){if("sc:manifest"===e["@type"].toLowerCase())return this.parseManifest(e,t);if("sc:collection"===e["@type"].toLowerCase())return this.parseCollection(e,t)}else if(e.type){if("manifest"===e.type.toLowerCase())return this.parseManifest(e,t);if("collection"===e.type.toLowerCase())return this.parseCollection(e,t)}return null},e.parseItems=function(e,t){var n=e.__jsonld.members||e.__jsonld.items;if(n)for(var i=function(i){t&&(t.index=i);var r=o.parseItem(n[i],t);return r?e.items.filter(function(e){return e.id===r.id})[0]?"continue":(r.index=i,r.parentCollection=e,void e.items.push(r)):{value:void 0}},o=this,r=0;r<n.length;r++){var s=i(r);if("object"==typeof s)return s.value}},e}(),Q=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),J=function(e){function t(t,n){return e.call(this,t,n)||this}return Q(t,e),t.prototype.getProfile=function(){var e=this.getProperty("profile");return e||(e=this.getProperty("dcterms:conformsTo")),Array.isArray(e)?e[0]:e},t.prototype.getConfirmLabel=function(){return $.getLocalisedValue(this.getProperty("confirmLabel"),this.options.locale)},t.prototype.getDescription=function(){return $.getLocalisedValue(this.getProperty("description"),this.options.locale)},t.prototype.getFailureDescription=function(){return $.getLocalisedValue(this.getProperty("failureDescription"),this.options.locale)},t.prototype.getFailureHeader=function(){return $.getLocalisedValue(this.getProperty("failureHeader"),this.options.locale)},t.prototype.getHeader=function(){return $.getLocalisedValue(this.getProperty("header"),this.options.locale)},t.prototype.getServiceLabel=function(){return $.getLocalisedValue(this.getProperty("label"),this.options.locale)},t.prototype.getInfoUri=function(){var e=this.id;return e.endsWith("/")||(e+="/"),e+="info.json"},t}(u),Z=function(e,t){this.width=e,this.height=t};!function(e){e[e.AUTHORIZATION_FAILED=1]="AUTHORIZATION_FAILED",e[e.FORBIDDEN=2]="FORBIDDEN",e[e.INTERNAL_SERVER_ERROR=3]="INTERNAL_SERVER_ERROR",e[e.RESTRICTED=4]="RESTRICTED"}(j||(j={}));var ee,te=function(e,t){this.data=t,this.index=t.index,this.width=e;var n=t.getHeight()/t.getWidth();this.height=n?Math.floor(this.width*n):e,this.uri=t.getCanonicalImageUri(e),this.label=t.getLabel().getValue()},ne=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),ie=function(e){function t(t,n){return e.call(this,t,n)||this}return ne(t,e),t}(c),oe=function(){function e(e,t){this.label=e,this.data=t||{},this.nodes=[]}return e.prototype.addNode=function(e){this.nodes.push(e),e.parentNode=this},e.prototype.isCollection=function(){return this.data.type===$.normaliseType(ee.COLLECTION)},e.prototype.isManifest=function(){return this.data.type===$.normaliseType(ee.MANIFEST)},e.prototype.isRange=function(){return this.data.type===$.normaliseType(ee.RANGE)},e}();!function(e){e.COLLECTION="collection",e.MANIFEST="manifest",e.RANGE="range"}(ee||(ee={})),n.d(t,"loadManifest",function(){return re}),n.d(t,"parseManifest",function(){return se}),n.d(t,"Utils",function(){return $}),n.d(t,"JSONLDResource",function(){return r}),n.d(t,"ManifestResource",function(){return u}),n.d(t,"Resource",function(){return c}),n.d(t,"IIIFResource",function(){
return p}),n.d(t,"Annotation",function(){return f}),n.d(t,"AnnotationBody",function(){return v}),n.d(t,"AnnotationList",function(){return m}),n.d(t,"AnnotationPage",function(){return y}),n.d(t,"Canvas",function(){return C}),n.d(t,"Collection",function(){return x}),n.d(t,"Duration",function(){return S}),n.d(t,"LabelValuePair",function(){return P}),n.d(t,"LanguageMap",function(){return L}),n.d(t,"LocalizedValue",function(){return V}),n.d(t,"PropertyValue",function(){return F}),n.d(t,"Manifest",function(){return H}),n.d(t,"ManifestType",function(){return o}),n.d(t,"Range",function(){return W}),n.d(t,"Rendering",function(){return q}),n.d(t,"Sequence",function(){return K}),n.d(t,"Deserialiser",function(){return Y}),n.d(t,"Service",function(){return J}),n.d(t,"Size",function(){return Z}),n.d(t,"StatusCode",function(){return j}),n.d(t,"Thumb",function(){return te}),n.d(t,"Thumbnail",function(){return ie}),n.d(t,"TreeNode",function(){return oe}),n.d(t,"TreeNodeType",function(){return ee});var re=function(e){return $.loadManifest(e)},se=function(e,t){return $.parseManifest(e,t)}},function(e,t,n){var i=n(10);e.exports=function(e){return(null==e?0:e.length)?i(e,1):[]}},function(e,t,n){var i=n(20).Symbol;e.exports=i},function(e,t,n){var i=n(10),o=1/0;e.exports=function(e){return(null==e?0:e.length)?i(e,o):[]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){this.isVisible=!0;var t=e.on.match(/.*xywh=(\d*),(\d*),(\d*),(\d*)/);this.x=Number(t[1]),this.y=Number(t[2]),this.width=Number(t[3]),this.height=Number(t[4]),this.chars=e.resource.chars};t.AnnotationRect=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),o=n(0),r=n(2),s=function(){function e(e){this._options=e,this._options.locale=this._options.locale||"en-GB"}return e.prototype.bootstrap=function(e,t){var n=this;return new Promise(function(i,o){e&&t&&(i=e,o=t),r.Utils.loadManifest(n._options.manifestUri).then(function(e){n._loaded(n,e,i,o)})})},e.prototype._loaded=function(e,t,n,s){var a=r.Utils.parseManifest(t,{locale:e._options.locale});if(a){e._options.iiifResource||(e._options.iiifResource=a);var u=e._options.collectionIndex,l=e._options.manifestIndex;if(a.getIIIFResourceType()===o.IIIFResourceType.COLLECTION){var c=a.getManifests(),h=a.getCollections();c.length||void 0!==u||(u=0),void 0!==u&&h&&h.length?a.getCollectionByIndex(u).then(function(t){t||s("Collection index not found"),0===t.getTotalManifests()&&0===l&&t.getTotalCollections()>0?(e._options.collectionIndex=0,e._options.manifestUri=t.id,e.bootstrap(n,s)):void 0!==l&&t.getManifestByIndex(l).then(function(t){e._options.manifest=t;var o=new i.Helper(e._options);n(o)})}):a.getManifestByIndex(e._options.manifestIndex).then(function(t){e._options.manifest=t;var o=new i.Helper(e._options);n(o)})}else{e._options.manifest=a;var p=new i.Helper(e._options);n(p)}}else console.error("Unable to load IIIF resource")},e}();t.Bootstrapper=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),o=n(13),r=n(14),s=n(0),a=n(30),u=n(2),l=function(){function e(e){this.options=e,this.iiifResource=this.options.iiifResource,this.manifestUri=this.options.manifestUri,this.manifest=this.options.manifest,this.collectionIndex=this.options.collectionIndex||0,this.manifestIndex=this.options.manifestIndex||0,this.sequenceIndex=this.options.sequenceIndex||0,this.canvasIndex=this.options.canvasIndex||0}return e.prototype.getAutoCompleteService=function(){var e=this.getSearchService(),t=null;return e&&((t=e.getService(s.ServiceProfile.SEARCH_0_AUTO_COMPLETE))||(t=e.getService(s.ServiceProfile.SEARCH_1_AUTO_COMPLETE))),t},e.prototype.getAttribution=function(){if(!this.manifest)throw new Error(a.Errors.manifestNotLoaded);var e=this.manifest.getAttribution();return e?e.getValue(this.options.locale):null},e.prototype.getCanvases=function(){return this.getCurrentSequence().getCanvases()},e.prototype.getCanvasById=function(e){return this.getCurrentSequence().getCanvasById(e)},e.prototype.getCanvasesById=function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n],o=this.getCanvasById(i);o&&t.push(o)}return t},e.prototype.getCanvasByIndex=function(e){return this.getCurrentSequence().getCanvasByIndex(e)},e.prototype.getCanvasIndexById=function(e){return this.getCurrentSequence().getCanvasIndexById(e)},e.prototype.getCanvasIndexByLabel=function(e){var t=this.getManifestType()===u.ManifestType.MANUSCRIPT;return this.getCurrentSequence().getCanvasIndexByLabel(e,t)},e.prototype.getCanvasRange=function(e,t){var n=this.getCanvasRanges(e);if(t){for(var i=0;i<n.length;i++){var o=n[i];if(o.path===t)return o}return null}return n[0]},e.prototype.getCanvasRanges=function(e){if(!this.manifest)throw new Error(a.Errors.manifestNotLoaded);return e.ranges?e.ranges:(e.ranges=this.manifest.getAllRanges().filter(function(t){return t.getCanvasIds().some(function(t){return u.Utils.normaliseUrl(t)===u.Utils.normaliseUrl(e.id)})}),e.ranges)},e.prototype.getCollectionIndex=function(e){return(!e.parentCollection||e.parentCollection.parentCollection)&&e.parentCollection?e.parentCollection.index:void 0},e.prototype.getCurrentCanvas=function(){return this.getCurrentSequence().getCanvasByIndex(this.canvasIndex)},e.prototype.getCurrentSequence=function(){return this.getSequenceByIndex(this.sequenceIndex)},e.prototype.getDescription=function(){if(!this.manifest)throw new Error(a.Errors.manifestNotLoaded);var e=this.manifest.getDescription();return e?e.getValue(this.options.locale):null},e.prototype.getLabel=function(){if(!this.manifest)throw new Error(a.Errors.manifestNotLoaded);var e=this.manifest.getLabel();return e?e.getValue(this.options.locale):null},e.prototype.getLastCanvasLabel=function(e){return this.getCurrentSequence().getLastCanvasLabel(e)},e.prototype.getFirstPageIndex=function(){return 0},e.prototype.getLastPageIndex=function(){return this.getTotalCanvases()-1},e.prototype.getLicense=function(){if(!this.manifest)throw new Error(a.Errors.manifestNotLoaded);return this.manifest.getLicense()},e.prototype.getLogo=function(){if(!this.manifest)throw new Error(a.Errors.manifestNotLoaded);return this.manifest.getLogo()},e.prototype.getManifestType=function(){if(!this.manifest)throw new Error(a.Errors.manifestNotLoaded);var e=this.manifest.getManifestType();return e===u.ManifestType.EMPTY&&(e=u.ManifestType.MONOGRAPH),e},e.prototype.getMetadata=function(e){if(!this.manifest)throw new Error(a.Errors.manifestNotLoaded);var t=[],n=this.manifest.getMetadata(),i=new o.MetadataGroup(this.manifest),r=this.options.locale;n&&n.length&&i.addMetadata(n,!0),this.manifest.getDescription().length&&((c=new u.LabelValuePair(r)).label=new u.PropertyValue([new u.LocalizedValue("description",r)]),c.value=this.manifest.getDescription(),c.isRootLevel=!0,i.addItem(c)),this.manifest.getAttribution().length&&((c=new u.LabelValuePair(r)).label=new u.PropertyValue([new u.LocalizedValue("attribution",r)]),c.value=this.manifest.getAttribution(),c.isRootLevel=!0,i.addItem(c));var s=this.manifest.getLicense();if(s){var l={label:"license",value:e&&e.licenseFormatter?e.licenseFormatter.format(s):s};(c=new u.LabelValuePair(r)).parse(l),c.isRootLevel=!0,i.addItem(c)}if(this.manifest.getLogo()){var c;l={label:"logo",value:'<img alt="logo" src="'+this.manifest.getLogo()+'"/>'},(c=new u.LabelValuePair(r)).parse(l),c.isRootLevel=!0,i.addItem(c)}return t.push(i),e?this._parseMetadataOptions(e,t):t},e.prototype.getRequiredStatement=function(){if(!this.manifest)throw new Error(a.Errors.manifestNotLoaded);var e=this.manifest.getRequiredStatement();return e?{label:e.label?e.getLabel():"",value:e.value&&e.value.length?e.getValue():""}:null},e.prototype._parseMetadataOptions=function(e,t){var n=this.getCurrentSequence(),i=n.getMetadata();if(i&&i.length){var r=new o.MetadataGroup(n);r.addMetadata(i),t.push(r)}if(e.range){var s=this._getRangeMetadata([],e.range);s=s.reverse(),t=t.concat(s)}if(e.canvases&&e.canvases.length)for(var a=0;a<e.canvases.length;a++){var u=e.canvases[a],l=u.getMetadata();if(l&&l.length){var c=new o.MetadataGroup(u);c.addMetadata(u.getMetadata()),t.push(c)}for(var h=u.getImages(),p=0;p<h.length;p++){var d=h[p],f=d.getMetadata();if(f&&f.length){var g=new o.MetadataGroup(d);g.addMetadata(f),t.push(g)}}}return t},e.prototype._getRangeMetadata=function(e,t){var n=t.getMetadata();if(n&&n.length){var i=new o.MetadataGroup(t);i.addMetadata(n),e.push(i)}else if(t.parentRange)return this._getRangeMetadata(e,t.parentRange);return e},e.prototype.getMultiSelectState=function(){return this._multiSelectState||(this._multiSelectState=new i.MultiSelectState,this._multiSelectState.ranges=this.getRanges().slice(0),this._multiSelectState.canvases=this.getCurrentSequence().getCanvases().slice(0)),this._multiSelectState},e.prototype.getCurrentRange=function(){return this.rangeId?this.getRangeById(this.rangeId):null},e.prototype.getPosterCanvas=function(){if(!this.manifest)throw new Error(a.Errors.manifestNotLoaded);return this.manifest.getPosterCanvas()},e.prototype.getAccompanyingCanvas=function(){if(!this.manifest)throw new Error(a.Errors.manifestNotLoaded);return this.manifest.getAccompanyingCanvas()},e.prototype.getPosterImage=function(){var e=this.getPosterCanvas();if(e){var t=e.getContent();if(t&&t.length)return t[0].getBody()[0].id}return null},e.prototype.getAccompanyingCanvasImage=function(){var e=this.getAccompanyingCanvas();if(e){var t=e.getContent();if(t&&t.length)return t[0].getBody()[0].id}return null},e.prototype.getPreviousRange=function(e){var t=null;if(t=e||this.getCurrentRange()){var n=this.getFlattenedTree();if(n)for(var i=0;i<n.length;i++){var o=n[i];if(o&&o.data.id===t.id){for(;i>0;)return n[--i].data;break}}}return null},e.prototype.getNextRange=function(e){var t=null;if(t=e||this.getCurrentRange()){var n=this.getFlattenedTree();if(n)for(var i=0;i<n.length;i++){var o=n[i];if(o&&o.data.id===t.id){for(;i<n.length-1;){var r=n[++i];if(r.data.canvases&&r.data.canvases.length)return r.data}break}}}return null},e.prototype.getFlattenedTree=function(e){var t=null;return(t=e||this.getTree())?this._flattenTree(t,"nodes"):null},e.prototype._flattenTree=function(e,t){var n=this,i=[e];return e[t]&&e[t].length>0?i.concat(e[t].map(function(e){return n._flattenTree(e,t)}).reduce(function(e,t){return e.concat(t)},[])):i},e.prototype.getRanges=function(){return this.manifest.getAllRanges()},e.prototype.getRangeByPath=function(e){if(!this.manifest)throw new Error(a.Errors.manifestNotLoaded);return this.manifest.getRangeByPath(e)},e.prototype.getRangeById=function(e){if(!this.manifest)throw new Error(a.Errors.manifestNotLoaded);return this.manifest.getRangeById(e)},e.prototype.getRangeCanvases=function(e){var t=e.getCanvasIds();return this.getCanvasesById(t)},e.prototype.getRelated=function(){if(!this.manifest)throw new Error(a.Errors.manifestNotLoaded);return this.manifest.getRelated()},e.prototype.getSearchService=function(){if(!this.manifest)throw new Error(a.Errors.manifestNotLoaded);var e=this.manifest.getService(s.ServiceProfile.SEARCH_0);return e||(e=this.manifest.getService(s.ServiceProfile.SEARCH_1)),e},e.prototype.getSeeAlso=function(){if(!this.manifest)throw new Error(a.Errors.manifestNotLoaded);return this.manifest.getSeeAlso()},e.prototype.getSequenceByIndex=function(e){if(!this.manifest)throw new Error(a.Errors.manifestNotLoaded);return this.manifest.getSequenceByIndex(e)},e.prototype.getShareServiceUrl=function(){if(!this.manifest)throw new Error(a.Errors.manifestNotLoaded);var e=null,t=this.manifest.getService(s.ServiceProfile.SHARE_EXTENSIONS);return t&&(t.length&&(t=t[0]),e=t.__jsonld.shareUrl),e},e.prototype._getSortedTreeNodesByDate=function(e,t){var n=this.getFlattenedTree(t);if(n){var i=n.filter(function(e){return e.data.type===u.TreeNodeType.MANIFEST});this.createDecadeNodes(e,n),this.sortDecadeNodes(e),this.createYearNodes(e,n),this.sortYearNodes(e),this.createMonthNodes(e,i),this.sortMonthNodes(e),this.createDateNodes(e,i),this.pruneDecadeNodes(e)}},e.prototype.getStartCanvasIndex=function(){return this.getCurrentSequence().getStartCanvasIndex()},e.prototype.getThumbs=function(e,t){return this.getCurrentSequence().getThumbs(e,t)},e.prototype.getTopRanges=function(){if(!this.manifest)throw new Error(a.Errors.manifestNotLoaded);return this.manifest.getTopRanges()},e.prototype.getTotalCanvases=function(){return this.getCurrentSequence().getTotalCanvases()},e.prototype.getTrackingLabel=function(){if(!this.manifest)throw new Error(a.Errors.manifestNotLoaded);return this.manifest.getTrackingLabel()},e.prototype._getTopRanges=function(){return this.iiifResource.getTopRanges()},e.prototype.getTree=function(e,t){if(void 0===e&&(e=0),void 0===t&&(t=r.TreeSortType.NONE),!this.iiifResource)return null;var n;if(this.iiifResource.isCollection())n=this.iiifResource.getDefaultTree();else{var i=this._getTopRanges(),o=new u.TreeNode;if(o.label="root",o.data=this.iiifResource,!i.length)return o;n=i[e].getTree(o)}var s=new u.TreeNode;switch(t.toString()){case r.TreeSortType.DATE.toString():if(this.treeHasNavDates(n))return this._getSortedTreeNodesByDate(s,n),s}return n},e.prototype.treeHasNavDates=function(e){var t=this.getFlattenedTree(e);return!!t&&t.some(function(e){return!isNaN(e.navDate)})},e.prototype.getViewingDirection=function(){if(!this.manifest)throw new Error(a.Errors.manifestNotLoaded);var e=this.getCurrentSequence().getViewingDirection();return e||(e=this.manifest.getViewingDirection()),e},e.prototype.getViewingHint=function(){if(!this.manifest)throw new Error(a.Errors.manifestNotLoaded);var e=this.getCurrentSequence().getViewingHint();return e||(e=this.manifest.getViewingHint()),e},e.prototype.hasParentCollection=function(){if(!this.manifest)throw new Error(a.Errors.manifestNotLoaded);return!!this.manifest.parentCollection},e.prototype.hasRelatedPage=function(){var e=this.getRelated();return!!e&&(e.length&&(e=e[0]),"text/html"===e.format)},e.prototype.hasResources=function(){return this.getCurrentCanvas().getResources().length>0},e.prototype.isBottomToTop=function(){var e=this.getViewingDirection();return!!e&&e===s.ViewingDirection.BOTTOM_TO_TOP},e.prototype.isCanvasIndexOutOfRange=function(e){return this.getCurrentSequence().isCanvasIndexOutOfRange(e)},e.prototype.isContinuous=function(){var e=this.getViewingHint();return!!e&&e===s.ViewingHint.CONTINUOUS},e.prototype.isFirstCanvas=function(e){return void 0!==e?this.getCurrentSequence().isFirstCanvas(e):this.getCurrentSequence().isFirstCanvas(this.canvasIndex)},e.prototype.isHorizontallyAligned=function(){return this.isLeftToRight()||this.isRightToLeft()},e.prototype.isLastCanvas=function(e){return void 0!==e?this.getCurrentSequence().isLastCanvas(e):this.getCurrentSequence().isLastCanvas(this.canvasIndex)},e.prototype.isLeftToRight=function(){var e=this.getViewingDirection();return!!e&&e===s.ViewingDirection.LEFT_TO_RIGHT},e.prototype.isMultiCanvas=function(){return this.getCurrentSequence().isMultiCanvas()},e.prototype.isMultiSequence=function(){if(!this.manifest)throw new Error(a.Errors.manifestNotLoaded);return this.manifest.isMultiSequence()},e.prototype.isPaged=function(){if(!this.manifest)throw new Error(a.Errors.manifestNotLoaded);var e=this.getViewingHint();return e?e===s.ViewingHint.PAGED:this.manifest.isPagingEnabled()},e.prototype.isPagingAvailable=function(){return this.isPagingEnabled()&&this.getTotalCanvases()>2},e.prototype.isPagingEnabled=function(){if(!this.manifest)throw new Error(a.Errors.manifestNotLoaded);return this.manifest.isPagingEnabled()||this.getCurrentSequence().isPagingEnabled()},e.prototype.isRightToLeft=function(){var e=this.getViewingDirection();return!!e&&e===s.ViewingDirection.RIGHT_TO_LEFT},e.prototype.isTopToBottom=function(){var e=this.getViewingDirection();return!!e&&e===s.ViewingDirection.TOP_TO_BOTTOM},e.prototype.isTotalCanvasesEven=function(){return this.getCurrentSequence().isTotalCanvasesEven()},e.prototype.isUIEnabled=function(e){if(!this.manifest)throw new Error(a.Errors.manifestNotLoaded);var t=this.manifest.getService(s.ServiceProfile.UI_EXTENSIONS);if(t){var n=t.getProperty("disableUI");if(n&&(-1!==n.indexOf(e)||-1!==n.indexOf(e.toLowerCase())))return!1}return!0},e.prototype.isVerticallyAligned=function(){return this.isTopToBottom()||this.isBottomToTop()},e.prototype.createDateNodes=function(e,t){for(var n=0;n<t.length;n++){var i=t[n],o=this.getNodeYear(i),r=this.getNodeMonth(i),s=new u.TreeNode;s.id=i.id,s.label=this.getNodeDisplayDate(i),s.data=i.data,s.data.type=u.TreeNodeType.MANIFEST,s.data.year=o,s.data.month=r;var a=this.getDecadeNode(e,o);if(a){var l=this.getYearNode(a,o);if(l){var c=this.getMonthNode(l,r);c&&c.addNode(s)}}}},e.prototype.createDecadeNodes=function(e,t){for(var n=0;n<t.length;n++){var i=t[n];if(i.navDate){var o=this.getNodeYear(i),r=Number(o.toString().substr(0,3)+"9");if(!this.getDecadeNode(e,o)){var s=new u.TreeNode;s.label=o+" - "+r,s.navDate=i.navDate,s.data.startYear=o,s.data.endYear=r,e.addNode(s)}}}},e.prototype.createMonthNodes=function(e,t){for(var n=0;n<t.length;n++){var i=t[n];if(i.navDate){var o=this.getNodeYear(i),r=this.getNodeMonth(i),s=this.getDecadeNode(e,o),a=null;if(s&&(a=this.getYearNode(s,o)),s&&a&&!this.getMonthNode(a,r)){var l=new u.TreeNode;l.label=this.getNodeDisplayMonth(i),l.navDate=i.navDate,l.data.year=o,l.data.month=r,a.addNode(l)}}}},e.prototype.createYearNodes=function(e,t){for(var n=0;n<t.length;n++){var i=t[n];if(i.navDate){var o=this.getNodeYear(i),r=this.getDecadeNode(e,o);if(r&&!this.getYearNode(r,o)){var s=new u.TreeNode;s.label=o.toString(),s.navDate=i.navDate,s.data.year=o,r.addNode(s)}}}},e.prototype.getDecadeNode=function(e,t){for(var n=0;n<e.nodes.length;n++){var i=e.nodes[n];if(t>=i.data.startYear&&t<=i.data.endYear)return i}return null},e.prototype.getMonthNode=function(e,t){for(var n=0;n<e.nodes.length;n++){var i=e.nodes[n];if(t===this.getNodeMonth(i))return i}return null},e.prototype.getNodeDisplayDate=function(e){return e.navDate.toDateString()},e.prototype.getNodeDisplayMonth=function(e){return["January","February","March","April","May","June","July","August","September","October","November","December"][e.navDate.getMonth()]},e.prototype.getNodeMonth=function(e){return e.navDate.getMonth()},e.prototype.getNodeYear=function(e){return e.navDate.getFullYear()},e.prototype.getYearNode=function(e,t){for(var n=0;n<e.nodes.length;n++){var i=e.nodes[n];if(t===this.getNodeYear(i))return i}return null},e.prototype.pruneDecadeNodes=function(e){for(var t=[],n=0;n<e.nodes.length;n++){var i=e.nodes[n];i.nodes.length||t.push(i)}for(var o=0;o<t.length;o++){var r=t[o],s=e.nodes.indexOf(r);s>-1&&e.nodes.splice(s,1)}},e.prototype.sortDecadeNodes=function(e){e.nodes=e.nodes.sort(function(e,t){return e.data.startYear-t.data.startYear})},e.prototype.sortMonthNodes=function(e){for(var t=this,n=0;n<e.nodes.length;n++)for(var i=e.nodes[n],o=0;o<i.nodes.length;o++){var r=i.nodes[o];r.nodes=r.nodes.sort(function(e,n){return t.getNodeMonth(e)-t.getNodeMonth(n)})}},e.prototype.sortYearNodes=function(e){for(var t=this,n=0;n<e.nodes.length;n++){var i=e.nodes[n];i.nodes=i.nodes.sort(function(e,n){return t.getNodeYear(e)-t.getNodeYear(n)})}},e}();t.Helper=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),o=function(){function e(){this.isEnabled=!1,this.ranges=[],this.canvases=[]}return e.prototype.allCanvasesSelected=function(){return this.canvases.length>0&&this.getAllSelectedCanvases().length===this.canvases.length},e.prototype.allRangesSelected=function(){return this.ranges.length>0&&this.getAllSelectedRanges().length===this.ranges.length},e.prototype.allSelected=function(){return this.allRangesSelected()&&this.allCanvasesSelected()},e.prototype.getAll=function(){return this.canvases.concat(this.ranges)},e.prototype.getAllSelectedCanvases=function(){return this.canvases.filter(function(e){return e.multiSelected})},e.prototype.getAllSelectedRanges=function(){return this.ranges.filter(function(e){return e.multiSelected})},e.prototype.getCanvasById=function(e){return this.canvases.filter(function(t){return i.Utils.normaliseUrl(t.id)===i.Utils.normaliseUrl(e)})[0]},e.prototype.getCanvasesByIds=function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];t.push(this.getCanvasById(i))}return t},e.prototype.getRangeCanvases=function(e){var t=e.getCanvasIds();return this.getCanvasesByIds(t)},e.prototype.selectAll=function(e){this.selectRanges(this.ranges,e),this.selectCanvases(this.canvases,e)},e.prototype.selectCanvas=function(e,t){this.canvases.filter(function(t){return t.id===e.id})[0].multiSelected=t},e.prototype.selectAllCanvases=function(e){this.selectCanvases(this.canvases,e)},e.prototype.selectCanvases=function(e,t){for(var n=0;n<e.length;n++)e[n].multiSelected=t},e.prototype.selectRange=function(e,t){var n=this.ranges.filter(function(t){return t.id===e.id})[0];n.multiSelected=t;var i=this.getRangeCanvases(n);this.selectCanvases(i,t)},e.prototype.selectAllRanges=function(e){this.selectRanges(this.ranges,e)},e.prototype.selectRanges=function(e,t){for(var n=0;n<e.length;n++){var i=e[n];i.multiSelected=t;var o=this.getCanvasesByIds(i.getCanvasIds());this.selectCanvases(o,t)}},e.prototype.setEnabled=function(e){this.isEnabled=e;for(var t=this.getAll(),n=0;n<t.length;n++){var i=t[n];i.multiSelectEnabled=this.isEnabled,e||(i.multiSelected=!1)}},e}();t.MultiSelectState=o},function(e,t,n){var i=n(18),o=n(19);e.exports=function r(e,t,n,s,a){var u=-1,l=e.length;for(n||(n=o),a||(a=[]);++u<l;){var c=e[u];t>0&&n(c)?t>1?r(c,t-1,n,s,a):i(a,c):s||(a[a.length]=c)}return a}},function(e,t){e.exports=function(e){return null!=e&&"object"==typeof e}},function(e,t,n){"use strict";n.r(t),t["default"]=function(e,t){return t=t||{},new Promise(function(n,i){var o=new XMLHttpRequest,r=[],s=[],a={},u=function(){return{ok:2==(o.status/100|0),statusText:o.statusText,status:o.status,url:o.responseURL,text:function(){return Promise.resolve(o.responseText)},json:function(){return Promise.resolve(o.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([o.response]))},clone:u,headers:{keys:function(){return r},entries:function(){return s},get:function(e){return a[e.toLowerCase()]},has:function(e){return e.toLowerCase()in a}}}};for(var l in o.open(t.method||"get",e,!0),o.onload=function(){o.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(e,t,n){r.push(t=t.toLowerCase()),s.push([t,n]),a[t]=a[t]?a[t]+","+n:n}),n(u())},o.onerror=i,o.withCredentials="include"==t.credentials,t.headers)o.setRequestHeader(l,t.headers[l]);o.send(t.body||null)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.items=[],this.resource=e,this.label=t}return e.prototype.addItem=function(e){this.items.push(e)},e.prototype.addMetadata=function(e,t){void 0===t&&(t=!1);for(var n=0;n<e.length;n++){var i=e[n];i.isRootLevel=t,this.addItem(i)}},e}();t.MetadataGroup=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.DATE="date",e.NONE="none"}(t.TreeSortType||(t.TreeSortType={}))},function(e,t,n){e.exports=n(16)},function(e,t,n){"use strict";function i(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),i(n(17)),i(n(6)),i(n(7)),i(n(31)),i(n(8)),i(n(33)),i(n(13)),i(n(34)),i(n(9)),i(n(35)),i(n(14)),i(n(36));var o=n(7);t.loadManifest=function(e){return new o.Bootstrapper(e).bootstrap()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),o=function(){function e(e,t){this.rects=[],this.canvasIndex=t,this.addRect(e)}return e.prototype.addRect=function(e){var t=new i.AnnotationRect(e);t.canvasIndex=this.canvasIndex,t.index=this.rects.length,this.rects.push(t),this.rects.sort(function(e,t){return e.index-t.index})},e}();t.AnnotationGroup=o},function(e,t){e.exports=function(e,t){for(var n=-1,i=t.length,o=e.length;++n<i;)e[o+n]=t[n];return e}},function(e,t,n){var i=n(4),o=n(23),r=n(28),s=i?i.isConcatSpreadable:void 0;e.exports=function(e){return r(e)||o(e)||!!(s&&e&&e[s])}},function(e,t,n){var i=n(21),o="object"==typeof self&&self&&self.Object===Object&&self,r=i||o||Function("return this")();e.exports=r},function(e,t,n){(function(t){var n="object"==typeof t&&t&&t.Object===Object&&t;e.exports=n}).call(this,n(22))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var i=n(24),o=n(11),r=Object.prototype,s=r.hasOwnProperty,a=r.propertyIsEnumerable,u=i(function(){return arguments}())?i:function(e){return o(e)&&s.call(e,"callee")&&!a.call(e,"callee")};e.exports=u},function(e,t,n){var i=n(25),o=n(11),r="[object Arguments]";e.exports=function(e){return o(e)&&i(e)==r}},function(e,t,n){var i=n(4),o=n(26),r=n(27),s="[object Null]",a="[object Undefined]",u=i?i.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?a:s:u&&u in Object(e)?o(e):r(e)}},function(e,t,n){var i=n(4),o=Object.prototype,r=o.hasOwnProperty,s=o.toString,a=i?i.toStringTag:void 0;e.exports=function(e){var t=r.call(e,a),n=e[a];try{e[a]=void 0;var i=!0}catch(e){}var o=s.call(e);return i&&(t?e[a]=n:delete e[a]),o}},function(e,t){var n=Object.prototype.toString;e.exports=function(e){return n.call(e)}},function(e,t){var n=Array.isArray;e.exports=n},function(e,t,n){e.exports=self.fetch||(self.fetch=n(12)["default"]||n(12))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.manifestNotLoaded="Manifest has not loaded yet",e}();t.Errors=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=n(32),r=n(2),s=function(){function e(e,t){this.authHoldingPage=null,this.clickThroughService=null,this.externalService=null,this.isProbed=!1,this.isResponseHandled=!1,this.kioskService=null,this.loginService=null,this.logoutService=null,this.probeService=null,this.restrictedService=null,this.tokenService=null,e.externalResource=this,this.dataUri=this._getDataUri(e),this.index=e.index,this.authAPIVersion=t.authApiVersion,this._parseAuthServices(e),this._parseCanvasDimensions(e)}return e.prototype._getImageServiceDescriptor=function(e){for(var t=null,n=0;n<e.length;n++){var i=e[n],o=i.id;o.endsWith("/")||(o+="/"),r.Utils.isImageProfile(i.getProfile())&&(t=o+"info.json")}return t},e.prototype._getDataUri=function(e){var t=e.getContent(),n=e.getImages(),o=null;if(t&&t.length){var r=t[0].getBody();return r.length?(s=r[0].getServices()).length&&(o=this._getImageServiceDescriptor(s))?o:r[0].id:null}if(n&&n.length){var s,a=n[0].getResource();return(s=a.getServices()).length&&(o=this._getImageServiceDescriptor(s))?o:a.id}var u=e.getService(i.ServiceProfile.IXIF);return u?u.getInfoUri():e.id},e.prototype._parseAuthServices=function(e){if(.9===this.authAPIVersion)this.clickThroughService=r.Utils.getService(e,i.ServiceProfile.AUTH_0_CLICK_THROUGH),this.loginService=r.Utils.getService(e,i.ServiceProfile.AUTH_0_LOGIN),this.restrictedService=r.Utils.getService(e,i.ServiceProfile.AUTH_0_RESTRICTED),this.clickThroughService?(this.logoutService=this.clickThroughService.getService(i.ServiceProfile.AUTH_0_LOGOUT),this.tokenService=this.clickThroughService.getService(i.ServiceProfile.AUTH_0_TOKEN)):this.loginService?(this.logoutService=this.loginService.getService(i.ServiceProfile.AUTH_0_LOGOUT),this.tokenService=this.loginService.getService(i.ServiceProfile.AUTH_0_TOKEN)):this.restrictedService&&(this.logoutService=this.restrictedService.getService(i.ServiceProfile.AUTH_0_LOGOUT),this.tokenService=this.restrictedService.getService(i.ServiceProfile.AUTH_0_TOKEN));else{if(void 0!==e.isCanvas&&e.isCanvas()){var t=e.getContent();if(t&&t.length){var n=t[0].getBody();n&&n.length&&(e=n[0])}}this.clickThroughService=r.Utils.getService(e,i.ServiceProfile.AUTH_1_CLICK_THROUGH),this.loginService=r.Utils.getService(e,i.ServiceProfile.AUTH_1_LOGIN),this.externalService=r.Utils.getService(e,i.ServiceProfile.AUTH_1_EXTERNAL),this.kioskService=r.Utils.getService(e,i.ServiceProfile.AUTH_1_KIOSK),this.clickThroughService?(this.logoutService=this.clickThroughService.getService(i.ServiceProfile.AUTH_1_LOGOUT),this.tokenService=this.clickThroughService.getService(i.ServiceProfile.AUTH_1_TOKEN),this.probeService=this.clickThroughService.getService(i.ServiceProfile.AUTH_1_PROBE)):this.loginService?(this.logoutService=this.loginService.getService(i.ServiceProfile.AUTH_1_LOGOUT),this.tokenService=this.loginService.getService(i.ServiceProfile.AUTH_1_TOKEN),this.probeService=this.loginService.getService(i.ServiceProfile.AUTH_1_PROBE)):this.externalService?(this.logoutService=this.externalService.getService(i.ServiceProfile.AUTH_1_LOGOUT),this.tokenService=this.externalService.getService(i.ServiceProfile.AUTH_1_TOKEN),this.probeService=this.externalService.getService(i.ServiceProfile.AUTH_1_PROBE)):this.kioskService&&(this.logoutService=this.kioskService.getService(i.ServiceProfile.AUTH_1_LOGOUT),this.tokenService=this.kioskService.getService(i.ServiceProfile.AUTH_1_TOKEN),this.probeService=this.kioskService.getService(i.ServiceProfile.AUTH_1_PROBE))}},e.prototype._parseCanvasDimensions=function(e){var t=e.getImages();if(t&&t.length){var n=t[0].getResource();this.width=n.getWidth(),this.height=n.getHeight()}else if((t=e.getContent()).length){var i=t[0].getBody();i.length&&(this.width=i[0].getWidth(),this.height=i[0].getHeight())}},e.prototype._parseDescriptorDimensions=function(e){void 0!==e.width&&(this.width=e.width),void 0!==e.height&&(this.height=e.height)},e.prototype.isAccessControlled=function(){return!!(this.clickThroughService||this.loginService||this.externalService||this.kioskService||this.probeService)},e.prototype.hasServiceDescriptor=function(){return!!this.dataUri&&this.dataUri.endsWith("info.json")},e.prototype.getData=function(e){var t=this;return t.data={},new Promise(function(n,i){if(t.dataUri)if(t.probeService){t.isProbed=!0;var r=new XMLHttpRequest;r.open("GET",t.probeService.id,!0),r.withCredentials=!0,r.onload=function(){var e=JSON.parse(r.responseText);unescape(e.contentLocation)!==t.dataUri?t.status=o.MOVED_TEMPORARILY:t.status=o.OK,n(t)},r.onerror=function(){t.status=r.status,n(t)},r.send()}else{var s="GET";if(!t.hasServiceDescriptor()){if(!t.isAccessControlled())return t.status=o.OK,void n(t);s="HEAD"}var a=new XMLHttpRequest;a.open(s,t.dataUri,!0),e&&a.setRequestHeader("Authorization","Bearer "+e.accessToken),a.onload=function(){if(a.responseText){var e=JSON.parse(a.responseText),i=unescape(e["@id"]);t.data=e,t._parseAuthServices(t.data),t._parseDescriptorDimensions(t.data),i.endsWith("/info.json")&&(i=i.substr(0,i.lastIndexOf("/")));var r=t.dataUri;r&&r.endsWith("/info.json")&&(r=r.substr(0,r.lastIndexOf("/"))),i!==r&&t.loginService?t.status=o.MOVED_TEMPORARILY:t.status=o.OK,n(t)}else t.status=o.OK,n(t)},a.onerror=function(){t.status=a.status,a.responseText&&t._parseAuthServices(JSON.parse(a.responseText)),n(t)},a.send()}else i("There is no dataUri to fetch")})},e}();t.ExternalResource=s},function(e,t,n){window,e.exports=function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:i})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(t.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)t.d(i,o,function(t){return e[t]}.bind(null,o));return i},t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t);
},t.p="",t(t.s=0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONTINUE=100,t.SWITCHING_PROTOCOLS=101,t.PROCESSING=102,t.OK=200,t.CREATED=201,t.ACCEPTED=202,t.NON_AUTHORITATIVE_INFORMATION=203,t.NO_CONTENT=204,t.RESET_CONTENT=205,t.PARTIAL_CONTENT=206,t.MULTI_STATUS=207,t.MULTIPLE_CHOICES=300,t.MOVED_PERMANENTLY=301,t.MOVED_TEMPORARILY=302,t.SEE_OTHER=303,t.NOT_MODIFIED=304,t.USE_PROXY=305,t.TEMPORARY_REDIRECT=307,t.BAD_REQUEST=400,t.UNAUTHORIZED=401,t.PAYMENT_REQUIRED=402,t.FORBIDDEN=403,t.NOT_FOUND=404,t.METHOD_NOT_ALLOWED=405,t.NOT_ACCEPTABLE=406,t.PROXY_AUTHENTICATION_REQUIRED=407,t.REQUEST_TIME_OUT=408,t.CONFLICT=409,t.GONE=410,t.LENGTH_REQUIRED=411,t.PRECONDITION_FAILED=412,t.REQUEST_ENTITY_TOO_LARGE=413,t.REQUEST_URI_TOO_LARGE=414,t.UNSUPPORTED_MEDIA_TYPE=415,t.REQUESTED_RANGE_NOT_SATISFIABLE=416,t.EXPECTATION_FAILED=417,t.IM_A_TEAPOT=418,t.UNPROCESSABLE_ENTITY=422,t.LOCKED=423,t.FAILED_DEPENDENCY=424,t.UNORDERED_COLLECTION=425,t.UPGRADE_REQUIRED=426,t.PRECONDITION_REQUIRED=428,t.TOO_MANY_REQUESTS=429,t.REQUEST_HEADER_FIELDS_TOO_LARGE=431,t.INTERNAL_SERVER_ERROR=500,t.NOT_IMPLEMENTED=501,t.BAD_GATEWAY=502,t.SERVICE_UNAVAILABLE=503,t.GATEWAY_TIME_OUT=504,t.HTTP_VERSION_NOT_SUPPORTED=505,t.VARIANT_ALSO_NEGOTIATES=506,t.INSUFFICIENT_STORAGE=507,t.BANDWIDTH_LIMIT_EXCEEDED=509,t.NOT_EXTENDED=510,t.NETWORK_AUTHENTICATION_REQUIRED=511}])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){};t.ILabelValuePair=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){};t.MetadataOptions=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e,t){this.value=e,this.locale=t};t.Translation=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.labels=e}return e.prototype.format=function(e){return-1!=e.indexOf("<a")?e:'<a href="'+e+'">'+(this.labels[e]?this.labels[e]:e)+"</a>"},e}();t.UriLabeller=i}])}),define("lib/manifold.js",function(){});var Utils;!function(e){var t=function(){function e(){}return e.waitFor=function(t,n,i,o,r,s){o||(o=200),r||(r=100),s||(s=0),s+=1,s>r?i&&i():t()?n():setTimeout(function(){e.waitFor(t,n,i,o,r,s)},o)},e}();e.Async=t;var n=function(){function e(){}return e.getBool=function(e,t){return null===e||"undefined"==typeof e?t:e},e}();e.Bools=n;var i=function(){function e(){}return e.supportsCopy=function(){return document.queryCommandSupported&&document.queryCommandSupported("copy")},e.copy=function(t){t=e.convertBrToNewLine(t);var n=document.createElement("textarea");n.value=t,e.hideButKeepEnabled(n),document.body.appendChild(n),n.focus(),n.select(),document.execCommand("copy"),document.body.removeChild(n)},e.hideButKeepEnabled=function(e){e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="2em",e.style.height="2em",e.style.padding="0",e.style.border="none",e.style.outline="none",e.style.boxShadow="none",e.style.background="transparent"},e.convertBrToNewLine=function(e){var t=/<br\s*[\/]?>/gi;return e=e.replace(t,"\n")},e}();e.Clipboard=i;var o=function(){function e(){}return e.float32ColorToARGB=function(e){var t=(4278190080&e)>>>24,n=(16711680&e)>>>16,i=(65280&e)>>>8,o=255&e,r=[t,n,i,o];return r},e._componentToHex=function(e){var t=e.toString(16);return 1==t.length?"0"+t:t},e.rgbToHexString=function(t){return e.coalesce(t),"#"+e._componentToHex(t[0])+e._componentToHex(t[1])+e._componentToHex(t[2])},e.argbToHexString=function(t){return"#"+e._componentToHex(t[0])+e._componentToHex(t[1])+e._componentToHex(t[2])+e._componentToHex(t[3])},e.coalesce=function(e){for(var t=1;t<e.length;t++)"undefined"==typeof e[t]&&(e[t]=e[t-1])},e}();e.Colors=o;var r=function(){function e(){}return e.getTimeStamp=function(){return(new Date).getTime()},e}();e.Dates=r;var s=function(){function e(){}return e.getPixelRatio=function(e){var t=window.devicePixelRatio||1,n=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return t/n},e.isTouch=function(){return!!("ontouchstart"in window)||window.navigator.msMaxTouchPoints>0},e}();e.Device=s;var a=function(){function e(){}return e.isInIFrame=function(){try{return window.self!==window.top}catch(e){return!0}},e.supportsFullscreen=function(){var e=document.documentElement,t=e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullScreen||e.msRequestFullscreen;return void 0!==t},e.isHidden=function(){var t=e.getHiddenProp();return t?!0:!1},e.getHiddenProp=function(){var e=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var t=0;t<e.length;t++)if(e[t]+"Hidden"in document)return e[t]+"Hidden";return null},e}();e.Documents=a;var u=function(){function e(){}return e.debounce=function(e,t){return t=t||100,function(){if(!e.debouncing){var n=Array.prototype.slice.apply(arguments);e.lastReturnVal=e.apply(window,n),e.debouncing=!0}return clearTimeout(e.debounceTimeout),e.debounceTimeout=setTimeout(function(){e.debouncing=!1},t),e.lastReturnVal}},e}();e.Events=u;var l=function(){function e(){}return e.simplifyMimeType=function(e){switch(e){case"text/plain":return"txt";case"image/jpeg":return"jpg";case"application/msword":return"doc";case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":return"docx";default:var t=e.split("/");return t[t.length-1]}},e}();e.Files=l;var c=function(){function e(){}return e.getCharCode=function(e){var t="number"==typeof e.which?e.which:e.keyCode;return t},e}();e.Keyboard=c;var h=function(){function e(){}return e.normalise=function(e,t,n){return(e-t)/(n-t)},e.median=function(e){e.sort(function(e,t){return e-t});var t=Math.floor(e.length/2);return e.length%2?e[t]:(e[t-1]+e[t])/2},e.clamp=function(e,t,n){return Math.min(Math.max(e,t),n)},e}();e.Maths=h;var p=function(){function e(e,t){this.width=e,this.height=t}return e}();e.Size=p;var d=function(){function e(){}return e.fitRect=function(e,t,n,i){var o,r=t/e,s=i/n,a=0,u=0;return s>r?(o=n/e,a=e*o,u=t*o):(o=i/t,a=e*o,u=t*o),new p(Math.floor(a),Math.floor(u))},e.hitRect=function(e,t,n,i,o,r){return o>e&&e+n>o&&r>t&&t+i>r?!0:!1},e}();e.Dimensions=d;var f=function(){function e(){}return e.numericalInput=function(e){return 46==e.keyCode||8==e.keyCode||9==e.keyCode||27==e.keyCode||65==e.keyCode&&e.ctrlKey===!0||e.keyCode>=35&&e.keyCode<=39?!0:e.shiftKey||(e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)?(e.preventDefault(),!1):!0},e}();e.Numbers=f;var g=function(){function e(){}return e.toPlainObject=function(e){e=Object(e);var t={};for(var n in e)t[n]=e[n];return t},e}();e.Objects=g;var v=function(){function e(){}return e.clear=function(e){switch(void 0===e&&(e=m.memory),e.value){case m.memory.value:this._memoryStorage={};break;case m.session.value:sessionStorage.clear();break;case m.local.value:localStorage.clear()}},e.clearExpired=function(e){void 0===e&&(e=m.memory);for(var t=this.getItems(e),n=0;n<t.length;n++){var i=t[n];this._isExpired(i)&&this.remove(i.key)}},e.get=function(e,t){void 0===t&&(t=m.memory);var n=null;switch(t.value){case m.memory.value:n=this._memoryStorage[e];break;case m.session.value:n=sessionStorage.getItem(e);break;case m.local.value:n=localStorage.getItem(e)}if(!n)return null;var i=null;try{i=JSON.parse(n)}catch(o){return null}return i?this._isExpired(i)?null:(i.key=e,i):null},e._isExpired=function(e){return(new Date).getTime()<e.expiresAt?!1:!0},e.getItems=function(e){void 0===e&&(e=m.memory);var t=[];switch(e.value){case m.memory.value:for(var n=Object.keys(this._memoryStorage),i=0;i<n.length;i++){var o=this.get(n[i],m.memory);o&&t.push(o)}break;case m.session.value:for(var i=0;i<sessionStorage.length;i++){var r=sessionStorage.key(i);if(r){var o=this.get(r,m.session);o&&t.push(o)}}break;case m.local.value:for(var i=0;i<localStorage.length;i++){var r=localStorage.key(i);if(r){var o=this.get(r,m.local);o&&t.push(o)}}}return t},e.remove=function(e,t){switch(void 0===t&&(t=m.memory),t.value){case m.memory.value:delete this._memoryStorage[e];break;case m.session.value:sessionStorage.removeItem(e);break;case m.local.value:localStorage.removeItem(e)}},e.set=function(e,t,n,i){void 0===i&&(i=m.memory);var o=1e3*n,r=new _;switch(r.value=t,r.expiresAt=(new Date).getTime()+o,i.value){case m.memory.value:this._memoryStorage[e]=JSON.stringify(r);break;case m.session.value:sessionStorage.setItem(e,JSON.stringify(r));break;case m.local.value:localStorage.setItem(e,JSON.stringify(r))}return r},e._memoryStorage={},e}();e.Storage=v;var _=function(){function e(){}return e}();e.StorageItem=_;var m=function(){function e(e){this.value=e}return e.prototype.toString=function(){return this.value},e.memory=new e("memory"),e.session=new e("session"),e.local=new e("local"),e}();e.StorageType=m;var E=function(){function e(){}return e.ellipsis=function(e,t){if(e.length<=t)return e;var n=e.substr(0,t),i=n.lastIndexOf(" ");return-1!=i&&(n=n.substr(0,Math.min(n.length,i))),n+"&hellip;"},e.htmlDecode=function(e){var t=document.createElement("div");return t.innerHTML=e,t.firstChild.nodeValue},e.format=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var i=0;i<t.length;i++){var o=new RegExp("\\{"+i+"\\}","gm");e=e.replace(o,t[i])}return e},e.isAlphanumeric=function(e){return/^[a-zA-Z0-9]*$/.test(e)},e.toCssClass=function(e){return e.replace(/[^a-z0-9]/g,function(e){var t=e.charCodeAt(0);return 32==t?"-":t>=65&&90>=t?"_"+e.toLowerCase():"__"+("000"+t.toString(16)).slice(-4)})},e.toFileName=function(e){return e.replace(/[^a-z0-9]/gi,"_").toLowerCase()},e.utf8_to_b64=function(e){return window.btoa(unescape(encodeURIComponent(e)))},e}();e.Strings=E;var y=function(){function e(){}return e.getHashParameter=function(e,t){return t||(t=window.document),t&&t.location?this.getHashParameterFromString(e,t.location.hash):null},e.getHashParameterFromString=function(e,t){var n=new RegExp("#.*[?&]"+e+"=([^&]+)(&|$)"),i=n.exec(t);return i?decodeURIComponent(i[1].replace(/\+/g," ")):null},e.setHashParameter=function(e,t,n){if(n||(n=window.document),n&&n.location){var i=this.updateURIKeyValuePair(n.location.hash.replace("#?",""),e,t),o="#?"+i,r=n.URL,s=r.indexOf("#");-1!=s&&(r=r.substr(0,r.indexOf("#"))),n.location.replace(r+o)}},e.getQuerystringParameter=function(e,t){return t||(t=window),this.getQuerystringParameterFromString(e,t.location.search)},e.getQuerystringParameterFromString=function(e,t){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+e+"=([^&#]*)"),i=n.exec(t);return i?decodeURIComponent(i[1].replace(/\+/g," ")):null},e.setQuerystringParameter=function(e,t,n){if(n||(n=window.document),n&&n.location){var i=this.updateURIKeyValuePair(n.location.hash.replace("#?",""),e,t);window.location.search=i}},e.updateURIKeyValuePair=function(e,t,n){t=encodeURIComponent(t),n=encodeURIComponent(n);var i=e.split("&");""==i[0]&&i.shift();for(var o,r=i.length;r--;)if(o=i[r].split("="),o[0]==t){o[1]=n,i[r]=o.join("=");break}return 0>r&&(i[i.length]=[t,n].join("=")),i.join("&")},e.getUrlParts=function(e){var t=document.createElement("a");return t.href=e,t},e.convertToRelativeUrl=function(e){var t=this.getUrlParts(e),n=t.pathname+t.searchWithin;return n.startsWith("/")||(n="/"+n),n},e}();e.Urls=y}(Utils||(Utils={})),window.Utils=Utils,define("lib/Utils.js",function(){}),function e(t,n,i){function o(s,a){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(r)return r(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){var n=t[s][1][e];return o(n?n:e)},c,c.exports,e,t,n,i)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(e,t,n){function i(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","loop","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],sup:[],strong:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","loop","preload","src","height","width"]}}function o(e,t,n){}function r(e,t,n){}function s(e,t,n){}function a(e,t,n){}function u(e){return e.replace(A,"&lt;").replace(C,"&gt;")}function l(e,t,n,i){if(n=g(n),"href"===t||"src"===t){if(n=T.trim(n),"#"===n)return"#";if("http://"!==n.substr(0,7)&&"https://"!==n.substr(0,8)&&"mailto:"!==n.substr(0,7)&&"tel:"!==n.substr(0,4)&&"#"!==n[0]&&"/"!==n[0])return""}else if("background"===t){if(L.lastIndex=0,L.test(n))return""}else if("style"===t){if(N.lastIndex=0,N.test(n))return"";if(D.lastIndex=0,D.test(n)&&(L.lastIndex=0,L.test(n)))return"";i!==!1&&(i=i||O,n=i.process(n))}return n=v(n)}function c(e){return e.replace(w,"&quot;")}function h(e){return e.replace(x,'"')}function p(e){return e.replace(S,function(e,t){return"x"===t[0]||"X"===t[0]?String.fromCharCode(parseInt(t.substr(1),16)):String.fromCharCode(parseInt(t,10))})}function d(e){return e.replace(P,":").replace(R," ")}function f(e){for(var t="",n=0,i=e.length;i>n;n++)t+=e.charCodeAt(n)<32?" ":e.charAt(n);return T.trim(t)}function g(e){return e=h(e),e=p(e),e=d(e),e=f(e)}function v(e){return e=c(e),e=u(e)}function _(){return""}function m(e,t){function n(t){return i?!0:-1!==T.indexOf(e,t)}"function"!=typeof t&&(t=function(){});var i=!Array.isArray(e),o=[],r=!1;return{onIgnoreTag:function(e,i,s){if(n(e)){if(s.isClosing){var a="[/removed]",u=s.position+a.length;return o.push([r!==!1?r:s.position,u]),r=!1,a}return r||(r=s.position),"[removed]"}return t(e,i,s)},remove:function(e){var t="",n=0;return T.forEach(o,function(i){t+=e.slice(n,i[0]),n=i[1]}),t+=e.slice(n)}}}function E(e){return e.replace(M,"")}function y(e){var t=e.split("");return t=t.filter(function(e){var t=e.charCodeAt(0);return 127===t?!1:31>=t?10===t||13===t?!0:!1:!0}),t.join("")}var b=e("cssfilter").FilterCSS,I=e("cssfilter").getDefaultWhiteList,T=e("./util"),O=new b,A=/</g,C=/>/g,w=/"/g,x=/&quot;/g,S=/&#([a-zA-Z0-9]*);?/gim,P=/&colon;?/gim,R=/&newline;?/gim,L=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a)\:/gi,N=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,D=/u\s*r\s*l\s*\(.*/gi,M=/<!--[\s\S]*?-->/g;n.whiteList=i(),n.getDefaultWhiteList=i,n.onTag=o,n.onIgnoreTag=r,n.onTagAttr=s,n.onIgnoreTagAttr=a,n.safeAttrValue=l,n.escapeHtml=u,n.escapeQuote=c,n.unescapeQuote=h,n.escapeHtmlEntities=p,n.escapeDangerHtml5Entities=d,n.clearNonPrintableCharacter=f,n.friendlyAttrValue=g,n.escapeAttrValue=v,n.onIgnoreTagStripAll=_,n.StripTagBody=m,n.stripCommentTag=E,n.stripBlankChar=y,n.cssFilter=O,n.getDefaultCSSWhiteList=I},{"./util":4,cssfilter:8}],2:[function(e,t,n){function i(e,t){var n=new a(t);return n.process(e)}function o(){return"undefined"!=typeof self&&"undefined"!=typeof DedicatedWorkerGlobalScope&&self instanceof DedicatedWorkerGlobalScope}var r=e("./default"),s=e("./parser"),a=e("./xss");n=t.exports=i,n.FilterXSS=a;for(var u in r)n[u]=r[u];for(var u in s)n[u]=s[u];"undefined"!=typeof window&&(window.filterXSS=t.exports),o()&&(self.filterXSS=t.exports)},{"./default":1,"./parser":3,"./xss":5}],3:[function(e,t,n){function i(e){var t=h.spaceIndex(e);if(-1===t)var n=e.slice(1,-1);else var n=e.slice(1,t+1);return n=h.trim(n).toLowerCase(),"/"===n.slice(0,1)&&(n=n.slice(1)),"/"===n.slice(-1)&&(n=n.slice(0,-1)),n}function o(e){return"</"===e.slice(0,2)}function r(e,t,n){"user strict";var r="",s=0,a=!1,u=!1,l=0,c=e.length,h="",p="";for(l=0;c>l;l++){var d=e.charAt(l);if(a===!1){if("<"===d){a=l;continue}}else if(u===!1){if("<"===d){r+=n(e.slice(s,l)),a=l,s=l;continue}if(">"===d){r+=n(e.slice(s,a)),p=e.slice(a,l+1),h=i(p),r+=t(a,r.length,h,p,o(p)),s=l+1,a=!1;continue}if(('"'===d||"'"===d)&&"="===e.charAt(l-1)){u=d;continue}}else if(d===u){u=!1;continue}}return s<e.length&&(r+=n(e.substr(s))),r}function s(e,t){"user strict";function n(e,n){if(e=h.trim(e),e=e.replace(p,"").toLowerCase(),!(e.length<1)){var i=t(e,n||"");i&&o.push(i)}}for(var i=0,o=[],r=!1,s=e.length,l=0;s>l;l++){var d,f,g=e.charAt(l);if(r!==!1||"="!==g)if(r===!1||l!==i||'"'!==g&&"'"!==g||"="!==e.charAt(l-1))if(/\s|\n|\t/.test(g)){if(e=e.replace(/\s|\n|\t/g," "),r===!1){if(f=a(e,l),-1===f){d=h.trim(e.slice(i,l)),n(d),r=!1,i=l+1;continue}l=f-1;continue}if(f=u(e,l-1),-1===f){d=h.trim(e.slice(i,l)),d=c(d),n(r,d),r=!1,i=l+1;continue}}else;else{if(f=e.indexOf(g,l+1),-1===f)break;d=h.trim(e.slice(i+1,f)),n(r,d),r=!1,l=f,i=l+1}else r=e.slice(i,l),i=l+1}return i<e.length&&(r===!1?n(e.slice(i)):n(r,c(h.trim(e.slice(i))))),h.trim(o.join(" "))}function a(e,t){for(;t<e.length;t++){var n=e[t];if(" "!==n)return"="===n?t:-1}}function u(e,t){for(;t>0;t--){var n=e[t];if(" "!==n)return"="===n?t:-1}}function l(e){return'"'===e[0]&&'"'===e[e.length-1]||"'"===e[0]&&"'"===e[e.length-1]?!0:!1}function c(e){return l(e)?e.substr(1,e.length-2):e}var h=e("./util"),p=/[^a-zA-Z0-9_:\.\-]/gim;n.parseTag=r,n.parseAttr=s},{"./util":4}],4:[function(e,t,n){t.exports={indexOf:function(e,t){var n,i;if(Array.prototype.indexOf)return e.indexOf(t);for(n=0,i=e.length;i>n;n++)if(e[n]===t)return n;return-1},forEach:function(e,t,n){var i,o;if(Array.prototype.forEach)return e.forEach(t,n);for(i=0,o=e.length;o>i;i++)t.call(n,e[i],i,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(e){var t=/\s|\n|\t/,n=t.exec(e);return n?n.index:-1}}},{}],5:[function(e,t,n){function i(e){return void 0===e||null===e}function o(e){var t=p.spaceIndex(e);if(-1===t)return{html:"",closing:"/"===e[e.length-2]};e=p.trim(e.slice(t+1,-1));var n="/"===e[e.length-1];return n&&(e=p.trim(e.slice(0,-1))),{html:e,closing:n}}function r(e){var t={};for(var n in e)t[n]=e[n];return t}function s(e){e=r(e||{}),e.stripIgnoreTag&&(e.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),e.onIgnoreTag=u.onIgnoreTagStripAll),e.whiteList=e.whiteList||u.whiteList,e.onTag=e.onTag||u.onTag,e.onTagAttr=e.onTagAttr||u.onTagAttr,e.onIgnoreTag=e.onIgnoreTag||u.onIgnoreTag,e.onIgnoreTagAttr=e.onIgnoreTagAttr||u.onIgnoreTagAttr,e.safeAttrValue=e.safeAttrValue||u.safeAttrValue,e.escapeHtml=e.escapeHtml||u.escapeHtml,this.options=e,e.css===!1?this.cssFilter=!1:(e.css=e.css||{},this.cssFilter=new a(e.css))}var a=e("cssfilter").FilterCSS,u=e("./default"),l=e("./parser"),c=l.parseTag,h=l.parseAttr,p=e("./util");s.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,n=t.options,r=n.whiteList,s=n.onTag,a=n.onIgnoreTag,l=n.onTagAttr,d=n.onIgnoreTagAttr,f=n.safeAttrValue,g=n.escapeHtml,v=t.cssFilter;n.stripBlankChar&&(e=u.stripBlankChar(e)),n.allowCommentTag||(e=u.stripCommentTag(e));var _=!1;if(n.stripIgnoreTagBody){var _=u.StripTagBody(n.stripIgnoreTagBody,a);a=_.onIgnoreTag}var m=c(e,function(e,t,n,u,c){var _={sourcePosition:e,position:t,isClosing:c,isWhite:r.hasOwnProperty(n)},m=s(n,u,_);if(!i(m))return m;if(_.isWhite){if(_.isClosing)return"</"+n+">";var E=o(u),y=r[n],b=h(E.html,function(e,t){var o=-1!==p.indexOf(y,e),r=l(n,e,t,o);if(!i(r))return r;if(o)return t=f(n,e,t,v),t?e+'="'+t+'"':e;var r=d(n,e,t,o);return i(r)?void 0:r}),u="<"+n;return b&&(u+=" "+b),E.closing&&(u+=" /"),u+=">"}var m=a(n,u,_);return i(m)?g(u):m},g);return _&&(m=_.remove(m)),m},t.exports=s},{"./default":1,"./parser":3,"./util":4,cssfilter:8}],6:[function(e,t,n){function i(e){return void 0===e||null===e}function o(e){var t={};for(var n in e)t[n]=e[n];return t}function r(e){e=o(e||{}),e.whiteList=e.whiteList||s.whiteList,e.onAttr=e.onAttr||s.onAttr,e.onIgnoreAttr=e.onIgnoreAttr||s.onIgnoreAttr,e.safeAttrValue=e.safeAttrValue||s.safeAttrValue,this.options=e}var s=e("./default"),a=e("./parser");e("./util");r.prototype.process=function(e){if(e=e||"",e=e.toString(),!e)return"";var t=this,n=t.options,o=n.whiteList,r=n.onAttr,s=n.onIgnoreAttr,u=n.safeAttrValue,l=a(e,function(e,t,n,a,l){var c=o[n],h=!1;if(c===!0?h=c:"function"==typeof c?h=c(a):c instanceof RegExp&&(h=c.test(a)),h!==!0&&(h=!1),a=u(n,a)){var p={position:t,sourcePosition:e,source:l,isWhite:h};if(h){var d=r(n,a,p);return i(d)?n+":"+a:d}var d=s(n,a,p);return i(d)?void 0:d}});return l},t.exports=r},{"./default":7,"./parser":9,"./util":10}],7:[function(e,t,n){function i(){var e={};return e["align-content"]=!1,e["align-items"]=!1,e["align-self"]=!1,e["alignment-adjust"]=!1,e["alignment-baseline"]=!1,e.all=!1,e["anchor-point"]=!1,e.animation=!1,e["animation-delay"]=!1,e["animation-direction"]=!1,e["animation-duration"]=!1,e["animation-fill-mode"]=!1,e["animation-iteration-count"]=!1,e["animation-name"]=!1,e["animation-play-state"]=!1,e["animation-timing-function"]=!1,e.azimuth=!1,e["backface-visibility"]=!1,e.background=!0,e["background-attachment"]=!0,e["background-clip"]=!0,e["background-color"]=!0,e["background-image"]=!0,e["background-origin"]=!0,e["background-position"]=!0,e["background-repeat"]=!0,e["background-size"]=!0,e["baseline-shift"]=!1,e.binding=!1,e.bleed=!1,e["bookmark-label"]=!1,e["bookmark-level"]=!1,e["bookmark-state"]=!1,e.border=!0,e["border-bottom"]=!0,e["border-bottom-color"]=!0,e["border-bottom-left-radius"]=!0,e["border-bottom-right-radius"]=!0,e["border-bottom-style"]=!0,e["border-bottom-width"]=!0,e["border-collapse"]=!0,e["border-color"]=!0,e["border-image"]=!0,e["border-image-outset"]=!0,e["border-image-repeat"]=!0,e["border-image-slice"]=!0,e["border-image-source"]=!0,e["border-image-width"]=!0,e["border-left"]=!0,e["border-left-color"]=!0,e["border-left-style"]=!0,e["border-left-width"]=!0,e["border-radius"]=!0,e["border-right"]=!0,e["border-right-color"]=!0,e["border-right-style"]=!0,e["border-right-width"]=!0,e["border-spacing"]=!0,e["border-style"]=!0,e["border-top"]=!0,e["border-top-color"]=!0,e["border-top-left-radius"]=!0,e["border-top-right-radius"]=!0,e["border-top-style"]=!0,e["border-top-width"]=!0,e["border-width"]=!0,e.bottom=!1,e["box-decoration-break"]=!0,e["box-shadow"]=!0,e["box-sizing"]=!0,e["box-snap"]=!0,e["box-suppress"]=!0,e["break-after"]=!0,e["break-before"]=!0,e["break-inside"]=!0,e["caption-side"]=!1,e.chains=!1,e.clear=!0,e.clip=!1,e["clip-path"]=!1,e["clip-rule"]=!1,e.color=!0,e["color-interpolation-filters"]=!0,e["column-count"]=!1,e["column-fill"]=!1,e["column-gap"]=!1,e["column-rule"]=!1,e["column-rule-color"]=!1,e["column-rule-style"]=!1,e["column-rule-width"]=!1,e["column-span"]=!1,e["column-width"]=!1,e.columns=!1,e.contain=!1,e.content=!1,e["counter-increment"]=!1,e["counter-reset"]=!1,e["counter-set"]=!1,e.crop=!1,e.cue=!1,e["cue-after"]=!1,e["cue-before"]=!1,e.cursor=!1,e.direction=!1,e.display=!0,e["display-inside"]=!0,e["display-list"]=!0,e["display-outside"]=!0,e["dominant-baseline"]=!1,e.elevation=!1,e["empty-cells"]=!1,e.filter=!1,e.flex=!1,e["flex-basis"]=!1,e["flex-direction"]=!1,e["flex-flow"]=!1,e["flex-grow"]=!1,e["flex-shrink"]=!1,e["flex-wrap"]=!1,e["float"]=!1,e["float-offset"]=!1,e["flood-color"]=!1,e["flood-opacity"]=!1,e["flow-from"]=!1,e["flow-into"]=!1,e.font=!0,e["font-family"]=!0,e["font-feature-settings"]=!0,e["font-kerning"]=!0,e["font-language-override"]=!0,e["font-size"]=!0,e["font-size-adjust"]=!0,e["font-stretch"]=!0,e["font-style"]=!0,e["font-synthesis"]=!0,e["font-variant"]=!0,e["font-variant-alternates"]=!0,e["font-variant-caps"]=!0,e["font-variant-east-asian"]=!0,e["font-variant-ligatures"]=!0,e["font-variant-numeric"]=!0,e["font-variant-position"]=!0,e["font-weight"]=!0,e.grid=!1,e["grid-area"]=!1,e["grid-auto-columns"]=!1,e["grid-auto-flow"]=!1,e["grid-auto-rows"]=!1,e["grid-column"]=!1,e["grid-column-end"]=!1,e["grid-column-start"]=!1,e["grid-row"]=!1,e["grid-row-end"]=!1,e["grid-row-start"]=!1,e["grid-template"]=!1,e["grid-template-areas"]=!1,e["grid-template-columns"]=!1,e["grid-template-rows"]=!1,e["hanging-punctuation"]=!1,e.height=!0,e.hyphens=!1,e.icon=!1,e["image-orientation"]=!1,e["image-resolution"]=!1,e["ime-mode"]=!1,e["initial-letters"]=!1,e["inline-box-align"]=!1,e["justify-content"]=!1,e["justify-items"]=!1,e["justify-self"]=!1,e.left=!1,e["letter-spacing"]=!0,e["lighting-color"]=!0,e["line-box-contain"]=!1,e["line-break"]=!1,e["line-grid"]=!1,e["line-height"]=!1,e["line-snap"]=!1,e["line-stacking"]=!1,e["line-stacking-ruby"]=!1,e["line-stacking-shift"]=!1,e["line-stacking-strategy"]=!1,e["list-style"]=!0,e["list-style-image"]=!0,e["list-style-position"]=!0,e["list-style-type"]=!0,e.margin=!0,e["margin-bottom"]=!0,e["margin-left"]=!0,e["margin-right"]=!0,e["margin-top"]=!0,e["marker-offset"]=!1,e["marker-side"]=!1,e.marks=!1,e.mask=!1,e["mask-box"]=!1,e["mask-box-outset"]=!1,e["mask-box-repeat"]=!1,e["mask-box-slice"]=!1,e["mask-box-source"]=!1,e["mask-box-width"]=!1,e["mask-clip"]=!1,e["mask-image"]=!1,e["mask-origin"]=!1,e["mask-position"]=!1,e["mask-repeat"]=!1,e["mask-size"]=!1,e["mask-source-type"]=!1,e["mask-type"]=!1,e["max-height"]=!0,e["max-lines"]=!1,e["max-width"]=!0,e["min-height"]=!0,e["min-width"]=!0,e["move-to"]=!1,e["nav-down"]=!1,e["nav-index"]=!1,e["nav-left"]=!1,e["nav-right"]=!1,e["nav-up"]=!1,e["object-fit"]=!1,e["object-position"]=!1,e.opacity=!1,e.order=!1,e.orphans=!1,e.outline=!1,e["outline-color"]=!1,e["outline-offset"]=!1,e["outline-style"]=!1,e["outline-width"]=!1,e.overflow=!1,e["overflow-wrap"]=!1,e["overflow-x"]=!1,e["overflow-y"]=!1,e.padding=!0,e["padding-bottom"]=!0,e["padding-left"]=!0,e["padding-right"]=!0,e["padding-top"]=!0,e.page=!1,e["page-break-after"]=!1,e["page-break-before"]=!1,e["page-break-inside"]=!1,e["page-policy"]=!1,e.pause=!1,e["pause-after"]=!1,e["pause-before"]=!1,e.perspective=!1,e["perspective-origin"]=!1,e.pitch=!1,e["pitch-range"]=!1,e["play-during"]=!1,e.position=!1,e["presentation-level"]=!1,e.quotes=!1,e["region-fragment"]=!1,e.resize=!1,e.rest=!1,e["rest-after"]=!1,e["rest-before"]=!1,e.richness=!1,e.right=!1,e.rotation=!1,e["rotation-point"]=!1,e["ruby-align"]=!1,e["ruby-merge"]=!1,e["ruby-position"]=!1,e["shape-image-threshold"]=!1,e["shape-outside"]=!1,e["shape-margin"]=!1,e.size=!1,e.speak=!1,e["speak-as"]=!1,e["speak-header"]=!1,e["speak-numeral"]=!1,e["speak-punctuation"]=!1,e["speech-rate"]=!1,e.stress=!1,e["string-set"]=!1,e["tab-size"]=!1,e["table-layout"]=!1,e["text-align"]=!0,e["text-align-last"]=!0,e["text-combine-upright"]=!0,e["text-decoration"]=!0,e["text-decoration-color"]=!0,e["text-decoration-line"]=!0,e["text-decoration-skip"]=!0,e["text-decoration-style"]=!0,e["text-emphasis"]=!0,e["text-emphasis-color"]=!0,e["text-emphasis-position"]=!0,e["text-emphasis-style"]=!0,e["text-height"]=!0,e["text-indent"]=!0,e["text-justify"]=!0,e["text-orientation"]=!0,e["text-overflow"]=!0,e["text-shadow"]=!0,e["text-space-collapse"]=!0,e["text-transform"]=!0,e["text-underline-position"]=!0,e["text-wrap"]=!0,e.top=!1,e.transform=!1,e["transform-origin"]=!1,e["transform-style"]=!1,e.transition=!1,e["transition-delay"]=!1,e["transition-duration"]=!1,e["transition-property"]=!1,e["transition-timing-function"]=!1,e["unicode-bidi"]=!1,e["vertical-align"]=!1,e.visibility=!1,e["voice-balance"]=!1,e["voice-duration"]=!1,e["voice-family"]=!1,e["voice-pitch"]=!1,e["voice-range"]=!1,e["voice-rate"]=!1,e["voice-stress"]=!1,e["voice-volume"]=!1,e.volume=!1,e["white-space"]=!1,e.widows=!1,e.width=!0,e["will-change"]=!1,e["word-break"]=!0,e["word-spacing"]=!0,e["word-wrap"]=!0,e["wrap-flow"]=!1,e["wrap-through"]=!1,e["writing-mode"]=!1,e["z-index"]=!1,e}function o(e,t,n){}function r(e,t,n){}function s(e,t){return a.test(t)?"":t}var a=/javascript\s*\:/gim;n.whiteList=i(),n.getDefaultWhiteList=i,n.onAttr=o,n.onIgnoreAttr=r,n.safeAttrValue=s},{}],8:[function(e,t,n){function i(e,t){var n=new r(t);return n.process(e)}var o=e("./default"),r=e("./css");n=t.exports=i,n.FilterCSS=r;for(var s in o)n[s]=o[s];"undefined"!=typeof window&&(window.filterCSS=t.exports)},{"./css":6,"./default":7}],9:[function(e,t,n){function i(e,t){function n(){if(!r){var n=o.trim(e.slice(s,a)),i=n.indexOf(":");if(-1!==i){var l=o.trim(n.slice(0,i)),c=o.trim(n.slice(i+1));if(l){var h=t(s,u.length,l,c,n);h&&(u+=h+"; ")}}}s=a+1}e=o.trimRight(e),";"!==e[e.length-1]&&(e+=";");for(var i=e.length,r=!1,s=0,a=0,u="";i>a;a++){var l=e[a];if("/"===l&&"*"===e[a+1]){var c=e.indexOf("*/",a+2);if(-1===c)break;a=c+1,s=a+1,r=!1}else"("===l?r=!0:")"===l?r=!1:";"===l?r||n():"\n"===l&&n()}return o.trim(u)}var o=e("./util");t.exports=i},{"./util":10}],10:[function(e,t,n){t.exports={indexOf:function(e,t){var n,i;if(Array.prototype.indexOf)return e.indexOf(t);for(n=0,i=e.length;i>n;n++)if(e[n]===t)return n;return-1},forEach:function(e,t,n){var i,o;if(Array.prototype.forEach)return e.forEach(t,n);for(i=0,o=e.length;o>i;i++)t.call(n,e[i],i,e)},trim:function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(e){return String.prototype.trimRight?e.trimRight():e.replace(/(\s*$)/g,"")}}},{}]},{},[2]),define("lib/xss.min.js",function(){}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define("lib/fetch.umd.js",["exports"],t):t(e.WHATWGFetch={})}(this,function(e){"use strict";function t(e){return e&&DataView.prototype.isPrototypeOf(e)}function n(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function i(e){return"string"!=typeof e&&(e=String(e)),e}function o(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return E.iterable&&(t[Symbol.iterator]=function(){return t}),t}function r(e){this.map={},e instanceof r?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function s(e){return e.bodyUsed?Promise.reject(new TypeError("Already read")):void(e.bodyUsed=!0)}function a(e){return new Promise(function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function u(e){var t=new FileReader,n=a(t);return t.readAsArrayBuffer(e),n}function l(e){var t=new FileReader,n=a(t);return t.readAsText(e),n}function c(e){for(var t=new Uint8Array(e),n=new Array(t.length),i=0;i<t.length;i++)n[i]=String.fromCharCode(t[i]);return n.join("")}function h(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function p(){return this.bodyUsed=!1,this._initBody=function(e){this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:E.blob&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:E.formData&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:E.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():E.arrayBuffer&&E.blob&&t(e)?(this._bodyArrayBuffer=h(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):E.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||b(e))?this._bodyArrayBuffer=h(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):E.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},E.blob&&(this.blob=function(){
var e=s(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?s(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(u)}),this.text=function(){var e=s(this);if(e)return e;if(this._bodyBlob)return l(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(c(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},E.formData&&(this.formData=function(){return this.text().then(g)}),this.json=function(){return this.text().then(JSON.parse)},this}function d(e){var t=e.toUpperCase();return I.indexOf(t)>-1?t:e}function f(e,t){t=t||{};var n=t.body;if(e instanceof f){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new r(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,n||null==e._bodyInit||(n=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",(t.headers||!this.headers)&&(this.headers=new r(t.headers)),this.method=d(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(n)}function g(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var n=e.split("="),i=n.shift().replace(/\+/g," "),o=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(i),decodeURIComponent(o))}}),t}function v(e){var t=new r,n=e.replace(/\r?\n[\t ]+/g," ");return n.split(/\r?\n/).forEach(function(e){var n=e.split(":"),i=n.shift().trim();if(i){var o=n.join(":").trim();t.append(i,o)}}),t}function _(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new r(t.headers),this.url=t.url||"",this._initBody(e)}function m(t,n){return new Promise(function(i,o){function r(){a.abort()}var s=new f(t,n);if(s.signal&&s.signal.aborted)return o(new e.DOMException("Aborted","AbortError"));var a=new XMLHttpRequest;a.onload=function(){var e={status:a.status,statusText:a.statusText,headers:v(a.getAllResponseHeaders()||"")};e.url="responseURL"in a?a.responseURL:e.headers.get("X-Request-URL");var t="response"in a?a.response:a.responseText;i(new _(t,e))},a.onerror=function(){o(new TypeError("Network request failed"))},a.ontimeout=function(){o(new TypeError("Network request failed"))},a.onabort=function(){o(new e.DOMException("Aborted","AbortError"))},a.open(s.method,s.url,!0),"include"===s.credentials?a.withCredentials=!0:"omit"===s.credentials&&(a.withCredentials=!1),"responseType"in a&&E.blob&&(a.responseType="blob"),s.headers.forEach(function(e,t){a.setRequestHeader(t,e)}),s.signal&&(s.signal.addEventListener("abort",r),a.onreadystatechange=function(){4===a.readyState&&s.signal.removeEventListener("abort",r)}),a.send("undefined"==typeof s._bodyInit?null:s._bodyInit)})}var E={searchParams:"URLSearchParams"in self,iterable:"Symbol"in self&&"iterator"in Symbol,blob:"FileReader"in self&&"Blob"in self&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in self,arrayBuffer:"ArrayBuffer"in self};if(E.arrayBuffer)var y=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],b=ArrayBuffer.isView||function(e){return e&&y.indexOf(Object.prototype.toString.call(e))>-1};r.prototype.append=function(e,t){e=n(e),t=i(t);var o=this.map[e];this.map[e]=o?o+", "+t:t},r.prototype["delete"]=function(e){delete this.map[n(e)]},r.prototype.get=function(e){return e=n(e),this.has(e)?this.map[e]:null},r.prototype.has=function(e){return this.map.hasOwnProperty(n(e))},r.prototype.set=function(e,t){this.map[n(e)]=i(t)},r.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},r.prototype.keys=function(){var e=[];return this.forEach(function(t,n){e.push(n)}),o(e)},r.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),o(e)},r.prototype.entries=function(){var e=[];return this.forEach(function(t,n){e.push([n,t])}),o(e)},E.iterable&&(r.prototype[Symbol.iterator]=r.prototype.entries);var I=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];f.prototype.clone=function(){return new f(this,{body:this._bodyInit})},p.call(f.prototype),p.call(_.prototype),_.prototype.clone=function(){return new _(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new r(this.headers),url:this.url})},_.error=function(){var e=new _(null,{status:0,statusText:""});return e.type="error",e};var T=[301,302,303,307,308];_.redirect=function(e,t){if(-1===T.indexOf(t))throw new RangeError("Invalid status code");return new _(null,{status:t,headers:{location:e}})},e.DOMException=self.DOMException;try{new e.DOMException}catch(O){e.DOMException=function(e,t){this.message=e,this.name=t;var n=Error(e);this.stack=n.stack},e.DOMException.prototype=Object.create(Error.prototype),e.DOMException.prototype.constructor=e.DOMException}m.polyfill=!0,self.fetch||(self.fetch=m,self.Headers=r,self.Request=f,self.Response=_),e.Headers=r,e.Request=f,e.Response=_,e.fetch=m,Object.defineProperty(e,"__esModule",{value:!0})}),define("UVDataProvider",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.readonly=!1,this.readonly=e}return e.prototype.get=function(e,t){return null},e.prototype.set=function(e,t){},e}();t.UVDataProvider=n});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("URLDataProvider",["require","exports","./UVDataProvider"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.get=function(e,t){return Utils.Urls.getHashParameter(e,document)||t},t.prototype.set=function(e,t){this.readonly||(t?Utils.Urls.setHashParameter(e,t.toString(),document):Utils.Urls.setHashParameter(e,"",document))},t}(n.UVDataProvider);t["default"]=i}),!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("vocabulary",[],t):"object"==typeof exports?exports.vocabulary=t():e.vocabulary=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:i})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(t.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)t.d(i,o,function(t){return e[t]}.bind(null,o));return i},t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.BOOKMARKING="oa:bookmarking",e.CLASSIFYING="oa:classifying",e.COMMENTING="oa:commenting",e.DESCRIBING="oa:describing",e.EDITING="oa:editing",e.HIGHLIGHTING="oa:highlighting",e.IDENTIFYING="oa:identifying",e.LINKING="oa:linking",e.MODERATING="oa:moderating",e.PAINTING="sc:painting",e.QUESTIONING="oa:questioning",e.REPLYING="oa:replying",e.TAGGING="oa:tagging",e.TRANSCRIBING="oad:transcribing"}(t.AnnotationMotivation||(t.AnnotationMotivation={})),function(e){e.AUTO_ADVANCE="auto-advance",e.CONTINUOUS="continuous",e.FACING_PAGES="facing-pages",e.HIDDEN="hidden",e.INDIVIDUALS="individuals",e.MULTI_PART="multi-part",e.NO_NAV="no-nav",e.NON_PAGED="non-paged",e.PAGED="paged",e.REPEAT="repeat",e.SEQUENCE="sequence",e.THUMBNAIL_NAV="thumbnail-nav",e.TOGETHER="together",e.UNORDERED="unordered"}(t.Behavior||(t.Behavior={})),function(e){e.CANVAS="canvas",e.CHOICE="choice",e.OA_CHOICE="oa:choice",e.CONTENT_AS_TEXT="contentastext",e.DATASET="dataset",e.DOCUMENT="document",e.IMAGE="image",e.MODEL="model",e.MOVING_IMAGE="movingimage",e.PDF="pdf",e.PHYSICAL_OBJECT="physicalobject",e.SOUND="sound",e.TEXT="text",e.TEXTUALBODY="textualbody",e.VIDEO="video"}(t.ExternalResourceType||(t.ExternalResourceType={})),function(e){e.ANNOTATION="annotation",e.CANVAS="canvas",e.COLLECTION="collection",e.MANIFEST="manifest",e.RANGE="range",e.SEQUENCE="sequence"}(t.IIIFResourceType||(t.IIIFResourceType={})),function(e){e.AUDIO_MP4="audio/mp4",e.CORTO="application/corto",e.DICOM="application/dicom",e.DRACO="application/draco",e.EPUB="application/epub+zip",e.GLB="model/gltf-binary",e.GLTF="model/gltf+json",e.IIIF_PRESENTATION_2='application/ld+json;profile="http://iiif.io/api/presentation/2/context.json"',e.IIIF_PRESENTATION_3='application/ld+json;profile="http://iiif.io/api/presentation/3/context.json"',e.JPG="image/jpeg",e.M3U8="application/vnd.apple.mpegurl",e.MP3="audio/mp3",e.MPEG_DASH="application/dash+xml",e.OBJ="text/plain",e.OPF="application/oebps-package+xml",e.PDF="application/pdf",e.PLY="application/ply",e.THREEJS="application/vnd.threejs+json",e.USDZ="model/vnd.usd+zip",e.VIDEO_MP4="video/mp4",e.WEBM="video/webm"}(t.MediaType||(t.MediaType={})),function(e){e.DOC="application/msword",e.DOCX="application/vnd.openxmlformats-officedocument.wordprocessingml.document",e.PDF="application/pdf"}(t.RenderingFormat||(t.RenderingFormat={})),function(e){e.IMAGE_0_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0",e.IMAGE_0_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1",e.IMAGE_0_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2",e.IMAGE_0_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0",e.IMAGE_0_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1",e.IMAGE_0_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2",e.IMAGE_1_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",e.IMAGE_1_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",e.IMAGE_1_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",e.IMAGE_1_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",e.IMAGE_1_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",e.IMAGE_1_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",e.IMAGE_1_LEVEL_0="http://iiif.io/api/image/1/level0.json",e.IMAGE_1_PROFILE_LEVEL_0="http://iiif.io/api/image/1/profiles/level0.json",e.IMAGE_1_LEVEL_1="http://iiif.io/api/image/1/level1.json",e.IMAGE_1_PROFILE_LEVEL_1="http://iiif.io/api/image/1/profiles/level1.json",e.IMAGE_1_LEVEL_2="http://iiif.io/api/image/1/level2.json",e.IMAGE_1_PROFILE_LEVEL_2="http://iiif.io/api/image/1/profiles/level2.json",e.IMAGE_2_LEVEL_0="http://iiif.io/api/image/2/level0.json",e.IMAGE_2_PROFILE_LEVEL_0="http://iiif.io/api/image/2/profiles/level0.json",e.IMAGE_2_LEVEL_1="http://iiif.io/api/image/2/level1.json",e.IMAGE_2_PROFILE_LEVEL_1="http://iiif.io/api/image/2/profiles/level1.json",e.IMAGE_2_LEVEL_2="http://iiif.io/api/image/2/level2.json",e.IMAGE_2_PROFILE_LEVEL_2="http://iiif.io/api/image/2/profiles/level2.json",e.AUTH_0_CLICK_THROUGH="http://iiif.io/api/auth/0/login/clickthrough",e.AUTH_0_LOGIN="http://iiif.io/api/auth/0/login",e.AUTH_0_LOGOUT="http://iiif.io/api/auth/0/logout",e.AUTH_0_RESTRICTED="http://iiif.io/api/auth/0/login/restricted",e.AUTH_0_TOKEN="http://iiif.io/api/auth/0/token",e.AUTH_1_CLICK_THROUGH="http://iiif.io/api/auth/1/clickthrough",e.AUTH_1_EXTERNAL="http://iiif.io/api/auth/1/external",e.AUTH_1_KIOSK="http://iiif.io/api/auth/1/kiosk",e.AUTH_1_LOGIN="http://iiif.io/api/auth/1/login",e.AUTH_1_LOGOUT="http://iiif.io/api/auth/1/logout",e.AUTH_1_PROBE="http://iiif.io/api/auth/1/probe",e.AUTH_1_TOKEN="http://iiif.io/api/auth/1/token",e.SEARCH_0="http://iiif.io/api/search/0/search",e.SEARCH_0_AUTO_COMPLETE="http://iiif.io/api/search/0/autocomplete",e.SEARCH_1="http://iiif.io/api/search/1/search",e.SEARCH_1_AUTO_COMPLETE="http://iiif.io/api/search/1/autocomplete",e.TRACKING_EXTENSIONS="http://universalviewer.io/tracking-extensions-profile",e.UI_EXTENSIONS="http://universalviewer.io/ui-extensions-profile",e.PRINT_EXTENSIONS="http://universalviewer.io/print-extensions-profile",e.SHARE_EXTENSIONS="http://universalviewer.io/share-extensions-profile",e.OTHER_MANIFESTATIONS="http://iiif.io/api/otherManifestations.json",e.IXIF="http://wellcomelibrary.org/ld/ixif/0/alpha.json"}(t.ServiceProfile||(t.ServiceProfile={})),function(e){e.BOTTOM_TO_TOP="bottom-to-top",e.LEFT_TO_RIGHT="left-to-right",e.RIGHT_TO_LEFT="right-to-left",e.TOP_TO_BOTTOM="top-to-bottom"}(t.ViewingDirection||(t.ViewingDirection={})),function(e){e.CONTINUOUS="continuous",e.INDIVIDUALS="individuals",e.NON_PAGED="non-paged",e.PAGED="paged",e.TOP="top"}(t.ViewingHint||(t.ViewingHint={}))}])}),define("lib/vocabulary.js",function(){}),define("modules/uv-shared-module/BaseEvents",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.ACCEPT_TERMS="acceptTerms",e.ANNOTATION_CANVAS_CHANGED="annotationCanvasChanged",e.ANNOTATION_CHANGED="annotationChanged",e.ANNOTATIONS_CLEARED="annotationsCleared",e.ANNOTATIONS_EMPTY="annotationsEmpty",e.ANNOTATIONS="annotations",e.BOOKMARK="bookmark",e.CANVAS_INDEX_CHANGE_FAILED="canvasIndexChangeFailed",e.CANVAS_INDEX_CHANGED="canvasIndexChanged",e.CLEAR_ANNOTATIONS="clearAnnotations",e.CLICKTHROUGH="clickthrough",e.CLOSE_ACTIVE_DIALOGUE="closeActiveDialogue",e.CLOSE_LEFT_PANEL="closeLeftPanel",e.CLOSE_RIGHT_PANEL="closeRightPanel",e.COLLECTION_INDEX_CHANGED="collectionIndexChanged",e.CREATE="create",e.CREATED="created",e.CURRENT_TIME_CHANGED="currentTimeChanged",e.DOWN_ARROW="downArrow",e.DOWNLOAD="download",e.DROP="drop",e.END="end",e.ERROR="error",e.ESCAPE="escape",e.EXIT_FULLSCREEN="exitFullScreen",e.EXTERNAL_LINK_CLICKED="externalLinkClicked",e.FEEDBACK="feedback",e.FIRST="first",e.FORBIDDEN="forbidden",e.GALLERY_DECREASE_SIZE="galleryDecreaseSize",e.GALLERY_INCREASE_SIZE="galleryIncreaseSize",e.GALLERY_THUMB_SELECTED="galleryThumbSelected",e.HIDE_AUTH_DIALOGUE="hideAuthDialogue",e.HIDE_CLICKTHROUGH_DIALOGUE="hideClickthroughDialogue",e.HIDE_DOWNLOAD_DIALOGUE="hideDownloadDialogue",e.HIDE_EMBED_DIALOGUE="hideEmbedDialogue",e.HIDE_EXTERNALCONTENT_DIALOGUE="hideExternalContentDialogue",e.HIDE_GENERIC_DIALOGUE="hideGenericDialogue",e.HIDE_HELP_DIALOGUE="hideHelpDialogue",e.HIDE_INFORMATION="hideInformation",e.HIDE_LOGIN_DIALOGUE="hideLoginDialogue",e.HIDE_MOREINFO_DIALOGUE="hideMoreInfoDialogue",e.HIDE_MULTISELECT_DIALOGUE="hideMultiSelectDialogue",e.HIDE_OVERLAY="hideOverlay",e.HIDE_RESTRICTED_DIALOGUE="hideRestrictedDialogue",e.HIDE_SETTINGS_DIALOGUE="hideSettingsDialogue",e.HIDE_SHARE_DIALOGUE="hideShareDialogue",e.HOME="home",e.INFO_DISPLAYED="infoDisplayed",e.LAST="last",e.LEFT_ARROW="leftArrow",e.LEFTPANEL_COLLAPSE_FULL_FINISH="leftPanelCollapseFullFinish",e.LEFTPANEL_COLLAPSE_FULL_START="leftPanelCollapseFullStart",e.LEFTPANEL_EXPAND_FULL_FINISH="leftPanelExpandFullFinish",e.LEFTPANEL_EXPAND_FULL_START="leftPanelExpandFullStart",e.LOAD_FAILED="loadFailed",e.LOGIN_FAILED="loginFailed",e.LOGIN="login",e.LOGOUT="logout",e.MANIFEST_INDEX_CHANGED="manifestIndexChanged",e.METRIC_CHANGED="metricChanged",e.MINUS="minus",e.MULTISELECT_CHANGE="multiSelectChange",e.MULTISELECTION_MADE="multiSelectionMade",e.NEXT="next",e.NOT_FOUND="notFound",e.OPEN_EXTERNAL_RESOURCE="openExternalResource",e.OPEN_LEFT_PANEL="openLeftPanel",e.OPEN_RIGHT_PANEL="openRightPanel",e.OPEN_THUMBS_VIEW="openThumbsView",e.OPEN_TREE_VIEW="openTreeView",e.OPEN="open",e.PAGE_DOWN="pageDown",e.PAGE_UP="pageUp",e.PAUSE="pause",e.PLUS="plus",e.PREV="prev",e.RANGE_CHANGED="rangeChanged",e.RANGE_NOT_FOUND="rangeNotFound",e.REDIRECT="redirect",e.REFRESH="refresh",e.RELOAD="reload",e.RESIZE="resize",e.RESOURCE_DEGRADED="resourceDegraded",e.RETRY="retry",e.RETURN="return",e.RIGHT_ARROW="rightArrow",e.RIGHTPANEL_COLLAPSE_FULL_FINISH="rightPanelCollapseFullFinish",e.RIGHTPANEL_COLLAPSE_FULL_START="rightPanelCollapseFullStart",e.RIGHTPANEL_EXPAND_FULL_FINISH="rightPanelExpandFullFinish",e.RIGHTPANEL_EXPAND_FULL_START="rightPanelExpandFullStart",e.SEQUENCE_INDEX_CHANGED="sequenceIndexChanged",e.SETTINGS_CHANGED="settingsChanged",e.SHOW_AUTH_DIALOGUE="showAuthDialogue",e.SHOW_CLICKTHROUGH_DIALOGUE="showClickThroughDialogue",e.SHOW_DOWNLOAD_DIALOGUE="showDownloadDialogue",e.SHOW_EMBED_DIALOGUE="showEmbedDialogue",e.SHOW_EXTERNALCONTENT_DIALOGUE="showExternalContentDialogue",e.SHOW_GENERIC_DIALOGUE="showGenericDialogue",e.SHOW_HELP_DIALOGUE="showHelpDialogue",e.SHOW_INFORMATION="showInformation",e.SHOW_LOGIN_DIALOGUE="showLoginDialogue",e.SHOW_MESSAGE="showMessage",e.SHOW_MOREINFO_DIALOGUE="showMoreInfoDialogue",e.SHOW_MULTISELECT_DIALOGUE="showMultiSelectDialogue",e.SHOW_OVERLAY="showOverlay",e.SHOW_RESTRICTED_DIALOGUE="showRestrictedDialogue",e.SHOW_SETTINGS_DIALOGUE="showSettingsDialogue",e.SHOW_SHARE_DIALOGUE="showShareDialogue",e.SHOW_TERMS_OF_USE="showTermsOfUse",e.THUMB_MULTISELECTED="thumbMultiSelected",e.THUMB_SELECTED="thumbSelected",e.TOGGLE_EXPAND_LEFT_PANEL="toggleExpandLeftPanel",e.TOGGLE_EXPAND_RIGHT_PANEL="toggleExpandRightPanel",e.TOGGLE_FULLSCREEN="toggleFullScreen",e.TREE_NODE_MULTISELECTED="treeNodeMultiSelected",e.TREE_NODE_SELECTED="treeNodeSelected",e.UP_ARROW="upArrow",e.UPDATE_SETTINGS="updateSettings",e.VIEW_FULL_TERMS="viewFullTerms",e.WINDOW_UNLOAD="windowUnload",e}();t.BaseEvents=n}),define("modules/uv-shared-module/Panel",["require","exports","./BaseEvents"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t,n){this.isResized=!1,this.$element=e,this.fitToParentWidth=t||!1,this.fitToParentHeight=n||!1,this.create()}return e.prototype.create=function(){var e=this;this.component.subscribe(n.BaseEvents.RESIZE,function(){e.resize()})},e.prototype.whenResized=function(e){var t=this;Utils.Async.waitFor(function(){return t.isResized},e)},e.prototype.resize=function(){var e=this.$element.parent();this.fitToParentWidth&&this.$element.width(e.width()),this.fitToParentHeight&&this.$element.height(e.height()),this.isResized=!0},e}();t.Panel=i});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-shared-module/BaseView",["require","exports","./Panel"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t,n,i){return e.call(this,t,n,i)||this}return __extends(t,e),t.prototype.create=function(){this.component=this.$element.closest(".uv").data("component"),e.prototype.create.call(this),this.extension=this.component.extension,this.config={},this.config.content={},this.config.options={};var t=this;t.modules&&t.modules.length&&(t.modules=t.modules.reverse(),t.modules.forEach(function(e){t.config=$.extend(!0,t.config,t.extension.data.config.modules[e])})),this.content=this.config.content,this.options=this.config.options},t.prototype.init=function(){},t.prototype.setConfig=function(e){this.modules||(this.modules=[]),this.modules.push(e)},t.prototype.resize=function(){e.prototype.resize.call(this)},t}(n.Panel);t.BaseView=i}),define("modules/uv-shared-module/Position",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n;!function(e){e[e.TOP_LEFT=0]="TOP_LEFT",e[e.TOP_CENTER=1]="TOP_CENTER",e[e.TOP_RIGHT=2]="TOP_RIGHT",e[e.CENTER_LEFT=3]="CENTER_LEFT",e[e.CENTER=4]="CENTER",e[e.CENTER_RIGHT=5]="CENTER_RIGHT",e[e.BOTTOM_LEFT=6]="BOTTOM_LEFT",e[e.BOTTOM_CENTER=7]="BOTTOM_CENTER",e[e.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(n=t.Position||(t.Position={}))}),define("Utils",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.sanitize=function(e){return filterXSS(e,{whiteList:{a:["href","title","target","class","data-uv-navigate"],b:[],br:[],i:[],img:["src","alt"],p:[],small:[],span:["data-uv-navigate"],strong:[],sub:[],sup:[]}})},e.isValidUrl=function(e){var t=document.createElement("a");return t.href=e,!!t.host&&t.host!==window.location.host},e.propertiesChanged=function(t,n,i){for(var o=!1,r=0;r<i.length&&!(o=e.propertyChanged(t,n,i[r]));r++);return o},e.propertyChanged=function(e,t,n){return t[n]!==e[n]},e}();t.UVUtils=n});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-shared-module/CenterPanel",["require","exports","./BaseView","./Position","../../Utils"],function(e,t,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(t){var n=e.call(this,t,!1,!0)||this;return n.subtitleExpanded=!1,n.isAttributionOpen=!1,n.attributionPosition=i.Position.BOTTOM_LEFT,n}return __extends(t,e),t.prototype.create=function(){var t=this;e.prototype.create.call(this),this.$title=$('<div class="title"></div>'),this.$element.append(this.$title),this.$subtitle=$('<div class="subtitle">\n                                <div class="wrapper">\n                                    <button type="button" class="expand-btn" aria-label="Expand">\n                                        <span aria-hidden="true">+</span>\n                                    </button>\n                                    <span class="text"></span>\n                                </div>\n                            </div>'),this.$element.append(this.$subtitle),this.$subtitleWrapper=this.$subtitle.find(".wrapper"),this.$subtitleExpand=this.$subtitle.find(".expand-btn"),this.$subtitleText=this.$subtitle.find(".text"),this.$content=$('<div class="content"></div>'),this.$element.append(this.$content),this.$attribution=$('\n                                <div class="attribution">\n                                  <div class="header">\n                                    <div class="title"></div>\n                                    <button type="button" class="close" aria-label="Close">\n                                      <span aria-hidden="true">&#215;</span>\n                                    </button>\n                                  </div>\n                                  <div class="main">\n                                    <div class="attribution-text"></div>\n                                    <div class="license"></div>\n                                    <div class="logo"></div>\n                                  </div>\n                                </div>\n        '),this.$attribution.find(".header .title").text(this.content.attribution),this.$content.append(this.$attribution),this.closeAttribution(),this.$closeAttributionButton=this.$attribution.find(".header .close"),this.$closeAttributionButton.on("click",function(e){e.preventDefault(),t.closeAttribution()}),this.$subtitleExpand.on("click",function(e){e.preventDefault(),t.subtitleExpanded=!t.subtitleExpanded,t.subtitleExpanded?(t.$subtitleWrapper.addClass("expanded"),t.$subtitleExpand.text("-")):(t.$subtitleWrapper.removeClass("expanded"),t.$subtitleExpand.text("+")),t.resize()}),Utils.Bools.getBool(this.options.titleEnabled,!0)?this.$title.removeClass("hidden"):this.$title.addClass("hidden"),Utils.Bools.getBool(this.options.subtitleEnabled,!1)?this.$subtitle.removeClass("hidden"):this.$subtitle.addClass("hidden"),this.whenResized(function(){t.updateRequiredStatement()})},t.prototype.openAttribution=function(){this.$attribution.show(),this.isAttributionOpen=!0},t.prototype.closeAttribution=function(){this.$attribution.hide(),this.isAttributionOpen=!1},t.prototype.updateRequiredStatement=function(){var e=this,t=this.extension.helper.getRequiredStatement(),n=Utils.Bools.getBool(this.options.requiredStatementEnabled,!0);if(t&&t.value&&n){this.openAttribution();var i=this.$attribution.find(".title"),r=this.$attribution.find(".attribution-text"),s=this.$attribution.find(".license"),a=this.$attribution.find(".logo");if(t.label){var u=o.UVUtils.sanitize(t.label);i.html(u)}else i.text(this.content.attribution);if(t.value){var l=o.UVUtils.sanitize(t.value);r.html(l),r.find("img").one("load",function(){e.resize()}).each(function(){this.complete&&$(this).load()}),r.targetBlank()}s.hide(),a.hide(),this.resize()}},t.prototype.resize=function(){e.prototype.resize.call(this);var t=this.extension.shell.$leftPanel.is(":visible")?Math.floor(this.extension.shell.$leftPanel.width()):0,n=this.extension.shell.$rightPanel.is(":visible")?Math.floor(this.extension.shell.$rightPanel.width()):0,r=Math.floor(this.$element.parent().width()-t-n);this.$element.css({left:t,width:r});var s,a;if(s=this.options&&this.options.titleEnabled===!1||!this.$title.is(":visible")?0:this.$title.height(),a=this.options&&this.options.subtitleEnabled===!1||!this.$subtitle.is(":visible")?0:this.$subtitle.height(),this.$content.height(this.$element.height()-s-a),this.$content.width(this.$element.width()),this.$attribution&&this.isAttributionOpen){switch(this.attributionPosition){case i.Position.BOTTOM_LEFT:this.$attribution.css("top",this.$content.height()-this.$attribution.outerHeight()-this.$attribution.verticalMargins()),this.$attribution.css("left",0);break;case i.Position.BOTTOM_RIGHT:this.$attribution.css("top",this.$content.height()-this.$attribution.outerHeight()-this.$attribution.verticalMargins()),this.$attribution.css("left",this.$content.width()-this.$attribution.outerWidth()-this.$attribution.horizontalMargins())}this.$content.width()<=this.$attribution.width()?this.$attribution.hide():this.$attribution.show()}this.subtitle&&this.options.subtitleEnabled?(this.$subtitleText.html(o.UVUtils.sanitize(this.subtitle.replace(/<br\s*[\/]?>/gi,"; "))),this.$subtitleText.removeClass("elided"),this.$subtitle.removeClass("hidden"),this.$subtitleWrapper.css("max-height",this.$content.height()+this.$subtitle.outerHeight()),this.$subtitleWrapper.width(this.$content.width()),this.subtitleExpanded?this.$subtitleText.width(this.$content.width()-this.$subtitleText.horizontalMargins()-2):(this.$subtitleText.width("auto"),this.$subtitleWrapper.width("auto"),this.$subtitleExpand.hide(),this.$subtitleText.width()>this.$content.width()&&(this.$subtitleExpand.show(),this.$subtitleText.addClass("elided"),this.$subtitleText.width(this.$content.width()-(this.$subtitleExpand.outerWidth()+this.$subtitleText.horizontalMargins()))))):this.$subtitle.addClass("hidden")},t}(n.BaseView);t.CenterPanel=r}),!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("IIIFAVComponent",[],t):"object"==typeof exports?exports.IIIFAVComponent=t():e.IIIFAVComponent=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:i})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(t.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)t.d(i,o,function(t){return e[t]}.bind(null,o));return i},t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=36)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.BOOKMARKING="oa:bookmarking",e.CLASSIFYING="oa:classifying",e.COMMENTING="oa:commenting",e.DESCRIBING="oa:describing",e.EDITING="oa:editing",e.HIGHLIGHTING="oa:highlighting",e.IDENTIFYING="oa:identifying",e.LINKING="oa:linking",e.MODERATING="oa:moderating",e.PAINTING="sc:painting",e.QUESTIONING="oa:questioning",e.REPLYING="oa:replying",e.TAGGING="oa:tagging",e.TRANSCRIBING="oad:transcribing"}(t.AnnotationMotivation||(t.AnnotationMotivation={})),function(e){e.AUTO_ADVANCE="auto-advance",e.CONTINUOUS="continuous",e.FACING_PAGES="facing-pages",e.HIDDEN="hidden",e.INDIVIDUALS="individuals",e.MULTI_PART="multi-part",e.NO_NAV="no-nav",e.NON_PAGED="non-paged",e.PAGED="paged",e.REPEAT="repeat",e.SEQUENCE="sequence",e.THUMBNAIL_NAV="thumbnail-nav",e.TOGETHER="together",e.UNORDERED="unordered"}(t.Behavior||(t.Behavior={})),function(e){e.CANVAS="canvas",e.CHOICE="choice",e.OA_CHOICE="oa:choice",e.CONTENT_AS_TEXT="contentastext",e.DATASET="dataset",e.DOCUMENT="document",e.IMAGE="image",e.MODEL="model",e.MOVING_IMAGE="movingimage",e.PDF="pdf",e.PHYSICAL_OBJECT="physicalobject",e.SOUND="sound",e.TEXT="text",e.TEXTUALBODY="textualbody",e.VIDEO="video"}(t.ExternalResourceType||(t.ExternalResourceType={})),function(e){e.ANNOTATION="annotation",e.CANVAS="canvas",e.COLLECTION="collection",e.MANIFEST="manifest",e.RANGE="range",e.SEQUENCE="sequence"}(t.IIIFResourceType||(t.IIIFResourceType={})),function(e){e.AUDIO_MP4="audio/mp4",e.CORTO="application/corto",e.DICOM="application/dicom",e.DRACO="application/draco",e.EPUB="application/epub+zip",e.GLB="model/gltf-binary",e.GLTF="model/gltf+json",e.IIIF_PRESENTATION_2='application/ld+json;profile="http://iiif.io/api/presentation/2/context.json"',e.IIIF_PRESENTATION_3='application/ld+json;profile="http://iiif.io/api/presentation/3/context.json"',e.JPG="image/jpeg",e.M3U8="application/vnd.apple.mpegurl",e.MP3="audio/mp3",e.MPEG_DASH="application/dash+xml",e.OBJ="text/plain",e.OPF="application/oebps-package+xml",e.PDF="application/pdf",e.PLY="application/ply",e.THREEJS="application/vnd.threejs+json",e.USDZ="model/vnd.usd+zip",e.VIDEO_MP4="video/mp4",e.WEBM="video/webm"}(t.MediaType||(t.MediaType={})),function(e){e.DOC="application/msword",e.DOCX="application/vnd.openxmlformats-officedocument.wordprocessingml.document",e.PDF="application/pdf"}(t.RenderingFormat||(t.RenderingFormat={})),function(e){e.IMAGE_0_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0",
e.IMAGE_0_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1",e.IMAGE_0_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2",e.IMAGE_0_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0",e.IMAGE_0_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1",e.IMAGE_0_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2",e.IMAGE_1_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",e.IMAGE_1_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",e.IMAGE_1_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",e.IMAGE_1_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",e.IMAGE_1_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",e.IMAGE_1_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",e.IMAGE_1_LEVEL_0="http://iiif.io/api/image/1/level0.json",e.IMAGE_1_PROFILE_LEVEL_0="http://iiif.io/api/image/1/profiles/level0.json",e.IMAGE_1_LEVEL_1="http://iiif.io/api/image/1/level1.json",e.IMAGE_1_PROFILE_LEVEL_1="http://iiif.io/api/image/1/profiles/level1.json",e.IMAGE_1_LEVEL_2="http://iiif.io/api/image/1/level2.json",e.IMAGE_1_PROFILE_LEVEL_2="http://iiif.io/api/image/1/profiles/level2.json",e.IMAGE_2_LEVEL_0="http://iiif.io/api/image/2/level0.json",e.IMAGE_2_PROFILE_LEVEL_0="http://iiif.io/api/image/2/profiles/level0.json",e.IMAGE_2_LEVEL_1="http://iiif.io/api/image/2/level1.json",e.IMAGE_2_PROFILE_LEVEL_1="http://iiif.io/api/image/2/profiles/level1.json",e.IMAGE_2_LEVEL_2="http://iiif.io/api/image/2/level2.json",e.IMAGE_2_PROFILE_LEVEL_2="http://iiif.io/api/image/2/profiles/level2.json",e.AUTH_0_CLICK_THROUGH="http://iiif.io/api/auth/0/login/clickthrough",e.AUTH_0_LOGIN="http://iiif.io/api/auth/0/login",e.AUTH_0_LOGOUT="http://iiif.io/api/auth/0/logout",e.AUTH_0_RESTRICTED="http://iiif.io/api/auth/0/login/restricted",e.AUTH_0_TOKEN="http://iiif.io/api/auth/0/token",e.AUTH_1_CLICK_THROUGH="http://iiif.io/api/auth/1/clickthrough",e.AUTH_1_EXTERNAL="http://iiif.io/api/auth/1/external",e.AUTH_1_KIOSK="http://iiif.io/api/auth/1/kiosk",e.AUTH_1_LOGIN="http://iiif.io/api/auth/1/login",e.AUTH_1_LOGOUT="http://iiif.io/api/auth/1/logout",e.AUTH_1_PROBE="http://iiif.io/api/auth/1/probe",e.AUTH_1_TOKEN="http://iiif.io/api/auth/1/token",e.SEARCH_0="http://iiif.io/api/search/0/search",e.SEARCH_0_AUTO_COMPLETE="http://iiif.io/api/search/0/autocomplete",e.SEARCH_1="http://iiif.io/api/search/1/search",e.SEARCH_1_AUTO_COMPLETE="http://iiif.io/api/search/1/autocomplete",e.TRACKING_EXTENSIONS="http://universalviewer.io/tracking-extensions-profile",e.UI_EXTENSIONS="http://universalviewer.io/ui-extensions-profile",e.PRINT_EXTENSIONS="http://universalviewer.io/print-extensions-profile",e.SHARE_EXTENSIONS="http://universalviewer.io/share-extensions-profile",e.OTHER_MANIFESTATIONS="http://iiif.io/api/otherManifestations.json",e.IXIF="http://wellcomelibrary.org/ld/ixif/0/alpha.json"}(t.ServiceProfile||(t.ServiceProfile={})),function(e){e.BOTTOM_TO_TOP="bottom-to-top",e.LEFT_TO_RIGHT="left-to-right",e.RIGHT_TO_LEFT="right-to-left",e.TOP_TO_BOTTOM="top-to-bottom"}(t.ViewingDirection||(t.ViewingDirection={})),function(e){e.CONTINUOUS="continuous",e.INDIVIDUALS="individuals",e.NON_PAGED="non-paged",e.PAGED="paged",e.TOP="top"}(t.ViewingHint||(t.ViewingHint={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONTINUE=100,t.SWITCHING_PROTOCOLS=101,t.PROCESSING=102,t.OK=200,t.CREATED=201,t.ACCEPTED=202,t.NON_AUTHORITATIVE_INFORMATION=203,t.NO_CONTENT=204,t.RESET_CONTENT=205,t.PARTIAL_CONTENT=206,t.MULTI_STATUS=207,t.MULTIPLE_CHOICES=300,t.MOVED_PERMANENTLY=301,t.MOVED_TEMPORARILY=302,t.SEE_OTHER=303,t.NOT_MODIFIED=304,t.USE_PROXY=305,t.TEMPORARY_REDIRECT=307,t.BAD_REQUEST=400,t.UNAUTHORIZED=401,t.PAYMENT_REQUIRED=402,t.FORBIDDEN=403,t.NOT_FOUND=404,t.METHOD_NOT_ALLOWED=405,t.NOT_ACCEPTABLE=406,t.PROXY_AUTHENTICATION_REQUIRED=407,t.REQUEST_TIME_OUT=408,t.CONFLICT=409,t.GONE=410,t.LENGTH_REQUIRED=411,t.PRECONDITION_FAILED=412,t.REQUEST_ENTITY_TOO_LARGE=413,t.REQUEST_URI_TOO_LARGE=414,t.UNSUPPORTED_MEDIA_TYPE=415,t.REQUESTED_RANGE_NOT_SATISFIABLE=416,t.EXPECTATION_FAILED=417,t.IM_A_TEAPOT=418,t.UNPROCESSABLE_ENTITY=422,t.LOCKED=423,t.FAILED_DEPENDENCY=424,t.UNORDERED_COLLECTION=425,t.UPGRADE_REQUIRED=426,t.PRECONDITION_REQUIRED=428,t.TOO_MANY_REQUESTS=429,t.REQUEST_HEADER_FIELDS_TOO_LARGE=431,t.INTERNAL_SERVER_ERROR=500,t.NOT_IMPLEMENTED=501,t.BAD_GATEWAY=502,t.SERVICE_UNAVAILABLE=503,t.GATEWAY_TIME_OUT=504,t.HTTP_VERSION_NOT_SUPPORTED=505,t.VARIANT_ALSO_NEGOTIATES=506,t.INSUFFICIENT_STORAGE=507,t.BANDWIDTH_LIMIT_EXCEEDED=509,t.NOT_EXTENDED=510,t.NETWORK_AUTHENTICATION_REQUIRED=511},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return window&&window.__DEBUG_AV_COMPONENT__};t.Logger={log:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];i()&&console.log.apply(console,e)},warn:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];i()&&console.warn.apply(console,e)},error:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];i()&&console.error.apply(console,e)},groupCollapsed:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];i()&&console.groupCollapsed.apply(console,e)},group:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];i()&&console.group.apply(console,e)},groupEnd:function(){i()&&console.groupEnd()}}},function(e,t,n){"use strict";n.r(t),n.d(t,"JSONLDResource",function(){return r}),n.d(t,"ManifestResource",function(){return u}),n.d(t,"Resource",function(){return c}),n.d(t,"IIIFResource",function(){return p}),n.d(t,"Annotation",function(){return f}),n.d(t,"AnnotationBody",function(){return v}),n.d(t,"AnnotationList",function(){return m}),n.d(t,"AnnotationPage",function(){return y}),n.d(t,"Canvas",function(){return C}),n.d(t,"Collection",function(){return x}),n.d(t,"Duration",function(){return S}),n.d(t,"LabelValuePair",function(){return P}),n.d(t,"LanguageMap",function(){return L}),n.d(t,"LocalizedValue",function(){return V}),n.d(t,"PropertyValue",function(){return F}),n.d(t,"Manifest",function(){return H}),n.d(t,"ManifestType",function(){return o}),n.d(t,"Range",function(){return W}),n.d(t,"Rendering",function(){return q}),n.d(t,"Sequence",function(){return K}),n.d(t,"Deserialiser",function(){return Y}),n.d(t,"Service",function(){return J}),n.d(t,"Size",function(){return Z}),n.d(t,"StatusCode",function(){return j}),n.d(t,"Thumb",function(){return te}),n.d(t,"Thumbnail",function(){return ie}),n.d(t,"TreeNode",function(){return oe}),n.d(t,"TreeNodeType",function(){return ee}),n.d(t,"Utils",function(){return $}),n.d(t,"loadManifest",function(){return re}),n.d(t,"parseManifest",function(){return se});var i,o,r=function(){function e(e){this.__jsonld=e,this.context=this.getProperty("context"),this.id=this.getProperty("id")}return e.prototype.getProperty=function(e){var t=null;return this.__jsonld&&((t=this.__jsonld[e])||(t=this.__jsonld["@"+e])),t},e}(),s=n(0),a=(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),u=function(e){function t(t,n){var i=e.call(this,t)||this;return i.options=n,i}return a(t,e),t.prototype.getIIIFResourceType=function(){return $.normaliseType(this.getProperty("type"))},t.prototype.getLabel=function(){var e=this.getProperty("label");return e?F.parse(e,this.options.locale):new F([],this.options.locale)},t.prototype.getDefaultLabel=function(){return this.getLabel().getValue(this.options.locale)},t.prototype.getMetadata=function(){var e=this.getProperty("metadata"),t=[];if(!e)return t;for(var n=0;n<e.length;n++){var i=e[n],o=new P(this.options.locale);o.parse(i),t.push(o)}return t},t.prototype.getRendering=function(e){for(var t=this.getRenderings(),n=0;n<t.length;n++){var i=t[n];if(i.getFormat()===e)return i}return null},t.prototype.getRenderings=function(){var e,t=[];if(!(e=this.__jsonld?this.__jsonld.rendering:this.rendering))return t;Array.isArray(e)||(e=[e]);for(var n=0;n<e.length;n++){var i=e[n];t.push(new q(i,this.options))}return t},t.prototype.getService=function(e){return $.getService(this,e)},t.prototype.getServices=function(){return $.getServices(this)},t.prototype.getThumbnail=function(){var e=this.getProperty("thumbnail");return Array.isArray(e)&&(e=e[0]),e?new ie(e,this.options):null},t.prototype.isAnnotation=function(){return this.getIIIFResourceType()===s.IIIFResourceType.ANNOTATION},t.prototype.isCanvas=function(){return this.getIIIFResourceType()===s.IIIFResourceType.CANVAS},t.prototype.isCollection=function(){return this.getIIIFResourceType()===s.IIIFResourceType.COLLECTION},t.prototype.isManifest=function(){return this.getIIIFResourceType()===s.IIIFResourceType.MANIFEST},t.prototype.isRange=function(){return this.getIIIFResourceType()===s.IIIFResourceType.RANGE},t.prototype.isSequence=function(){return this.getIIIFResourceType()===s.IIIFResourceType.SEQUENCE},t}(r),l=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),c=function(e){function t(t,n){return e.call(this,t,n)||this}return l(t,e),t.prototype.getFormat=function(){var e=this.getProperty("format");return e?e.toLowerCase():null},t.prototype.getResources=function(){var e=[];if(!this.__jsonld.resources)return e;for(var t=0;t<this.__jsonld.resources.length;t++){var n=this.__jsonld.resources[t],i=new f(n,this.options);e.push(i)}return e},t.prototype.getType=function(){var e=this.getProperty("type");return e?$.normaliseType(e):null},t.prototype.getWidth=function(){return this.getProperty("width")},t.prototype.getHeight=function(){return this.getProperty("height")},t.prototype.getMaxWidth=function(){return this.getProperty("maxWidth")},t.prototype.getMaxHeight=function(){return this.getProperty("maxHeight")?null:this.getMaxWidth()},t}(u),h=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),p=function(e){function t(t,n){var i=e.call(this,t,n)||this;i.index=-1,i.isLoaded=!1;var o={defaultLabel:"-",locale:"en-GB",resource:i,pessimisticAccessControl:!1};return i.options=Object.assign(o,n),i}return h(t,e),t.prototype.getAttribution=function(){var e=this.getProperty("attribution");return e?F.parse(e,this.options.locale):new F([],this.options.locale)},t.prototype.getDescription=function(){var e=this.getProperty("description");return e?F.parse(e,this.options.locale):new F([],this.options.locale)},t.prototype.getHomepage=function(){var e=this.getProperty("homepage");return e?"string"==typeof e?e:(Array.isArray(e)&&e.length&&(e=e[0]),e["@id"]||e.id):null},t.prototype.getIIIFResourceType=function(){return $.normaliseType(this.getProperty("type"))},t.prototype.getLogo=function(){var e=this.getProperty("logo");return e?"string"==typeof e?e:(Array.isArray(e)&&e.length&&(e=e[0]),e["@id"]||e.id):null},t.prototype.getLicense=function(){return $.getLocalisedValue(this.getProperty("license"),this.options.locale)},t.prototype.getNavDate=function(){return new Date(this.getProperty("navDate"))},t.prototype.getRelated=function(){return this.getProperty("related")},t.prototype.getSeeAlso=function(){return this.getProperty("seeAlso")},t.prototype.getTrackingLabel=function(){var e=this.getService(s.ServiceProfile.TRACKING_EXTENSIONS);return e?e.getProperty("trackingLabel"):""},t.prototype.getDefaultTree=function(){return this.defaultTree=new oe("root"),this.defaultTree.data=this,this.defaultTree},t.prototype.getRequiredStatement=function(){var e=null,t=this.getProperty("requiredStatement");if(t)(e=new P(this.options.locale)).parse(t);else{var n=this.getAttribution();n&&((e=new P(this.options.locale)).value=n)}return e},t.prototype.isCollection=function(){return this.getIIIFResourceType()===s.IIIFResourceType.COLLECTION},t.prototype.isManifest=function(){return this.getIIIFResourceType()===s.IIIFResourceType.MANIFEST},t.prototype.load=function(){var e=this;return new Promise(function(t){if(e.isLoaded)t(e);else{var n=e.options;n.navDate=e.getNavDate();var i=e.__jsonld.id;i||(i=e.__jsonld["@id"]),$.loadManifest(i).then(function(i){e.parentLabel=e.getLabel().getValue(n.locale);var o=Y.parse(i,n);(e=Object.assign(e,o)).index=n.index,t(e)})}})},t}(u),d=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),f=function(e){function t(t,n){return e.call(this,t,n)||this}return d(t,e),t.prototype.getBody=function(){var e=[],t=this.getProperty("body");if(t)if(Array.isArray(t))for(var n=0;n<t.length;n++)if((r=t[n]).items)for(var i=0;i<r.items.length;i++){var o=r.items[i];e.push(new v(o,this.options))}else e.push(new v(r,this.options));else if(t.items)for(n=0;n<t.items.length;n++){var r=t.items[n];e.push(new v(r,this.options))}else e.push(new v(t,this.options));return e},t.prototype.getMotivation=function(){var e=this.getProperty("motivation");return e||null},t.prototype.getOn=function(){return this.getProperty("on")},t.prototype.getTarget=function(){return this.getProperty("target")},t.prototype.getResource=function(){return new c(this.getProperty("resource"),this.options)},t}(u),g=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),v=function(e){function t(t,n){return e.call(this,t,n)||this}return g(t,e),t.prototype.getFormat=function(){var e=this.getProperty("format");return e?$.getMediaType(e):null},t.prototype.getType=function(){return this.getProperty("type")?$.normaliseType(this.getProperty("type")):null},t.prototype.getWidth=function(){return this.getProperty("width")},t.prototype.getHeight=function(){return this.getProperty("height")},t}(u),_=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),m=function(e){function t(t,n,i){var o=e.call(this,n)||this;return o.label=t,o.options=i,o}return _(t,e),t.prototype.getIIIFResourceType=function(){return $.normaliseType(this.getProperty("type"))},t.prototype.getLabel=function(){return this.label},t.prototype.getResources=function(){var e=this;return this.getProperty("resources").map(function(t){return new f(t,e.options)})},t.prototype.load=function(){var e=this;return new Promise(function(t,n){if(e.isLoaded)t(e);else{var i=e.__jsonld.id;i||(i=e.__jsonld["@id"]),$.loadManifest(i).then(function(n){e.__jsonld=n,e.context=e.getProperty("context"),e.id=e.getProperty("id"),e.isLoaded=!0,t(e)})["catch"](n)}})},t}(r),E=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),y=function(e){function t(t,n){return e.call(this,t,n)||this}return E(t,e),t.prototype.getItems=function(){return this.getProperty("items")},t}(u),b=n(7),I=n.n(b),T=n(21),O=n.n(T),A=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),C=function(e){function t(t,n){return e.call(this,t,n)||this}return A(t,e),t.prototype.getCanonicalImageUri=function(e){var t,n=null,i="default",o=e;if(this.externalResource&&this.externalResource.data&&this.externalResource.data["@id"])n=this.externalResource.data["@id"],o||(o=this.externalResource.data.width),this.externalResource.data["@context"]&&(this.externalResource.data["@context"].indexOf("/1.0/context.json")>-1||this.externalResource.data["@context"].indexOf("/1.1/context.json")>-1||this.externalResource.data["@context"].indexOf("/1/context.json")>-1)&&(i="native");else{var r=this.getImages();if(r&&r.length){var s=r[0].getResource(),a=s.getServices();if(o||(o=s.getWidth()),a.length){var u=a[0];n=u.id,i=$.getImageQuality(u.getProfile())}else if(o===s.getWidth())return s.id}if(!n){var l=this.getProperty("thumbnail");if(l){if("string"==typeof l)return l;if(l["@id"])return l["@id"];if(l.length)return l[0].id}}}return t=o+",",n&&n.endsWith("/")&&(n=n.substr(0,n.length-1)),[n,"full",t,0,i+".jpg"].join("/")},t.prototype.getMaxDimensions=function(){var e,t=null;return this.externalResource&&this.externalResource.data&&this.externalResource.data.profile&&(e=this.externalResource.data.profile,Array.isArray(e)&&(e=e.filter(function(e){return e.maxWidth})[0])&&(t=new Z(e.maxWidth,e.maxHeight?e.maxHeight:e.maxWidth))),t},t.prototype.getContent=function(){var e=[],t=this.__jsonld.items||this.__jsonld.content;if(!t)return e;var n=null;if(t.length&&(n=new y(t[0],this.options)),!n)return e;for(var i=n.getItems(),o=0;o<i.length;o++){var r=i[o],s=new f(r,this.options);e.push(s)}return e},t.prototype.getDuration=function(){return this.getProperty("duration")},t.prototype.getImages=function(){var e=[];if(!this.__jsonld.images)return e;for(var t=0;t<this.__jsonld.images.length;t++){var n=this.__jsonld.images[t],i=new f(n,this.options);e.push(i)}return e},t.prototype.getIndex=function(){return this.getProperty("index")},t.prototype.getOtherContent=function(){var e=this,t=Array.isArray(this.getProperty("otherContent"))?this.getProperty("otherContent"):[this.getProperty("otherContent")],n=t.filter(function(e){return e&&(t=e["@type"],n="sc:AnnotationList","string"==typeof t&&"string"==typeof n&&t.toLowerCase()==t.toLowerCase());var t,n}).map(function(t,n){return new m(t.label||"Annotation list "+n,t,e.options)}).map(function(e){return e.load()});return Promise.all(n)},t.prototype.getWidth=function(){return this.getProperty("width")},t.prototype.getHeight=function(){return this.getProperty("height")},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},Object.defineProperty(t.prototype,"imageResources",{get:function(){var e=this,n=O()([this.getImages().map(function(e){return e.getResource()}),this.getContent().map(function(e){return e.getBody()})]);return I()(n.map(function(n){switch(n.getProperty("type").toLowerCase()){case s.ExternalResourceType.CHOICE:case s.ExternalResourceType.OA_CHOICE:return new t({images:I()([n.getProperty("default"),n.getProperty("item")]).map(function(e){return{resource:e}})},e.options).getImages().map(function(e){return e.getResource()});default:return n}}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resourceAnnotations",{get:function(){return O()([this.getImages(),this.getContent()])},enumerable:!0,configurable:!0}),t.prototype.resourceAnnotation=function(e){return this.resourceAnnotations.find(function(t){return t.getResource().id===e||I()(new Array(t.getBody())).some(function(t){return t.id===e})})},t.prototype.onFragment=function(e){var t=this.resourceAnnotation(e);if(t){var n=t.getProperty("on"),i=t.getProperty("target"),o=(n||i).match(/xywh=(.*)$/);if(o)return o[1].split(",").map(function(e){return parseInt(e,10)})}},Object.defineProperty(t.prototype,"iiifImageResources",{get:function(){return this.imageResources.filter(function(e){return e&&e.getServices()[0]&&e.getServices()[0].id})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageServiceIds",{get:function(){return this.iiifImageResources.map(function(e){return e.getServices()[0].id})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"aspectRatio",{get:function(){return this.getWidth()/this.getHeight()},enumerable:!0,configurable:!0}),t}(c),w=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),x=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.items=[],i._collections=null,i._manifests=null,t.__collection=i,i}return w(t,e),t.prototype.getCollections=function(){return this._collections?this._collections:this._collections=this.items.filter(function(e){return e.isCollection()})},t.prototype.getManifests=function(){return this._manifests?this._manifests:this._manifests=this.items.filter(function(e){return e.isManifest()})},t.prototype.getCollectionByIndex=function(e){for(var t,n=this.getCollections(),i=0;i<n.length;i++){var o=n[i];o.index===e&&(t=o)}if(t)return t.options.index=e,t.load();throw new Error("Collection index not found")},t.prototype.getManifestByIndex=function(e){for(var t,n=this.getManifests(),i=0;i<n.length;i++){var o=n[i];o.index===e&&(t=o)}if(t)return t.options.index=e,t.load();throw new Error("Manifest index not found")},t.prototype.getTotalCollections=function(){return this.getCollections().length},t.prototype.getTotalManifests=function(){return this.getManifests().length},t.prototype.getTotalItems=function(){return this.items.length},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?this.getProperty("viewingDirection"):s.ViewingDirection.LEFT_TO_RIGHT},t.prototype.getBehavior=function(){var e=this.getProperty("behavior");return Array.isArray(e)&&(e=e[0]),e||null},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t.prototype.getDefaultTree=function(){return e.prototype.getDefaultTree.call(this),this.defaultTree.data.type=$.normaliseType(ee.COLLECTION),this._parseManifests(this),this._parseCollections(this),$.generateTreeNodeIds(this.defaultTree),this.defaultTree},t.prototype._parseManifests=function(e){if(e.getManifests()&&e.getManifests().length)for(var t=0;t<e.getManifests().length;t++){var n=e.getManifests()[t],i=n.getDefaultTree();i.label=n.parentLabel||n.getLabel().getValue(this.options.locale)||"manifest "+(t+1),i.navDate=n.getNavDate(),i.data.id=n.id,i.data.type=$.normaliseType(ee.MANIFEST),e.defaultTree.addNode(i)}},t.prototype._parseCollections=function(e){if(e.getCollections()&&e.getCollections().length)for(var t=0;t<e.getCollections().length;t++){var n=e.getCollections()[t],i=n.getDefaultTree();i.label=n.parentLabel||n.getLabel().getValue(this.options.locale)||"collection "+(t+1),i.navDate=n.getNavDate(),i.data.id=n.id,i.data.type=$.normaliseType(ee.COLLECTION),e.defaultTree.addNode(i)}},t}(p),S=function(){function e(e,t){this.start=e,this.end=t}return e.prototype.getLength=function(){return this.end-this.start},e}(),P=function(){function e(e){this.defaultLocale=e}return e.prototype.parse=function(e){this.resource=e,this.label=F.parse(this.resource.label,this.defaultLocale),this.value=F.parse(this.resource.value,this.defaultLocale)},e.prototype.getLabel=function(e){return null===this.label?null:(Array.isArray(e)&&!e.length&&(e=void 0),this.label.getValue(e||this.defaultLocale))},e.prototype.setLabel=function(e){null===this.label&&(this.label=new F([])),this.label.setValue(e,this.defaultLocale)},e.prototype.getValue=function(e,t){return void 0===t&&(t="<br/>"),null===this.value?null:(Array.isArray(e)&&!e.length&&(e=void 0),this.value.getValue(e||this.defaultLocale,t))},e.prototype.getValues=function(e){return null===this.value?[]:(Array.isArray(e)&&!e.length&&(e=void 0),this.value.getValues(e||this.defaultLocale))},e.prototype.setValue=function(e){null===this.value&&(this.value=new F([])),this.value.setValue(e,this.defaultLocale)},e}(),R=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),L=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return R(t,e),t.getValue=function(e,t){return e.getValue(t,"<br/>")},t.getValues=function(e,t){return e.getValues(t)},t}(Array),N=n(1),D=(n(49),function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{u(i.next(e))}catch(e){r(e)}}function a(e){try{u(i["throw"](e))}catch(e){r(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}u((i=i.apply(e,t||[])).next())})}),M=function(e,t){function n(e){return function(n){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(r=2&e[0]?o["return"]:e[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,e[1])).done)return r;switch(o=0,r&&(e=[2&e[0],r.value]),e[0]){case 0:case 1:r=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(r=a.trys,!((r=r.length>0&&r[r.length-1])||6!==e[0]&&2!==e[0])){a=0;continue}if(3===e[0]&&(!r||e[1]>r[0]&&e[1]<r[3])){a.label=e[1];break}if(6===e[0]&&a.label<r[1]){a.label=r[1],r=e;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(e);break}r[2]&&a.ops.pop(),a.trys.pop();continue}e=t.call(n,a)}catch(n){e=[6,n],o=0}finally{i=r=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,n])}}var i,o,r,s,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},$=function(){function e(){}return e.getMediaType=function(e){return(e=(e=e.toLowerCase()).split(";")[0]).trim()},e.getImageQuality=function(e){return e===s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1||e===s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2||e===s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_1||e===s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2||e===s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1||e===s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2||e===s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1||e===s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2||e===s.ServiceProfile.IMAGE_1_LEVEL_1||e===s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1||e===s.ServiceProfile.IMAGE_1_LEVEL_2||e===s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2?"native":"default"},e.getInexactLocale=function(e){return-1!==e.indexOf("-")?e.substr(0,e.indexOf("-")):e},e.getLocalisedValue=function(e,t){if(!Array.isArray(e))return e;for(var n=0;n<e.length;n++){var i=e[n];if(t===i["@language"])return i["@value"]}var o=t.substr(0,t.indexOf("-"));for(n=0;n<e.length;n++){var r=e[n];if(r["@language"]===o)return r["@value"]}return null},e.generateTreeNodeIds=function(t,n){var i;void 0===n&&(n=0),i=t.parentNode?t.parentNode.id+"-"+n:"0",t.id=i;for(var o=0;o<t.nodes.length;o++){var r=t.nodes[o];e.generateTreeNodeIds(r,o)}},e.normaliseType=function(e){return-1!==(e=(e||"").toLowerCase()).indexOf(":")?e.split(":")[1]:e},e.normaliseUrl=function(e){return-1!==(e=e.substr(e.indexOf("://"))).indexOf("#")&&(e=e.split("#")[0]),e},e.normalisedUrlsMatch=function(t,n){return e.normaliseUrl(t)===e.normaliseUrl(n)},e.isImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_PROFILE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_PROFILE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_PROFILE_LEVEL_2))},e.isLevel0ImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_PROFILE_LEVEL_0))},e.isLevel1ImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_PROFILE_LEVEL_1))},e.isLevel2ImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_PROFILE_LEVEL_2))},e.parseManifest=function(e,t){return Y.parse(e,t)},e.checkStatus=function(e){if(e.ok)return e;var t=new Error(e.statusText);return t.response=e,Promise.reject(t)},e.loadManifest=function(t){return new Promise(function(n,i){fetch(t).then(e.checkStatus).then(function(e){return e.json();
}).then(function(e){n(e)})["catch"](function(e){i()})})},e.loadExternalResourcesAuth1=function(t,n,i,o,r,s,a,u){return new Promise(function(l,c){var h=t.map(function(t){return e.loadExternalResourceAuth1(t,n,i,o,r,s,a,u)});Promise.all(h).then(function(){l(t)})["catch"](function(e){c(e)})})},e.loadExternalResourceAuth1=function(t,n,i,o,r,s,a,u){return D(this,void 0,void 0,function(){var l;return M(this,function(c){switch(c.label){case 0:return[4,o(t)];case 1:return(l=c.sent())?[4,t.getData(l)]:[3,6];case 2:return c.sent(),t.status!==N.OK?[3,3]:[2,t];case 3:return[4,e.doAuthChain(t,n,i,r,s,a,u)];case 4:c.sent(),c.label=5;case 5:if(t.status===N.OK||t.status===N.MOVED_TEMPORARILY)return[2,t];throw e.createAuthorizationFailedError();case 6:return[4,t.getData()];case 7:return c.sent(),t.status!==N.MOVED_TEMPORARILY&&t.status!==N.UNAUTHORIZED?[3,9]:[4,e.doAuthChain(t,n,i,r,s,a,u)];case 8:c.sent(),c.label=9;case 9:if(t.status===N.OK||t.status===N.MOVED_TEMPORARILY)return[2,t];throw e.createAuthorizationFailedError()}})})},e.doAuthChain=function(t,n,i,o,r,s,a){return D(this,void 0,void 0,function(){var u,l,c,h,p,d,f,g;return M(this,function(v){switch(v.label){case 0:return t.isAccessControlled()?((u=t.externalService)&&(u.options=t.options),(l=t.kioskService)&&(l.options=t.options),(c=t.clickThroughService)&&(c.options=t.options),(h=t.loginService)&&(h.options=t.options),t.isResponseHandled||t.status!==N.MOVED_TEMPORARILY?[3,2]:[4,s(t)]):[2,t];case 1:return v.sent(),[2,t];case 2:return p=null,d=null,(p=u)?(d=p,[4,e.attemptResourceWithToken(t,i,p)]):[3,4];case 3:return v.sent(),[2,t];case 4:return(p=l)?(d=p,(f=n(p))?[4,o(f)]:[3,7]):[3,7];case 5:return v.sent(),[4,e.attemptResourceWithToken(t,i,p)];case 6:return v.sent(),[2,t];case 7:return(p=c)?(d=p,[4,r(t,p)]):[3,11];case 8:return(g=v.sent())?[4,o(g)]:[3,11];case 9:return v.sent(),[4,e.attemptResourceWithToken(t,i,p)];case 10:return v.sent(),[2,t];case 11:return(p=h)?(d=p,[4,r(t,p)]):[3,15];case 12:return(g=v.sent())?[4,o(g)]:[3,15];case 13:return v.sent(),[4,e.attemptResourceWithToken(t,i,p)];case 14:return v.sent(),[2,t];case 15:return d&&a(t,d),[2]}})})},e.attemptResourceWithToken=function(e,t,n){return D(this,void 0,void 0,function(){var i,o;return M(this,function(r){switch(r.label){case 0:return(i=n.getService(s.ServiceProfile.AUTH_1_TOKEN))?[4,t(e,i)]:[3,3];case 1:return(o=r.sent())&&o.accessToken?[4,e.getData(o)]:[3,3];case 2:return r.sent(),[2,e];case 3:return[2]}})})},e.loadExternalResourcesAuth09=function(t,n,i,o,r,s,a,u,l,c){return new Promise(function(h,p){var d=t.map(function(t){return e.loadExternalResourceAuth09(t,n,i,o,r,s,a,u,l,c)});Promise.all(d).then(function(){h(t)})["catch"](function(e){p(e)})})},e.loadExternalResourceAuth09=function(t,n,i,o,r,s,a,u,l,c){return new Promise(function(h,p){c&&c.pessimisticAccessControl?t.getData().then(function(){t.isAccessControlled()?t.clickThroughService?(h(i(t)),h(o(t))):r(t).then(function(){s(t,!0).then(function(n){t.getData(n).then(function(){h(l(t))})["catch"](function(t){p(e.createInternalServerError(t))})})["catch"](function(t){p(e.createInternalServerError(t))})})["catch"](function(t){p(e.createInternalServerError(t))}):h(t)})["catch"](function(t){p(e.createInternalServerError(t))}):u(t,n).then(function(c){c?t.getData(c).then(function(){t.status===N.OK?h(l(t)):e.authorize(t,n,i,o,r,s,a,u).then(function(){h(l(t))})["catch"](function(t){p(e.createAuthorizationFailedError())})})["catch"](function(t){p(e.createAuthorizationFailedError())}):e.authorize(t,n,i,o,r,s,a,u).then(function(){h(l(t))})["catch"](function(t){p(e.createAuthorizationFailedError())})})["catch"](function(t){p(e.createAuthorizationFailedError())})})},e.createError=function(e,t){var n=new Error;return n.message=t,n.name=String(e),n},e.createAuthorizationFailedError=function(){return e.createError(j.AUTHORIZATION_FAILED,"Authorization failed")},e.createRestrictedError=function(){return e.createError(j.RESTRICTED,"Restricted")},e.createInternalServerError=function(t){return e.createError(j.INTERNAL_SERVER_ERROR,t)},e.authorize=function(t,n,i,o,r,s,a,u){return new Promise(function(l,c){t.getData().then(function(){t.isAccessControlled()?u(t,n).then(function(u){u?t.getData(u).then(function(){t.status===N.OK?l(t):e.showAuthInteraction(t,n,i,o,r,s,a,l,c)})["catch"](function(t){c(e.createInternalServerError(t))}):s(t,!1).then(function(u){u?a(t,u,n).then(function(){t.getData(u).then(function(){t.status===N.OK?l(t):e.showAuthInteraction(t,n,i,o,r,s,a,l,c)})["catch"](function(t){c(e.createInternalServerError(t))})})["catch"](function(t){c(e.createInternalServerError(t))}):e.showAuthInteraction(t,n,i,o,r,s,a,l,c)})})["catch"](function(t){c(e.createInternalServerError(t))}):l(t)})})},e.showAuthInteraction=function(t,n,i,o,r,s,a,u,l){t.status!==N.MOVED_TEMPORARILY||t.isResponseHandled?t.clickThroughService&&!t.isResponseHandled?i(t).then(function(){s(t,!0).then(function(i){a(t,i,n).then(function(){t.getData(i).then(function(){u(t)})["catch"](function(t){l(e.createInternalServerError(t))})})["catch"](function(t){l(e.createInternalServerError(t))})})["catch"](function(t){l(e.createInternalServerError(t))})}):r(t).then(function(){s(t,!0).then(function(i){a(t,i,n).then(function(){t.getData(i).then(function(){u(t)})["catch"](function(t){l(e.createInternalServerError(t))})})["catch"](function(t){l(e.createInternalServerError(t))})})["catch"](function(t){l(e.createInternalServerError(t))})}):u(t)},e.getService=function(e,t){for(var n=this.getServices(e),i=0;i<n.length;i++){var o=n[i];if(o.getProfile()===t)return o}return null},e.getResourceById=function(t,n){return e.traverseAndFind(t.__jsonld,"@id",n)},e.traverseAndFind=function(t,n,i){if(t.hasOwnProperty(n)&&t[n]===i)return t;for(var o=0;o<Object.keys(t).length;o++)if("object"==typeof t[Object.keys(t)[o]]){var r=e.traverseAndFind(t[Object.keys(t)[o]],n,i);if(null!=r)return r}},e.getServices=function(e){var t,n=[];if(!(t=e.__jsonld?e.__jsonld.service:e.service))return n;Array.isArray(t)||(t=[t]);for(var i=0;i<t.length;i++){var o=t[i];if("string"==typeof o){var r=this.getResourceById(e.options.resource,o);r&&n.push(new J(r.__jsonld||r,e.options))}else n.push(new J(o,e.options))}return n},e.getTemporalComponent=function(e){var t=/t=([^&]+)/g.exec(e),n=null;return t&&t[1]&&(n=t[1].split(",")),n},e}(),B=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),U=function(){for(var e=0,t=0,n=arguments.length;n>t;t++)e+=arguments[t].length;var i=Array(e),o=0;for(t=0;n>t;t++)for(var r=arguments[t],s=0,a=r.length;a>s;s++,o++)i[o]=r[s];return i},V=function(){function e(e,t,n){void 0===n&&(n="none"),Array.isArray(e)&&1===e.length?this._value=e[0]:this._value=e,"none"!==t&&"@none"!==t||(t=void 0),this._locale=t,this._defaultLocale=n}return e.parseV2Value=function(t,n){return"string"==typeof t?new e(t,void 0,n):t["@value"]?new e(t["@value"],t["@language"],n):null},Object.defineProperty(e.prototype,"value",{get:function(){return Array.isArray(this._value)?this._value.join("<br/>"):this._value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"locale",{get:function(){return void 0===this._locale?this._defaultLocale:this._locale},enumerable:!0,configurable:!0}),e.prototype.addValue=function(e){Array.isArray(this._value)||(this._value=[this._value]),Array.isArray(e)?this._value=this._value.concat(e):this._value.push(e)},e}(),F=function(e){function t(n,i){void 0===n&&(n=[]);var o=e.apply(this,n)||this;return o.__proto__=t.prototype,o._defaultLocale=i,o}return B(t,e),t.parse=function(e,n){if(!e)return new t([],n);if(Array.isArray(e)){var i=(o=e.map(function(e){return V.parseV2Value(e,n)}).filter(function(e){return null!==e})).reduce(function(e,t){var n=t._locale;return n||(n="none"),e[n]?e[n].addValue(t._value):e[n]=t,e},{});return new t(Object.values(i),n)}return"string"==typeof e?new t([new V(e,void 0,n)],n):e["@language"]?new t(null!==(o=V.parseV2Value(e))?[o]:[],n):new t(Object.keys(e).map(function(t){var i=e[t];if(!Array.isArray(i))throw new Error("A IIIF v3 localized property value must have an array as the value for a given language.");return new V(i,t,n)}),n);var o},t.prototype.getSuitableLocale=function(e){for(var t=U(this).map(function(e){return e._locale}).filter(function(e){return void 0!==e}),n=function(e){var n=t.find(function(t){return t===e});return n?{value:n}:void 0},i=0,o=e;i<o.length;i++){var r=n(o[i]);if("object"==typeof r)return r.value}for(var s=function(e){var n=t.find(function(t){return $.getInexactLocale(t)===$.getInexactLocale(e)});return n?{value:n}:void 0},a=0,u=e;a<u.length;a++){var l=s(u[a]);if("object"==typeof l)return l.value}},t.prototype.setValue=function(e,t){var n=void 0;if(t){var i=this.getSuitableLocale([t]);i&&(n=this.find(function(e){return e._locale===i}))}else n=this.find(function(e){return void 0===e._locale});n?n._value=e:this.push(new V(e,t,this._defaultLocale))},t.prototype.getValue=function(e,t){var n=this.getValues(e);return 0===n.length?null:t?n.join(t):n[0]},t.prototype.getValues=function(e){if(!this.length)return[];var t;if(t=e?Array.isArray(e)?e:[e]:[],1===this.length&&void 0===this[0]._locale){var n=this[0]._value;return Array.isArray(n)?n:[n]}var i=this.getSuitableLocale(t);if(i)return n=this.find(function(e){return e._locale===i})._value,Array.isArray(n)?n:[n];if(!this.find(function(e){return void 0===e._locale}))return n=this[0]._value,Array.isArray(n)?n:[n];var o=this.find(function(e){return void 0===e._locale});return o?Array.isArray(o._value)?o._value:[o._value]:[]},t}(Array),G=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),H=function(e){function t(t,n){var i=e.call(this,t,n)||this;if(i.index=0,i._allRanges=null,i.items=[],i._topRanges=[],i.__jsonld.structures&&i.__jsonld.structures.length)for(var o=i._getTopRanges(),r=0;r<o.length;r++){var s=o[r];i._parseRanges(s,String(r))}return i}return G(t,e),t.prototype.getPosterCanvas=function(){var e=this.getProperty("posterCanvas");return e&&(e=new C(e,this.options)),e},t.prototype.getAccompanyingCanvas=function(){var e=this.getProperty("accompanyingCanvas");return e&&(e=new C(e,this.options)),e},t.prototype.getBehavior=function(){var e=this.getProperty("behavior");return Array.isArray(e)&&(e=e[0]),e||null},t.prototype.getDefaultTree=function(){if(e.prototype.getDefaultTree.call(this),this.defaultTree.data.type=$.normaliseType(ee.MANIFEST),!this.isLoaded)return this.defaultTree;var t=this.getTopRanges();return t.length&&t[0].getTree(this.defaultTree),$.generateTreeNodeIds(this.defaultTree),this.defaultTree},t.prototype._getTopRanges=function(){var e=[];if(this.__jsonld.structures&&this.__jsonld.structures.length){for(var t=0;t<this.__jsonld.structures.length;t++){var n=this.__jsonld.structures[t];n.viewingHint===s.ViewingHint.TOP&&e.push(n)}if(!e.length){var i={};i.ranges=this.__jsonld.structures,e.push(i)}}return e},t.prototype.getTopRanges=function(){return this._topRanges},t.prototype._getRangeById=function(e){if(this.__jsonld.structures&&this.__jsonld.structures.length)for(var t=0;t<this.__jsonld.structures.length;t++){var n=this.__jsonld.structures[t];if(n["@id"]===e||n.id===e)return n}return null},t.prototype._parseRanges=function(e,t,n){var i,o=null;if("string"==typeof e&&(o=e,e=this._getRangeById(o)),e){(i=new W(e,this.options)).parentRange=n,i.path=t,n?n.items.push(i):this._topRanges.push(i);var r=e.items||e.members;if(r)for(var s=0;s<r.length;s++){var a=r[s];if(a["@type"]&&"sc:range"===a["@type"].toLowerCase()||a.type&&"range"===a.type.toLowerCase())this._parseRanges(a,t+"/"+s,i);else if(a["@type"]&&"sc:canvas"===a["@type"].toLowerCase()||a.type&&"canvas"===a.type.toLowerCase()){i.canvases||(i.canvases=[]);var u=a.id||a["@id"];i.canvases.push(u)}}else if(e.ranges)for(s=0;s<e.ranges.length;s++)this._parseRanges(e.ranges[s],t+"/"+s,i)}else console.warn("Range:",o,"does not exist")},t.prototype.getAllRanges=function(){if(null!=this._allRanges)return this._allRanges;this._allRanges=[];for(var e=this.getTopRanges(),t=function(t){var i=e[t];i.id&&n._allRanges.push(i);var o=function(e,t){e.add(t);var n=t.getRanges();return n.length?n.reduce(o,e):e},r=Array.from(i.getRanges().reduce(o,new Set));n._allRanges=n._allRanges.concat(r)},n=this,i=0;i<e.length;i++)t(i);return this._allRanges},t.prototype.getRangeById=function(e){for(var t=this.getAllRanges(),n=0;n<t.length;n++){var i=t[n];if(i.id===e)return i}return null},t.prototype.getRangeByPath=function(e){for(var t=this.getAllRanges(),n=0;n<t.length;n++){var i=t[n];if(i.path===e)return i}return null},t.prototype.getSequences=function(){if(this.items.length)return this.items;var e=this.__jsonld.mediaSequences||this.__jsonld.sequences;if(e)for(var t=0;t<e.length;t++){var n=e[t],i=new K(n,this.options);this.items.push(i)}else this.__jsonld.items&&(i=new K(this.__jsonld.items,this.options),this.items.push(i));return this.items},t.prototype.getSequenceByIndex=function(e){return this.getSequences()[e]},t.prototype.getTotalSequences=function(){return this.getSequences().length},t.prototype.getManifestType=function(){var e=this.getService(s.ServiceProfile.UI_EXTENSIONS);return e?e.getProperty("manifestType"):o.EMPTY},t.prototype.isMultiSequence=function(){return this.getTotalSequences()>1},t.prototype.isPagingEnabled=function(){var e=this.getViewingHint();if(e)return e===s.ViewingHint.PAGED;var t=this.getBehavior();return!!t&&t===s.Behavior.PAGED},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t}(p);!function(e){e.EMPTY="",e.MANUSCRIPT="manuscript",e.MONOGRAPH="monograph"}(o||(o={}));var j,k=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),W=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i._ranges=null,i.canvases=null,i.items=[],i}return k(t,e),t.prototype.getCanvasIds=function(){return this.__jsonld.canvases?this.__jsonld.canvases:this.canvases?this.canvases:[]},t.prototype.getDuration=function(){if(this.canvases&&this.canvases.length){for(var e=[],t=[],n=0,i=this.canvases;n<i.length;n++)if(d=i[n]){var o=d.match(/(.*)#t=([0-9.]+),?([0-9.]+)?/)||[void 0,d],r=o[1],s=o[2],a=o[3];r&&(e.push(parseFloat(s)),t.push(parseFloat(a)))}if(e.length&&t.length)return new S(Math.min.apply(Math,e),Math.max.apply(Math,t))}else{e=[],t=[];for(var u=0,l=g=this.getRanges();u<l.length;u++)(v=l[u].getDuration())&&(e.push(v.start),t.push(v.end));if(e.length&&t.length)return new S(Math.min.apply(Math,e),Math.max.apply(Math,t))}var c,h;if(this.canvases&&this.canvases.length)for(var p=0;p<this.canvases.length;p++){var d=this.canvases[p],f=$.getTemporalComponent(d);f&&f.length>1&&(0===p&&(c=Number(f[0])),p===this.canvases.length-1&&(h=Number(f[1])))}else{var g=this.getRanges();for(p=0;p<g.length;p++){var v;(v=g[p].getDuration())&&(0===p&&(c=v.start),p===g.length-1&&(h=v.end))}}return void 0!==c&&void 0!==h?new S(c,h):void 0},t.prototype.getRanges=function(){return this._ranges?this._ranges:this._ranges=this.items.filter(function(e){return e.isRange()})},t.prototype.getBehavior=function(){var e=this.getProperty("behavior");return Array.isArray(e)&&(e=e[0]),e||null},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t.prototype.getTree=function(e){e.data=this,this.treeNode=e;var t=this.getRanges();if(t&&t.length)for(var n=0;n<t.length;n++){var i=t[n],o=new oe;e.addNode(o),this._parseTreeNode(o,i)}return $.generateTreeNodeIds(e),e},t.prototype.spansTime=function(e){var t=this.getDuration();return!!(t&&e>=t.start&&e<=t.end)},t.prototype._parseTreeNode=function(e,t){e.label=t.getLabel().getValue(this.options.locale),e.data=t,e.data.type=$.normaliseType(ee.RANGE),t.treeNode=e;var n=t.getRanges();if(n&&n.length)for(var i=0;i<n.length;i++){var o=n[i];if(o.getBehavior()!==s.Behavior.NO_NAV){var r=new oe;e.addNode(r),this._parseTreeNode(r,o)}}},t}(u),z=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),q=function(e){function t(t,n){return e.call(this,t,n)||this}return z(t,e),t.prototype.getFormat=function(){return this.getProperty("format")},t}(u),X=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),K=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.items=[],i._thumbnails=null,i}return X(t,e),t.prototype.getCanvases=function(){if(this.items.length)return this.items;var e=this.__jsonld.canvases||this.__jsonld.elements;if(e)for(var t=0;t<e.length;t++){var n=e[t];(i=new C(n,this.options)).index=t,this.items.push(i)}else if(this.__jsonld)for(t=0;t<this.__jsonld.length;t++){var i;n=this.__jsonld[t],(i=new C(n,this.options)).index=t,this.items.push(i)}return this.items},t.prototype.getCanvasById=function(e){for(var t=0;t<this.getTotalCanvases();t++){var n=this.getCanvasByIndex(t),i=$.normaliseUrl(n.id);if($.normaliseUrl(e)===i)return n}return null},t.prototype.getCanvasByIndex=function(e){return this.getCanvases()[e]},t.prototype.getCanvasIndexById=function(e){for(var t=0;t<this.getTotalCanvases();t++)if(this.getCanvasByIndex(t).id===e)return t;return null},t.prototype.getCanvasIndexByLabel=function(e,t){e=e.trim(),isNaN(e)||(e=parseInt(e,10).toString(),t&&(e+="r"));for(var n,i,o,r=/(\d*)\D+(\d*)/,s=0;s<this.getTotalCanvases();s++){var a=this.getCanvasByIndex(s);if(a.getLabel().getValue(this.options.locale)===e)return s;if((n=r.exec(e))&&(i=n[1],(o=n[2])&&new RegExp("^"+i+"\\D+"+o+"$").test(a.getLabel().toString())))return s}return-1},t.prototype.getLastCanvasLabel=function(e){for(var t=this.getTotalCanvases()-1;t>=0;t--){var n=this.getCanvasByIndex(t).getLabel().getValue(this.options.locale);if(e){if(/^[a-zA-Z0-9]*$/.test(n))return n}else if(n)return n}return this.options.defaultLabel},t.prototype.getLastPageIndex=function(){return this.getTotalCanvases()-1},t.prototype.getNextPageIndex=function(e,t){var n;if(t){var i=this.getPagedIndices(e),o=this.getViewingDirection();n=o&&o===s.ViewingDirection.RIGHT_TO_LEFT?i[0]+1:i[i.length-1]+1}else n=e+1;return n>this.getLastPageIndex()?-1:n},t.prototype.getPagedIndices=function(e,t){var n=[];if(t){n=this.isFirstCanvas(e)||this.isLastCanvas(e)?[e]:e%2?[e,e+1]:[e-1,e];var i=this.getViewingDirection();i&&i===s.ViewingDirection.RIGHT_TO_LEFT&&(n=n.reverse())}else n.push(e);return n},t.prototype.getPrevPageIndex=function(e,t){var n;if(t){var i=this.getPagedIndices(e),o=this.getViewingDirection();n=o&&o===s.ViewingDirection.RIGHT_TO_LEFT?i[i.length-1]-1:i[0]-1}else n=e-1;return n},t.prototype.getStartCanvasIndex=function(){var e=this.getStartCanvas();if(e)for(var t=0;t<this.getTotalCanvases();t++)if(this.getCanvasByIndex(t).id===e)return t;return 0},t.prototype.getThumbs=function(e,t){for(var n=[],i=this.getTotalCanvases(),o=0;i>o;o++){var r=this.getCanvasByIndex(o),s=new te(e,r);n.push(s)}return n},t.prototype.getThumbnails=function(){if(null!=this._thumbnails)return this._thumbnails;this._thumbnails=[];for(var e=this.getCanvases(),t=0;t<e.length;t++){var n=e[t].getThumbnail();n&&this._thumbnails.push(n)}return this._thumbnails},t.prototype.getStartCanvas=function(){return this.getProperty("startCanvas")},t.prototype.getTotalCanvases=function(){return this.getCanvases().length},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?this.getProperty("viewingDirection"):this.options.resource.getViewingDirection?this.options.resource.getViewingDirection():null},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t.prototype.isCanvasIndexOutOfRange=function(e){return e>this.getTotalCanvases()-1},t.prototype.isFirstCanvas=function(e){return 0===e},t.prototype.isLastCanvas=function(e){return e===this.getTotalCanvases()-1},t.prototype.isMultiCanvas=function(){return this.getTotalCanvases()>1},t.prototype.isPagingEnabled=function(){var e=this.getViewingHint();return!!e&&e===s.ViewingHint.PAGED},t.prototype.isTotalCanvasesEven=function(){return this.getTotalCanvases()%2==0},t}(u),Y=function(){function e(){}return e.parse=function(e,t){return"string"==typeof e&&(e=JSON.parse(e)),this.parseJson(e,t)},e.parseJson=function(e,t){var n;if(t&&t.navDate&&!isNaN(t.navDate.getTime())&&(e.navDate=t.navDate.toString()),e["@type"])switch(e["@type"]){case"sc:Collection":n=this.parseCollection(e,t);break;case"sc:Manifest":n=this.parseManifest(e,t);break;default:return null}else switch(e.type){case"Collection":n=this.parseCollection(e,t);break;case"Manifest":n=this.parseManifest(e,t);break;default:return null}return n.isLoaded=!0,n},e.parseCollection=function(e,t){var n=new x(e,t);return t?(n.index=t.index||0,t.resource&&(n.parentCollection=t.resource.parentCollection)):n.index=0,this.parseCollections(n,t),this.parseManifests(n,t),this.parseItems(n,t),n},e.parseCollections=function(e,t){var n;if(e.__jsonld.collections?n=e.__jsonld.collections:e.__jsonld.items&&(n=e.__jsonld.items.filter(function(e){return"collection"===e.type.toLowerCase()})),n)for(var i=0;i<n.length;i++){t&&(t.index=i);var o=this.parseCollection(n[i],t);o.index=i,o.parentCollection=e,e.items.push(o)}},e.parseManifest=function(e,t){return new H(e,t)},e.parseManifests=function(e,t){var n;if(e.__jsonld.manifests?n=e.__jsonld.manifests:e.__jsonld.items&&(n=e.__jsonld.items.filter(function(e){return"manifest"===e.type.toLowerCase()})),n)for(var i=0;i<n.length;i++){var o=this.parseManifest(n[i],t);o.index=i,o.parentCollection=e,e.items.push(o)}},e.parseItem=function(e,t){if(e["@type"]){if("sc:manifest"===e["@type"].toLowerCase())return this.parseManifest(e,t);if("sc:collection"===e["@type"].toLowerCase())return this.parseCollection(e,t)}else if(e.type){if("manifest"===e.type.toLowerCase())return this.parseManifest(e,t);if("collection"===e.type.toLowerCase())return this.parseCollection(e,t)}return null},e.parseItems=function(e,t){var n=e.__jsonld.members||e.__jsonld.items;if(n)for(var i=function(i){t&&(t.index=i);var r=o.parseItem(n[i],t);return r?e.items.filter(function(e){return e.id===r.id})[0]?"continue":(r.index=i,r.parentCollection=e,void e.items.push(r)):{value:void 0}},o=this,r=0;r<n.length;r++){var s=i(r);if("object"==typeof s)return s.value}},e}(),Q=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),J=function(e){function t(t,n){return e.call(this,t,n)||this}return Q(t,e),t.prototype.getProfile=function(){var e=this.getProperty("profile");return e||(e=this.getProperty("dcterms:conformsTo")),Array.isArray(e)?e[0]:e},t.prototype.getConfirmLabel=function(){return $.getLocalisedValue(this.getProperty("confirmLabel"),this.options.locale)},t.prototype.getDescription=function(){return $.getLocalisedValue(this.getProperty("description"),this.options.locale)},t.prototype.getFailureDescription=function(){return $.getLocalisedValue(this.getProperty("failureDescription"),this.options.locale)},t.prototype.getFailureHeader=function(){return $.getLocalisedValue(this.getProperty("failureHeader"),this.options.locale)},t.prototype.getHeader=function(){return $.getLocalisedValue(this.getProperty("header"),this.options.locale)},t.prototype.getServiceLabel=function(){return $.getLocalisedValue(this.getProperty("label"),this.options.locale)},t.prototype.getInfoUri=function(){var e=this.id;return e.endsWith("/")||(e+="/"),e+="info.json"},t}(u),Z=function(e,t){this.width=e,this.height=t};!function(e){e[e.AUTHORIZATION_FAILED=1]="AUTHORIZATION_FAILED",e[e.FORBIDDEN=2]="FORBIDDEN",e[e.INTERNAL_SERVER_ERROR=3]="INTERNAL_SERVER_ERROR",e[e.RESTRICTED=4]="RESTRICTED"}(j||(j={}));var ee,te=function(e,t){this.data=t,this.index=t.index,this.width=e;var n=t.getHeight()/t.getWidth();this.height=n?Math.floor(this.width*n):e,this.uri=t.getCanonicalImageUri(e),this.label=t.getLabel().getValue()},ne=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),ie=function(e){function t(t,n){return e.call(this,t,n)||this}return ne(t,e),t}(c),oe=function(){function e(e,t){this.label=e,this.data=t||{},this.nodes=[]}return e.prototype.addNode=function(e){this.nodes.push(e),e.parentNode=this},e.prototype.isCollection=function(){return this.data.type===$.normaliseType(ee.COLLECTION)},e.prototype.isManifest=function(){return this.data.type===$.normaliseType(ee.MANIFEST)},e.prototype.isRange=function(){return this.data.type===$.normaliseType(ee.RANGE)},e}();!function(e){e.COLLECTION="collection",e.MANIFEST="manifest",e.RANGE="range"}(ee||(ee={}));var re=function(e){return $.loadManifest(e)},se=function(e,t){return $.parseManifest(e,t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.VOLUME_CHANGED="volumechanged",e}();t.VolumeEvents=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){void 0===t&&(t={}),this.source=e,this.options=t}return e.prototype.attachTo=function(e){e.setAttribute("src",this.source)},e}();t.MediaFormat=i},function(e,t,n){"use strict";function i(e,t){return e*t}Object.defineProperty(t,"__esModule",{value:!0}),t.timelineTime=function(e){return e},t.canvasTime=function(e){return e},t.annotationTime=function(e){return e},t.addTime=function(e,t){return e+t},t.minusTime=function(e,t){return e-t},t.multiplyTime=i,t.toMs=function(e){return i(e,1e3)},t.fromMs=function(e){return e/1e3}},function(e,t,n){var i=n(23);e.exports=function(e){return(null==e?0:e.length)?i(e,1):[]}},function(e,t,n){var i=n(40).Symbol;e.exports=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.NEXT_RANGE="nextrange",e.PAUSECANVAS="pause",e.PLAYCANVAS="play",e.PREVIOUS_RANGE="previousrange",e}();t.CanvasInstanceEvents=i},function(e,t,n){"use strict";n.r(t),n.d(t,"BaseComponent",function(){return i});var i=function(){function e(e){this.options=e,this.options.data=Object.assign({},this.data(),e.data)}return e.prototype._init=function(){return this.el=this.options.target,this.el?(this.el.innerHTML="",!0):(console.warn("element not found"),!1)},e.prototype.data=function(){return{}},e.prototype.on=function(e,t,n){var i=this._e||(this._e={});(i[e]||(i[e]=[])).push({fn:t,ctx:n})},e.prototype.fire=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var i=[].slice.call(arguments,1),o=((this._e||(this._e={}))[e]||[]).slice(),r=0,s=o.length;s>r;r++)o[r].fn.apply(o[r].ctx,i)},e.prototype._resize=function(){},e.prototype.set=function(e){},e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),o=n(26),r=n(12),s=function(){function e(){this.canvases=[],this.durationMap={},this.totalDuration=0,this.id=o.getTimestamp()}return e.prototype.addCanvas=function(e){this.canvases.push(jQuery.extend(!0,{},e));var t=e.getDuration()||0;this.totalDuration+=t,this.durationMap[e.id]={duration:t,runningDuration:this.totalDuration}},e.prototype.getContent=function(){var e=this,t=[];return this.canvases.forEach(function(n){var o=n.getContent();o.forEach(function(e){var t=e.getTarget();t&&(i.Utils.getTemporalComponent(t)||(e.__jsonld.target+="#t=0,"+n.getDuration()))}),o.forEach(function(t){var n=t.getTarget();n&&(t.__jsonld.target=r.retargetTemporalComponent(e.canvases,n))}),t.push.apply(t,o)}),t},e.prototype.getDuration=function(){var e=0;return this.canvases.forEach(function(t){var n=t.getDuration();n&&(e+=n)}),Math.floor(e)},e.prototype.getWidth=function(){return this.canvases.length?this.canvases[0].getWidth():0},e.prototype.getHeight=function(){return this.canvases.length?this.canvases[0].getHeight():0},e}();t.VirtualCanvas=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3);t.retargetTemporalComponent=function(e,t){var n=i.Utils.getTemporalComponent(t);if(n){for(var o=0,r=t.substr(0,t.indexOf("#")),s=0;s<e.length;s++){var a=e[s];if(a.id.includes(r))break;var u=a.getDuration();u&&(o+=u)}return n[0]=Number(n[0])+o,n[1]=Number(n[1])+o,r+"#t="+n[0]+","+n[1]}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(14);t.isHLSFormat=function(e){return i.hlsMimeTypes.includes(e.toString())}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hlsMimeTypes=["application/vnd.apple.mpegurl","vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isMpegDashFormat=function(e){return"application/dash+xml"===e.toString()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(14);t.canPlayHls=function(){var e="object"==typeof document&&document,t=e&&e.createElement("video");return Boolean(t&&t.canPlayType)&&i.hlsMimeTypes.some(function(e){return!!t&&/maybe|probably/i.test(t.canPlayType(e))})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isSafari=function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSpatialComponent=function(e){var t=/xywh=([^&]+)/g.exec(e),n=null;return t&&t[1]&&(n=t[1].split(",")),n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.PLAY="play",e.PAUSE="pause",e.MEDIA_READY="mediaready",e.LOG="log",e.RANGE_CHANGED="rangechanged",e.WAVEFORM_READY="waveformready",e.WAVEFORMS_READY="waveformsready",e}();t.Events=i},function(e,t,n){"use strict";function i(e,t){var n=[];return Object.keys(e).forEach(function(i){Object.is(t[i],e[i])||n.push(i)}),n}Object.defineProperty(t,"__esModule",{value:!0}),t.diffData=function(e,t){return Array.from(new Set(i(e,t).concat(i(t,e))))}},function(e,t,n){var i=n(23);e.exports=function(e){return(null==e?0:e.length)?i(e,1/0):[]}},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),r=this&&this.__awaiter||function(e,t,n,i){
return new(n||(n=Promise))(function(o,r){function s(e){try{u(i.next(e))}catch(e){r(e)}}function a(e){try{u(i["throw"](e))}catch(e){r(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}u((i=i.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){function n(e){return function(n){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(r=2&e[0]?o["return"]:e[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,e[1])).done)return r;switch(o=0,r&&(e=[2&e[0],r.value]),e[0]){case 0:case 1:r=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(r=a.trys,!((r=r.length>0&&r[r.length-1])||6!==e[0]&&2!==e[0])){a=0;continue}if(3===e[0]&&(!r||e[1]>r[0]&&e[1]<r[3])){a.label=e[1];break}if(6===e[0]&&a.label<r[1]){a.label=r[1],r=e;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(e);break}r[2]&&a.ops.pop(),a.trys.pop();continue}e=t.call(n,a)}catch(n){e=[6,n],o=0}finally{i=r=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,n])}}var i,o,r,s,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0});var a=n(3),u=n(9),l=n(10),c=n(4),h=n(11),p=n(27),d=n(20),f=n(35),g=n(19),v=n(2),_=function(e){function t(t){var n=e.call(this,t)||this;return n._data=n.data(),n.canvasInstances=[],n._readyMedia=0,n._readyWaveforms=0,n._posterCanvasWidth=0,n._posterCanvasHeight=0,n._posterImageExpanded=!1,n._init(),n._resize(),n}return o(t,e),t.prototype._init=function(){var t=e.prototype._init.call(this);return this._$element=$(this.el),t||v.Logger.error("Component failed to initialise"),t},t.prototype.getCurrentCanvasInstance=function(){var e=this._data.helper.getRangeById(this._data.range.id);if(!e)return null;var t=f.getFirstTargetedCanvasId(e);return t?this._data.helper.getCanvasById(t):null},t.prototype.data=function(){return{autoPlay:!1,constrainNavigationToRange:!1,defaultAspectRatio:.56,doubleClickMS:350,halveAtWidth:200,limitToRange:!1,posterImageRatio:.3,virtualCanvasEnabled:!0,content:{currentTime:"Current Time",collapse:"Collapse",duration:"Duration",expand:"Expand",mute:"Mute",next:"Next",pause:"Pause",play:"Play",previous:"Previous",unmute:"Unmute"},enableFastForward:!0,enableFastRewind:!0}},t.prototype.set=function(e){var t=this;v.Logger.groupCollapsed("AVComponent.set()"),v.Logger.log("Data",e);var n=Object.assign({},this._data);this._data=Object.assign(this._data,e);var i=d.diffData(n,this._data);if(i.includes("helper")&&this._reset(),this._data.helper){if(this.canvasInstances.forEach(function(e,n){var o={};i.includes("limitToRange")&&t._data.canvasId&&(o.limitToRange=t._data.limitToRange),i.includes("constrainNavigationToRange")&&t._data.canvasId&&(o.constrainNavigationToRange=t._data.constrainNavigationToRange),i.includes("autoSelectRange")&&t._data.canvasId&&(o.autoSelectRange=t._data.autoSelectRange),e.set(o)}),(i.includes("virtualCanvasEnabled")||i.includes("canvasId"))&&this._data.canvasId){var o=this._getCanvasInstanceById(this._data.canvasId);o&&this.canvasInstances.forEach(function(e){e.getCanvasId()!==o.getCanvasId()?e.set({visible:!1}):i.includes("range")?e.set({visible:!0,range:t._data.range?jQuery.extend(!0,{},t._data.range):void 0}):e.set({visible:!0})})}if(i.includes("virtualCanvasEnabled")&&(this.set({range:void 0}),this._data.virtualCanvasEnabled&&this.canvasInstances.forEach(function(e){e.isVirtual()&&t.set({canvasId:e.getCanvasId(),range:void 0})})),i.includes("range")&&this._data.range){var r=this._data.helper.getRangeById(this._data.range.id);if(r){var s=f.getFirstTargetedCanvasId(r);if(s){var u=this._getCanvasInstanceById(s);if(u){if(u.isVirtual()&&this._data.virtualCanvasEnabled&&u.includesVirtualSubCanvas(s)){s=u.getCanvasId();for(var l=0;l<u.ranges.length;l++){var c=u.ranges[l];if(c.id===r.id){r=c;break}}}this._data.canvasId&&(this._data.canvasId.includes("://")?a.Utils.normaliseUrl(this._data.canvasId):this._data.canvasId)!==s?this.set({canvasId:s,range:jQuery.extend(!0,{},r)}):u.set({range:jQuery.extend(!0,{},r)})}}}else v.Logger.warn("range not found",{id:this._data.range.id})}this._render(),this._resize(),v.Logger.groupEnd()}else v.Logger.warn("must pass a helper object")},t.prototype._render=function(){},t.prototype.reset=function(){this._reset()},t.prototype._reset=function(){var e=this;if(this._readyMedia=0,this._readyWaveforms=0,this._posterCanvasWidth=0,this._posterCanvasHeight=0,clearInterval(this._checkAllMediaReadyInterval),clearInterval(this._checkAllWaveformsReadyInterval),this.canvasInstances.forEach(function(e){e.destroy()}),this.canvasInstances=[],this._$element.empty(),this._data&&this._data.helper&&this._data.helper.manifest){var t=this._data.helper.manifest.getBehavior(),n=this._getCanvases();if(t&&"auto-advance"===t.toString()){var i=new h.VirtualCanvas;n.forEach(function(e){i.addCanvas(e)}),this._initCanvas(i)}n.forEach(function(t){e._initCanvas(t)}),this.canvasInstances.length>0&&(this._data.canvasId=this.canvasInstances[0].getCanvasId()),this._checkAllMediaReadyInterval=setInterval(this._checkAllMediaReady.bind(this),100),this._checkAllWaveformsReadyInterval=setInterval(this._checkAllWaveformsReady.bind(this),100),this._$posterContainer=$('<div class="poster-container"></div>'),this._$element.append(this._$posterContainer),this._$posterImage=$('<div class="poster-image"></div>'),this._$posterExpandButton=$('\n                    <button class="btn" title="'+(this._data&&this._data.content?this._data.content.expand:"")+'">\n                        <i class="av-icon  av-icon-expand expand" aria-hidden="true"></i><span>'+(this._data&&this._data.content?this._data.content.expand:"")+"</span>\n                    </button>\n                "),this._$posterImage.append(this._$posterExpandButton),this._$posterImage.on("touchstart click",function(t){t.preventDefault();var n=e._getPosterImageCss(!e._posterImageExpanded);if(e._$posterImage.animate(n),e._posterImageExpanded=!e._posterImageExpanded,e._data.content)if(e._posterImageExpanded){var i=e._data.content.collapse;e._$posterExpandButton.prop("title",i),e._$posterExpandButton.find("i").switchClass("expand","collapse")}else i=e._data.content.expand,e._$posterExpandButton.prop("title",i),e._$posterExpandButton.find("i").switchClass("collapse","expand")});var o=this._data.helper.getAccompanyingCanvas();if(o||(o=this._data.helper.getPosterCanvas()),o){this._posterCanvasWidth=o.getWidth(),this._posterCanvasHeight=o.getHeight();var r=this._data.helper.getPosterImage();if(r||(r=this._data.helper.getAccompanyingCanvasImage()),r){this._$posterContainer.append(this._$posterImage);var s=this._getPosterImageCss(this._posterImageExpanded);s=Object.assign({},s,{"background-image":"url("+r+")"}),this._$posterImage.css(s)}}}},t.prototype.setCurrentTime=function(e){return r(this,void 0,void 0,function(){var t;return s(this,function(n){return(t=this._getCurrentCanvas())?[2,t.setCurrentTime(e)]:[2]})})},t.prototype.getCurrentTime=function(){var e=this._getCurrentCanvas();return e?e.getClockTime():0},t.prototype.isPlaying=function(){return this.canvasInstances.reduce(function(e,t){return e||t.isPlaying()},!1)},t.prototype._checkAllMediaReady=function(){this._readyMedia===this.canvasInstances.length&&(clearInterval(this._checkAllMediaReadyInterval),this.fire(g.Events.MEDIA_READY),this.resize())},t.prototype._checkAllWaveformsReady=function(){this._readyWaveforms===this._getCanvasInstancesWithWaveforms().length&&(clearInterval(this._checkAllWaveformsReadyInterval),this.fire(g.Events.WAVEFORMS_READY),this.resize())},t.prototype._getCanvasInstancesWithWaveforms=function(){return this.canvasInstances.filter(function(e){return e.waveforms.length>0})},t.prototype._getCanvases=function(){return this._data.helper?this._data.helper.getCanvases():[]},t.prototype._initCanvas=function(e){var t=this,n=new p.CanvasInstance({target:document.createElement("div"),data:Object.assign({},{canvas:e},this._data)});n.logMessage=this._logMessage.bind(this),n.isOnlyCanvasInstance=1===this._getCanvases().length,this._$element.append(n.$playerElement),n.init(),this.canvasInstances.push(n),n.on("play",function(){t.fire(g.Events.PLAY,n)},!1),n.on("pause",function(){t.fire(g.Events.PAUSE,n)},!1),n.on(g.Events.MEDIA_READY,function(){t._readyMedia++,n.loaded()},!1),n.on(g.Events.WAVEFORM_READY,function(){t._readyWaveforms++},!1),n.on(u.CanvasInstanceEvents.PREVIOUS_RANGE,function(){t._prevRange(),t.play()},!1),n.on(u.CanvasInstanceEvents.NEXT_RANGE,function(){t._nextRange(),t.play()},!1),n.on(g.Events.RANGE_CHANGED,function(e){t.fire(g.Events.RANGE_CHANGED,e)},!1),n.on(c.VolumeEvents.VOLUME_CHANGED,function(e){t._setCanvasInstanceVolumes(e),t.fire(c.VolumeEvents.VOLUME_CHANGED,e)},!1)},t.prototype.getCurrentRange=function(){var e=this._data.helper.getCurrentRange().id;return this._getCurrentCanvas().ranges.find(function(t){return t.id===e})||null},t.prototype._prevRange=function(){if(this._data&&this._data.helper){var e=this.getCurrentRange();if(e){var t=this.getCurrentTime(),n=e.getDuration().start||0;if(t-n>5)return void this.setCurrentTime(n)}var i=this._data.helper.getPreviousRange();i?this.playRange(i.id):this._rewind()}},t.prototype._nextRange=function(){if(this._data&&this._data.helper){var e=this._data.helper.getNextRange();e&&this.playRange(e.id)}},t.prototype._setCanvasInstanceVolumes=function(e){this.canvasInstances.forEach(function(t){t.set({volume:e})})},t.prototype._getNormaliseCanvasId=function(e){return e.includes("://")?a.Utils.normaliseUrl(e):e},t.prototype._getCanvasInstanceById=function(e){if(e=this._getNormaliseCanvasId(e),this._data.virtualCanvasEnabled)for(var t=0;t<this.canvasInstances.length;t++){var n=(i=this.canvasInstances[t]).getCanvasId();if(n&&(n=this._getNormaliseCanvasId(n),(i.isVirtual()||1===this.canvasInstances.length)&&n===e||i.includesVirtualSubCanvas(e)))return i}else for(t=0;t<this.canvasInstances.length;t++){var i,o=(i=this.canvasInstances[t]).getCanvasId();if(o&&a.Utils.normaliseUrl(o)===e)return i}},t.prototype._getCurrentCanvas=function(){return this._data.canvasId?this._getCanvasInstanceById(this._data.canvasId):void 0},t.prototype._rewind=function(){if(!this._data.limitToRange){var e=this._getCurrentCanvas();e&&e.set({range:void 0})}},t.prototype.play=function(){var e=this._getCurrentCanvas();e&&e.play()},t.prototype.viewRange=function(e){var t=this._getCurrentCanvas();t&&t.viewRange(e)},t.prototype.pause=function(){var e=this._getCurrentCanvas();e&&e.pause()},t.prototype.playRange=function(e,t){if(void 0===t&&(t=!1),this._data.helper){var n=this._data.helper.getRangeById(e);n&&this.set({range:jQuery.extend(!0,{autoChanged:t},n)})}},t.prototype.showCanvas=function(e){var t=this._getCurrentCanvas();this._data.virtualCanvasEnabled&&t&&t.getCanvasId()===e&&!t.isVisible()?t.set({visible:!0}):this.set({canvasId:e})},t.prototype._logMessage=function(e){this.fire(g.Events.LOG,e)},t.prototype._getPosterImageCss=function(e){var t=this._getCurrentCanvas();if(t){var n=t.$playerElement.find(".options-container"),i=t.$playerElement.parent().width(),o=t.$playerElement.parent().height()-n.height();if(e)return{top:0,left:0,width:i,height:o};var r=void 0,s=void 0,a=void 0;return this._posterCanvasWidth>this._posterCanvasHeight?(r=this._posterCanvasHeight/this._posterCanvasWidth,a=(s=i*(this._data.posterImageRatio||1))*r):(r=this._posterCanvasWidth/this._posterCanvasHeight,s=(a=o*(this._data.posterImageRatio||1))*r),{top:0,left:i-s,width:s,height:a}}return null},t.prototype.resize=function(){this.canvasInstances.forEach(function(e){e.resize()}),this._getCurrentCanvas()&&this._$posterImage&&this._$posterImage.is(":visible")&&(this._posterImageExpanded?this._$posterImage.css(this._getPosterImageCss(!0)):this._$posterImage.css(this._getPosterImageCss(!1)))},t.newRanges=!0,t}(l.BaseComponent);t.AVComponent=_},function(e,t,n){var i=n(38),o=n(39);e.exports=function r(e,t,n,s,a){var u=-1,l=e.length;for(n||(n=o),a||(a=[]);++u<l;){var c=e[u];t>0&&n(c)?t>1?r(c,t-1,n,s,a):i(a,c):s||(a[a.length]=c)}return a}},function(e,t){e.exports=function(e){return null!=e&&"object"==typeof e}},function(e,t,n){"use strict";n.r(t),t["default"]=function(e,t){return t=t||{},new Promise(function(n,i){var o=new XMLHttpRequest,r=[],s=[],a={},u=function(){return{ok:2==(o.status/100|0),statusText:o.statusText,status:o.status,url:o.responseURL,text:function(){return Promise.resolve(o.responseText)},json:function(){return Promise.resolve(o.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([o.response]))},clone:u,headers:{keys:function(){return r},entries:function(){return s},get:function(e){return a[e.toLowerCase()]},has:function(e){return e.toLowerCase()in a}}}};for(var l in o.open(t.method||"get",e,!0),o.onload=function(){o.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(e,t,n){r.push(t=t.toLowerCase()),s.push([t,n]),a[t]=a[t]?a[t]+","+n:n}),n(u())},o.onerror=i,o.withCredentials="include"==t.credentials,t.headers)o.setRequestHeader(l,t.headers[l]);o.send(t.body||null)})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getTimestamp=function(){return String((new Date).valueOf())}},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),r=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{u(i.next(e))}catch(e){r(e)}}function a(e){try{u(i["throw"](e))}catch(e){r(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}u((i=i.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){function n(e){return function(n){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(r=2&e[0]?o["return"]:e[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,e[1])).done)return r;switch(o=0,r&&(e=[2&e[0],r.value]),e[0]){case 0:case 1:r=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(r=a.trys,!((r=r.length>0&&r[r.length-1])||6!==e[0]&&2!==e[0])){a=0;continue}if(3===e[0]&&(!r||e[1]>r[0]&&e[1]<r[3])){a.label=e[1];break}if(6===e[0]&&a.label<r[1]){a.label=r[1],r=e;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(e);break}r[2]&&a.ops.pop(),a.trys.pop();continue}e=t.call(n,a)}catch(n){e=[6,n],o=0}finally{i=r=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,n])}}var i,o,r,s,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0});var a=n(3),u=n(10),l=n(50),c=n(55),h=n(4),p=n(28),d=n(29),f=n(56),g=n(30),v=n(31),_=n(9),m=n(22),E=n(11),y=n(57),b=n(19),I=n(13),T=n(15),O=n(12),A=n(18),C=n(16),w=n(32),x=n(17),S=n(33),P=n(20),R=n(34),L=n(6),N=n(2),D=function(e){function t(t){var n=e.call(this,t)||this;return n._canvasClockFrequency=25,n._canvasClockStartDate=0,n._canvasClockTime=0,n._canvasHeight=0,n._canvasWidth=0,n._data=n.data(),n._highPriorityFrequency=25,n._isPlaying=!1,n._isStalled=!1,n._lowPriorityFrequency=250,n._mediaSyncMarginSecs=1,n._rangeSpanPadding=.25,n._readyMediaCount=0,n._stallRequestedBy=[],n._wasPlaying=!1,n.ranges=[],n.waveforms=[],n._buffering=!1,n._bufferShown=!1,n.isOnlyCanvasInstance=!1,n.waveformDeltaX=0,n.waveformPageX=0,n.waveFormInit=!1,n._scaleY=function(e,t){return Math.max(n._data.waveformBarWidth,e*t/256)},n._$element=$(n.options.target),n._data=n.options.data,n.$playerElement=$('<div class="player player--loading"></div>'),n}return o(t,e),t.prototype.loaded=function(){var e=this;setTimeout(function(){e.$playerElement.removeClass("player--loading")},500)},t.prototype.isPlaying=function(){return this._isPlaying},t.prototype.getClockTime=function(){return this._canvasClockTime},t.prototype.createTimeStops=function(){var e=this,t=this._data.helper,n=this._data.canvas;if(t&&n){this.ranges=[],this._contentAnnotations=[];for(var i=[],o=0,r=n.canvases;o<r.length;o++)for(var s=r[o],a=0,u=s.getContent();a<u.length;a++){var h=u[a],d=p.extractMediaFromAnnotationBodies(h);if(d){var _=v.getMediaSourceFromAnnotationBody(h,d,{id:s.id,duration:s.getDuration()||0,height:s.getHeight(),width:s.getWidth()}),m=new l.MediaElement(_,{adaptiveAuthEnabled:this._data.adaptiveAuthEnabled});m.setSize(this._convertToPercentage(_.x||0,s.getHeight()),this._convertToPercentage(_.y||0,s.getWidth()),this._convertToPercentage(_.width||s.getWidth(),s.getWidth()),this._convertToPercentage(_.height||s.getHeight(),s.getHeight())),i.push(m);var E=h.getProperty("seeAlso");if(E&&E.length){var y=E[0].id;this.waveforms.push(y)}}}var I=new f.CompositeMediaElement(i);I.appendTo(this.$playerElement),I.load().then(function(){e.fire(b.Events.MEDIA_READY)});var T=g.createTimePlansFromManifest(t.manifest,i);window.timePlanPlayer=this.timePlanPlayer=new c.TimePlanPlayer(I,T,function(t){e.setCurrentRangeId(t,{autoChanged:!0})},function(t){e._canvasClockTime=t},function(t){t?e.play(!0):e.pause(!0)})}},t.prototype.init=function(){var e=this;if(this._data&&this._data.content&&this._data.canvas){this._$hoverPreviewTemplate=$('<div class="hover-preview"><div class="label"></div><div class="pointer"><span class="arrow"></span></div></div>'),this._$canvasContainer=$('<div class="canvas-container"></div>'),this._$optionsContainer=$('<div class="options-container"></div>'),this._$rangeTimelineContainer=$('<div class="range-timeline-container"></div>'),this._$canvasTimelineContainer=$('<div class="canvas-timeline-container"></div>'),this._$canvasHoverPreview=this._$hoverPreviewTemplate.clone(),this._$canvasHoverHighlight=$('<div class="hover-highlight"></div>'),this._$rangeHoverPreview=this._$hoverPreviewTemplate.clone(),this._$rangeHoverHighlight=$('<div class="hover-highlight"></div>'),this._$durationHighlight=$('<div class="duration-highlight"></div>'),this._$timelineItemContainer=$('<div class="timeline-item-container"></div>'),this._$controlsContainer=$('<div class="controls-container"></div>'),this._$prevButton=$('\n                                <button class="btn" title="'+this._data.content.previous+'">\n                                    <i class="av-icon av-icon-previous" aria-hidden="true"></i>'+this._data.content.previous+"\n                                </button>"),this._$playButton=$('\n                                <button class="btn" title="'+this._data.content.play+'">\n                                    <i class="av-icon av-icon-play play" aria-hidden="true"></i>'+this._data.content.play+"\n                                </button>"),this._$nextButton=$('\n                                <button class="btn" title="'+this._data.content.next+'">\n                                    <i class="av-icon av-icon-next" aria-hidden="true"></i>'+this._data.content.next+"\n                                </button>"),this._$fastForward=$('\n                                <button class="btn" title="'+this._data.content.next+'">\n                                    <i class="av-icon av-icon-fast-forward" aria-hidden="true"></i>'+(this._data.content.fastForward||"")+"\n                                </button>"),this._$fastRewind=$('\n                                <button class="btn" title="'+this._data.content.next+'">\n                                    <i class="av-icon av-icon-fast-rewind" aria-hidden="true"></i>'+(this._data.content.fastRewind||"")+"\n                                </button>"),this._$timeDisplay=$('<div class="time-display"><span class="canvas-time"></span> / <span class="canvas-duration"></span></div>'),this._$canvasTime=this._$timeDisplay.find(".canvas-time"),this._$canvasDuration=this._$timeDisplay.find(".canvas-duration"),this.isVirtual()&&this.$playerElement.addClass("virtual");var t=$('<div class="volume"></div>');this._volume=new d.AVVolumeControl({target:t[0],data:Object.assign({},this._data)}),this._volume.on(h.VolumeEvents.VOLUME_CHANGED,function(t){e.fire(h.VolumeEvents.VOLUME_CHANGED,t)},!1),this._$controlsContainer.append(this._$prevButton,this._data.enableFastRewind?this._$fastRewind:null,this._$playButton,this._data.enableFastForward?this._$fastForward:null,this._$nextButton,this._$timeDisplay,t),this._$canvasTimelineContainer.append(this._$canvasHoverPreview,this._$canvasHoverHighlight,this._$durationHighlight),this._$rangeTimelineContainer.append(this._$rangeHoverPreview,this._$rangeHoverHighlight),this._$optionsContainer.append(this._$canvasTimelineContainer,this._$rangeTimelineContainer,this._$controlsContainer),this.$playerElement.append(this._$canvasContainer,this._$optionsContainer),this._$canvasHoverPreview.hide(),this._$rangeHoverPreview.hide();var n=this.isVirtual()&&m.AVComponent.newRanges;if(n&&this.createTimeStops(),!n&&this._data&&this._data.helper&&this._data.canvas){var i=[];R.isVirtual(this._data.canvas)?this._data.canvas.canvases.forEach(function(t){if(e._data&&e._data.helper){var n=e._data.helper.getCanvasRanges(t),o=[];n.forEach(function(t){var n=jQuery.extend(!0,{},t);if(o.push(n),n.canvases&&n.canvases.length)for(var i=0;i<n.canvases.length;i++)R.isVirtual(e._data.canvas)&&(n.canvases[i]=O.retargetTemporalComponent(e._data.canvas.canvases,n.__jsonld.items[i].id))}),i.push.apply(i,o)}}):i=i.concat(this._data.helper.getCanvasRanges(this._data.canvas)),i.forEach(function(t){e.ranges.push(t)})}var o=this._data.canvas.getWidth(),r=this._data.canvas.getHeight();this._canvasWidth=o||this.$playerElement.parent().width(),this._canvasHeight=r||this._canvasWidth*(this._data.defaultAspectRatio||1);var s=this,u=0,l=0;if(this._$prevButton.on("touchstart click",function(t){t.preventDefault(),1===++u?(e._previous(!1),l=setTimeout(function(){u=0,l=0},e._data.doubleClickMS)):(e._previous(!0),clearTimeout(l),u=0,l=0)}),this._$playButton.on("touchstart click",function(t){t.preventDefault(),e._isPlaying?e.pause():e.play()}),this._$nextButton.on("touchstart click",function(t){t.preventDefault(),e._next()}),this._$fastForward.on("touchstart click",function(t){var n=e.getRangeTiming().end,i=L.addTime(e.getClockTime(),20);return n>i?e._setCurrentTime(i):e._setCurrentTime(n)}),this._$fastRewind.on("touchstart click",function(t){var n=e.getRangeTiming().start,i=L.minusTime(e.getClockTime(),20);return i>=n?e._setCurrentTime(i):e._setCurrentTime(n)}),n?this._$canvasTimelineContainer.slider({value:0,step:.01,orientation:"horizontal",range:"min",min:0,max:this.timePlanPlayer.getDuration(),animate:!1,slide:function(t,n){e._setCurrentTime(e.timePlanPlayer.plan.start+n.value)}}):this._$canvasTimelineContainer.slider({value:0,step:.01,orientation:"horizontal",range:"min",max:s._getDuration(),animate:!1,create:function(e,t){},slide:function(e,t){s._setCurrentTime(t.value)},stop:function(e,t){}}),this._$canvasTimelineContainer.mouseout(function(){s._$canvasHoverHighlight.width(0),s._$canvasHoverPreview.hide()}),this._$rangeTimelineContainer.mouseout(function(){s._$rangeHoverHighlight.width(0),s._$rangeHoverPreview.hide()}),this._$canvasTimelineContainer.on("mousemove",function(t){n?e._updateHoverPreview(t,e._$canvasTimelineContainer,e.timePlanPlayer.getDuration()):e._updateHoverPreview(t,e._$canvasTimelineContainer,e._getDuration())}),this._$rangeTimelineContainer.on("mousemove",function(t){if(n)e._updateHoverPreview(t,e._$canvasTimelineContainer,e.timePlanPlayer.getDuration());else if(e._data.range){var i=e._data.range.getDuration();e._updateHoverPreview(t,e._$rangeTimelineContainer,i?i.getLength():0)}}),!n){this._contentAnnotations=[];var c=this._data.canvas.getContent();this._$timelineItemContainer.hide();for(var p=0;p<c.length;p++){var f=c[p],g=void 0,v=f.getBody();if(!v.length)return void N.Logger.warn("item has no body");var _=this._getBody(v);if(_){var E=_.getType(),y=_.getFormat();E&&"textualbody"===E.toString()||(g=_.id.split("#")[0]);var b=f.getTarget();if(!b)return void N.Logger.warn("item has no target");var I=A.getSpatialComponent(b),T=a.Utils.getTemporalComponent(b);I||(I=[0,0,this._canvasWidth,this._canvasHeight]),T||(T=[0,this._getDuration()]);var C=parseInt(String(I[0])),w=parseInt(String(I[1])),x=parseInt(String(I[2])),S=parseInt(String(I[3])),P=parseInt(String(T[0])),D=parseInt(String(T[1])),M=this._convertToPercentage(w,this._canvasHeight),B=this._convertToPercentage(C,this._canvasWidth),U=this._convertToPercentage(x,this._canvasWidth),V=this._convertToPercentage(S,this._canvasHeight),F=/t=([^&]+)/g.exec(_.id),G=void 0,H=(G=F&&F[1]?F[1].split(","):[null,null])[0]?parseInt(G[0]):G[0],j={active:!1,end:D,endOffset:G[1]?parseInt(G[1]):G[1],format:y,height:V,left:B,source:g,start:P,startOffset:H,top:M,type:E,width:U};this._renderMediaElement(j);var k=f.getProperty("seeAlso");if(k&&k.length){var W=k[0].id;this.waveforms.push(W)}}else N.Logger.warn("unable to find suitable format for",f.id)}}}else N.Logger.warn("unable to initialise, missing canvas or content")},t.prototype._getBody=function(e){for(var t=0;t<e.length;t++)if((i=(n=e[t]).getFormat())&&I.isHLSFormat(i)&&C.canPlayHls())return n;for(t=0;t<e.length;t++)if((i=(n=e[t]).getFormat())&&T.isMpegDashFormat(i)&&!x.isSafari())return n;for(t=0;t<e.length;t++){var n,i;if((i=(n=e[t]).getFormat())&&!I.isHLSFormat(i)&&!T.isMpegDashFormat(i))return n}return null},t.prototype._getDuration=function(){return this.isVirtual()&&m.AVComponent.newRanges?this.timePlanPlayer.getDuration():this._data&&this._data.canvas?Math.floor(this._data.canvas.getDuration()):0},t.prototype.data=function(){return{waveformColor:"#fff",waveformBarSpacing:4,waveformBarWidth:2,volume:1}},t.prototype.isVirtual=function(){return this._data.canvas instanceof E.VirtualCanvas},t.prototype.isVisible=function(){return!!this._data.visible},t.prototype.includesVirtualSubCanvas=function(e){if(R.isVirtual(this._data.canvas)&&this._data.canvas&&this._data.canvas.canvases)for(var t=0;t<this._data.canvas.canvases.length;t++){var n=this._data.canvas.canvases[t];if(a.Utils.normaliseUrl(n.id)===e)return!0}return!1},t.prototype.setVisibility=function(e){this._data.visible!==e&&(this._data.visible=e,e?(this._rewind(),this.$playerElement.show()):(this.$playerElement.hide(),this.pause()),this.resize())},t.prototype.viewRange=function(e){if(this.currentRange!==e){if(N.Logger.log("Switching range from "+this.currentRange+" to "+e),this.setCurrentRangeId(e),m.AVComponent.newRanges&&this.isVirtual())this._setCurrentTime(this.timePlanPlayer.setRange(e),!0);else{var t=this._data.helper.getRangeById(e);this.set({range:jQuery.extend(!0,{autoChanged:!0},t)})}this._render()}},t.prototype.setCurrentRangeId=function(e,t){var n=void 0===t?{}:t;n.autoChanged,n.limitToRange,!this.currentRange&&e&&this.limitToRange,N.Logger.log("Setting current range id",e),e&&this.currentRange!==e?(this.currentRange=e,this.fire(b.Events.RANGE_CHANGED,e)):null===e&&(this.currentRange=void 0,this.fire(b.Events.RANGE_CHANGED,null)),this._render()},t.prototype.setVolume=function(e){this._volume.set({volume:e}),m.AVComponent.newRanges&&this.isVirtual()&&this.timePlanPlayer.setVolume(e)},t.prototype.setLimitToRange=function(e){N.Logger.log(this._data.constrainNavigationToRange),this.limitToRange!==e&&(this.limitToRange=e,this._render())},t.prototype.set=function(e){var t=this;if(m.AVComponent.newRanges&&this.isVirtual())return void 0!==e.range&&this.setCurrentRangeId(e.range.id,{limitToRange:e.limitToRange}),void 0!==e.rangeId&&this.setCurrentRangeId(e.rangeId,{limitToRange:e.limitToRange}),void 0!==e.volume&&this.setVolume(e.volume),void 0!==e.limitToRange&&this.setLimitToRange(e.limitToRange),void(void 0!==e.visible&&this.setVisibility(e.visible));var n=Object.assign({},this._data);this._data=Object.assign(this._data,e);var i=P.diffData(n,this._data);if(i.includes("visible")&&this._data.canvas&&(this._data.visible?(this._rewind(),this.$playerElement.show()):(this.$playerElement.hide(),this.pause()),this.resize()),i.includes("volume")?this._contentAnnotations.forEach(function(e){var n=void 0!==t._data.volume?t._data.volume:1;$(e.element).prop("volume",n),t._volume.set({volume:t._data.volume})}):this.isVisible()&&this._render(),i.includes("range")){if(this._data.helper)if(this._data.range){var o=this._data.range.getDuration();o&&void 0!==o&&((o.start>=this._canvasClockTime||o.end<=this._canvasClockTime)&&this._setCurrentTime(o.start),this._data.autoPlay&&this.play(),this.fire(b.Events.RANGE_CHANGED,this._data.range.id,this._data.range))}else this.fire(b.Events.RANGE_CHANGED,null);i.includes("limitToRange")&&this._render()}},t.prototype._hasRangeChanged=function(){if(!this.isVirtual()||!m.AVComponent.newRanges){var e=this._getRangeForCurrentTime();e&&!this._data.limitToRange&&(!this._data.range||this._data.range&&e.id!==this._data.range.id)&&this.set({range:jQuery.extend(!0,{autoChanged:!0},e)})}},t.prototype._getRangeForCurrentTime=function(e){var t;t=e?e.getRanges():this.ranges;for(var n=0;n<t.length;n++){var i=t[n],o=i.getBehavior();if((!o||"no-nav"===o)&&this._rangeSpansCurrentTime(i)){if(this._rangeNavigable(i))return i;for(var r=i.getRanges(),s=0;s<r.length;s++){var a=r[s];if(this._rangeSpansCurrentTime(a))return this._getRangeForCurrentTime(a)}return i.parentRange}}},t.prototype._rangeSpansCurrentTime=function(e){return!!e.spansTime(Math.ceil(this._canvasClockTime)+this._rangeSpanPadding)},t.prototype._rangeNavigable=function(e){var t=e.getBehavior();return!t||"no-nav"!==t.toString()},t.prototype._render=function(){if(this.isVirtual()&&m.AVComponent.newRanges&&this.isVisible()){N.Logger.groupCollapsed("CanvasInstance._render()"),N.Logger.log({dataRange:this._data.rangeId,range:this.currentRange,newLimitToRange:this.limitToRange,constraintToRange:this._data.constrainNavigationToRange,autoSelectRange:this._data.autoSelectRange}),this.limitToRange&&this.currentRange?(N.Logger.log("Selecting plan...",this.currentRange),this.timePlanPlayer.selectPlan({rangeId:this.currentRange})):(N.Logger.log("Resetting..."),this.timePlanPlayer.selectPlan({reset:!0}));var e=this._$canvasTimelineContainer.width()/this.timePlanPlayer.getDuration();this._$durationHighlight.show();var t=this.timePlanPlayer.getCurrentRange(),n=t.start,i=t.duration;return this._$canvasTimelineContainer.slider({value:this._canvasClockTime-this.timePlanPlayer.plan.start,max:this.timePlanPlayer.getDuration()}),this._$durationHighlight.css({left:n*e,width:i*e}),N.Logger.groupEnd(),this._updateCurrentTimeDisplay(),this._updateDurationDisplay(),void this._drawWaveform()}if(this._data.limitToRange&&this._data.range?(this._$canvasTimelineContainer.hide(),this._$rangeTimelineContainer.show()):(this._$canvasTimelineContainer.show(),this._$rangeTimelineContainer.hide()),this._data.range||this._$durationHighlight.hide(),this.isVisible()&&(this.isOnlyCanvasInstance||this.isVirtual())){if(this._data.range&&(!this.isVirtual()||!m.AVComponent.newRanges)&&(i=this._data.range.getDuration())){var o=this._getDuration(),r=o*(e=this._$canvasTimelineContainer.width()/o),s=(n=i.start*e,i.end*e);(s>r||n>s)&&(s=r);var a=s-n;this.isVirtual()||this.isOnlyCanvasInstance?(this._$durationHighlight.show(),this._$durationHighlight.css({left:n,width:a})):this._$durationHighlight.hide();var u=this;this._$rangeTimelineContainer.data("ui-sortable")&&this._$rangeTimelineContainer.slider("destroy"),this._$rangeTimelineContainer.slider({value:i.start,step:.01,orientation:"horizontal",range:"min",min:i.start,max:i.end,animate:!1,
create:function(e,t){},slide:function(e,t){u._setCurrentTime(t.value)},stop:function(e,t){}})}this._updateCurrentTimeDisplay(),this._updateDurationDisplay(),this._drawWaveform()}},t.prototype.getCanvasId=function(){return this._data&&this._data.canvas?this._data.canvas.id:void 0},t.prototype._updateHoverPreview=function(e,t,n){var i=t.offset()||{left:0},o=e.pageX-i.left,r=t.find(".arrow"),s=t.find(".hover-highlight"),a=t.find(".hover-preview");s.width(o);var u=t.width(),l=o/u,c=Math.min(n*l);a.find(".label").text(w.formatTime(c));var h=a.outerWidth(),p=a.outerHeight(),d=o-.5*h,f=.5*h-6;0>d&&(d=0,f=o-6),d+h>u&&(d=u-h,f=h-(u-o)-6),a.css({left:d,top:-1*p+"px"}).show(),r.css({left:f})},t.prototype._previous=function(e){if(m.AVComponent.newRanges&&this.isVirtual()){N.Logger.group("prev");var t=this.timePlanPlayer.previous();return this._setCurrentTime(t),N.Logger.log("CanvasInstance.previous()",t),void N.Logger.groupEnd()}this._data.limitToRange?e?this._isNavigationConstrainedToRange()?this._rewind():this.fire(_.CanvasInstanceEvents.PREVIOUS_RANGE):this._rewind():this._data.range?e?(this.set({range:void 0}),this._rewind()):this.fire(_.CanvasInstanceEvents.PREVIOUS_RANGE):this._rewind()},t.prototype._next=function(){if(m.AVComponent.newRanges&&this.isVirtual()){N.Logger.groupCollapsed("next");var e=this.timePlanPlayer.next();return N.Logger.log("CanvasInstance.previous()",e),this._setCurrentTime(e,!1),void N.Logger.groupEnd()}this._data.limitToRange&&this._isNavigationConstrainedToRange()?this._fastforward():this.fire(_.CanvasInstanceEvents.NEXT_RANGE)},t.prototype.destroy=function(){window.clearInterval(this._highPriorityInterval),window.clearInterval(this._lowPriorityInterval),window.clearInterval(this._canvasClockInterval)},t.prototype._convertToPercentage=function(e,t){return e/t*100},t.prototype._renderMediaElement=function(e){var t,n=this;switch(e.type.toString().toLowerCase()){case"video":t=$('<video crossorigin="anonymous" class="anno" />');break;case"sound":case"audio":t=$('<audio crossorigin="anonymous" class="anno" />');break;default:return}var i=t[0];if(e.format&&"application/dash+xml"===e.format.toString()){t.attr("data-dashjs-player","");var o=dashjs.MediaPlayer().create();o.getDebug().setLogToBrowserConsole(!1),this._data.adaptiveAuthEnabled&&o.setXHRWithCredentialsForType("MPD",!0),o.initialize(i,e.source)}else if(e.format&&"application/vnd.apple.mpegurl"===e.format.toString())if(Hls.isSupported()){var r=new Hls;r=this._data.adaptiveAuthEnabled?new Hls({xhrSetup:function(e){e.withCredentials=!0}}):new Hls,this._data.adaptiveAuthEnabled,r.loadSource(e.source),r.attachMedia(i)}else i.canPlayType("application/vnd.apple.mpegurl")&&(i.src=e.source);else t.attr("src",e.source);t.css({top:e.top+"%",left:e.left+"%",width:e.width+"%",height:e.height+"%"}).hide(),e.element=t,e.timeout=null;var s=this;e.checkForStall=function(){var e=this;this.active?(s._checkMediaSynchronization(),this.element.get(0).readyState>0&&!this.outOfSync?s._playbackStalled(!1,e):(s._playbackStalled(!0,e),this.timeout&&window.clearTimeout(this.timeout),this.timeout=window.setTimeout(function(){e.checkForStall()},1e3))):s._playbackStalled(!1,e)},this._contentAnnotations.push(e),this.$playerElement&&this._$canvasContainer.append(t),t.on("loadedmetadata",function(){n._readyMediaCount++,n._readyMediaCount===n._contentAnnotations.length&&(n._data.autoPlay?n.play():n.pause(),n._updateDurationDisplay(),n.fire(b.Events.MEDIA_READY))}),t.attr("preload","metadata"),t.get(0).load(),this._renderSyncIndicator(e)},t.prototype._getWaveformData=function(e){return new Promise(function(t,n){$.ajax({url:e,type:"GET",dataType:"binary",responseType:"arraybuffer",processData:!1}).done(function(e){t(WaveformData.create(e))}).fail(function(){n(new Error("Network Error"))})})},t.prototype._renderWaveform=function(e){var t=this;if(void 0===e&&(e=!1),(!this.waveFormInit||e)&&(this.waveFormInit=!0,this.waveforms.length)){var n=this.waveforms.map(function(e){return t._getWaveformData(e)});Promise.all(n).then(function(e){t._waveformCanvas=document.createElement("canvas"),t._waveformCanvas.classList.add("waveform"),t._$canvasContainer.append(t._waveformCanvas),t.waveformPageX=t._waveformCanvas.getBoundingClientRect().left;var n=t._drawWaveform.bind(t);t._waveformCanvas.addEventListener("mousein",function(){t.waveformDeltaX=0}),t._$canvasTimelineContainer.on("mouseout",function(){t.waveformDeltaX=0,requestAnimationFrame(n)}),t._waveformCanvas.addEventListener("mouseout",function(){t.waveformDeltaX=0,requestAnimationFrame(n)}),t._waveformCanvas.addEventListener("mousemove",function(e){t.waveformDeltaX=e.clientX-t.waveformPageX,requestAnimationFrame(n)}),t._$canvasTimelineContainer.on("mousemove",function(e){t.waveformDeltaX=e.clientX-t.waveformPageX,requestAnimationFrame(n)}),t._waveformCanvas.addEventListener("click",function(){var e=t._waveformCanvas.getBoundingClientRect().width||0;if(e){var n=t.getRangeTiming(),i=n.start,o=n.duration;t._setCurrentTime(L.multiplyTime(L.addTime(i,o),t.waveformDeltaX/e))}}),t._waveformCtx=t._waveformCanvas.getContext("2d"),t._waveformCtx&&(t._waveformCtx.fillStyle=t._data.waveformColor||"#fff",t._compositeWaveform=new y.CompositeWaveform(e),t.fire(b.Events.WAVEFORM_READY))})["catch"](function(){N.Logger.warn("Could not load wave forms.")})}},t.prototype.getRangeTiming=function(){if(m.AVComponent.newRanges&&this.isVirtual())return{start:this.timePlanPlayer.plan.start,end:this.timePlanPlayer.plan.end,duration:this.timePlanPlayer.plan.duration,percent:Math.min((this.timePlanPlayer.getTime()-this.timePlanPlayer.plan.start)/this.timePlanPlayer.plan.duration,1)};var e,t=0,n=L.timelineTime(this._compositeWaveform?this._compositeWaveform.duration:-1),i=n;return this._data.range&&(e=this._data.range.getDuration()),this.isVirtual()||(n=this._getDuration()),this._data.limitToRange&&e&&(t=e.start,n=e.end,i=L.minusTime(n,t)),-1===n&&e&&(t=e.start,n=e.end,i=L.minusTime(n,t)),-1===n&&N.Logger.warn("Duration not found...",{start:t,end:n,duration:i,durationObj:e}),{start:t,end:n,duration:L.minusTime(n,t),percent:Math.min((this.getClockTime()-t)/i,1)}},t.prototype._drawWaveform=function(){if(this._renderWaveform(),this._waveformCtx&&this.isVisible()){var e=this.getRangeTiming(),t=e.start,n=e.end,i=e.percent,o=t*this._compositeWaveform.pixelsPerSecond,r=n*this._compositeWaveform.pixelsPerSecond,s=this._waveformCtx.canvas.width,a=this._waveformCtx.canvas.height,u=this._data.waveformBarSpacing,l=this._data.waveformBarWidth,c=Math.floor((r-o)/s*u),h=s/u;this._waveformCtx.clearRect(0,0,s,a),this._waveformCtx.fillStyle=this._data.waveformColor||"#fff";var p=s/(n-t),d=[];if(this._contentAnnotations)for(var f=0;f<this._contentAnnotations.length;f++){var g=this._contentAnnotations[f];if(g&&g.element){var v=g.element[0],_=g.startOffest||0;if(g.active)for(var E=0;E<v.buffered.length;E++){var y=v.buffered.length-E-1,b=v.buffered.start(y),I=v.buffered.end(y);d.push([(_+b-t)*p,(_+I-t)*p])}}}var T=[];if(this.isVirtual()&&m.AVComponent.newRanges)for(var O=this.timePlanPlayer.plan,A=this._data.canvas,C=0,w=O.stops;C<w.length;C++){var x=w[C],P=A.durationMap[O.canvases[x.canvasIndex]],R=P.runningDuration-P.duration;T.push({start:(x.start-O.start)/O.duration,end:(x.end-O.start)/O.duration,duration:x.duration,startTime:R+x.canvasTime.start,endTime:R+x.canvasTime.start+x.canvasTime.end})}else T.push({start:0,duration:n-t,end:n,startTime:t});for(var L=0,N=o;r>N;N+=c){var D=S.normalise(N,o,r),M=D*s;T[L].end<D&&L++;var $=T[L],B=D-$.start,U=Math.floor(($.startTime+B*$.duration)*this._compositeWaveform.pixelsPerSecond),V=this._getWaveformMaxAndMin(this._compositeWaveform,U,h),F=this._scaleY(V.max-V.min,a),G=i>M/s,H=this.waveformDeltaX/s,j=this._data.waveformColor||"#fff",k=(a-F)/2;if(G)j=0===this.waveformDeltaX?"#14A4C3":H>M/s?"#11758e":"#14A4C3";else if(H>M/s)j="#86b3c3";else{j="#8a9aa1";for(var W=0,z=d;W<z.length;W++){var q=z[W],X=q[0],K=q[1];if(M>X&&K>M){j="#fff";break}}}this._waveformCtx.fillStyle=j,this._waveformCtx.fillRect(M,k,l,0|F)}}},t.prototype._getWaveformMaxAndMin=function(e,t,n){for(var i=-127,o=128,r=t;t+n>r;r++){var s=e.max(r),a=e.min(r);s>i&&(i=s),o>a&&(o=a)}return{max:i,min:o}},t.prototype.isLimitedToRange=function(){return this._data.limitToRange},t.prototype.hasCurrentRange=function(){return!!this._data.range},t.prototype._updateCurrentTimeDisplay=function(){var e;if(m.AVComponent.newRanges&&this.isVirtual())this._$canvasTime.text(w.formatTime(this._canvasClockTime-this.timePlanPlayer.getStartTime()));else if(this._data.range&&(e=this._data.range.getDuration()),this._data.limitToRange&&e){var t=this._canvasClockTime-e.start;this._$canvasTime.text(w.formatTime(t))}else this._$canvasTime.text(w.formatTime(this._canvasClockTime))},t.prototype._updateDurationDisplay=function(){var e;m.AVComponent.newRanges&&this.isVirtual()?this._$canvasDuration.text(w.formatTime(this.timePlanPlayer.getDuration())):(this._data.range&&(e=this._data.range.getDuration()),this._data.limitToRange&&e?this._$canvasDuration.text(w.formatTime(e.getLength())):this._$canvasDuration.text(w.formatTime(this._getDuration())))},t.prototype._renderSyncIndicator=function(e){if(m.AVComponent.newRanges&&this.isVirtual())N.Logger.log("_renderSyncIndicator");else{var t=this._convertToPercentage(e.start,this._getDuration()),n=this._convertToPercentage(e.end-e.start,this._getDuration()),i=$('<div class="timeline-item"></div>');i.css({left:t+"%",width:n+"%"});var o=$('<div class="line-wrapper"></div>');i.appendTo(o),e.timelineElement=i,this.$playerElement&&this._$timelineItemContainer.append(o)}},t.prototype.setCurrentTime=function(e){return N.Logger.log("External set current time?"),this._setCurrentTime(e,!1)},t.prototype.now=function(){return L.fromMs(Date.now())},t.prototype.nowMs=function(){return Date.now()},t.prototype._setCurrentTime=function(e,t){return void 0===t&&(t=!0),r(this,void 0,void 0,function(){var n,i,o;return s(this,function(r){switch(r.label){case 0:return m.AVComponent.newRanges&&this.isVirtual()?(this._buffering=!0,[4,this.timePlanPlayer.setTime(e,t)]):[3,2];case 1:return r.sent(),this._buffering=!1,this._canvasClockStartDate=L.toMs(L.minusTime(this.now(),this._canvasClockTime)),this._canvasClockUpdater(),this._highPriorityUpdater(),this._lowPriorityUpdater(),this._synchronizeMedia(),[2];case 2:return n=this.getRangeTiming(),i=n.start,o=n.end,i>e||i>o?[2]:(this._canvasClockTime=e,this._canvasClockStartDate=L.toMs(L.minusTime(this.now(),this._canvasClockTime)),this.logMessage("SET CURRENT TIME to: "+this._canvasClockTime+" seconds."),this._canvasClockUpdater(),this._highPriorityUpdater(),this._lowPriorityUpdater(),this._synchronizeMedia(),[2])}})})},t.prototype._rewind=function(e){var t;m.AVComponent.newRanges&&this.isVirtual()?N.Logger.log("Rewind"):(this.pause(),this._data.range&&(t=this._data.range.getDuration()),this._data.limitToRange&&t?this._setCurrentTime(t.start):this._setCurrentTime(0),this._data.limitToRange||this._data&&this._data.helper&&this.set({range:void 0}))},t.prototype._fastforward=function(){var e;m.AVComponent.newRanges&&this.isVirtual()?N.Logger.log("Fast forward"):(this._data.range&&(e=this._data.range.getDuration()),this._data.limitToRange&&e?this._canvasClockTime=L.timelineTime(e.end):this._canvasClockTime=this._getDuration(),this.pause())},t.prototype.play=function(e){return r(this,void 0,void 0,function(){var t,n,i=this;return s(this,function(o){switch(o.label){case 0:return this._isPlaying?[2]:m.AVComponent.newRanges&&this.isVirtual()?this.timePlanPlayer.hasEnded()?(this._buffering=!0,[4,this.timePlanPlayer.setTime(this.timePlanPlayer.currentStop.start)]):[3,2]:[3,3];case 1:o.sent(),this._buffering=!1,o.label=2;case 2:return this.timePlanPlayer.play(),[3,4];case 3:t=void 0,this._data.range&&(t=this._data.range.getDuration()),this._data.limitToRange&&t&&this._canvasClockTime>=t.end&&(this._canvasClockTime=t.start),this._canvasClockTime===this._getDuration()&&(this._canvasClockTime=0),o.label=4;case 4:return this._canvasClockStartDate=L.toMs(L.minusTime(this.now(),this._canvasClockTime)),this._highPriorityInterval&&clearInterval(this._highPriorityInterval),this._highPriorityInterval=window.setInterval(function(){i._highPriorityUpdater()},this._highPriorityFrequency),this._lowPriorityInterval&&clearInterval(this._lowPriorityInterval),this._lowPriorityInterval=window.setInterval(function(){i._lowPriorityUpdater()},this._lowPriorityFrequency),this._canvasClockInterval&&clearInterval(this._canvasClockInterval),this._canvasClockInterval=window.setInterval(function(){i._canvasClockUpdater()},this._canvasClockFrequency),this._isPlaying=!0,e||this._synchronizeMedia(),n=this._data&&this._data.content?this._data.content.pause:"",this._$playButton.prop("title",n),this._$playButton.find("i").switchClass("play","pause"),this.fire(_.CanvasInstanceEvents.PLAYCANVAS),this.logMessage("PLAY canvas"),[2]}})})},t.prototype.pause=function(e){window.clearInterval(this._highPriorityInterval),window.clearInterval(this._lowPriorityInterval),window.clearInterval(this._canvasClockInterval),this._isPlaying=!1,e||(this._highPriorityUpdater(),this._lowPriorityUpdater(),this._synchronizeMedia()),m.AVComponent.newRanges&&this.isVirtual()&&this.timePlanPlayer.pause();var t=this._data&&this._data.content?this._data.content.play:"";this._$playButton.prop("title",t),this._$playButton.find("i").switchClass("pause","play"),this.fire(_.CanvasInstanceEvents.PAUSECANVAS),this.logMessage("PAUSE canvas")},t.prototype._isNavigationConstrainedToRange=function(){return this._data.constrainNavigationToRange||!1},t.prototype._canvasClockUpdater=function(){if(m.AVComponent.newRanges&&this.isVirtual()){if(this._buffering)return;var e=L.fromMs(this._canvasClockStartDate);return N.Logger.log("CanvasInstance._canvasClockUpdater()",{startDate:e,advanceToTime:L.minusTime(this.now(),e)}),void(this.timePlanPlayer.advanceToTime(L.minusTime(this.now(),e)).paused&&this.pause())}if(!this._buffering){var t,n=L.fromMs(this._canvasClockStartDate);this._canvasClockTime=L.minusTime(this.now(),n),this._data.range&&(t=this._data.range.getDuration()),this._data.limitToRange&&t&&this._canvasClockTime>=t.end&&this.pause(),this._canvasClockTime>=this._getDuration()&&(this._canvasClockTime=this._getDuration(),this.pause())}},t.prototype._highPriorityUpdater=function(){this._bufferShown&&!this._buffering&&(this.$playerElement.removeClass("player--loading"),this._bufferShown=!1),this._buffering&&!this._bufferShown&&(this.$playerElement.addClass("player--loading"),this._bufferShown=!0),m.AVComponent.newRanges&&this.isVirtual()?(this._$rangeTimelineContainer.slider({value:this._canvasClockTime-this.timePlanPlayer.plan.start}),this._$canvasTimelineContainer.slider({value:this._canvasClockTime-this.timePlanPlayer.plan.start})):(this._$rangeTimelineContainer.slider({value:this._canvasClockTime}),this._$canvasTimelineContainer.slider({value:this._canvasClockTime})),this._updateCurrentTimeDisplay(),this._updateDurationDisplay(),this._drawWaveform()},t.prototype._lowPriorityUpdater=function(){this._updateMediaActiveStates(),this._data.autoSelectRange&&(this.isVirtual()||this.isOnlyCanvasInstance)&&this._hasRangeChanged()},t.prototype._updateMediaActiveStates=function(){if(m.AVComponent.newRanges&&this.isVirtual()){if(this._isPlaying){if(this.timePlanPlayer.isBuffering())return void(this._buffering=!0);this._buffering&&(this._buffering=!1),this.timePlanPlayer.advanceToTime(this._canvasClockTime)}}else for(var e,t=0;t<this._contentAnnotations.length;t++)(e=this._contentAnnotations[t]).start<=this._canvasClockTime&&e.end>=this._canvasClockTime?(this._checkMediaSynchronization(),e.active||(this._synchronizeMedia(),e.active=!0,e.element.show(),e.timelineElement.addClass("active")),e.element[0].currentTime>e.element[0].duration-e.endOffset&&this._pauseMedia(e.element[0])):e.active&&(e.active=!1,e.element.hide(),e.timelineElement.removeClass("active"),this._pauseMedia(e.element[0]))},t.prototype._pauseMedia=function(e){e.pause()},t.prototype._setMediaCurrentTime=function(e,t){isNaN(e.duration)||(e.currentTime=t)},t.prototype._synchronizeMedia=function(){if(!m.AVComponent.newRanges||!this.isVirtual()){for(var e,t=0;t<this._contentAnnotations.length;t++){if(e=this._contentAnnotations[t],this._setMediaCurrentTime(e.element[0],this._canvasClockTime-e.start+e.startOffset),e.start<=this._canvasClockTime&&e.end>=this._canvasClockTime)if(this._isPlaying){if(e.element[0].paused){var n=e.element[0].play();n&&n["catch"](function(){})}}else this._pauseMedia(e.element[0]);else this._pauseMedia(e.element[0]);e.element[0].currentTime>e.element[0].duration-e.endOffset&&this._pauseMedia(e.element[0])}this.logMessage("SYNC MEDIA at: "+this._canvasClockTime+" seconds.")}},t.prototype._checkMediaSynchronization=function(){if(m.AVComponent.newRanges&&this.isVirtual())this._isPlaying&&(this.timePlanPlayer.isBuffering()?this._buffering=!0:this._buffering&&(this._buffering=!1));else for(var e,t=0,n=this._contentAnnotations.length;n>t;t++)if((e=this._contentAnnotations[t]).start<=this._canvasClockTime&&e.end>=this._canvasClockTime){this._isPlaying&&(e.element[0].readyState<3?this._buffering=!0:this._buffering&&(this._buffering=!1));var i=this._canvasClockTime-e.start+e.startOffset,o=e.element[0].currentTime;if(Math.abs(o-i)>this._mediaSyncMarginSecs){e.outOfSync=!0;var r=Math.abs(o-i);this.logMessage("DETECTED synchronization lag: "+Math.abs(r)),this._setMediaCurrentTime(e.element[0],i)}else e.outOfSync=!1}},t.prototype._playbackStalled=function(e,t){if(e)this._stallRequestedBy.indexOf(t)<0&&this._stallRequestedBy.push(t),this._isStalled||(this.$playerElement,this._wasPlaying=this._isPlaying,this.pause(!0),this._isStalled=e);else{var n=this._stallRequestedBy.indexOf(t);n>=0&&this._stallRequestedBy.splice(n,1),0===this._stallRequestedBy.length&&(this._isStalled&&this._wasPlaying&&this.play(!0),this._isStalled=e)}},t.prototype.resize=function(){if(this.$playerElement){var e=this._$canvasContainer.width();if(e){this._$canvasTimelineContainer.width(e);var t=this.$playerElement.find(".options-container");void 0!==this._data.halveAtWidth&&this.$playerElement.parent().width()<this._data.halveAtWidth?this._$canvasContainer.height(this.$playerElement.parent().height()/2):this._$canvasContainer.height(this.$playerElement.parent().height()-t.height())}if(this._waveformCanvas){var n=this._$canvasContainer.width(),i=this._$canvasContainer.height();this._waveformCanvas.width=n,this._waveformCanvas.height=i,this.waveformPageX=this._waveformCanvas.getBoundingClientRect().left}this._render(),this._drawWaveform()}},t}(u.BaseComponent);t.CanvasInstance=D},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(13),o=n(15),r=n(16),s=n(17);t.extractMediaFromAnnotationBodies=function(e){var t=e.getBody();if(!t.length)return null;for(var n=0;n<t.length;n++)if((u=(a=t[n]).getFormat())&&i.isHLSFormat(u)&&r.canPlayHls())return a;for(n=0;n<t.length;n++)if((u=(a=t[n]).getFormat())&&o.isMpegDashFormat(u)&&!s.isSafari())return a;for(n=0;n<t.length;n++){var a,u;if((u=(a=t[n]).getFormat())&&!i.isHLSFormat(u)&&!o.isMpegDashFormat(u))return a}return null}},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(10),s=n(4),a=n(2),u=function(e){function t(t){var n=e.call(this,t)||this;return n._lastVolume=1,n._data={volume:1},n._init(),n._resize(),n}return o(t,e),t.prototype._init=function(){var t=this,n=e.prototype._init.call(this);this._$element=$(this.el),n||a.Logger.error("Component failed to initialise"),this._$volumeMute=$('\n      <button class="btn volume-mute" title="'+this.options.data.content.mute+'">\n          <i class="av-icon av-icon-mute on" aria-hidden="true"></i>'+this.options.data.content.mute+"\n      </button>\n    "),this._$volumeSlider=$('<div class="volume-slider"></div>'),this._$element.append(this._$volumeMute,this._$volumeSlider);var i=this;return this._$volumeMute.on("touchstart click",function(e){e.preventDefault(),0!==t._data.volume?(t._lastVolume=t._data.volume,t._data.volume=0):t._data.volume=t._lastVolume,t.fire(s.VolumeEvents.VOLUME_CHANGED,t._data.volume)}),this._$volumeSlider.slider({value:i._data.volume,step:.1,orientation:"horizontal",range:"min",min:0,max:1,animate:!1,create:function(){},slide:function(e,t){i._data.volume=t.value,0===i._data.volume&&(i._lastVolume=0),i.fire(s.VolumeEvents.VOLUME_CHANGED,i._data.volume)},stop:function(e,t){}}),n},t.prototype.set=function(e){this._data=Object.assign(this._data,e),this._render()},t.prototype._render=function(){if(void 0!==this._data.volume)if(this._$volumeSlider.slider({value:this._data.volume}),0===this._data.volume){var e=this.options.data.content.unmute;this._$volumeMute.prop("title",e),this._$volumeMute.find("i").switchClass("on","off")}else e=this.options.data.content.mute,this._$volumeMute.prop("title",e),this._$volumeMute.find("i").switchClass("off","on")},t.prototype._resize=function(){},t}(r.BaseComponent);t.AVVolumeControl=u},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;i>n;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;n>t;t++)e+=arguments[t].length;var i=Array(e),o=0;for(t=0;n>t;t++)for(var r=arguments[t],s=0,a=r.length;a>s;s++,o++)i[o]=r[s];return i};Object.defineProperty(t,"__esModule",{value:!0});var r=n(6);t.createTimePlansFromManifest=function(e){var t=function(n,s,a){var u,l,c;void 0===s&&(s=[]),void 0===a&&(a=r.timelineTime(0));for(var h={type:"time-plan",canvases:[],duration:r.timelineTime(0),items:[],stops:[],rangeOrder:[n.id],end:r.timelineTime(0),start:a,rangeId:n.id,rangeStack:s},p=a,d=o(n.items,n.getCanvasIds()),f=0;f<d.length;f++){var g=d[f];if("string"==typeof g){var v=g.match(/(.*)#t=([0-9.]+),?([0-9.]+)?/)||[void 0,g,"0","0"],_=v[1],m=v[2],E=v[3];if(!_||void 0===m||void 0===E)continue;var y=e.getSequenceByIndex(0).getCanvasById(_);if(null===y)throw new Error("Canvas not found..");h.canvases.push(y.id);var b=r.canvasTime(parseFloat(m||"0")),I=r.canvasTime(parseFloat(E||"0")),T=r.timelineTime(I-b);p=r.addTime(T,p);var O={type:"time-stop",canvasIndex:f,start:r.minusTime(p,T),end:p,duration:T,rangeId:n.id,rawCanvasSelector:g,canvasTime:{start:b,end:I},rangeStack:s};h.stops.push(O),h.items.push(O)}else{var A=g.getBehavior();if(!A||"no-nav"!==A){var C=t(g,o(s,[g.id]),p);p=r.addTime(p,C.duration),(u=h.stops).push.apply(u,C.stops.map(function(e){return i(i({},e),{canvasIndex:e.canvasIndex+h.canvases.length})})),(l=h.canvases).push.apply(l,C.canvases),h.items.push(C),(c=h.rangeOrder).push.apply(c,C.rangeOrder)}}}return h.end=p,h.duration=r.timelineTime(h.end-h.start),h},n=e.getTopRanges(),s=[];n||(n=e.getAllRanges()),1!==n.length||n[0].id||(n=n[0].getRanges());for(var a=0,u=n;a<u.length;a++){var l=u[a];l.getRanges()[0]&&l.id===l.getRanges()[0].id&&(l=l.getRanges()[0]);var c=t(l,[l.id]);s.push(c)}return s[0]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3),o=n(18),r=n(6);t.getMediaSourceFromAnnotationBody=function(e,t,n){var s=t.getType(),a=t.getFormat()||void 0,u=t.id.split("#")[0],l=e.getTarget();if(!l)throw new Error("No target");if(!s)throw new Error("Unknown media type");var c=o.getSpatialComponent(l)||[0,0,n.width||0,n.height||0],h=c[0],p=c[1],d=c[2],f=c[3],g=i.Utils.getTemporalComponent(l)||[0,n.duration],v=g[0],_=g[1],m=t.id.match(/(.*)#t=([0-9.]+),?([0-9.]+)?/)||[void 0,t.id,void 0,void 0],E=m[1],y=m[2],b=m[3];return{type:s,format:a,mediaSource:u,canvasId:n.id,x:h,y:p,width:void 0===d?void 0:parseInt(String(d),10),height:void 0===f?void 0:parseInt(String(f),10),start:r.annotationTime(Number(Number(v).toFixed(2))),end:r.annotationTime(Number(Number(_).toFixed(2))),bodyId:E,offsetStart:void 0===y?void 0:r.canvasTime(parseFloat(y)),offsetEnd:void 0===b?void 0:r.canvasTime(parseFloat(b))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.formatTime=function(e){var t,n,i;return i=Math.ceil(e),((t=(t=Math.floor(i/3600))>=10?t:"0"+t)>=1?t+":":"")+(n=(n=Math.floor(i%3600/60))>=10?n:"0"+n)+":"+(i=(i=Math.floor(i%3600%60))>=10?i:"0"+i)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.normalise=function(e,t,n){return(e-t)/(n-t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(11);t.isVirtual=function(e){return!!e&&e instanceof i.VirtualCanvas}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3);t.getFirstTargetedCanvasId=function o(e){var t;if(e.canvases&&e.canvases.length)t=e.canvases[0];else{var n=e.getRanges();if(n.length)return o(n[0])}return void 0!==t?i.Utils.normaliseUrl(t):void 0}},function(e,t,n){e.exports=n(37)},function(e,t,n){"use strict";function i(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),i(n(22)),i(n(27)),i(n(29)),i(n(58)),i(n(19)),i(n(9)),i(n(4))},function(e,t){e.exports=function(e,t){for(var n=-1,i=t.length,o=e.length;++n<i;)e[o+n]=t[n];return e}},function(e,t,n){var i=n(8),o=n(43),r=n(48),s=i?i.isConcatSpreadable:void 0;e.exports=function(e){return r(e)||o(e)||!!(s&&e&&e[s])}},function(e,t,n){var i=n(41),o="object"==typeof self&&self&&self.Object===Object&&self,r=i||o||Function("return this")();e.exports=r},function(e,t,n){(function(t){var n="object"==typeof t&&t&&t.Object===Object&&t;e.exports=n}).call(this,n(42))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var i=n(44),o=n(24),r=Object.prototype,s=r.hasOwnProperty,a=r.propertyIsEnumerable,u=i(function(){return arguments}())?i:function(e){return o(e)&&s.call(e,"callee")&&!a.call(e,"callee")};e.exports=u},function(e,t,n){var i=n(45),o=n(24);e.exports=function(e){return o(e)&&"[object Arguments]"==i(e)}},function(e,t,n){var i=n(8),o=n(46),r=n(47),s=i?i.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":s&&s in Object(e)?o(e):r(e)}},function(e,t,n){var i=n(8),o=Object.prototype,r=o.hasOwnProperty,s=o.toString,a=i?i.toStringTag:void 0;e.exports=function(e){var t=r.call(e,a),n=e[a];try{e[a]=void 0;var i=!0}catch(e){}var o=s.call(e);return i&&(t?e[a]=n:delete e[a]),o}},function(e,t){var n=Object.prototype.toString;e.exports=function(e){return n.call(e)}},function(e,t){var n=Array.isArray;e.exports=n},function(e,t,n){e.exports=self.fetch||(self.fetch=n(25)["default"]||n(25))},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{u(i.next(e))}catch(e){r(e)}}function a(e){try{u(i["throw"](e))}catch(e){r(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}u((i=i.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){function n(e){return function(n){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(r=2&e[0]?o["return"]:e[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,e[1])).done)return r;switch(o=0,r&&(e=[2&e[0],r.value]),e[0]){case 0:case 1:r=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(r=a.trys,!((r=r.length>0&&r[r.length-1])||6!==e[0]&&2!==e[0])){a=0;continue}if(3===e[0]&&(!r||e[1]>r[0]&&e[1]<r[3])){a.label=e[1];break}if(6===e[0]&&a.label<r[1]){a.label=r[1],r=e;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(e);break}r[2]&&a.ops.pop(),a.trys.pop();continue}e=t.call(n,a)}catch(n){e=[6,n],o=0}finally{i=r=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,n])}}var i,o,r,s,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0});var r=n(51),s=n(52),a=n(53),u=n(54),l=n(2),c=function(){function e(e,t){switch(void 0===t&&(t={}),this.source=e,this.mediaSource=e.mediaSource,this.type=e.type.toString().toLowerCase(),this.format=e.format?e.format.toString():void 0,this.mediaSyncMarginSecs=t.mediaSyncMarginSecs||1,this.type){case"video":this.element=document.createElement("video");break;case"sound":case"audio":this.element=document.createElement("audio");break;default:return}this.isDash()?this.instance=new r.DashFormat(this.mediaSource,t):this.isHls()?this.instance=new s.HlsFormat(this.mediaSource,t):this.isMpeg()?this.instance=new a.MpegFormat(this.mediaSource,t):this.instance=new u.DefaultFormat(this.mediaSource,t),this.element.classList.add("anno"),this.element.crossOrigin="anonymous",this.element.preload="metadata",this.element.pause(),this.instance.attachTo(this.element),this.element.currentTime=this.source.start}return e.prototype.syncClock=function(e){e>this.element.duration?l.Logger.error("Clock synced out of bounds (max: "+this.element.duration+", got: "+e+")"):Math.abs(this.element.currentTime-e)>this.mediaSyncMarginSecs&&(this.element.currentTime=e)},e.prototype.getCanvasId=function(){return this.source.canvasId},e.prototype.isWithinRange=function(e){return this.source.start<=e&&this.source.end>=e},e.prototype.load=function(e){return void 0===e&&(e=!1),i(this,void 0,void 0,function(){var t=this;return o(this,function(n){switch(n.label){case 0:return e&&this.element.load(),[4,new Promise(function(e){t.element.addEventListener("loadedmetadata",function(){e()})})];case 1:return n.sent(),[2]}})})},e.prototype.setSize=function(e,t,n,i){$(this.element).css({top:e+"%",left:t+"%",width:n+"%",height:i+"%"})},e.prototype.isDash=function(){return this.format&&"application/dash+xml"===this.format.toString()&&"undefined"!=typeof dashjs},e.prototype.isHls=function(){return this.format&&"application/vnd.apple.mpegurl"===this.format.toString()&&"undefined"!=typeof Hls&&Hls.isSupported()},e.prototype.isMpeg=function(){return""!==this.element.canPlayType("application/vnd.apple.mpegurl")},e.prototype.stop=function(){this.element.pause(),this.element.currentTime=this.source.start},e.prototype.play=function(e){return l.Logger.log("MediaElement.play("+e+")"),void 0!==e&&(this.element.currentTime=e),this.element.play()},e.prototype.pause=function(){this.element.pause()},e.prototype.isBuffering=function(){return this.element.readyState<3},e}();t.MediaElement=c},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(t,n){void 0===n&&(n={});var i=e.call(this,t,n)||this;return i.player=dashjs.MediaPlayer().create(),i.player.getDebug().setLogToBrowserConsole(!1),n.adaptiveAuthEnabled&&i.player.setXHRWithCredentialsForType("MPD",!0),i}return o(t,e),t.prototype.attachTo=function(e){this.player.initialize(e,this.source,!1)},t.prototype.debug=function(){this.player.getDebug().setLogToBrowserConsole(!0),this.player.getDebug().setLogLevel(4)},t}(n(5).MediaFormat);t.DashFormat=r},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){
e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(t,n){void 0===n&&(n={});var i=e.call(this,t,n)||this;return n.adaptiveAuthEnabled?i.hls=new Hls({xhrSetup:function(e){e.withCredentials=!0}}):i.hls=new Hls,i.hls.loadSource(i.source),i}return o(t,e),t.prototype.attachTo=function(e){this.hls.attachMedia(e)},t}(n(5).MediaFormat);t.HlsFormat=r},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(t,n){return void 0===n&&(n={}),e.call(this,t,n)||this}return o(t,e),t.prototype.attachTo=function(e){e.src=this.source},t}(n(5).MediaFormat);t.MpegFormat=r},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(t,n){return void 0===n&&(n={}),e.call(this,t,n)||this}return o(t,e),t}(n(5).MediaFormat);t.DefaultFormat=r},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{u(i.next(e))}catch(e){r(e)}}function a(e){try{u(i["throw"](e))}catch(e){r(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}u((i=i.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){function n(e){return function(n){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(r=2&e[0]?o["return"]:e[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,e[1])).done)return r;switch(o=0,r&&(e=[2&e[0],r.value]),e[0]){case 0:case 1:r=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(r=a.trys,!((r=r.length>0&&r[r.length-1])||6!==e[0]&&2!==e[0])){a=0;continue}if(3===e[0]&&(!r||e[1]>r[0]&&e[1]<r[3])){a.label=e[1];break}if(6===e[0]&&a.label<r[1]){a.label=r[1],r=e;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(e);break}r[2]&&a.ops.pop(),a.trys.pop();continue}e=t.call(n,a)}catch(n){e=[6,n],o=0}finally{i=r=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,n])}}var i,o,r,s,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},r=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;n>t;t++)e+=arguments[t].length;var i=Array(e),o=0;for(t=0;n>t;t++)for(var r=arguments[t],s=0,a=r.length;a>s;s++,o++)i[o]=r[s];return i};Object.defineProperty(t,"__esModule",{value:!0});var s=n(6),a=n(2),u=function(){function e(e,t,n,i,o){var r=this;this.continuous=!0,this.playing=!1,this._time=s.timelineTime(0),this.media=e,this.plan=t,this.fullPlan=t,this.currentStop=t.stops[0];var a=function(){};this.notifyRangeChange=n||a,this.notifyTimeChange=i||a,this.notifyPlaying=o||a,this.logging=!0,this.currentRange=this.currentStop.rangeStack[0],this.setTime(this.currentStop.start),e.onPlay(function(e,t,n){e===r.plan.canvases[r.currentStop.canvasIndex]?r.playing||r.notifyPlaying(!0):n.pause()}),e.onPause(function(e){e===r.plan.canvases[r.currentStop.canvasIndex]&&r.playing&&r.notifyPlaying(!1)})}return e.prototype.selectPlan=function(e){var t=void 0===e?{}:e,n=t.reset,i=t.rangeId;if(n)return this.initialisePlan(this.fullPlan);if(i){for(var o=[],r=0,s=this.fullPlan.stops;r<s.length;r++){var a=s[r],u=a.rangeStack.indexOf(i);-1!==a.rangeStack.indexOf(i)&&(o=a.rangeStack.slice(1,u+1))}for(var l=this.fullPlan,c=0,h=o;c<h.length;c++)for(var p=h[c],d=0,f=l.items;d<f.length;d++){var g=f[d];if("time-plan"===g.type&&g.rangeId===p){l=g;break}}if(l)return this.initialisePlan(l)}},e.prototype.initialisePlan=function(e){this.plan=e},e.prototype.getCurrentRange=function(){for(var e=this.currentRange,t=this.currentRange===this.currentStop.rangeId,n=t?this.plan.stops:this.fullPlan.stops,i=[],o=[],r=0,s=n;r<s.length;r++){var u=s[r];t?u.rangeId===e&&(i.push(u.start),o.push(u.end)):-1!==u.rangeStack.indexOf(e)&&(i.push(u.start),o.push(u.end))}var l=Math.min.apply(Math,i),c=Math.max.apply(Math,o);return a.Logger.log("Range",{rangeId:e,isRangeWithStop:t,stopsToCheck:n,start:l-this.plan.start,end:c-this.plan.start,duration:c-l}),{start:l-this.plan.start,end:c-this.plan.start,duration:c-l}},e.prototype.getTime=function(){return this._time},e.prototype.setInternalTime=function(e){return this._time=e,this.notifyTimeChange(e),this._time},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.logging&&a.Logger.log.apply(a.Logger,r(["TimePlanPlayer"],e))},e.prototype.setContinuousPlayback=function(e){this.continuous=e},e.prototype.setIsPlaying=function(e){this.playing=e},e.prototype.play=function(){return this.log("Play",this.getTime()),this.setIsPlaying(!0),this.media.play(this.plan.canvases[this.currentStop.canvasIndex]),this.getTime()},e.prototype.currentTimelineTime=function(){return this.getTime()},e.prototype.currentMediaTime=function(){a.Logger.log("Current media time:\n  - Current start: "+this.currentStop.start+"\n  - Current canvas: "+this.currentStop.canvasTime.start+"\n  - Current time: "+this.getTime()+"\n    ",this);var e=s.minusTime(this.getTime(),this.currentStop.start);return s.annotationTime(s.addTime(e,s.timelineTime(this.currentStop.canvasTime.start)))},e.prototype.pause=function(){return this.log("Pause",this.getTime()),this.setIsPlaying(!1),this.media.pause(),this.getTime()},e.prototype.setVolume=function(e){this.media.setVolume(e)},e.prototype.findStop=function(e){for(var t=0,n=this.plan.stops;t<n.length;t++){var i=n[t];if(i.start-.001<=e&&i.end-.001>e)return i}return this.plan.stops[this.plan.stops.length-1].end===e?this.plan.stops[this.plan.stops.length-1]:void 0},e.prototype.setTime=function(e,t){return void 0===t&&(t=!0),i(this,void 0,void 0,function(){var n;return o(this,function(i){switch(i.label){case 0:return a.Logger.groupCollapsed("TimeplanPlayer.setTime("+e+", "+(t?"true":"false")+")"),this.getTime()===e?[3,2]:(this.log("set time",{from:this.getTime(),to:e}),this.setInternalTime(e),(n=this.findStop(e))&&n!==this.currentStop?(t&&(this.currentRange=n.rangeId),[4,this.advanceToStop(this.currentStop,n)]):[3,2]);case 1:i.sent(),i.label=2;case 2:return a.Logger.groupEnd(),[2]}})})},e.prototype.next=function(){for(var e=this.plan.rangeOrder.indexOf(this.currentRange),t=e>=0&&e===this.plan.rangeOrder.length-1?void 0:this.plan.rangeOrder.indexOf(this.currentRange)+1,n=void 0!==t?this.plan.rangeOrder[t]:void 0,i=this.plan.stops.indexOf(this.currentStop),o=0,r=void 0,s=!0;s;){if(o++,!(r=this.plan.stops[i+o])){s=!1;break}if(r.rangeId!==this.currentStop.rangeId){s=!1;break}}return this.playing&&r&&(n=r.rangeId),n&&r&&r.rangeId!==n?(this.playing||-1===this.currentStop.rangeStack.indexOf(n)&&-1!==r.rangeStack.indexOf(n)?(this.currentRange=this.playing?r.rangeId:n,this.setInternalTime(r.start),this.advanceToStop(this.currentStop,r,this.playing?r.rangeId:n)):(this.currentRange=n,this.setInternalTime(this.currentStop.start),this.advanceToStop(this.currentStop,this.currentStop,n)),this.getTime()):(r?(this.setInternalTime(r.start),this.currentRange=r.rangeId,this.advanceToStop(this.currentStop,r,r.rangeId)):this.goToEndOfRange(this.currentStop.rangeId),this.getTime())},e.prototype.goToEndOfRange=function(e){for(var t=void 0,n=0;n<this.plan.stops.length;n++){var i=this.plan.stops[n];i.rangeId===e&&(!t||i.canvasIndex>=t.canvasIndex&&i.end>t.end)&&(t=i)}t&&(this.advanceToStop(this.currentStop,t,e),this.setInternalTime(t.end))},e.prototype.goToStartOfRange=function(e){for(var t=void 0,n=this.plan.stops.length-1;n>=0;n--){var i=this.plan.stops[n];i.rangeId===e&&(!t||i.canvasIndex<=t.canvasIndex&&i.start<t.start)&&(t=i)}t&&(t!==this.currentStop&&this.advanceToStop(this.currentStop,t,e),this.setInternalTime(t.start))},e.prototype.previous=function(){for(var e=0===this.plan.rangeOrder.indexOf(this.currentRange)?void 0:this.plan.rangeOrder.indexOf(this.currentRange)-1,t=void 0!==e?this.plan.rangeOrder[e]:void 0,n=this.currentStop,i=this.plan.stops.indexOf(this.currentStop),o=i,r=this.plan.stops[i-1],s=!0;s;){var a=this.plan.stops[o-1];if(!a){s=!1;break}if(a.rangeId===this.currentRange&&(n=a),r.rangeId!==a.rangeId){s=!1;break}a&&(r=a,o-=1)}var u=this._time-(n.start+2)>0,l=this.playing&&r&&r.rangeId!==this.currentStop.rangeId,c=0===i||!t&&0===o,h=t&&-1===this.currentStop.rangeStack.indexOf(t)&&(-1!==r.rangeStack.indexOf(t)||r.rangeId===t),p=t&&-1!==this.currentStop.rangeStack.indexOf(t);return u?(n!==this.currentStop&&this.advanceToStop(this.currentStop,n,n.rangeId),this.setInternalTime(n.start),this.getTime()):(l&&(t=r.rangeId),c?(this.goToStartOfRange(t||this.currentStop.rangeId),t&&this.currentStop.rangeId!==t&&(this.currentRange=t,this.advanceToStop(this.currentStop,n,t)),this.getTime()):t&&h?(this.setInternalTime(r.start),this.currentRange=t,this.advanceToStop(this.currentStop,r,t),this.getTime()):t&&p?(this.setInternalTime(this.currentStop.start),this.currentRange=t,this.advanceToStop(this.currentStop,n,t),this.getTime()):this.getTime())},e.prototype.setRange=function(e){if(a.Logger.log("setRange",e),e===this.currentRange)return this.getTime();if(this.currentRange=e,e===this.currentStop.rangeId)return this.getTime();for(var t=0,n=this.plan.stops;t<n.length;t++){var i=n[t];if(i.rangeId===e){this.setInternalTime(i.start),this.advanceToStop(this.currentStop,i,e);break}}for(var o=0,r=this.plan.stops;o<r.length;o++){var s=r[o];if(-1!==s.rangeStack.indexOf(e)){this.setInternalTime(s.start),this.advanceToStop(this.currentStop,s,e);break}}return this.getTime()},e.prototype.isBuffering=function(){return this.media.isBuffering()},e.prototype.advanceToTime=function(e){a.Logger.groupCollapsed("TimeplanPlayer.advanceToTime("+e+")");var t=this.findStop(e);return t&&this.currentStop!==t?(a.Logger.log("advanceToTime.a"),this.advanceToStop(this.currentStop,t),{buffering:this.isBuffering(),time:e}):(this.playing&&this.currentRange!==this.currentStop.rangeId&&(this.currentRange=this.currentStop.rangeId,this.notifyRangeChange(this.currentStop.rangeId,{from:this.currentStop,to:this.currentStop})),t?(a.Logger.log("advanceToTime.c",{time:this.getTime()}),this.setInternalTime(e),this.media.syncClock(this.currentMediaTime()),a.Logger.groupEnd(),{time:e}):(a.Logger.log("advanceToTime.b"),this.pause(),this.setTime(this.currentStop.end),a.Logger.groupEnd(),{paused:!0,buffering:this.isBuffering(),time:this.currentStop.end}))},e.prototype.hasEnded=function(){return this.currentStop.end===this.getTime()},e.prototype.advanceToStop=function(e,t,n){return i(this,void 0,void 0,function(){var i;return o(this,function(o){switch(o.label){case 0:return a.Logger.log("TimeplanPlayer.advanceToStop",{from:e,to:t,rangeId:n}),e===t?(n&&this.notifyRangeChange(n||t.rangeId,{to:t,from:e}),[2]):(this.log("advanceToStop",t.start),this.currentStop=t,i=this.media.seekToMediaTime(this.currentMediaTime()),this.notifyRangeChange(n||t.rangeId,{to:t,from:e}),[4,i]);case 1:return o.sent(),[2]}})})},e.prototype.getStartTime=function(){return this.plan.start},e.prototype.getDuration=function(){return this.plan.duration},e}();t.TimePlanPlayer=u},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{u(i.next(e))}catch(e){r(e)}}function a(e){try{u(i["throw"](e))}catch(e){r(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}u((i=i.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){function n(e){return function(n){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(r=2&e[0]?o["return"]:e[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,e[1])).done)return r;switch(o=0,r&&(e=[2&e[0],r.value]),e[0]){case 0:case 1:r=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(r=a.trys,!((r=r.length>0&&r[r.length-1])||6!==e[0]&&2!==e[0])){a=0;continue}if(3===e[0]&&(!r||e[1]>r[0]&&e[1]<r[3])){a.label=e[1];break}if(6===e[0]&&a.label<r[1]){a.label=r[1],r=e;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(e);break}r[2]&&a.ops.pop(),a.trys.pop();continue}e=t.call(n,a)}catch(n){e=[6,n],o=0}finally{i=r=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,n])}}var i,o,r,s,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),s=function(){function e(e){var t=this;this.elements=[],this.playing=!1,this.canvasMap={},this._onPlay=[],this._onPause=[],r.Logger.log("Composite media element",e),this.elements=e;for(var n=function(e){var n=e.getCanvasId();i.canvasMap[n]=i.canvasMap[n]?i.canvasMap[n]:[],i.canvasMap[n].push(e),e.element.addEventListener("play",function(){t._onPlay.forEach(function(t){return t(n,e.element.currentTime,e)})}),e.element.addEventListener("pause",function(){t._onPause.forEach(function(t){return t(n,e.element.currentTime,e)})})},i=this,o=0,s=e;o<s.length;o++)n(s[o]);this.activeElement=e[0]}return e.prototype.syncClock=function(e){r.Logger.group("CompositeMediaElement.syncClock"),r.Logger.log("syncClock: "+e),r.Logger.log({fromTime:e,toTime:e,instance:this}),this.activeElement&&this.activeElement.syncClock(e),r.Logger.groupEnd()},e.prototype.onPlay=function(e){this._onPlay.push(e)},e.prototype.onPause=function(e){this._onPause.push(e)},e.prototype.findElementInRange=function(e,t){if(this.canvasMap[e])for(var n=0,i=this.canvasMap[e];n<i.length;n++){var o=i[n];if(o.isWithinRange(t))return o}},e.prototype.appendTo=function(e){r.Logger.log("Appending...",this.elements.map(function(e){return e.element})),e.append(this.elements.map(function(e){return e.element}))},e.prototype.load=function(){return i(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return[4,Promise.all(this.elements.map(function(e){return e.load()}))];case 1:return e.sent(),[2]}})})},e.prototype.seekToMediaTime=function(e){return i(this,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return this.activeElement?this.playing?[4,this.activeElement.play(e)]:[3,2]:[3,3];case 1:return t.sent(),[3,3];case 2:this.activeElement.syncClock(e),t.label=3;case 3:return[2]}})})},e.prototype.seekTo=function(e,t){return i(this,void 0,void 0,function(){var n;return o(this,function(i){return n=this.findElementInRange(e,t),r.Logger.log("CompositeMediaElement.seekTo()",{canvasId:n?n.source.canvasId:null,newElement:n}),this.activeElement&&n&&n!==this.activeElement&&(this.activeElement.stop(),this.activeElement=n),[2,this.seekToMediaTime(t)]})})},e.prototype.play=function(e,t){return i(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return this.playing=!0,e&&void 0!==t?[4,this.seekTo(e,t)]:[3,2];case 1:n.sent(),n.label=2;case 2:return this.activeElement?[2,this.activeElement.play(t)]:[2]}})})},e.prototype.pause=function(){this.playing=!1,this.activeElement&&this.activeElement.pause()},e.prototype.setVolume=function(e){for(var t=0,n=this.elements;t<n.length;t++)n[t].element.volume=e},e.prototype.isBuffering=function(){return!!this.activeElement&&this.activeElement.isBuffering()},e}();t.CompositeMediaElement=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){var t=this;this.length=0,this.duration=0,this.pixelsPerSecond=Number.MAX_VALUE,this.secondsPerPixel=Number.MAX_VALUE,this.timeIndex={},this.minIndex={},this.maxIndex={},this._waveforms=[],e.forEach(function(e){t._waveforms.push({start:t.length,end:t.length+e.adapter.length,waveform:e}),t.length+=e.adapter.length,t.duration+=e.duration,t.pixelsPerSecond=Math.min(t.pixelsPerSecond,e.pixels_per_second),t.secondsPerPixel=Math.min(t.secondsPerPixel,e.seconds_per_pixel)})}return e.prototype.min=function(e){if(void 0===this.minIndex[e]){var t=this._find(e);this.minIndex[e]=t?t.waveform.min_sample(e-t.start):0}return this.minIndex[e]},e.prototype.max=function(e){if(void 0===this.maxIndex[e]){var t=this._find(e);this.maxIndex[e]=t?t.waveform.max_sample(e-t.start):0}return this.maxIndex[e]},e.prototype._find=function(e){if(void 0===this.timeIndex[e]){var t=this._waveforms.find(function(t){return e>=t.start&&e<t.end});if(!t)return null;this.timeIndex[e]=t}return this.timeIndex[e]},e}();t.CompositeWaveform=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(16),o=n(30),r=n(59),s=n(20),a=n(28),u=n(32),l=n(35),c=n(31),h=n(18),p=n(26),d=n(14),f=n(13),g=n(60),v=n(15),_=n(17),m=n(34),E=n(33),y=n(12);t.AVComponentUtils={canPlayHls:i.canPlayHls,createTimePlansFromManifest:o.createTimePlansFromManifest,debounce:r.debounce,diffData:s.diffData,diff:s.diffData,extractMediaFromAnnotationBodies:a.extractMediaFromAnnotationBodies,formatTime:u.formatTime,getFirstTargetedCanvasId:l.getFirstTargetedCanvasId,getMediaSourceFromAnnotationBody:c.getMediaSourceFromAnnotationBody,getSpatialComponent:h.getSpatialComponent,getTimestamp:p.getTimestamp,hlsMimeTypes:d.hlsMimeTypes,hlsMediaTypes:d.hlsMimeTypes,isHLSFormat:f.isHLSFormat,isIE:g.isIE,isMpegDashFormat:v.isMpegDashFormat,isSafari:_.isSafari,isVirtual:m.isVirtual,normalise:E.normalise,normalize:E.normalise,normalizeNumber:E.normalise,normaliseNumber:E.normalise,retargetTemporalComponent:y.retargetTemporalComponent}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.debounce=function(e,t){return t=t||100,function(){if(!e.debouncing){var n=Array.prototype.slice.apply(arguments);e.lastReturnVal=e.apply(window,n),e.debouncing=!0}return clearTimeout(e.debounceTimeout),e.debounceTimeout=setTimeout(function(){e.debouncing=!1},t),e.lastReturnVal}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isIE=function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");if(t>0)return parseInt(e.substring(t+5,e.indexOf(".",t)),10);if(e.indexOf("Trident/")>0){var n=e.indexOf("rv:");return parseInt(e.substring(n+3,e.indexOf(".",n)),10)}var i=e.indexOf("Edge/");return i>0&&parseInt(e.substring(i+5,e.indexOf(".",i)),10)}}])}),define("lib/IIIFAVComponent.js",function(){});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-avcenterpanel-module/AVCenterPanel",["require","exports","../uv-shared-module/BaseEvents","../uv-shared-module/CenterPanel","../uv-shared-module/Position","../../Utils","manifesto.js","@iiif/iiif-av-component"],function(e,t,n,i,o,r,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=function(e){function t(t){var n=e.call(this,t)||this;return n._mediaReady=!1,n._isThumbsViewOpen=!1,n._mediaReadyQueue=[],n.attributionPosition=o.Position.BOTTOM_RIGHT,n}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("avCenterPanel"),e.prototype.create.call(this);var i=this;this.component.subscribe(n.BaseEvents.OPEN_EXTERNAL_RESOURCE,function(e){i.openMedia(e)}),this.component.subscribe(n.BaseEvents.CANVAS_INDEX_CHANGED,function(e){t._lastCanvasIndex!==e&&t._viewCanvas(e)}),this.component.subscribe(n.BaseEvents.CURRENT_TIME_CHANGED,function(e,n){t._whenMediaReady(function(){t.avcomponent&&t.avcomponent.setCurrentTime(n)})}),this.component.subscribe(n.BaseEvents.RANGE_CHANGED,function(e){t._observeRangeChanges()&&t._whenMediaReady(function(){i._viewRange(e),i._setTitle()})}),this.component.subscribe(n.BaseEvents.METRIC_CHANGED,function(){t._whenMediaReady(function(){t.avcomponent&&t.avcomponent.set({limitToRange:t._limitToRange(),constrainNavigationToRange:t._limitToRange()})})}),this.component.subscribe(n.BaseEvents.CREATED,function(){t._setTitle()}),this.component.subscribe(n.BaseEvents.OPEN_THUMBS_VIEW,function(){t._isThumbsViewOpen=!0,t._whenMediaReady(function(){if(t.avcomponent){t.avcomponent.set({virtualCanvasEnabled:!1});var e=t.extension.helper.getCurrentCanvas();e&&t._viewCanvas(t.extension.helper.canvasIndex)}})}),this.component.subscribe(n.BaseEvents.OPEN_TREE_VIEW,function(){t._isThumbsViewOpen=!1,t._whenMediaReady(function(){t.avcomponent&&t.avcomponent.set({virtualCanvasEnabled:!0})})}),this._createAVComponent()},t.prototype._flushMediaReadyQueue=function(){for(var e=0,t=this._mediaReadyQueue;e<t.length;e++){var n=t[e];n()}this._mediaReadyQueue=[]},t.prototype._createAVComponent=function(){var e=this;this.$avcomponent=$('<div class="iiif-av-component"></div>'),this.$content.prepend(this.$avcomponent),this.avcomponent=new a.AVComponent({target:this.$avcomponent[0],posterImageExpanded:this.options.posterImageExpanded}),this.avcomponent.on("mediaready",function(){console.log("mediaready"),e._mediaReady=!0,e._flushMediaReadyQueue()},!1),this.avcomponent.on("pause",function(){e.component.publish(n.BaseEvents.PAUSE,e.avcomponent.getCurrentTime())}),this.avcomponent.on("rangechanged",function(t){if(t){var i=e.extension.helper.getRangeById(t);if(i){var o=e.extension.helper.getCurrentRange();i!==o&&e.component.publish(n.BaseEvents.RANGE_CHANGED,i)}else e.component.publish(n.BaseEvents.RANGE_CHANGED,null)}else e.component.publish(n.BaseEvents.RANGE_CHANGED,null);e._setTitle()},!1)},t.prototype._observeRangeChanges=function(){return!this._isThumbsViewOpen},t.prototype._setTitle=function(){var e,t,n=this,i="",o=this.extension.helper.getCurrentRange();t=o?o.getLabel():this.extension.helper.getCurrentCanvas().getLabel(),e=s.LanguageMap.getValue(t),e&&(i=e),Utils.Bools.getBool(this.config.options.includeParentInTitleEnabled,!1)&&(o?o.parentRange&&(t=o.parentRange.getLabel(),e=s.LanguageMap.getValue(t)):e=this.extension.helper.getLabel(),e&&(i+=this.content.delimiter+e)),this.title=i;for(var a=this.extension.helper.getMetadata({range:o}),u=0;u<a.length;u++){var l=a[u],c=l.items.find(function(e){if(e.label){var t=s.LanguageMap.getValue(e.label);if(t&&t.toLowerCase()===n.config.options.subtitleMetadataField)return!0}return!1});if(c){this.subtitle=s.LanguageMap.getValue(c.value);break}}this.$title.text(r.UVUtils.sanitize(this.title)),this.resize(!1)},t.prototype._isCurrentResourceAccessControlled=function(){var e=this.extension.helper.getCurrentCanvas();return e.externalResource.isAccessControlled()},t.prototype.openMedia=function(e){var t=this;this.extension.getExternalResources(e).then(function(){t.avcomponent&&(t.extension.helper.canvasIndex===t._lastCanvasIndex&&t.avcomponent.reset(),t._lastCanvasIndex=t.extension.helper.canvasIndex,t.avcomponent.set({helper:t.extension.helper,adaptiveAuthEnabled:t._isCurrentResourceAccessControlled(),autoPlay:t.config.options.autoPlay,enableFastForward:t.config.options.enableFastForward,enableFastRewind:t.config.options.enableFastRewind,autoSelectRange:!0,constrainNavigationToRange:t._limitToRange(),content:t.content,defaultAspectRatio:.56,doubleClickMS:350,limitToRange:t._limitToRange(),posterImageRatio:t.config.options.posterImageRatio}),t.resize())})},t.prototype._limitToRange=function(){return!this.extension.isDesktopMetric()},t.prototype._whenMediaReady=function(e){this._mediaReady?e():this._mediaReadyQueue.push(e)},t.prototype._viewRange=function(e){var t=this;this._whenMediaReady(function(){e&&t.avcomponent&&t.avcomponent.viewRange(e.id),t.resize(!1)})},t.prototype._viewCanvas=function(e){var t=this;this._whenMediaReady(function(){var n=t.extension.helper.getCanvasByIndex(e);t.avcomponent&&t.avcomponent.showCanvas(n.id)})},t.prototype.resize=function(t){void 0===t&&(t=!0),e.prototype.resize.call(this),t&&this.avcomponent&&(this.$avcomponent.height(this.$content.height()),this.avcomponent.resize())},t}(i.CenterPanel);t.AVCenterPanel=u}),define("modules/uv-shared-module/InformationArgs",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.informationType=e,this.param=t}return e}();t.InformationArgs=n}),define("modules/uv-shared-module/InformationType",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n;!function(e){e[e.AUTH_CORS_ERROR=0]="AUTH_CORS_ERROR",e[e.DEGRADED_RESOURCE=1]="DEGRADED_RESOURCE"}(n=t.InformationType||(t.InformationType={}))}),define("modules/uv-shared-module/LoginWarningMessages",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.FORBIDDEN="forbiddenResourceMessage",e}();t.LoginWarningMessages=n}),define("modules/uv-shared-module/Auth09",["require","exports","manifesto.js","./BaseEvents","./InformationArgs","./InformationType","./LoginWarningMessages"],function(e,t,n,i,o,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(){}return e.loadExternalResources=function(t,o){return new Promise(function(r){n.Utils.loadExternalResourcesAuth09(t,o,e.clickThrough,e.restricted,e.login,e.getAccessToken,e.storeAccessToken,e.getStoredAccessToken,e.handleExternalResourceResponse).then(function(e){r(e)})["catch"](function(t){switch(t.name){case n.StatusCode.AUTHORIZATION_FAILED.toString():e.publish(i.BaseEvents.LOGIN_FAILED);break;case n.StatusCode.FORBIDDEN.toString():e.publish(i.BaseEvents.FORBIDDEN);break;case n.StatusCode.RESTRICTED.toString():break;default:e.publish(i.BaseEvents.SHOW_MESSAGE,[t.message||t])}})})},e.clickThrough=function(t){return new Promise(function(n){e.publish(i.BaseEvents.SHOW_CLICKTHROUGH_DIALOGUE,[{resource:t,acceptCallback:function(){if(t.clickThroughService)var o=window.open(t.clickThroughService.id),r=window.setInterval(function(){o&&o.closed&&(window.clearInterval(r),e.publish(i.BaseEvents.CLICKTHROUGH),n())},500)}}])})},e.restricted=function(t){return new Promise(function(n,o){e.publish(i.BaseEvents.SHOW_RESTRICTED_DIALOGUE,[{resource:t,acceptCallback:function(){e.publish(i.BaseEvents.LOAD_FAILED),o(t)}}])})},e.login=function(t){return new Promise(function(n){var o={};t.status===HTTPStatusCode.FORBIDDEN&&(o.warningMessage=s.LoginWarningMessages.FORBIDDEN,o.showCancelButton=!0),e.publish(i.BaseEvents.SHOW_LOGIN_DIALOGUE,[{resource:t,loginCallback:function(){if(t.loginService)var o=window.open(t.loginService.id+"?t="+(new Date).getTime()),r=window.setInterval(function(){o&&o.closed&&(window.clearInterval(r),e.publish(i.BaseEvents.LOGIN),n())},500)},logoutCallback:function(){if(t.logoutService)var o=window.open(t.logoutService.id+"?t="+(new Date).getTime()),r=window.setInterval(function(){o&&o.closed&&(window.clearInterval(r),e.publish(i.BaseEvents.LOGOUT),n())},500)},options:o}])})},e.getAccessToken=function(e,t){return new Promise(function(n,i){if(e.tokenService){var o=e.tokenService.id,r=o+"|"+(new Date).getTime(),s=function(e){window.removeEventListener("message",s);var o=e.data;o.error?t?i(o.errorDescription):n(void 0):n(o)};window.addEventListener("message",s,!1);var a=o+"?messageId="+r;$("#commsFrame").prop("src",a)}else i("Token service not found")})},e.storeAccessToken=function(e,t,n){return new Promise(function(i,o){e.tokenService?(Utils.Storage.set(e.tokenService.id,t,t.expiresIn,new Utils.StorageType(n)),i()):o("Token service not found")})},e.getStoredAccessToken=function(e,t){return new Promise(function(n,i){var o=[],r=null;if(e.tokenService&&(r=Utils.Storage.get(e.tokenService.id,new Utils.StorageType(t))),r)o.push(r);else for(var s=Utils.Urls.getUrlParts(e.dataUri).hostname,a=Utils.Storage.getItems(new Utils.StorageType(t)),u=0;u<a.length;u++)r=a[u],r.key.includes(s)&&o.push(r);o=o.sort(function(e,t){return e.expiresAt-t.expiresAt});var l;o.length&&(l=o[o.length-1].value),n(l)})},e.handleExternalResourceResponse=function(t){return new Promise(function(s,a){if(t.isResponseHandled=!0,t.status===HTTPStatusCode.OK)s(t);else if(t.status===HTTPStatusCode.MOVED_TEMPORARILY)s(t),e.publish(i.BaseEvents.RESOURCE_DEGRADED,[t]);else if(t.error.status===HTTPStatusCode.UNAUTHORIZED||t.error.status===HTTPStatusCode.INTERNAL_SERVER_ERROR)if(Modernizr.cors)a(t.error.statusText);else{var u=new o.InformationArgs(r.InformationType.AUTH_CORS_ERROR,null);e.publish(i.BaseEvents.SHOW_INFORMATION,[u]),s(t)}else if(t.error.status===HTTPStatusCode.FORBIDDEN){var l=new Error;l.message="Forbidden",l.name=n.StatusCode.FORBIDDEN.toString(),a(l)}else a(t.error.statusText)})},e.handleDegraded=function(t){var n=new o.InformationArgs(r.InformationType.DEGRADED_RESOURCE,t);e.publish(i.BaseEvents.SHOW_INFORMATION,[n])},e}();t.Auth09=a}),define("modules/uv-shared-module/Auth1",["require","exports","manifesto.js","./BaseEvents","../../Utils","./InformationArgs","./InformationType"],function(e,t,n,i,o,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(){}return e.loadExternalResources=function(t,o,r){return new Promise(function(s){e.storageStrategy=o,t=t.map(function(e){return e.authAPIVersion=1,e.options=r,e}),n.Utils.loadExternalResourcesAuth1(t,e.openContentProviderInteraction,e.openTokenService,e.getStoredAccessToken,e.userInteractedWithContentProvider,e.getContentProviderInteraction,e.handleMovedTemporarily,e.showOutOfOptionsMessages).then(function(e){s(e)})["catch"](function(t){switch(t.name){case n.StatusCode.AUTHORIZATION_FAILED.toString():e.publish(i.BaseEvents.LOGIN_FAILED);break;case n.StatusCode.FORBIDDEN.toString():e.publish(i.BaseEvents.FORBIDDEN);break;case n.StatusCode.RESTRICTED.toString():break;default:e.publish(i.BaseEvents.SHOW_MESSAGE,[t.message||t])}})})},e.getCookieServiceUrl=function(t){return t.id+"?origin="+e.getOrigin()},e.openContentProviderInteraction=function(t){var n=e.getCookieServiceUrl(t);return window.open(n)},e.getOrigin=function(e){var t=window.location;return e&&(t=document.createElement("a"),t.href=e),t.protocol+"//"+t.hostname+(t.port?":"+t.port:"")},e.userInteractedWithContentProvider=function(e){return new Promise(function(t){var n=window.setInterval(function(){e.closed&&(window.clearInterval(n),t(!0))},500)})},e.handleMovedTemporarily=function(t){return new Promise(function(n){e.showDegradedMessage(t),t.isResponseHandled=!0,n()})},e.showDegradedMessage=function(t){var n=new r.InformationArgs(s.InformationType.DEGRADED_RESOURCE,t);e.publish(i.BaseEvents.SHOW_INFORMATION,[n])},e.storeAccessToken=function(t,n){return new Promise(function(i,o){t.tokenService?(Utils.Storage.set(t.tokenService.id,n,n.expiresIn,new Utils.StorageType(e.storageStrategy)),i()):o("Token service not found")})},e.getStoredAccessToken=function(t){return new Promise(function(n){var i=[],o=null;if(t.tokenService&&(o=Utils.Storage.get(t.tokenService.id,new Utils.StorageType(e.storageStrategy))),o)i.push(o);else for(var r=Utils.Urls.getUrlParts(t.dataUri).hostname,s=Utils.Storage.getItems(new Utils.StorageType(e.storageStrategy)),a=0;a<s.length;a++)o=s[a],o.key.includes(r)&&i.push(o);i=i.sort(function(e,t){
return e.expiresAt-t.expiresAt});var u=null;i.length&&(u=i[i.length-1].value),n(u)})},e.getContentProviderInteraction=function(t,n){return new Promise(function(o){t.isResponseHandled&&!t.authHoldingPage?(e.showDegradedMessage(t),o(null)):t.authHoldingPage?(t.authHoldingPage.location.href=e.getCookieServiceUrl(n),o(t.authHoldingPage)):e.publish(i.BaseEvents.SHOW_AUTH_DIALOGUE,[{service:n,closeCallback:function(){o(null)},confirmCallback:function(){var t=e.openContentProviderInteraction(n);o(t)},cancelCallback:function(){o(null)}}])})},e.openTokenService=function(t,n){return new Promise(function(i,o){var r=e.getOrigin(n.id),s=(new Date).getTime();e.messages[s]={resolve:i,reject:o,serviceOrigin:r,resource:t},window.addEventListener("message",e.receiveToken,!1);var a=n.id+"?messageId="+s+"&origin="+e.getOrigin();$("#commsFrame").prop("src",a);var u=5e3;setTimeout(function(){e.messages[s]&&(e.messages[s].reject("Message unhandled after "+u+"ms, rejecting"),delete e.messages[s])},u)})},e.receiveToken=function(t){if(t.data.hasOwnProperty("messageId")){var n=e.messages[t.data.messageId];n&&t.origin==n.serviceOrigin&&e.storeAccessToken(n.resource,t.data).then(function(){n.resolve(t.data),delete e.messages[t.data.messageId]})}},e.showOutOfOptionsMessages=function(t,n){if(t.status!=HTTPStatusCode.MOVED_TEMPORARILY){var r="";n.getFailureHeader()&&(r+="<p>"+n.getFailureHeader()+"</p>"),n.getFailureDescription()&&(r+=n.getFailureDescription()),e.publish(i.BaseEvents.SHOW_MESSAGE,[o.UVUtils.sanitize(r)])}},e.messages={},e}();t.Auth1=a});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-shared-module/Dialogue",["require","exports","./BaseView","./BaseEvents"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){var n=e.call(this,t,!1,!1)||this;return n.allowClose=!0,n.isActive=!1,n.isUnopened=!0,n}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("dialogue"),e.prototype.create.call(this),this.component.subscribe(i.BaseEvents.CLOSE_ACTIVE_DIALOGUE,function(){t.isActive&&t.allowClose&&t.close()}),this.component.subscribe(i.BaseEvents.ESCAPE,function(){t.isActive&&t.allowClose&&t.close()}),this.$top=$('<div class="top"></div>'),this.$element.append(this.$top),this.$closeButton=$('<button type="button" class="btn btn-default close" tabindex="0">'+this.content.close+"</button>"),this.$middle=$('<div class="middle"></div>'),this.$element.append(this.$middle),this.$content=$('<div class="content"></div>'),this.$middle.append(this.$content),this.$buttons=$('<div class="buttons"></div>'),this.$middle.append(this.$buttons),this.$bottom=$('<div class="bottom"></div>'),this.$element.append(this.$bottom),this.config.topCloseButtonEnabled?this.$top.append(this.$closeButton):this.$buttons.append(this.$closeButton),this.$closeButton.on("click",function(e){e.preventDefault(),t.close()}),this.returnFunc=this.close},t.prototype.enableClose=function(){this.allowClose=!0,this.$closeButton.show()},t.prototype.disableClose=function(){this.allowClose=!1,this.$closeButton.hide()},t.prototype.setDockedPosition=function(){var e=Math.floor(this.extension.height()-this.$element.outerHeight(!0)),t=0,n=0,i=0;if(this.$triggerButton){var o=4,r=2,s=this.$triggerButton.offset().top,a=this.extension.$element.offset().top,u=this.$element.outerHeight(!0),l=s-a-u;e=l+o;var c=this.$triggerButton.offset().left,h=this.extension.$element.offset().left,p=c-h;i=Utils.Maths.normalise(p,0,this.extension.width()),t=Math.floor(this.extension.width()*i-this.$element.width()*i)+r,n=Math.floor(this.$element.width()*i)}this.$bottom.css("backgroundPosition",n+"px 0px"),this.$element.css({top:e,left:t})},t.prototype.open=function(e){var t=this;this.$element.attr("aria-hidden","false"),this.$element.show(),e?(this.$triggerButton=$(e),this.$bottom.show()):this.$bottom.hide(),this.isActive=!0,setTimeout(function(){var e=t.$element.find(".default");if(e.length)e.focus();else{var n=t.$element.find("input:visible").first();n.length?n.focus():t.$closeButton.focus()}},1),this.component.publish(i.BaseEvents.SHOW_OVERLAY),this.isUnopened&&(this.isUnopened=!1,this.afterFirstOpen()),this.resize()},t.prototype.afterFirstOpen=function(){},t.prototype.close=function(){this.isActive&&(this.$element.attr("aria-hidden","true"),this.$element.hide(),this.isActive=!1,this.component.publish(this.closeCommand),this.component.publish(i.BaseEvents.HIDE_OVERLAY))},t.prototype.resize=function(){e.prototype.resize.call(this),this.$element.css({top:Math.floor(this.extension.height()/2-this.$element.height()/2),left:Math.floor(this.extension.width()/2-this.$element.width()/2)})},t}(n.BaseView);t.Dialogue=o});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-dialogues-module/AuthDialogue",["require","exports","../uv-shared-module/BaseEvents","../uv-shared-module/Dialogue","../../Utils"],function(e,t,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("authDialogue"),e.prototype.create.call(this),this.openCommand=n.BaseEvents.SHOW_AUTH_DIALOGUE,this.closeCommand=n.BaseEvents.HIDE_AUTH_DIALOGUE,this.component.subscribe(this.openCommand,function(e){t.closeCallback=e.closeCallback,t.confirmCallback=e.confirmCallback,t.cancelCallback=e.cancelCallback,t.service=e.service,t.open()}),this.component.subscribe(this.closeCommand,function(){t.close()}),this.$title=$("<h1></h1>"),this.$content.append(this.$title),this.$content.append('            <div>                <p class="message scroll"></p>            </div>'),this.$buttons.prepend(this._buttonsToAdd()),this.$message=this.$content.find(".message"),this.$confirmButton=this.$buttons.find(".confirm"),this.$confirmButton.text(this.content.confirm),this.$cancelButton=this.$buttons.find(".close"),this.$cancelButton.text(this.content.cancel),this.$element.hide(),this.$confirmButton.on("click",function(e){e.preventDefault(),t.confirmCallback&&t.confirmCallback(),t.close()}),this.$cancelButton.on("click",function(e){e.preventDefault(),t.cancelCallback&&t.cancelCallback(),t.close()})},t.prototype.open=function(){e.prototype.open.call(this);var t=this.service.getHeader(),i=this.service.getDescription(),r=this.service.getConfirmLabel();t&&this.$title.text(o.UVUtils.sanitize(t)),i&&(this.$message.html(o.UVUtils.sanitize(i)),this.$message.targetBlank(),this.$message.find("a").on("click",function(){var e=$(this).attr("href");this.component.publish(n.BaseEvents.EXTERNAL_LINK_CLICKED,e)})),r&&this.$confirmButton.text(o.UVUtils.sanitize(r)),this.resize()},t.prototype.resize=function(){e.prototype.resize.call(this)},t.prototype._buttonsToAdd=function(){var e='<a class="confirm btn btn-primary" href="#" target="_parent"></a>';return this.config.topCloseButtonEnabled&&(e+='<button class="close btn btn-default"></button>'),e},t}(i.Dialogue);t.AuthDialogue=r});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-dialogues-module/ClickThroughDialogue",["require","exports","../uv-shared-module/BaseEvents","../uv-shared-module/Dialogue"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("clickThroughDialogue"),e.prototype.create.call(this),this.openCommand=n.BaseEvents.SHOW_CLICKTHROUGH_DIALOGUE,this.closeCommand=n.BaseEvents.HIDE_CLICKTHROUGH_DIALOGUE,this.component.subscribe(this.openCommand,function(e){t.acceptCallback=e.acceptCallback,t.resource=e.resource,t.open()}),this.component.subscribe(this.closeCommand,function(){t.close()}),this.$title=$("<h1></h1>"),this.$content.append(this.$title),this.$content.append('            <div>                <p class="message scroll"></p>                <div class="buttons">                    <a class="acceptTerms btn btn-primary" href="#" target="_parent"></a>                </div>            </div>'),this.$message=this.$content.find(".message"),this.$acceptTermsButton=this.$content.find(".acceptTerms"),this.$acceptTermsButton.text("Accept Terms and Open"),this.$element.hide(),this.$acceptTermsButton.on("click",function(e){e.preventDefault(),t.close(),t.component.publish(n.BaseEvents.ACCEPT_TERMS),t.acceptCallback&&t.acceptCallback()})},t.prototype.open=function(){e.prototype.open.call(this),this.resource.clickThroughService&&(this.$title.text(this.resource.clickThroughService.getProperty("label")),this.$message.html(this.resource.clickThroughService.getProperty("description")),this.$message.targetBlank()),this.$message.find("a").on("click",function(){var e=$(this).attr("href");this.component.publish(n.BaseEvents.EXTERNAL_LINK_CLICKED,e)}),this.resize()},t.prototype.resize=function(){e.prototype.resize.call(this)},t}(i.Dialogue);t.ClickThroughDialogue=o});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-dialogues-module/LoginDialogue",["require","exports","../uv-shared-module/BaseEvents","../uv-shared-module/Dialogue"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("loginDialogue"),e.prototype.create.call(this),this.openCommand=n.BaseEvents.SHOW_LOGIN_DIALOGUE,this.closeCommand=n.BaseEvents.HIDE_LOGIN_DIALOGUE,this.component.subscribe(this.openCommand,function(e){t.loginCallback=e.loginCallback,t.logoutCallback=e.logoutCallback,t.options=e.options,t.resource=e.resource,t.open()}),this.component.subscribe(this.closeCommand,function(){t.close()}),this.$title=$("<h1></h1>"),this.$content.append(this.$title),this.$content.append('            <div>                <p class="message scroll"></p>                <div class="buttons">                    <a class="logout btn btn-primary" href="#" target="_parent"></a>                    <a class="login btn btn-primary" href="#" target="_parent"></a>                    <a class="cancel btn btn-primary" href="#"></a>                </div>            </div>'),this.$message=this.$content.find(".message"),this.$loginButton=this.$content.find(".login"),this.$loginButton.text(this.content.login),this.$logoutButton=this.$content.find(".logout"),this.$logoutButton.text(this.content.logout),this.$cancelButton=this.$content.find(".cancel"),this.$cancelButton.text(this.content.cancel),this.$element.hide(),this.$loginButton.on("click",function(e){e.preventDefault(),t.close(),t.loginCallback&&t.loginCallback()}),this.$logoutButton.on("click",function(e){e.preventDefault(),t.close(),t.logoutCallback&&t.logoutCallback()}),this.$cancelButton.on("click",function(e){e.preventDefault(),t.close()}),this.updateLogoutButton()},t.prototype.open=function(){e.prototype.open.call(this);var t="";this.resource.loginService&&(this.$title.text(this.resource.loginService.getProperty("label")),t=this.resource.loginService.getProperty("description")),this.options.warningMessage&&(t='<span class="warning">'+this.extension.data.config.content[this.options.warningMessage]+'</span><span class="description">'+t+"</span>"),this.updateLogoutButton(),this.$message.html(t),this.$message.targetBlank(),this.$message.find("a").on("click",function(){var e=$(this).attr("href");this.component.publish(n.BaseEvents.EXTERNAL_LINK_CLICKED,e)}),this.options.showCancelButton?this.$cancelButton.show():this.$cancelButton.hide(),this.resize()},t.prototype.updateLogoutButton=function(){this.extension.isLoggedIn?this.$logoutButton.show():this.$logoutButton.hide()},t.prototype.resize=function(){e.prototype.resize.call(this)},t}(i.Dialogue);t.LoginDialogue=o}),define("modules/uv-shared-module/StringValue",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.value="",e&&(this.value=e.toLowerCase())}return e.prototype.toString=function(){return this.value},e}();t.StringValue=n});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-shared-module/MetricType",["require","exports","./StringValue"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.DESKTOP=new t("desktop"),t.MOBILELANDSCAPE=new t("mobilelandscape"),t.MOBILEPORTRAIT=new t("mobileportrait"),t.NONE=new t("none"),t.WATCH=new t("watch"),t}(n.StringValue);t.MetricType=i});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-dialogues-module/RestrictedDialogue",["require","exports","../uv-shared-module/BaseEvents","../uv-shared-module/Dialogue"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("restrictedDialogue"),e.prototype.create.call(this),this.openCommand=n.BaseEvents.SHOW_RESTRICTED_DIALOGUE,this.closeCommand=n.BaseEvents.HIDE_RESTRICTED_DIALOGUE,this.component.subscribe(this.openCommand,function(e){t.acceptCallback=e.acceptCallback,t.options=e.options,t.resource=e.resource,t.open()}),this.component.subscribe(this.closeCommand,function(){t.close()}),this.$title=$("<h1></h1>"),this.$content.append(this.$title),this.$content.append('            <div>                <p class="message scroll"></p>                <div class="buttons">                    <a class="cancel btn btn-primary" href="#" target="_parent"></a>                </div>            </div>'),this.$message=this.$content.find(".message"),this.$message.targetBlank(),this.$cancelButton=this.$content.find(".cancel"),this.$cancelButton.text(this.content.cancel),this.$element.hide(),this.$cancelButton.on("click",function(e){e.preventDefault(),t.close()})},t.prototype.open=function(){e.prototype.open.call(this),this.isAccepted=!1;var t="";this.resource.restrictedService&&(this.$title.text(this.resource.restrictedService.getProperty("label")),t=this.resource.restrictedService.getProperty("description")),this.$message.html(t),this.$message.targetBlank(),this.$message.find("a").on("click",function(){var e=$(this).attr("href");this.component.publish(n.BaseEvents.EXTERNAL_LINK_CLICKED,e)}),this.resize()},t.prototype.close=function(){e.prototype.close.call(this),!this.isAccepted&&this.acceptCallback&&(this.isAccepted=!0,this.acceptCallback())},t.prototype.resize=function(){e.prototype.resize.call(this)},t}(i.Dialogue);t.RestrictedDialogue=o});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-shared-module/GenericDialogue",["require","exports","./BaseEvents","./Dialogue"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("genericDialogue"),e.prototype.create.call(this),this.openCommand=n.BaseEvents.SHOW_GENERIC_DIALOGUE,this.closeCommand=n.BaseEvents.HIDE_GENERIC_DIALOGUE,this.component.subscribe(this.openCommand,function(e){t.acceptCallback=e.acceptCallback,t.showMessage(e)}),this.component.subscribe(this.closeCommand,function(){t.close()}),this.$message=$("<p></p>"),this.$content.append(this.$message),this.$acceptButton=$('\n          <button class="btn btn-primary accept default">\n            '+this.content.ok+"\n          </button>\n        "),this.$buttons.append(this.$acceptButton),this.$buttons.find(".close").hide(),this.$acceptButton.onPressed(function(){t.accept()}),this.returnFunc=function(){t.isActive&&t.accept()},this.$element.hide()},t.prototype.accept=function(){this.component.publish(n.BaseEvents.CLOSE_ACTIVE_DIALOGUE),this.acceptCallback&&this.acceptCallback()},t.prototype.showMessage=function(e){this.$message.html(e.message),e.buttonText?this.$acceptButton.text(e.buttonText):this.$acceptButton.text(this.content.ok),e.allowClose===!1&&this.disableClose(),this.open()},t.prototype.resize=function(){e.prototype.resize.call(this)},t}(i.Dialogue);t.GenericDialogue=o});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-shared-module/Shell",["require","exports","./BaseEvents","./BaseView","./GenericDialogue"],function(e,t,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(t){return e.call(this,t,!0,!0)||this}return __extends(t,e),t.prototype.create=function(){var t=this;e.prototype.create.call(this),this.component.subscribe(n.BaseEvents.SHOW_OVERLAY,function(){t.$overlays.show()}),this.component.subscribe(n.BaseEvents.HIDE_OVERLAY,function(){t.$overlays.hide()}),this.$headerPanel=$('<div class="headerPanel"></div>'),this.$element.append(this.$headerPanel),this.$mainPanel=$('<div class="mainPanel"></div>'),this.$element.append(this.$mainPanel),this.$centerPanel=$('<div class="centerPanel"></div>'),this.$mainPanel.append(this.$centerPanel),this.$leftPanel=$('<div class="leftPanel"></div>'),this.$mainPanel.append(this.$leftPanel),this.$rightPanel=$('<div class="rightPanel"></div>'),this.$mainPanel.append(this.$rightPanel),this.$footerPanel=$('<div class="footerPanel"></div>'),this.$element.append(this.$footerPanel),this.$mobileFooterPanel=$('<div class="mobileFooterPanel"></div>'),this.$element.append(this.$mobileFooterPanel),this.$overlays=$('<div class="overlays"></div>'),this.$element.append(this.$overlays),this.$genericDialogue=$('<div class="overlay genericDialogue" aria-hidden="true"></div>'),this.$overlays.append(this.$genericDialogue),this.$overlays.on("click",function(e){$(e.target).hasClass("overlays")&&(e.preventDefault(),t.component.publish(n.BaseEvents.CLOSE_ACTIVE_DIALOGUE))}),new o.GenericDialogue(this.$genericDialogue)},t.prototype.resize=function(){var t=this;e.prototype.resize.call(this),setTimeout(function(){t.$overlays.width(t.extension.width()),t.$overlays.height(t.extension.height())},1);var n=this.$element.height()-parseInt(this.$mainPanel.css("paddingTop"))-(this.$headerPanel.is(":visible")?this.$headerPanel.height():0)-(this.$footerPanel.is(":visible")?this.$footerPanel.height():0)-(this.$mobileFooterPanel.is(":visible")?this.$mobileFooterPanel.height():0);this.$mainPanel.height(n)},t}(i.BaseView);t.Shell=r}),define("SynchronousRequire",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.load=function(e,t){for(var n=[],o=0;o<e.length;o++){var r=new i(o,e[o],e,t);n.push(r)}var s=Promise.resolve();return n.forEach(function(e){s=s.then(function(){return e.load()})}),s},e}();t.SynchronousRequire=n;var i=function(){function e(e,t,n,i){this._dep=t,this._deps=n,this._cb=i,this._index=e}return e.prototype.getDependencyIndex=function(e){return this._deps.findIndex(function(t){return t.includes(e)})},e.prototype.load=function(){var e=this;return new Promise(function(t){requirejs([e._dep],function(n){e._cb(e._index,n),t()})})},e}();t.DependencyLoader=i}),define("modules/uv-shared-module/BaseExtension",["require","exports","@iiif/manifold","@iiif/vocabulary","../../Utils","./Auth09","./Auth1","../uv-dialogues-module/AuthDialogue","./BaseEvents","../uv-dialogues-module/ClickThroughDialogue","../uv-dialogues-module/LoginDialogue","./MetricType","../uv-dialogues-module/RestrictedDialogue","./Shell","../../SynchronousRequire"],function(e,t,n,i,o,r,s,a,u,l,c,h,p,d,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var g=function(){function e(){this.isCreated=!1,this.isLoggedIn=!1,this.metric=h.MetricType.NONE,this.metrics=[],this.shifted=!1,this.tabbing=!1}return e.prototype.create=function(){var e=this,t=this;if(r.Auth09.publish=this.component.publish,s.Auth1.publish=this.component.publish,this.$element=$(this.component.options.target),this.$element.data("component",this.component),this.fire(u.BaseEvents.CREATE,{data:this.data,settings:this.getSettings(),preview:this.getSharePreview()}),this._parseMetrics(),this._initLocales(),this.$element.empty(),this.$element.removeClass(),this.$element.addClass("uv"),this.data.locales&&this.$element.addClass(this.data.locales[0].name.toLowerCase()),this.$element.addClass(this.name),this.$element.addClass("browser-"+window.browserDetect.browser),this.$element.addClass("browser-version-"+window.browserDetect.version),this.$element.prop("tabindex",0),this.data.embedded&&this.$element.addClass("embedded"),this.isMobile()&&this.$element.addClass("mobile"),this.data.isLightbox&&this.$element.addClass("lightbox"),Utils.Documents.supportsFullscreen()&&this.$element.addClass("fullscreen-supported"),this.$element.on("mousemove",function(t){e.mouseX=t.pageX,e.mouseY=t.pageY}),this.isFullScreen()&&this.$element.addClass("fullscreen"),!this.data.isReload){var n=Utils.Documents.getHiddenProp();if(n){var i=n.replace(/[H|h]idden/,"")+"visibilitychange";document.addEventListener(i,function(){Utils.Documents.isHidden()||e.resize()})}Utils.Bools.getBool(this.data.config.options.dropEnabled,!0)&&this.$element.on("drop",function(t){t.preventDefault();var n=t.originalEvent.dataTransfer.getData("URL"),i=Utils.Urls.getUrlParts(n),o=Utils.Urls.getQuerystringParameterFromString("manifest",i.search);if(o||(o=Utils.Urls.getQuerystringParameterFromString("collection",i.search)),o){e.fire(u.BaseEvents.DROP,o);var r={};r.iiifResourceUri=o,e.reload(r)}}),this.$element.on("dragover",function(e){e.preventDefault()}),this.$element.on("keyup keydown",function(t){e.shifted=t.shiftKey,e.tabbing=t.keyCode===KeyCodes.KeyDown.Tab}),this.$element.on("keydown",function(n){var i=null,o=!0;n.ctrlKey||n.altKey||n.shiftKey||(n.keyCode===KeyCodes.KeyDown.Enter&&(i=u.BaseEvents.RETURN,o=!1),n.keyCode===KeyCodes.KeyDown.Escape&&(i=u.BaseEvents.ESCAPE),n.keyCode===KeyCodes.KeyDown.PageUp&&(i=u.BaseEvents.PAGE_UP),n.keyCode===KeyCodes.KeyDown.PageDown&&(i=u.BaseEvents.PAGE_DOWN),n.keyCode===KeyCodes.KeyDown.End&&(i=u.BaseEvents.END),n.keyCode===KeyCodes.KeyDown.Home&&(i=u.BaseEvents.HOME),(n.keyCode===KeyCodes.KeyDown.NumpadPlus||171===n.keyCode||n.keyCode===KeyCodes.KeyDown.Equals)&&(i=u.BaseEvents.PLUS,o=!1),(n.keyCode===KeyCodes.KeyDown.NumpadMinus||173===n.keyCode||n.keyCode===KeyCodes.KeyDown.Dash)&&(i=u.BaseEvents.MINUS,o=!1),t.useArrowKeysToNavigate()&&(n.keyCode===KeyCodes.KeyDown.LeftArrow&&(i=u.BaseEvents.LEFT_ARROW),n.keyCode===KeyCodes.KeyDown.UpArrow&&(i=u.BaseEvents.UP_ARROW),n.keyCode===KeyCodes.KeyDown.RightArrow&&(i=u.BaseEvents.RIGHT_ARROW),n.keyCode===KeyCodes.KeyDown.DownArrow&&(i=u.BaseEvents.DOWN_ARROW))),i&&(o&&n.preventDefault(),e.component.publish(i))})}this.component.subscribe(u.BaseEvents.EXIT_FULLSCREEN,function(){e.isOverlayActive()&&e.component.publish(u.BaseEvents.ESCAPE),e.component.publish(u.BaseEvents.ESCAPE),e.component.publish(u.BaseEvents.RESIZE)}),this.$element.append('<a href="/" id="top"></a>'),this.$element.append('<iframe id="commsFrame" style="display:none"></iframe>'),this.component.subscribe(u.BaseEvents.ACCEPT_TERMS,function(){e.fire(u.BaseEvents.ACCEPT_TERMS)}),this.component.subscribe(u.BaseEvents.LOGIN_FAILED,function(){e.fire(u.BaseEvents.LOGIN_FAILED),e.showMessage(e.data.config.content.authorisationFailedMessage)}),this.component.subscribe(u.BaseEvents.LOGIN,function(){e.isLoggedIn=!0,e.fire(u.BaseEvents.LOGIN)}),this.component.subscribe(u.BaseEvents.LOGOUT,function(){e.isLoggedIn=!1,e.fire(u.BaseEvents.LOGOUT)}),this.component.subscribe(u.BaseEvents.BOOKMARK,function(){e.bookmark(),e.fire(u.BaseEvents.BOOKMARK)}),this.component.subscribe(u.BaseEvents.CANVAS_INDEX_CHANGE_FAILED,function(){e.fire(u.BaseEvents.CANVAS_INDEX_CHANGE_FAILED)}),this.component.subscribe(u.BaseEvents.CANVAS_INDEX_CHANGED,function(t){e.data.canvasIndex=t,e.lastCanvasIndex=e.helper.canvasIndex,e.helper.canvasIndex=t,e.fire(u.BaseEvents.CANVAS_INDEX_CHANGED,e.data.canvasIndex)}),this.component.subscribe(u.BaseEvents.CLICKTHROUGH,function(){e.fire(u.BaseEvents.CLICKTHROUGH)}),this.component.subscribe(u.BaseEvents.CLOSE_ACTIVE_DIALOGUE,function(){e.fire(u.BaseEvents.CLOSE_ACTIVE_DIALOGUE)}),this.component.subscribe(u.BaseEvents.CLOSE_LEFT_PANEL,function(){e.fire(u.BaseEvents.CLOSE_LEFT_PANEL),e.resize()}),this.component.subscribe(u.BaseEvents.CLOSE_RIGHT_PANEL,function(){e.fire(u.BaseEvents.CLOSE_RIGHT_PANEL),e.resize()}),this.component.subscribe(u.BaseEvents.COLLECTION_INDEX_CHANGED,function(t){e.data.collectionIndex=t,e.fire(u.BaseEvents.COLLECTION_INDEX_CHANGED,e.data.collectionIndex)}),this.component.subscribe(u.BaseEvents.CREATED,function(){e.isCreated=!0,e.fire(u.BaseEvents.CREATED)}),this.component.subscribe(u.BaseEvents.DOWN_ARROW,function(){e.fire(u.BaseEvents.DOWN_ARROW)}),this.component.subscribe(u.BaseEvents.DOWNLOAD,function(t){e.fire(u.BaseEvents.DOWNLOAD,t)}),this.component.subscribe(u.BaseEvents.END,function(){e.fire(u.BaseEvents.END)}),this.component.subscribe(u.BaseEvents.ESCAPE,function(){e.fire(u.BaseEvents.ESCAPE),e.isFullScreen()&&!e.isOverlayActive()&&e.component.publish(u.BaseEvents.TOGGLE_FULLSCREEN)}),this.component.subscribe(u.BaseEvents.EXTERNAL_LINK_CLICKED,function(t){e.fire(u.BaseEvents.EXTERNAL_LINK_CLICKED,t)}),this.component.subscribe(u.BaseEvents.FEEDBACK,function(){e.feedback()}),this.component.subscribe(u.BaseEvents.FORBIDDEN,function(){e.fire(u.BaseEvents.FORBIDDEN),e.component.publish(u.BaseEvents.OPEN_EXTERNAL_RESOURCE)}),this.component.subscribe(u.BaseEvents.HIDE_DOWNLOAD_DIALOGUE,function(){e.fire(u.BaseEvents.HIDE_DOWNLOAD_DIALOGUE)}),this.component.subscribe(u.BaseEvents.HIDE_EMBED_DIALOGUE,function(){e.fire(u.BaseEvents.HIDE_EMBED_DIALOGUE)}),this.component.subscribe(u.BaseEvents.HIDE_EXTERNALCONTENT_DIALOGUE,function(){e.fire(u.BaseEvents.HIDE_EXTERNALCONTENT_DIALOGUE)}),this.component.subscribe(u.BaseEvents.HIDE_GENERIC_DIALOGUE,function(){e.fire(u.BaseEvents.HIDE_GENERIC_DIALOGUE)}),this.component.subscribe(u.BaseEvents.HIDE_HELP_DIALOGUE,function(){e.fire(u.BaseEvents.HIDE_HELP_DIALOGUE)}),this.component.subscribe(u.BaseEvents.HIDE_INFORMATION,function(){e.fire(u.BaseEvents.HIDE_INFORMATION)}),this.component.subscribe(u.BaseEvents.HIDE_LOGIN_DIALOGUE,function(){e.fire(u.BaseEvents.HIDE_LOGIN_DIALOGUE)}),this.component.subscribe(u.BaseEvents.HIDE_OVERLAY,function(){e.fire(u.BaseEvents.HIDE_OVERLAY)}),this.component.subscribe(u.BaseEvents.HIDE_RESTRICTED_DIALOGUE,function(){e.fire(u.BaseEvents.HIDE_RESTRICTED_DIALOGUE)}),this.component.subscribe(u.BaseEvents.HIDE_SETTINGS_DIALOGUE,function(){e.fire(u.BaseEvents.HIDE_SETTINGS_DIALOGUE)}),this.component.subscribe(u.BaseEvents.HOME,function(){e.fire(u.BaseEvents.HOME)}),this.component.subscribe(u.BaseEvents.LEFT_ARROW,function(){e.fire(u.BaseEvents.LEFT_ARROW)}),this.component.subscribe(u.BaseEvents.LEFTPANEL_COLLAPSE_FULL_FINISH,function(){e.fire(u.BaseEvents.LEFTPANEL_COLLAPSE_FULL_FINISH)}),this.component.subscribe(u.BaseEvents.LEFTPANEL_COLLAPSE_FULL_START,function(){e.fire(u.BaseEvents.LEFTPANEL_COLLAPSE_FULL_START)}),this.component.subscribe(u.BaseEvents.LEFTPANEL_EXPAND_FULL_FINISH,function(){e.fire(u.BaseEvents.LEFTPANEL_EXPAND_FULL_FINISH)}),this.component.subscribe(u.BaseEvents.LEFTPANEL_EXPAND_FULL_START,function(){e.fire(u.BaseEvents.LEFTPANEL_EXPAND_FULL_START)}),this.component.subscribe(u.BaseEvents.LOAD_FAILED,function(){e.fire(u.BaseEvents.LOAD_FAILED),null==!t.lastCanvasIndex&&t.lastCanvasIndex!==t.helper.canvasIndex&&e.component.publish(u.BaseEvents.CANVAS_INDEX_CHANGED,t.lastCanvasIndex)}),this.component.subscribe(u.BaseEvents.MANIFEST_INDEX_CHANGED,function(t){e.data.manifestIndex=t,e.fire(u.BaseEvents.MANIFEST_INDEX_CHANGED,e.data.manifestIndex)}),this.component.subscribe(u.BaseEvents.NOT_FOUND,function(){e.fire(u.BaseEvents.NOT_FOUND)}),this.component.subscribe(u.BaseEvents.OPEN,function(){e.fire(u.BaseEvents.OPEN);var t=Utils.Strings.format(e.data.config.options.openTemplate,e.helper.manifestUri);window.open(t)}),this.component.subscribe(u.BaseEvents.OPEN_LEFT_PANEL,function(){e.fire(u.BaseEvents.OPEN_LEFT_PANEL),e.resize()}),this.component.subscribe(u.BaseEvents.OPEN_EXTERNAL_RESOURCE,function(){e.fire(u.BaseEvents.OPEN_EXTERNAL_RESOURCE)}),this.component.subscribe(u.BaseEvents.OPEN_RIGHT_PANEL,function(){e.fire(u.BaseEvents.OPEN_RIGHT_PANEL),e.resize()}),this.component.subscribe(u.BaseEvents.PAGE_DOWN,function(){e.fire(u.BaseEvents.PAGE_DOWN)}),this.component.subscribe(u.BaseEvents.PAGE_UP,function(){e.fire(u.BaseEvents.PAGE_UP)}),this.component.subscribe(u.BaseEvents.RANGE_NOT_FOUND,function(t,n){e.fire(u.BaseEvents.RANGE_NOT_FOUND,n)}),this.component.subscribe(u.BaseEvents.RANGE_CHANGED,function(t){t?(e.data.rangeId=t.id,e.helper.rangeId=t.id,e.fire(u.BaseEvents.RANGE_CHANGED,e.data.rangeId,t)):(e.data.rangeId=void 0,e.helper.rangeId=void 0,e.fire(u.BaseEvents.RANGE_CHANGED,null))}),this.component.subscribe(u.BaseEvents.RESOURCE_DEGRADED,function(t){e.fire(u.BaseEvents.RESOURCE_DEGRADED),r.Auth09.handleDegraded(t)}),this.component.subscribe(u.BaseEvents.RETURN,function(){e.fire(u.BaseEvents.RETURN)}),this.component.subscribe(u.BaseEvents.RIGHT_ARROW,function(){e.fire(u.BaseEvents.RIGHT_ARROW)}),this.component.subscribe(u.BaseEvents.RIGHTPANEL_COLLAPSE_FULL_FINISH,function(){e.fire(u.BaseEvents.RIGHTPANEL_COLLAPSE_FULL_FINISH)}),this.component.subscribe(u.BaseEvents.RIGHTPANEL_COLLAPSE_FULL_START,function(){e.fire(u.BaseEvents.RIGHTPANEL_COLLAPSE_FULL_START)}),this.component.subscribe(u.BaseEvents.RIGHTPANEL_EXPAND_FULL_FINISH,function(){e.fire(u.BaseEvents.RIGHTPANEL_EXPAND_FULL_FINISH)}),this.component.subscribe(u.BaseEvents.RIGHTPANEL_EXPAND_FULL_START,function(){e.fire(u.BaseEvents.RIGHTPANEL_EXPAND_FULL_START)}),this.component.subscribe(u.BaseEvents.SEQUENCE_INDEX_CHANGED,function(t){
e.data.sequenceIndex=t,e.fire(u.BaseEvents.SEQUENCE_INDEX_CHANGED,e.data.sequenceIndex)}),this.component.subscribe(u.BaseEvents.SETTINGS_CHANGED,function(t){e.fire(u.BaseEvents.SETTINGS_CHANGED,t)}),this.component.subscribe(u.BaseEvents.SHOW_DOWNLOAD_DIALOGUE,function(){e.fire(u.BaseEvents.SHOW_DOWNLOAD_DIALOGUE)}),this.component.subscribe(u.BaseEvents.SHOW_EMBED_DIALOGUE,function(){e.fire(u.BaseEvents.SHOW_EMBED_DIALOGUE)}),this.component.subscribe(u.BaseEvents.SHOW_EXTERNALCONTENT_DIALOGUE,function(){e.fire(u.BaseEvents.SHOW_EXTERNALCONTENT_DIALOGUE)}),this.component.subscribe(u.BaseEvents.SHOW_GENERIC_DIALOGUE,function(){e.fire(u.BaseEvents.SHOW_GENERIC_DIALOGUE)}),this.component.subscribe(u.BaseEvents.SHOW_HELP_DIALOGUE,function(){e.fire(u.BaseEvents.SHOW_HELP_DIALOGUE)}),this.component.subscribe(u.BaseEvents.SHOW_INFORMATION,function(){e.fire(u.BaseEvents.SHOW_INFORMATION)}),this.component.subscribe(u.BaseEvents.SHOW_LOGIN_DIALOGUE,function(){e.fire(u.BaseEvents.SHOW_LOGIN_DIALOGUE)}),this.component.subscribe(u.BaseEvents.SHOW_CLICKTHROUGH_DIALOGUE,function(){e.fire(u.BaseEvents.SHOW_CLICKTHROUGH_DIALOGUE)}),this.component.subscribe(u.BaseEvents.SHOW_MESSAGE,function(t){e.showMessage(t)}),this.component.subscribe(u.BaseEvents.SHOW_RESTRICTED_DIALOGUE,function(){e.fire(u.BaseEvents.SHOW_RESTRICTED_DIALOGUE)}),this.component.subscribe(u.BaseEvents.SHOW_OVERLAY,function(){e.fire(u.BaseEvents.SHOW_OVERLAY)}),this.component.subscribe(u.BaseEvents.SHOW_SETTINGS_DIALOGUE,function(){e.fire(u.BaseEvents.SHOW_SETTINGS_DIALOGUE)}),this.component.subscribe(u.BaseEvents.INFO_DISPLAYED,function(t,n){e.fire(u.BaseEvents.INFO_DISPLAYED,n)}),this.component.subscribe(u.BaseEvents.SHOW_TERMS_OF_USE,function(){e.fire(u.BaseEvents.SHOW_TERMS_OF_USE);var t=e.helper.getLicense();if(!t){var n=e.helper.getRequiredStatement();n&&n.value&&(t=n.value)}t&&e.showMessage(t)}),this.component.subscribe(u.BaseEvents.THUMB_SELECTED,function(t){e.fire(u.BaseEvents.THUMB_SELECTED,t.index)}),this.component.subscribe(u.BaseEvents.TOGGLE_FULLSCREEN,function(){$("#top").focus(),e.component.isFullScreen=!e.component.isFullScreen,e.component.isFullScreen?e.$element.addClass("fullscreen"):e.$element.removeClass("fullscreen"),e.fire(u.BaseEvents.TOGGLE_FULLSCREEN,{isFullScreen:e.component.isFullScreen,overrideFullScreen:e.data.config.options.overrideFullScreen})}),this.component.subscribe(u.BaseEvents.UP_ARROW,function(){e.fire(u.BaseEvents.UP_ARROW)}),this.component.subscribe(u.BaseEvents.UPDATE_SETTINGS,function(){e.fire(u.BaseEvents.UPDATE_SETTINGS)}),this.component.subscribe(u.BaseEvents.VIEW_FULL_TERMS,function(){e.fire(u.BaseEvents.VIEW_FULL_TERMS)}),this.component.subscribe(u.BaseEvents.WINDOW_UNLOAD,function(){e.fire(u.BaseEvents.WINDOW_UNLOAD)}),this.shell=new d.Shell(this.$element),this.getDependencies(function(t){e.loadDependencies(t)})},e.prototype.createModules=function(){this.$authDialogue=$('<div class="overlay auth" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$authDialogue),this.authDialogue=new a.AuthDialogue(this.$authDialogue),this.$clickThroughDialogue=$('<div class="overlay clickthrough" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$clickThroughDialogue),this.clickThroughDialogue=new l.ClickThroughDialogue(this.$clickThroughDialogue),this.$restrictedDialogue=$('<div class="overlay login" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$restrictedDialogue),this.restrictedDialogue=new p.RestrictedDialogue(this.$restrictedDialogue),this.$loginDialogue=$('<div class="overlay login" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$loginDialogue),this.loginDialogue=new c.LoginDialogue(this.$loginDialogue)},e.prototype.modulesCreated=function(){},e.prototype.getDependencies=function(e){var t=this,n=this.data.root+"/lib/"+this.name+"-dependencies",i=$("script[data-requiremodule]").filter(function(){var e=$(this).attr("data-requiremodule");return-1!==e.indexOf(t.name)&&-1!==e.indexOf("dependencies")});i.length?e(null):requirejs([n],function(n){var i=t.helper.getCurrentCanvas(),o=t.getMediaFormats(i),r=[];o&&o.length&&(r=o.map(function(e){return e.getFormat().toString()}));var s=n(r),a=t.data.root+"/lib/";if(s.sync)for(var u=0;u<s.sync.length;u++){var l=s.sync[u];l.startsWith("!")||(s.sync[u]=a+l)}if(s.async)for(var u=0;u<s.async.length;u++){var l=s.async[u];l.startsWith("!")||(s.async[u]=a+l)}e(s)})},e.prototype.loadDependencies=function(e){var t=this;e?e.sync?f.SynchronousRequire.load(e.sync,t.dependencyLoaded).then(function(){e.async?requirejs(e.async,function(){t.dependenciesLoaded(arguments)}):t.dependenciesLoaded()}):e.async?requirejs(e.async,function(){t.dependenciesLoaded(arguments)}):t.dependenciesLoaded():t.dependenciesLoaded()},e.prototype.dependencyLoaded=function(e,t){},e.prototype.dependenciesLoaded=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.createModules(),this.modulesCreated(),this.component.publish(u.BaseEvents.RESIZE),setTimeout(function(){e.render(),e.component.publish(u.BaseEvents.CREATED),e._setDefaultFocus()},1)},e.prototype.render=function(){if(this.isCreated&&this.data.collectionIndex===this.helper.collectionIndex||this.component.publish(u.BaseEvents.COLLECTION_INDEX_CHANGED,this.data.collectionIndex),this.isCreated&&this.data.manifestIndex===this.helper.manifestIndex||this.component.publish(u.BaseEvents.MANIFEST_INDEX_CHANGED,this.data.manifestIndex),this.isCreated&&this.data.sequenceIndex===this.helper.sequenceIndex||this.component.publish(u.BaseEvents.SEQUENCE_INDEX_CHANGED,this.data.sequenceIndex),this.isCreated&&this.data.canvasIndex===this.helper.canvasIndex||this.component.publish(u.BaseEvents.CANVAS_INDEX_CHANGED,this.data.canvasIndex),(!this.isCreated||this.data.rangeId!==this.helper.rangeId)&&this.data.rangeId){var e=this.helper.getRangeById(this.data.rangeId);e?this.component.publish(u.BaseEvents.RANGE_CHANGED,e):this.component.publish(u.BaseEvents.RANGE_NOT_FOUND,[this.data.rangeId])}this.isCreated||this.data.startTime&&this.component.publish(u.BaseEvents.CURRENT_TIME_CHANGED,[this.data.startTime])},e.prototype._setDefaultFocus=function(){var e=this;setTimeout(function(){e.data.config.options.allowStealFocus&&$("[tabindex=0]").focus()},1)},e.prototype.width=function(){return this.$element.width()},e.prototype.height=function(){return this.$element.height()},e.prototype.exitFullScreen=function(){this.component.publish(u.BaseEvents.EXIT_FULLSCREEN)},e.prototype.fire=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.component.fire(e,arguments[1])},e.prototype.redirect=function(e){this.fire(u.BaseEvents.REDIRECT,e)},e.prototype.refresh=function(){this.fire(u.BaseEvents.REFRESH,null)},e.prototype._initLocales=function(){var e=this.data.config.localisation.locales.slice(0),t=this.data.locales,n=[];if(t){t.forEach(function(t){var i=e.filter(function(e){return e.name===t.name});if(i.length){var o=i[0];t.label&&(o.label=t.label),o.added=!0,n.push(o)}});var i=Utils.Bools.getBool(this.data.config.options.limitLocales,!1);i||e.forEach(function(e){e.added||n.push(e),delete e.added}),this.data.locales=n}else console.warn("No locales configured")},e.prototype._parseMetrics=function(){var e=this.data.config.options.metrics;if(e)for(var t=0;t<e.length;t++){var n=e[t];"string"==typeof n.type&&(n.type=new h.MetricType(n.type)),this.metrics.push(n)}},e.prototype._updateMetric=function(){var e=this;setTimeout(function(){for(var t=!1,n=0;n<e.metrics.length;n++){var i=e.metrics[n];e.width()>=i.minWidth&&e.width()<=i.maxWidth&&e.height()>=i.minHeight&&e.height()<=i.maxHeight&&(t=!0,e.metric!==i.type&&(e.metric=i.type,e.component.publish(u.BaseEvents.METRIC_CHANGED)))}t||e.metric!==h.MetricType.NONE&&(e.metric=h.MetricType.NONE,e.component.publish(u.BaseEvents.METRIC_CHANGED))},1)},e.prototype.resize=function(){this._updateMetric(),this.component.publish(u.BaseEvents.RESIZE)},e.prototype.reload=function(e){this.component.publish(u.BaseEvents.RELOAD,e)},e.prototype.isSeeAlsoEnabled=function(){return this.data.config.options.seeAlsoEnabled!==!1},e.prototype.getShareUrl=function(){if(!this.data.embedded)return Utils.Documents.isInIFrame()?parent.document.location.href:document.location.href;if(this.helper.hasRelatedPage()){var e=this.helper.getRelated();return e&&e.length&&(e=e[0]),e["@id"]}return null},e.prototype.getIIIFShareUrl=function(e){void 0===e&&(e=!1);var t=e&&this.helper.manifest?this.helper.manifest.id:this.helper.manifestUri;return t+"?manifest="+t},e.prototype.addTimestamp=function(e){return e+"?t="+Utils.Dates.getTimeStamp()},e.prototype.getDomain=function(){var e=Utils.Urls.getUrlParts(this.helper.manifestUri);return e.host},e.prototype.getAppUri=function(){var e=Utils.Urls.getUrlParts(document.location.href),t=this.data.config.modules.shareDialogue.options.embedFile||"uv.html",n=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""),i=e.pathname;i.startsWith("/")||(i="/"+i),i=i.substr(0,i.lastIndexOf("/")+1);var r=n+i,s="";return Utils.Documents.isInIFrame()||(s=this.data.root||"",s.startsWith("./")&&(s=s.substr(2)),s&&!s.endsWith("/")&&(s+="/")),o.UVUtils.isValidUrl(s)?s+t:r+s+t},e.prototype.getSettings=function(){if(Utils.Bools.getBool(this.data.config.options.saveUserSettings,!1)){var e=Utils.Storage.get("uv.settings",Utils.StorageType.local);if(e)return $.extend(this.data.config.options,e.value)}return this.data.config.options},e.prototype.updateSettings=function(e){if(Utils.Bools.getBool(this.data.config.options.saveUserSettings,!1)){var t=Utils.Storage.get("uv.settings",Utils.StorageType.local);t&&(e=$.extend(t.value,e)),Utils.Storage.set("uv.settings",e,31536e4,Utils.StorageType.local)}this.data.config.options=$.extend(this.data.config.options,e)},e.prototype.getLocale=function(){return this.helper.options.locale},e.prototype.getSharePreview=function(){var e=this.helper.getLabel(),t=this.helper.getCurrentCanvas(),n=t.getProperty("thumbnail");return n&&"string"==typeof n||(n=t.getCanonicalImageUri(this.data.config.options.bookmarkThumbWidth)),{title:e,image:n}},e.prototype.getPagedIndices=function(e){return void 0===e&&(e=this.helper.canvasIndex),[e]},e.prototype.getCurrentCanvases=function(){for(var e=this.getPagedIndices(this.helper.canvasIndex),t=[],n=0;n<e.length;n++){var i=e[n],o=this.helper.getCanvasByIndex(i);t.push(o)}return t},e.prototype.getCanvasLabels=function(e){var t=this.getPagedIndices(),n="";if(1===t.length)n=e;else for(var i=1;i<=t.length;i++)n.length&&(n+=","),n+=e+" "+i;return n},e.prototype.getCurrentCanvasRange=function(){var e=this.helper.getCanvasRange(this.helper.getCurrentCanvas());return e},e.prototype.getExternalResources=function(e){var t=this,i=this.getPagedIndices(),o=[];i.forEach(function(i){var r,s=t.helper.getCanvasByIndex(i);if(r=s.externalResource?s.externalResource:new n.ExternalResource(s,{authApiVersion:t.data.config.options.authAPIVersion}),e){var a=e.find(function(e){return e.dataUri===r.dataUri});a?o.push(a):o.push(r)}else o.push(r)});var a=this.data.config.options.tokenStorage,u=this.data.config.options.authAPIVersion;return 1===u?new Promise(function(e){var n={locale:t.helper.options.locale};s.Auth1.loadExternalResources(o,a,n).then(function(n){t.resources=n.map(function(e){return t._prepareResourceData(e)}),e(t.resources)})}):new Promise(function(e){r.Auth09.loadExternalResources(o,a).then(function(n){t.resources=n.map(function(e){return t._prepareResourceData(e)}),e(t.resources)})})},e.prototype._prepareResourceData=function(e){return e.data.hasServiceDescriptor=e.hasServiceDescriptor(),e.hasServiceDescriptor()||(e.data.id=e.dataUri,e.data.width=e.width,e.data.height=e.height),e.data.index=e.index,Utils.Objects.toPlainObject(e.data)},e.prototype.getMediaFormats=function(e){var t=e.getContent();if(t&&t.length){var n=t[0];return n.getBody()}var i={id:e.id,type:e.getType(),getFormat:function(){return""}};return[i]},e.prototype.viewCanvas=function(e){return this.helper.isCanvasIndexOutOfRange(e)?void this.showMessage(this.data.config.content.canvasIndexOutOfRange):void this.component.publish(u.BaseEvents.OPEN_EXTERNAL_RESOURCE)},e.prototype.showMessage=function(e,t,n,i){this.closeActiveDialogue(),this.component.publish(u.BaseEvents.SHOW_GENERIC_DIALOGUE,{message:e,acceptCallback:t,buttonText:n,allowClose:i})},e.prototype.closeActiveDialogue=function(){this.component.publish(u.BaseEvents.CLOSE_ACTIVE_DIALOGUE)},e.prototype.isOverlayActive=function(){return this.shell.$overlays.is(":visible")},e.prototype.isDesktopMetric=function(){return this.metric.toString()===h.MetricType.DESKTOP.toString()},e.prototype.isWatchMetric=function(){return this.metric.toString()===h.MetricType.WATCH.toString()},e.prototype.isCatchAllMetric=function(){return this.metric.toString()===h.MetricType.NONE.toString()},e.prototype.viewManifest=function(e){var t={};t.iiifResourceUri=this.helper.manifestUri,t.collectionIndex=this.helper.getCollectionIndex(e),t.manifestIndex=e.index,t.sequenceIndex=0,t.canvasIndex=0,this.reload(t)},e.prototype.viewCollection=function(e){var t={};t.iiifResourceUri=e.parentCollection?e.parentCollection.id:this.helper.manifestUri,t.collectionIndex=e.index,t.manifestIndex=0,t.sequenceIndex=0,t.canvasIndex=0,this.reload(t)},e.prototype.isFullScreen=function(){return this.component.isFullScreen},e.prototype.isHeaderPanelEnabled=function(){return Utils.Bools.getBool(this.data.config.options.headerPanelEnabled,!0)},e.prototype.isLeftPanelEnabled=function(){if(Utils.Bools.getBool(this.data.config.options.leftPanelEnabled,!0)){if(this.helper.hasParentCollection())return!0;if(this.helper.isMultiCanvas()){var e=this.helper.getViewingHint();if(!e||e&&e.toString()!==i.ViewingHint.CONTINUOUS.toString())return!0}}return!1},e.prototype.isRightPanelEnabled=function(){return Utils.Bools.getBool(this.data.config.options.rightPanelEnabled,!0)},e.prototype.isFooterPanelEnabled=function(){return Utils.Bools.getBool(this.data.config.options.footerPanelEnabled,!0)},e.prototype.isMobile=function(){return $.browser.mobile},e.prototype.useArrowKeysToNavigate=function(){return Utils.Bools.getBool(this.data.config.options.useArrowKeysToNavigate,!0)},e.prototype.bookmark=function(){},e.prototype.feedback=function(){this.fire(u.BaseEvents.FEEDBACK,this.data)},e.prototype.getAlternateLocale=function(){var e=null;return this.data.locales&&this.data.locales.length>1&&(e=this.data.locales[1]),e},e.prototype.getSerializedLocales=function(){return this.data.locales?this.serializeLocales(this.data.locales):null},e.prototype.serializeLocales=function(e){for(var t="",n=0;n<e.length;n++){var i=e[n];n>0&&(t+=","),t+=i.name,i.label&&(t+=":"+i.label)}return t},e.prototype.changeLocale=function(e){var t={};if(this.data.locales){t.locales=this.data.locales.slice(0);var n=t.locales.findIndex(function(t){return t.name===e}),i=0;t.locales.splice(i,0,t.locales.splice(n,1)[0]),this.reload(t)}},e}();t.BaseExtension=g}),!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define("lib/GalleryComponent.js",[],t);else{var n=t();for(var i in n)("object"==typeof exports?exports:e)[i]=n[i]}}(window,function(){return function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:i})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(t.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)t.d(i,o,function(t){return e[t]}.bind(null,o));return i},t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),s=n(3),a=n(4),u=function(e){function t(t){var n=e.call(this,t)||this;return n._data=n.data(),n._data=n.options.data,n._init(),n._resize(),n}return o(t,e),t.prototype._init=function(){var t=this;e.prototype._init.call(this),this._$element=$(this.el),this._$header=$('<div class="header"></div>'),this._$element.append(this._$header),this._$leftOptions=$('<div class="left"></div>'),this._$header.append(this._$leftOptions),this._$rightOptions=$('<div class="right"></div>'),this._$header.append(this._$rightOptions),this._$sizeDownButton=$('<input class="btn btn-default size-down" type="button" value="-" />'),this._$leftOptions.append(this._$sizeDownButton),this._$sizeRange=$('<input type="range" name="size" min="1" max="10" value="'+this.options.data.initialZoom+'" />'),this._$leftOptions.append(this._$sizeRange),this._$sizeUpButton=$('<input class="btn btn-default size-up" type="button" value="+" />'),this._$leftOptions.append(this._$sizeUpButton),this._$multiSelectOptions=$('<div class="multiSelectOptions"></div>'),this._$rightOptions.append(this._$multiSelectOptions),this._$selectAllButton=$('<div class="multiSelectAll"><input id="multiSelectAll" type="checkbox" tabindex="0" /><label for="multiSelectAll">'+this.options.data.content.selectAll+"</label></div>"),this._$multiSelectOptions.append(this._$selectAllButton),this._$selectAllButtonCheckbox=$(this._$selectAllButton.find("input:checkbox")),this._$selectButton=$('<a class="select" href="#">'+this.options.data.content.select+"</a>"),this._$multiSelectOptions.append(this._$selectButton),this._$main=$('<div class="main"></div>'),this._$element.append(this._$main),this._$thumbs=$('<div class="thumbs"></div>'),this._$main.append(this._$thumbs),this._$sizeDownButton.on("click",function(){var e=Number(t._$sizeRange.val())-1;e>=Number(t._$sizeRange.attr("min"))&&(t._$sizeRange.val(e.toString()),t._$sizeRange.trigger("change"),t.fire(l.DECREASE_SIZE))}),this._$sizeUpButton.on("click",function(){var e=Number(t._$sizeRange.val())+1;e<=Number(t._$sizeRange.attr("max"))&&(t._$sizeRange.val(e.toString()),t._$sizeRange.trigger("change"),t.fire(l.INCREASE_SIZE))}),this._$sizeRange.on("change",function(){t._updateThumbs(),t._scrollToThumb(t._getSelectedThumbIndex())}),this._$selectAllButton.checkboxButton(function(e){var n=t._getMultiSelectState();n&&(e?n.selectAll(!0):n.selectAll(!1)),t.set(t.options.data)}),this._$selectButton.on("click",function(){var e=t._getMultiSelectState();if(e){var n=e.getAllSelectedCanvases().map(function(e){return e.id});t.fire(l.MULTISELECTION_MADE,n)}}),this._setRange(),$.templates({galleryThumbsTemplate:'				<div class="{{:~galleryThumbClassName()}}" data-src="{{>uri}}" data-index="{{>index}}" data-visible="{{>visible}}" data-width="{{>width}}" data-height="{{>height}}" data-initialwidth="{{>initialWidth}}" data-initialheight="{{>initialHeight}}">						<div class="wrap" style="width:{{>initialWidth}}px; height:{{>initialHeight}}px" data-link="class{merge:multiSelected toggle=\'multiSelected\'}">						{^{if multiSelectEnabled}}								<input id="thumb-checkbox-{{>id}}" type="checkbox" data-link="checked{:multiSelected ? \'checked\' : \'\'}" class="multiSelect" />						{{/if}}						</div>						<div class="info">								<span class="index" style="width:{{>initialWidth}}px">{{:#index + 1}}</span>								<span class="label" style="width:{{>initialWidth}}px" title="{{>label}}">{{>label}}&nbsp;</span>								<span class="searchResults" title="{{:~galleryThumbSearchResultsTitle()}}">{{>data.searchResults}}</span>						</div>				</div>'});var n=this;return $.views.helpers({galleryThumbClassName:function(){var e="thumb preLoad";return 0===this.data.index&&(e+=" first"),this.data.uri||(e+=" placeholder"),e},galleryThumbSearchResultsTitle:function(){var e=Number(this.data.data.searchResults);return e?e>1?a.Strings.format(n.options.data.content.searchResults,e.toString()):a.Strings.format(n.options.data.content.searchResult,e.toString()):null}}),this._$main.on("scroll",function(){t._updateThumbs()},this.options.data.scrollStopDuration),this.options.data.sizingEnabled||this._$sizeRange.hide(),!0},t.prototype.data=function(){return{chunkedResizingThreshold:400,content:{searchResult:"{0} search result",searchResults:"{0} search results",select:"Select",selectAll:"Select All"},debug:!1,helper:null,imageFadeInDuration:300,initialZoom:6,minLabelWidth:20,pageModeEnabled:!1,scrollStopDuration:100,searchResults:[],sizingEnabled:!0,thumbHeight:320,thumbLoadPadding:3,thumbWidth:200,viewingDirection:r.ViewingDirection.LEFT_TO_RIGHT}},t.prototype.set=function(e){if(this._data=Object.assign(this._data,e),this._data.helper&&void 0!==this._data.thumbWidth&&void 0!==this._data.thumbHeight&&(this._thumbs=this._data.helper.getThumbs(this._data.thumbWidth,this._data.thumbHeight)),this._data.viewingDirection&&(this._data.viewingDirection===r.ViewingDirection.BOTTOM_TO_TOP&&this._thumbs.reverse(),this._$thumbs.addClass(this._data.viewingDirection)),this._data.searchResults&&this._data.searchResults.length)for(var t=0;t<this._data.searchResults.length;t++){var n=this._data.searchResults[t],i=this._thumbs.filter(function(e){return e.index===n.canvasIndex})[0],o=$.extend(!0,{},i.data);o.searchResults=n.rects.length,i.data=o}this._thumbsCache=null,this._createThumbs(),this._data.helper&&this.selectIndex(this._data.helper.canvasIndex);var s=this._getMultiSelectState();if(s&&s.isEnabled){for(this._$multiSelectOptions.show(),this._$thumbs.addClass("multiSelect"),t=0;t<s.canvases.length;t++){var a=s.canvases[t];i=this._getThumbByCanvas(a),this._setThumbMultiSelected(i,a.multiSelected)}for(t=0;t<s.ranges.length;t++)for(var u=s.ranges[t],l=this._getThumbsByRange(u),c=0;c<l.length;c++)i=l[c],this._setThumbMultiSelected(i,u.multiSelected)}else this._$multiSelectOptions.hide(),this._$thumbs.removeClass("multiSelect");this._update()},t.prototype._update=function(){var e=this._getMultiSelectState();e&&e.isEnabled&&(this._$selectAllButtonCheckbox.prop("checked",e.allSelected()),e.getAll().filter(function(e){return e.multiSelected}).length>0?this._$selectButton.show():this._$selectButton.hide())},t.prototype._getMultiSelectState=function(){return this._data.helper?this._data.helper.getMultiSelectState():null},t.prototype._createThumbs=function(){var e=this;if(this._thumbs){this._$thumbs.undelegate(".thumb","click"),this._$thumbs.empty();for(var t=this._getMultiSelectState(),n=[],i=0;i<this._thumbs.length;i++){var o=(c=this._thumbs[i]).width,r=c.height;c.initialWidth=o,n.push(r),c.multiSelectEnabled=!!t&&t.isEnabled}for(var s=a.Maths.median(n),u=0;u<this._thumbs.length;u++){var c;(c=this._thumbs[u]).initialHeight=s}if(this._$thumbs.link($.templates.galleryThumbsTemplate,this._thumbs),t&&!t.isEnabled)this._$thumbs.delegate(".thumb","click",function(t){t.preventDefault();var n=$.view(this).data;e.fire(l.THUMB_SELECTED,n)});else for(var h=this._$thumbs.find(".thumb"),p=function(){var e=d;$(h[f]).checkboxButton(function(t){var n=$.view(this).data;e._setThumbMultiSelected(n,!n.multiSelected);var i=e.options.data.helper.getCanvasRange(n.data),o=e._getMultiSelectState();o&&(i?o.selectRange(i,n.multiSelected):o.selectCanvas(n.data,n.multiSelected)),e._update(),e.fire(l.THUMB_MULTISELECTED,n)})},d=this,f=0;f<h.length;f++)p()}},t.prototype._getThumbByCanvas=function(e){return this._thumbs.filter(function(t){return t.data.id===e.id})[0]},t.prototype._sizeThumb=function(e){var t=e.data().initialwidth,n=e.data().initialheight,i=Number(t),o=Number(n),r=Math.floor(i*this._range),s=Math.floor(o*this._range),a=e.find(".wrap"),u=e.find(".label"),l=e.find(".index"),c=e.find(".searchResults"),h=r;this._data.searchResults&&this._data.searchResults.length&&(c.show(),h=r-c.outerWidth(),void 0!==this._data.minLabelWidth&&h<this._data.minLabelWidth?(c.hide(),h=r):c.show()),this._data.pageModeEnabled?(l.hide(),u.show()):(l.show(),u.hide()),a.outerWidth(r),a.outerHeight(s),l.outerWidth(h),u.outerWidth(h)},t.prototype._loadThumb=function(e,t){var n=e.find(".wrap");if(!n.hasClass("loading")&&!n.hasClass("loaded")){e.removeClass("preLoad");var i=e.attr("data-visible"),o=this._data.imageFadeInDuration||0;if("false"!==i){n.addClass("loading");var r=e.attr("data-src"),s=$('<img class="thumbImage" src="'+r+'" />');s.hide(),s.on("load",function(){$(this).fadeIn(o,function(){$(this).parent().switchClass("loading","loaded")})}),n.prepend(s),t&&t(s)}else n.addClass("hidden")}},t.prototype._getThumbsByRange=function(e){var t=[];if(!this._data.helper)return t;for(var n=0;n<this._thumbs.length;n++){var i=this._thumbs[n],o=i.data,r=this._data.helper.getCanvasRange(o,e.path);r&&r.id===e.id&&t.push(i)}return t},t.prototype._updateThumbs=function(){var e=!!this._data.debug;this._setRange();var t=this._$main.scrollTop(),n=t+this._$main.height();e&&console.log("scrollTop %s, scrollBottom %s",t,n);for(var i=this._getAllThumbs(),o=0,r=0;r<i.length;r++){var s=$(i[r]),a=s.position().top,u=s.outerHeight(),l=a+u,c=u*this._data.thumbLoadPadding;n+c>=a&&l>=t-c?(o+=1,this._sizeThumb(s),s.addClass("insideScrollArea"),this._loadThumb(s)):s.removeClass("insideScrollArea")}e&&console.log("number of thumbs to update: "+o)},t.prototype._getSelectedThumbIndex=function(){return Number(this._$selectedThumb.data("index"))},t.prototype._getAllThumbs=function(){return this._thumbsCache||(this._thumbsCache=this._$thumbs.find(".thumb")),this._thumbsCache},t.prototype._getThumbByIndex=function(e){return this._$thumbs.find('[data-index="'+e+'"]')},t.prototype._scrollToThumb=function(e){var t=this._getThumbByIndex(e);this._$main.scrollTop(t.position().top)},t.prototype.selectIndex=function(e){this._thumbs&&this._thumbs.length&&(this._getAllThumbs().removeClass("selected"),this._$selectedThumb=this._getThumbByIndex(e),this._$selectedThumb.addClass("selected"),this._scrollToThumb(e),this._updateThumbs())},t.prototype._setRange=function(){var e=a.Maths.normalise(Number(this._$sizeRange.val()),0,10);this._range=a.Maths.clamp(e,.05,1)},t.prototype._setThumbMultiSelected=function(e,t){$.observable(e).setProperty("multiSelected",t)},t.prototype._resize=function(){},t}(s.BaseComponent);t.GalleryComponent=u;var l=function(){function e(){}return e.DECREASE_SIZE="decreaseSize",e.INCREASE_SIZE="increaseSize",e.MULTISELECTION_MADE="multiSelectionMade",e.THUMB_SELECTED="thumbSelected",e.THUMB_MULTISELECTED="thumbMultiSelected",e}()},function(e,t,n){"use strict";var i,o,r,s,a,u,l,c,h;n.r(t),n.d(t,"AnnotationMotivation",function(){return i}),n.d(t,"Behavior",function(){return o}),n.d(t,"ExternalResourceType",function(){return r}),n.d(t,"IIIFResourceType",function(){return s}),n.d(t,"MediaType",function(){return a}),n.d(t,"RenderingFormat",function(){return u}),n.d(t,"ServiceProfile",function(){return l}),n.d(t,"ViewingDirection",function(){return c}),n.d(t,"ViewingHint",function(){return h}),function(e){e.BOOKMARKING="oa:bookmarking",e.CLASSIFYING="oa:classifying",e.COMMENTING="oa:commenting",e.DESCRIBING="oa:describing",e.EDITING="oa:editing",e.HIGHLIGHTING="oa:highlighting",e.IDENTIFYING="oa:identifying",e.LINKING="oa:linking",e.MODERATING="oa:moderating",e.PAINTING="sc:painting",e.QUESTIONING="oa:questioning",e.REPLYING="oa:replying",e.TAGGING="oa:tagging",e.TRANSCRIBING="oad:transcribing"}(i||(i={})),function(e){e.AUTO_ADVANCE="auto-advance",e.CONTINUOUS="continuous",e.FACING_PAGES="facing-pages",e.HIDDEN="hidden",e.INDIVIDUALS="individuals",e.MULTI_PART="multi-part",e.NO_NAV="no-nav",e.NON_PAGED="non-paged",e.PAGED="paged",e.REPEAT="repeat",e.SEQUENCE="sequence",e.THUMBNAIL_NAV="thumbnail-nav",e.TOGETHER="together",e.UNORDERED="unordered"}(o||(o={})),function(e){e.CANVAS="canvas",e.CHOICE="choice",e.CONTENT_AS_TEXT="contentastext",e.DOCUMENT="document",e.IMAGE="image",e.MOVING_IMAGE="movingimage",e.PDF="pdf",e.PHYSICAL_OBJECT="physicalobject",e.SOUND="sound",e.TEXTUALBODY="textualbody",e.VIDEO="video"}(r||(r={})),function(e){e.ANNOTATION="annotation",e.CANVAS="canvas",e.COLLECTION="collection",e.MANIFEST="manifest",e.RANGE="range",e.SEQUENCE="sequence"}(s||(s={})),function(e){e.AUDIO_MP4="audio/mp4",e.CORTO="application/corto",e.DRACO="application/draco",e.GLTF="model/gltf+json",e.JPG="image/jpeg",e.M3U8="application/vnd.apple.mpegurl",e.MP3="audio/mp3",e.MPEG_DASH="application/dash+xml",e.OBJ="text/plain",e.PDF="application/pdf",e.PLY="application/ply",e.THREEJS="application/vnd.threejs+json",e.VIDEO_MP4="video/mp4",e.WEBM="video/webm"}(a||(a={})),function(e){e.DOC="application/msword",e.DOCX="application/vnd.openxmlformats-officedocument.wordprocessingml.document",e.PDF="application/pdf"}(u||(u={})),function(e){e.IMAGE_0_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0",e.IMAGE_0_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1",e.IMAGE_0_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2",e.IMAGE_0_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0",e.IMAGE_0_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1",e.IMAGE_0_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2",e.IMAGE_1_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",e.IMAGE_1_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",e.IMAGE_1_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",e.IMAGE_1_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",e.IMAGE_1_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",e.IMAGE_1_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",e.IMAGE_1_LEVEL_0="http://iiif.io/api/image/1/level0.json",e.IMAGE_1_PROFILE_LEVEL_0="http://iiif.io/api/image/1/profiles/level0.json",e.IMAGE_1_LEVEL_1="http://iiif.io/api/image/1/level1.json",e.IMAGE_1_PROFILE_LEVEL_1="http://iiif.io/api/image/1/profiles/level1.json",e.IMAGE_1_LEVEL_2="http://iiif.io/api/image/1/level2.json",e.IMAGE_1_PROFILE_LEVEL_2="http://iiif.io/api/image/1/profiles/level2.json",e.IMAGE_2_LEVEL_0="http://iiif.io/api/image/2/level0.json",e.IMAGE_2_PROFILE_LEVEL_0="http://iiif.io/api/image/2/profiles/level0.json",e.IMAGE_2_LEVEL_1="http://iiif.io/api/image/2/level1.json",e.IMAGE_2_PROFILE_LEVEL_1="http://iiif.io/api/image/2/profiles/level1.json",e.IMAGE_2_LEVEL_2="http://iiif.io/api/image/2/level2.json",e.IMAGE_2_PROFILE_LEVEL_2="http://iiif.io/api/image/2/profiles/level2.json",e.AUTH_0_CLICK_THROUGH="http://iiif.io/api/auth/0/login/clickthrough",e.AUTH_0_LOGIN="http://iiif.io/api/auth/0/login",e.AUTH_0_LOGOUT="http://iiif.io/api/auth/0/logout",e.AUTH_0_RESTRICTED="http://iiif.io/api/auth/0/login/restricted",e.AUTH_0_TOKEN="http://iiif.io/api/auth/0/token",e.AUTH_1_CLICK_THROUGH="http://iiif.io/api/auth/1/clickthrough",e.AUTH_1_EXTERNAL="http://iiif.io/api/auth/1/external",e.AUTH_1_KIOSK="http://iiif.io/api/auth/1/kiosk",e.AUTH_1_LOGIN="http://iiif.io/api/auth/1/login",e.AUTH_1_LOGOUT="http://iiif.io/api/auth/1/logout",e.AUTH_1_PROBE="http://iiif.io/api/auth/1/probe",e.AUTH_1_TOKEN="http://iiif.io/api/auth/1/token",e.SEARCH_0="http://iiif.io/api/search/0/search",e.SEARCH_0_AUTO_COMPLETE="http://iiif.io/api/search/0/autocomplete",e.SEARCH_1="http://iiif.io/api/search/1/search",
e.SEARCH_1_AUTO_COMPLETE="http://iiif.io/api/search/1/autocomplete",e.TRACKING_EXTENSIONS="http://universalviewer.io/tracking-extensions-profile",e.UI_EXTENSIONS="http://universalviewer.io/ui-extensions-profile",e.PRINT_EXTENSIONS="http://universalviewer.io/print-extensions-profile",e.SHARE_EXTENSIONS="http://universalviewer.io/share-extensions-profile",e.OTHER_MANIFESTATIONS="http://iiif.io/api/otherManifestations.json",e.IXIF="http://wellcomelibrary.org/ld/ixif/0/alpha.json"}(l||(l={})),function(e){e.BOTTOM_TO_TOP="bottom-to-top",e.LEFT_TO_RIGHT="left-to-right",e.RIGHT_TO_LEFT="right-to-left",e.TOP_TO_BOTTOM="top-to-bottom"}(c||(c={})),function(e){e.CONTINUOUS="continuous",e.INDIVIDUALS="individuals",e.NON_PAGED="non-paged",e.PAGED="paged",e.TOP="top"}(h||(h={}))},function(e,t,n){"use strict";n.r(t),n.d(t,"BaseComponent",function(){return i});var i=function(){function e(e){this.options=e,this.options.data=Object.assign({},this.data(),e.data)}return e.prototype._init=function(){return this.el=this.options.target,this.el?(this.el.innerHTML="",!0):(console.warn("element not found"),!1)},e.prototype.data=function(){return{}},e.prototype.on=function(e,t,n){var i=this._e||(this._e={});(i[e]||(i[e]=[])).push({fn:t,ctx:n})},e.prototype.fire=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var i=[].slice.call(arguments,1),o=((this._e||(this._e={}))[e]||[]).slice(),r=0,s=o.length;s>r;r++)o[r].fn.apply(o[r].ctx,i)},e.prototype._resize=function(){},e.prototype.set=function(e){},e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"Async",function(){return o}),n.d(t,"Bools",function(){return r}),n.d(t,"Clipboard",function(){return s}),n.d(t,"Colors",function(){return a}),n.d(t,"Dates",function(){return u}),n.d(t,"Device",function(){return l}),n.d(t,"Documents",function(){return c}),n.d(t,"Events",function(){return h}),n.d(t,"Files",function(){return p}),n.d(t,"Keyboard",function(){return d}),n.d(t,"Maths",function(){return f}),n.d(t,"Size",function(){return g}),n.d(t,"Dimensions",function(){return v}),n.d(t,"Numbers",function(){return _}),n.d(t,"Objects",function(){return m}),n.d(t,"Storage",function(){return E}),n.d(t,"StorageItem",function(){return y}),n.d(t,"StorageType",function(){return i}),n.d(t,"Strings",function(){return b}),n.d(t,"Urls",function(){return I});var i,o=function(){function e(){}return e.waitFor=function(t,n,i,o,r,s){o||(o=200),r||(r=100),s||(s=0),(s+=1)>r?i&&i():t()?n():setTimeout(function(){e.waitFor(t,n,i,o,r,s)},o)},e}(),r=function(){function e(){}return e.getBool=function(e,t){return null==e?t:e},e}(),s=function(){function e(){}return e.supportsCopy=function(){return document.queryCommandSupported&&document.queryCommandSupported("copy")},e.copy=function(t){t=e.convertBrToNewLine(t);var n=document.createElement("textarea");n.value=t,e.hideButKeepEnabled(n),document.body.appendChild(n),n.focus(),n.select(),document.execCommand("copy"),document.body.removeChild(n)},e.hideButKeepEnabled=function(e){e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="2em",e.style.height="2em",e.style.padding="0",e.style.border="none",e.style.outline="none",e.style.boxShadow="none",e.style.background="transparent"},e.convertBrToNewLine=function(e){return e=e.replace(/<br\s*[\/]?>/gi,"\n")},e}(),a=function(){function e(){}return e.float32ColorToARGB=function(e){return[(4278190080&e)>>>24,(16711680&e)>>>16,(65280&e)>>>8,255&e]},e._componentToHex=function(e){var t=e.toString(16);return 1==t.length?"0"+t:t},e.rgbToHexString=function(t){return e.coalesce(t),"#"+e._componentToHex(t[0])+e._componentToHex(t[1])+e._componentToHex(t[2])},e.argbToHexString=function(t){return"#"+e._componentToHex(t[0])+e._componentToHex(t[1])+e._componentToHex(t[2])+e._componentToHex(t[3])},e.coalesce=function(e){for(var t=1;t<e.length;t++)void 0===e[t]&&(e[t]=e[t-1])},e}(),u=function(){function e(){}return e.getTimeStamp=function(){return(new Date).getTime()},e}(),l=function(){function e(){}return e.getPixelRatio=function(e){return(window.devicePixelRatio||1)/(e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1)},e.isTouch=function(){return!!("ontouchstart"in window)||window.navigator.msMaxTouchPoints>0},e}(),c=function(){function e(){}return e.isInIFrame=function(){try{return window.self!==window.top}catch(e){return!0}},e.supportsFullscreen=function(){var e=document.documentElement;return void 0!==(e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullScreen||e.msRequestFullscreen)},e.isHidden=function(){return!!e.getHiddenProp()},e.getHiddenProp=function(){var e=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var t=0;t<e.length;t++)if(e[t]+"Hidden"in document)return e[t]+"Hidden";return null},e}(),h=function(){function e(){}return e.debounce=function(e,t){return t=t||100,function(){if(!e.debouncing){var n=Array.prototype.slice.apply(arguments);e.lastReturnVal=e.apply(window,n),e.debouncing=!0}return clearTimeout(e.debounceTimeout),e.debounceTimeout=setTimeout(function(){e.debouncing=!1},t),e.lastReturnVal}},e}(),p=function(){function e(){}return e.simplifyMimeType=function(e){switch(e){case"text/plain":return"txt";case"image/jpeg":return"jpg";case"application/msword":return"doc";case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":return"docx";default:var t=e.split("/");return t[t.length-1]}},e}(),d=function(){function e(){}return e.getCharCode=function(e){return"number"==typeof e.which?e.which:e.keyCode},e}(),f=function(){function e(){}return e.normalise=function(e,t,n){return(e-t)/(n-t)},e.median=function(e){e.sort(function(e,t){return e-t});var t=Math.floor(e.length/2);return e.length%2?e[t]:(e[t-1]+e[t])/2},e.clamp=function(e,t,n){return Math.min(Math.max(e,t),n)},e}(),g=function(e,t){this.width=e,this.height=t},v=function(){function e(){}return e.fitRect=function(e,t,n,i){var o,r=0,s=0;return i/n>t/e?(r=e*(o=n/e),s=t*o):(r=e*(o=i/t),s=t*o),new g(Math.floor(r),Math.floor(s))},e.hitRect=function(e,t,n,i,o,r){return o>e&&e+n>o&&r>t&&t+i>r},e}(),_=function(){function e(){}return e.numericalInput=function(e){return 46==e.keyCode||8==e.keyCode||9==e.keyCode||27==e.keyCode||65==e.keyCode&&!0===e.ctrlKey||e.keyCode>=35&&e.keyCode<=39||!(e.shiftKey||(e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105))||(e.preventDefault(),!1)},e}(),m=function(){function e(){}return e.toPlainObject=function(e){e=Object(e);var t={};for(var n in e)t[n]=e[n];return t},e}(),E=function(){function e(){}return e.clear=function(e){switch(void 0===e&&(e=i.MEMORY),e){case i.MEMORY:this._memoryStorage={};break;case i.SESSION:sessionStorage.clear();break;case i.LOCAL:localStorage.clear()}},e.clearExpired=function(e){void 0===e&&(e=i.MEMORY);for(var t=this.getItems(e),n=0;n<t.length;n++){var o=t[n];this._isExpired(o)&&this.remove(o.key)}},e.get=function(e,t){void 0===t&&(t=i.MEMORY);var n=null;switch(t){case i.MEMORY:n=this._memoryStorage[e];break;case i.SESSION:n=sessionStorage.getItem(e);break;case i.LOCAL:n=localStorage.getItem(e)}if(!n)return null;var o=null;try{o=JSON.parse(n)}catch(e){return null}return o?this._isExpired(o)?null:(o.key=e,o):null},e._isExpired=function(e){return!((new Date).getTime()<e.expiresAt)},e.getItems=function(e){void 0===e&&(e=i.MEMORY);var t=[];switch(e){case i.MEMORY:for(var n=Object.keys(this._memoryStorage),o=0;o<n.length;o++)(s=this.get(n[o],i.MEMORY))&&t.push(s);break;case i.SESSION:for(o=0;o<sessionStorage.length;o++)(r=sessionStorage.key(o))&&(s=this.get(r,i.SESSION))&&t.push(s);break;case i.LOCAL:for(o=0;o<localStorage.length;o++){var r,s;(r=localStorage.key(o))&&(s=this.get(r,i.LOCAL))&&t.push(s)}}return t},e.remove=function(e,t){switch(void 0===t&&(t=i.MEMORY),t){case i.MEMORY:delete this._memoryStorage[e];break;case i.SESSION:sessionStorage.removeItem(e);break;case i.LOCAL:localStorage.removeItem(e)}},e.set=function(e,t,n,o){void 0===o&&(o=i.MEMORY);var r=1e3*n,s=new y;switch(s.value=t,s.expiresAt=(new Date).getTime()+r,o){case i.MEMORY:this._memoryStorage[e]=JSON.stringify(s);break;case i.SESSION:sessionStorage.setItem(e,JSON.stringify(s));break;case i.LOCAL:localStorage.setItem(e,JSON.stringify(s))}return s},e._memoryStorage={},e}(),y=function(){};!function(e){e.MEMORY="memory",e.SESSION="session",e.LOCAL="local"}(i||(i={}));var b=function(){function e(){}return e.ellipsis=function(e,t){if(e.length<=t)return e;var n=e.substr(0,t),i=n.lastIndexOf(" ");return-1!=i&&(n=n.substr(0,Math.min(n.length,i))),n+"&hellip;"},e.htmlDecode=function(e){var t=document.createElement("div");return t.innerHTML=e,t.firstChild.nodeValue},e.format=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var i=0;i<t.length;i++){var o=new RegExp("\\{"+i+"\\}","gm");e=e.replace(o,t[i])}return e},e.isAlphanumeric=function(e){return/^[a-zA-Z0-9]*$/.test(e)},e.toCssClass=function(e){return e.replace(/[^a-z0-9]/g,function(e){var t=e.charCodeAt(0);return 32==t?"-":t>=65&&90>=t?"_"+e.toLowerCase():"__"+("000"+t.toString(16)).slice(-4)})},e.toFileName=function(e){return e.replace(/[^a-z0-9]/gi,"_").toLowerCase()},e.utf8_to_b64=function(e){return window.btoa(unescape(encodeURIComponent(e)))},e}(),I=function(){function e(){}return e.getHashParameter=function(e,t){return t||(t=window.document),t&&t.location?this.getHashParameterFromString(e,t.location.hash):null},e.getHashParameterFromString=function(e,t){var n=new RegExp("#.*[?&]"+e+"=([^&]+)(&|$)").exec(t);return n?decodeURIComponent(n[1].replace(/\+/g," ")):null},e.setHashParameter=function(e,t,n){if(n||(n=window.document),n&&n.location){var i="#?"+this.updateURIKeyValuePair(n.location.hash.replace("#?",""),e,t),o=n.URL;-1!=o.indexOf("#")&&(o=o.substr(0,o.indexOf("#"))),n.location.replace(o+i)}},e.getQuerystringParameter=function(e,t){return t||(t=window),this.getQuerystringParameterFromString(e,t.location.search)},e.getQuerystringParameterFromString=function(e,t){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t);return n?decodeURIComponent(n[1].replace(/\+/g," ")):null},e.setQuerystringParameter=function(e,t,n){if(n||(n=window.document),n&&n.location){var i=this.updateURIKeyValuePair(n.location.hash.replace("#?",""),e,t);window.location.search=i}},e.updateURIKeyValuePair=function(e,t,n){t=encodeURIComponent(t),n=encodeURIComponent(n);var i=e.split("&");""==i[0]&&i.shift();for(var o,r=i.length;r--;)if((o=i[r].split("="))[0]==t){o[1]=n,i[r]=o.join("=");break}return 0>r&&(i[i.length]=[t,n].join("=")),i.join("&")},e.getUrlParts=function(e){var t=document.createElement("a");return t.href=e,t},e.convertToRelativeUrl=function(e){var t=this.getUrlParts(e),n=t.pathname+t.searchWithin;return n.startsWith("/")||(n="/"+n),n},e}()}])});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-contentleftpanel-module/GalleryView",["require","exports","../uv-shared-module/BaseEvents","../uv-shared-module/BaseView","@iiif/iiif-gallery-component"],function(e,t,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(t){var n=e.call(this,t,!0,!0)||this;return n.isOpen=!1,n}return __extends(t,e),t.prototype.create=function(){this.setConfig("contentLeftPanel"),e.prototype.create.call(this),this.$gallery=$('<div class="iiif-gallery-component"></div>'),this.$element.append(this.$gallery)},t.prototype.setup=function(){var e=this;this.galleryComponent=new o.GalleryComponent({target:this.$gallery[0]}),this.galleryComponent.on("thumbSelected",function(t){e.component.publish(n.BaseEvents.GALLERY_THUMB_SELECTED,t),e.component.publish(n.BaseEvents.THUMB_SELECTED,t)},!1),this.galleryComponent.on("decreaseSize",function(){e.component.publish(n.BaseEvents.GALLERY_DECREASE_SIZE)},!1),this.galleryComponent.on("increaseSize",function(){e.component.publish(n.BaseEvents.GALLERY_INCREASE_SIZE)},!1)},t.prototype.databind=function(){this.galleryComponent.options.data=this.galleryData,this.galleryComponent.set(this.galleryData),this.resize()},t.prototype.show=function(){var e=this;this.isOpen=!0,this.$element.show(),setTimeout(function(){e.galleryComponent.selectIndex(e.extension.helper.canvasIndex)},10)},t.prototype.hide=function(){this.isOpen=!1,this.$element.hide()},t.prototype.resize=function(){e.prototype.resize.call(this);var t=this.$gallery.find(".main"),n=this.$gallery.find(".header");t.height(this.$element.height()-n.height())},t}(i.BaseView);t.GalleryView=r});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-shared-module/BaseExpandPanel",["require","exports","./BaseView"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t){var n=e.call(this,t,!1,!0)||this;return n.isExpanded=!1,n.isFullyExpanded=!1,n.isUnopened=!0,n.autoToggled=!1,n.expandFullEnabled=!0,n}return __extends(t,e),t.prototype.create=function(){var t=this;e.prototype.create.call(this),this.$top=$('<div class="top"></div>'),this.$element.append(this.$top),this.$title=$('<div class="title"></div>'),this.$title.prop("title",this.content.title),this.$top.append(this.$title),this.$expandFullButton=$('<a class="expandFullButton" tabindex="0"></a>'),this.$expandFullButton.prop("title",this.content.expandFull),this.$top.append(this.$expandFullButton),Utils.Bools.getBool(this.config.options.expandFullEnabled,!0)||this.$expandFullButton.hide(),this.$collapseButton=$('<div class="collapseButton" tabindex="0"></div>'),this.$collapseButton.prop("title",this.content.collapse),this.$top.append(this.$collapseButton),this.$closed=$('<div class="closed"></div>'),this.$element.append(this.$closed),this.$expandButton=$('<a class="expandButton" tabindex="0"></a>'),this.$expandButton.prop("title",this.content.expand),this.$closed.append(this.$expandButton),this.$closedTitle=$('<a class="title"></a>'),this.$closedTitle.prop("title",this.content.title),this.$closed.append(this.$closedTitle),this.$main=$('<div class="main"></div>'),this.$element.append(this.$main),this.$expandButton.onPressed(function(){t.toggle()}),this.$expandFullButton.onPressed(function(){t.expandFull()}),this.$closedTitle.onPressed(function(){t.toggle()}),this.$title.onPressed(function(){t.isFullyExpanded?t.collapseFull():t.toggle()}),this.$collapseButton.onPressed(function(){t.isFullyExpanded?t.collapseFull():t.toggle()}),this.$top.hide(),this.$main.hide()},t.prototype.init=function(){e.prototype.init.call(this)},t.prototype.setTitle=function(e){this.$title.text(e),this.$closedTitle.text(e)},t.prototype.toggle=function(e){var t=this;e?this.autoToggled=!0:this.autoToggled=!1,this.isExpanded&&(this.$top.attr("aria-hidden","true"),this.$main.attr("aria-hidden","true"),this.$closed.attr("aria-hidden","false"),this.$top.hide(),this.$main.hide(),this.$closed.show()),this.$element.stop().animate({width:this.getTargetWidth(),left:this.getTargetLeft()},this.options.panelAnimationDuration,function(){t.toggled()})},t.prototype.toggled=function(){this.toggleStart(),this.isExpanded=!this.isExpanded,this.isExpanded&&(this.$top.attr("aria-hidden","false"),this.$main.attr("aria-hidden","false"),this.$closed.attr("aria-hidden","true"),this.$closed.hide(),this.$top.show(),this.$main.show()),this.toggleFinish(),this.isUnopened=!1},t.prototype.expandFull=function(){var e=this;this.isExpanded||this.toggled();var t=this.getFullTargetWidth(),n=this.getFullTargetLeft();this.expandFullStart(),this.$element.stop().animate({width:t,left:n},this.options.panelAnimationDuration,function(){e.expandFullFinish()})},t.prototype.collapseFull=function(){var e=this,t=this.getTargetWidth(),n=this.getTargetLeft();this.collapseFullStart(),this.$element.stop().animate({width:t,left:n},this.options.panelAnimationDuration,function(){e.collapseFullFinish()})},t.prototype.getTargetWidth=function(){return 0},t.prototype.getTargetLeft=function(){return 0},t.prototype.getFullTargetWidth=function(){return 0},t.prototype.getFullTargetLeft=function(){return 0},t.prototype.toggleStart=function(){},t.prototype.toggleFinish=function(){this.isExpanded&&!this.autoToggled?this.focusCollapseButton():this.focusExpandButton()},t.prototype.expandFullStart=function(){},t.prototype.expandFullFinish=function(){this.isFullyExpanded=!0,this.$expandFullButton.hide(),this.focusCollapseButton()},t.prototype.collapseFullStart=function(){},t.prototype.collapseFullFinish=function(){this.isFullyExpanded=!1,this.expandFullEnabled&&this.$expandFullButton.show(),this.focusExpandFullButton()},t.prototype.focusExpandButton=function(){var e=this;setTimeout(function(){e.$expandButton.focus()},1)},t.prototype.focusExpandFullButton=function(){var e=this;setTimeout(function(){e.$expandFullButton.focus()},1)},t.prototype.focusCollapseButton=function(){var e=this;setTimeout(function(){e.$collapseButton.focus()},1)},t.prototype.resize=function(){e.prototype.resize.call(this),this.$main.height(this.$element.parent().height()-this.$top.outerHeight(!0))},t}(n.BaseView);t.BaseExpandPanel=i});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-shared-module/LeftPanel",["require","exports","./BaseEvents","./BaseExpandPanel"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){var t=this;e.prototype.create.call(this),this.$element.width(this.options.panelCollapsedWidth),this.component.subscribe(n.BaseEvents.TOGGLE_EXPAND_LEFT_PANEL,function(){t.isFullyExpanded?t.collapseFull():t.expandFull()})},t.prototype.init=function(){e.prototype.init.call(this);var t=Utils.Bools.getBool(this.extension.getSettings().leftPanelOpen,this.options.panelOpen);t&&this.toggle(!0)},t.prototype.getTargetWidth=function(){return this.isFullyExpanded||!this.isExpanded?this.options.panelExpandedWidth:this.options.panelCollapsedWidth},t.prototype.getFullTargetWidth=function(){return this.$element.parent().width()},t.prototype.toggleFinish=function(){e.prototype.toggleFinish.call(this),this.isExpanded?this.component.publish(n.BaseEvents.OPEN_LEFT_PANEL):this.component.publish(n.BaseEvents.CLOSE_LEFT_PANEL),this.extension.updateSettings({leftPanelOpen:this.isExpanded})},t.prototype.resize=function(){e.prototype.resize.call(this),this.isFullyExpanded&&this.$element.width(this.$element.parent().width())},t}(i.BaseExpandPanel);t.LeftPanel=o}),define("extensions/uv-seadragon-extension/Mode",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.value=e}return e.prototype.toString=function(){return this.value},e.image=new e("image"),e.page=new e("page"),e}();t.Mode=n});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-shared-module/ThumbsView",["require","exports","./BaseEvents","./BaseView","@iiif/vocabulary"],function(e,t,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(t){var n=e.call(this,t,!0,!0)||this;return n.isCreated=!1,n.isOpen=!1,n}return __extends(t,e),t.prototype.create=function(){var t=this;e.prototype.create.call(this),this.component.subscribe(n.BaseEvents.CANVAS_INDEX_CHANGED,function(e){t.selectIndex(parseInt(e))}),this.component.subscribe(n.BaseEvents.LOGIN,function(){t.loadThumbs()}),this.component.subscribe(n.BaseEvents.CLICKTHROUGH,function(){t.loadThumbs()}),this.$thumbs=$('<div class="thumbs"></div>'),this.$element.append(this.$thumbs);var i=this.extension.helper.getViewingDirection()||o.ViewingDirection.LEFT_TO_RIGHT;this.$thumbs.addClass(i.toString());var r=this;$.templates({thumbsTemplate:'<div id="thumb{{>index}}" class="{{:~className()}}" data-src="{{>uri}}" data-visible="{{>visible}}" data-index="{{>index}}">                                <div class="wrap" style="height:{{>height + ~extraHeight()}}px"></div>                                <div class="info">                                    <span class="index">{{:#index + 1}}</span>                                    <span class="label" title="{{>label}}">{{>label}}&nbsp;</span>                                    <span class="searchResults" title="{{:~searchResultsTitle()}}">{{>data.searchResults}}</span>                                </div>                             </div>                             {{if ~separator()}}                                  <div class="separator"></div>                              {{/if}}'});var s=this.options.thumbsExtraHeight;$.views.helpers({separator:function(){return!1},extraHeight:function(){return s},className:function(){var e="thumb";0===this.data.index&&(e+=" first"),this.data.uri||(e+=" placeholder");var t=r.extension.helper.getViewingDirection();return e+=!t||t.toString()!==o.ViewingDirection.LEFT_TO_RIGHT.toString()&&t.toString()!==o.ViewingDirection.RIGHT_TO_LEFT.toString()?r.extension.helper.isPaged()?" twoCol":" oneCol":" twoCol"},searchResultsTitle:function(){var e=Number(this.data.data.searchResults);return e?e>1?Utils.Strings.format(r.content.searchResults,e.toString()):Utils.Strings.format(r.content.searchResult,e.toString()):""}}),this.$element.on("scroll",function(){t.scrollStop()},100),this.resize()},t.prototype.databind=function(){this.thumbs&&(this._$thumbsCache=null,this.createThumbs(),this.loadThumbs(0),this.selectIndex(this.extension.helper.canvasIndex))},t.prototype.createThumbs=function(){var e=this;if(this.thumbs){for(var t=[],i=0;i<this.thumbs.length;i++){var o=this.thumbs[i];t.push(o.height)}for(var r=Utils.Maths.median(t),i=0;i<this.thumbs.length;i++){var o=this.thumbs[i];o.height=r}this.$thumbs.link($.templates.thumbsTemplate,this.thumbs),this.$thumbs.undelegate(".thumb","click"),this.$thumbs.delegate(".thumb","click",function(t){t.preventDefault();var i=$.view(this).data;e.lastThumbClickedIndex=i.index,e.component.publish(n.BaseEvents.THUMB_SELECTED,i)}),this.setLabel(),this.isCreated=!0}},t.prototype.scrollStop=function(){var e=1/((this.$thumbs.height()-this.$element.height())/this.$element.scrollTop());e>1&&(e=1);var t=Math.floor((this.thumbs.length-1)*e);this.loadThumbs(t)},t.prototype.loadThumbs=function(e){if(void 0===e&&(e=this.extension.helper.canvasIndex),this.thumbs&&this.thumbs.length){var t,n=this.extension.helper.getCanvasByIndex(e),i=n.getContent();if(i.length){var o=i[0],r=o.getBody();if(r.length){var s=r[0].getType();s&&(t=s.toString().toLowerCase())}}for(var a=e,u=this.options.thumbsLoadRange,l={start:a>u?a-u:0,end:a<this.thumbs.length-1-u?a+u:this.thumbs.length-1},c=this.options.thumbsImageFadeInDuration,h=this,p=l.start;p<=l.end;p++){var d=this.getThumbByIndex(p),f=d.find(".wrap");if(!f.hasClass("loading")&&!f.hasClass("loaded")){var g=d.attr("data-visible");if("false"!==g){f.removeClass("loadingFailed"),f.addClass("loading"),t&&f.addClass(t);var v=d.attr("data-src");h.config.options.thumbsCacheInvalidation&&h.config.options.thumbsCacheInvalidation.enabled&&(v+=h.config.options.thumbsCacheInvalidation.paramType+"t="+Utils.Dates.getTimeStamp());var _=$('<img src="'+v+'" alt=""/>');_.hide(),_.on("load",function(){$(this).fadeIn(c,function(){$(this).parent().switchClass("loading","loaded")})}),_.on("error",function(){$(this).parent().switchClass("loading","loadingFailed")}),f.append(_)}else f.addClass("hidden")}}}},t.prototype.show=function(){var e=this;this.isOpen=!0,this.$element.show(),setTimeout(function(){e.selectIndex(e.extension.helper.canvasIndex)},1)},t.prototype.hide=function(){this.isOpen=!1,this.$element.hide()},t.prototype.isPDF=function(){var e=this.extension.helper.getCurrentCanvas(),t=e.getType();return t?t.toString().includes("pdf"):!1},t.prototype.setLabel=function(){$(this.$thumbs).find("span.index").hide(),$(this.$thumbs).find("span.label").show()},t.prototype.addSelectedClassToThumbs=function(e){this.getThumbByIndex(e).addClass("selected")},t.prototype.selectIndex=function(e){if(-1!==e&&this.thumbs&&this.thumbs.length){this.getAllThumbs().removeClass("selected"),this.$selectedThumb=this.getThumbByIndex(e),this.addSelectedClassToThumbs(e);var t=this.extension.getPagedIndices(e);~t.indexOf(this.lastThumbClickedIndex)||this.$element.scrollTop(this.$selectedThumb.position().top),this.loadThumbs(e)}},t.prototype.getAllThumbs=function(){return this._$thumbsCache||(this._$thumbsCache=this.$thumbs.find(".thumb")),this._$thumbsCache},t.prototype.getThumbByIndex=function(e){return this.$thumbs.find('[data-index="'+e+'"]')},t.prototype.scrollToThumb=function(e){var t=this.getThumbByIndex(e);this.$element.scrollTop(t.position().top)},t.prototype.resize=function(){e.prototype.resize.call(this)},t}(i.BaseView);t.ThumbsView=r}),define("extensions/uv-seadragon-extension/Events",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.namespace="openseadragonExtension.",e.CURRENT_VIEW_URI=e.namespace+"currentViewUri",e.IMAGE_SEARCH=e.namespace+"imageSearch",e.MODE_CHANGED=e.namespace+"modeChanged",e.NEXT_SEARCH_RESULT=e.namespace+"nextSearchResult",e.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE=e.namespace+"nextImagesSearchResultUnavailable",e.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE=e.namespace+"prevImagesSearchResultUnavailable",e.PAGE_SEARCH=e.namespace+"pageSearch",e.PAGING_TOGGLED=e.namespace+"pagingToggled",e.PREV_SEARCH_RESULT=e.namespace+"prevSearchResult",e.PRINT=e.namespace+"print",e.ROTATE=e.namespace+"rotate",e.SEADRAGON_ANIMATION_FINISH=e.namespace+"animationFinish",e.SEADRAGON_ANIMATION_START=e.namespace+"animationStart",e.SEADRAGON_ANIMATION=e.namespace+"animation",e.SEADRAGON_OPEN=e.namespace+"open",e.SEADRAGON_RESIZE=e.namespace+"resize",e.SEADRAGON_ROTATION=e.namespace+"rotationChanged",e.SEARCH_PREVIEW_FINISH=e.namespace+"searchPreviewFinish",e.SEARCH_PREVIEW_START=e.namespace+"searchPreviewStart",e.SEARCH=e.namespace+"search",e.XYWH_CHANGED=e.namespace+"xywhChanged",e.ZOOM_IN=e.namespace+"zoomIn",e.ZOOM_OUT=e.namespace+"zoomOut",e}();t.Events=n});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-contentleftpanel-module/ThumbsView",["require","exports","../uv-shared-module/ThumbsView","../../extensions/uv-seadragon-extension/Events","../../extensions/uv-seadragon-extension/Mode"],function(e,t,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("contentLeftPanel"),e.prototype.create.call(this),this.component.subscribe(i.Events.MODE_CHANGED,function(){t.setLabel()}),this.component.subscribe(i.Events.SEARCH_PREVIEW_START,function(e){t.searchPreviewStart(e)}),this.component.subscribe(i.Events.SEARCH_PREVIEW_FINISH,function(){t.searchPreviewFinish()}),this.extension.helper.isPaged()&&this.$thumbs.addClass("paged");var n=this;$.views.helpers({separator:function(){return n.extension.helper.isPaged()&&(this.data.index-1)%2==0?!1:!0}})},t.prototype.addSelectedClassToThumbs=function(e){for(var t=this.extension.getPagedIndices(e),n=0;n<t.length;n++)this.getThumbByIndex(t[n]).addClass("selected")},t.prototype.isPageModeEnabled=function(){return"function"==typeof this.extension.getMode?this.config.options.pageModeEnabled&&this.extension.getMode().toString()===o.Mode.page.toString():this.config.options.pageModeEnabled},t.prototype.searchPreviewStart=function(e){this.scrollToThumb(e);var t=this.getThumbByIndex(e);t.addClass("searchpreview")},t.prototype.searchPreviewFinish=function(){this.scrollToThumb(this.extension.helper.canvasIndex),this.getAllThumbs().removeClass("searchpreview")},t.prototype.setLabel=function(){this.isPDF()?($(this.$thumbs).find("span.index").hide(),$(this.$thumbs).find("span.label").hide()):this.isPageModeEnabled()?($(this.$thumbs).find("span.index").hide(),$(this.$thumbs).find("span.label").show()):($(this.$thumbs).find("span.index").show(),$(this.$thumbs).find("span.label").hide())},t}(n.ThumbsView);t.ThumbsView=r});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-contentleftpanel-module/TreeView",["require","exports","../uv-shared-module/BaseEvents","../uv-shared-module/BaseView"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){var n=e.call(this,t,!0,!0)||this;return n.isOpen=!1,n}return __extends(t,e),t.prototype.create=function(){this.setConfig("contentLeftPanel"),e.prototype.create.call(this),this.$tree=$('<div class="iiif-tree-component"></div>'),this.$element.append(this.$tree)},t.prototype.setup=function(){var e=this;this.treeComponent=new IIIFComponents.TreeComponent({target:this.$tree[0],data:this.treeData}),this.treeComponent.on("treeNodeSelected",function(t){e.component.publish(n.BaseEvents.TREE_NODE_SELECTED,t)},!1),this.treeComponent.on("treeNodeMultiSelected",function(t){e.component.publish(n.BaseEvents.TREE_NODE_MULTISELECTED,t)},!1)},t.prototype.databind=function(){this.treeComponent.set(this.treeData),this.resize()},t.prototype.show=function(){this.isOpen=!0,this.$element.show()},t.prototype.hide=function(){this.isOpen=!1,this.$element.hide()},t.prototype.selectNode=function(e){if(!this.treeComponent.selectedNode){this.treeComponent.expandParents(e,!0);var t=this.$tree.find("#tree-link-"+e.id)[0];t&&t.scrollIntoViewIfNeeded()}this.treeComponent.selectNode(e)},t.prototype.expandNode=function(e,t){this.treeComponent.expandNode(e,t)},t.prototype.getAllNodes=function(){return this.treeComponent.getAllNodes()},t.prototype.deselectCurrentNode=function(){this.treeComponent.deselectCurrentNode()},t.prototype.getNodeById=function(e){return this.treeComponent.getNodeById(e)},t.prototype.resize=function(){e.prototype.resize.call(this)},t}(i.BaseView);t.TreeView=o});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-contentleftpanel-module/ContentLeftPanel",["require","exports","../uv-shared-module/BaseEvents","./GalleryView","../uv-shared-module/LeftPanel","../../extensions/uv-seadragon-extension/Mode","./ThumbsView","./TreeView","@iiif/vocabulary","manifesto.js","@iiif/manifold"],function(e,t,n,i,o,r,s,a,u,l,c){
"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=function(e){function t(t){var n=e.call(this,t)||this;return n.expandFullEnabled=!1,n.isThumbsViewOpen=!1,n.isTreeViewOpen=!1,n.treeSortType=c.TreeSortType.NONE,n}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("contentLeftPanel"),e.prototype.create.call(this),this.component.subscribe(n.BaseEvents.SETTINGS_CHANGED,function(){t.databind()}),this.component.subscribe(n.BaseEvents.GALLERY_THUMB_SELECTED,function(){t.collapseFull()}),this.component.subscribe(n.BaseEvents.METRIC_CHANGED,function(){t.extension.isDesktopMetric()||t.isFullyExpanded&&t.collapseFull()}),this.component.subscribe(n.BaseEvents.ANNOTATIONS,function(){t.databindThumbsView(),t.databindGalleryView()}),this.component.subscribe(n.BaseEvents.ANNOTATIONS_CLEARED,function(){t.databindThumbsView(),t.databindGalleryView()}),this.component.subscribe(n.BaseEvents.ANNOTATIONS_EMPTY,function(){t.databindThumbsView(),t.databindGalleryView()}),this.component.subscribe(n.BaseEvents.CANVAS_INDEX_CHANGED,function(){t.isFullyExpanded&&t.collapseFull(),t.selectCurrentTreeNode(),t.updateTreeTabBySelection()}),this.component.subscribe(n.BaseEvents.RANGE_CHANGED,function(){t.isFullyExpanded&&t.collapseFull(),t.selectCurrentTreeNode(),t.updateTreeTabBySelection()}),this.$tabs=$('<div class="tabs"></div>'),this.$main.append(this.$tabs),this.$treeButton=$('<a class="index tab" tabindex="0">'+this.content.index+"</a>"),this.$tabs.append(this.$treeButton),this.$thumbsButton=$('<a class="thumbs tab" tabindex="0">'+this.content.thumbnails+"</a>"),this.$thumbsButton.prop("title",this.content.thumbnails),this.$tabs.append(this.$thumbsButton),this.$tabsContent=$('<div class="tabsContent"></div>'),this.$main.append(this.$tabsContent),this.$options=$('<div class="options"></div>'),this.$tabsContent.append(this.$options),this.$topOptions=$('<div class="top"></div>'),this.$options.append(this.$topOptions),this.$treeSelect=$('<select aria-label="'+this.content.manifestRanges+'"></select>'),this.$topOptions.append(this.$treeSelect),this.$bottomOptions=$('<div class="bottom"></div>'),this.$options.append(this.$bottomOptions),this.$leftOptions=$('<div class="left"></div>'),this.$bottomOptions.append(this.$leftOptions),this.$rightOptions=$('<div class="right"></div>'),this.$bottomOptions.append(this.$rightOptions),this.$treeViewOptions=$('<div class="treeView"></div>'),this.$leftOptions.append(this.$treeViewOptions),this.$sortByLabel=$('<span class="sort">'+this.content.sortBy+"</span>"),this.$treeViewOptions.append(this.$sortByLabel),this.$sortButtonGroup=$('<div class="btn-group"></div>'),this.$treeViewOptions.append(this.$sortButtonGroup),this.$sortByDateButton=$('<button class="btn" tabindex="0">'+this.content.date+"</button>"),this.$sortButtonGroup.append(this.$sortByDateButton),this.$sortByVolumeButton=$('<button class="btn" tabindex="0">'+this.content.volume+"</button>"),this.$sortButtonGroup.append(this.$sortByVolumeButton),this.$views=$('<div class="views"></div>'),this.$tabsContent.append(this.$views),this.$treeView=$('<div class="treeView"></div>'),this.$views.append(this.$treeView),this.$thumbsView=$('<div class="thumbsView" tabindex="0"></div>'),this.$views.append(this.$thumbsView),this.$galleryView=$('<div class="galleryView"></div>'),this.$views.append(this.$galleryView),this.$treeSelect.hide(),this.$treeSelect.change(function(){t.databindTreeView(),t.selectCurrentTreeNode(),t.updateTreeTabBySelection()}),this.$sortByDateButton.on("click",function(){t.sortByDate()}),this.$sortByVolumeButton.on("click",function(){t.sortByVolume()}),this.$treeViewOptions.hide(),this.$treeButton.onPressed(function(){t.openTreeView()}),this.$thumbsButton.onPressed(function(){t.openThumbsView()}),this.setTitle(this.content.title),this.$sortByVolumeButton.addClass("on");var i=this.options.tabOrder;if(i){i=i.toLowerCase(),i=i.replace(/ /g,"");var o=i.split(",");"thumbs"===o[0]?(this.$treeButton.before(this.$thumbsButton),this.$thumbsButton.addClass("first")):this.$treeButton.addClass("first")}},t.prototype.createTreeView=function(){this.treeView=new a.TreeView(this.$treeView),this.treeView.treeData=this.getTreeData(),this.treeView.setup(),this.databindTreeView();var e=this.extension.helper.getTopRanges();if(e.length>1)for(var t=0;t<e.length;t++){var n=e[t];this.$treeSelect.append('<option value="'+n.id+'">'+l.LanguageMap.getValue(n.getLabel())+"</option>")}this.updateTreeViewOptions()},t.prototype.databind=function(){this.databindThumbsView(),this.databindTreeView(),this.databindGalleryView()},t.prototype.updateTreeViewOptions=function(){var e=this.getTree();e&&(this.isCollection()&&this.extension.helper.treeHasNavDates(e)?this.$treeViewOptions.show():this.$treeViewOptions.hide(),this.$treeSelect.find("option").length?this.$treeSelect.show():this.$treeSelect.hide())},t.prototype.sortByDate=function(){this.treeSortType=c.TreeSortType.DATE,this.treeView.treeData=this.getTreeData(),this.treeView.databind(),this.selectCurrentTreeNode(),this.$sortByDateButton.addClass("on"),this.$sortByVolumeButton.removeClass("on"),this.resize()},t.prototype.sortByVolume=function(){this.treeSortType=c.TreeSortType.NONE,this.treeView.treeData=this.getTreeData(),this.treeView.databind(),this.selectCurrentTreeNode(),this.$sortByDateButton.removeClass("on"),this.$sortByVolumeButton.addClass("on"),this.resize()},t.prototype.isCollection=function(){var e=this.getTree();if(e)return e.data.type===l.TreeNodeType.COLLECTION.toString();throw new Error("Tree not available")},t.prototype.databindTreeView=function(){this.treeView&&(this.treeView.treeData=this.getTreeData(),this.treeView.databind(),this.selectCurrentTreeNode())},t.prototype.getTreeData=function(){return{autoExpand:this._isTreeAutoExpanded(),branchNodesExpandOnClick:Utils.Bools.getBool(this.config.options.branchNodesExpandOnClick,!0),branchNodesSelectable:Utils.Bools.getBool(this.config.options.branchNodesSelectable,!1),helper:this.extension.helper,topRangeIndex:this.getSelectedTopRangeIndex(),treeSortType:this.treeSortType}},t.prototype._isTreeAutoExpanded=function(){var e=Utils.Bools.getBool(this.config.options.autoExpandTreeEnabled,!1),t=this.config.options.autoExpandTreeIfFewerThan||0;if(e){var n=this.extension.helper.getFlattenedTree();if(n&&n.length<t)return!0}return!1},t.prototype.updateTreeTabByCanvasIndex=function(){var e=this.extension.helper.getTopRanges();if(e.length>1){var t=this.getCurrentCanvasTopRangeIndex();if(-1===t)return;var n=e[t];this.setTreeTabTitle(l.LanguageMap.getValue(n.getLabel()))}else this.setTreeTabTitle(this.content.index)},t.prototype.setTreeTabTitle=function(e){this.$treeButton.text(e),this.$treeButton.prop("title",e)},t.prototype.updateTreeTabBySelection=function(){var e=null,t=this.extension.helper.getTopRanges();t.length>1&&(e=this.treeView?this.getSelectedTree().text():l.LanguageMap.getValue(t[0].getLabel())),e?this.setTreeTabTitle(e):this.setTreeTabTitle(this.content.index)},t.prototype.getViewingHint=function(){return this.extension.helper.getViewingHint()},t.prototype.getViewingDirection=function(){return this.extension.helper.getViewingDirection()},t.prototype.createThumbsView=function(){this.thumbsView=new s.ThumbsView(this.$thumbsView),this.databindThumbsView()},t.prototype.databindThumbsView=function(){if(this.thumbsView){var e,t,n=this.getViewingHint(),i=this.getViewingDirection();!i||i.toString()!==u.ViewingDirection.LEFT_TO_RIGHT.toString()&&i.toString()!==u.ViewingDirection.RIGHT_TO_LEFT.toString()?n&&n.toString()===u.ViewingHint.PAGED.toString()?(e=this.config.options.twoColThumbWidth,t=this.config.options.twoColThumbHeight):(e=this.config.options.oneColThumbWidth,t=this.config.options.oneColThumbHeight):(e=this.config.options.twoColThumbWidth,t=this.config.options.twoColThumbHeight);var o=this.extension.helper.getThumbs(e,t);i&&i.toString()===u.ViewingDirection.BOTTOM_TO_TOP.toString()&&o.reverse();var r=this.extension.annotations;if(r&&r.length)for(var s=function(e){var t=r[e],n=o.en().where(function(e){return e.index===t.canvasIndex}).first();if(n){var i=$.extend(!0,{},n.data);i.searchResults=t.rects.length,n.data=i}},a=0;a<r.length;a++)s(a);this.thumbsView.thumbs=o,this.thumbsView.databind()}},t.prototype.createGalleryView=function(){this.galleryView=new i.GalleryView(this.$galleryView),this.galleryView.galleryData=this.getGalleryData(),this.galleryView.setup(),this.databindGalleryView()},t.prototype.databindGalleryView=function(){this.galleryView&&(this.galleryView.galleryData=this.getGalleryData(),this.galleryView.databind())},t.prototype.getGalleryData=function(){return{helper:this.extension.helper,chunkedResizingThreshold:this.config.options.galleryThumbChunkedResizingThreshold,content:this.config.content,debug:!1,imageFadeInDuration:300,initialZoom:6,minLabelWidth:20,pageModeEnabled:this.isPageModeEnabled(),scrollStopDuration:100,searchResults:this.extension.annotations,sizingEnabled:Modernizr.inputtypes.range,thumbHeight:this.config.options.galleryThumbHeight,thumbLoadPadding:this.config.options.galleryThumbLoadPadding,thumbWidth:this.config.options.galleryThumbWidth,viewingDirection:this.getViewingDirection()}},t.prototype.isPageModeEnabled=function(){return"function"==typeof this.extension.getMode?Utils.Bools.getBool(this.config.options.pageModeEnabled,!0)&&this.extension.getMode().toString()===r.Mode.page.toString():Utils.Bools.getBool(this.config.options.pageModeEnabled,!0)},t.prototype.getSelectedTree=function(){return this.$treeSelect.find(":selected")},t.prototype.getSelectedTopRangeIndex=function(){var e=this.getSelectedTree().index();return-1===e&&(e=0),e},t.prototype.getTree=function(){var e=this.getSelectedTopRangeIndex();return this.extension.helper.getTree(e,c.TreeSortType.NONE)},t.prototype.toggleFinish=function(){if(e.prototype.toggleFinish.call(this),this.isUnopened){var t=Utils.Bools.getBool(this.config.options.treeEnabled,!0),n=Utils.Bools.getBool(this.config.options.thumbsEnabled,!0),i=this.getTree();i&&i.nodes.length||(t=!1),t&&n||this.$tabs.hide(),n&&this.defaultToThumbsView()?this.openThumbsView():t&&this.openTreeView()}},t.prototype.defaultToThumbsView=function(){var e=Utils.Bools.getBool(this.config.options.defaultToTreeEnabled,!1),t=this.config.options.defaultToTreeIfGreaterThan||0,n=this.getTree();return e&&n&&n.nodes.length>t?!1:!0},t.prototype.expandFullStart=function(){e.prototype.expandFullStart.call(this),this.component.publish(n.BaseEvents.LEFTPANEL_EXPAND_FULL_START)},t.prototype.expandFullFinish=function(){e.prototype.expandFullFinish.call(this),this.$treeButton.hasClass("on")?this.openTreeView():this.$thumbsButton.hasClass("on")&&this.openThumbsView(),this.component.publish(n.BaseEvents.LEFTPANEL_EXPAND_FULL_FINISH)},t.prototype.collapseFullStart=function(){e.prototype.collapseFullStart.call(this),this.component.publish(n.BaseEvents.LEFTPANEL_COLLAPSE_FULL_START)},t.prototype.collapseFullFinish=function(){e.prototype.collapseFullFinish.call(this),this.$thumbsButton.hasClass("on")&&this.openThumbsView(),this.component.publish(n.BaseEvents.LEFTPANEL_COLLAPSE_FULL_FINISH)},t.prototype.openTreeView=function(){this.isTreeViewOpen=!0,this.isThumbsViewOpen=!1,this.treeView||this.createTreeView(),this.$treeButton.addClass("on"),this.$thumbsButton.removeClass("on"),this.treeView.show(),this.thumbsView&&this.thumbsView.hide(),this.galleryView&&this.galleryView.hide(),this.updateTreeViewOptions(),this.selectCurrentTreeNode(),this.resize(),this.treeView.resize(),this.component.publish(n.BaseEvents.OPEN_TREE_VIEW)},t.prototype.openThumbsView=function(){this.isTreeViewOpen=!1,this.isThumbsViewOpen=!0,this.thumbsView||this.createThumbsView(),this.isFullyExpanded&&!this.galleryView&&this.createGalleryView(),this.$treeButton.removeClass("on"),this.$thumbsButton.addClass("on"),this.treeView&&this.treeView.hide(),this.$treeSelect.hide(),this.$treeViewOptions.hide(),this.resize(),this.isFullyExpanded?(this.thumbsView.hide(),this.galleryView&&this.galleryView.show(),this.galleryView&&this.galleryView.resize()):(this.galleryView&&this.galleryView.hide(),this.thumbsView.show(),this.thumbsView.resize()),this.component.publish(n.BaseEvents.OPEN_THUMBS_VIEW)},t.prototype.selectTopRangeIndex=function(e){this.$treeSelect.prop("selectedIndex",e)},t.prototype.getCurrentCanvasTopRangeIndex=function(){var e=-1,t=this.extension.getCurrentCanvasRange();return t&&(e=Number(t.path.split("/")[0])),e},t.prototype.selectCurrentTreeNode=function(){"uv-seadragon-extension"===this.extension.name?this.selectCurrentTreeNodeByCanvas():this.selectCurrentTreeNodeByRange()},t.prototype.selectCurrentTreeNodeByRange=function(){if(this.treeView){var e=this.extension.helper.getCurrentRange(),t=null;e&&e.treeNode&&(t=this.treeView.getNodeById(e.treeNode.id)),t?this.treeView.selectNode(t):this.selectTreeNodeByManifest()}},t.prototype.selectCurrentTreeNodeByCanvas=function(){if(this.treeView){var e=null,t=this.getCurrentCanvasTopRangeIndex(),n=this.getSelectedTopRangeIndex(),i=t===n,o=null;-1!==t&&(o=this.extension.getCurrentCanvasRange(),o&&o.treeNode&&(e=this.treeView.getNodeById(o.treeNode.id))),e&&i?this.treeView.selectNode(e):(o=this.extension.helper.getCurrentRange(),o&&o.treeNode&&(e=this.treeView.getNodeById(o.treeNode.id)),e?this.treeView.selectNode(e):this.selectTreeNodeByManifest())}},t.prototype.selectTreeNodeByManifest=function(){var e=this,t=this.extension.helper.collectionIndex,n=this.extension.helper.manifestIndex,i=this.treeView.getAllNodes(),o=!1;i.map(function(i){i.isCollection()&&i.data.index===t&&(e.treeView.selectNode(i),e.treeView.expandNode(i,!0),o=!0),i.isManifest()&&i.data.index===n&&(e.treeView.selectNode(i),o=!0)}),o||this.treeView.deselectCurrentNode()},t.prototype.resize=function(){e.prototype.resize.call(this),this.$tabsContent.height(this.$main.height()-(this.$tabs.is(":visible")?this.$tabs.height():0)-this.$tabsContent.verticalPadding()),this.$views.height(this.$tabsContent.height()-this.$options.outerHeight())},t}(o.LeftPanel);t.ContentLeftPanel=h}),define("modules/uv-shared-module/DownloadOption",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n;!function(e){e.CANVAS_RENDERINGS="canvasRenderings",e.CURRENT_VIEW="currentView",e.ENTIRE_DOCUMENT_AS_PDF="entireDocumentAsPdf",e.ENTIRE_DOCUMENT_AS_TEXT="entireDocumentAsText",e.ENTIRE_FILE_AS_ORIGINAL="entireFileAsOriginal",e.IMAGE_RENDERINGS="imageRenderings",e.MANIFEST_RENDERINGS="manifestRenderings",e.RANGE_RENDERINGS="rangeRenderings",e.SELECTION="selection",e.UNKNOWN="unknown",e.WHOLE_IMAGE_HIGH_RES="wholeImageHighRes",e.WHOLE_IMAGE_LOW_RES="wholeImageLowRes",e.WHOLE_IMAGES_HIGH_RES="wholeImagesHighRes"}(n=t.DownloadOption||(t.DownloadOption={}))});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-dialogues-module/DownloadDialogue",["require","exports","../uv-shared-module/BaseEvents","../uv-shared-module/Dialogue","../uv-shared-module/DownloadOption","manifesto.js"],function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("downloadDialogue"),e.prototype.create.call(this),this.openCommand=n.BaseEvents.SHOW_DOWNLOAD_DIALOGUE,this.closeCommand=n.BaseEvents.HIDE_DOWNLOAD_DIALOGUE,this.component.subscribe(this.openCommand,function(e){t.open(e)}),this.component.subscribe(this.closeCommand,function(){t.close()}),this.$title=$("<h1>"+this.content.title+"</h1>"),this.$content.append(this.$title),this.$noneAvailable=$('<div class="noneAvailable">'+this.content.noneAvailable+"</div>"),this.$content.append(this.$noneAvailable),this.$downloadOptions=$('<ol class="options"></ol>'),this.$content.append(this.$downloadOptions),this.$footer=$('<div class="footer"></div>'),this.$content.append(this.$footer),this.$termsOfUseButton=$('<a href="#">'+this.extension.data.config.content.termsOfUse+"</a>"),this.$footer.append(this.$termsOfUseButton),this.$termsOfUseButton.onPressed(function(){t.component.publish(n.BaseEvents.SHOW_TERMS_OF_USE)}),this.$element.hide(),this.updateTermsOfUseButton()},t.prototype.addEntireFileDownloadOptions=function(){if(this.isDownloadOptionAvailable(o.DownloadOption.ENTIRE_FILE_AS_ORIGINAL)){this.$downloadOptions.empty();for(var e=this.extension.helper.getCurrentCanvas(),t=!1,n=e.getRenderings(),i=0;i<n.length;i++){var s=n[i],a=s.getFormat(),u="";a&&(u=a.toString()),this.addEntireFileDownloadOption(s.id,r.LanguageMap.getValue(s.getLabel()),u),t=!0}if(!t){for(var l=!1,c=e.getContent(),i=0;i<c.length;i++){var h=c[i],p=h.getBody();if(p.length){var u=p[0].getFormat();u&&(this.addEntireFileDownloadOption(p[0].id,"",u.toString()),l=!0)}}l||this.addEntireFileDownloadOption(e.id,"","")}}},t.prototype.addEntireFileDownloadOption=function(e,t,n){var i;i=n?Utils.Files.simplifyMimeType(n):this.getFileExtension(e),t||(t=this.content.entireFileAsOriginal),i&&(t+=" ("+i+")"),this.$downloadOptions.append('<li><a href="'+e+'" target="_blank" download tabindex="0">'+t+"</li>")},t.prototype.resetDynamicDownloadOptions=function(){this.renderingUrls=[],this.renderingUrlsCount=0,this.$downloadOptions.find("li.dynamic").remove()},t.prototype.getDownloadOptionsForRenderings=function(e,t,n){var i=[];if(!e)return i;for(var o=e.getRenderings(),s=0;s<o.length;s++){var a=o[s];if(a){var u=r.LanguageMap.getValue(a.getLabel(),this.extension.getLocale()),l="downloadOption"+ ++this.renderingUrlsCount;u?u+=" ({0})":u=t;var c=Utils.Files.simplifyMimeType(a.getFormat().toString());u=Utils.Strings.format(u,c),this.renderingUrls[l]=a.id;var h=$('<li class="option dynamic"><input id="'+l+'" data-mime="'+c+'" title="'+u+'" type="radio" name="downloadOptions" tabindex="0" /><label for="'+l+'">'+u+"</label></li>");i.push({type:n,button:h})}}return i},t.prototype.getSelectedOption=function(){return this.$downloadOptions.find("li.option input:checked")},t.prototype.getCurrentResourceId=function(){var e=this.extension.helper.getCurrentCanvas();return e.externalResource.data.id},t.prototype.getCurrentResourceFormat=function(){var e=this.getCurrentResourceId();return e.substr(e.lastIndexOf(".")+1).toLowerCase()},t.prototype.updateNoneAvailable=function(){this.$downloadOptions.find("li:visible").length?this.$noneAvailable.hide():this.$noneAvailable.show()},t.prototype.updateTermsOfUseButton=function(){var e=this.extension.helper.getRequiredStatement();Utils.Bools.getBool(this.extension.data.config.options.termsOfUseEnabled,!1)&&e&&e.value?this.$termsOfUseButton.show():this.$termsOfUseButton.hide()},t.prototype.getFileExtension=function(e){var t=e.split(".").pop();return t.length>5||-1!==t.indexOf("/")?null:t},t.prototype.isMediaDownloadEnabled=function(){return this.extension.helper.isUIEnabled("mediaDownload")},t.prototype.isDownloadOptionAvailable=function(e){switch(e){case o.DownloadOption.ENTIRE_FILE_AS_ORIGINAL:return this.isMediaDownloadEnabled()}return!0},t.prototype.close=function(){e.prototype.close.call(this)},t.prototype.resize=function(){this.setDockedPosition()},t}(i.Dialogue);t.DownloadDialogue=s});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("extensions/uv-av-extension/DownloadDialogue",["require","exports","../../modules/uv-dialogues-module/DownloadDialogue","../../modules/uv-shared-module/DownloadOption","../../modules/uv-shared-module/BaseEvents"],function(e,t,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("downloadDialogue"),e.prototype.create.call(this),this.$entireFileAsOriginal=$('<li class="option single"><input id="'+i.DownloadOption.ENTIRE_FILE_AS_ORIGINAL+'" type="radio" name="downloadOptions" tabindex="0" /><label id="'+i.DownloadOption.ENTIRE_FILE_AS_ORIGINAL+'label" for="'+i.DownloadOption.ENTIRE_FILE_AS_ORIGINAL+'"></label></li>'),this.$downloadOptions.append(this.$entireFileAsOriginal),this.$entireFileAsOriginal.hide(),this.$downloadButton=$('<a class="btn btn-primary" href="#" tabindex="0">'+this.content.download+"</a>"),this.$buttons.prepend(this.$downloadButton),this.$imageOptionsContainer=$('<li class="group image"></li>'),this.$imageOptions=$("<ul></ul>"),this.$imageOptionsContainer.append(this.$imageOptions),this.$canvasOptionsContainer=$('<li class="group canvas"></li>'),this.$canvasOptions=$("<ul></ul>"),this.$canvasOptionsContainer.append(this.$canvasOptions),this.$manifestOptionsContainer=$('<li class="group manifest"></li>'),this.$manifestOptions=$("<ul></ul>"),this.$manifestOptionsContainer.append(this.$manifestOptions);var n=this;this.$downloadButton.find(".btn-primary").on("click",function(){t.component.publish(o.BaseEvents.EXIT_FULLSCREEN)}),this.$downloadButton.on("click",function(e){e.preventDefault();var r=n.getSelectedOption(),s=r.attr("id"),a=r.attr("title"),u=i.DownloadOption.UNKNOWN;if(t.renderingUrls[s])window.open(t.renderingUrls[s]);else{var l=t.getCurrentResourceId();window.open(l)}t.component.publish(o.BaseEvents.DOWNLOAD,{type:u,label:a}),t.close()})},t.prototype._isAdaptive=function(){var e=this.getCurrentResourceFormat();return"mpd"===e||"m3u8"===e},t.prototype.open=function(t){e.prototype.open.call(this,t);var n=this.extension.helper.getCurrentCanvas();if(this.isDownloadOptionAvailable(i.DownloadOption.ENTIRE_FILE_AS_ORIGINAL)&&!this._isAdaptive()){var o=this.$entireFileAsOriginal.find("input"),r=this.$entireFileAsOriginal.find("label"),s=Utils.Strings.format(this.content.entireFileAsOriginalWithFormat,this.getCurrentResourceFormat());r.text(s),o.prop("title",s),this.$entireFileAsOriginal.show()}if(this.resetDynamicDownloadOptions(),this.isDownloadOptionAvailable(i.DownloadOption.RANGE_RENDERINGS)&&n.ranges&&n.ranges.length)for(var a=0;a<n.ranges.length;a++){var u=n.ranges[a],l=this.getDownloadOptionsForRenderings(u,this.content.entireFileAsOriginal,i.DownloadOption.CANVAS_RENDERINGS);this.addDownloadOptionsForRenderings(l)}if(this.isDownloadOptionAvailable(i.DownloadOption.IMAGE_RENDERINGS)){var c=n.getImages();c.length&&this.$downloadOptions.append(this.$imageOptionsContainer);for(var a=0;a<c.length;a++){var l=this.getDownloadOptionsForRenderings(c[a].getResource(),this.content.entireFileAsOriginal,i.DownloadOption.IMAGE_RENDERINGS);this.addDownloadOptionsForRenderings(l)}}if(this.isDownloadOptionAvailable(i.DownloadOption.CANVAS_RENDERINGS)){var l=this.getDownloadOptionsForRenderings(n,this.content.entireFileAsOriginal,i.DownloadOption.CANVAS_RENDERINGS);l.length&&(this.$downloadOptions.append(this.$canvasOptionsContainer),this.addDownloadOptionsForRenderings(l))}if(this.isDownloadOptionAvailable(i.DownloadOption.MANIFEST_RENDERINGS)){var l=this.getDownloadOptionsForRenderings(this.extension.helper.getCurrentSequence(),this.content.entireDocument,i.DownloadOption.MANIFEST_RENDERINGS);l.length||(l=this.getDownloadOptionsForRenderings(this.extension.helper.manifest,this.content.entireDocument,i.DownloadOption.MANIFEST_RENDERINGS)),l.length&&(this.$downloadOptions.append(this.$manifestOptionsContainer),this.addDownloadOptionsForRenderings(l))}this.$downloadOptions.length&&this.$entireFileAsOriginal.hide(),this.$downloadOptions.find("li.option:visible").length?(this.$downloadOptions.find("li.option input:visible:first").prop("checked",!0),this.$noneAvailable.hide(),this.$downloadButton.show()):(this.$noneAvailable.show(),this.$downloadButton.hide()),this.resize()},t.prototype.addDownloadOptionsForRenderings=function(e){var t=this;e.forEach(function(e){switch(e.type){case i.DownloadOption.IMAGE_RENDERINGS:t.$imageOptions.append(e.button);break;case i.DownloadOption.CANVAS_RENDERINGS:t.$canvasOptions.append(e.button);break;case i.DownloadOption.MANIFEST_RENDERINGS:t.$manifestOptions.append(e.button)}})},t.prototype.isDownloadOptionAvailable=function(e){return this.isMediaDownloadEnabled()},t}(n.DownloadDialogue);t.DownloadDialogue=r});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-shared-module/FooterPanel",["require","exports","./BaseEvents","./BaseView"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("footerPanel"),e.prototype.create.call(this),this.component.subscribe(n.BaseEvents.TOGGLE_FULLSCREEN,function(){t.updateFullScreenButton()}),this.component.subscribe(n.BaseEvents.METRIC_CHANGED,function(){t.updateMinimisedButtons(),t.updateMoreInfoButton()}),this.component.subscribe(n.BaseEvents.SETTINGS_CHANGED,function(){t.updateDownloadButton()}),this.$options=$('<div class="options"></div>'),this.$element.append(this.$options),this.$feedbackButton=$('\n          <button class="feedback btn imageBtn" title="'+this.content.feedback+'" tabindex="0">\n            <i class="uv-icon uv-icon-feedback" aria-hidden="true"></i>'+this.content.feedback+"\n          </button>\n        "),this.$options.prepend(this.$feedbackButton),this.$openButton=$('\n          <button class="open btn imageBtn" title="'+this.content.open+'" tabindex="0">\n            <i class="uv-icon-open" aria-hidden="true"></i>'+this.content.open+"\n          </button>\n        "),this.$options.prepend(this.$openButton),this.$bookmarkButton=$('\n          <button class="bookmark btn imageBtn" title="'+this.content.bookmark+'" tabindex="0">\n            <i class="uv-icon uv-icon-bookmark" aria-hidden="true"></i>'+this.content.bookmark+"\n          </button>\n        "),this.$options.prepend(this.$bookmarkButton),this.$shareButton=$('\n          <button class="share btn imageBtn" title="'+this.content.share+'" tabindex="0">\n            <i class="uv-icon uv-icon-share" aria-hidden="true"></i>'+this.content.share+"\n          </button>\n        "),this.$options.append(this.$shareButton),this.$embedButton=$('\n          <button class="embed btn imageBtn" title="'+this.content.embed+'" tabindex="0">\n            <i class="uv-icon uv-icon-embed" aria-hidden="true"></i>'+this.content.embed+"\n          </button>\n        "),this.$options.append(this.$embedButton),this.$downloadButton=$('\n          <button class="download btn imageBtn" title="'+this.content.download+'" tabindex="0">\n            <i class="uv-icon uv-icon-download" aria-hidden="true"></i>'+this.content.download+"\n          </button>\n        "),this.$options.prepend(this.$downloadButton),this.$moreInfoButton=$('\n          <button class="moreInfo btn imageBtn" title="'+this.content.moreInfo+'" tabindex="0">\n            <i class="uv-icon uv-icon-more-info" aria-hidden="true"></i>'+this.content.moreInfo+"\n          </button>\n        "),this.$options.prepend(this.$moreInfoButton),this.$fullScreenBtn=$('\n          <button class="fullScreen btn imageBtn" title="'+this.content.fullScreen+'" tabindex="0">\n            <i class="uv-icon uv-icon-fullscreen" aria-hidden="true"></i>'+this.content.fullScreen+"\n          </button>\n        "),this.$options.append(this.$fullScreenBtn),this.$openButton.onPressed(function(){t.component.publish(n.BaseEvents.OPEN)}),this.$feedbackButton.onPressed(function(){t.component.publish(n.BaseEvents.FEEDBACK)}),this.$bookmarkButton.onPressed(function(){t.component.publish(n.BaseEvents.BOOKMARK)}),this.$shareButton.onPressed(function(){t.component.publish(n.BaseEvents.SHOW_SHARE_DIALOGUE,t.$shareButton)}),this.$embedButton.onPressed(function(){t.component.publish(n.BaseEvents.SHOW_EMBED_DIALOGUE,t.$embedButton)}),this.$downloadButton.onPressed(function(){t.component.publish(n.BaseEvents.SHOW_DOWNLOAD_DIALOGUE,t.$downloadButton)}),this.$moreInfoButton.onPressed(function(){t.component.publish(n.BaseEvents.SHOW_MOREINFO_DIALOGUE,t.$moreInfoButton)}),this.$fullScreenBtn.on("click",function(e){e.preventDefault(),t.component.publish(n.BaseEvents.TOGGLE_FULLSCREEN)}),Utils.Bools.getBool(this.options.embedEnabled,!0)||this.$embedButton.hide(),this.updateMoreInfoButton(),this.updateOpenButton(),this.updateFeedbackButton(),this.updateBookmarkButton(),this.updateEmbedButton(),this.updateDownloadButton(),this.updateFullScreenButton(),this.updateShareButton(),this.updateMinimisedButtons()},t.prototype.updateMinimisedButtons=function(){return Utils.Bools.getBool(this.options.minimiseButtons,!1)?void this.$options.addClass("minimiseButtons"):void(this.extension.isDesktopMetric()?this.$options.removeClass("minimiseButtons"):this.$options.addClass("minimiseButtons"))},t.prototype.updateMoreInfoButton=function(){var e=Utils.Bools.getBool(this.options.moreInfoEnabled,!1);!e||this.extension.isDesktopMetric()||this.extension.isCatchAllMetric()?this.$moreInfoButton.hide():this.$moreInfoButton.show()},t.prototype.updateOpenButton=function(){var e=Utils.Bools.getBool(this.options.openEnabled,!1);e&&Utils.Documents.isInIFrame()?this.$openButton.show():this.$openButton.hide()},t.prototype.updateFullScreenButton=function(){return Utils.Bools.getBool(this.options.fullscreenEnabled,!0)&&Utils.Documents.supportsFullscreen()?(this.extension.data.isLightbox&&this.$fullScreenBtn.addClass("lightbox"),void(this.extension.isFullScreen()?(this.$fullScreenBtn.switchClass("fullScreen","exitFullscreen"),this.$fullScreenBtn.find("i").switchClass("uv-icon-fullscreen","uv-icon-exit-fullscreen"),this.$fullScreenBtn.attr("title",this.content.exitFullScreen),$(this.$fullScreenBtn[0].firstChild.nextSibling.nextSibling).replaceWith(this.content.exitFullScreen)):(this.$fullScreenBtn.switchClass("exitFullscreen","fullScreen"),this.$fullScreenBtn.find("i").switchClass("uv-icon-exit-fullscreen","uv-icon-fullscreen"),this.$fullScreenBtn.attr("title",this.content.fullScreen),$(this.$fullScreenBtn[0].firstChild.nextSibling.nextSibling).replaceWith(this.content.fullScreen)))):void this.$fullScreenBtn.hide()},t.prototype.updateEmbedButton=function(){this.extension.helper.isUIEnabled("embed")&&Utils.Bools.getBool(this.options.embedEnabled,!1)?this.extension.isMobile()||this.$embedButton.show():this.$embedButton.hide()},t.prototype.updateShareButton=function(){this.extension.helper.isUIEnabled("share")&&Utils.Bools.getBool(this.options.shareEnabled,!0)?this.$shareButton.show():this.$shareButton.hide()},t.prototype.updateDownloadButton=function(){var e=Utils.Bools.getBool(this.options.downloadEnabled,!0);e?this.$downloadButton.show():this.$downloadButton.hide()},t.prototype.updateFeedbackButton=function(){var e=Utils.Bools.getBool(this.options.feedbackEnabled,!1);e?this.$feedbackButton.show():this.$feedbackButton.hide()},t.prototype.updateBookmarkButton=function(){var e=Utils.Bools.getBool(this.options.bookmarkEnabled,!1);e?this.$bookmarkButton.show():this.$bookmarkButton.hide()},t.prototype.resize=function(){e.prototype.resize.call(this)},t}(i.BaseView);t.FooterPanel=o});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,
new i)}}();define("modules/uv-avmobilefooterpanel-module/MobileFooter",["require","exports","../uv-shared-module/FooterPanel"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){this.setConfig("mobileFooterPanel"),e.prototype.create.call(this)},t.prototype.resize=function(){e.prototype.resize.call(this),this.$options.css("left",Math.floor(this.$element.width()/2-this.$options.width()/2))},t}(n.FooterPanel);t.FooterPanel=i}),define("modules/uv-shared-module/Information",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.message=e,this.actions=t}return e}();t.Information=n}),define("modules/uv-shared-module/InformationAction",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e}();t.InformationAction=n}),define("modules/uv-shared-module/InformationFactory",["require","exports","./BaseEvents","./Information","./InformationAction","./InformationType"],function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e){this.extension=e}return e.prototype.Get=function(e){var t=this;switch(e.informationType){case r.InformationType.AUTH_CORS_ERROR:return new i.Information(this.extension.data.config.content.authCORSError,[]);case r.InformationType.DEGRADED_RESOURCE:var s=[],a=new o.InformationAction,u=e.param.loginService.getConfirmLabel();u||(u=this.extension.data.config.content.fallbackDegradedLabel),a.label=u;var l=e.param;a.action=function(){l.authHoldingPage=window.open("","_blank"),t.extension.component.publish(n.BaseEvents.HIDE_INFORMATION),t.extension.component.publish(n.BaseEvents.OPEN_EXTERNAL_RESOURCE,[[l]])},s.push(a);var c=e.param.loginService.getServiceLabel();return c||(c=this.extension.data.config.content.fallbackDegradedMessage),new i.Information(c,s)}},e}();t.InformationFactory=s});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-shared-module/HeaderPanel",["require","exports","./BaseEvents","./BaseView","../uv-shared-module/InformationFactory"],function(e,t,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(t){return e.call(this,t,!1,!1)||this}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("headerPanel"),e.prototype.create.call(this),this.component.subscribe(n.BaseEvents.SHOW_INFORMATION,function(e){t.showInformation(e)}),this.component.subscribe(n.BaseEvents.HIDE_INFORMATION,function(){t.hideInformation()}),this.$options=$('<div class="options"></div>'),this.$element.append(this.$options),this.$centerOptions=$('<div class="centerOptions"></div>'),this.$options.append(this.$centerOptions),this.$rightOptions=$('<div class="rightOptions"></div>'),this.$options.append(this.$rightOptions),this.$localeToggleButton=$('<a class="localeToggle" tabindex="0"></a>'),this.$rightOptions.append(this.$localeToggleButton),this.$settingsButton=$('\n          <button class="btn imageBtn settings" tabindex="0" title="'+this.content.settings+'">\n            <i class="uv-icon-settings" aria-hidden="true"></i>'+this.content.settings+"\n          </button>\n        "),this.$settingsButton.attr("title",this.content.settings),this.$rightOptions.append(this.$settingsButton),this.$informationBox=$('<div class="informationBox" aria-hidden="true">                                     <div class="message"></div>                                     <div class="actions"></div>                                     <button type="button" class="close" aria-label="Close">                                         <span aria-hidden="true">&#215;</span>                                    </button>                                   </div>'),this.$element.append(this.$informationBox),this.$informationBox.hide(),this.$informationBox.find(".close").attr("title",this.content.close),this.$informationBox.find(".close").on("click",function(e){e.preventDefault(),t.component.publish(n.BaseEvents.HIDE_INFORMATION)}),this.$localeToggleButton.on("click",function(){t.extension.changeLocale(String(t.$localeToggleButton.data("locale")))}),this.$settingsButton.onPressed(function(){t.component.publish(n.BaseEvents.SHOW_SETTINGS_DIALOGUE)}),Utils.Bools.getBool(this.options.centerOptionsEnabled,!0)||this.$centerOptions.hide(),this.updateLocaleToggle(),this.updateSettingsButton()},t.prototype.updateLocaleToggle=function(){if(!this.localeToggleIsVisible())return void this.$localeToggleButton.hide();var e=this.extension.getAlternateLocale(),t=e.name.split("-")[0].toUpperCase();this.$localeToggleButton.data("locale",e.name),this.$localeToggleButton.attr("title",e.label),this.$localeToggleButton.text(t)},t.prototype.updateSettingsButton=function(){var e=Utils.Bools.getBool(this.options.settingsButtonEnabled,!0);e?this.$settingsButton.show():this.$settingsButton.hide()},t.prototype.localeToggleIsVisible=function(){var e=this.extension.data.locales;return e?e.length>1&&Utils.Bools.getBool(this.options.localeToggleEnabled,!1):!1},t.prototype.showInformation=function(e){var t=new o.InformationFactory(this.extension);this.information=t.Get(e),this.component.publish(n.BaseEvents.INFO_DISPLAYED,[this.information]);var i=this.$informationBox.find(".message");i.html(this.information.message).find("a").attr("target","_top");var r=this.$informationBox.find(".actions");r.empty();for(var s=0;s<this.information.actions.length;s++){var a=this.information.actions[s],u=$('<a href="#" class="btn btn-default">'+a.label+"</a>");u.on("click",a.action),r.append(u)}this.$informationBox.attr("aria-hidden","false"),this.$informationBox.show(),this.$element.addClass("showInformation"),this.extension.resize()},t.prototype.hideInformation=function(){this.$element.removeClass("showInformation"),this.$informationBox.attr("aria-hidden","true"),this.$informationBox.hide(),this.extension.resize()},t.prototype.getSettings=function(){return this.extension.getSettings()},t.prototype.updateSettings=function(e){this.extension.updateSettings(e),this.component.publish(n.BaseEvents.UPDATE_SETTINGS,e)},t.prototype.resize=function(){e.prototype.resize.call(this);var t=this.$element.width(),n=t/2,i=this.$centerOptions.outerWidth(),o=n-i/2;if(this.$centerOptions.css({left:o}),this.$informationBox.is(":visible")){var r=this.$informationBox.find(".actions"),s=this.$informationBox.find(".message");s.width(Math.floor(this.$element.width())-Math.ceil(s.horizontalMargins())-Math.ceil(r.outerWidth(!0))-Math.ceil(this.$informationBox.find(".close").outerWidth(!0))-2),s.text(this.information.message)}this.extension.width()<this.extension.data.config.options.minWidthBreakPoint?this.localeToggleIsVisible()&&this.$localeToggleButton.hide():this.localeToggleIsVisible()&&this.$localeToggleButton.show()},t}(i.BaseView);t.HeaderPanel=r}),!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("IIIFMetadataComponent",[],t):"object"==typeof exports?exports.IIIFMetadataComponent=t():e.IIIFMetadataComponent=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:i})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(t.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)t.d(i,o,function(t){return e[t]}.bind(null,o));return i},t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r,s=n(2),a=n(3),u=n(4);!function(e){e.LINES="lines",e.CHARS="chars"}(r=t.LimitType||(t.LimitType={}));var l=function(e){function t(t){var n=e.call(this,t)||this;return n._data=n.data(),n._data=n.options.data,n._init(),n._resize(),n}return o(t,e),t.prototype._init=function(){return e.prototype._init.call(this),this._$element=$(this.el),this._$metadataGroupTemplate=$('<div class="group">          <div class="header"></div>          <div class="items"></div>      </div>'),this._$metadataItemTemplate=$('<div class="item">          <div class="label"></div>          <div class="values"></div>      </div>'),this._$metadataItemValueTemplate=$('<div class="value"></div>'),this._$metadataItemURIValueTemplate=$('<a class="value" href="" target="_blank"></a>'),this._$copyTextTemplate=$('<div class="copyText" alt="'+this.options.data.content.copyToClipboard+'" title="'+this.options.data.content.copyToClipboard+'">        <div class="copiedText">'+this.options.data.content.copiedToClipboard+" </div>        </div>"),this._$metadataGroups=$('<div class="groups"></div>'),this._$element.append(this._$metadataGroups),this._$noData=$('<div class="noData">'+this.options.data.content.noData+"</div>"),this._$element.append(this._$noData),!0},t.prototype.data=function(){return{aggregateValues:"",canvases:null,canvasDisplayOrder:"",metadataGroupOrder:"",canvasExclude:"",canvasLabels:"",content:{attribution:"Attribution",canvasHeader:"About the canvas",copiedToClipboard:"Copied to clipboard",copyToClipboard:"Copy to clipboard",description:"Description",imageHeader:"About the image",less:"less",license:"License",logo:"Logo",manifestHeader:"About the item",more:"more",noData:"No data to display",rangeHeader:"About the range",sequenceHeader:"About the sequence"},copiedMessageDuration:2e3,copyToClipboardEnabled:!1,helper:null,licenseFormatter:null,limit:4,limitType:r.LINES,limitToRange:!1,manifestDisplayOrder:"",manifestExclude:"",range:null,rtlLanguageCodes:"ar, ara, dv, div, he, heb, ur, urd",sanitizer:function(e){return e},showAllLanguages:!1}},t.prototype._getManifestGroup=function(){return this._metadataGroups.filter(function(e){return e.resource.isManifest()})[0]},t.prototype._getCanvasGroups=function(){return this._metadataGroups.filter(function(e){return e.resource.isCanvas()})},t.prototype.set=function(e){var t=this;if(this._data=Object.assign(this._data,e),this._data&&this._data.helper){var n,i={canvases:this._data.canvases,licenseFormatter:this._data.licenseFormatter,range:this._data.range};if(this._metadataGroups=this._data.helper.getMetadata(i),this._data.manifestDisplayOrder&&((n=this._getManifestGroup()).items=this._sortItems(n.items,this._readCSV(this._data.manifestDisplayOrder))),this._data.canvasDisplayOrder&&this._getCanvasGroups().forEach(function(e,n){e.items=t._sortItems(e.items,t._readCSV(t._data.canvasDisplayOrder))}),this._data.metadataGroupOrder&&(this._metadataGroups=this._sortGroups(this._metadataGroups,this._readCSV(this._data.metadataGroupOrder))),this._data.canvasLabels&&this._label(this._getCanvasGroups(),this._readCSV(this._data.canvasLabels,!1)),this._data.manifestExclude&&((n=this._getManifestGroup()).items=this._exclude(n.items,this._readCSV(this._data.manifestExclude))),this._data.canvasExclude&&this._getCanvasGroups().forEach(function(e,n){e.items=t._exclude(e.items,t._readCSV(t._data.canvasExclude))}),this._data.limitToRange){var o=[];this._metadataGroups.forEach(function(e,t){e.resource.isRange()&&o.push(e)}),o.length&&(this._metadataGroups=o)}this._render()}},t.prototype._sortItems=function(e,t){var n=this,i=[],o=e.slice(0);return t.forEach(function(e,t){var r=o.filter(function(t){return n._normalise(t.getLabel())===e})[0];if(r){i.push(r);var s=o.indexOf(r);s>-1&&o.splice(s,1)}}),o.forEach(function(e,t){i.push(e)}),i},t.prototype._sortGroups=function(e,t){var n=[],i=e.slice(0);return t.forEach(function(e,t){var o=i.filter(function(t){return t.resource.getIIIFResourceType().toLowerCase()==e.toLowerCase()})[0];if(o){n.push(o);var r=i.indexOf(o);r>-1&&i.splice(r,1)}}),n},t.prototype._label=function(e,t){e.forEach(function(e,n){e.label=t[n]})},t.prototype._exclude=function(e,t){var n=this;return t.forEach(function(t,i){var o=e.filter(function(e){return n._normalise(e.getLabel())===t})[0];if(o){var r=e.indexOf(o);r>-1&&e.splice(r,1)}}),e},t.prototype._normalise=function(e){return e?e.toLowerCase().replace(/ /g,""):null},t.prototype._render=function(){var e=this;this._metadataGroups.length?(this._$noData.hide(),this._$metadataGroups.empty(),this._metadataGroups.forEach(function(t,n){var i=e._buildMetadataGroup(t);e._$metadataGroups.append(i);var o=i.find(".value");e._data.limit&&e._data.content&&(e._data.limitType===r.LINES?o.toggleExpandTextByLines(e._data.limit,e._data.content.less,e._data.content.more,function(){}):e._data.limitType===r.CHARS&&o.ellipsisHtmlFixed(e._data.limit,function(){}))})):this._$noData.show()},t.prototype._buildMetadataGroup=function(e){var t=this._$metadataGroupTemplate.clone(),n=t.find(">.header");if(this._data.content)if(e.resource.isManifest()&&this._data.content.manifestHeader)(o=this._sanitize(this._data.content.manifestHeader))&&n.html(o);else if(e.resource.isSequence()&&this._data.content.sequenceHeader)(o=this._sanitize(this._data.content.sequenceHeader))&&n.html(o);else if(e.resource.isRange()&&this._data.content.rangeHeader)(o=this._sanitize(this._data.content.rangeHeader))&&n.html(o);else if(e.resource.isCanvas()&&(e.label||this._data.content.canvasHeader)){var i=e.label||this._data.content.canvasHeader;n.html(this._sanitize(i))}else if(e.resource.isAnnotation()&&this._data.content.imageHeader){var o;(o=this._sanitize(this._data.content.imageHeader))&&n.html(o)}n.text()||n.hide();for(var r=t.find(".items"),s=0;s<e.items.length;s++){var a=e.items[s],u=this._buildMetadataItem(a);r.append(u)}return t},t.prototype._buildMetadataItem=function(e){var t,n=this._$metadataItemTemplate.clone(),i=n.find(".label"),o=n.find(".values"),r=e.getLabel(),s=r,a=new RegExp("/w+:(/?/?)[^s]+/gm","i");if(this._data.content&&s&&e.isRootLevel)switch(s.toLowerCase()){case"attribution":s=this._data.content.attribution;break;case"description":s=this._data.content.description;break;case"license":s=this._data.content.license;break;case"logo":s=this._data.content.logo}if(s=this._sanitize(s),i.html(s),this._addReadingDirection(i,this._getLabelLocale(e)),n.addClass(u.Strings.toCssClass(s)),r&&"license"===r.toLowerCase()&&null!==a.exec(e.value[0].value))t=this._buildMetadataItemURIValue(e.value[0].value),o.append(t);else if(this._data.showAllLanguages&&e.value&&e.value.length>1)for(var l=0;l<e.value.length;l++){var h=e.value[l];t=this._buildMetadataItemValue(h.value,h.locale),o.append(t)}else{var p=this._getValueLocale(e),d=!1;for(l=0;l<e.value.length;l++){var h=e.value[l];p.toLowerCase()===h.locale.toLowerCase()&&(d=!0,t=this._buildMetadataItemValue(h.value,h.locale),o.append(t))}d||(h=e.value[0])&&(t=this._buildMetadataItemValue(h.value,h.locale),o.append(t))}this._data.copyToClipboardEnabled&&u.Clipboard.supportsCopy()&&i.text()&&this._addCopyButton(n,i,o);var f=this;return n.on("click","a.iiif-viewer-link",function(e){e.preventDefault();var t=$(e.target),n=t.attr("data-uv-navigate")||t.prop("href");f.fire(c.IIIF_VIEWER_LINK_CLICKED,n)}),n.on("click","[data-uv-navigate]",function(e){e.preventDefault();var t=$(e.target).attr("data-uv-navigate")||null;t&&f.fire(c.IIIF_VIEWER_LINK_CLICKED,t)}),n},t.prototype._getLabelLocale=function(e){if(!this._data||!this._data.helper)return"";var t=this._data.helper.options.locale;if(e.label.length){var n=e.label[0].locale;if(n.toLowerCase()!==t.toLowerCase())return n}return t},t.prototype._getValueLocale=function(e){return this._data&&this._data.helper?this._data.helper.options.locale:""},t.prototype._buildMetadataItemValue=function(e,t){e=(e=this._sanitize(e)).replace("\n","<br>");var n=this._$metadataItemValueTemplate.clone();return n.html(e),n.find("a").each(function(){var e=$(this);e.hasClass("iiif-viewer-link")||e.prop("target","_blank")}),t&&this._addReadingDirection(n,t),n},t.prototype._buildMetadataItemURIValue=function(e){e=this._sanitize(e);var t=this._$metadataItemURIValueTemplate.clone();return t.prop("href",e),t.text(e),t},t.prototype._addReadingDirection=function(e,t){t=s.Utils.getInexactLocale(t),this._readCSV(this._data.rtlLanguageCodes).filter(function(e){return e===t}).length>0&&(e.prop("dir","rtl"),e.addClass("rtl"))},t.prototype._addCopyButton=function(e,t,n){var i=this._$copyTextTemplate.clone(),o=i.children();t.append(i),u.Device.isTouch()?i.show():(e.on("mouseenter",function(){i.show()}),e.on("mouseleave",function(){i.hide()}),i.on("mouseleave",function(){o.hide()}));var r=this,s=n.text();i.on("click",function(e){r._copyItemValues(i,s)})},t.prototype._copyItemValues=function(e,t){u.Clipboard.copy(t);var n=e.find(".copiedText");n.show(),setTimeout(function(){n.hide()},this._data.copiedMessageDuration)},t.prototype._readCSV=function(e,t){void 0===t&&(t=!0);var n=[];if(e&&(n=e.split(","),t))for(var i=0;i<n.length;i++)n[i]=this._normalise(n[i]);return n},t.prototype._sanitize=function(e){return this._data.sanitizer?this._data.sanitizer(e):null},t.prototype._resize=function(){},t}(a.BaseComponent);t.MetadataComponent=l;var c=function(){function e(){}return e.IIIF_VIEWER_LINK_CLICKED="iiifViewerLinkClicked",e}();t.Events=c},function(e,t,n){"undefined"!=typeof self&&self,e.exports=function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:i})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(t.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)t.d(i,o,function(t){return e[t]}.bind(null,o));return i},t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=4)}([function(e,t,n){"use strict";function i(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),i(n(6)),i(n(7)),i(n(8)),i(n(9)),i(n(10)),i(n(11)),i(n(12)),i(n(13)),i(n(14)),i(n(15)),i(n(16)),i(n(17)),i(n(18)),i(n(19)),i(n(20)),i(n(21)),i(n(22)),i(n(23)),i(n(24)),i(n(25)),i(n(26)),i(n(27)),i(n(28)),i(n(29)),i(n(30)),i(n(31)),i(n(32)),i(n(2))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.BOOKMARKING="oa:bookmarking",e.CLASSIFYING="oa:classifying",e.COMMENTING="oa:commenting",e.DESCRIBING="oa:describing",e.EDITING="oa:editing",e.HIGHLIGHTING="oa:highlighting",e.IDENTIFYING="oa:identifying",e.LINKING="oa:linking",e.MODERATING="oa:moderating",e.PAINTING="sc:painting",e.QUESTIONING="oa:questioning",e.REPLYING="oa:replying",e.TAGGING="oa:tagging",e.TRANSCRIBING="oad:transcribing"}(t.AnnotationMotivation||(t.AnnotationMotivation={})),function(e){e.AUTO_ADVANCE="auto-advance",e.CONTINUOUS="continuous",e.FACING_PAGES="facing-pages",e.HIDDEN="hidden",e.INDIVIDUALS="individuals",e.MULTI_PART="multi-part",e.NO_NAV="no-nav",e.NON_PAGED="non-paged",e.PAGED="paged",e.REPEAT="repeat",e.SEQUENCE="sequence",e.THUMBNAIL_NAV="thumbnail-nav",e.TOGETHER="together",e.UNORDERED="unordered"}(t.Behavior||(t.Behavior={})),function(e){e.CANVAS="canvas",e.CHOICE="choice",e.CONTENT_AS_TEXT="contentastext",e.DOCUMENT="document",e.IMAGE="image",e.MOVING_IMAGE="movingimage",e.PDF="pdf",e.PHYSICAL_OBJECT="physicalobject",e.SOUND="sound",e.TEXTUALBODY="textualbody",e.VIDEO="video"}(t.ExternalResourceType||(t.ExternalResourceType={})),function(e){e.ANNOTATION="annotation",e.CANVAS="canvas",e.COLLECTION="collection",e.MANIFEST="manifest",e.RANGE="range",e.SEQUENCE="sequence"}(t.IIIFResourceType||(t.IIIFResourceType={})),function(e){e.AUDIO_MP4="audio/mp4",e.CORTO="application/corto",e.DRACO="application/draco",e.GLTF="model/gltf+json",e.JPG="image/jpeg",e.M3U8="application/vnd.apple.mpegurl",e.MP3="audio/mp3",e.MPEG_DASH="application/dash+xml",e.OBJ="text/plain",e.PDF="application/pdf",e.PLY="application/ply",e.THREEJS="application/vnd.threejs+json",e.VIDEO_MP4="video/mp4",e.WEBM="video/webm"}(t.MediaType||(t.MediaType={})),function(e){e.DOC="application/msword",e.DOCX="application/vnd.openxmlformats-officedocument.wordprocessingml.document",e.PDF="application/pdf"}(t.RenderingFormat||(t.RenderingFormat={})),function(e){e.IMAGE_0_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0",e.IMAGE_0_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1",e.IMAGE_0_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2",e.IMAGE_0_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0",e.IMAGE_0_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1",e.IMAGE_0_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2",e.IMAGE_1_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",e.IMAGE_1_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",e.IMAGE_1_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",e.IMAGE_1_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",e.IMAGE_1_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",e.IMAGE_1_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",e.IMAGE_1_LEVEL_0="http://iiif.io/api/image/1/level0.json",e.IMAGE_1_PROFILE_LEVEL_0="http://iiif.io/api/image/1/profiles/level0.json",e.IMAGE_1_LEVEL_1="http://iiif.io/api/image/1/level1.json",e.IMAGE_1_PROFILE_LEVEL_1="http://iiif.io/api/image/1/profiles/level1.json",e.IMAGE_1_LEVEL_2="http://iiif.io/api/image/1/level2.json",e.IMAGE_1_PROFILE_LEVEL_2="http://iiif.io/api/image/1/profiles/level2.json",e.IMAGE_2_LEVEL_0="http://iiif.io/api/image/2/level0.json",e.IMAGE_2_PROFILE_LEVEL_0="http://iiif.io/api/image/2/profiles/level0.json",e.IMAGE_2_LEVEL_1="http://iiif.io/api/image/2/level1.json",e.IMAGE_2_PROFILE_LEVEL_1="http://iiif.io/api/image/2/profiles/level1.json",e.IMAGE_2_LEVEL_2="http://iiif.io/api/image/2/level2.json",e.IMAGE_2_PROFILE_LEVEL_2="http://iiif.io/api/image/2/profiles/level2.json",e.AUTH_0_CLICK_THROUGH="http://iiif.io/api/auth/0/login/clickthrough",e.AUTH_0_LOGIN="http://iiif.io/api/auth/0/login",e.AUTH_0_LOGOUT="http://iiif.io/api/auth/0/logout",e.AUTH_0_RESTRICTED="http://iiif.io/api/auth/0/login/restricted",e.AUTH_0_TOKEN="http://iiif.io/api/auth/0/token",e.AUTH_1_CLICK_THROUGH="http://iiif.io/api/auth/1/clickthrough",e.AUTH_1_EXTERNAL="http://iiif.io/api/auth/1/external",e.AUTH_1_KIOSK="http://iiif.io/api/auth/1/kiosk",e.AUTH_1_LOGIN="http://iiif.io/api/auth/1/login",e.AUTH_1_LOGOUT="http://iiif.io/api/auth/1/logout",e.AUTH_1_PROBE="http://iiif.io/api/auth/1/probe",e.AUTH_1_TOKEN="http://iiif.io/api/auth/1/token",e.SEARCH_0="http://iiif.io/api/search/0/search",e.SEARCH_0_AUTO_COMPLETE="http://iiif.io/api/search/0/autocomplete",e.SEARCH_1="http://iiif.io/api/search/1/search",e.SEARCH_1_AUTO_COMPLETE="http://iiif.io/api/search/1/autocomplete",e.TRACKING_EXTENSIONS="http://universalviewer.io/tracking-extensions-profile",e.UI_EXTENSIONS="http://universalviewer.io/ui-extensions-profile",e.PRINT_EXTENSIONS="http://universalviewer.io/print-extensions-profile",e.SHARE_EXTENSIONS="http://universalviewer.io/share-extensions-profile",e.OTHER_MANIFESTATIONS="http://iiif.io/api/otherManifestations.json",e.IXIF="http://wellcomelibrary.org/ld/ixif/0/alpha.json"}(t.ServiceProfile||(t.ServiceProfile={})),function(e){e.BOTTOM_TO_TOP="bottom-to-top",e.LEFT_TO_RIGHT="left-to-right",e.RIGHT_TO_LEFT="right-to-left",e.TOP_TO_BOTTOM="top-to-bottom"}(t.ViewingDirection||(t.ViewingDirection={})),function(e){e.CONTINUOUS="continuous",e.INDIVIDUALS="individuals",e.NON_PAGED="non-paged",e.PAGED="paged",e.TOP="top"}(t.ViewingHint||(t.ViewingHint={}))},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function s(e){try{u(i.next(e))}catch(e){r(e)}}function a(e){try{u(i["throw"](e))}catch(e){r(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}u((i=i.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){function n(e){return function(n){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(r=2&e[0]?o["return"]:e[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,e[1])).done)return r;switch(o=0,r&&(e=[2&e[0],r.value]),e[0]){case 0:case 1:r=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!r||e[1]>r[0]&&e[1]<r[3])){a.label=e[1];break}if(6===e[0]&&a.label<r[1]){a.label=r[1],r=e;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(e);break}r[2]&&a.ops.pop(),a.trys.pop();continue}e=t.call(n,a)}catch(n){e=[6,n],o=0}finally{i=r=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,n])}}var i,o,r,s,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(1),a=n(33);n(34);var u=function(){function e(){}return e.getMediaType=function(e){return(e=(e=e.toLowerCase()).split(";")[0]).trim()},e.getImageQuality=function(e){return e===s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1||e===s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2||e===s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_1||e===s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2||e===s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1||e===s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2||e===s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1||e===s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2||e===s.ServiceProfile.IMAGE_1_LEVEL_1||e===s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1||e===s.ServiceProfile.IMAGE_1_LEVEL_2||e===s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2?"native":"default"},e.getInexactLocale=function(e){return-1!==e.indexOf("-")?e.substr(0,e.indexOf("-")):e},e.getLocalisedValue=function(e,t){if(!Array.isArray(e))return e;for(var n=0;n<e.length;n++){var i=e[n];if(t===i["@language"])return i["@value"]}var o=t.substr(0,t.indexOf("-"));for(n=0;n<e.length;n++){var r=e[n];if(r["@language"]===o)return r["@value"]}return null},e.generateTreeNodeIds=function(t,n){var i;void 0===n&&(n=0),i=t.parentNode?t.parentNode.id+"-"+n:"0",t.id=i;for(var o=0;o<t.nodes.length;o++){var r=t.nodes[o];e.generateTreeNodeIds(r,o)}},e.normaliseType=function(e){return-1!==(e=e.toLowerCase()).indexOf(":")?e.split(":")[1]:e},e.normaliseUrl=function(e){return-1!==(e=e.substr(e.indexOf("://"))).indexOf("#")&&(e=e.split("#")[0]),e},e.normalisedUrlsMatch=function(t,n){return e.normaliseUrl(t)===e.normaliseUrl(n)},e.isImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_PROFILE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_PROFILE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_PROFILE_LEVEL_2))},e.isLevel0ImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_LEVEL_0)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_PROFILE_LEVEL_0))},e.isLevel1ImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_LEVEL_1)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_PROFILE_LEVEL_1))},e.isLevel2ImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_LEVEL_2)||e.normalisedUrlsMatch(t,s.ServiceProfile.IMAGE_2_PROFILE_LEVEL_2))},e.parseManifest=function(e,t){return r.Deserialiser.parse(e,t)},e.checkStatus=function(e){if(e.ok)return e;var t=new Error(e.statusText);return t.response=e,Promise.reject(t)},e.loadManifest=function(t){return new Promise(function(n){fetch(t).then(e.checkStatus).then(function(e){
return e.json()}).then(function(e){n(e)})})},e.loadExternalResourcesAuth1=function(t,n,i,o,r,s,a,u){return new Promise(function(l,c){var h=t.map(function(t){return e.loadExternalResourceAuth1(t,n,i,o,r,s,a,u)});Promise.all(h).then(function(){l(t)})["catch"](function(e){c(e)})})},e.loadExternalResourceAuth1=function(t,n,r,s,u,l,c,h){return i(this,void 0,void 0,function(){var i;return o(this,function(o){switch(o.label){case 0:return[4,s(t)];case 1:return(i=o.sent())?[4,t.getData(i)]:[3,6];case 2:return o.sent(),t.status!==a.OK?[3,3]:[2,t];case 3:return[4,e.doAuthChain(t,n,r,u,l,c,h)];case 4:o.sent(),o.label=5;case 5:if(t.status===a.OK||t.status===a.MOVED_TEMPORARILY)return[2,t];throw e.createAuthorizationFailedError();case 6:return[4,t.getData()];case 7:return o.sent(),t.status!==a.MOVED_TEMPORARILY&&t.status!==a.UNAUTHORIZED?[3,9]:[4,e.doAuthChain(t,n,r,u,l,c,h)];case 8:o.sent(),o.label=9;case 9:if(t.status===a.OK||t.status===a.MOVED_TEMPORARILY)return[2,t];throw e.createAuthorizationFailedError()}})})},e.doAuthChain=function(t,n,r,s,u,l,c){return i(this,void 0,void 0,function(){var i,h,p,d,f,g,v,_;return o(this,function(o){switch(o.label){case 0:return t.isAccessControlled()?((i=t.externalService)&&(i.options=t.options),(h=t.kioskService)&&(h.options=t.options),(p=t.clickThroughService)&&(p.options=t.options),(d=t.loginService)&&(d.options=t.options),t.isResponseHandled||t.status!==a.MOVED_TEMPORARILY?[3,2]:[4,l(t)]):[2,t];case 1:return o.sent(),[2,t];case 2:return f=null,g=null,(f=i)?(g=f,[4,e.attemptResourceWithToken(t,r,f)]):[3,4];case 3:return o.sent(),[2,t];case 4:return(f=h)?(g=f,(v=n(f))?[4,s(v)]:[3,7]):[3,7];case 5:return o.sent(),[4,e.attemptResourceWithToken(t,r,f)];case 6:return o.sent(),[2,t];case 7:return(f=p)?(g=f,[4,u(t,f)]):[3,11];case 8:return(_=o.sent())?[4,s(_)]:[3,11];case 9:return o.sent(),[4,e.attemptResourceWithToken(t,r,f)];case 10:return o.sent(),[2,t];case 11:return(f=d)?(g=f,[4,u(t,f)]):[3,15];case 12:return(_=o.sent())?[4,s(_)]:[3,15];case 13:return o.sent(),[4,e.attemptResourceWithToken(t,r,f)];case 14:return o.sent(),[2,t];case 15:return g&&c(t,g),[2]}})})},e.attemptResourceWithToken=function(e,t,n){return i(this,void 0,void 0,function(){var i,r;return o(this,function(o){switch(o.label){case 0:return(i=n.getService(s.ServiceProfile.AUTH_1_TOKEN))?[4,t(e,i)]:[3,3];case 1:return(r=o.sent())&&r.accessToken?[4,e.getData(r)]:[3,3];case 2:return o.sent(),[2,e];case 3:return[2]}})})},e.loadExternalResourcesAuth09=function(t,n,i,o,r,s,a,u,l,c){return new Promise(function(h,p){var d=t.map(function(t){return e.loadExternalResourceAuth09(t,n,i,o,r,s,a,u,l,c)});Promise.all(d).then(function(){h(t)})["catch"](function(e){p(e)})})},e.loadExternalResourceAuth09=function(t,n,i,o,r,s,u,l,c,h){return new Promise(function(p,d){h&&h.pessimisticAccessControl?t.getData().then(function(){t.isAccessControlled()?t.clickThroughService?(p(i(t)),p(o(t))):r(t).then(function(){s(t,!0).then(function(n){t.getData(n).then(function(){p(c(t))})["catch"](function(t){d(e.createInternalServerError(t))})})["catch"](function(t){d(e.createInternalServerError(t))})})["catch"](function(t){d(e.createInternalServerError(t))}):p(t)})["catch"](function(t){d(e.createInternalServerError(t))}):l(t,n).then(function(h){h?t.getData(h).then(function(){t.status===a.OK?p(c(t)):e.authorize(t,n,i,o,r,s,u,l).then(function(){p(c(t))})["catch"](function(t){d(e.createAuthorizationFailedError())})})["catch"](function(t){d(e.createAuthorizationFailedError())}):e.authorize(t,n,i,o,r,s,u,l).then(function(){p(c(t))})["catch"](function(t){d(e.createAuthorizationFailedError())})})["catch"](function(t){d(e.createAuthorizationFailedError())})})},e.createError=function(e,t){var n=new Error;return n.message=t,n.name=String(e),n},e.createAuthorizationFailedError=function(){return e.createError(r.StatusCode.AUTHORIZATION_FAILED,"Authorization failed")},e.createRestrictedError=function(){return e.createError(r.StatusCode.RESTRICTED,"Restricted")},e.createInternalServerError=function(t){return e.createError(r.StatusCode.INTERNAL_SERVER_ERROR,t)},e.authorize=function(t,n,i,o,r,s,u,l){return new Promise(function(c,h){t.getData().then(function(){t.isAccessControlled()?l(t,n).then(function(l){l?t.getData(l).then(function(){t.status===a.OK?c(t):e.showAuthInteraction(t,n,i,o,r,s,u,c,h)})["catch"](function(t){h(e.createInternalServerError(t))}):s(t,!1).then(function(l){l?u(t,l,n).then(function(){t.getData(l).then(function(){t.status===a.OK?c(t):e.showAuthInteraction(t,n,i,o,r,s,u,c,h)})["catch"](function(t){h(e.createInternalServerError(t))})})["catch"](function(t){h(e.createInternalServerError(t))}):e.showAuthInteraction(t,n,i,o,r,s,u,c,h)})})["catch"](function(t){h(e.createInternalServerError(t))}):c(t)})})},e.showAuthInteraction=function(t,n,i,o,r,s,u,l,c){t.status!==a.MOVED_TEMPORARILY||t.isResponseHandled?t.clickThroughService&&!t.isResponseHandled?i(t).then(function(){s(t,!0).then(function(i){u(t,i,n).then(function(){t.getData(i).then(function(){l(t)})["catch"](function(t){c(e.createInternalServerError(t))})})["catch"](function(t){c(e.createInternalServerError(t))})})["catch"](function(t){c(e.createInternalServerError(t))})}):r(t).then(function(){s(t,!0).then(function(i){u(t,i,n).then(function(){t.getData(i).then(function(){l(t)})["catch"](function(t){c(e.createInternalServerError(t))})})["catch"](function(t){c(e.createInternalServerError(t))})})["catch"](function(t){c(e.createInternalServerError(t))})}):l(t)},e.getService=function(e,t){for(var n=this.getServices(e),i=0;i<n.length;i++){var o=n[i];if(o.getProfile()===t)return o}return null},e.getResourceById=function(t,n){return e.traverseAndFind(t.__jsonld,"@id",n)},e.traverseAndFind=function(t,n,i){if(t.hasOwnProperty(n)&&t[n]===i)return t;for(var o=0;o<Object.keys(t).length;o++)if("object"==typeof t[Object.keys(t)[o]]){var r=e.traverseAndFind(t[Object.keys(t)[o]],n,i);if(null!=r)return r}},e.getServices=function(e){var t,n=[];if(!(t=e.__jsonld?e.__jsonld.service:e.service))return n;Array.isArray(t)||(t=[t]);for(var i=0;i<t.length;i++){var o=t[i];if("string"==typeof o){var s=this.getResourceById(e.options.resource,o);s&&n.push(new r.Service(s.__jsonld||s,e.options))}else n.push(new r.Service(o,e.options))}return n},e.getTemporalComponent=function(e){var t=/t=([^&]+)/g.exec(e),n=null;return t&&t[1]&&(n=t[1].split(",")),n},e}();t.Utils=u},function(e,t,n){"use strict";n.r(t),t["default"]=function(e,t){return t=t||{},new Promise(function(n,i){var o=new XMLHttpRequest,r=[],s=[],a={},u=function(){return{ok:2==(o.status/100|0),statusText:o.statusText,status:o.status,url:o.responseURL,text:function(){return Promise.resolve(o.responseText)},json:function(){return Promise.resolve(JSON.parse(o.responseText))},blob:function(){return Promise.resolve(new Blob([o.response]))},clone:u,headers:{keys:function(){return r},entries:function(){return s},get:function(e){return a[e.toLowerCase()]},has:function(e){return e.toLowerCase()in a}}}};for(var l in o.open(t.method||"get",e,!0),o.onload=function(){o.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(e,t,n){r.push(t=t.toLowerCase()),s.push([t,n]),a[t]=a[t]?a[t]+","+n:n}),n(u())},o.onerror=i,o.withCredentials="include"==t.credentials,t.headers)o.setRequestHeader(l,t.headers[l]);o.send(t.body||null)})}},function(e,t,n){e.exports=n(5)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(0));var i=n(2);t.loadManifest=function(e){return i.Utils.loadManifest(e)},t.parseManifest=function(e,t){return i.Utils.parseManifest(e,t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.__jsonld=e,this.context=this.getProperty("context"),this.id=this.getProperty("id")}return e.prototype.getProperty=function(e){var t=null;return this.__jsonld&&((t=this.__jsonld[e])||(t=this.__jsonld["@"+e])),t},e}();t.JSONLDResource=i},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(1),a=function(e){function t(t,n){var i=e.call(this,t)||this;return i.options=n,i}return o(t,e),t.prototype.getIIIFResourceType=function(){return r.Utils.normaliseType(this.getProperty("type"))},t.prototype.getLabel=function(){var e=this.getProperty("label");return e?r.LanguageMap.parse(e,this.options.locale):[]},t.prototype.getDefaultLabel=function(){return r.LanguageMap.getValue(this.getLabel())},t.prototype.getMetadata=function(){var e=this.getProperty("metadata"),t=[];if(!e)return t;for(var n=0;n<e.length;n++){var i=e[n],o=new r.LabelValuePair(this.options.locale);o.parse(i),t.push(o)}return t},t.prototype.getRendering=function(e){for(var t=this.getRenderings(),n=0;n<t.length;n++){var i=t[n];if(i.getFormat()===e)return i}return null},t.prototype.getRenderings=function(){var e,t=[];if(!(e=this.__jsonld?this.__jsonld.rendering:this.rendering))return t;Array.isArray(e)||(e=[e]);for(var n=0;n<e.length;n++){var i=e[n];t.push(new r.Rendering(i,this.options))}return t},t.prototype.getService=function(e){return r.Utils.getService(this,e)},t.prototype.getServices=function(){return r.Utils.getServices(this)},t.prototype.getThumbnail=function(){var e=this.getProperty("thumbnail");return Array.isArray(e)&&(e=e[0]),e?new r.Thumbnail(e,this.options):null},t.prototype.isAnnotation=function(){return this.getIIIFResourceType()===s.IIIFResourceType.ANNOTATION},t.prototype.isCanvas=function(){return this.getIIIFResourceType()===s.IIIFResourceType.CANVAS},t.prototype.isCollection=function(){return this.getIIIFResourceType()===s.IIIFResourceType.COLLECTION},t.prototype.isManifest=function(){return this.getIIIFResourceType()===s.IIIFResourceType.MANIFEST},t.prototype.isRange=function(){return this.getIIIFResourceType()===s.IIIFResourceType.RANGE},t.prototype.isSequence=function(){return this.getIIIFResourceType()===s.IIIFResourceType.SEQUENCE},t}(r.JSONLDResource);t.ManifestResource=a},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=function(e){function t(t,n){return e.call(this,t,n)||this}return o(t,e),t.prototype.getFormat=function(){var e=this.getProperty("format");return e?e.toLowerCase():null},t.prototype.getResources=function(){var e=[];if(!this.__jsonld.resources)return e;for(var t=0;t<this.__jsonld.resources.length;t++){var n=this.__jsonld.resources[t],i=new r.Annotation(n,this.options);e.push(i)}return e},t.prototype.getType=function(){var e=this.getProperty("type");return e?r.Utils.normaliseType(e):null},t.prototype.getWidth=function(){return this.getProperty("width")},t.prototype.getHeight=function(){return this.getProperty("height")},t.prototype.getMaxWidth=function(){return this.getProperty("maxWidth")},t.prototype.getMaxHeight=function(){return this.getProperty("maxHeight")?null:this.getMaxWidth()},t}(r.ManifestResource);t.Resource=s},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(1),a=function(e){function t(t,n){var i=e.call(this,t,n)||this;i.index=-1,i.isLoaded=!1;var o={defaultLabel:"-",locale:"en-GB",resource:i,pessimisticAccessControl:!1};return i.options=Object.assign(o,n),i}return o(t,e),t.prototype.getAttribution=function(){var e=this.getProperty("attribution");return e?r.LanguageMap.parse(e,this.options.locale):[]},t.prototype.getDescription=function(){var e=this.getProperty("description");return e?r.LanguageMap.parse(e,this.options.locale):[]},t.prototype.getIIIFResourceType=function(){return r.Utils.normaliseType(this.getProperty("type"))},t.prototype.getLogo=function(){var e=this.getProperty("logo");return e?"string"==typeof e?e:(Array.isArray(e)&&e.length&&(e=e[0]),e["@id"]||e.id):null},t.prototype.getLicense=function(){return r.Utils.getLocalisedValue(this.getProperty("license"),this.options.locale)},t.prototype.getNavDate=function(){return new Date(this.getProperty("navDate"))},t.prototype.getRelated=function(){return this.getProperty("related")},t.prototype.getSeeAlso=function(){return this.getProperty("seeAlso")},t.prototype.getTrackingLabel=function(){var e=this.getService(s.ServiceProfile.TRACKING_EXTENSIONS);return e?e.getProperty("trackingLabel"):""},t.prototype.getDefaultTree=function(){return this.defaultTree=new r.TreeNode("root"),this.defaultTree.data=this,this.defaultTree},t.prototype.getRequiredStatement=function(){var e=null,t=this.getProperty("requiredStatement");if(t)(e=new r.LabelValuePair(this.options.locale)).parse(t);else{var n=this.getAttribution();n&&((e=new r.LabelValuePair(this.options.locale)).value=n)}return e},t.prototype.isCollection=function(){return this.getIIIFResourceType()===s.IIIFResourceType.COLLECTION},t.prototype.isManifest=function(){return this.getIIIFResourceType()===s.IIIFResourceType.MANIFEST},t.prototype.load=function(){var e=this;return new Promise(function(t){if(e.isLoaded)t(e);else{var n=e.options;n.navDate=e.getNavDate();var i=e.__jsonld.id;i||(i=e.__jsonld["@id"]),r.Utils.loadManifest(i).then(function(i){e.parentLabel=r.LanguageMap.getValue(e.getLabel(),n.locale);var o=r.Deserialiser.parse(i,n);(e=Object.assign(e,o)).index=n.index,t(e)})}})},t}(r.ManifestResource);t.IIIFResource=a},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=function(e){function t(t,n){return e.call(this,t,n)||this}return o(t,e),t.prototype.getBody=function(){var e=[],t=this.getProperty("body");if(t)if(Array.isArray(t))for(var n=0;n<t.length;n++)if((s=t[n]).items)for(var i=0;i<s.items.length;i++){var o=s.items[i];e.push(new r.AnnotationBody(o,this.options))}else e.push(new r.AnnotationBody(s,this.options));else if(t.items)for(n=0;n<t.items.length;n++){var s=t.items[n];e.push(new r.AnnotationBody(s,this.options))}else e.push(new r.AnnotationBody(t,this.options));return e},t.prototype.getMotivation=function(){return this.getProperty("motivation")||null},t.prototype.getOn=function(){return this.getProperty("on")},t.prototype.getTarget=function(){return this.getProperty("target")},t.prototype.getResource=function(){return new r.Resource(this.getProperty("resource"),this.options)},t}(r.ManifestResource);t.Annotation=s},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=function(e){function t(t,n){return e.call(this,t,n)||this}return o(t,e),t.prototype.getFormat=function(){var e=this.getProperty("format");return e?r.Utils.getMediaType(e):null},t.prototype.getType=function(){return this.getProperty("type")?r.Utils.normaliseType(this.getProperty("type")):null},t.prototype.getWidth=function(){return this.getProperty("width")},t.prototype.getHeight=function(){return this.getProperty("height")},t}(r.ManifestResource);t.AnnotationBody=s},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=function(e){function t(t,n,i){var o=e.call(this,n)||this;return o.label=t,o.options=i,o}return o(t,e),t.prototype.getIIIFResourceType=function(){return r.Utils.normaliseType(this.getProperty("type"))},t.prototype.getLabel=function(){return this.label},t.prototype.getResources=function(){var e=this;return this.getProperty("resources").map(function(t){return new r.Annotation(t,e.options)})},t.prototype.load=function(){var e=this;return new Promise(function(t,n){if(e.isLoaded)t(e);else{var i=e.__jsonld.id;i||(i=e.__jsonld["@id"]),r.Utils.loadManifest(i).then(function(n){e.__jsonld=n,e.context=e.getProperty("context"),e.id=e.getProperty("id"),e.isLoaded=!0,t(e)})["catch"](n)}})},t}(r.JSONLDResource);t.AnnotationList=s},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(t,n){return e.call(this,t,n)||this}return o(t,e),t.prototype.getItems=function(){return this.getProperty("items")},t}(n(0).ManifestResource);t.AnnotationPage=r},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=function(e){function t(t,n){return e.call(this,t,n)||this}return o(t,e),t.prototype.getCanonicalImageUri=function(e){var t,n=null,i="default",o=e;if(this.externalResource&&this.externalResource.data&&this.externalResource.data["@id"])n=this.externalResource.data["@id"],o||(o=this.externalResource.data.width),this.externalResource.data["@context"]&&(this.externalResource.data["@context"].indexOf("/1.0/context.json")>-1||this.externalResource.data["@context"].indexOf("/1.1/context.json")>-1||this.externalResource.data["@context"].indexOf("/1/context.json")>-1)&&(i="native");else{var s=this.getImages();if(s&&s.length){var a=s[0].getResource(),u=a.getServices();if(o||(o=a.getWidth()),u.length){var l=u[0];n=l.id,i=r.Utils.getImageQuality(l.getProfile())}else if(o===a.getWidth())return a.id}if(!n){var c=this.getProperty("thumbnail");if(c){if("string"==typeof c)return c;if(c["@id"])return c["@id"];if(c.length)return c[0].id}}}return t=o+",",n&&n.endsWith("/")&&(n=n.substr(0,n.length-1)),[n,"full",t,0,i+".jpg"].join("/")},t.prototype.getMaxDimensions=function(){var e,t=null;return this.externalResource&&this.externalResource.data&&this.externalResource.data.profile&&(e=this.externalResource.data.profile,Array.isArray(e)&&(e=e.filter(function(e){return e.maxWidth})[0])&&(t=new r.Size(e.maxWidth,e.maxHeight?e.maxHeight:e.maxWidth))),t},t.prototype.getContent=function(){var e=[],t=this.__jsonld.items||this.__jsonld.content;if(!t)return e;var n=null;if(t.length&&(n=new r.AnnotationPage(t[0],this.options)),!n)return e;for(var i=n.getItems(),o=0;o<i.length;o++){var s=i[o],a=new r.Annotation(s,this.options);e.push(a)}return e},t.prototype.getDuration=function(){return this.getProperty("duration")},t.prototype.getImages=function(){var e=[];if(!this.__jsonld.images)return e;for(var t=0;t<this.__jsonld.images.length;t++){var n=this.__jsonld.images[t],i=new r.Annotation(n,this.options);e.push(i)}return e},t.prototype.getIndex=function(){return this.getProperty("index")},t.prototype.getOtherContent=function(){var e=this,t=(Array.isArray(this.getProperty("otherContent"))?this.getProperty("otherContent"):[this.getProperty("otherContent")]).filter(function(e){return e&&"string"==typeof(t=e["@type"])&&t.toLowerCase()==t.toLowerCase();var t}).map(function(t,n){return new r.AnnotationList(t.label||"Annotation list "+n,t,e.options)}).map(function(e){return e.load()});return Promise.all(t)},t.prototype.getWidth=function(){return this.getProperty("width")},t.prototype.getHeight=function(){return this.getProperty("height")},t}(r.Resource);t.Canvas=s},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),s=n(0),a=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.items=[],i._collections=null,i._manifests=null,t.__collection=i,i}return o(t,e),t.prototype.getCollections=function(){return this._collections?this._collections:this._collections=this.items.filter(function(e){return e.isCollection()})},t.prototype.getManifests=function(){return this._manifests?this._manifests:this._manifests=this.items.filter(function(e){return e.isManifest()})},t.prototype.getCollectionByIndex=function(e){for(var t,n=this.getCollections(),i=0;i<n.length;i++){var o=n[i];o.index===e&&(t=o)}if(t)return t.options.index=e,t.load();throw new Error("Collection index not found")},t.prototype.getManifestByIndex=function(e){for(var t,n=this.getManifests(),i=0;i<n.length;i++){var o=n[i];o.index===e&&(t=o)}if(t)return t.options.index=e,t.load();throw new Error("Manifest index not found")},t.prototype.getTotalCollections=function(){return this.getCollections().length},t.prototype.getTotalManifests=function(){return this.getManifests().length},t.prototype.getTotalItems=function(){return this.items.length},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?this.getProperty("viewingDirection"):r.ViewingDirection.LEFT_TO_RIGHT},t.prototype.getDefaultTree=function(){return e.prototype.getDefaultTree.call(this),this.defaultTree.data.type=s.Utils.normaliseType(s.TreeNodeType.COLLECTION),this._parseManifests(this),this._parseCollections(this),s.Utils.generateTreeNodeIds(this.defaultTree),this.defaultTree},t.prototype._parseManifests=function(e){if(e.getManifests()&&e.getManifests().length)for(var t=0;t<e.getManifests().length;t++){var n=e.getManifests()[t],i=n.getDefaultTree();i.label=n.parentLabel||s.LanguageMap.getValue(n.getLabel(),this.options.locale)||"manifest "+(t+1),i.navDate=n.getNavDate(),i.data.id=n.id,i.data.type=s.Utils.normaliseType(s.TreeNodeType.MANIFEST),e.defaultTree.addNode(i)}},t.prototype._parseCollections=function(e){if(e.getCollections()&&e.getCollections().length)for(var t=0;t<e.getCollections().length;t++){var n=e.getCollections()[t],i=n.getDefaultTree();i.label=n.parentLabel||s.LanguageMap.getValue(n.getLabel(),this.options.locale)||"collection "+(t+1),i.navDate=n.getNavDate(),i.data.id=n.id,i.data.type=s.Utils.normaliseType(s.TreeNodeType.COLLECTION),e.defaultTree.addNode(i)}},t}(s.IIIFResource);t.Collection=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.start=e,this.end=t}return e.prototype.getLength=function(){return this.end-this.start},e}();t.Duration=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=function(){function e(e){this.defaultLocale=e}return e.prototype.parse=function(e){this.resource=e,this.label=i.LanguageMap.parse(this.resource.label,this.defaultLocale),this.value=i.LanguageMap.parse(this.resource.value,this.defaultLocale)},e.prototype.getLabel=function(){return this.label?i.LanguageMap.getValue(this.label,this.defaultLocale):null},e.prototype.setLabel=function(e){var t=this;if(this.label&&this.label.length){var n=this.label.filter(function(e){return e.locale===t.defaultLocale||e.locale===i.Utils.getInexactLocale(t.defaultLocale)})[0];n&&(n.value=e)}},e.prototype.getValue=function(){if(this.value){var e=this.defaultLocale;return this.label&&this.label.length&&this.label[0].locale&&(e=this.label[0].locale),i.LanguageMap.getValue(this.value,e)}return null},e.prototype.setValue=function(e){var t=this;if(this.value&&this.value.length){var n=this.value.filter(function(e){return e.locale===t.defaultLocale||e.locale===i.Utils.getInexactLocale(t.defaultLocale)})[0];n&&(n.value=e)}},e}();t.LabelValuePair=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Language=function(e,t){Array.isArray(e)?1===e.length?this.value=e[0]:this.value=e.join("<br/>"):this.value=e,this.locale=t}},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.parse=function(e,t){var n,i=[];if(!e)return i;if(Array.isArray(e))for(var o=0;o<e.length;o++){var s=e[o];n="string"==typeof s?new r.Language(s,t):new r.Language(s["@value"],s["@language"]||t),i.push(n)}else{if("string"==typeof e)return n=new r.Language(e,t),i.push(n),i;e["@value"]?(n=new r.Language(e["@value"],e["@language"]||t),i.push(n)):Object.keys(e).forEach(function(t){if(!e[t].length)throw new Error("language must have a value");n=new r.Language(e[t],t),i.push(n)})}return i},t.getValue=function(e,t){if(e.length){if(t){var n=e.filter(function(e){return e.locale===t||r.Utils.getInexactLocale(e.locale)===r.Utils.getInexactLocale(t)})[0];if(n)return n.value}return e[0].value}return null},t}(Array);t.LanguageMap=s},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),s=n(0),a=function(e){function t(t,n){var i=e.call(this,t,n)||this;if(i.index=0,i._allRanges=null,i.items=[],i._topRanges=[],i.__jsonld.structures&&i.__jsonld.structures.length)for(var o=i._getTopRanges(),r=0;r<o.length;r++){var s=o[r];i._parseRanges(s,String(r))}return i}return o(t,e),t.prototype.getPosterCanvas=function(){var e=this.getProperty("posterCanvas");return e&&(e=new s.Canvas(e,this.options)),e},t.prototype.getBehavior=function(){var e=this.getProperty("behavior");return Array.isArray(e)&&(e=e[0]),e||null},t.prototype.getDefaultTree=function(){if(e.prototype.getDefaultTree.call(this),this.defaultTree.data.type=s.Utils.normaliseType(s.TreeNodeType.MANIFEST),!this.isLoaded)return this.defaultTree;var t=this.getTopRanges();return t.length&&t[0].getTree(this.defaultTree),s.Utils.generateTreeNodeIds(this.defaultTree),this.defaultTree},t.prototype._getTopRanges=function(){var e=[];if(this.__jsonld.structures&&this.__jsonld.structures.length){for(var t=0;t<this.__jsonld.structures.length;t++){var n=this.__jsonld.structures[t];n.viewingHint===r.ViewingHint.TOP&&e.push(n)}if(!e.length){var i={};i.ranges=this.__jsonld.structures,e.push(i)}}return e},t.prototype.getTopRanges=function(){return this._topRanges},t.prototype._getRangeById=function(e){if(this.__jsonld.structures&&this.__jsonld.structures.length)for(var t=0;t<this.__jsonld.structures.length;t++){var n=this.__jsonld.structures[t];if(n["@id"]===e||n.id===e)return n}return null},t.prototype._parseRanges=function(e,t,n){var i,o=null;if("string"==typeof e&&(o=e,e=this._getRangeById(o)),e){(i=new s.Range(e,this.options)).parentRange=n,i.path=t,n?n.items.push(i):this._topRanges.push(i);var r=e.items||e.members;if(r)for(var a=0;a<r.length;a++){var u=r[a];if(u["@type"]&&"sc:range"===u["@type"].toLowerCase()||u.type&&"range"===u.type.toLowerCase())this._parseRanges(u,t+"/"+a,i);else if(u["@type"]&&"sc:canvas"===u["@type"].toLowerCase()||u.type&&"canvas"===u.type.toLowerCase()){i.canvases||(i.canvases=[]);var l=u.id||u["@id"];i.canvases.push(l)}}else if(e.ranges)for(a=0;a<e.ranges.length;a++)this._parseRanges(e.ranges[a],t+"/"+a,i)}else console.warn("Range:",o,"does not exist")},t.prototype.getAllRanges=function(){if(null!=this._allRanges)return this._allRanges;this._allRanges=[];for(var e=this.getTopRanges(),t=function(t){var i=e[t];i.id&&n._allRanges.push(i);var o=function(e,t){e.add(t);var n=t.getRanges();return n.length?n.reduce(o,e):e},r=Array.from(i.getRanges().reduce(o,new Set));n._allRanges=n._allRanges.concat(r)},n=this,i=0;i<e.length;i++)t(i);return this._allRanges},t.prototype.getRangeById=function(e){for(var t=this.getAllRanges(),n=0;n<t.length;n++){var i=t[n];if(i.id===e)return i}return null},t.prototype.getRangeByPath=function(e){for(var t=this.getAllRanges(),n=0;n<t.length;n++){var i=t[n];if(i.path===e)return i}return null},t.prototype.getSequences=function(){if(this.items.length)return this.items;var e=this.__jsonld.mediaSequences||this.__jsonld.sequences;if(e)for(var t=0;t<e.length;t++){var n=e[t],i=new s.Sequence(n,this.options);this.items.push(i)}else this.__jsonld.items&&(i=new s.Sequence(this.__jsonld.items,this.options),this.items.push(i));return this.items},t.prototype.getSequenceByIndex=function(e){return this.getSequences()[e]},t.prototype.getTotalSequences=function(){return this.getSequences().length},t.prototype.getManifestType=function(){var e=this.getService(r.ServiceProfile.UI_EXTENSIONS);return e?e.getProperty("manifestType"):s.ManifestType.EMPTY},t.prototype.isMultiSequence=function(){return this.getTotalSequences()>1},t.prototype.isPagingEnabled=function(){var e=this.getViewingHint();if(e)return e===r.ViewingHint.PAGED;var t=this.getBehavior();return!!t&&t===r.Behavior.PAGED},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t}(s.IIIFResource);t.Manifest=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.EMPTY="",e.MANUSCRIPT="manuscript",e.MONOGRAPH="monograph"}(t.ManifestType||(t.ManifestType={}))},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=n(1),a=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i._ranges=null,i.canvases=null,i.items=[],i}return o(t,e),t.prototype.getCanvasIds=function(){return this.__jsonld.canvases?this.__jsonld.canvases:this.canvases?this.canvases:[]},t.prototype.getDuration=function(){var e,t;if(this.canvases&&this.canvases.length)for(var n=0;n<this.canvases.length;n++){
var i=this.canvases[n],o=r.Utils.getTemporalComponent(i);o&&o.length>1&&(0===n&&(e=Number(o[0])),n===this.canvases.length-1&&(t=Number(o[1])))}else{var s=this.getRanges();for(n=0;n<s.length;n++){var a=s[n].getDuration();a&&(0===n&&(e=a.start),n===s.length-1&&(t=a.end))}}return void 0!==e&&void 0!==t?new r.Duration(e,t):void 0},t.prototype.getRanges=function(){return this._ranges?this._ranges:this._ranges=this.items.filter(function(e){return e.isRange()})},t.prototype.getBehavior=function(){var e=this.getProperty("behavior");return Array.isArray(e)&&(e=e[0]),e||null},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t.prototype.getTree=function(e){e.data=this,this.treeNode=e;var t=this.getRanges();if(t&&t.length)for(var n=0;n<t.length;n++){var i=t[n],o=new r.TreeNode;e.addNode(o),this._parseTreeNode(o,i)}return r.Utils.generateTreeNodeIds(e),e},t.prototype.spansTime=function(e){var t=this.getDuration();return!!(t&&e>=t.start&&e<=t.end)},t.prototype._parseTreeNode=function(e,t){e.label=r.LanguageMap.getValue(t.getLabel(),this.options.locale),e.data=t,e.data.type=r.Utils.normaliseType(r.TreeNodeType.RANGE),t.treeNode=e;var n=t.getRanges();if(n&&n.length)for(var i=0;i<n.length;i++){var o=n[i];if(o.getBehavior()!==s.Behavior.NO_NAV){var a=new r.TreeNode;e.addNode(a),this._parseTreeNode(a,o)}}},t}(r.ManifestResource);t.Range=a},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(t,n){return e.call(this,t,n)||this}return o(t,e),t.prototype.getFormat=function(){return this.getProperty("format")},t}(n(0).ManifestResource);t.Rendering=r},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),s=n(0),a=function(e){function t(t,n){var i=e.call(this,t,n)||this;return i.items=[],i._thumbnails=null,i}return o(t,e),t.prototype.getCanvases=function(){if(this.items.length)return this.items;var e=this.__jsonld.canvases||this.__jsonld.elements;if(e)for(var t=0;t<e.length;t++){var n=e[t];(i=new s.Canvas(n,this.options)).index=t,this.items.push(i)}else if(this.__jsonld)for(t=0;t<this.__jsonld.length;t++){var i;n=this.__jsonld[t],(i=new s.Canvas(n,this.options)).index=t,this.items.push(i)}return this.items},t.prototype.getCanvasById=function(e){for(var t=0;t<this.getTotalCanvases();t++){var n=this.getCanvasByIndex(t),i=s.Utils.normaliseUrl(n.id);if(s.Utils.normaliseUrl(e)===i)return n}return null},t.prototype.getCanvasByIndex=function(e){return this.getCanvases()[e]},t.prototype.getCanvasIndexById=function(e){for(var t=0;t<this.getTotalCanvases();t++)if(this.getCanvasByIndex(t).id===e)return t;return null},t.prototype.getCanvasIndexByLabel=function(e,t){e=e.trim(),isNaN(e)||(e=parseInt(e,10).toString(),t&&(e+="r"));for(var n,i,o,r=/(\d*)\D+(\d*)/,a=0;a<this.getTotalCanvases();a++){var u=this.getCanvasByIndex(a);if(s.LanguageMap.getValue(u.getLabel(),this.options.locale)===e)return a;if((n=r.exec(e))&&(i=n[1],(o=n[2])&&new RegExp("^"+i+"\\D+"+o+"$").test(u.getLabel().toString())))return a}return-1},t.prototype.getLastCanvasLabel=function(e){for(var t=this.getTotalCanvases()-1;t>=0;t--){var n=this.getCanvasByIndex(t),i=s.LanguageMap.getValue(n.getLabel(),this.options.locale);if(e){if(/^[a-zA-Z0-9]*$/.test(i))return i}else if(i)return i}return this.options.defaultLabel},t.prototype.getLastPageIndex=function(){return this.getTotalCanvases()-1},t.prototype.getNextPageIndex=function(e,t){var n;if(t){var i=this.getPagedIndices(e),o=this.getViewingDirection();n=o&&o===r.ViewingDirection.RIGHT_TO_LEFT?i[0]+1:i[i.length-1]+1}else n=e+1;return n>this.getLastPageIndex()?-1:n},t.prototype.getPagedIndices=function(e,t){var n=[];if(t){n=this.isFirstCanvas(e)||this.isLastCanvas(e)?[e]:e%2?[e,e+1]:[e-1,e];var i=this.getViewingDirection();i&&i===r.ViewingDirection.RIGHT_TO_LEFT&&(n=n.reverse())}else n.push(e);return n},t.prototype.getPrevPageIndex=function(e,t){var n;if(t){var i=this.getPagedIndices(e),o=this.getViewingDirection();n=o&&o===r.ViewingDirection.RIGHT_TO_LEFT?i[i.length-1]-1:i[0]-1}else n=e-1;return n},t.prototype.getStartCanvasIndex=function(){var e=this.getStartCanvas();if(e)for(var t=0;t<this.getTotalCanvases();t++)if(this.getCanvasByIndex(t).id===e)return t;return 0},t.prototype.getThumbs=function(e,t){for(var n=[],i=this.getTotalCanvases(),o=0;i>o;o++){var r=this.getCanvasByIndex(o),a=new s.Thumb(e,r);n.push(a)}return n},t.prototype.getThumbnails=function(){if(null!=this._thumbnails)return this._thumbnails;this._thumbnails=[];for(var e=this.getCanvases(),t=0;t<e.length;t++){var n=e[t].getThumbnail();n&&this._thumbnails.push(n)}return this._thumbnails},t.prototype.getStartCanvas=function(){return this.getProperty("startCanvas")},t.prototype.getTotalCanvases=function(){return this.getCanvases().length},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?this.getProperty("viewingDirection"):this.options.resource.getViewingDirection?this.options.resource.getViewingDirection():null},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t.prototype.isCanvasIndexOutOfRange=function(e){return e>this.getTotalCanvases()-1},t.prototype.isFirstCanvas=function(e){return 0===e},t.prototype.isLastCanvas=function(e){return e===this.getTotalCanvases()-1},t.prototype.isMultiCanvas=function(){return this.getTotalCanvases()>1},t.prototype.isPagingEnabled=function(){var e=this.getViewingHint();return!!e&&e===r.ViewingHint.PAGED},t.prototype.isTotalCanvasesEven=function(){return this.getTotalCanvases()%2==0},t}(s.ManifestResource);t.Sequence=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=function(){function e(){}return e.parse=function(e,t){return"string"==typeof e&&(e=JSON.parse(e)),this.parseJson(e,t)},e.parseJson=function(e,t){var n;if(t&&t.navDate&&!isNaN(t.navDate.getTime())&&(e.navDate=t.navDate.toString()),e["@type"])switch(e["@type"]){case"sc:Collection":n=this.parseCollection(e,t);break;case"sc:Manifest":n=this.parseManifest(e,t);break;default:return null}else switch(e.type){case"Collection":n=this.parseCollection(e,t);break;case"Manifest":n=this.parseManifest(e,t);break;default:return null}return n.isLoaded=!0,n},e.parseCollection=function(e,t){var n=new i.Collection(e,t);return t?(n.index=t.index||0,t.resource&&(n.parentCollection=t.resource.parentCollection)):n.index=0,this.parseCollections(n,t),this.parseManifests(n,t),this.parseItems(n,t),n},e.parseCollections=function(e,t){var n;if(e.__jsonld.collections?n=e.__jsonld.collections:e.__jsonld.items&&(n=e.__jsonld.items.filter(function(e){return"collection"===e.type.toLowerCase()})),n)for(var i=0;i<n.length;i++){t&&(t.index=i);var o=this.parseCollection(n[i],t);o.index=i,o.parentCollection=e,e.items.push(o)}},e.parseManifest=function(e,t){return new i.Manifest(e,t)},e.parseManifests=function(e,t){var n;if(e.__jsonld.manifests?n=e.__jsonld.manifests:e.__jsonld.items&&(n=e.__jsonld.items.filter(function(e){return"manifest"===e.type.toLowerCase()})),n)for(var i=0;i<n.length;i++){var o=this.parseManifest(n[i],t);o.index=i,o.parentCollection=e,e.items.push(o)}},e.parseItem=function(e,t){if(e["@type"]){if("sc:manifest"===e["@type"].toLowerCase())return this.parseManifest(e,t);if("sc:collection"===e["@type"].toLowerCase())return this.parseCollection(e,t)}else if(e.type){if("manifest"===e.type.toLowerCase())return this.parseManifest(e,t);if("collection"===e.type.toLowerCase())return this.parseCollection(e,t)}return null},e.parseItems=function(e,t){var n=e.__jsonld.members||e.__jsonld.items;if(n)for(var i=function(i){t&&(t.index=i);var r=o.parseItem(n[i],t);return r?e.items.filter(function(e){return e.id===r.id})[0]?"continue":(r.index=i,r.parentCollection=e,void e.items.push(r)):{value:void 0}},o=this,r=0;r<n.length;r++){var s=i(r);if("object"==typeof s)return s.value}},e}();t.Deserialiser=o},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=function(e){function t(t,n){return e.call(this,t,n)||this}return o(t,e),t.prototype.getProfile=function(){var e=this.getProperty("profile");return e||(e=this.getProperty("dcterms:conformsTo")),Array.isArray(e)?e[0]:e},t.prototype.getConfirmLabel=function(){return r.Utils.getLocalisedValue(this.getProperty("confirmLabel"),this.options.locale)},t.prototype.getDescription=function(){return r.Utils.getLocalisedValue(this.getProperty("description"),this.options.locale)},t.prototype.getFailureDescription=function(){return r.Utils.getLocalisedValue(this.getProperty("failureDescription"),this.options.locale)},t.prototype.getFailureHeader=function(){return r.Utils.getLocalisedValue(this.getProperty("failureHeader"),this.options.locale)},t.prototype.getHeader=function(){return r.Utils.getLocalisedValue(this.getProperty("header"),this.options.locale)},t.prototype.getServiceLabel=function(){return r.Utils.getLocalisedValue(this.getProperty("label"),this.options.locale)},t.prototype.getInfoUri=function(){var e=this.id;return e.endsWith("/")||(e+="/"),e+"info.json"},t}(r.ManifestResource);t.Service=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Size=function(e,t){this.width=e,this.height=t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.AUTHORIZATION_FAILED=1]="AUTHORIZATION_FAILED",e[e.FORBIDDEN=2]="FORBIDDEN",e[e.INTERNAL_SERVER_ERROR=3]="INTERNAL_SERVER_ERROR",e[e.RESTRICTED=4]="RESTRICTED"}(t.StatusCode||(t.StatusCode={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t.Thumb=function(e,t){this.data=t,this.index=t.index,this.width=e;var n=t.getHeight()/t.getWidth();this.height=n?Math.floor(this.width*n):e,this.uri=t.getCanonicalImageUri(e),this.label=i.LanguageMap.getValue(t.getLabel())}},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(t,n){return e.call(this,t,n)||this}return o(t,e),t}(n(0).Resource);t.Thumbnail=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=function(){function e(e,t){this.label=e,this.data=t||{},this.nodes=[]}return e.prototype.addNode=function(e){this.nodes.push(e),e.parentNode=this},e.prototype.isCollection=function(){return this.data.type===i.Utils.normaliseType(i.TreeNodeType.COLLECTION)},e.prototype.isManifest=function(){return this.data.type===i.Utils.normaliseType(i.TreeNodeType.MANIFEST)},e.prototype.isRange=function(){return this.data.type===i.Utils.normaliseType(i.TreeNodeType.RANGE)},e}();t.TreeNode=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.COLLECTION="collection",e.MANIFEST="manifest",e.RANGE="range"}(t.TreeNodeType||(t.TreeNodeType={}))},function(e,t,n){window,e.exports=function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:i})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(t.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)t.d(i,o,function(t){return e[t]}.bind(null,o));return i},t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONTINUE=100,t.SWITCHING_PROTOCOLS=101,t.PROCESSING=102,t.OK=200,t.CREATED=201,t.ACCEPTED=202,t.NON_AUTHORITATIVE_INFORMATION=203,t.NO_CONTENT=204,t.RESET_CONTENT=205,t.PARTIAL_CONTENT=206,t.MULTI_STATUS=207,t.MULTIPLE_CHOICES=300,t.MOVED_PERMANENTLY=301,t.MOVED_TEMPORARILY=302,t.SEE_OTHER=303,t.NOT_MODIFIED=304,t.USE_PROXY=305,t.TEMPORARY_REDIRECT=307,t.BAD_REQUEST=400,t.UNAUTHORIZED=401,t.PAYMENT_REQUIRED=402,t.FORBIDDEN=403,t.NOT_FOUND=404,t.METHOD_NOT_ALLOWED=405,t.NOT_ACCEPTABLE=406,t.PROXY_AUTHENTICATION_REQUIRED=407,t.REQUEST_TIME_OUT=408,t.CONFLICT=409,t.GONE=410,t.LENGTH_REQUIRED=411,t.PRECONDITION_FAILED=412,t.REQUEST_ENTITY_TOO_LARGE=413,t.REQUEST_URI_TOO_LARGE=414,t.UNSUPPORTED_MEDIA_TYPE=415,t.REQUESTED_RANGE_NOT_SATISFIABLE=416,t.EXPECTATION_FAILED=417,t.IM_A_TEAPOT=418,t.UNPROCESSABLE_ENTITY=422,t.LOCKED=423,t.FAILED_DEPENDENCY=424,t.UNORDERED_COLLECTION=425,t.UPGRADE_REQUIRED=426,t.PRECONDITION_REQUIRED=428,t.TOO_MANY_REQUESTS=429,t.REQUEST_HEADER_FIELDS_TOO_LARGE=431,t.INTERNAL_SERVER_ERROR=500,t.NOT_IMPLEMENTED=501,t.BAD_GATEWAY=502,t.SERVICE_UNAVAILABLE=503,t.GATEWAY_TIME_OUT=504,t.HTTP_VERSION_NOT_SUPPORTED=505,t.VARIANT_ALSO_NEGOTIATES=506,t.INSUFFICIENT_STORAGE=507,t.BANDWIDTH_LIMIT_EXCEEDED=509,t.NOT_EXTENDED=510,t.NETWORK_AUTHENTICATION_REQUIRED=511}])},function(e,t,n){e.exports=window.fetch||(window.fetch=n(3)["default"]||n(3))}])},function(e,t,n){"use strict";n.r(t),n.d(t,"BaseComponent",function(){return i});var i=function(){function e(e){this.options=e,this.options.data=Object.assign({},this.data(),e.data)}return e.prototype._init=function(){return this.el=this.options.target,this.el?(this.el.innerHTML="",!0):(console.warn("element not found"),!1)},e.prototype.data=function(){return{}},e.prototype.on=function(e,t,n){var i=this._e||(this._e={});(i[e]||(i[e]=[])).push({fn:t,ctx:n})},e.prototype.fire=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var i=[].slice.call(arguments,1),o=((this._e||(this._e={}))[e]||[]).slice(),r=0,s=o.length;s>r;r++)o[r].fn.apply(o[r].ctx,i)},e.prototype._resize=function(){},e.prototype.set=function(e){},e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"Async",function(){return o}),n.d(t,"Bools",function(){return r}),n.d(t,"Clipboard",function(){return s}),n.d(t,"Colors",function(){return a}),n.d(t,"Dates",function(){return u}),n.d(t,"Device",function(){return l}),n.d(t,"Documents",function(){return c}),n.d(t,"Events",function(){return h}),n.d(t,"Files",function(){return p}),n.d(t,"Keyboard",function(){return d}),n.d(t,"Maths",function(){return f}),n.d(t,"Size",function(){return g}),n.d(t,"Dimensions",function(){return v}),n.d(t,"Numbers",function(){return _}),n.d(t,"Objects",function(){return m}),n.d(t,"Storage",function(){return E}),n.d(t,"StorageItem",function(){return y}),n.d(t,"StorageType",function(){return i}),n.d(t,"Strings",function(){return b}),n.d(t,"Urls",function(){return I});var i,o=function(){function e(){}return e.waitFor=function(t,n,i,o,r,s){o||(o=200),r||(r=100),s||(s=0),(s+=1)>r?i&&i():t()?n():setTimeout(function(){e.waitFor(t,n,i,o,r,s)},o)},e}(),r=function(){function e(){}return e.getBool=function(e,t){return null==e?t:e},e}(),s=function(){function e(){}return e.supportsCopy=function(){return document.queryCommandSupported&&document.queryCommandSupported("copy")},e.copy=function(t){t=e.convertBrToNewLine(t);var n=document.createElement("textarea");n.value=t,e.hideButKeepEnabled(n),document.body.appendChild(n),n.focus(),n.select(),document.execCommand("copy"),document.body.removeChild(n)},e.hideButKeepEnabled=function(e){e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="2em",e.style.height="2em",e.style.padding="0",e.style.border="none",e.style.outline="none",e.style.boxShadow="none",e.style.background="transparent"},e.convertBrToNewLine=function(e){return e=e.replace(/<br\s*[\/]?>/gi,"\n")},e}(),a=function(){function e(){}return e.float32ColorToARGB=function(e){return[(4278190080&e)>>>24,(16711680&e)>>>16,(65280&e)>>>8,255&e]},e._componentToHex=function(e){var t=e.toString(16);return 1==t.length?"0"+t:t},e.rgbToHexString=function(t){return e.coalesce(t),"#"+e._componentToHex(t[0])+e._componentToHex(t[1])+e._componentToHex(t[2])},e.argbToHexString=function(t){return"#"+e._componentToHex(t[0])+e._componentToHex(t[1])+e._componentToHex(t[2])+e._componentToHex(t[3])},e.coalesce=function(e){for(var t=1;t<e.length;t++)void 0===e[t]&&(e[t]=e[t-1])},e}(),u=function(){function e(){}return e.getTimeStamp=function(){return(new Date).getTime()},e}(),l=function(){function e(){}return e.getPixelRatio=function(e){return(window.devicePixelRatio||1)/(e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1)},e.isTouch=function(){return!!("ontouchstart"in window)||window.navigator.msMaxTouchPoints>0},e}(),c=function(){function e(){}return e.isInIFrame=function(){try{return window.self!==window.top}catch(e){return!0}},e.supportsFullscreen=function(){var e=document.documentElement;return void 0!==(e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullScreen||e.msRequestFullscreen)},e.isHidden=function(){return!!e.getHiddenProp()},e.getHiddenProp=function(){var e=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var t=0;t<e.length;t++)if(e[t]+"Hidden"in document)return e[t]+"Hidden";return null},e}(),h=function(){function e(){}return e.debounce=function(e,t){return t=t||100,function(){if(!e.debouncing){var n=Array.prototype.slice.apply(arguments);e.lastReturnVal=e.apply(window,n),e.debouncing=!0}return clearTimeout(e.debounceTimeout),e.debounceTimeout=setTimeout(function(){e.debouncing=!1},t),e.lastReturnVal}},e}(),p=function(){function e(){}return e.simplifyMimeType=function(e){switch(e){case"text/plain":return"txt";case"image/jpeg":return"jpg";case"application/msword":return"doc";case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":return"docx";default:var t=e.split("/");return t[t.length-1]}},e}(),d=function(){function e(){}return e.getCharCode=function(e){return"number"==typeof e.which?e.which:e.keyCode},e}(),f=function(){function e(){}return e.normalise=function(e,t,n){return(e-t)/(n-t)},e.median=function(e){e.sort(function(e,t){return e-t});var t=Math.floor(e.length/2);return e.length%2?e[t]:(e[t-1]+e[t])/2},e.clamp=function(e,t,n){return Math.min(Math.max(e,t),n)},e}(),g=function(e,t){this.width=e,this.height=t},v=function(){function e(){}return e.fitRect=function(e,t,n,i){var o,r=0,s=0;return i/n>t/e?(r=e*(o=n/e),s=t*o):(r=e*(o=i/t),s=t*o),new g(Math.floor(r),Math.floor(s))},e.hitRect=function(e,t,n,i,o,r){return o>e&&e+n>o&&r>t&&t+i>r},e}(),_=function(){function e(){}return e.numericalInput=function(e){return 46==e.keyCode||8==e.keyCode||9==e.keyCode||27==e.keyCode||65==e.keyCode&&!0===e.ctrlKey||e.keyCode>=35&&e.keyCode<=39||!(e.shiftKey||(e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105))||(e.preventDefault(),!1)},e}(),m=function(){function e(){}return e.toPlainObject=function(e){e=Object(e);var t={};for(var n in e)t[n]=e[n];return t},e}(),E=function(){function e(){}return e.clear=function(e){switch(void 0===e&&(e=i.MEMORY),e){case i.MEMORY:this._memoryStorage={};break;case i.SESSION:sessionStorage.clear();break;case i.LOCAL:localStorage.clear()}},e.clearExpired=function(e){void 0===e&&(e=i.MEMORY);for(var t=this.getItems(e),n=0;n<t.length;n++){var o=t[n];this._isExpired(o)&&this.remove(o.key)}},e.get=function(e,t){void 0===t&&(t=i.MEMORY);var n=null;switch(t){case i.MEMORY:n=this._memoryStorage[e];break;case i.SESSION:n=sessionStorage.getItem(e);break;case i.LOCAL:n=localStorage.getItem(e)}if(!n)return null;var o=null;try{o=JSON.parse(n)}catch(e){return null}return o?this._isExpired(o)?null:(o.key=e,o):null},e._isExpired=function(e){return!((new Date).getTime()<e.expiresAt)},e.getItems=function(e){void 0===e&&(e=i.MEMORY);var t=[];switch(e){case i.MEMORY:for(var n=Object.keys(this._memoryStorage),o=0;o<n.length;o++)(s=this.get(n[o],i.MEMORY))&&t.push(s);break;case i.SESSION:for(o=0;o<sessionStorage.length;o++)(r=sessionStorage.key(o))&&(s=this.get(r,i.SESSION))&&t.push(s);break;case i.LOCAL:for(o=0;o<localStorage.length;o++){var r,s;(r=localStorage.key(o))&&(s=this.get(r,i.LOCAL))&&t.push(s)}}return t},e.remove=function(e,t){switch(void 0===t&&(t=i.MEMORY),t){case i.MEMORY:delete this._memoryStorage[e];break;case i.SESSION:sessionStorage.removeItem(e);break;case i.LOCAL:localStorage.removeItem(e)}},e.set=function(e,t,n,o){void 0===o&&(o=i.MEMORY);var r=1e3*n,s=new y;switch(s.value=t,s.expiresAt=(new Date).getTime()+r,o){case i.MEMORY:this._memoryStorage[e]=JSON.stringify(s);break;case i.SESSION:sessionStorage.setItem(e,JSON.stringify(s));break;case i.LOCAL:localStorage.setItem(e,JSON.stringify(s))}return s},e._memoryStorage={},e}(),y=function(){};!function(e){e.MEMORY="memory",e.SESSION="session",e.LOCAL="local"}(i||(i={}));var b=function(){function e(){}return e.ellipsis=function(e,t){if(e.length<=t)return e;var n=e.substr(0,t),i=n.lastIndexOf(" ");return-1!=i&&(n=n.substr(0,Math.min(n.length,i))),n+"&hellip;"},e.htmlDecode=function(e){var t=document.createElement("div");return t.innerHTML=e,t.firstChild.nodeValue},e.format=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var i=0;i<t.length;i++){var o=new RegExp("\\{"+i+"\\}","gm");e=e.replace(o,t[i])}return e},e.isAlphanumeric=function(e){return/^[a-zA-Z0-9]*$/.test(e)},e.toCssClass=function(e){return e.replace(/[^a-z0-9]/g,function(e){var t=e.charCodeAt(0);return 32==t?"-":t>=65&&90>=t?"_"+e.toLowerCase():"__"+("000"+t.toString(16)).slice(-4)})},e.toFileName=function(e){return e.replace(/[^a-z0-9]/gi,"_").toLowerCase()},e.utf8_to_b64=function(e){return window.btoa(unescape(encodeURIComponent(e)))},e}(),I=function(){function e(){}return e.getHashParameter=function(e,t){return t||(t=window.document),t&&t.location?this.getHashParameterFromString(e,t.location.hash):null},e.getHashParameterFromString=function(e,t){var n=new RegExp("#.*[?&]"+e+"=([^&]+)(&|$)").exec(t);return n?decodeURIComponent(n[1].replace(/\+/g," ")):null},e.setHashParameter=function(e,t,n){if(n||(n=window.document),n&&n.location){var i="#?"+this.updateURIKeyValuePair(n.location.hash.replace("#?",""),e,t),o=n.URL;-1!=o.indexOf("#")&&(o=o.substr(0,o.indexOf("#"))),n.location.replace(o+i)}},e.getQuerystringParameter=function(e,t){return t||(t=window),this.getQuerystringParameterFromString(e,t.location.search)},e.getQuerystringParameterFromString=function(e,t){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t);return n?decodeURIComponent(n[1].replace(/\+/g," ")):null},e.setQuerystringParameter=function(e,t,n){if(n||(n=window.document),n&&n.location){var i=this.updateURIKeyValuePair(n.location.hash.replace("#?",""),e,t);window.location.search=i}},e.updateURIKeyValuePair=function(e,t,n){t=encodeURIComponent(t),n=encodeURIComponent(n);var i=e.split("&");""==i[0]&&i.shift();for(var o,r=i.length;r--;)if((o=i[r].split("="))[0]==t){o[1]=n,i[r]=o.join("=");break}return 0>r&&(i[i.length]=[t,n].join("=")),i.join("&")},e.getUrlParts=function(e){var t=document.createElement("a");return t.href=e,t},e.convertToRelativeUrl=function(e){var t=this.getUrlParts(e),n=t.pathname+t.searchWithin;return n.startsWith("/")||(n="/"+n),n},e}()}])}),define("lib/IIIFMetadataComponent.js",function(){});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-shared-module/RightPanel",["require","exports","./BaseEvents","./BaseExpandPanel"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){e.prototype.create.call(this),this.$element.width(this.options.panelCollapsedWidth)},t.prototype.init=function(){var t=this;e.prototype.init.call(this);var i=Utils.Bools.getBool(this.extension.getSettings().rightPanelOpen,this.options.panelOpen);i&&this.toggle(!0),this.component.subscribe(n.BaseEvents.TOGGLE_EXPAND_RIGHT_PANEL,function(){t.isFullyExpanded?t.collapseFull():t.expandFull()})},t.prototype.getTargetWidth=function(){return this.isExpanded?this.options.panelCollapsedWidth:this.options.panelExpandedWidth},t.prototype.getTargetLeft=function(){return this.isExpanded?this.$element.parent().width()-this.options.panelCollapsedWidth:this.$element.parent().width()-this.options.panelExpandedWidth},t.prototype.toggleFinish=function(){e.prototype.toggleFinish.call(this),this.isExpanded?this.component.publish(n.BaseEvents.OPEN_RIGHT_PANEL):this.component.publish(n.BaseEvents.CLOSE_RIGHT_PANEL),this.extension.updateSettings({rightPanelOpen:this.isExpanded})},t.prototype.resize=function(){e.prototype.resize.call(this),this.$element.css({left:Math.floor(this.$element.parent().width()-this.$element.outerWidth())})},t}(i.BaseExpandPanel);t.RightPanel=o});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-moreinforightpanel-module/MoreInfoRightPanel",["require","exports","@iiif/iiif-metadata-component","@iiif/manifold","../uv-shared-module/BaseEvents","../uv-shared-module/RightPanel","../../Utils"],function(e,t,n,i,o,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("moreInfoRightPanel"),e.prototype.create.call(this),this.component.subscribe(o.BaseEvents.CANVAS_INDEX_CHANGED,function(){t.databind()}),this.component.subscribe(o.BaseEvents.RANGE_CHANGED,function(){t.databind()}),this.setTitle(this.config.content.title),this.$metadata=$('<div class="iiif-metadata-component"></div>'),this.$main.append(this.$metadata),this.metadataComponent=new n.MetadataComponent({target:this.$metadata[0],data:this._getData()}),this.metadataComponent.on("iiifViewerLinkClicked",function(e){var n=Utils.Urls.getHashParameterFromString("rid",e),i=Utils.Urls.getHashParameterFromString("t",e),r=i?parseInt(i,10):null,s=Utils.Urls.getHashParameterFromString("c",e);if(s){var a=t.extension.helper.getCanvasIndexById(s);a&&t.component.publish(o.BaseEvents.CANVAS_INDEX_CHANGED,[a])}if(n){var u=t.extension.helper.getRangeById(n);u&&t.component.publish(o.BaseEvents.RANGE_CHANGED,u)}null!==r&&t.component.publish(o.BaseEvents.CURRENT_TIME_CHANGED,[r])},!1)},t.prototype.toggleFinish=function(){e.prototype.toggleFinish.call(this),this.databind()},t.prototype.databind=function(){this.metadataComponent.set(this._getData())},t.prototype._getCurrentRange=function(){return this.extension.helper.getCurrentRange()},t.prototype._getData=function(){return{canvasDisplayOrder:this.config.options.canvasDisplayOrder,canvases:this.extension.getCurrentCanvases(),canvasExclude:this.config.options.canvasExclude,canvasLabels:this.extension.getCanvasLabels(this.content.page),content:this.config.content,copiedMessageDuration:2e3,copyToClipboardEnabled:Utils.Bools.getBool(this.config.options.copyToClipboardEnabled,!1),helper:this.extension.helper,licenseFormatter:new i.UriLabeller(this.config.license?this.config.license:{}),limit:this.config.options.textLimit||4,limitType:"lines",limitToRange:Utils.Bools.getBool(this.config.options.limitToRange,!1),manifestDisplayOrder:this.config.options.manifestDisplayOrder,manifestExclude:this.config.options.manifestExclude,range:this._getCurrentRange(),rtlLanguageCodes:this.config.options.rtlLanguageCodes,sanitizer:function(e){return s.UVUtils.sanitize(e)},showAllLanguages:this.config.options.showAllLanguages}},t.prototype.resize=function(){e.prototype.resize.call(this),this.$main.height(this.$element.height()-this.$top.height()-this.$main.verticalMargins())},t}(r.RightPanel);t.MoreInfoRightPanel=a});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-dialogues-module/SettingsDialogue",["require","exports","../uv-shared-module/BaseEvents","../uv-shared-module/Dialogue"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("settingsDialogue"),e.prototype.create.call(this),this.openCommand=n.BaseEvents.SHOW_SETTINGS_DIALOGUE,this.closeCommand=n.BaseEvents.HIDE_SETTINGS_DIALOGUE,this.component.subscribe(this.openCommand,function(){t.open()}),this.component.subscribe(this.closeCommand,function(){t.close()}),this.$title=$("<h1></h1>"),this.$content.append(this.$title),this.$scroll=$('<div class="scroll"></div>'),this.$content.append(this.$scroll),this.$version=$('<div class="version"></div>'),this.$content.append(this.$version),this.$website=$('<div class="website"></div>'),this.$content.append(this.$website),this.$locale=$('<div class="setting locale"></div>'),this.$scroll.append(this.$locale),this.$localeLabel=$('<label for="locale">'+this.content.locale+"</label>"),this.$locale.append(this.$localeLabel),this.$localeDropDown=$('<select id="locale"></select>'),this.$locale.append(this.$localeDropDown),this.$title.text(this.content.title),this.$website.html(this.content.website),this.$website.targetBlank(),this._createLocalesMenu(),this.$element.hide()},t.prototype.getSettings=function(){return this.extension.getSettings()},t.prototype.updateSettings=function(e){this.extension.updateSettings(e),this.component.publish(n.BaseEvents.UPDATE_SETTINGS,e)},t.prototype.open=function(){e.prototype.open.call(this),this.$version.text("v3.1.4")},t.prototype._createLocalesMenu=function(){var e=this,t=this.extension.data.locales;if(t&&t.length>1){for(var n=0;n<t.length;n++){var i=t[n];this.$localeDropDown.append('<option value="'+i.name+'">'+i.label+"</option>")}this.$localeDropDown.val(t[0].name)}else this.$locale.hide();this.$localeDropDown.change(function(){e.extension.changeLocale(e.$localeDropDown.val());
})},t.prototype.resize=function(){e.prototype.resize.call(this)},t}(i.Dialogue);t.SettingsDialogue=o});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("extensions/uv-av-extension/SettingsDialogue",["require","exports","../../modules/uv-dialogues-module/SettingsDialogue"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){this.setConfig("settingsDialogue"),e.prototype.create.call(this)},t}(n.SettingsDialogue);t.SettingsDialogue=i});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-dialogues-module/ShareDialogue",["require","exports","../uv-shared-module/BaseEvents","../uv-shared-module/Dialogue"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){var n=e.call(this,t)||this;return n.aspectRatio=.75,n.isEmbedViewVisible=!1,n.isShareViewVisible=!1,n.maxWidth=8e3,n.maxHeight=n.maxWidth*n.aspectRatio,n.minWidth=200,n.minHeight=n.minWidth*n.aspectRatio,n.shareManifests=!1,n}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("shareDialogue"),e.prototype.create.call(this),this.openCommand=n.BaseEvents.SHOW_SHARE_DIALOGUE,this.closeCommand=n.BaseEvents.HIDE_SHARE_DIALOGUE,this.shareManifests=this.options.shareManifests||!1,this.component.subscribe(this.openCommand,function(e){t.open(e),t.isShareAvailable()?t.openShareView():t.openEmbedView()}),this.component.subscribe(this.closeCommand,function(){t.close()}),this.component.subscribe(n.BaseEvents.SHOW_EMBED_DIALOGUE,function(e){t.open(e),t.openEmbedView()}),this.$tabs=$('<div class="tabs"></div>'),this.$content.append(this.$tabs),this.$shareButton=$('<a class="share tab default" tabindex="0">'+this.content.share+"</a>"),this.$shareButton.prop("title",this.content.share),this.$tabs.append(this.$shareButton),this.$embedButton=$('<a class="embed tab" tabindex="0">'+this.content.embed+"</a>"),this.$embedButton.prop("title",this.content.embed),this.$tabs.append(this.$embedButton),this.$tabsContent=$('<div class="tabsContent"></div>'),this.$content.append(this.$tabsContent),this.$footer=$('<div class="footer"></div>'),this.$content.append(this.$footer),this.$shareView=$('<div class="shareView view"></div>'),this.$tabsContent.append(this.$shareView),this.$shareHeader=$('<div class="header"></div>'),this.$shareView.append(this.$shareHeader),this.$shareLink=$('<a class="shareLink" onclick="return false;"></a>'),this.$shareView.append(this.$shareLink),this.$shareInput=$('<input class="shareInput" type="text" readonly="readonly" aria-label="'+this.content.shareUrl+'"/>'),this.$shareView.append(this.$shareInput),this.$shareFrame=$('<iframe class="shareFrame"></iframe>'),this.$shareView.append(this.$shareFrame),this.$embedView=$('<div class="embedView view"></div>'),this.$tabsContent.append(this.$embedView),this.$embedHeader=$('<div class="header"></div>'),this.$embedView.append(this.$embedHeader),this.$code=$('<input class="code" type="text" readonly="readonly" aria-label="'+this.content.embed+'"/>'),this.$embedView.append(this.$code),this.$customSize=$('<div class="customSize"></div>'),this.$embedView.append(this.$customSize),this.$size=$('<span class="size">'+this.content.size+"</span>"),this.$customSize.append(this.$size),this.$customSizeDropDown=$('<select id="size" aria-label="'+this.content.size+'"></select>'),this.$customSize.append(this.$customSizeDropDown),this.$customSizeDropDown.append('<option value="small" data-width="560" data-height="420">560 x 420</option>'),this.$customSizeDropDown.append('<option value="medium" data-width="640" data-height="480">640 x 480</option>'),this.$customSizeDropDown.append('<option value="large" data-width="800" data-height="600">800 x 600</option>'),this.$customSizeDropDown.append('<option value="custom">'+this.content.customSize+"</option>"),this.$widthInput=$('<input class="width" type="text" maxlength="10" aria-label="'+this.content.width+'"/>'),this.$customSize.append(this.$widthInput),this.$x=$('<span class="x">x</span>'),this.$customSize.append(this.$x),this.$heightInput=$('<input class="height" type="text" maxlength="10" aria-label="'+this.content.height+'"/>'),this.$customSize.append(this.$heightInput);var i=this.extension.getIIIFShareUrl(this.shareManifests);this.$iiifButton=$('<a class="imageBtn iiif" href="'+i+'" title="'+this.content.iiif+'" target="_blank"></a>'),this.$footer.append(this.$iiifButton),this.$termsOfUseButton=$('<a href="#">'+this.extension.data.config.content.termsOfUse+"</a>"),this.$footer.append(this.$termsOfUseButton),this.$widthInput.on("keydown",function(e){return Utils.Numbers.numericalInput(e)}),this.$heightInput.on("keydown",function(e){return Utils.Numbers.numericalInput(e)}),this.$shareInput.focus(function(){$(this).select()}),this.$code.focus(function(){$(this).select()}),this.$shareButton.onPressed(function(){t.openShareView()}),this.$embedButton.onPressed(function(){t.openEmbedView()}),this.$customSizeDropDown.change(function(){t.update()}),this.$widthInput.change(function(){t.updateHeightRatio(),t.update()}),this.$heightInput.change(function(){t.updateWidthRatio(),t.update()}),this.$termsOfUseButton.onPressed(function(){t.component.publish(n.BaseEvents.SHOW_TERMS_OF_USE)}),this.$element.hide(),this.update()},t.prototype.open=function(t){e.prototype.open.call(this,t),this.update()},t.prototype.getShareUrl=function(){return this.extension.getShareUrl()},t.prototype.isShareAvailable=function(){return!!this.getShareUrl()},t.prototype.update=function(){this.isShareAvailable()?this.$shareButton.show():this.$shareButton.hide();var e=this.getSelectedSize();"custom"===e.val()?(this.$widthInput.show(),this.$x.show(),this.$heightInput.show()):(this.$widthInput.hide(),this.$x.hide(),this.$heightInput.hide(),this.currentWidth=Number(e.data("width")),this.currentHeight=Number(e.data("height")),this.$widthInput.val(String(this.currentWidth)),this.$heightInput.val(String(this.currentHeight))),this.updateInstructions(),this.updateShareOptions(),this.updateShareFrame(),this.updateTermsOfUseButton()},t.prototype.updateShareOptions=function(){var e=this.getShareUrl();e&&(this.$shareInput.val(e),this.$shareLink.prop("href",e),this.$shareLink.text(e)),this.extension.isMobile()?(this.$shareInput.hide(),this.$shareLink.show()):(this.$shareInput.show(),this.$shareLink.hide())},t.prototype.updateInstructions=function(){Utils.Bools.getBool(this.options.instructionsEnabled,!1)?(this.$shareHeader.show(),this.$embedHeader.show(),this.$shareHeader.text(this.content.shareInstructions),this.$embedHeader.text(this.content.embedInstructions)):(this.$shareHeader.hide(),this.$embedHeader.hide())},t.prototype.getSelectedSize=function(){return this.$customSizeDropDown.find(":selected")},t.prototype.updateWidthRatio=function(){this.currentHeight=Number(this.$heightInput.val()),this.currentHeight<this.minHeight?(this.currentHeight=this.minHeight,this.$heightInput.val(String(this.currentHeight))):this.currentHeight>this.maxHeight&&(this.currentHeight=this.maxHeight,this.$heightInput.val(String(this.currentHeight))),this.currentWidth=Math.floor(this.currentHeight/this.aspectRatio),this.$widthInput.val(String(this.currentWidth))},t.prototype.updateHeightRatio=function(){this.currentWidth=Number(this.$widthInput.val()),this.currentWidth<this.minWidth?(this.currentWidth=this.minWidth,this.$widthInput.val(String(this.currentWidth))):this.currentWidth>this.maxWidth&&(this.currentWidth=this.maxWidth,this.$widthInput.val(String(this.currentWidth))),this.currentHeight=Math.floor(this.currentWidth*this.aspectRatio),this.$heightInput.val(String(this.currentHeight))},t.prototype.updateShareFrame=function(){var e=this.extension.helper.getShareServiceUrl();e&&(Utils.Bools.getBool(this.config.options.shareFrameEnabled,!0)&&e?(this.$shareFrame.prop("src",e),this.$shareFrame.show()):this.$shareFrame.hide())},t.prototype.updateTermsOfUseButton=function(){var e=this.extension.helper.getRequiredStatement();Utils.Bools.getBool(this.extension.data.config.options.termsOfUseEnabled,!1)&&e&&e.value?this.$termsOfUseButton.show():this.$termsOfUseButton.hide()},t.prototype.openShareView=function(){this.isShareViewVisible=!0,this.isEmbedViewVisible=!1,this.$embedView.hide(),this.$shareView.show(),this.$shareButton.addClass("on default"),this.$embedButton.removeClass("on default"),this.resize()},t.prototype.openEmbedView=function(){this.isShareViewVisible=!1,this.isEmbedViewVisible=!0,this.$embedView.show(),this.$shareView.hide(),this.$shareButton.removeClass("on default"),this.$embedButton.addClass("on default"),this.resize()},t.prototype.close=function(){e.prototype.close.call(this)},t.prototype.getViews=function(){return this.$tabsContent.find(".view")},t.prototype.equaliseViewHeights=function(){this.getViews().equaliseHeight(!0)},t.prototype.resize=function(){this.equaliseViewHeights(),this.setDockedPosition()},t}(i.Dialogue);t.ShareDialogue=o});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("extensions/uv-av-extension/ShareDialogue",["require","exports","../../modules/uv-dialogues-module/ShareDialogue"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){this.setConfig("shareDialogue"),e.prototype.create.call(this)},t.prototype.update=function(){e.prototype.update.call(this),this.code=this.extension.getEmbedScript(this.options.embedTemplate,this.currentWidth,this.currentHeight),this.$code.val(this.code)},t.prototype.resize=function(){e.prototype.resize.call(this)},t}(n.ShareDialogue);t.ShareDialogue=i});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("extensions/uv-av-extension/Extension",["require","exports","@iiif/vocabulary","../../modules/uv-avcenterpanel-module/AVCenterPanel","../../modules/uv-shared-module/BaseEvents","../../modules/uv-shared-module/BaseExtension","../../modules/uv-contentleftpanel-module/ContentLeftPanel","./DownloadDialogue","../../modules/uv-shared-module/FooterPanel","../../modules/uv-avmobilefooterpanel-module/MobileFooter","../../modules/uv-shared-module/HeaderPanel","../../modules/uv-moreinforightpanel-module/MoreInfoRightPanel","./SettingsDialogue","./ShareDialogue"],function(e,t,n,i,o,r,s,a,u,l,c,h,p,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.create=function(){var t=this;e.prototype.create.call(this),this.component.subscribe(o.BaseEvents.CANVAS_INDEX_CHANGED,function(e){t.viewCanvas(e)}),this.component.subscribe(o.BaseEvents.TREE_NODE_SELECTED,function(e){t.fire(o.BaseEvents.TREE_NODE_SELECTED,e.data.path),t.treeNodeSelected(e)}),this.component.subscribe(o.BaseEvents.THUMB_SELECTED,function(e){t.data.canvasIndex!==e.index&&t.component.publish(o.BaseEvents.CANVAS_INDEX_CHANGED,e.index)})},t.prototype.dependencyLoaded=function(e,t){e===this.getDependencyIndex("waveform-data")?window.WaveformData=t:e===this.getDependencyIndex("hls")&&(window.Hls=t)},t.prototype.createModules=function(){e.prototype.createModules.call(this),this.isHeaderPanelEnabled()?this.headerPanel=new c.HeaderPanel(this.shell.$headerPanel):this.shell.$headerPanel.hide(),this.isLeftPanelEnabled()?this.leftPanel=new s.ContentLeftPanel(this.shell.$leftPanel):this.shell.$leftPanel.hide(),this.centerPanel=new i.AVCenterPanel(this.shell.$centerPanel),this.isRightPanelEnabled()?this.rightPanel=new h.MoreInfoRightPanel(this.shell.$rightPanel):this.shell.$rightPanel.hide(),this.isFooterPanelEnabled()?(this.footerPanel=new u.FooterPanel(this.shell.$footerPanel),this.mobileFooterPanel=new l.FooterPanel(this.shell.$mobileFooterPanel)):this.shell.$footerPanel.hide(),this.$shareDialogue=$('<div class="overlay share" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$shareDialogue),this.shareDialogue=new d.ShareDialogue(this.$shareDialogue),this.$downloadDialogue=$('<div class="overlay download" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$downloadDialogue),this.downloadDialogue=new a.DownloadDialogue(this.$downloadDialogue),this.$settingsDialogue=$('<div class="overlay settings" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$settingsDialogue),this.settingsDialogue=new p.SettingsDialogue(this.$settingsDialogue),this.isHeaderPanelEnabled()&&this.headerPanel.init(),this.isLeftPanelEnabled()&&this.leftPanel.init(),this.isRightPanelEnabled()&&this.rightPanel.init(),this.isFooterPanelEnabled()&&this.footerPanel.init()},t.prototype.isLeftPanelEnabled=function(){var t=e.prototype.isLeftPanelEnabled.call(this),n=this.helper.getTree();return n&&n.nodes.length&&(t=!0),t},t.prototype.render=function(){e.prototype.render.call(this)},t.prototype.isThumbsViewOpen=function(){return this.leftPanel?this.leftPanel.isThumbsViewOpen:!1},t.prototype.getEmbedScript=function(e,t,n){var i=this.getAppUri(),o=i+"#?manifest="+this.helper.manifestUri+"&c="+this.helper.collectionIndex+"&m="+this.helper.manifestIndex+"&s="+this.helper.sequenceIndex+"&cv="+this.helper.canvasIndex+"&rid="+this.helper.rangeId;return Utils.Strings.format(e,o,t.toString(),n.toString())},t.prototype.treeNodeSelected=function(e){var t=e.data;if(t.type)switch(t.type){case n.IIIFResourceType.MANIFEST.toString():break;case n.IIIFResourceType.COLLECTION.toString():break;default:this.viewRange(t.path)}},t.prototype.viewRange=function(e){var t=this.helper.getRangeByPath(e);t&&this.component.publish(o.BaseEvents.RANGE_CHANGED,t)},t}(r.BaseExtension);t.Extension=f});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-filelinkcenterpanel-module/FileLinkCenterPanel",["require","exports","manifesto.js","../uv-shared-module/BaseEvents","../uv-shared-module/CenterPanel","../../Utils"],function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("fileLinkCenterPanel"),e.prototype.create.call(this),this.component.subscribe(i.BaseEvents.OPEN_EXTERNAL_RESOURCE,function(e){t.openMedia(e)}),this.$scroll=$('<div class="scroll"></div>'),this.$content.append(this.$scroll),this.$downloadItems=$("<ol></ol>"),this.$scroll.append(this.$downloadItems),this.$downloadItemTemplate=$('<li><img/><div class="col2"><a class="filename" target="_blank" download=""></a><span class="label"></span><a class="description" target="_blank" download=""></a></div></li>'),this.title=this.extension.helper.getLabel()},t.prototype.openMedia=function(e){var t=this;this.extension.getExternalResources(e).then(function(){for(var e,i=t.extension.helper.getCurrentCanvas(),o=i.getContent(),s=0;s<o.length;s++){var a=o[s];if(a.getBody().length){e=t.$downloadItemTemplate.clone();var u=e.find(".filename"),l=e.find(".label"),c=e.find("img"),h=e.find(".description"),p=a.getBody()[0],d=p.getProperty("id");d&&(u.prop("href",d),u.text(d.substr(d.lastIndexOf("/")+1)));var f=n.LanguageMap.getValue(p.getLabel());f&&l.text(r.UVUtils.sanitize(f));var g=a.getProperty("thumbnail");g?c.prop("src",g):c.hide();var v=p.getProperty("description");v&&(h.text(r.UVUtils.sanitize(v)),d&&h.prop("href",d)),t.$downloadItems.append(e)}}})},t.prototype.resize=function(){e.prototype.resize.call(this),this.title&&this.$title.text(r.UVUtils.sanitize(this.title)),this.$scroll.height(this.$content.height()-this.$scroll.verticalMargins())},t}(o.CenterPanel);t.FileLinkCenterPanel=s});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-dialogues-module/HelpDialogue",["require","exports","../uv-shared-module/BaseEvents","../uv-shared-module/Dialogue"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("helpDialogue"),e.prototype.create.call(this),this.openCommand=n.BaseEvents.SHOW_HELP_DIALOGUE,this.closeCommand=n.BaseEvents.HIDE_HELP_DIALOGUE,this.component.subscribe(this.openCommand,function(){t.open()}),this.component.subscribe(this.closeCommand,function(){t.close()}),this.$title=$("<h1></h1>"),this.$content.append(this.$title),this.$scroll=$('<div class="scroll"></div>'),this.$content.append(this.$scroll),this.$message=$("<p></p>"),this.$scroll.append(this.$message),this.$title.text(this.content.title),this.$message.html(this.content.text),this.$message.targetBlank(),this.$element.hide()},t.prototype.resize=function(){e.prototype.resize.call(this)},t}(i.Dialogue);t.HelpDialogue=o});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-resourcesleftpanel-module/ThumbsView",["require","exports","../uv-shared-module/ThumbsView"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.create=function(){this.setConfig("resourcesLeftPanel"),e.prototype.create.call(this)},t}(n.ThumbsView);t.ThumbsView=i});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-resourcesleftpanel-module/ResourcesLeftPanel",["require","exports","../uv-shared-module/BaseEvents","../uv-shared-module/LeftPanel","./ThumbsView","manifesto.js","@iiif/vocabulary"],function(e,t,n,i,o,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){this.setConfig("resourcesLeftPanel"),e.prototype.create.call(this),this.setTitle(this.content.title),this.$tabsContent=$('<div class="tabsContent"></div>'),this.$main.append(this.$tabsContent),this.$views=$('<div class="views"></div>'),this.$tabsContent.append(this.$views),this.$thumbsView=$('<div class="thumbsView"></div>'),this.$views.append(this.$thumbsView),this.$resourcesView=$('<div class="resourcesView"></div>'),this.$resources=$("<ul></ul>"),this.$resourcesView.append(this.$resources),this.$views.append(this.$resourcesView),this.thumbsView=new o.ThumbsView(this.$thumbsView),this.dataBind()},t.prototype.dataBind=function(){this.dataBindThumbsView();var e=this.extension.helper.getCurrentCanvas().getResources();0===e.length&&this.$resourcesView.hide();for(var t=0;t<e.length;t++){var n=e[t],i=n.getResource();if(i){var o=r.LanguageMap.getValue(i.getLabel());if(o){var s=Utils.Files.simplifyMimeType(i.getFormat().toString()),a=$('<li><a href="'+i.id+'" target="_blank">'+o+" ("+s+")</li>");this.$resources.append(a)}}}},t.prototype.dataBindThumbsView=function(){if(this.thumbsView){var e,t,n=this.extension.helper.getViewingDirection();!n||n.toString()!==s.ViewingDirection.LEFT_TO_RIGHT.toString()&&n.toString()!==s.ViewingDirection.RIGHT_TO_LEFT.toString()?(e=this.config.options.oneColThumbWidth,t=this.config.options.oneColThumbHeight):(e=this.config.options.twoColThumbWidth,t=this.config.options.twoColThumbHeight),"undefined"==typeof e&&(e=100),"undefined"==typeof t&&(t=100),this.thumbsView.thumbs=this.extension.helper.getThumbs(e,t),this.thumbsView.thumbs.length<2&&this.$thumbsView.hide(),this.thumbsView.databind()}},t.prototype.expandFullStart=function(){e.prototype.expandFullStart.call(this),this.component.publish(n.BaseEvents.LEFTPANEL_EXPAND_FULL_START)},t.prototype.expandFullFinish=function(){e.prototype.expandFullFinish.call(this),this.component.publish(n.BaseEvents.LEFTPANEL_EXPAND_FULL_FINISH)},t.prototype.collapseFullStart=function(){e.prototype.collapseFullStart.call(this),this.component.publish(n.BaseEvents.LEFTPANEL_COLLAPSE_FULL_START)},t.prototype.collapseFullFinish=function(){e.prototype.collapseFullFinish.call(this),this.component.publish(n.BaseEvents.LEFTPANEL_COLLAPSE_FULL_FINISH)},t.prototype.resize=function(){e.prototype.resize.call(this),this.$views.height(this.$main.height()),this.$resources.height(this.$main.height())},t}(i.LeftPanel);t.ResourcesLeftPanel=a});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("extensions/uv-default-extension/SettingsDialogue",["require","exports","../../modules/uv-dialogues-module/SettingsDialogue"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){this.setConfig("settingsDialogue"),e.prototype.create.call(this)},t}(n.SettingsDialogue);t.SettingsDialogue=i});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("extensions/uv-default-extension/ShareDialogue",["require","exports","../../modules/uv-dialogues-module/ShareDialogue"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){this.setConfig("shareDialogue"),e.prototype.create.call(this)},t.prototype.update=function(){e.prototype.update.call(this),this.code=this.extension.getEmbedScript(this.options.embedTemplate,this.currentWidth,this.currentHeight),this.$code.val(this.code)},t.prototype.resize=function(){e.prototype.resize.call(this)},t}(n.ShareDialogue);t.ShareDialogue=i});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("extensions/uv-default-extension/Extension",["require","exports","../../modules/uv-shared-module/BaseEvents","../../modules/uv-shared-module/BaseExtension","../../modules/uv-filelinkcenterpanel-module/FileLinkCenterPanel","../../modules/uv-shared-module/FooterPanel","../../modules/uv-shared-module/HeaderPanel","../../modules/uv-dialogues-module/HelpDialogue","../../modules/uv-moreinforightpanel-module/MoreInfoRightPanel","../../modules/uv-resourcesleftpanel-module/ResourcesLeftPanel","./SettingsDialogue","./ShareDialogue"],function(e,t,n,i,o,r,s,a,u,l,c,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.create=function(){var t=this;e.prototype.create.call(this),$(window).bind("enterfullscreen",function(){t.component.publish(n.BaseEvents.TOGGLE_FULLSCREEN)}),$(window).bind("exitfullscreen",function(){t.component.publish(n.BaseEvents.TOGGLE_FULLSCREEN)}),this.component.subscribe(n.BaseEvents.CANVAS_INDEX_CHANGED,function(e){t.viewCanvas(e)}),this.component.subscribe(n.BaseEvents.THUMB_SELECTED,function(e){t.component.publish(n.BaseEvents.CANVAS_INDEX_CHANGED,e)})},t.prototype.createModules=function(){e.prototype.createModules.call(this),this.isHeaderPanelEnabled()?this.headerPanel=new s.HeaderPanel(this.shell.$headerPanel):this.shell.$headerPanel.hide(),this.isLeftPanelEnabled()&&(this.leftPanel=new l.ResourcesLeftPanel(this.shell.$leftPanel)),this.centerPanel=new o.FileLinkCenterPanel(this.shell.$centerPanel),this.isRightPanelEnabled()&&(this.rightPanel=new u.MoreInfoRightPanel(this.shell.$rightPanel)),this.isFooterPanelEnabled()?this.footerPanel=new r.FooterPanel(this.shell.$footerPanel):this.shell.$footerPanel.hide(),this.$helpDialogue=$('<div class="overlay help" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$helpDialogue),this.helpDialogue=new a.HelpDialogue(this.$helpDialogue),this.$shareDialogue=$('<div class="overlay share" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$shareDialogue),this.shareDialogue=new h.ShareDialogue(this.$shareDialogue),this.$settingsDialogue=$('<div class="overlay settings" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$settingsDialogue),this.settingsDialogue=new c.SettingsDialogue(this.$settingsDialogue),this.isLeftPanelEnabled()&&this.leftPanel.init(),this.isRightPanelEnabled()&&this.rightPanel.init()},t.prototype.render=function(){e.prototype.render.call(this)},t.prototype.isLeftPanelEnabled=function(){return Utils.Bools.getBool(this.data.config.options.leftPanelEnabled,!0)&&(this.helper.isMultiCanvas()||this.helper.isMultiSequence()||this.helper.hasResources())},t.prototype.getEmbedScript=function(e,t,n){var i=this.getAppUri(),o=i+"#?manifest="+this.helper.manifestUri+"&c="+this.helper.collectionIndex+"&m="+this.helper.manifestIndex+"&s="+this.helper.sequenceIndex+"&cv="+this.helper.canvasIndex;return Utils.Strings.format(e,o,t.toString(),n.toString())},t}(i.BaseExtension);t.Extension=p}),define("extensions/uv-ebook-extension/Events",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.namespace="ebookExtension.",e.CFI_FRAGMENT_CHANGED=e.namespace+"cfiFragmentChanged",e.ITEM_CLICKED=e.namespace+"itemClicked",e.LOADED_NAVIGATION=e.namespace+"loadedNavigation",e.RELOCATED=e.namespace+"relocated",e.RENDITION_ATTACHED=e.namespace+"renditionAttached",e.TOC_READY=e.namespace+"tocReady",e}();t.Events=n});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-ebookleftpanel-module/EbookLeftPanel",["require","exports","../uv-shared-module/BaseEvents","../uv-shared-module/LeftPanel","../../extensions/uv-ebook-extension/Events"],function(e,t,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("ebookLeftPanel"),e.prototype.create.call(this),this._$container=$('<div class="container"></div>'),this._ebookTOC=document.createElement("uv-ebook-toc"),this._$ebookTOC=$(this._ebookTOC),this.$main.addClass("disabled"),this.$main.append(this._$container),this._$container.append(this._$ebookTOC),this.setTitle(this.content.title),this.component.subscribe(o.Events.LOADED_NAVIGATION,function(e){t.$main.removeClass("disabled"),t._ebookTOC.toc=e.toc}),this.component.subscribe(o.Events.RELOCATED,function(e){t._ebookTOC.selected=e.start.href}),this._ebookTOC.addEventListener("itemClicked",function(e){t.component.publish(o.Events.ITEM_CLICKED,e.detail)},!1),Utils.Async.waitFor(function(){return void 0!==window.customElements},function(){customElements.whenDefined("uv-ebook-toc").then(function(){t.component.publish(o.Events.TOC_READY)})})},t.prototype.expandFullStart=function(){e.prototype.expandFullStart.call(this),this.component.publish(n.BaseEvents.LEFTPANEL_EXPAND_FULL_START)},t.prototype.expandFullFinish=function(){e.prototype.expandFullFinish.call(this),this.component.publish(n.BaseEvents.LEFTPANEL_EXPAND_FULL_FINISH)},t.prototype.collapseFullStart=function(){e.prototype.collapseFullStart.call(this),this.component.publish(n.BaseEvents.LEFTPANEL_COLLAPSE_FULL_START)},t.prototype.collapseFullFinish=function(){e.prototype.collapseFullFinish.call(this),this.component.publish(n.BaseEvents.LEFTPANEL_COLLAPSE_FULL_FINISH)},t.prototype.resize=function(){e.prototype.resize.call(this),this._$container.height(this.$main.height()-this._$container.verticalPadding())},t}(i.LeftPanel);t.EbookLeftPanel=r});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("extensions/uv-ebook-extension/DownloadDialogue",["require","exports","../../modules/uv-dialogues-module/DownloadDialogue"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){this.setConfig("downloadDialogue"),e.prototype.create.call(this)},t.prototype.open=function(t){e.prototype.open.call(this,t),this.addEntireFileDownloadOptions(),this.updateNoneAvailable(),this.resize()},t.prototype.isDownloadOptionAvailable=function(t){return e.prototype.isDownloadOptionAvailable.call(this,t)},t}(n.DownloadDialogue);t.DownloadDialogue=i});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-ebookcenterpanel-module/EbookCenterPanel",["require","exports","../uv-shared-module/BaseEvents","../uv-shared-module/CenterPanel","../../extensions/uv-ebook-extension/Events","../uv-shared-module/Position"],function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{
value:!0});var s=function(e){function t(t){var n=e.call(this,t)||this;return n._ebookReaderReady=!1,n._state={},n._prevState={},n.attributionPosition=r.Position.BOTTOM_RIGHT,n}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("ebookCenterPanel"),e.prototype.create.call(this),this._ebookReader=document.createElement("uv-ebook-reader"),this.$content.prepend(this._ebookReader),this._ebookReader.setAttribute("width","100%"),this._ebookReader.setAttribute("height","100%"),this._ebookReader.addEventListener("loadedNavigation",function(e){t.component.publish(o.Events.LOADED_NAVIGATION,e.detail)},!1),this._ebookReader.addEventListener("relocated",function(e){t.component.publish(o.Events.RELOCATED,e.detail),t._cfi=e.detail.start.cfi,t.component.publish(o.Events.CFI_FRAGMENT_CHANGED,t._cfi)},!1),Utils.Async.waitFor(function(){return void 0!==window.customElements},function(){customElements.whenDefined("uv-ebook-reader").then(function(){t._ebookReaderReady=!0})});var i=this;this.component.subscribe(n.BaseEvents.OPEN_EXTERNAL_RESOURCE,function(e,t){i.openMedia(t)}),this.component.subscribe(o.Events.ITEM_CLICKED,function(e){t._nextState({cfi:e})}),this.component.subscribe(o.Events.CFI_FRAGMENT_CHANGED,function(e){Utils.Async.waitFor(function(){return t._ebookReaderReady},function(){e!==t._cfi&&t._nextState({cfi:e})})})},t.prototype.openMedia=function(e){var t=this;this.extension.getExternalResources(e).then(function(){var e=t.extension.helper.getCurrentCanvas(),i=e.getContent();if(i.length){var o=i[0],r=o.getBody();if(r.length){var s=r[0];t._nextState({bookPath:s.id})}}t.component.publish(n.BaseEvents.RESIZE)})},t.prototype._nextState=function(e){var t=this;this._state=Object.assign({},this._state,e),Utils.Async.waitFor(function(){return t._ebookReaderReady},function(){t._state.bookPath&&t._state.bookPath!==t._prevState.bookPath&&t._ebookReader.load(t._state.bookPath),t._state.cfi&&t._state.cfi!==t._prevState.cfi&&t._ebookReader.display(t._state.cfi),t._prevState=Object.assign({},t._state)})},t.prototype.resize=function(){var t=this;e.prototype.resize.call(this),this._ebookReaderReady&&setTimeout(function(){t._ebookReader.resize()},10)},t}(i.CenterPanel);t.EbookCenterPanel=s});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-ebookmobilefooterpanel-module/MobileFooter",["require","exports","../uv-shared-module/FooterPanel"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){this.setConfig("mobileFooterPanel"),e.prototype.create.call(this)},t.prototype.resize=function(){e.prototype.resize.call(this),this.$options.css("left",Math.floor(this.$element.width()/2-this.$options.width()/2))},t}(n.FooterPanel);t.FooterPanel=i});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-dialogues-module/MoreInfoDialogue",["require","exports","../uv-shared-module/BaseEvents","../uv-shared-module/Dialogue","../../Utils","@iiif/iiif-metadata-component"],function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("moreInfoDialogue"),e.prototype.create.call(this),this.openCommand=n.BaseEvents.SHOW_MOREINFO_DIALOGUE,this.closeCommand=n.BaseEvents.HIDE_MOREINFO_DIALOGUE,this.component.subscribe(this.openCommand,function(e){t.open(e)}),this.component.subscribe(this.closeCommand,function(){t.close()}),this.config.content=this.extension.data.config.modules.moreInfoRightPanel.content,this.config.options=this.extension.data.config.modules.moreInfoRightPanel.options,this.$title=$("<h1>"+this.config.content.title+"</h1>"),this.$content.append(this.$title),this.$metadata=$('<div class="iiif-metadata-component"></div>'),this.$content.append(this.$metadata),this.metadataComponent=new r.MetadataComponent({target:this.$metadata[0]}),this.$element.hide()},t.prototype.open=function(t){e.prototype.open.call(this,t),this.metadataComponent.set(this._getData())},t.prototype._getData=function(){return{canvasDisplayOrder:this.config.options.canvasDisplayOrder,canvases:this.extension.getCurrentCanvases(),canvasExclude:this.config.options.canvasExclude,canvasLabels:this.extension.getCanvasLabels(this.content.page),content:this.config.content,copiedMessageDuration:2e3,copyToClipboardEnabled:Utils.Bools.getBool(this.config.options.copyToClipboardEnabled,!1),helper:this.extension.helper,licenseFormatter:null,limit:this.config.options.textLimit||4,limitType:r.LimitType.LINES,manifestDisplayOrder:this.config.options.manifestDisplayOrder,manifestExclude:this.config.options.manifestExclude,range:this.extension.getCurrentCanvasRange(),rtlLanguageCodes:this.config.options.rtlLanguageCodes,sanitizer:function(e){return o.UVUtils.sanitize(e)},showAllLanguages:this.config.options.showAllLanguages}},t.prototype.close=function(){e.prototype.close.call(this)},t.prototype.resize=function(){this.setDockedPosition()},t}(i.Dialogue);t.MoreInfoDialogue=s});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("extensions/uv-ebook-extension/SettingsDialogue",["require","exports","../../modules/uv-dialogues-module/SettingsDialogue"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){this.setConfig("settingsDialogue"),e.prototype.create.call(this)},t}(n.SettingsDialogue);t.SettingsDialogue=i});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("extensions/uv-ebook-extension/ShareDialogue",["require","exports","../../modules/uv-dialogues-module/ShareDialogue"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){this.setConfig("shareDialogue"),e.prototype.create.call(this)},t.prototype.update=function(){e.prototype.update.call(this),this.code=this.extension.getEmbedScript(this.options.embedTemplate,this.currentWidth,this.currentHeight),this.$code.val(this.code)},t.prototype.resize=function(){e.prototype.resize.call(this)},t}(n.ShareDialogue);t.ShareDialogue=i});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("extensions/uv-ebook-extension/Extension",["require","exports","../../modules/uv-shared-module/BaseEvents","../../modules/uv-shared-module/BaseExtension","../../modules/uv-ebookleftpanel-module/EbookLeftPanel","./Events","./DownloadDialogue","../../modules/uv-ebookcenterpanel-module/EbookCenterPanel","../../modules/uv-shared-module/FooterPanel","../../modules/uv-ebookmobilefooterpanel-module/MobileFooter","../../modules/uv-shared-module/HeaderPanel","../../modules/uv-dialogues-module/MoreInfoDialogue","../../modules/uv-moreinforightpanel-module/MoreInfoRightPanel","./SettingsDialogue","./ShareDialogue"],function(e,t,n,i,o,r,s,a,u,l,c,h,p,d,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.create=function(){var t=this;e.prototype.create.call(this),this.component.subscribe(n.BaseEvents.CANVAS_INDEX_CHANGED,function(e){t.viewCanvas(e)}),this.component.subscribe(r.Events.CFI_FRAGMENT_CHANGED,function(e){t.cfiFragement=e,t.fire(r.Events.CFI_FRAGMENT_CHANGED,t.cfiFragement)})},t.prototype.dependencyLoaded=function(e,t){},t.prototype.createModules=function(){e.prototype.createModules.call(this),this.isHeaderPanelEnabled()?this.headerPanel=new c.HeaderPanel(this.shell.$headerPanel):this.shell.$headerPanel.hide(),this.isLeftPanelEnabled()?this.leftPanel=new o.EbookLeftPanel(this.shell.$leftPanel):this.shell.$leftPanel.hide(),this.centerPanel=new a.EbookCenterPanel(this.shell.$centerPanel),this.isRightPanelEnabled()?this.rightPanel=new p.MoreInfoRightPanel(this.shell.$rightPanel):this.shell.$rightPanel.hide(),this.isFooterPanelEnabled()?(this.footerPanel=new u.FooterPanel(this.shell.$footerPanel),this.mobileFooterPanel=new l.FooterPanel(this.shell.$mobileFooterPanel)):this.shell.$footerPanel.hide(),this.$moreInfoDialogue=$('<div class="overlay moreInfo" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$moreInfoDialogue),this.moreInfoDialogue=new h.MoreInfoDialogue(this.$moreInfoDialogue),this.$shareDialogue=$('<div class="overlay share" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$shareDialogue),this.shareDialogue=new f.ShareDialogue(this.$shareDialogue),this.$downloadDialogue=$('<div class="overlay download" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$downloadDialogue),this.downloadDialogue=new s.DownloadDialogue(this.$downloadDialogue),this.$settingsDialogue=$('<div class="overlay settings" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$settingsDialogue),this.settingsDialogue=new d.SettingsDialogue(this.$settingsDialogue),this.isHeaderPanelEnabled()&&this.headerPanel.init(),this.isLeftPanelEnabled()&&this.leftPanel.init(),this.isRightPanelEnabled()&&this.rightPanel.init(),this.isFooterPanelEnabled()&&this.footerPanel.init()},t.prototype.isLeftPanelEnabled=function(){return!0},t.prototype.render=function(){e.prototype.render.call(this),this.checkForCFIParam()},t.prototype.getEmbedScript=function(e,t,n){var i=this.getAppUri(),o=i+"#?manifest="+this.helper.manifestUri+"&cfi="+this.cfiFragement,r=Utils.Strings.format(e,o,t.toString(),n.toString());return r},t.prototype.checkForCFIParam=function(){var e=this.data.cfi;e&&this.component.publish(r.Events.CFI_FRAGMENT_CHANGED,e)},t}(i.BaseExtension);t.Extension=g}),define("modules/uv-shared-module/Bookmark",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e}();t.Bookmark=n});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("extensions/uv-mediaelement-extension/DownloadDialogue",["require","exports","../../modules/uv-dialogues-module/DownloadDialogue"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){this.setConfig("downloadDialogue"),e.prototype.create.call(this)},t.prototype.open=function(t){e.prototype.open.call(this,t),this.addEntireFileDownloadOptions(),this.updateNoneAvailable(),this.resize()},t.prototype.isDownloadOptionAvailable=function(t){return e.prototype.isDownloadOptionAvailable.call(this,t)},t}(n.DownloadDialogue);t.DownloadDialogue=i}),define("extensions/uv-mediaelement-extension/Events",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.namespace="mediaelementExtension.",e.MEDIA_ENDED=e.namespace+"mediaEnded",e.MEDIA_PAUSED=e.namespace+"mediaPaused",e.MEDIA_PLAYED=e.namespace+"mediaPlayed",e}();t.Events=n});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-mediaelementcenterpanel-module/MediaElementCenterPanel",["require","exports","../uv-shared-module/BaseEvents","../../extensions/uv-mediaelement-extension/Events","../uv-shared-module/CenterPanel","../../Utils"],function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){this.setConfig("mediaelementCenterPanel"),e.prototype.create.call(this);var t=this;this.component.subscribe(n.BaseEvents.OPEN_EXTERNAL_RESOURCE,function(e){t.openMedia(e)}),this.$container=$('<div class="container"></div>'),this.$content.append(this.$container),this.title=this.extension.helper.getLabel()},t.prototype.openMedia=function(e){var t=this,n=this;this.extension.getExternalResources(e).then(function(){t.$container.empty();var e=t.extension.helper.getCurrentCanvas();t.mediaHeight=t.config.defaultHeight,t.mediaWidth=t.config.defaultWidth,t.$container.height(t.mediaHeight),t.$container.width(t.mediaWidth);var o=t.extension.getPosterImageUri(),r=[],s=e.getRenderings();if(s&&s.length)e.getRenderings().forEach(function(e){r.push({type:e.getFormat().toString(),src:e.id})});else{var a=t.extension.getMediaFormats(t.extension.helper.getCurrentCanvas());a&&a.length&&a.forEach(function(e){var t=e.getFormat();t&&r.push({type:t.toString(),src:e.id})})}t.isVideo()?(t.$media=$('<video controls="controls" preload="none"></video>'),t.$container.append(t.$media),t.player=new MediaElementPlayer($("video")[0],{poster:o,features:["playpause","current","progress","volume"],success:function(e,t){e.addEventListener("canplay",function(){n.resize()}),e.addEventListener("play",function(){n.component.publish(i.Events.MEDIA_PLAYED,Math.floor(e.currentTime))}),e.addEventListener("pause",function(){Math.floor(e.currentTime)!=Math.floor(e.duration)&&n.component.publish(i.Events.MEDIA_PAUSED,Math.floor(e.currentTime))}),e.addEventListener("ended",function(){n.component.publish(i.Events.MEDIA_ENDED,Math.floor(e.duration))}),e.setSrc(r)}}),t.player.fullscreenBtn={},t.player.fullscreenBtn.classList={},t.player.fullscreenBtn.classList.add=function(){},t.player.fullscreenBtn.classList.remove=function(){}):(t.$media=$('<audio controls="controls" preload="none"></audio>'),t.$container.append(t.$media),t.player=new MediaElementPlayer($("audio")[0],{poster:o,defaultAudioWidth:"auto",defaultAudioHeight:"auto",showPosterWhenPaused:!0,showPosterWhenEnded:!0,success:function(e,t){e.addEventListener("canplay",function(){n.resize()}),e.addEventListener("play",function(){n.component.publish(i.Events.MEDIA_PLAYED,Math.floor(e.currentTime))}),e.addEventListener("pause",function(){Math.floor(e.currentTime)!=Math.floor(e.duration)&&n.component.publish(i.Events.MEDIA_PAUSED,Math.floor(e.currentTime))}),e.addEventListener("ended",function(){n.component.publish(i.Events.MEDIA_ENDED,Math.floor(e.duration))}),e.setSrc(r)}})),t.resize()})},t.prototype.isVideo=function(){return this.extension.isVideo()},t.prototype.resize=function(){if(e.prototype.resize.call(this),"Firefox"===window.browserDetect.browser&&window.browserDetect.version<13)this.$container.width(this.mediaWidth),this.$container.height(this.mediaHeight);else{var t=Utils.Dimensions.fitRect(this.mediaWidth,this.mediaHeight,this.$content.width(),this.$content.height());this.$container.height(t.height),this.$container.width(t.width),this.player&&!this.extension.isFullScreen()&&(this.$media.width(t.width),this.$media.height(t.height))}var n=Math.floor((this.$content.width()-this.$container.width())/2),i=Math.floor((this.$content.height()-this.$container.height())/2);if(this.$container.css({left:n,top:i}),this.title&&this.$title.text(r.UVUtils.sanitize(this.title)),this.player){this.player.setPlayerSize(),this.player.setControlsSize();var o=$(".mejs__container");o.css({"margin-top":(this.$container.height()-o.height())/2})}},t}(o.CenterPanel);t.MediaElementCenterPanel=s});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("extensions/uv-mediaelement-extension/SettingsDialogue",["require","exports","../../modules/uv-dialogues-module/SettingsDialogue"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){this.setConfig("settingsDialogue"),e.prototype.create.call(this)},t}(n.SettingsDialogue);t.SettingsDialogue=i});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("extensions/uv-mediaelement-extension/ShareDialogue",["require","exports","../../modules/uv-dialogues-module/ShareDialogue"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){this.setConfig("shareDialogue"),e.prototype.create.call(this)},t.prototype.update=function(){e.prototype.update.call(this),this.code=this.extension.getEmbedScript(this.options.embedTemplate,this.currentWidth,this.currentHeight),this.$code.val(this.code)},t.prototype.resize=function(){e.prototype.resize.call(this)},t}(n.ShareDialogue);t.ShareDialogue=i});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("extensions/uv-mediaelement-extension/Extension",["require","exports","manifesto.js","../../modules/uv-shared-module/BaseEvents","../../modules/uv-shared-module/BaseExtension","../../modules/uv-shared-module/Bookmark","./DownloadDialogue","./Events","../../modules/uv-shared-module/FooterPanel","../../modules/uv-shared-module/HeaderPanel","../../modules/uv-dialogues-module/HelpDialogue","../../modules/uv-mediaelementcenterpanel-module/MediaElementCenterPanel","../../modules/uv-moreinforightpanel-module/MoreInfoRightPanel","../../modules/uv-resourcesleftpanel-module/ResourcesLeftPanel","./SettingsDialogue","./ShareDialogue","@iiif/vocabulary"],function(e,t,n,i,o,r,s,a,u,l,c,h,p,d,f,g,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var _=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.create=function(){var t=this;e.prototype.create.call(this),$(window).bind("enterfullscreen",function(){t.component.publish(i.BaseEvents.TOGGLE_FULLSCREEN)}),$(window).bind("exitfullscreen",function(){t.component.publish(i.BaseEvents.TOGGLE_FULLSCREEN)}),this.component.subscribe(i.BaseEvents.CANVAS_INDEX_CHANGED,function(e){t.viewCanvas(e)}),this.component.subscribe(i.BaseEvents.THUMB_SELECTED,function(e){t.component.publish(i.BaseEvents.CANVAS_INDEX_CHANGED,e.index)}),this.component.subscribe(i.BaseEvents.LEFTPANEL_EXPAND_FULL_START,function(){t.shell.$centerPanel.hide(),t.shell.$rightPanel.hide()}),this.component.subscribe(i.BaseEvents.LEFTPANEL_COLLAPSE_FULL_FINISH,function(){t.shell.$centerPanel.show(),t.shell.$rightPanel.show(),t.resize()}),this.component.subscribe(a.Events.MEDIA_ENDED,function(){t.fire(a.Events.MEDIA_ENDED)}),this.component.subscribe(a.Events.MEDIA_PAUSED,function(){t.fire(a.Events.MEDIA_PAUSED)}),this.component.subscribe(a.Events.MEDIA_PLAYED,function(){t.fire(a.Events.MEDIA_PLAYED)})},t.prototype.createModules=function(){e.prototype.createModules.call(this),this.isHeaderPanelEnabled()?this.headerPanel=new l.HeaderPanel(this.shell.$headerPanel):this.shell.$headerPanel.hide(),this.isLeftPanelEnabled()&&(this.leftPanel=new d.ResourcesLeftPanel(this.shell.$leftPanel)),this.centerPanel=new h.MediaElementCenterPanel(this.shell.$centerPanel),this.isRightPanelEnabled()&&(this.rightPanel=new p.MoreInfoRightPanel(this.shell.$rightPanel)),this.isFooterPanelEnabled()?this.footerPanel=new u.FooterPanel(this.shell.$footerPanel):this.shell.$footerPanel.hide(),this.$helpDialogue=$('<div class="overlay help" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$helpDialogue),this.helpDialogue=new c.HelpDialogue(this.$helpDialogue),this.$downloadDialogue=$('<div class="overlay download" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$downloadDialogue),this.downloadDialogue=new s.DownloadDialogue(this.$downloadDialogue),this.$shareDialogue=$('<div class="overlay share" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$shareDialogue),this.shareDialogue=new g.ShareDialogue(this.$shareDialogue),this.$settingsDialogue=$('<div class="overlay settings" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$settingsDialogue),this.settingsDialogue=new f.SettingsDialogue(this.$settingsDialogue),this.isLeftPanelEnabled()&&this.leftPanel.init(),this.isRightPanelEnabled()&&this.rightPanel.init()},t.prototype.render=function(){e.prototype.render.call(this)},t.prototype.isLeftPanelEnabled=function(){return Utils.Bools.getBool(this.data.config.options.leftPanelEnabled,!0)&&(this.helper.isMultiCanvas()||this.helper.isMultiSequence()||this.helper.hasResources())},t.prototype.bookmark=function(){e.prototype.bookmark.call(this);var t=this.extensions.helper.getCurrentCanvas(),o=new r.Bookmark;o.index=this.helper.canvasIndex,o.label=n.LanguageMap.getValue(t.getLabel()),o.thumb=t.getProperty("thumbnail"),o.title=this.helper.getLabel(),o.trackingLabel=window.trackingLabel,this.isVideo()?o.type=v.ExternalResourceType.MOVING_IMAGE.toString():o.type=v.ExternalResourceType.SOUND.toString(),this.fire(i.BaseEvents.BOOKMARK,o)},t.prototype.getEmbedScript=function(e,t,n){var i=this.getAppUri(),o=i+"#?manifest="+this.helper.manifestUri+"&c="+this.helper.collectionIndex+"&m="+this.helper.manifestIndex+"&s="+this.helper.sequenceIndex+"&cv="+this.helper.canvasIndex;return Utils.Strings.format(e,o,t.toString(),n.toString())},t.prototype.getPosterImageUri=function(){var e=this.helper.getCurrentCanvas(),t=e.getContent();return t&&t.length?t[0].getProperty("thumbnail"):e.getProperty("thumbnail")},t.prototype.isVideoFormat=function(e){var t=[v.MediaType.VIDEO_MP4.toString(),v.MediaType.WEBM.toString()];return-1!=t.indexOf(e)},t.prototype.isVideo=function(){var e=this.helper.getCurrentCanvas(),t=e.getContent();if(t&&t.length){for(var n=this.getMediaFormats(e),i=0;i<n.length;i++){var o=n[i],r=o.getFormat();if(r&&this.isVideoFormat(r.toString()))return!0}return!1}var r=e.getType();if(r)return r.toString()===v.ExternalResourceType.MOVING_IMAGE.toString();throw new Error("Unable to determine media type")},t}(o.BaseExtension);t.Extension=_}),define("modules/uv-shared-module/AnnotationResults",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e}();t.AnnotationResults=n}),define("modules/uv-shared-module/Point",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.x=e,this.y=t}return e}();t.Point=n}),define("extensions/uv-seadragon-extension/CroppedImageDimensions",["require","exports","../../modules/uv-shared-module/Point"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=Utils.Size,o=function(){function e(){this.region=new i(0,0),this.regionPos=new n.Point(0,0),this.size=new i(0,0)}return e}();t.CroppedImageDimensions=o});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("extensions/uv-seadragon-extension/DownloadDialogue",["require","exports","manifesto.js","../../modules/uv-shared-module/BaseEvents","../../modules/uv-dialogues-module/DownloadDialogue","../../modules/uv-shared-module/DownloadOption"],function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("downloadDialogue"),e.prototype.create.call(this),this.$settingsButton=$('<a class="settings" href="#">'+this.content.editSettings+"</a>"),this.$pagingNote=$('<div class="pagingNote">'+this.content.pagingNote+" </div>"),this.$pagingNote.append(this.$settingsButton),this.$content.append(this.$pagingNote),this.$imageOptionsContainer=$('<li class="group image"></li>'),this.$downloadOptions.append(this.$imageOptionsContainer),this.$imageOptions=$("<ul></ul>"),this.$imageOptionsContainer.append(this.$imageOptions),this.$currentViewAsJpgButton=$('<li class="option single"><input id="'+r.DownloadOption.CURRENT_VIEW+'" type="radio" name="downloadOptions" tabindex="0" /><label for="'+r.DownloadOption.CURRENT_VIEW+'"></label></li>'),this.$imageOptions.append(this.$currentViewAsJpgButton),this.$currentViewAsJpgButton.hide(),this.$wholeImageHighResButton=$('<li class="option single"><input id="'+r.DownloadOption.WHOLE_IMAGE_HIGH_RES+'" type="radio" name="downloadOptions" tabindex="0" /><label id="'+r.DownloadOption.WHOLE_IMAGE_HIGH_RES+'label" for="'+r.DownloadOption.WHOLE_IMAGE_HIGH_RES+'"></label></li>'),this.$imageOptions.append(this.$wholeImageHighResButton),this.$wholeImageHighResButton.hide(),this.$wholeImagesHighResButton=$('<li class="option multiple"><input id="'+r.DownloadOption.WHOLE_IMAGES_HIGH_RES+'" type="radio" name="downloadOptions" tabindex="0" /><label id="'+r.DownloadOption.WHOLE_IMAGES_HIGH_RES+'label" for="'+r.DownloadOption.WHOLE_IMAGES_HIGH_RES+'"></label></li>'),this.$imageOptions.append(this.$wholeImagesHighResButton),this.$wholeImageHighResButton.hide(),this.$wholeImageLowResAsJpgButton=$('<li class="option single"><input id="'+r.DownloadOption.WHOLE_IMAGE_LOW_RES+'" type="radio" name="downloadOptions" tabindex="0" /><label for="'+r.DownloadOption.WHOLE_IMAGE_LOW_RES+'">'+this.content.wholeImageLowResAsJpg+"</label></li>"),this.$imageOptions.append(this.$wholeImageLowResAsJpgButton),this.$wholeImageLowResAsJpgButton.hide(),this.$canvasOptionsContainer=$('<li class="group canvas"></li>'),this.$downloadOptions.append(this.$canvasOptionsContainer),this.$canvasOptions=$("<ul></ul>"),this.$canvasOptionsContainer.append(this.$canvasOptions),this.$manifestOptionsContainer=$('<li class="group manifest"></li>'),this.$downloadOptions.append(this.$manifestOptionsContainer),this.$manifestOptions=$("<ul></ul>"),this.$manifestOptionsContainer.append(this.$manifestOptions),this.$selectionButton=$('<li class="option"><input id="'+r.DownloadOption.SELECTION+'" type="radio" name="downloadOptions" tabindex="0" /><label id="'+r.DownloadOption.SELECTION+'label" for="'+r.DownloadOption.SELECTION+'"></label></li>'),this.$manifestOptions.append(this.$selectionButton),this.$selectionButton.hide(),this.$downloadButton=$('<a class="btn btn-primary" href="#" tabindex="0">'+this.content.download+"</a>"),this.$buttons.prepend(this.$downloadButton),this.$explanatoryTextTemplate=$('<span class="explanatory"></span>');var n=this;this.$downloadButton.on("click",function(e){e.preventDefault();var o=n.getSelectedOption(),s=o.attr("id"),a=o.attr("title"),u=o.data("mime"),l=r.DownloadOption.UNKNOWN,c=t.extension.helper.getCurrentCanvas();if(t.renderingUrls[s])u&&(-1!==u.toLowerCase().indexOf("pdf")?l=r.DownloadOption.ENTIRE_DOCUMENT_AS_PDF:-1!==u.toLowerCase().indexOf("txt")&&(l=r.DownloadOption.ENTIRE_DOCUMENT_AS_TEXT)),(l=r.DownloadOption.ENTIRE_DOCUMENT_AS_PDF)&&window.open(t.renderingUrls[s]);else switch(l=s){case r.DownloadOption.CURRENT_VIEW:var h=n.extension.getViewer();window.open(n.extension.getCroppedImageUri(c,h));break;case r.DownloadOption.SELECTION:Utils.Async.waitFor(function(){return!t.isActive},function(){t.component.publish(i.BaseEvents.SHOW_MULTISELECT_DIALOGUE)});break;case r.DownloadOption.WHOLE_IMAGE_HIGH_RES:window.open(t.getCanvasHighResImageUri(t.extension.helper.getCurrentCanvas()));break;case r.DownloadOption.WHOLE_IMAGES_HIGH_RES:for(var p=t.extension.getPagedIndices(),d=0;d<p.length;d++)window.open(t.getCanvasHighResImageUri(t.extension.helper.getCanvasByIndex(p[d])));break;case r.DownloadOption.WHOLE_IMAGE_LOW_RES:var f=n.extension.getConfinedImageUri(c,n.options.confinedImageSize);f&&window.open(f)}t.component.publish(i.BaseEvents.DOWNLOAD,{type:l,label:a}),t.close()}),this.$settingsButton.onPressed(function(){t.component.publish(i.BaseEvents.HIDE_DOWNLOAD_DIALOGUE),t.component.publish(i.BaseEvents.SHOW_SETTINGS_DIALOGUE)})},t.prototype.open=function(t){e.prototype.open.call(this,t);var n=this.extension.helper.getCurrentCanvas(),i=this.extension.getViewerRotation(),o=i%180==0;if(this.isDownloadOptionAvailable(r.DownloadOption.CURRENT_VIEW)){var s=this.$currentViewAsJpgButton.find("input"),a=this.$currentViewAsJpgButton.find("label"),u=this.content.currentViewAsJpg,l=this.extension.getViewer(),c=this.extension.getCroppedImageDimensions(n,l);if(c?(u=o?Utils.Strings.format(u,c.size.width.toString(),c.size.height.toString()):Utils.Strings.format(u,c.size.height.toString(),c.size.width.toString()),a.text(u),s.prop("title",u),this.$currentViewAsJpgButton.data("width",c.size.width),this.$currentViewAsJpgButton.data("height",c.size.height),this.$currentViewAsJpgButton.show()):this.$currentViewAsJpgButton.hide(),Utils.Bools.getBool(this.options.optionsExplanatoryTextEnabled,!1)){var h=this.content.currentViewAsJpgExplanation;if(h){var p=this.$explanatoryTextTemplate.clone();p.text(h),a.append(p)}}}else this.$currentViewAsJpgButton.hide();if(this.isDownloadOptionAvailable(r.DownloadOption.WHOLE_IMAGE_HIGH_RES)){var s=this.$wholeImageHighResButton.find("input"),a=this.$wholeImageHighResButton.find("label"),d=this.getCanvasMimeType(this.extension.helper.getCurrentCanvas());d=d?Utils.Files.simplifyMimeType(d):"?";var f=this.getCanvasComputedDimensions(this.extension.helper.getCurrentCanvas());if(f){var u=o?Utils.Strings.format(this.content.wholeImageHighRes,f.width.toString(),f.height.toString(),d):Utils.Strings.format(this.content.wholeImageHighRes,f.height.toString(),f.width.toString(),d);a.text(u),s.prop("title",u),this.$wholeImageHighResButton.data("width",f.width),this.$wholeImageHighResButton.data("height",f.height),this.$wholeImageHighResButton.show();
}else if(n.externalResource&&!n.externalResource.hasServiceDescriptor()){var u=Utils.Strings.format(this.content.wholeImageHighRes,"?","?",d);a.text(u),s.prop("title",u),this.$wholeImageHighResButton.show()}else this.$wholeImageHighResButton.hide();if(Utils.Bools.getBool(this.options.optionsExplanatoryTextEnabled,!1)){var h=this.content.wholeImageHighResExplanation;if(h){var p=this.$explanatoryTextTemplate.clone();p.text(h),a.append(p)}}}else this.$wholeImageHighResButton.hide();if(this.isDownloadOptionAvailable(r.DownloadOption.WHOLE_IMAGES_HIGH_RES)){var s=this.$wholeImagesHighResButton.find("input"),a=this.$wholeImagesHighResButton.find("label"),d=this.getCanvasMimeType(this.extension.helper.getCurrentCanvas());d=d?Utils.Files.simplifyMimeType(d):"?";var u=Utils.Strings.format(this.content.wholeImagesHighRes,d);if(a.text(u),s.prop("title",u),this.$wholeImagesHighResButton.show(),Utils.Bools.getBool(this.options.optionsExplanatoryTextEnabled,!1)){var h=this.content.wholeImagesHighResExplanation;if(h){var p=this.$explanatoryTextTemplate.clone();p.text(h),a.append(p)}}}else this.$wholeImagesHighResButton.hide();if(this.isDownloadOptionAvailable(r.DownloadOption.WHOLE_IMAGE_LOW_RES)){var s=this.$wholeImageLowResAsJpgButton.find("input"),a=this.$wholeImageLowResAsJpgButton.find("label"),f=this.extension.getConfinedImageDimensions(n,this.options.confinedImageSize),u=o?Utils.Strings.format(this.content.wholeImageLowResAsJpg,f.width.toString(),f.height.toString()):Utils.Strings.format(this.content.wholeImageLowResAsJpg,f.height.toString(),f.width.toString());if(a.text(u),s.prop("title",u),this.$wholeImageLowResAsJpgButton.data("width",f.width),this.$wholeImageLowResAsJpgButton.data("height",f.height),this.$wholeImageLowResAsJpgButton.show(),Utils.Bools.getBool(this.options.optionsExplanatoryTextEnabled,!1)){var h=this.content.wholeImageLowResAsJpgExplanation;if(h){var p=this.$explanatoryTextTemplate.clone();p.text(h),a.append(p)}}}else this.$wholeImageLowResAsJpgButton.hide();if(this.isDownloadOptionAvailable(r.DownloadOption.SELECTION)){var s=this.$selectionButton.find("input"),a=this.$selectionButton.find("label");if(a.text(this.content.downloadSelection),s.prop("title",this.content.downloadSelection),this.$selectionButton.show(),Utils.Bools.getBool(this.options.optionsExplanatoryTextEnabled,!1)){var h=this.content.selectionExplanation;if(h){var p=this.$explanatoryTextTemplate.clone();p.text(h),a.append(p)}}}else this.$selectionButton.hide();if(this.resetDynamicDownloadOptions(),this.isDownloadOptionAvailable(r.DownloadOption.RANGE_RENDERINGS)&&n.ranges&&n.ranges.length)for(var g=0;g<n.ranges.length;g++){var v=n.ranges[g],_=this.getDownloadOptionsForRenderings(v,this.content.entireFileAsOriginal,r.DownloadOption.CANVAS_RENDERINGS);this.addDownloadOptionsForRenderings(_)}if(this.isDownloadOptionAvailable(r.DownloadOption.IMAGE_RENDERINGS))for(var m=n.getImages(),g=0;g<m.length;g++){var _=this.getDownloadOptionsForRenderings(m[g].getResource(),this.content.entireFileAsOriginal,r.DownloadOption.IMAGE_RENDERINGS);this.addDownloadOptionsForRenderings(_)}if(this.isDownloadOptionAvailable(r.DownloadOption.CANVAS_RENDERINGS)){var _=this.getDownloadOptionsForRenderings(n,this.content.entireFileAsOriginal,r.DownloadOption.CANVAS_RENDERINGS);this.addDownloadOptionsForRenderings(_)}if(this.isDownloadOptionAvailable(r.DownloadOption.MANIFEST_RENDERINGS)){var _=this.getDownloadOptionsForRenderings(this.extension.helper.getCurrentSequence(),this.content.entireDocument,r.DownloadOption.MANIFEST_RENDERINGS);!_.length&&this.extension.helper.manifest&&(_=this.getDownloadOptionsForRenderings(this.extension.helper.manifest,this.content.entireDocument,r.DownloadOption.MANIFEST_RENDERINGS)),this.addDownloadOptionsForRenderings(_)}if(this.isDownloadOptionAvailable(r.DownloadOption.CURRENT_VIEW)){var E=parseInt(this.$currentViewAsJpgButton.data("width").toString()),y=parseInt(this.$currentViewAsJpgButton.data("height").toString()),b=parseInt(this.$wholeImageHighResButton.data("width").toString()),I=parseInt(this.$wholeImageHighResButton.data("height").toString()),T=E/b*100,O=y/I*100,A=this.options.currentViewDisabledPercentage;T>=A&&O>=A?this.$currentViewAsJpgButton.hide():this.$currentViewAsJpgButton.show()}var C=this.$imageOptions.find("li.single");C=C.sort(function(e,t){var n=$(e).data("width");n?n=parseInt(n.toString()):0;var i=$(e).data("height");i?i=parseInt(i.toString()):0;var o=$(t).data("width");o?o=parseInt(o.toString()):0;var r=$(t).data("height");r?r=parseInt(r.toString()):0;var s=n*i,a=o*r;return a>s?-1:s>a?1:0}),C.detach().appendTo(this.$imageOptions);var w=this.$downloadOptions.find("li.group");w.each(function(e,t){var n=$(t);n.show(),n.find("li.option:hidden").length===n.find("li.option").length&&n.hide()}),this.$downloadOptions.find("li.group:visible").last().addClass("lastVisible"),this.extension.isPagingSettingEnabled()&&this.config.options.downloadPagingNoteEnabled?this.$pagingNote.show():this.$pagingNote.hide(),this.$downloadOptions.find("li.option:visible").length?(this.$downloadOptions.find("li.option input:visible:first").prop("checked",!0),this.$noneAvailable.hide(),this.$downloadButton.show()):(this.$noneAvailable.show(),this.$downloadButton.hide()),this.resize()},t.prototype.addDownloadOptionsForRenderings=function(e){var t=this;e.forEach(function(e){switch(e.type){case r.DownloadOption.IMAGE_RENDERINGS:t.$imageOptions.append(e.button);break;case r.DownloadOption.CANVAS_RENDERINGS:t.$canvasOptions.append(e.button);break;case r.DownloadOption.MANIFEST_RENDERINGS:t.$manifestOptions.append(e.button)}})},t.prototype.getCanvasImageResource=function(e){var t=e.getImages();return t[0]?t[0].getResource():null},t.prototype.getCanvasHighResImageUri=function(e){var t=this.getCanvasComputedDimensions(e);if(t){var n=t.width,i=e.getCanonicalImageUri(n);if(e.externalResource&&e.externalResource.hasServiceDescriptor()){var o=i.split("/"),r=this.extension.getViewerRotation();o[o.length-2]=String(r),i=o.join("/")}return i}return e.externalResource&&!e.externalResource.hasServiceDescriptor()?e.externalResource.dataUri:""},t.prototype.getCanvasMimeType=function(e){var t=this.getCanvasImageResource(e);if(t){var n=t.getFormat();if(n)return n.toString()}return null},t.prototype.getCanvasDimensions=function(e){if(e.externalResource.data){var t=e.externalResource.data.width,i=e.externalResource.data.height;if(t&&i)return new n.Size(t,i)}return null},t.prototype.getCanvasComputedDimensions=function(e){var t=this.getCanvasDimensions(e),i=e.getMaxDimensions();if(!t)return null;if(!i)return t;if(t.width<=i.width&&t.height<=i.height)return t;var o=i.width/t.width,r=i.height/t.height,s=Math.min(o,r);return new n.Size(Math.floor(t.width*s),Math.floor(t.height*s))},t.prototype._isLevel0=function(e){return e&&e.length?n.Utils.isLevel0ImageProfile(e[0]):!1},t.prototype.isDownloadOptionAvailable=function(t){if(!this.extension.resources)return!1;var n=this.extension.helper.getCurrentCanvas();if(!n.externalResource.hasServiceDescriptor()||this._isLevel0(n.externalResource.data.profile))return t===r.DownloadOption.WHOLE_IMAGE_HIGH_RES&&(!this.extension.isPagingSettingEnabled()||this.extension.isPagingSettingEnabled()&&this.extension.resources&&1===this.extension.resources.length)?!0:!1;switch(t){case r.DownloadOption.CURRENT_VIEW:case r.DownloadOption.CANVAS_RENDERINGS:case r.DownloadOption.IMAGE_RENDERINGS:case r.DownloadOption.WHOLE_IMAGE_HIGH_RES:if(!this.extension.isPagingSettingEnabled()||this.extension.isPagingSettingEnabled()&&this.extension.resources&&1===this.extension.resources.length){var i=n.getMaxDimensions();return i?i.width<=this.options.maxImageWidth?!0:!1:!0}return!1;case r.DownloadOption.WHOLE_IMAGES_HIGH_RES:return this.extension.isPagingSettingEnabled()&&this.extension.resources&&this.extension.resources.length>1?!0:!1;case r.DownloadOption.WHOLE_IMAGE_LOW_RES:var o=this.getCanvasComputedDimensions(n);return o?!this.extension.isPagingSettingEnabled()&&o.width>this.options.confinedImageSize:!1;case r.DownloadOption.SELECTION:return this.options.selectionEnabled;case r.DownloadOption.RANGE_RENDERINGS:if(n.ranges&&n.ranges.length){var s=n.ranges[0];return s.getRenderings().length>0}return!1;default:return e.prototype.isDownloadOptionAvailable.call(this,t)}},t}(o.DownloadDialogue);t.DownloadDialogue=s});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-dialogues-module/ExternalContentDialogue",["require","exports","../uv-shared-module/BaseEvents","../uv-shared-module/Dialogue"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("externalContentDialogue"),e.prototype.create.call(this),this.openCommand=n.BaseEvents.SHOW_EXTERNALCONTENT_DIALOGUE,this.closeCommand=n.BaseEvents.HIDE_EXTERNALCONTENT_DIALOGUE,this.component.subscribe(this.openCommand,function(e){t.open(),t.$iframe.prop("src",e.uri)}),this.component.subscribe(this.closeCommand,function(){t.close()}),this.$iframe=$("<iframe></iframe>"),this.$content.append(this.$iframe),this.$element.hide()},t.prototype.resize=function(){e.prototype.resize.call(this),this.$iframe.width(this.$content.width()),this.$iframe.height(this.$content.height())},t}(i.Dialogue);t.ExternalContentDialogue=o});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-osdmobilefooterpanel-module/MobileFooter",["require","exports","../uv-shared-module/FooterPanel","../../extensions/uv-seadragon-extension/Events"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("mobileFooterPanel"),e.prototype.create.call(this),this.$spacer=$('<div class="spacer"></div>'),this.$options.prepend(this.$spacer),this.$rotateButton=$('\n            <button class="btn imageBtn rotate" title="'+this.content.rotateRight+'">\n                <i class="uv-icon-rotate" aria-hidden="true"></i>'+this.content.rotateRight+"\n            </button>\n        "),this.$options.prepend(this.$rotateButton),this.$zoomOutButton=$('\n            <button class="btn imageBtn zoomOut" title="'+this.content.zoomOut+'">\n                <i class="uv-icon-zoom-out" aria-hidden="true"></i>'+this.content.zoomOut+"\n            </button>\n        "),this.$options.prepend(this.$zoomOutButton),this.$zoomInButton=$('\n            <button class="btn imageBtn zoomIn" title="'+this.content.zoomIn+'">\n                <i class="uv-icon-zoom-in" aria-hidden="true"></i>'+this.content.zoomIn+"\n            </button>\n        "),this.$options.prepend(this.$zoomInButton),this.$zoomInButton.onPressed(function(){t.component.publish(i.Events.ZOOM_IN)}),this.$zoomOutButton.onPressed(function(){t.component.publish(i.Events.ZOOM_OUT)}),this.$rotateButton.onPressed(function(){t.component.publish(i.Events.ROTATE)})},t.prototype.resize=function(){e.prototype.resize.call(this),this.$options.css("left",Math.floor(this.$element.width()/2-this.$options.width()/2))},t}(n.FooterPanel);t.FooterPanel=o}),define("modules/uv-shared-module/AutoComplete",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,n,i,o,r,s,a){void 0===o&&(o=300),void 0===r&&(r=2),void 0===s&&(s=!1),void 0===a&&(a=!1);var u=this;this._$element=e,this._autoCompleteFunc=t,this._delay=o,this._minChars=r,this._onSelect=i,this._parseResultsFunc=n,this._positionAbove=s,this._allowWords=a,this._$searchResultsList=$('<ul class="autocomplete"></ul>'),this._positionAbove?this._$element.parent().prepend(this._$searchResultsList):this._$element.parent().append(this._$searchResultsList),this._$searchResultTemplate=$('<li class="result"><a href="#" tabindex="-1"></a></li>');var l=function(){var e=0;return function(t,n){clearTimeout(e),e=setTimeout(t,n)}}(),c=this;this._$element.on("keydown",function(e){var t=e.originalEvent,n=Utils.Keyboard.getCharCode(t),i=!1;n===KeyCodes.KeyDown.LeftArrow?i=!0:n===KeyCodes.KeyDown.RightArrow&&(i=!0),i&&(t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation())}),this._$element.on("keyup",function(e){if(!c._getSelectedListItem().length&&e.keyCode===KeyCodes.KeyDown.Enter)return void c._onSelect(c._getTerms());if(c._$searchResultsList.is(":visible")&&c._results.length)if(e.keyCode===KeyCodes.KeyDown.Enter)c._searchForItem(c._getSelectedListItem());else{if(e.keyCode===KeyCodes.KeyDown.DownArrow)return void c._setSelectedResultIndex(1);if(e.keyCode===KeyCodes.KeyDown.UpArrow)return void c._setSelectedResultIndex(-1)}e.keyCode!==KeyCodes.KeyDown.Enter&&l(function(){var e=c._getTerms();e&&e.length>c._minChars&&c._searchForWords(e)?c._search(e):(c._clearResults(),c._hideResults())},c._delay)}),$(document).on("mouseup",function(e){0===u._$searchResultsList.parent().has($(e.target)[0]).length&&(u._clearResults(),u._hideResults())}),this._hideResults()}return e.prototype._searchForWords=function(e){return this._allowWords||!e.includes(" ")?!0:!1},e.prototype._getTerms=function(){return this._$element.val().trim()},e.prototype._setSelectedResultIndex=function(e){var t;t=1===e?this._selectedResultIndex+1:this._selectedResultIndex-1;var n=this._$searchResultsList.find("li");0>t?t=n.length-1:t>n.length-1&&(t=0),this._selectedResultIndex=t,n.removeClass("selected");var i=n.eq(this._selectedResultIndex);i.addClass("selected");var o=i.outerHeight(!0)*this._selectedResultIndex;this._$searchResultsList.scrollTop(o)},e.prototype._search=function(e){this._results=[],this._clearResults(),this._showResults(),this._$searchResultsList.append('<li class="loading"></li>'),this._updateListPosition();var t=this;this._autoCompleteFunc(e,function(e){t._listResults(e)})},e.prototype._clearResults=function(){this._$searchResultsList.empty()},e.prototype._hideResults=function(){this._$searchResultsList.hide()},e.prototype._showResults=function(){this._selectedResultIndex=-1,this._$searchResultsList.show()},e.prototype._updateListPosition=function(){this._positionAbove?this._$searchResultsList.css({top:-1*this._$searchResultsList.outerHeight(!0)}):this._$searchResultsList.css({top:this._$element.outerHeight(!0)})},e.prototype._listResults=function(e){if(this._results=this._parseResultsFunc(e),this._clearResults(),!this._results.length)return void this._hideResults();for(var t=0;t<this._results.length;t++){var n=this._results[t],i=this._$searchResultTemplate.clone(),o=i.find("a");o.text(n),this._$searchResultsList.append(i)}this._updateListPosition();var r=this;this._$searchResultsList.find("li").on("click",function(e){e.preventDefault(),r._searchForItem($(this))})},e.prototype._searchForItem=function(e){var t=e.find("a").text();this._$element.val(t),this._hideResults(),this._onSelect(t),this._clearResults(),this._hideResults()},e.prototype._getSelectedListItem=function(){return this._$searchResultsList.find("li.selected")},e}();t.AutoComplete=n});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-searchfooterpanel-module/FooterPanel",["require","exports","manifesto.js","../uv-shared-module/AutoComplete","../uv-shared-module/BaseEvents","../../extensions/uv-seadragon-extension/Events","../uv-shared-module/FooterPanel","../../extensions/uv-seadragon-extension/Mode","../../Utils"],function(e,t,n,i,o,r,s,a,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(t){var n=e.call(this,t)||this;return n.placemarkerTouched=!1,n}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("searchFooterPanel"),e.prototype.create.call(this),this.component.subscribe(o.BaseEvents.CANVAS_INDEX_CHANGED,function(){t.canvasIndexChanged(),t.setCurrentSearchResultPlacemarker(),t.updatePrevButton(),t.updateNextButton()}),this.component.subscribe(o.BaseEvents.CLEAR_ANNOTATIONS,function(){t.clearSearchResults()}),this.component.subscribe(r.Events.MODE_CHANGED,function(){t.settingsChanged()}),this.component.subscribe(r.Events.SEARCH,function(e){t.terms=e}),this.component.subscribe(o.BaseEvents.ANNOTATIONS,function(e){t.displaySearchResults(e.annotations,e.terms),t.setCurrentSearchResultPlacemarker(),t.updatePrevButton(),t.updateNextButton()}),this.component.subscribe(o.BaseEvents.ANNOTATIONS_EMPTY,function(){t.hideSearchSpinner()}),this.component.subscribe(o.BaseEvents.ANNOTATION_CHANGED,function(){t.updatePrevButton(),t.updateNextButton()}),this.$printButton=$('\n          <button class="print btn imageBtn" title="'+this.content.print+'" tabindex="0">\n            <i class="uv-icon uv-icon-print" aria-hidden="true"></i>'+this.content.print+"\n          </button>\n        "),this.$options.prepend(this.$printButton),this.$searchContainer=$('<div class="search"></div>'),this.$element.prepend(this.$searchContainer),this.$searchOptions=$('<div class="searchOptions"></div>'),this.$searchContainer.append(this.$searchOptions),this.$searchLabel=$('<span class="label">'+this.content.searchWithin+"</span>"),this.$searchOptions.append(this.$searchLabel),this.$searchTextContainer=$('<div class="searchTextContainer"></div>'),this.$searchOptions.append(this.$searchTextContainer),this.$searchText=$('<input class="searchText" type="text" maxlength="100" value="'+this.content.enterKeyword+'" aria-label="'+this.content.searchWithin+'"/>'),this.$searchTextContainer.append(this.$searchText),this.$searchButton=$('<a class="imageButton searchButton" tabindex="0"></a>'),this.$searchTextContainer.append(this.$searchButton),this.$searchPagerContainer=$('<div class="searchPager"></div>'),this.$element.prepend(this.$searchPagerContainer),this.$searchPagerControls=$('<div class="controls"></div>'),this.$searchPagerContainer.prepend(this.$searchPagerControls),this.$previousResultButton=$('<a class="previousResult" title="'+this.content.previousResult+'">'+this.content.previousResult+"</a>"),this.$searchPagerControls.append(this.$previousResultButton),this.$searchResultsInfo=$('<div class="searchResultsInfo"><span class="info"><span class="number">x</span> <span class="foundFor"></span> \'<span class="terms">y</span>\'</span></div>'),this.$searchPagerControls.append(this.$searchResultsInfo),this.$clearSearchResultsButton=$('<a class="clearSearch" title="'+this.content.clearSearch+'">'+this.content.clearSearch+"</a>"),this.$searchResultsInfo.append(this.$clearSearchResultsButton),this.$nextResultButton=$('<a class="nextResult" title="'+this.content.nextResult+'">'+this.content.nextResult+"</a>"),this.$searchPagerControls.append(this.$nextResultButton),this.$searchResultsContainer=$('<div class="searchResults"></div>'),this.$element.prepend(this.$searchResultsContainer),this.$line=$('<div class="line"></div>'),this.$searchResultsContainer.append(this.$line),this.$pagePositionMarker=$('<div class="positionPlacemarker"></div>'),this.$searchResultsContainer.append(this.$pagePositionMarker),this.$pagePositionLabel=$('<div class="label"></div>'),this.$searchResultsContainer.append(this.$pagePositionLabel),this.$placemarkerDetails=$('<div class="placeMarkerDetails"></div>'),this.$searchResultsContainer.append(this.$placemarkerDetails),this.$placemarkerDetailsTop=$("<h1></h1>"),this.$placemarkerDetails.append(this.$placemarkerDetailsTop),this.$placemarkerDetailsBottom=$("<p></p>"),this.$placemarkerDetails.append(this.$placemarkerDetailsBottom),this.$searchPagerContainer.hide(),this.$placemarkerDetails.hide();var n=this;this.$searchButton.on("click",function(e){e.preventDefault(),t.search(t.$searchText.val())}),this.$searchText.on("focus",function(){t.$searchText.val()===t.content.enterKeyword&&t.$searchText.val("")}),this.$placemarkerDetails.on("mouseover",function(){n.component.publish(r.Events.SEARCH_PREVIEW_START,t.currentPlacemarkerIndex)}),this.$placemarkerDetails.on("mouseleave",function(){$(this).hide(),n.component.publish(r.Events.SEARCH_PREVIEW_FINISH);var e=n.getSearchResultPlacemarkers();e.removeClass("hover")}),this.$placemarkerDetails.on("click",function(){n.component.publish(o.BaseEvents.CANVAS_INDEX_CHANGED,t.currentPlacemarkerIndex)}),this.$previousResultButton.on("click",function(e){e.preventDefault(),t.isPreviousButtonEnabled()&&n.component.publish(r.Events.PREV_SEARCH_RESULT)}),this.$nextResultButton.on("click",function(e){e.preventDefault(),t.isNextButtonEnabled()&&n.component.publish(r.Events.NEXT_SEARCH_RESULT)}),this.$clearSearchResultsButton.on("click",function(e){e.preventDefault(),n.component.publish(o.BaseEvents.CLEAR_ANNOTATIONS)}),this.isSearchEnabled()||(this.$searchContainer.hide(),this.$searchPagerContainer.hide(),this.$searchResultsContainer.hide(),this.$element.addClass("min")),1===this.extension.helper.getTotalCanvases()&&this.$searchResultsContainer.hide();var s=this.extension.getAutoCompleteUri();s?new i.AutoComplete(this.$searchText,function(e,t){$.getJSON(Utils.Strings.format(s,e),function(e){t(e)})},function(e){return $.map(e.terms,function(e){return e.match})},function(e){t.search(e)},300,2,!0,Utils.Bools.getBool(this.options.autocompleteAllowWords,!1)):this.$searchText.on("keyup",function(e){e.keyCode===KeyCodes.KeyDown.Enter&&n.search(n.$searchText.val())}),this.$printButton.onPressed(function(){n.component.publish(r.Events.PRINT)}),this.updatePrintButton();var a=Utils.Bools.getBool(this.config.options.positionMarkerEnabled,!0);a||(this.$pagePositionMarker.hide(),this.$pagePositionLabel.hide())},t.prototype.isSearchEnabled=function(){return this.extension.isSearchEnabled()},t.prototype.isZoomToSearchResultEnabled=function(){return Utils.Bools.getBool(this.extension.data.config.options.zoomToSearchResultEnabled,!0)},t.prototype.isPreviousButtonEnabled=function(){var e=this.extension.helper.canvasIndex,t=this.getFirstSearchResultCanvasIndex(),n=this.getCurrentSearchResultRectIndex();return this.isZoomToSearchResultEnabled()&&this.extension.currentAnnotationRect?t>e?!1:e===t&&0===n?!1:!0:e>t},t.prototype.isNextButtonEnabled=function(){var e=this.extension.helper.canvasIndex,t=this.getLastSearchResultCanvasIndex(),n=this.getCurrentSearchResultRectIndex();return this.isZoomToSearchResultEnabled()&&this.extension.currentAnnotationRect?e>t?!1:e===t&&n===this.getLastSearchResultRectIndex()?!1:!0:t>e},t.prototype.getSearchResults=function(){return this.extension.annotations},t.prototype.getCurrentSearchResultRectIndex=function(){return this.extension.getCurrentAnnotationRectIndex()},t.prototype.getFirstSearchResultCanvasIndex=function(){var e=this.getSearchResults();if(!e)return-1;var t=e[0].canvasIndex;return t},t.prototype.getLastSearchResultCanvasIndex=function(){var e=this.getSearchResults();if(!e)return-1;var t=e[e.length-1].canvasIndex;return t},t.prototype.getLastSearchResultRectIndex=function(){return this.extension.getLastAnnotationRectIndex()},t.prototype.updateNextButton=function(){var e=this.getSearchResults();e&&e.length&&(this.isNextButtonEnabled()?this.$nextResultButton.removeClass("disabled"):this.$nextResultButton.addClass("disabled"))},t.prototype.updatePrevButton=function(){var e=this.getSearchResults();e&&e.length&&(this.isPreviousButtonEnabled()?this.$previousResultButton.removeClass("disabled"):this.$previousResultButton.addClass("disabled"))},t.prototype.updatePrintButton=function(){var e=Utils.Bools.getBool(this.options.printEnabled,!1);e?this.$printButton.show():this.$printButton.hide()},t.prototype.search=function(e){var t=this;return this.terms=e,""===this.terms||this.terms===this.content.enterKeyword?void this.extension.showMessage(this.extension.data.config.modules.genericDialogue.content.emptyValue,function(){t.$searchText.focus()}):(this.$searchText.blur(),this.showSearchSpinner(),void this.component.publish(r.Events.SEARCH,this.terms))},t.prototype.getSearchResultPlacemarkers=function(){return this.$searchResultsContainer.find(".searchResultPlacemarker")},t.prototype.setCurrentSearchResultPlacemarker=function(){var e=this.getSearchResultPlacemarkers();e.parent().find(".current").removeClass("current");var t=$('.searchResultPlacemarker[data-index="'+this.extension.helper.canvasIndex+'"]');t.addClass("current")},t.prototype.positionSearchResultPlacemarkers=function(){var e=this.getSearchResults();if(e&&e.length){var t=this.getSearchResultPlacemarkers();t.remove();for(var n=this.getPageLineRatio(),i=this.$line.position().top,o=this.$line.position().left,r=this,s=0;s<e.length;s++){var a=e[s],u=a.canvasIndex*n,l=$('<div class="searchResultPlacemarker" data-index="'+a.canvasIndex+'"></div>');l[0].ontouchstart=function(e){r.onPlacemarkerTouchStart.call(this,r)},l.click(function(e){r.onPlacemarkerClick.call(this,r)}),l.mouseenter(function(e){r.onPlacemarkerMouseEnter.call(this,r)}),l.mouseleave(function(e){r.onPlacemarkerMouseLeave.call(this,e,r)}),this.$searchResultsContainer.append(l);var c=i-l.height(),h=o+u-l.width()/2;l.css({top:c,left:h})}}},t.prototype.onPlacemarkerTouchStart=function(e){e.placemarkerTouched=!0},t.prototype.onPlacemarkerClick=function(e){e.placemarkerTouched||(e.placemarkerTouched=!1)},t.prototype.onPlacemarkerMouseEnter=function(e){if(!e.placemarkerTouched){var t=$(this);t.addClass("hover");var i=parseInt(t.attr("data-index"));e.component.publish(r.Events.SEARCH_PREVIEW_START,i);var o=e.getSearchResultPlacemarkers(),s=o.index(t[0]);e.currentPlacemarkerIndex=i,e.$placemarkerDetails.show();var a="{0} {1}";if(e.isPageModeEnabled()){var u=e.extension.helper.getCanvasByIndex(i),l=n.LanguageMap.getValue(u.getLabel());!l&&e.extension.helper.manifest&&(l=e.extension.helper.manifest.options.defaultLabel),a=Utils.Strings.format(a,e.content.pageCaps,l)}else a=Utils.Strings.format(a,e.content.imageCaps,String(i+1));e.$placemarkerDetailsTop.html(a);var c=e.getSearchResults();if(c){var h=c[s],p="";e.terms&&(p=Utils.Strings.ellipsis(e.terms,e.options.elideDetailsTermsCount));var d=e.content.instanceFound,f=e.content.instancesFound,g="";1===h.rects.length?(g=Utils.Strings.format(d,p),e.$placemarkerDetailsBottom.html(g)):(g=Utils.Strings.format(f,String(h.rects.length),p),e.$placemarkerDetailsBottom.html(g))}var v=t.position(),_=v.top-e.$placemarkerDetails.height(),m=v.left;m<e.$placemarkerDetails.width()/2?m=0-t.width()/2:m>e.$line.width()-e.$placemarkerDetails.width()/2?m=e.$line.width()-e.$placemarkerDetails.width()+t.width()/2:m-=e.$placemarkerDetails.width()/2,e.$placemarkerDetails.css({top:_,left:m})}},t.prototype.onPlacemarkerMouseLeave=function(e,t){t.component.publish(r.Events.SEARCH_PREVIEW_FINISH);var n=$(this),i=e.toElement||e.relatedTarget,o=$(i).closest(t.$placemarkerDetails).length;i!=t.$placemarkerDetails.get(0)&&0===o&&(t.$placemarkerDetails.hide(),n.removeClass("hover"))},t.prototype.setPageMarkerPosition=function(){if(null!==this.extension.helper.canvasIndex){var e=this.getPageLineRatio(),t=this.$line.position().top,n=this.$line.position().left,i=this.extension.helper.canvasIndex*e,o=t,r=n+i;this.$pagePositionMarker.css({top:o,left:r});var s=this.$line.width();r+this.$pagePositionLabel.outerWidth(!0)>s?(r-=this.$pagePositionLabel.outerWidth(!0),this.$pagePositionLabel.removeClass("right"),this.$pagePositionLabel.addClass("left")):(this.$pagePositionLabel.removeClass("left"),this.$pagePositionLabel.addClass("right")),this.$pagePositionLabel.css({top:o,left:r})}},t.prototype.clearSearchResults=function(){if(this.isSearchEnabled()){var e=this.getSearchResultPlacemarkers();e.remove(),this.$searchText.val(this.content.enterKeyword),this.$searchContainer.show(),this.$searchPagerContainer.hide(),this.$searchText.focus()}},t.prototype.getPageLineRatio=function(){var e=this.$line.width();return 1===this.extension.helper.getTotalCanvases()?0:e/(this.extension.helper.getTotalCanvases()-1)},t.prototype.canvasIndexChanged=function(){this.setPageMarkerPosition(),this.setPlacemarkerLabel()},t.prototype.settingsChanged=function(){this.setPlacemarkerLabel()},t.prototype.setPlacemarkerLabel=function(){var e=this.content.displaying,t=this.extension.helper.canvasIndex;if(this.isPageModeEnabled()){var i=this.extension.helper.getCanvasByIndex(t),o=n.LanguageMap.getValue(i.getLabel());o||(o=this.content.defaultLabel);var r=this.extension.helper.getLastCanvasLabel(!0);r&&this.$pagePositionLabel.html(Utils.Strings.format(e,this.content.page,u.UVUtils.sanitize(o),u.UVUtils.sanitize(r)))}else this.$pagePositionLabel.html(Utils.Strings.format(e,this.content.image,String(t+1),this.extension.helper.getTotalCanvases().toString()))},t.prototype.isPageModeEnabled=function(){return this.config.options.pageModeEnabled&&this.extension.getMode().toString()===a.Mode.page.toString()&&!Utils.Bools.getBool(this.config.options.forceImageMode,!1)},t.prototype.showSearchSpinner=function(){this.$searchText.addClass("searching")},t.prototype.hideSearchSpinner=function(){this.$searchText.removeClass("searching")},t.prototype.displaySearchResults=function(e,t){if(this.isSearchEnabled()){this.hideSearchSpinner(),this.positionSearchResultPlacemarkers(),this.$searchContainer.hide(),this.$searchPagerControls.css({left:0});var n=this.$searchResultsInfo.find(".info"),i=n.find(".number"),o=n.find(".foundFor"),r=n.find(".terms");t?(n.show(),i.text(this.extension.getTotalAnnotationRects()),1===e.length?o.html(this.content.resultFoundFor):o.html(this.content.resultsFoundFor),r.html(Utils.Strings.ellipsis(t,this.options.elideResultsTermsCount)),r.prop("title",t)):n.hide(),this.$searchPagerContainer.show(),this.resize()}},t.prototype.resize=function(){e.prototype.resize.call(this);var t=this.getSearchResults();t&&t.length&&this.positionSearchResultPlacemarkers(),this.setPageMarkerPosition(),this.$searchPagerContainer.width(this.$element.width());var n=this.$element.width()/2;this.$searchPagerControls.css({left:n-this.$searchPagerControls.width()/2}),this.$searchOptions.css({left:n-this.$searchOptions.outerWidth()/2})},t}(s.FooterPanel);t.FooterPanel=l});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-multiselectdialogue-module/MultiSelectDialogue",["require","exports","../uv-shared-module/BaseEvents","../uv-shared-module/Dialogue","../../extensions/uv-seadragon-extension/Mode","@iiif/iiif-gallery-component"],function(e,t,n,i,o,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("multiSelectDialogue"),e.prototype.create.call(this);var i=this;this.openCommand=n.BaseEvents.SHOW_MULTISELECT_DIALOGUE,this.closeCommand=n.BaseEvents.HIDE_MULTISELECT_DIALOGUE,this.component.subscribe(this.openCommand,function(){t.open();var e=t.extension.helper.getMultiSelectState();e.setEnabled(!0),t.galleryComponent.set(t.data)}),this.component.subscribe(this.closeCommand,function(){t.close();var e=t.extension.helper.getMultiSelectState();e.setEnabled(!1)}),this.$title=$("<h1></h1>"),
this.$content.append(this.$title),this.$title.text(this.content.title),this.$gallery=$('<div class="iiif-gallery-component"></div>'),this.$content.append(this.$gallery),this.data={helper:this.extension.helper,chunkedResizingThreshold:this.config.options.galleryThumbChunkedResizingThreshold,content:this.config.content,debug:!1,imageFadeInDuration:300,initialZoom:4,minLabelWidth:20,pageModeEnabled:this.isPageModeEnabled(),searchResults:[],scrollStopDuration:100,sizingEnabled:!0,thumbHeight:this.config.options.galleryThumbHeight,thumbLoadPadding:this.config.options.galleryThumbLoadPadding,thumbWidth:this.config.options.galleryThumbWidth,viewingDirection:this.extension.helper.getViewingDirection()},this.galleryComponent=new r.GalleryComponent({target:this.$gallery[0]});var o=this.$gallery.find("a.select");o.addClass("btn btn-primary"),this.galleryComponent.on("multiSelectionMade",function(e){t.component.publish(n.BaseEvents.MULTISELECTION_MADE,e),i.close()},!1),this.$element.hide()},t.prototype.isPageModeEnabled=function(){return Utils.Bools.getBool(this.config.options.pageModeEnabled,!0)&&this.extension.getMode().toString()===o.Mode.page.toString()},t.prototype.open=function(){e.prototype.open.call(this)},t.prototype.close=function(){e.prototype.close.call(this)},t.prototype.resize=function(){e.prototype.resize.call(this);var t=this.$gallery.find(".main"),n=this.$gallery.find(".header");t.height(this.$content.height()-this.$title.outerHeight()-this.$title.verticalMargins()-n.height())},t}(i.Dialogue);t.MultiSelectDialogue=s}),define("extensions/uv-seadragon-extension/MultiSelectionArgs",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e}();t.MultiSelectionArgs=n});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-pagingheaderpanel-module/PagingHeaderPanel",["require","exports","../uv-shared-module/AutoComplete","../uv-shared-module/BaseEvents","../../extensions/uv-seadragon-extension/Events","../uv-shared-module/HeaderPanel","../../extensions/uv-seadragon-extension/Mode","../../Utils","@iiif/vocabulary","manifesto.js"],function(e,t,n,i,o,r,s,a,u,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=function(e){function t(t){var n=e.call(this,t)||this;return n.firstButtonEnabled=!1,n.lastButtonEnabled=!1,n.nextButtonEnabled=!1,n.prevButtonEnabled=!1,n}return __extends(t,e),t.prototype.create=function(){var t=this;if(this.setConfig("pagingHeaderPanel"),e.prototype.create.call(this),this.component.subscribe(i.BaseEvents.CANVAS_INDEX_CHANGED,function(e){t.canvasIndexChanged(e)}),this.component.subscribe(i.BaseEvents.SETTINGS_CHANGED,function(){t.modeChanged(),t.updatePagingToggle()}),this.component.subscribe(i.BaseEvents.CANVAS_INDEX_CHANGE_FAILED,function(){t.setSearchFieldValue(t.extension.helper.canvasIndex)}),this.component.subscribe(i.BaseEvents.LEFTPANEL_EXPAND_FULL_START,function(){t.openGallery()}),this.component.subscribe(i.BaseEvents.LEFTPANEL_COLLAPSE_FULL_START,function(){t.closeGallery()}),this.$prevOptions=$('<div class="prevOptions"></div>'),this.$centerOptions.append(this.$prevOptions),this.$firstButton=$('\n          <button class="btn imageBtn first" tabindex="0" title="'+this.content.first+'">\n            <i class="uv-icon-first" aria-hidden="true"></i><span>'+this.content.first+"</span>\n          </button>\n        "),this.$prevOptions.append(this.$firstButton),this.$prevButton=$('\n          <button class="btn imageBtn prev" tabindex="0" title="'+this.content.previous+'">\n            <i class="uv-icon-prev" aria-hidden="true"></i><span>'+this.content.previous+"</span>\n          </button>\n        "),this.$prevOptions.append(this.$prevButton),this.$modeOptions=$('<div class="mode"></div>'),this.$centerOptions.append(this.$modeOptions),this.$imageModeLabel=$('<label for="image">'+this.content.image+"</label>"),this.$modeOptions.append(this.$imageModeLabel),this.$imageModeOption=$('<input type="radio" id="image" name="mode" tabindex="0"/>'),this.$modeOptions.append(this.$imageModeOption),this.$pageModeLabel=$('<label for="page"></label>'),this.$modeOptions.append(this.$pageModeLabel),this.$pageModeOption=$('<input type="radio" id="page" name="mode" tabindex="0"/>'),this.$modeOptions.append(this.$pageModeOption),this.$search=$('<div class="search"></div>'),this.$centerOptions.append(this.$search),this.$searchText=$('<input class="searchText" maxlength="50" type="text" tabindex="0" aria-label="'+this.content.pageSearchLabel+'"/>'),this.$search.append(this.$searchText),Utils.Bools.getBool(this.options.autoCompleteBoxEnabled,!0))this.$searchText.hide(),this.$autoCompleteBox=$('<input class="autocompleteText" type="text" maxlength="100" aria-label="'+this.content.pageSearchLabel+'"/>'),this.$search.append(this.$autoCompleteBox),new n.AutoComplete(this.$autoCompleteBox,function(e,n){var i=[],o=t.extension.helper.getCanvases();if(t.isPageModeEnabled())for(var r=0;r<o.length;r++){var s=o[r],a=l.LanguageMap.getValue(s.getLabel());a&&a.startsWith(e)&&i.push(a)}else for(var r=0;r<o.length;r++){var s=o[r];s.index.toString().startsWith(e)&&i.push(s.index.toString())}n(i)},function(e){return e},function(e){t.search(e)},300,0,Utils.Bools.getBool(this.options.autocompleteAllowWords,!1));else if(Utils.Bools.getBool(this.options.imageSelectionBoxEnabled,!0)){this.$selectionBoxOptions=$('<div class="image-selectionbox-options"></div>'),this.$centerOptions.append(this.$selectionBoxOptions),this.$imageSelectionBox=$('<select class="image-selectionbox" name="image-select" tabindex="0" ></select>'),this.$selectionBoxOptions.append(this.$imageSelectionBox);for(var r=0;r<this.extension.helper.getTotalCanvases();r++){var c=this.extension.helper.getCanvasByIndex(r),h=a.UVUtils.sanitize(l.LanguageMap.getValue(c.getLabel(),this.extension.helper.options.locale));this.$imageSelectionBox.append("<option value="+r+">"+h+"</option>")}this.$imageSelectionBox.change(function(){var e=parseInt(t.$imageSelectionBox.val());t.component.publish(o.Events.IMAGE_SEARCH,e)})}this.$total=$('<span class="total"></span>'),this.$search.append(this.$total),this.$searchButton=$('<a class="go btn btn-primary" title="'+this.content.go+'" tabindex="0">'+this.content.go+"</a>"),this.$search.append(this.$searchButton),this.$nextOptions=$('<div class="nextOptions"></div>'),this.$centerOptions.append(this.$nextOptions),this.$nextButton=$('\n          <button class="btn imageBtn next" tabindex="0" title="'+this.content.next+'">\n            <i class="uv-icon-next" aria-hidden="true"></i><span>'+this.content.next+"</span>\n          </button>\n        "),this.$nextOptions.append(this.$nextButton),this.$lastButton=$('\n          <button class="btn imageBtn last" tabindex="0" title="'+this.content.last+'">\n            <i class="uv-icon-last" aria-hidden="true"></i><span>'+this.content.last+"</span>\n          </button>\n        "),this.$nextOptions.append(this.$lastButton),this.isPageModeEnabled()?(this.$pageModeOption.attr("checked","checked"),this.$pageModeOption.removeAttr("disabled"),this.$pageModeLabel.removeClass("disabled")):(this.$imageModeOption.attr("checked","checked"),this.$pageModeOption.attr("disabled","disabled"),this.$pageModeLabel.addClass("disabled")),this.extension.helper.getManifestType().toString()===l.ManifestType.MANUSCRIPT.toString()?this.$pageModeLabel.text(this.content.folio):this.$pageModeLabel.text(this.content.page),this.$galleryButton=$('\n          <button class="btn imageBtn gallery" title="'+this.content.gallery+'" tabindex="0">\n            <i class="uv-icon-gallery" aria-hidden="true"></i>'+this.content.gallery+"\n          </button>\n        "),this.$rightOptions.prepend(this.$galleryButton),this.$pagingToggleButtons=$('<div class="pagingToggleButtons"></div>'),this.$rightOptions.prepend(this.$pagingToggleButtons),this.$oneUpButton=$('\n          <button class="btn imageBtn one-up" title="'+this.content.oneUp+'" tabindex="0">\n            <i class="uv-icon-one-up" aria-hidden="true"></i>'+this.content.oneUp+"\n          </button>"),this.$pagingToggleButtons.append(this.$oneUpButton),this.$twoUpButton=$('\n          <button class="btn imageBtn two-up" title="'+this.content.twoUp+'" tabindex="0">\n            <i class="uv-icon-two-up" aria-hidden="true"></i>'+this.content.twoUp+"\n          </button>\n        "),this.$pagingToggleButtons.append(this.$twoUpButton),this.updatePagingToggle(),this.updateGalleryButton(),this.$oneUpButton.onPressed(function(){var e=!1;t.updateSettings({pagingEnabled:e}),t.component.publish(o.Events.PAGING_TOGGLED,e)}),this.$twoUpButton.onPressed(function(){var e=!0;t.updateSettings({pagingEnabled:e}),t.component.publish(o.Events.PAGING_TOGGLED,e)}),this.$galleryButton.onPressed(function(){t.component.publish(i.BaseEvents.TOGGLE_EXPAND_LEFT_PANEL)}),this.setNavigationTitles(),this.setTotal();var p=this.extension.helper.getViewingDirection()||u.ViewingDirection.LEFT_TO_RIGHT;1===this.extension.helper.getTotalCanvases()&&this.$centerOptions.hide(),this.$firstButton.onPressed(function(){switch(p.toString()){case u.ViewingDirection.LEFT_TO_RIGHT.toString():case u.ViewingDirection.TOP_TO_BOTTOM.toString():case u.ViewingDirection.BOTTOM_TO_TOP.toString():t.component.publish(i.BaseEvents.FIRST);break;case u.ViewingDirection.RIGHT_TO_LEFT.toString():t.component.publish(i.BaseEvents.LAST)}}),this.$prevButton.onPressed(function(){switch(p.toString()){case u.ViewingDirection.LEFT_TO_RIGHT.toString():case u.ViewingDirection.BOTTOM_TO_TOP.toString():case u.ViewingDirection.TOP_TO_BOTTOM.toString():t.component.publish(i.BaseEvents.PREV);break;case u.ViewingDirection.RIGHT_TO_LEFT.toString():t.component.publish(i.BaseEvents.NEXT)}}),this.$nextButton.onPressed(function(){switch(p.toString()){case u.ViewingDirection.LEFT_TO_RIGHT.toString():case u.ViewingDirection.BOTTOM_TO_TOP.toString():case u.ViewingDirection.TOP_TO_BOTTOM.toString():t.component.publish(i.BaseEvents.NEXT);break;case u.ViewingDirection.RIGHT_TO_LEFT.toString():t.component.publish(i.BaseEvents.PREV)}}),this.$lastButton.onPressed(function(){switch(p.toString()){case u.ViewingDirection.LEFT_TO_RIGHT.toString():case u.ViewingDirection.TOP_TO_BOTTOM.toString():case u.ViewingDirection.BOTTOM_TO_TOP.toString():t.component.publish(i.BaseEvents.LAST);break;case u.ViewingDirection.RIGHT_TO_LEFT.toString():t.component.publish(i.BaseEvents.FIRST)}}),this.config.options.pageModeEnabled?(this.$imageModeOption.on("click",function(e){t.component.publish(o.Events.MODE_CHANGED,s.Mode.image.toString())}),this.$pageModeOption.on("click",function(e){t.component.publish(o.Events.MODE_CHANGED,s.Mode.page.toString())})):(this.$imageModeOption.hide(),this.$pageModeLabel.hide(),this.$pageModeOption.hide()),this.$searchText.onEnter(function(){t.$searchText.blur(),t.search(t.$searchText.val())}),this.$searchText.click(function(){$(this).select()}),this.$searchButton.onPressed(function(){t.options.autoCompleteBoxEnabled?t.search(t.$autoCompleteBox.val()):t.search(t.$searchText.val())}),this.options.modeOptionsEnabled===!1&&(this.$modeOptions.hide(),this.$centerOptions.addClass("modeOptionsDisabled")),this.options.imageSelectionBoxEnabled===!0&&this.options.autoCompleteBoxEnabled!==!0&&this.$search.hide(),this.options.helpEnabled===!1&&this.$helpButton.hide(),Utils.Bools.getBool(this.options.pagingToggleEnabled,!0)||this.$pagingToggleButtons.hide()},t.prototype.openGallery=function(){this.$oneUpButton.removeClass("on"),this.$twoUpButton.removeClass("on"),this.$galleryButton.addClass("on")},t.prototype.closeGallery=function(){this.updatePagingToggle(),this.$galleryButton.removeClass("on")},t.prototype.isPageModeEnabled=function(){return this.config.options.pageModeEnabled&&this.extension.getMode().toString()===s.Mode.page.toString()},t.prototype.setNavigationTitles=function(){this.isPageModeEnabled()?this.extension.helper.isRightToLeft()?(this.$firstButton.prop("title",this.content.lastPage),this.$firstButton.find("span").text(this.content.lastPage),this.$prevButton.prop("title",this.content.nextPage),this.$prevButton.find("span").text(this.content.nextPage),this.$nextButton.prop("title",this.content.previousPage),this.$nextButton.find("span").text(this.content.previousPage),this.$lastButton.prop("title",this.content.firstPage),this.$lastButton.find("span").text(this.content.firstPage)):(this.$firstButton.prop("title",this.content.firstPage),this.$firstButton.find("span").text(this.content.firstPage),this.$prevButton.prop("title",this.content.previousPage),this.$prevButton.find("span").text(this.content.previousPage),this.$nextButton.prop("title",this.content.nextPage),this.$nextButton.find("span").text(this.content.nextPage),this.$lastButton.prop("title",this.content.lastPage),this.$lastButton.find("span").text(this.content.lastPage)):this.extension.helper.isRightToLeft()?(this.$firstButton.prop("title",this.content.lastImage),this.$firstButton.find("span").text(this.content.lastPage),this.$prevButton.prop("title",this.content.nextImage),this.$prevButton.find("span").text(this.content.nextImage),this.$nextButton.prop("title",this.content.previousImage),this.$nextButton.find("span").text(this.content.previousImage),this.$lastButton.prop("title",this.content.firstImage),this.$lastButton.find("span").text(this.content.firstImage)):(this.$firstButton.prop("title",this.content.firstImage),this.$firstButton.find("span").text(this.content.firstImage),this.$prevButton.prop("title",this.content.previousImage),this.$prevButton.find("span").text(this.content.previousImage),this.$nextButton.prop("title",this.content.nextImage),this.$nextButton.find("span").text(this.content.nextImage),this.$lastButton.prop("title",this.content.lastImage),this.$lastButton.find("span").text(this.content.lastImage))},t.prototype.updatePagingToggle=function(){return this.pagingToggleIsVisible()?void(this.extension.isPagingSettingEnabled()?(this.$oneUpButton.removeClass("on"),this.$twoUpButton.addClass("on")):(this.$twoUpButton.removeClass("on"),this.$oneUpButton.addClass("on"))):void this.$pagingToggleButtons.hide()},t.prototype.pagingToggleIsVisible=function(){return Utils.Bools.getBool(this.options.pagingToggleEnabled,!0)&&this.extension.helper.isPagingAvailable()},t.prototype.updateGalleryButton=function(){this.galleryIsVisible()||this.$galleryButton.hide()},t.prototype.galleryIsVisible=function(){return Utils.Bools.getBool(this.options.galleryButtonEnabled,!0)&&this.extension.isLeftPanelEnabled()},t.prototype.setTotal=function(){var e=this.content.of;this.isPageModeEnabled()?this.$total.html(Utils.Strings.format(e,this.extension.helper.getLastCanvasLabel(!0))):this.$total.html(Utils.Strings.format(e,this.extension.helper.getTotalCanvases().toString()))},t.prototype.setSearchFieldValue=function(e){var t=this.extension.helper.getCanvasByIndex(e),n=null;if(this.isPageModeEnabled()){var i=l.LanguageMap.getValue(t.getLabel());n="-"===i?"":i}else e+=1,n=e.toString();this.options.autoCompleteBoxEnabled?this.$autoCompleteBox.val(n):this.$searchText.val(n)},t.prototype.search=function(e){if(!e)return this.extension.showMessage(this.content.emptyValue),void this.component.publish(i.BaseEvents.CANVAS_INDEX_CHANGE_FAILED);if(this.isPageModeEnabled())this.component.publish(o.Events.PAGE_SEARCH,e);else{var t=void 0;if(t=this.options.autoCompleteBoxEnabled?parseInt(this.$autoCompleteBox.val(),10):parseInt(this.$searchText.val(),10),t-=1,isNaN(t))return this.extension.showMessage(this.extension.data.config.modules.genericDialogue.content.invalidNumber),void this.component.publish(i.BaseEvents.CANVAS_INDEX_CHANGE_FAILED);var n=this.extension.helper.getCanvasByIndex(t);if(!n)return this.extension.showMessage(this.extension.data.config.modules.genericDialogue.content.pageNotFound),void this.component.publish(i.BaseEvents.CANVAS_INDEX_CHANGE_FAILED);this.component.publish(o.Events.IMAGE_SEARCH,t)}},t.prototype.canvasIndexChanged=function(e){this.setSearchFieldValue(e),this.options.imageSelectionBoxEnabled===!0&&this.options.autoCompleteBoxEnabled!==!0&&this.$imageSelectionBox.val(e);var t=this.extension.helper.getViewingDirection()||u.ViewingDirection.LEFT_TO_RIGHT;t.toString()===u.ViewingDirection.RIGHT_TO_LEFT.toString()?(this.extension.helper.isFirstCanvas()?(this.disableLastButton(),this.disableNextButton()):(this.enableLastButton(),this.enableNextButton()),this.extension.helper.isLastCanvas()?(this.disableFirstButton(),this.disablePrevButton()):(this.enableFirstButton(),this.enablePrevButton())):(this.extension.helper.isFirstCanvas()?(this.disableFirstButton(),this.disablePrevButton()):(this.enableFirstButton(),this.enablePrevButton()),this.extension.helper.isLastCanvas()?(this.disableLastButton(),this.disableNextButton()):(this.enableLastButton(),this.enableNextButton()))},t.prototype.disableFirstButton=function(){this.firstButtonEnabled=!1,this.$firstButton.disable()},t.prototype.enableFirstButton=function(){this.firstButtonEnabled=!0,this.$firstButton.enable()},t.prototype.disableLastButton=function(){this.lastButtonEnabled=!1,this.$lastButton.disable()},t.prototype.enableLastButton=function(){this.lastButtonEnabled=!0,this.$lastButton.enable()},t.prototype.disablePrevButton=function(){this.prevButtonEnabled=!1,this.$prevButton.disable()},t.prototype.enablePrevButton=function(){this.prevButtonEnabled=!0,this.$prevButton.enable()},t.prototype.disableNextButton=function(){this.nextButtonEnabled=!1,this.$nextButton.disable()},t.prototype.enableNextButton=function(){this.nextButtonEnabled=!0,this.$nextButton.enable()},t.prototype.modeChanged=function(){this.setSearchFieldValue(this.extension.helper.canvasIndex),this.setNavigationTitles(),this.setTotal()},t.prototype.resize=function(){e.prototype.resize.call(this),this.extension.width()<this.extension.data.config.options.minWidthBreakPoint?(this.pagingToggleIsVisible()&&this.$pagingToggleButtons.hide(),this.galleryIsVisible()&&this.$galleryButton.hide()):(this.pagingToggleIsVisible()&&this.$pagingToggleButtons.show(),this.galleryIsVisible()&&this.$galleryButton.show())},t}(r.HeaderPanel);t.PagingHeaderPanel=c}),define("extensions/uv-seadragon-extension/Bounds",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,n,i){this.x=e,this.y=t,this.w=n,this.h=i}return e.prototype.toString=function(){return this.x+","+this.y+","+this.w+","+this.h},e.fromString=function(t){var n=t.split(",");return new e(Number(n[0]),Number(n[1]),Number(n[2]),Number(n[3]))},e}();t.Bounds=n});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-seadragoncenterpanel-module/SeadragonCenterPanel",["require","exports","@iiif/vocabulary","../uv-shared-module/BaseEvents","../../extensions/uv-seadragon-extension/Bounds","../uv-shared-module/CenterPanel","../../extensions/uv-seadragon-extension/Events","../../Utils"],function(e,t,n,i,o,r,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=function(e){function t(t){var n=e.call(this,t)||this;return n.controlsVisible=!1,n.isCreated=!1,n.isFirstLoad=!0,n.navigatedFromSearch=!1,n.nextButtonEnabled=!1,n.prevButtonEnabled=!1,n}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("seadragonCenterPanel"),e.prototype.create.call(this),this.viewerId="osd"+(new Date).getTime(),this.$viewer=$('<div id="'+this.viewerId+'" class="viewer"></div>'),this.$content.prepend(this.$viewer),this.component.subscribe(i.BaseEvents.ANNOTATIONS,function(e){t.overlayAnnotations(),t.zoomToInitialAnnotation()}),this.component.subscribe(i.BaseEvents.SETTINGS_CHANGED,function(e){t.viewer.gestureSettingsMouse.clickToZoom=e.clickToZoomEnabled}),this.component.subscribe(i.BaseEvents.OPEN_EXTERNAL_RESOURCE,function(e){t.whenResized(function(){t.isCreated||t.createUI(),t.openMedia(e)})}),this.component.subscribe(i.BaseEvents.CLEAR_ANNOTATIONS,function(){t.whenCreated(function(){t.extension.currentAnnotationRect=null,t.clearAnnotations()})}),this.component.subscribe(s.Events.NEXT_SEARCH_RESULT,function(){t.whenCreated(function(){t.nextAnnotation()})}),this.component.subscribe(s.Events.PREV_SEARCH_RESULT,function(){t.whenCreated(function(){t.prevAnnotation()})}),this.component.subscribe(s.Events.ZOOM_IN,function(){t.whenCreated(function(){t.zoomIn()})}),this.component.subscribe(s.Events.ZOOM_OUT,function(){t.whenCreated(function(){t.zoomOut()})}),this.component.subscribe(s.Events.ROTATE,function(){t.whenCreated(function(){t.rotateRight()})}),this.component.subscribe(i.BaseEvents.METRIC_CHANGED,function(){t.whenCreated(function(){t.updateResponsiveView()})})},t.prototype.whenCreated=function(e){var t=this;Utils.Async.waitFor(function(){return t.isCreated},e)},t.prototype.zoomIn=function(){this.viewer.viewport.zoomTo(2*this.viewer.viewport.getZoom(!0))},t.prototype.zoomOut=function(){this.viewer.viewport.zoomTo(.5*this.viewer.viewport.getZoom(!0))},t.prototype.rotateRight=function(){this.viewer.viewport.setRotation(this.viewer.viewport.getRotation()+90)},t.prototype.updateResponsiveView=function(){this.setNavigatorVisible(),this.extension.isDesktopMetric()?(this.viewer.autoHideControls=!0,this.$viewportNavButtons.show()):(this.viewer.autoHideControls=!1,this.$viewportNavButtons.hide())},t.prototype.createUI=function(){var e=this;this.$spinner=$('<div class="spinner"></div>'),this.$content.append(this.$spinner),this.viewer=OpenSeadragon({id:this.viewerId,ajaxWithCredentials:!1,showNavigationControl:!0,showNavigator:!0,showRotationControl:!0,showHomeControl:Utils.Bools.getBool(this.config.options.showHomeControl,!1),showFullPageControl:!1,defaultZoomLevel:this.config.options.defaultZoomLevel||0,maxZoomPixelRatio:this.config.options.maxZoomPixelRatio||2,controlsFadeDelay:this.config.options.controlsFadeDelay||250,controlsFadeLength:this.config.options.controlsFadeLength||250,navigatorPosition:this.config.options.navigatorPosition||"BOTTOM_RIGHT",animationTime:this.config.options.animationTime||1.2,visibilityRatio:this.config.options.visibilityRatio||.5,constrainDuringPan:Utils.Bools.getBool(this.config.options.constrainDuringPan,!1),immediateRender:Utils.Bools.getBool(this.config.options.immediateRender,!1),blendTime:this.config.options.blendTime||0,autoHideControls:Utils.Bools.getBool(this.config.options.autoHideControls,!0),prefixUrl:this.extension.data.root+"/img/",gestureSettingsMouse:{clickToZoom:Utils.Bools.getBool(this.extension.data.config.options.clickToZoomEnabled,!0)},navImages:{zoomIn:{REST:"pixel.gif",GROUP:"pixel.gif",HOVER:"pixel.gif",DOWN:"pixel.gif"},zoomOut:{REST:"pixel.gif",GROUP:"pixel.gif",HOVER:"pixel.gif",DOWN:"pixel.gif"},home:{REST:"pixel.gif",GROUP:"pixel.gif",HOVER:"pixel.gif",DOWN:"pixel.gif"},rotateright:{REST:"pixel.gif",GROUP:"pixel.gif",HOVER:"pixel.gif",DOWN:"pixel.gif"},rotateleft:{REST:"pixel.gif",GROUP:"pixel.gif",HOVER:"pixel.gif",DOWN:"pixel.gif"},next:{REST:"pixel.gif",GROUP:"pixel.gif",HOVER:"pixel.gif",DOWN:"pixel.gif"},previous:{REST:"pixel.gif",GROUP:"pixel.gif",HOVER:"pixel.gif",DOWN:"pixel.gif"}}}),this.$zoomInButton=this.$viewer.find('div[title="Zoom in"]'),this.$zoomInButton.attr("tabindex",0),this.$zoomInButton.prop("title",this.content.zoomIn),this.$zoomInButton.addClass("zoomIn viewportNavButton"),this.$zoomOutButton=this.$viewer.find('div[title="Zoom out"]'),this.$zoomOutButton.attr("tabindex",0),this.$zoomOutButton.prop("title",this.content.zoomOut),this.$zoomOutButton.addClass("zoomOut viewportNavButton"),this.$goHomeButton=this.$viewer.find('div[title="Go home"]'),this.$goHomeButton.attr("tabindex",0),this.$goHomeButton.prop("title",this.content.goHome),this.$goHomeButton.addClass("goHome viewportNavButton"),this.$rotateButton=this.$viewer.find('div[title="Rotate right"]'),this.$rotateButton.attr("tabindex",0),this.$rotateButton.prop("title",this.content.rotateRight),this.$rotateButton.addClass("rotate viewportNavButton"),this.$viewportNavButtonsContainer=this.$viewer.find(".openseadragon-container > div:not(.openseadragon-canvas):first"),this.$viewportNavButtons=this.$viewportNavButtonsContainer.find(".viewportNavButton"),this.$canvas=$(this.viewer.canvas),this.$canvas.on("contextmenu",function(){return!1}),this.$navigator=this.$viewer.find(".navigator"),this.setNavigatorVisible(),this.$element.on("mousemove",function(){e.controlsVisible||(e.controlsVisible=!0,e.viewer.setControlsEnabled(!0))}),this.$element.on("mouseleave",function(){e.controlsVisible&&(e.controlsVisible=!1,e.viewer.setControlsEnabled(!1))}),this.$element.on("mousemove",function(){if(!e.$prevButton.ismouseover()&&!e.$nextButton.ismouseover()&&!e.$viewer.find(".navigator").ismouseover()){if(!e.controlsVisible)return;e.controlsVisible=!1,e.viewer.setControlsEnabled(!1)}},this.config.options.controlsFadeAfterInactive),this.viewer.addHandler("tile-drawn",function(){e.$spinner.hide()}),this.viewer.addHandler("resize",function(t){e.component.publish(s.Events.SEADRAGON_RESIZE,t),e.viewerResize(t)}),this.viewer.addHandler("animation-start",function(t){e.component.publish(s.Events.SEADRAGON_ANIMATION_START,t)}),this.viewer.addHandler("animation",function(t){e.component.publish(s.Events.SEADRAGON_ANIMATION,t)}),this.viewer.addHandler("animation-finish",function(t){e.currentBounds=e.getViewportBounds(),e.updateVisibleAnnotationRects(),e.component.publish(s.Events.SEADRAGON_ANIMATION_FINISH,t)}),this.viewer.addHandler("rotate",function(t){e.component.publish(s.Events.SEADRAGON_ROTATION,t.degrees)}),this.title=this.extension.helper.getLabel(),this.createNavigationButtons(),this.hidePrevButton(),this.hideNextButton(),this.isCreated=!0,this.resize()},t.prototype.createNavigationButtons=function(){var e=this,t=this.extension.helper.getViewingDirection()||n.ViewingDirection.LEFT_TO_RIGHT;switch(this.$prevButton=$('<div class="paging btn prev" tabindex="0"></div>'),this.extension.helper.isRightToLeft()?this.$prevButton.prop("title",this.content.next):this.$prevButton.prop("title",this.content.previous),this.$nextButton=$('<div class="paging btn next" tabindex="0"></div>'),this.extension.helper.isRightToLeft()?this.$nextButton.prop("title",this.content.previous):this.$nextButton.prop("title",this.content.next),this.viewer.addControl(this.$prevButton[0],{anchor:OpenSeadragon.ControlAnchor.TOP_LEFT}),this.viewer.addControl(this.$nextButton[0],{anchor:OpenSeadragon.ControlAnchor.TOP_RIGHT}),t.toString()){case n.ViewingDirection.BOTTOM_TO_TOP.toString():case n.ViewingDirection.TOP_TO_BOTTOM.toString():this.$prevButton.addClass("vertical"),this.$nextButton.addClass("vertical")}var o=this;this.$prevButton.onPressed(function(r){if(r.preventDefault(),OpenSeadragon.cancelEvent(r),o.prevButtonEnabled)switch(t.toString()){case n.ViewingDirection.LEFT_TO_RIGHT.toString():case n.ViewingDirection.BOTTOM_TO_TOP.toString():case n.ViewingDirection.TOP_TO_BOTTOM.toString():e.component.publish(i.BaseEvents.PREV);break;case n.ViewingDirection.RIGHT_TO_LEFT.toString():e.component.publish(i.BaseEvents.NEXT)}}),this.$nextButton.onPressed(function(r){if(r.preventDefault(),OpenSeadragon.cancelEvent(r),o.nextButtonEnabled)switch(t.toString()){case n.ViewingDirection.LEFT_TO_RIGHT.toString():case n.ViewingDirection.BOTTOM_TO_TOP.toString():case n.ViewingDirection.TOP_TO_BOTTOM.toString():e.component.publish(i.BaseEvents.NEXT);break;case n.ViewingDirection.RIGHT_TO_LEFT.toString():e.component.publish(i.BaseEvents.PREV)}}),this.$prevButton.on("focus",function(){e.controlsVisible||(e.controlsVisible=!0,e.viewer.setControlsEnabled(!0))}),this.$nextButton.on("focus",function(){e.controlsVisible||(e.controlsVisible=!0,e.viewer.setControlsEnabled(!0))})},t.prototype.openMedia=function(e){var t=this;this.$spinner.show(),this.items=[],this.extension.getExternalResources(e).then(function(e){t.viewer.close(),e=t.getPagePositions(e);for(var n=0;n<e.length;n++){var i=e[n],o=void 0;o=i.hasServiceDescriptor?i:{type:"image",url:i.id,buildPyramid:!1},t.viewer.addTiledImage({tileSource:o,x:i.x,y:i.y,width:i.width,success:function(n){t.items.push(n),t.items.length===e.length&&t.openPagesHandler(),t.resize()}})}})},t.prototype.getPagePositions=function(e){var t,n,i,o,r,s;if(e.length>1)if(2===e.length)this.extension.helper.isVerticallyAligned()?(i=e[0],i.y=0,o=e[1],o.y=i.height+this.config.options.pageGap):(t=e[0],t.x=0,n=e[1],n.x=t.width+this.config.options.pageGap);else if(this.extension.helper.isVerticallyAligned())if(this.extension.helper.isTopToBottom())for(var a=0;a<e.length-1;a++)r=e[a],s=e[a+1],s.y=(r.y||0)+r.height;else for(var a=e.length;a>0;a--)r=e[a],s=e[a-1],s.y=(r.y||0)-r.height;else if(this.extension.helper.isLeftToRight())for(var a=0;a<e.length-1;a++)r=e[a],s=e[a+1],s.x=(r.x||0)+r.width;else for(var a=e.length-1;a>0;a--)r=e[a],s=e[a-1],s.x=(r.x||0)-r.width;return e},t.prototype.openPagesHandler=function(){if(this.component.publish(s.Events.SEADRAGON_OPEN),this.extension.helper.isMultiCanvas()&&!this.extension.helper.isContinuous()){this.showPrevButton(),this.showNextButton(),$(".navigator").addClass("extraMargin");var e=this.extension.helper.getViewingDirection()||n.ViewingDirection.LEFT_TO_RIGHT;e.toString()===n.ViewingDirection.RIGHT_TO_LEFT.toString()?(this.extension.helper.isFirstCanvas()?this.disableNextButton():this.enableNextButton(),this.extension.helper.isLastCanvas()?this.disablePrevButton():this.enablePrevButton()):(this.extension.helper.isFirstCanvas()?this.disablePrevButton():this.enablePrevButton(),this.extension.helper.isLastCanvas()?this.disableNextButton():this.enableNextButton())}this.setNavigatorVisible(),this.overlayAnnotations(),this.updateBounds(),this.navigatedFromSearch&&(this.navigatedFromSearch=!1,this.zoomToInitialAnnotation()),this.isFirstLoad=!1},t.prototype.zoomToInitialAnnotation=function(){var e=this.getInitialAnnotationRect();this.extension.previousAnnotationRect=null,this.extension.currentAnnotationRect=null,e&&this.isZoomToSearchResultEnabled()&&this.zoomToAnnotation(e)},t.prototype.overlayAnnotations=function(){for(var e=this.getAnnotationsForCurrentImages(),t=0;t<e.length;t++)for(var n=e[t],i=this.getAnnotationOverlayRects(n),o=0;o<i.length;o++){var r=i[o],s=document.createElement("div");s.id="searchResult-"+r.canvasIndex+"-"+r.resultIndex,s.className="searchOverlay",s.title=a.UVUtils.sanitize(r.chars),this.viewer.addOverlay(s,r)}},t.prototype.updateBounds=function(){var e=this.extension.getSettings();this.isFirstLoad?(this.initialRotation=this.extension.data.rotation,this.initialRotation&&this.viewer.viewport.setRotation(parseInt(this.initialRotation)),this.initialBounds=this.extension.data.xywh,this.initialBounds&&(this.initialBounds=o.Bounds.fromString(this.initialBounds),this.currentBounds=this.initialBounds,this.fitToBounds(this.currentBounds))):e.preserveViewport?this.fitToBounds(this.currentBounds):this.goHome()},t.prototype.goHome=function(){this.viewer.viewport.goHome(!0)},t.prototype.disablePrevButton=function(){this.prevButtonEnabled=!1,this.$prevButton.addClass("disabled")},t.prototype.enablePrevButton=function(){this.prevButtonEnabled=!0,this.$prevButton.removeClass("disabled")},t.prototype.hidePrevButton=function(){this.disablePrevButton(),this.$prevButton.hide()},t.prototype.showPrevButton=function(){this.enablePrevButton(),this.$prevButton.show()},t.prototype.disableNextButton=function(){this.nextButtonEnabled=!1,this.$nextButton.addClass("disabled")},t.prototype.enableNextButton=function(){this.nextButtonEnabled=!0,this.$nextButton.removeClass("disabled");
},t.prototype.hideNextButton=function(){this.disableNextButton(),this.$nextButton.hide()},t.prototype.showNextButton=function(){this.enableNextButton(),this.$nextButton.show()},t.prototype.fitToBounds=function(e,t){void 0===t&&(t=!0);var n=new OpenSeadragon.Rect;n.x=Number(e.x),n.y=Number(e.y),n.width=Number(e.w),n.height=Number(e.h),this.viewer.viewport.fitBoundsWithConstraints(n,t)},t.prototype.getCroppedImageBounds=function(){if(!this.viewer||!this.viewer.viewport)return null;var e=this.extension.helper.getCurrentCanvas(),t=this.extension.getCroppedImageDimensions(e,this.viewer);if(t){var n=new o.Bounds(t.regionPos.x,t.regionPos.y,t.region.width,t.region.height);return n.toString()}return null},t.prototype.getViewportBounds=function(){if(!this.viewer||!this.viewer.viewport)return null;var e=this.viewer.viewport.getBounds(!0);return new o.Bounds(Math.floor(e.x),Math.floor(e.y),Math.floor(e.width),Math.floor(e.height))},t.prototype.viewerResize=function(e){if(e.viewport){var t=e.viewport.getCenter(!0);t&&setTimeout(function(){e.viewport.panTo(t,!0)},1)}},t.prototype.clearAnnotations=function(){this.$canvas.find(".searchOverlay").hide()},t.prototype.getAnnotationsForCurrentImages=function(){var e=[],t=this.extension.annotations;if(!t||!t.length)return e;for(var n=this.extension.getPagedIndices(),i=0;i<n.length;i++)for(var o=n[i],r=0;r<t.length;r++)if(t[r].canvasIndex===o){e.push(t[r]);break}return e},t.prototype.getAnnotationRectsForCurrentImages=function(){var e=this.getAnnotationsForCurrentImages();return e.en().selectMany(function(e){return e.rects}).toArray()},t.prototype.updateVisibleAnnotationRects=function(){for(var e=this.getAnnotationRectsForCurrentImages(),t=0;t<e.length;t++){var n=e[t],i=this.viewer.viewport.getBounds();n.isVisible=Utils.Dimensions.hitRect(i.x,i.y,i.width,i.height,n.viewportX,n.viewportY)}},t.prototype.getAnnotationRectIndex=function(e){var t=this.getAnnotationRectsForCurrentImages();return t.indexOf(e)},t.prototype.isZoomToSearchResultEnabled=function(){return Utils.Bools.getBool(this.extension.data.config.options.zoomToSearchResultEnabled,!0)},t.prototype.prevAnnotation=function(){for(var e=this.getAnnotationRectsForCurrentImages(),t=this.extension.currentAnnotationRect,n=t?this.getAnnotationRectIndex(t):e.length,o=null,r=n-1;r>=0;r--){var a=e[r];o=a;break}o&&this.isZoomToSearchResultEnabled()?o.canvasIndex<this.extension.helper.canvasIndex?(this.extension.currentAnnotationRect=o,this.navigatedFromSearch=!0,this.component.publish(i.BaseEvents.ANNOTATION_CANVAS_CHANGED,o)):this.zoomToAnnotation(o):(this.navigatedFromSearch=!0,this.component.publish(s.Events.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE))},t.prototype.nextAnnotation=function(){for(var e=this.getAnnotationRectsForCurrentImages(),t=this.extension.currentAnnotationRect,n=t?this.getAnnotationRectIndex(t):-1,o=null,r=n+1;r<e.length;r++){var a=e[r];o=a;break}o&&this.isZoomToSearchResultEnabled()?o.canvasIndex>this.extension.helper.canvasIndex?(this.extension.currentAnnotationRect=o,this.navigatedFromSearch=!0,this.component.publish(i.BaseEvents.ANNOTATION_CANVAS_CHANGED,[o])):this.zoomToAnnotation(o):(this.navigatedFromSearch=!0,this.component.publish(s.Events.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE))},t.prototype.getAnnotationRectByIndex=function(e){var t=this.getAnnotationRectsForCurrentImages();return t.length?t[e]:null},t.prototype.getInitialAnnotationRect=function(){var e=this,t=this.getAnnotationRectsForCurrentImages();if(!t.length)return null;var n=this.extension.previousAnnotationRect;return!n&&this.extension.lastCanvasIndex>this.extension.helper.canvasIndex?t.en().where(function(t){return t.canvasIndex===e.extension.helper.canvasIndex}).last():t.en().where(function(t){return t.canvasIndex===e.extension.helper.canvasIndex}).first()},t.prototype.zoomToAnnotation=function(e){if(this.extension.previousAnnotationRect=this.extension.currentAnnotationRect||e,this.extension.currentAnnotationRect=e,Utils.Bools.getBool(this.extension.data.config.options.zoomToBoundsEnabled,!1))this.fitToBounds(new o.Bounds(e.viewportX,e.viewportY,e.width,e.height),!1);else{var t=e.viewportX-(.5*this.currentBounds.w-.5*e.width),n=e.viewportY-(.5*this.currentBounds.h-.5*e.height),r=this.currentBounds.w,s=this.currentBounds.h,a=new o.Bounds(t,n,r,s);this.fitToBounds(a)}this.highlightAnnotationRect(e),this.component.publish(i.BaseEvents.ANNOTATION_CHANGED)},t.prototype.highlightAnnotationRect=function(e){var t=$("#searchResult-"+e.canvasIndex+"-"+e.index);t.addClass("current"),$(".searchOverlay").not(t).removeClass("current")},t.prototype.getAnnotationOverlayRects=function(e){var t=[];if(!this.extension.resources)return t;var n=this.extension.resources.en().where(function(t){return t.index===e.canvasIndex}).first(),i=this.extension.resources.indexOf(n),o=0;i>0&&(o=this.extension.resources[i-1].width);for(var r=0;r<e.rects.length;r++){var s=e.rects[r],a=s.x+o+(i>0?this.config.options.pageGap:0),u=s.y,l=s.width,c=s.height,h=new OpenSeadragon.Rect(a,u,l,c);s.viewportX=a,s.viewportY=u,h.canvasIndex=s.canvasIndex,h.resultIndex=s.index,h.chars=s.chars,t.push(h)}return t},t.prototype.resize=function(){var t=this;if(e.prototype.resize.call(this),this.$viewer.height(this.$content.height()-this.$viewer.verticalMargins()),this.$viewer.width(this.$content.width()-this.$viewer.horizontalMargins()),this.isCreated){this.title&&this.$title.text(a.UVUtils.sanitize(this.title)),this.$spinner.css("top",this.$content.height()/2-this.$spinner.height()/2),this.$spinner.css("left",this.$content.width()/2-this.$spinner.width()/2);var i=this.extension.helper.getViewingDirection()||n.ViewingDirection.LEFT_TO_RIGHT;if(this.extension.helper.isMultiCanvas()&&this.$prevButton&&this.$nextButton){var o=Math.floor(this.$content.width()/2);switch(i.toString()){case n.ViewingDirection.BOTTOM_TO_TOP.toString():this.$prevButton.addClass("down"),this.$nextButton.addClass("up"),this.$prevButton.css("left",o-this.$prevButton.outerWidth()/2),this.$prevButton.css("top",this.$content.height()-this.$prevButton.height()),this.$nextButton.css("left",-1*o-this.$nextButton.outerWidth()/2);break;case n.ViewingDirection.TOP_TO_BOTTOM.toString():this.$prevButton.css("left",o-this.$prevButton.outerWidth()/2),this.$nextButton.css("left",-1*o-this.$nextButton.outerWidth()/2),this.$nextButton.css("top",this.$content.height()-this.$nextButton.height());break;default:this.$prevButton.css("top",(this.$content.height()-this.$prevButton.height())/2),this.$nextButton.css("top",(this.$content.height()-this.$nextButton.height())/2)}}setTimeout(function(){if(t.extension.helper.isContinuous())if(t.extension.helper.isHorizontallyAligned()){var e=t.$viewer.width()-t.$viewer.rightMargin();t.$navigator.width(e)}else t.$navigator.height(t.$viewer.height())},100)}},t.prototype.setFocus=function(){this.$canvas.is(":focus")||this.extension.data.config.options.allowStealFocus&&this.$canvas.focus()},t.prototype.setNavigatorVisible=function(){var e=Utils.Bools.getBool(this.extension.getSettings().navigatorEnabled,!0)&&this.extension.isDesktopMetric();this.viewer.navigator.setVisible(e),e?this.$navigator.show():this.$navigator.hide()},t}(r.CenterPanel);t.SeadragonCenterPanel=u});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("extensions/uv-seadragon-extension/SettingsDialogue",["require","exports","../../modules/uv-dialogues-module/SettingsDialogue"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("settingsDialogue"),e.prototype.create.call(this),this.$navigatorEnabled=$('<div class="setting navigatorEnabled"></div>'),this.$scroll.append(this.$navigatorEnabled),this.$navigatorEnabledCheckbox=$('<input id="navigatorEnabled" type="checkbox" tabindex="0" />'),this.$navigatorEnabled.append(this.$navigatorEnabledCheckbox),this.$navigatorEnabledLabel=$('<label for="navigatorEnabled">'+this.content.navigatorEnabled+"</label>"),this.$navigatorEnabled.append(this.$navigatorEnabledLabel),this.$pagingEnabled=$('<div class="setting pagingEnabled"></div>'),this.$scroll.append(this.$pagingEnabled),this.$pagingEnabledCheckbox=$('<input id="pagingEnabled" type="checkbox" tabindex="0" />'),this.$pagingEnabled.append(this.$pagingEnabledCheckbox),this.$pagingEnabledLabel=$('<label for="pagingEnabled">'+this.content.pagingEnabled+"</label>"),this.$pagingEnabled.append(this.$pagingEnabledLabel),this.$clickToZoomEnabled=$('<div class="setting clickToZoom"></div>'),this.$scroll.append(this.$clickToZoomEnabled),this.$clickToZoomEnabledCheckbox=$('<input id="clickToZoomEnabled" type="checkbox" />'),this.$clickToZoomEnabled.append(this.$clickToZoomEnabledCheckbox),this.$clickToZoomEnabledLabel=$('<label for="clickToZoomEnabled">'+this.content.clickToZoomEnabled+"</label>"),this.$clickToZoomEnabled.append(this.$clickToZoomEnabledLabel),this.$preserveViewport=$('<div class="setting preserveViewport"></div>'),this.$scroll.append(this.$preserveViewport),this.$preserveViewportCheckbox=$('<input id="preserveViewport" type="checkbox" tabindex="0" />'),this.$preserveViewport.append(this.$preserveViewportCheckbox),this.$preserveViewportLabel=$('<label for="preserveViewport">'+this.content.preserveViewport+"</label>"),this.$preserveViewport.append(this.$preserveViewportLabel),this.$navigatorEnabledCheckbox.change(function(){var e={};t.$navigatorEnabledCheckbox.is(":checked")?e.navigatorEnabled=!0:e.navigatorEnabled=!1,t.updateSettings(e)}),this.$clickToZoomEnabledCheckbox.change(function(){var e={};t.$clickToZoomEnabledCheckbox.is(":checked")?e.clickToZoomEnabled=!0:e.clickToZoomEnabled=!1,t.updateSettings(e)}),this.$pagingEnabledCheckbox.change(function(){var e={};t.$pagingEnabledCheckbox.is(":checked")?e.pagingEnabled=!0:e.pagingEnabled=!1,t.updateSettings(e)}),this.$preserveViewportCheckbox.change(function(){var e={};t.$preserveViewportCheckbox.is(":checked")?e.preserveViewport=!0:e.preserveViewport=!1,t.updateSettings(e)})},t.prototype.open=function(){e.prototype.open.call(this);var t=this.getSettings();t.navigatorEnabled?this.$navigatorEnabledCheckbox.prop("checked",!0):this.$navigatorEnabledCheckbox.removeAttr("checked"),t.clickToZoomEnabled?this.$clickToZoomEnabledCheckbox.prop("checked",!0):this.$clickToZoomEnabledCheckbox.removeAttr("checked"),this.extension.helper.isPagingAvailable()?t.pagingEnabled?this.$pagingEnabledCheckbox.prop("checked",!0):this.$pagingEnabledCheckbox.removeAttr("checked"):this.$pagingEnabled.hide(),t.preserveViewport?this.$preserveViewportCheckbox.prop("checked",!0):this.$preserveViewportCheckbox.removeAttr("checked")},t}(n.SettingsDialogue);t.SettingsDialogue=i});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("extensions/uv-seadragon-extension/ShareDialogue",["require","exports","./Events","../../modules/uv-dialogues-module/ShareDialogue"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){var i=e.call(this,t)||this;return i.component.subscribe(n.Events.SEADRAGON_OPEN,function(){i.update()}),i.component.subscribe(n.Events.SEADRAGON_ANIMATION_FINISH,function(){i.update()}),i}return __extends(t,e),t.prototype.create=function(){this.setConfig("shareDialogue"),e.prototype.create.call(this)},t.prototype.update=function(){e.prototype.update.call(this);var t=this.extension.getViewportBounds(),n=this.extension.getViewerRotation();this.code=this.extension.getEmbedScript(this.options.embedTemplate,this.currentWidth,this.currentHeight,t,n),this.$code.val(this.code)},t.prototype.resize=function(){e.prototype.resize.call(this)},t}(i.ShareDialogue);t.ShareDialogue=o});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("extensions/uv-seadragon-extension/Extension",["require","exports","manifesto.js","@iiif/manifold","../../modules/uv-shared-module/AnnotationResults","../../modules/uv-shared-module/BaseEvents","../../modules/uv-shared-module/BaseExtension","../../modules/uv-shared-module/Bookmark","../../modules/uv-contentleftpanel-module/ContentLeftPanel","./CroppedImageDimensions","./DownloadDialogue","./Events","../../modules/uv-dialogues-module/ExternalContentDialogue","../../modules/uv-osdmobilefooterpanel-module/MobileFooter","../../modules/uv-searchfooterpanel-module/FooterPanel","../../modules/uv-dialogues-module/HelpDialogue","./Mode","../../modules/uv-dialogues-module/MoreInfoDialogue","../../modules/uv-moreinforightpanel-module/MoreInfoRightPanel","../../modules/uv-multiselectdialogue-module/MultiSelectDialogue","./MultiSelectionArgs","../../modules/uv-pagingheaderpanel-module/PagingHeaderPanel","../../modules/uv-shared-module/Point","../../modules/uv-seadragoncenterpanel-module/SeadragonCenterPanel","./SettingsDialogue","./ShareDialogue","@iiif/vocabulary"],function(e,t,n,i,o,r,s,a,u,l,c,h,p,d,f,g,v,_,m,E,y,b,I,T,O,A,C){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var w=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.annotations=[],t.currentRotation=0,t.isAnnotating=!1,t}return __extends(t,e),t.prototype.create=function(){var t=this;e.prototype.create.call(this),this.component.subscribe(r.BaseEvents.METRIC_CHANGED,function(){if(t.isDesktopMetric())t.shell.$rightPanel.show();else{var e={};e.pagingEnabled=!1,t.updateSettings(e),t.component.publish(r.BaseEvents.UPDATE_SETTINGS),t.shell.$rightPanel.hide()}}),this.component.subscribe(r.BaseEvents.CANVAS_INDEX_CHANGED,function(e){t.previousAnnotationRect=null,t.currentAnnotationRect=null,t.viewPage(e)}),this.component.subscribe(r.BaseEvents.CLEAR_ANNOTATIONS,function(){t.clearAnnotations(),t.component.publish(r.BaseEvents.ANNOTATIONS_CLEARED),t.fire(r.BaseEvents.CLEAR_ANNOTATIONS)}),this.component.subscribe(r.BaseEvents.DOWN_ARROW,function(){t.useArrowKeysToNavigate()||t.centerPanel.setFocus()}),this.component.subscribe(r.BaseEvents.END,function(){t.component.publish(r.BaseEvents.CANVAS_INDEX_CHANGED,t.helper.getLastPageIndex())}),this.component.subscribe(r.BaseEvents.FIRST,function(){t.fire(r.BaseEvents.FIRST),t.component.publish(r.BaseEvents.CANVAS_INDEX_CHANGED,t.helper.getFirstPageIndex())}),this.component.subscribe(r.BaseEvents.GALLERY_DECREASE_SIZE,function(){t.fire(r.BaseEvents.GALLERY_DECREASE_SIZE)}),this.component.subscribe(r.BaseEvents.GALLERY_INCREASE_SIZE,function(){t.fire(r.BaseEvents.GALLERY_INCREASE_SIZE)}),this.component.subscribe(r.BaseEvents.GALLERY_THUMB_SELECTED,function(){t.fire(r.BaseEvents.GALLERY_THUMB_SELECTED)}),this.component.subscribe(r.BaseEvents.HOME,function(){t.component.publish(r.BaseEvents.CANVAS_INDEX_CHANGED,t.helper.getFirstPageIndex())}),this.component.subscribe(h.Events.IMAGE_SEARCH,function(e){t.fire(h.Events.IMAGE_SEARCH,e),t.component.publish(r.BaseEvents.CANVAS_INDEX_CHANGED,e)}),this.component.subscribe(r.BaseEvents.LAST,function(){t.fire(r.BaseEvents.LAST),t.component.publish(r.BaseEvents.CANVAS_INDEX_CHANGED,t.helper.getLastPageIndex())}),this.component.subscribe(r.BaseEvents.LEFT_ARROW,function(){t.useArrowKeysToNavigate()?t.component.publish(r.BaseEvents.CANVAS_INDEX_CHANGED,t.getPrevPageIndex()):t.centerPanel.setFocus()}),this.component.subscribe(r.BaseEvents.LEFTPANEL_COLLAPSE_FULL_START,function(){t.isDesktopMetric()&&t.shell.$rightPanel.show()}),this.component.subscribe(r.BaseEvents.LEFTPANEL_COLLAPSE_FULL_FINISH,function(){t.shell.$centerPanel.show(),t.resize()}),this.component.subscribe(r.BaseEvents.LEFTPANEL_EXPAND_FULL_START,function(){t.shell.$centerPanel.hide(),t.shell.$rightPanel.hide()}),this.component.subscribe(r.BaseEvents.MINUS,function(){t.centerPanel.setFocus()}),this.component.subscribe(h.Events.MODE_CHANGED,function(e){t.fire(h.Events.MODE_CHANGED,e),t.mode=new v.Mode(e);var n=t.getSettings();t.component.publish(r.BaseEvents.SETTINGS_CHANGED,n)}),this.component.subscribe(r.BaseEvents.MULTISELECTION_MADE,function(e){var n=new y.MultiSelectionArgs;n.manifestUri=t.helper.manifestUri,n.allCanvases=e.length===t.helper.getCanvases().length,n.canvases=e,n.format=t.data.config.options.multiSelectionMimeType,n.sequence=t.helper.getCurrentSequence().id,t.fire(r.BaseEvents.MULTISELECTION_MADE,n)}),this.component.subscribe(r.BaseEvents.NEXT,function(){t.fire(r.BaseEvents.NEXT),t.component.publish(r.BaseEvents.CANVAS_INDEX_CHANGED,t.getNextPageIndex())}),this.component.subscribe(h.Events.NEXT_SEARCH_RESULT,function(){t.fire(h.Events.NEXT_SEARCH_RESULT)}),this.component.subscribe(h.Events.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE,function(){t.fire(h.Events.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE),t.nextSearchResult()}),this.component.subscribe(h.Events.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE,function(){t.fire(h.Events.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE),t.prevSearchResult()}),this.component.subscribe(r.BaseEvents.OPEN_THUMBS_VIEW,function(){t.fire(r.BaseEvents.OPEN_THUMBS_VIEW)}),this.component.subscribe(r.BaseEvents.OPEN_TREE_VIEW,function(){t.fire(r.BaseEvents.OPEN_TREE_VIEW)}),this.component.subscribe(r.BaseEvents.PAGE_DOWN,function(){t.component.publish(r.BaseEvents.CANVAS_INDEX_CHANGED,t.getNextPageIndex())}),this.component.subscribe(h.Events.PAGE_SEARCH,function(e){t.fire(h.Events.PAGE_SEARCH,e),t.viewLabel(e)}),this.component.subscribe(r.BaseEvents.PAGE_UP,function(){t.component.publish(r.BaseEvents.CANVAS_INDEX_CHANGED,t.getPrevPageIndex())}),this.component.subscribe(h.Events.PAGING_TOGGLED,function(e){t.fire(h.Events.PAGING_TOGGLED,e)}),this.component.subscribe(r.BaseEvents.PLUS,function(){t.centerPanel.setFocus()}),this.component.subscribe(r.BaseEvents.PREV,function(){t.fire(r.BaseEvents.PREV),t.component.publish(r.BaseEvents.CANVAS_INDEX_CHANGED,t.getPrevPageIndex())}),this.component.subscribe(h.Events.PREV_SEARCH_RESULT,function(){t.fire(h.Events.PREV_SEARCH_RESULT)}),this.component.subscribe(h.Events.PRINT,function(){t.print()}),this.component.subscribe(r.BaseEvents.RELOAD,function(){t.component.publish(r.BaseEvents.CLEAR_ANNOTATIONS)}),this.component.subscribe(r.BaseEvents.RIGHT_ARROW,function(){t.useArrowKeysToNavigate()?t.component.publish(r.BaseEvents.CANVAS_INDEX_CHANGED,t.getNextPageIndex()):t.centerPanel.setFocus()}),this.component.subscribe(h.Events.SEADRAGON_ANIMATION,function(){t.fire(h.Events.SEADRAGON_ANIMATION)}),this.component.subscribe(h.Events.SEADRAGON_ANIMATION_FINISH,function(e){var n=t.centerPanel.getViewportBounds();t.centerPanel&&n&&(t.component.publish(h.Events.XYWH_CHANGED,n.toString()),t.data.xywh=n.toString(),t.fire(h.Events.XYWH_CHANGED,t.data.xywh));var i=t.helper.getCurrentCanvas();t.fire(h.Events.CURRENT_VIEW_URI,{cropUri:t.getCroppedImageUri(i,t.getViewer()),fullUri:t.getConfinedImageUri(i,i.getWidth())})}),this.component.subscribe(h.Events.SEADRAGON_ANIMATION_START,function(){t.fire(h.Events.SEADRAGON_ANIMATION_START)}),this.component.subscribe(h.Events.SEADRAGON_OPEN,function(){t.useArrowKeysToNavigate()||t.centerPanel.setFocus(),t.fire(h.Events.SEADRAGON_OPEN)}),this.component.subscribe(h.Events.SEADRAGON_RESIZE,function(){t.fire(h.Events.SEADRAGON_RESIZE)}),this.component.subscribe(h.Events.SEADRAGON_ROTATION,function(e){t.data.rotation=e,t.fire(h.Events.SEADRAGON_ROTATION,t.data.rotation),t.currentRotation=e}),this.component.subscribe(h.Events.SEARCH,function(e){t.fire(h.Events.SEARCH,e),t.search(e)}),this.component.subscribe(h.Events.SEARCH_PREVIEW_FINISH,function(){t.fire(h.Events.SEARCH_PREVIEW_FINISH)}),this.component.subscribe(h.Events.SEARCH_PREVIEW_START,function(){t.fire(h.Events.SEARCH_PREVIEW_START)}),this.component.subscribe(r.BaseEvents.ANNOTATIONS,function(e){t.fire(r.BaseEvents.ANNOTATIONS,e)}),this.component.subscribe(r.BaseEvents.ANNOTATION_CANVAS_CHANGED,function(e){t.component.publish(r.BaseEvents.CANVAS_INDEX_CHANGED,e.canvasIndex)}),this.component.subscribe(r.BaseEvents.ANNOTATIONS_EMPTY,function(){t.fire(r.BaseEvents.ANNOTATIONS_EMPTY)}),this.component.subscribe(r.BaseEvents.THUMB_SELECTED,function(e){t.component.publish(r.BaseEvents.CANVAS_INDEX_CHANGED,e.index)}),this.component.subscribe(r.BaseEvents.TREE_NODE_SELECTED,function(e){t.fire(r.BaseEvents.TREE_NODE_SELECTED,e.data.path),t.treeNodeSelected(e)}),this.component.subscribe(r.BaseEvents.UP_ARROW,function(){t.useArrowKeysToNavigate()||t.centerPanel.setFocus()}),this.component.subscribe(r.BaseEvents.UPDATE_SETTINGS,function(){t.component.publish(r.BaseEvents.CANVAS_INDEX_CHANGED,t.helper.canvasIndex);var e=t.getSettings();t.component.publish(r.BaseEvents.SETTINGS_CHANGED,e)})},t.prototype.createModules=function(){e.prototype.createModules.call(this),this.isHeaderPanelEnabled()?this.headerPanel=new b.PagingHeaderPanel(this.shell.$headerPanel):this.shell.$headerPanel.hide(),this.isLeftPanelEnabled()?this.leftPanel=new u.ContentLeftPanel(this.shell.$leftPanel):this.shell.$leftPanel.hide(),this.centerPanel=new T.SeadragonCenterPanel(this.shell.$centerPanel),this.isRightPanelEnabled()?this.rightPanel=new m.MoreInfoRightPanel(this.shell.$rightPanel):this.shell.$rightPanel.hide(),this.isFooterPanelEnabled()?(this.footerPanel=new f.FooterPanel(this.shell.$footerPanel),this.mobileFooterPanel=new d.FooterPanel(this.shell.$mobileFooterPanel)):this.shell.$footerPanel.hide(),this.$helpDialogue=$('<div class="overlay help" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$helpDialogue),this.helpDialogue=new g.HelpDialogue(this.$helpDialogue),this.$moreInfoDialogue=$('<div class="overlay moreInfo" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$moreInfoDialogue),this.moreInfoDialogue=new _.MoreInfoDialogue(this.$moreInfoDialogue),this.$multiSelectDialogue=$('<div class="overlay multiSelect" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$multiSelectDialogue),this.multiSelectDialogue=new E.MultiSelectDialogue(this.$multiSelectDialogue),this.$shareDialogue=$('<div class="overlay share" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$shareDialogue),this.shareDialogue=new A.ShareDialogue(this.$shareDialogue),this.$downloadDialogue=$('<div class="overlay download" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$downloadDialogue),this.downloadDialogue=new c.DownloadDialogue(this.$downloadDialogue),this.$settingsDialogue=$('<div class="overlay settings" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$settingsDialogue),this.settingsDialogue=new O.SettingsDialogue(this.$settingsDialogue),this.$externalContentDialogue=$('<div class="overlay externalContent" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$externalContentDialogue),this.externalContentDialogue=new p.ExternalContentDialogue(this.$externalContentDialogue),this.isHeaderPanelEnabled()&&this.headerPanel.init(),this.isLeftPanelEnabled()&&this.leftPanel.init(),this.isRightPanelEnabled()&&this.rightPanel.init(),this.isFooterPanelEnabled()&&this.footerPanel.init()},t.prototype.render=function(){e.prototype.render.call(this),this.checkForAnnotations(),this.checkForSearchParam(),this.checkForRotationParam()},t.prototype.checkForAnnotations=function(){if(this.data.annotations){var e=this.parseAnnotationList(this.data.annotations);this.component.publish(r.BaseEvents.CLEAR_ANNOTATIONS),this.annotate(e)}},t.prototype.annotate=function(e,t){this.annotations=e,this.annotations=e.sort(function(e,t){return e.canvasIndex-t.canvasIndex});var n=new o.AnnotationResults;n.terms=t,n.annotations=this.annotations,this.component.publish(r.BaseEvents.ANNOTATIONS,n)},t.prototype.checkForSearchParam=function(){var e=this.data.highlight;e&&(e.replace(/\+/g," ").replace(/"/g,""),this.component.publish(h.Events.SEARCH,e))},t.prototype.checkForRotationParam=function(){var e=this.data.rotation;e&&this.component.publish(h.Events.SEADRAGON_ROTATION,e)},t.prototype.viewPage=function(e){if(-1!==e){var t=!1;if(e===this.helper.canvasIndex&&(t=!0),this.helper.isCanvasIndexOutOfRange(e)&&(this.showMessage(this.data.config.content.canvasIndexOutOfRange),e=0),this.isPagingSettingEnabled()&&!t){var n=this.getPagedIndices(e);if(n.includes(this.helper.canvasIndex))return void this.viewCanvas(e)}this.viewCanvas(e)}},t.prototype.getViewer=function(){return this.centerPanel.viewer},t.prototype.getMode=function(){if(this.mode)return this.mode;var e=this.helper.getManifestType();if(!e)return v.Mode.image;switch(e.toString()){case n.ManifestType.MONOGRAPH.toString():return v.Mode.page;case n.ManifestType.MANUSCRIPT.toString():return v.Mode.page;default:return v.Mode.image}},t.prototype.getViewportBounds=function(){if(!this.centerPanel)return null;var e=this.centerPanel.getViewportBounds();return e?e.toString():null},t.prototype.getViewerRotation=function(){return this.centerPanel?this.currentRotation:null},t.prototype.viewRange=function(e){var t=this.helper.getRangeByPath(e);if(t){var n=t.getCanvasIds()[0],i=this.helper.getCanvasIndexById(n);this.component.publish(r.BaseEvents.CANVAS_INDEX_CHANGED,i)}},t.prototype.viewLabel=function(e){if(!e)return this.showMessage(this.data.config.modules.genericDialogue.content.emptyValue),void this.component.publish(r.BaseEvents.CANVAS_INDEX_CHANGE_FAILED);var t=this.helper.getCanvasIndexByLabel(e);-1!=t?this.component.publish(r.BaseEvents.CANVAS_INDEX_CHANGED,t):(this.showMessage(this.data.config.modules.genericDialogue.content.pageNotFound),this.component.publish(r.BaseEvents.CANVAS_INDEX_CHANGE_FAILED))},t.prototype.treeNodeSelected=function(e){var t=e.data;if(t.type)switch(t.type){case C.IIIFResourceType.MANIFEST.toString():this.viewManifest(t);break;case C.IIIFResourceType.COLLECTION.toString():this.viewCollection(t);break;default:this.viewRange(t.path)}},t.prototype.clearAnnotations=function(){this.annotations=null,this.component.publish(r.BaseEvents.CANVAS_INDEX_CHANGED,this.helper.canvasIndex)},t.prototype.prevSearchResult=function(){var e;if(this.annotations)for(var t=this.annotations.length-1;t>=0;t--){var n=this.annotations[t];if(n.canvasIndex<=this.getPrevPageIndex()){e=n,this.component.publish(r.BaseEvents.CANVAS_INDEX_CHANGED,e.canvasIndex);break}}},t.prototype.nextSearchResult=function(){if(this.annotations)for(var e=0;e<this.annotations.length;e++){var t=this.annotations[e];if(t&&t.canvasIndex>=this.getNextPageIndex()){this.component.publish(r.BaseEvents.CANVAS_INDEX_CHANGED,t.canvasIndex);break}}},t.prototype.bookmark=function(){e.prototype.bookmark.call(this);var t=this.helper.getCurrentCanvas(),i=new a.Bookmark;i.index=this.helper.canvasIndex,i.label=n.LanguageMap.getValue(t.getLabel()),i.path=this.getCroppedImageUri(t,this.getViewer()),i.thumb=t.getCanonicalImageUri(this.data.config.options.bookmarkThumbWidth),i.title=this.helper.getLabel(),i.trackingLabel=window.trackingLabel,i.type=C.ExternalResourceType.IMAGE.toString(),this.fire(r.BaseEvents.BOOKMARK,i)},t.prototype.print=function(){window.print(),this.fire(h.Events.PRINT)},t.prototype.getCroppedImageDimensions=function(e,t){if(!t)return null;if(!t.viewport)return null;if(!e.getHeight()||!e.getWidth())return null;var i=t.viewport.getBounds(!0),o=new l.CroppedImageDimensions,r=Math.floor(i.width),s=Math.floor(i.height),a=Math.floor(i.x),u=Math.floor(i.y);a+r>e.getWidth()?r=e.getWidth()-a:0>a&&(r+=a),0>a&&(a=0),u+s>e.getHeight()?s=e.getHeight()-u:0>u&&(s+=u),0>u&&(u=0),r=Math.min(r,e.getWidth()),s=Math.min(s,e.getHeight());var c=r,h=s,p=e.getMaxDimensions();if(p){if(r>p.width){var d=p.width;s=Math.round(d*(s/r)),r=d}if(s>p.height){var f=p.height;r=Math.round(r/s*f),s=f}}return o.region=new n.Size(c,h),o.regionPos=new I.Point(a,u),o.size=new n.Size(r,s),o},t.prototype.getCroppedImageUri=function(e,t){if(!t)return null;if(!t.viewport)return null;var n=this.getCroppedImageDimensions(e,t);if(!n)return null;var i=this.getImageBaseUri(e),o=this.getImageId(e);if(!o)return null;var r=n.regionPos.x+","+n.regionPos.y+","+n.region.width+","+n.region.height,s=n.size.width+","+n.size.height,a=this.getViewerRotation(),u="default";return i+"/"+o+"/"+r+"/"+s+"/"+a+"/"+u+".jpg"},t.prototype.getConfinedImageDimensions=function(e,t){var i=new n.Size(0,0);i.width=t;var o=Utils.Maths.normalise(t,0,e.getWidth());return i.height=Math.floor(e.getHeight()*o),i},t.prototype.getConfinedImageUri=function(e,t){var n=this.getImageBaseUri(e),i=this.getImageId(e);if(!i)return null;var o="full",r=this.getConfinedImageDimensions(e,t),s=r.width+","+r.height,a=this.getViewerRotation(),u="default";return n+"/"+i+"/"+o+"/"+s+"/"+a+"/"+u+".jpg"},t.prototype.getImageId=function(e){if(e.externalResource){var t=e.externalResource.data["@id"];if(t)return t.substr(t.lastIndexOf("/")+1)}return null},t.prototype.getImageBaseUri=function(e){var t=this.getInfoUri(e);return t=t.substr(0,t.lastIndexOf("/")),t.substr(0,t.lastIndexOf("/"))},t.prototype.getInfoUri=function(e){var t=null,i=e.getImages();if(i&&i.length)for(var o=i[0],r=o.getResource(),s=r.getServices(),a=0;a<s.length;a++){var u=s[a],l=u.id;l.endsWith("/")||(l+="/"),n.Utils.isImageProfile(u.getProfile())&&(t=l+"info.json")}return t||(t="lib/imageunavailable.json"),t},t.prototype.getEmbedScript=function(e,t,n,i,o){var r=this.data.config.uri||"",s=this.getSerializedLocales(),a=this.getAppUri(),u=a+"#?manifest="+this.helper.manifestUri+"&c="+this.helper.collectionIndex+"&m="+this.helper.manifestIndex+"&s="+this.helper.sequenceIndex+"&cv="+this.helper.canvasIndex+"&config="+r+"&locales="+s+"&xywh="+i+"&r="+o,l=Utils.Strings.format(e,u,t.toString(),n.toString());return l},t.prototype.getPrevPageIndex=function(e){void 0===e&&(e=this.helper.canvasIndex);var t;if(this.isPagingSettingEnabled()){var n=this.getPagedIndices(e);t=this.helper.isRightToLeft()?n[n.length-1]-1:n[0]-1}else t=e-1;return t},t.prototype.isSearchEnabled=function(){return Utils.Bools.getBool(this.data.config.options.searchWithinEnabled,!1)&&this.helper.getSearchService()?!0:!1},t.prototype.isPagingSettingEnabled=function(){return this.helper.isPagingAvailable()?this.getSettings().pagingEnabled:!1},t.prototype.getNextPageIndex=function(e){void 0===e&&(e=this.helper.canvasIndex);var t;if(this.isPagingSettingEnabled()){var n=this.getPagedIndices(e);t=this.helper.isRightToLeft()?n[0]+1:n[n.length-1]+1}else t=e+1;return t>this.helper.getTotalCanvases()-1?-1:t},t.prototype.getAutoCompleteService=function(){var e=this.helper.getSearchService();return e?e.getService(C.ServiceProfile.SEARCH_1_AUTO_COMPLETE)||e.getService(C.ServiceProfile.SEARCH_0_AUTO_COMPLETE):null},t.prototype.getAutoCompleteUri=function(){var e=this.getAutoCompleteService();return e?e.id+"?q={0}":null},t.prototype.getSearchServiceUri=function(){var e=this.helper.getSearchService();if(!e)return null;var t=e.id;return t+="?q={0}"},t.prototype.search=function(e){var t=this;if(!this.isAnnotating){this.isAnnotating=!0,this.annotations=[];var n=this,i=this.getSearchServiceUri();i&&(i=Utils.Strings.format(i,encodeURIComponent(e)),this.getSearchResults(i,e,this.annotations,function(i){n.isAnnotating=!1,i.length?n.annotate(i,e):n.showMessage(n.data.config.modules.genericDialogue.content.noMatches,function(){t.component.publish(r.BaseEvents.ANNOTATIONS_EMPTY)})}))}},t.prototype.getSearchResults=function(e,t,n,i){var o=this;$.getJSON(e,function(e){e.resources&&e.resources.length&&(n=n.concat(o.parseAnnotationList(e))),e.next?o.getSearchResults(e.next,t,n,i):i(n);
})},t.prototype.parseAnnotationList=function(e){for(var t=[],n=function(n){var r=e.resources[n],s=o.helper.getCanvasIndexById(r.on.match(/(.*)#/)[1]),a=new i.AnnotationGroup(r,s),u=t.en().where(function(e){return e.canvasIndex===a.canvasIndex}).first();u?u.addRect(r):t.push(a)},o=this,r=0;r<e.resources.length;r++)n(r);return t.sort(function(e,t){return e.canvasIndex-t.canvasIndex}),t},t.prototype.getAnnotationRects=function(){return this.annotations?this.annotations.en().selectMany(function(e){return e.rects}).toArray():[]},t.prototype.getCurrentAnnotationRectIndex=function(){var e=this.getAnnotationRects();return this.currentAnnotationRect?e.indexOf(this.currentAnnotationRect):-1},t.prototype.getTotalAnnotationRects=function(){var e=this.getAnnotationRects();return e.length},t.prototype.isFirstAnnotationRect=function(){return 0===this.getCurrentAnnotationRectIndex()},t.prototype.getLastAnnotationRectIndex=function(){return this.getTotalAnnotationRects()-1},t.prototype.getPagedIndices=function(e){void 0===e&&(e=this.helper.canvasIndex);var t=[];return this.helper.isContinuous()?t=$.map(this.helper.getCanvases(),function(e,t){return t}):this.isPagingSettingEnabled()?(t=this.helper.isFirstCanvas(e)||this.helper.isLastCanvas(e)&&this.helper.isTotalCanvasesEven()?[e]:e%2?[e,e+1]:[e-1,e],this.helper.isRightToLeft()&&(t=t.reverse())):t.push(this.helper.canvasIndex),t},t}(s.BaseExtension);t.Extension=w});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("extensions/uv-pdf-extension/DownloadDialogue",["require","exports","../../modules/uv-dialogues-module/DownloadDialogue"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){this.setConfig("downloadDialogue"),e.prototype.create.call(this)},t.prototype.open=function(t){e.prototype.open.call(this,t),this.addEntireFileDownloadOptions(),this.$downloadOptions.find("li:visible").length?this.$noneAvailable.hide():this.$noneAvailable.show(),this.resize()},t.prototype.isDownloadOptionAvailable=function(t){return e.prototype.isDownloadOptionAvailable.call(this,t)},t}(n.DownloadDialogue);t.DownloadDialogue=i}),define("extensions/uv-pdf-extension/Events",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.namespace="pdfExtension.",e.PDF_LOADED=e.namespace+"pdfLoaded",e.PAGE_INDEX_CHANGED=e.namespace+"pageIndexChanged",e.SEARCH=e.namespace+"search",e}();t.Events=n});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-pdfcenterpanel-module/PDFCenterPanel",["require","exports","../uv-shared-module/BaseEvents","../uv-shared-module/CenterPanel","../../extensions/uv-pdf-extension/Events"],function(e,t,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(t){var n=e.call(this,t)||this;return n._maxScale=5,n._minScale=.7,n._nextButtonEnabled=!1,n._pageIndex=1,n._pageIndexPending=null,n._pageRendering=!1,n._pdfDoc=null,n._prevButtonEnabled=!1,n._scale=.7,n}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("pdfCenterPanel"),e.prototype.create.call(this),this._$pdfContainer=$('<div class="pdfContainer"></div>'),this._$canvas=$("<canvas></canvas>"),this._$spinner=$('<div class="spinner"></div>'),this._canvas=this._$canvas[0],this._ctx=this._canvas.getContext("2d"),this._$prevButton=$('<div class="btn prev" tabindex="0"></div>'),this._$nextButton=$('<div class="btn next" tabindex="0"></div>'),this._$zoomInButton=$('<div class="btn zoomIn" tabindex="0"></div>'),this._$zoomOutButton=$('<div class="btn zoomOut" tabindex="0"></div>'),Utils.Bools.getBool(this.extension.data.config.options.usePdfJs,!1)&&(this.$content.append(this._$spinner),this.$content.append(this._$prevButton),this.$content.append(this._$nextButton),this.$content.append(this._$zoomInButton),this.$content.append(this._$zoomOutButton)),this._$pdfContainer.append(this._$canvas),this.$content.prepend(this._$pdfContainer),this.component.subscribe(n.BaseEvents.OPEN_EXTERNAL_RESOURCE,function(e){t.openMedia(e)}),this.component.subscribe(n.BaseEvents.FIRST,function(){t._pdfDoc&&(t._pageIndex=1,t._queueRenderPage(t._pageIndex))}),this.component.subscribe(n.BaseEvents.PREV,function(){t._pdfDoc&&(t._pageIndex<=1||(t._pageIndex--,t._queueRenderPage(t._pageIndex)))}),this.component.subscribe(n.BaseEvents.NEXT,function(){t._pdfDoc&&(t._pageIndex>=t._pdfDoc.numPages||(t._pageIndex++,t._queueRenderPage(t._pageIndex)))}),this.component.subscribe(n.BaseEvents.LAST,function(){t._pdfDoc&&(t._pageIndex=t._pdfDoc.numPages,t._queueRenderPage(t._pageIndex))}),this.component.subscribe(n.BaseEvents.CANVAS_INDEX_CHANGED,function(){t._pdfDoc&&(t._pageIndex=1,t._queueRenderPage(t._pageIndex))}),this.component.subscribe(o.Events.SEARCH,function(e){t._pdfDoc&&(1>e||e>t._pdfDoc.numPages||(t._pageIndex=e,t._queueRenderPage(t._pageIndex)))}),this._$prevButton.onPressed(function(e){e.preventDefault(),t._prevButtonEnabled&&t.component.publish(n.BaseEvents.PREV)}),this.disablePrevButton(),this._$nextButton.onPressed(function(e){e.preventDefault(),t._nextButtonEnabled&&t.component.publish(n.BaseEvents.NEXT)}),this.disableNextButton(),this._$zoomInButton.onPressed(function(e){e.preventDefault();var n=t._scale+.5;n<t._maxScale?t._scale=n:t._scale=t._maxScale,t._render(t._pageIndex)}),this._$zoomOutButton.onPressed(function(e){e.preventDefault();var n=t._scale-.5;n>t._minScale?t._scale=n:t._scale=t._minScale,t._render(t._pageIndex)})},t.prototype.disablePrevButton=function(){this._prevButtonEnabled=!1,this._$prevButton.addClass("disabled")},t.prototype.enablePrevButton=function(){this._prevButtonEnabled=!0,this._$prevButton.removeClass("disabled")},t.prototype.hidePrevButton=function(){this.disablePrevButton(),this._$prevButton.hide()},t.prototype.showPrevButton=function(){this.enablePrevButton(),this._$prevButton.show()},t.prototype.disableNextButton=function(){this._nextButtonEnabled=!1,this._$nextButton.addClass("disabled")},t.prototype.enableNextButton=function(){this._nextButtonEnabled=!0,this._$nextButton.removeClass("disabled")},t.prototype.hideNextButton=function(){this.disableNextButton(),this._$nextButton.hide()},t.prototype.showNextButton=function(){this.enableNextButton(),this._$nextButton.show()},t.prototype.openMedia=function(e){var t=this;this._$spinner.show(),this.extension.getExternalResources(e).then(function(){var e=null,n=t.extension.helper.getCurrentCanvas(),i=t.extension.getMediaFormats(n),r=n.id;if(e=i&&i.length?i[0].id:n.id,Utils.Bools.getBool(t.extension.data.config.options.usePdfJs,!1)){PDFJS.disableWorker=!0;var s={url:e,withCredentials:n.externalResource.isAccessControlled()};PDFJS.getDocument(s).then(function(e){t._pdfDoc=e,t._render(t._pageIndex),t.component.publish(o.Events.PDF_LOADED,e),t._$spinner.hide()})}else window.PDFObject.embed(r,".pdfContainer",{id:"PDF"})})},t.prototype._render=function(e){var t=this;if(Utils.Bools.getBool(this.extension.data.config.options.usePdfJs,!1)){this._pageRendering=!0,this._$zoomOutButton.enable(),this._$zoomInButton.enable();var n=this._scale-.5,i=this._scale+.5;n<this._minScale&&this._$zoomOutButton.disable(),i>this._maxScale&&this._$zoomInButton.disable(),this._pdfDoc.getPage(e).then(function(e){t._renderTask&&t._renderTask.cancel(),t._viewport=e.getViewport(t._scale),t._canvas.height=t._viewport.height,t._canvas.width=t._viewport.width;var n=t._canvas.height/t.$content.height(),i=t._canvas.height/n*t._viewport.scale;i<t.$content.height()&&(i=t.$content.height()),t._$canvas.css({height:i});var r={canvasContext:t._ctx,viewport:t._viewport};t._renderTask=e.render(r),t._renderTask.promise.then(function(){t.component.publish(o.Events.PAGE_INDEX_CHANGED,t._pageIndex),t._pageRendering=!1,null!==t._pageIndexPending&&(t._render(t._pageIndexPending),t._pageIndexPending=null),1===t._pageIndex?t.disablePrevButton():t.enablePrevButton(),t._pageIndex===t._pdfDoc.numPages?t.disableNextButton():t.enableNextButton()})["catch"](function(e){})})}},t.prototype._queueRenderPage=function(e){this._pageRendering?this._pageIndexPending=e:this._render(e)},t.prototype.resize=function(){e.prototype.resize.call(this),this._$pdfContainer.width(this.$content.width()),this._$pdfContainer.height(this.$content.height()),this._$spinner.css("top",this.$content.height()/2-this._$spinner.height()/2),this._$spinner.css("left",this.$content.width()/2-this._$spinner.width()/2),this._$prevButton.css({top:(this.$content.height()-this._$prevButton.height())/2,left:this._$prevButton.horizontalMargins()}),this._$nextButton.css({top:(this.$content.height()-this._$nextButton.height())/2,left:this.$content.width()-(this._$nextButton.width()+this._$nextButton.horizontalMargins())}),this._viewport&&this._render(this._pageIndex)},t}(i.CenterPanel);t.PDFCenterPanel=r});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-pdfheaderpanel-module/PDFHeaderPanel",["require","exports","../uv-shared-module/BaseEvents","../../extensions/uv-pdf-extension/Events","../uv-shared-module/HeaderPanel"],function(e,t,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(t){var n=e.call(this,t)||this;return n.firstButtonEnabled=!1,n.lastButtonEnabled=!1,n.nextButtonEnabled=!1,n.prevButtonEnabled=!1,n._pageIndex=0,n._pdfDoc=null,n}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("pdfHeaderPanel"),e.prototype.create.call(this),this.component.subscribe(i.Events.PAGE_INDEX_CHANGED,function(e){t._pageIndex=e,t.render()}),this.component.subscribe(i.Events.PDF_LOADED,function(e){t._pdfDoc=e}),this.$prevOptions=$('<div class="prevOptions"></div>'),this.$centerOptions.append(this.$prevOptions),this.$firstButton=$('\n          <button class="btn imageBtn first" tabindex="0" title="'+this.content.first+'">\n            <i class="uv-icon-first" aria-hidden="true"></i>'+this.content.first+"\n          </button>\n        "),this.$prevOptions.append(this.$firstButton),this.$firstButton.disable(),this.$prevButton=$('\n          <button class="btn imageBtn prev" tabindex="0" title="'+this.content.previous+'">\n            <i class="uv-icon-prev" aria-hidden="true"></i>'+this.content.previous+"\n          </button>\n        "),this.$prevOptions.append(this.$prevButton),this.$prevButton.disable(),this.$search=$('<div class="search"></div>'),this.$centerOptions.append(this.$search),this.$searchText=$('<input class="searchText" maxlength="50" type="text" tabindex="0" aria-label="'+this.content.pageSearchLabel+'"/>'),this.$search.append(this.$searchText),this.$total=$('<span class="total"></span>'),this.$search.append(this.$total),this.$searchButton=$('<a class="go btn btn-primary" tabindex="0">'+this.content.go+"</a>"),this.$search.append(this.$searchButton),this.$searchButton.disable(),this.$nextOptions=$('<div class="nextOptions"></div>'),this.$centerOptions.append(this.$nextOptions),this.$nextButton=$('\n          <button class="btn imageBtn next" tabindex="0" title="'+this.content.next+'">\n            <i class="uv-icon-next" aria-hidden="true"></i>'+this.content.next+"\n          </button>\n        "),this.$nextOptions.append(this.$nextButton),this.$nextButton.disable(),this.$lastButton=$('\n          <button class="btn imageBtn last" tabindex="0" title="'+this.content.last+'">\n            <i class="uv-icon-last" aria-hidden="true"></i>'+this.content.last+"\n          </button>\n        "),this.$nextOptions.append(this.$lastButton),this.$lastButton.disable(),this.$firstButton.onPressed(function(){t.component.publish(n.BaseEvents.FIRST)}),this.$prevButton.onPressed(function(){t.component.publish(n.BaseEvents.PREV)}),this.$nextButton.onPressed(function(){t.component.publish(n.BaseEvents.NEXT)}),this.$lastButton.onPressed(function(){t.component.publish(n.BaseEvents.LAST)}),this.$searchText.onEnter(function(){t.$searchText.blur(),t.search(t.$searchText.val())}),this.$searchText.click(function(){$(this).select()}),this.$searchButton.onPressed(function(){t.search(t.$searchText.val())})},t.prototype.render=function(){1===this._pdfDoc.numPages?this.$centerOptions.hide():this.$centerOptions.show(),this.$searchText.val(this._pageIndex);var e=this.content.of;this.$total.html(Utils.Strings.format(e,this._pdfDoc.numPages.toString())),this.$searchButton.enable(),1===this._pageIndex?(this.$firstButton.disable(),this.$prevButton.disable()):(this.$firstButton.enable(),this.$prevButton.enable()),this._pageIndex===this._pdfDoc.numPages?(this.$lastButton.disable(),this.$nextButton.disable()):(this.$lastButton.enable(),this.$nextButton.enable())},t.prototype.search=function(e){if(!e)return void this.extension.showMessage(this.content.emptyValue);var t=parseInt(this.$searchText.val(),10);return isNaN(t)?void this.extension.showMessage(this.extension.data.config.modules.genericDialogue.content.invalidNumber):void this.component.publish(i.Events.SEARCH,t)},t.prototype.resize=function(){e.prototype.resize.call(this)},t}(o.HeaderPanel);t.PDFHeaderPanel=r});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("extensions/uv-pdf-extension/SettingsDialogue",["require","exports","../../modules/uv-dialogues-module/SettingsDialogue"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){this.setConfig("settingsDialogue"),e.prototype.create.call(this)},t}(n.SettingsDialogue);t.SettingsDialogue=i});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("extensions/uv-pdf-extension/ShareDialogue",["require","exports","../../modules/uv-dialogues-module/ShareDialogue"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){this.setConfig("shareDialogue"),e.prototype.create.call(this)},t.prototype.update=function(){e.prototype.update.call(this),this.code=this.extension.getEmbedScript(this.options.embedTemplate,this.currentWidth,this.currentHeight),this.$code.val(this.code)},t.prototype.resize=function(){e.prototype.resize.call(this)},t}(n.ShareDialogue);t.ShareDialogue=i});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("extensions/uv-pdf-extension/Extension",["require","exports","@iiif/vocabulary","manifesto.js","../../modules/uv-shared-module/BaseEvents","../../modules/uv-shared-module/BaseExtension","../../modules/uv-shared-module/Bookmark","./DownloadDialogue","../../modules/uv-shared-module/FooterPanel","../../modules/uv-moreinforightpanel-module/MoreInfoRightPanel","../../modules/uv-pdfcenterpanel-module/PDFCenterPanel","../../modules/uv-pdfheaderpanel-module/PDFHeaderPanel","../../modules/uv-resourcesleftpanel-module/ResourcesLeftPanel","./SettingsDialogue","./ShareDialogue"],function(e,t,n,i,o,r,s,a,u,l,c,h,p,d,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.create=function(){var t=this;requirejs.config({paths:{"pdfjs-dist/build/pdf.combined":this.data.root+"/lib/pdf.combined"}}),e.prototype.create.call(this),this.component.subscribe(o.BaseEvents.CANVAS_INDEX_CHANGED,function(e){t.viewCanvas(e)}),this.component.subscribe(o.BaseEvents.THUMB_SELECTED,function(e){t.component.publish(o.BaseEvents.CANVAS_INDEX_CHANGED,e.index)}),this.component.subscribe(o.BaseEvents.LEFTPANEL_EXPAND_FULL_START,function(){t.shell.$centerPanel.hide(),t.shell.$rightPanel.hide()}),this.component.subscribe(o.BaseEvents.LEFTPANEL_COLLAPSE_FULL_FINISH,function(){t.shell.$centerPanel.show(),t.shell.$rightPanel.show(),t.resize()}),this.component.subscribe(o.BaseEvents.SHOW_OVERLAY,function(){t.IsOldIE()&&t.centerPanel.$element.hide()}),this.component.subscribe(o.BaseEvents.HIDE_OVERLAY,function(){t.IsOldIE()&&t.centerPanel.$element.show()}),this.component.subscribe(o.BaseEvents.EXIT_FULLSCREEN,function(){setTimeout(function(){t.resize()},10)})},t.prototype.render=function(){e.prototype.render.call(this)},t.prototype.IsOldIE=function(){var e=window.browserDetect.browser,t=window.browserDetect.version;return"Explorer"===e&&9>=t?!0:!1},t.prototype.isHeaderPanelEnabled=function(){return e.prototype.isHeaderPanelEnabled.call(this)&&Utils.Bools.getBool(this.data.config.options.usePdfJs,!0)},t.prototype.createModules=function(){e.prototype.createModules.call(this),this.isHeaderPanelEnabled()?this.headerPanel=new h.PDFHeaderPanel(this.shell.$headerPanel):this.shell.$headerPanel.hide(),this.isLeftPanelEnabled()&&(this.leftPanel=new p.ResourcesLeftPanel(this.shell.$leftPanel)),this.centerPanel=new c.PDFCenterPanel(this.shell.$centerPanel),this.isRightPanelEnabled()&&(this.rightPanel=new l.MoreInfoRightPanel(this.shell.$rightPanel)),this.isFooterPanelEnabled()?this.footerPanel=new u.FooterPanel(this.shell.$footerPanel):this.shell.$footerPanel.hide(),this.$downloadDialogue=$('<div class="overlay download" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$downloadDialogue),this.downloadDialogue=new a.DownloadDialogue(this.$downloadDialogue),this.$shareDialogue=$('<div class="overlay share" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$shareDialogue),this.shareDialogue=new f.ShareDialogue(this.$shareDialogue),this.$settingsDialogue=$('<div class="overlay settings" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$settingsDialogue),this.settingsDialogue=new d.SettingsDialogue(this.$settingsDialogue),this.isLeftPanelEnabled()&&this.leftPanel.init(),this.isRightPanelEnabled()&&this.rightPanel.init()},t.prototype.isLeftPanelEnabled=function(){return Utils.Bools.getBool(this.data.config.options.leftPanelEnabled,!0)&&(this.helper.isMultiCanvas()||this.helper.isMultiSequence()||this.helper.hasResources())},t.prototype.bookmark=function(){e.prototype.bookmark.call(this);var t=this.helper.getCurrentCanvas(),r=new s.Bookmark;r.index=this.helper.canvasIndex,r.label=i.LanguageMap.getValue(t.getLabel()),r.thumb=t.getProperty("thumbnail"),r.title=this.helper.getLabel(),r.trackingLabel=window.trackingLabel,r.type=n.ExternalResourceType.DOCUMENT.toString(),this.fire(o.BaseEvents.BOOKMARK,r)},t.prototype.dependencyLoaded=function(e,t){0===e&&(window.PDFObject=t)},t.prototype.getEmbedScript=function(e,t,n){var i=this.getAppUri(),o=i+"#?manifest="+this.helper.manifestUri+"&c="+this.helper.collectionIndex+"&m="+this.helper.manifestIndex+"&s="+this.helper.sequenceIndex+"&cv="+this.helper.canvasIndex,r=Utils.Strings.format(e,o,t.toString(),n.toString());return r},t}(r.BaseExtension);t.Extension=g});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("extensions/uv-virtex-extension/DownloadDialogue",["require","exports","../../modules/uv-dialogues-module/DownloadDialogue"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){this.setConfig("downloadDialogue"),e.prototype.create.call(this)},t.prototype.open=function(t){e.prototype.open.call(this,t),this.addEntireFileDownloadOptions(),this.updateNoneAvailable(),this.resize()},t.prototype.isDownloadOptionAvailable=function(t){return e.prototype.isDownloadOptionAvailable.call(this,t)},t}(n.DownloadDialogue);t.DownloadDialogue=i});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("extensions/uv-virtex-extension/SettingsDialogue",["require","exports","../../modules/uv-dialogues-module/SettingsDialogue"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){this.setConfig("settingsDialogue"),e.prototype.create.call(this)},t}(n.SettingsDialogue);t.SettingsDialogue=i});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("extensions/uv-virtex-extension/ShareDialogue",["require","exports","../../modules/uv-dialogues-module/ShareDialogue"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){this.setConfig("shareDialogue"),e.prototype.create.call(this)},t.prototype.update=function(){e.prototype.update.call(this),this.code=this.extension.getEmbedScript(this.options.embedTemplate,this.currentWidth,this.currentHeight),this.$code.val(this.code)},t.prototype.resize=function(){e.prototype.resize.call(this)},t}(n.ShareDialogue);t.ShareDialogue=i});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("modules/uv-virtexcenterpanel-module/VirtexCenterPanel",["require","exports","../uv-shared-module/BaseEvents","../uv-shared-module/CenterPanel","../../Utils"],function(e,t,n,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.create=function(){var t=this;this.setConfig("virtexCenterPanel"),e.prototype.create.call(this);var i=this;this.component.subscribe(n.BaseEvents.OPEN_EXTERNAL_RESOURCE,function(e){i.openMedia(e)}),this.$navigation=$('<div class="navigation"></div>'),this.$content.prepend(this.$navigation),this.$zoomInButton=$('\n          <button class="btn imageBtn zoomIn" title="'+this.content.zoomIn+'">\n            <i class="uv-icon-zoom-in" aria-hidden="true"></i>'+this.content.zoomIn+"\n          </button>\n        "),this.$navigation.append(this.$zoomInButton),this.$zoomOutButton=$('\n          <button class="btn imageBtn zoomOut" title="'+this.content.zoomOut+'">\n            <i class="uv-icon-zoom-out" aria-hidden="true"></i>'+this.content.zoomOut+"\n          </button>\n        "),this.$navigation.append(this.$zoomOutButton),this.$vrButton=$('\n          <button class="btn imageBtn vr" title="'+this.content.vr+'">\n            <i class="uv-icon-vr" aria-hidden="true"></i>'+this.content.vr+"\n          </button>\n        "),this.$navigation.append(this.$vrButton),this.$viewport=$('<div class="virtex"></div>'),this.$content.prepend(this.$viewport),this.title=this.extension.helper.getLabel(),this.$zoomInButton.on("click",function(e){e.preventDefault(),t.viewport&&t.viewport.zoomIn()}),this.$zoomOutButton.on("click",function(e){e.preventDefault(),t.viewport&&t.viewport.zoomOut()}),this.$vrButton.on("click",function(e){e.preventDefault(),t.viewport&&t.viewport.toggleVR()}),this._isVREnabled()||this.$vrButton.hide()},t.prototype.openMedia=function(e){var t=this;this.extension.getExternalResources(e).then(function(){t.$viewport.empty();var e=null,n=t.extension.helper.getCurrentCanvas(),i=t.extension.getMediaFormats(n),o=null,r=new Virtex.FileType("application/vnd.threejs+json");i&&i.length?(e=i[0].id,o=i[0].getFormat()):e=n.id,o&&(r=new Virtex.FileType(o.toString()));var s=navigator.userAgent.toLowerCase().indexOf("android")>-1;t.viewport=new Virtex.Viewport({target:t.$viewport[0],data:{antialias:!s,file:e,fullscreenEnabled:!1,type:r,showStats:t.options.showStats}}),t.viewport&&(t.viewport.on("vravailable",function(){t.$vrButton.show()},!1),t.viewport.on("vrunavailable",function(){t.$vrButton.hide()},!1)),t.resize()})},t.prototype._isVREnabled=function(){return Utils.Bools.getBool(this.config.options.vrEnabled,!1)&&WEBVR.isAvailable()},t.prototype.resize=function(){e.prototype.resize.call(this),this.title&&this.$title.text(o.UVUtils.sanitize(this.title)),this.$viewport.width(this.$content.width()),this.$viewport.height(this.$content.height()),this.viewport&&this.viewport.resize()},t}(i.CenterPanel);t.VirtexCenterPanel=r});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("extensions/uv-virtex-extension/Extension",["require","exports","manifesto.js","@iiif/vocabulary","../../modules/uv-shared-module/BaseEvents","../../modules/uv-shared-module/BaseExtension","../../modules/uv-shared-module/Bookmark","../../modules/uv-contentleftpanel-module/ContentLeftPanel","./DownloadDialogue","../../modules/uv-shared-module/FooterPanel","../../modules/uv-shared-module/HeaderPanel","../../modules/uv-moreinforightpanel-module/MoreInfoRightPanel","./SettingsDialogue","./ShareDialogue","../../modules/uv-virtexcenterpanel-module/VirtexCenterPanel"],function(e,t,n,i,o,r,s,a,u,l,c,h,p,d,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.create=function(){var t=this;e.prototype.create.call(this),this.component.subscribe(o.BaseEvents.CANVAS_INDEX_CHANGED,function(e){t.viewCanvas(e)}),this.component.subscribe(o.BaseEvents.THUMB_SELECTED,function(e){t.component.publish(o.BaseEvents.CANVAS_INDEX_CHANGED,e)})},t.prototype.createModules=function(){e.prototype.createModules.call(this),this.isHeaderPanelEnabled()?this.headerPanel=new c.HeaderPanel(this.shell.$headerPanel):this.shell.$headerPanel.hide(),this.isLeftPanelEnabled()&&(this.leftPanel=new a.ContentLeftPanel(this.shell.$leftPanel)),this.centerPanel=new f.VirtexCenterPanel(this.shell.$centerPanel),this.isRightPanelEnabled()&&(this.rightPanel=new h.MoreInfoRightPanel(this.shell.$rightPanel)),this.isFooterPanelEnabled()?this.footerPanel=new l.FooterPanel(this.shell.$footerPanel):this.shell.$footerPanel.hide(),this.$downloadDialogue=$('<div class="overlay download" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$downloadDialogue),this.downloadDialogue=new u.DownloadDialogue(this.$downloadDialogue),this.$shareDialogue=$('<div class="overlay share" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$shareDialogue),this.shareDialogue=new d.ShareDialogue(this.$shareDialogue),this.$settingsDialogue=$('<div class="overlay settings" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$settingsDialogue),this.settingsDialogue=new p.SettingsDialogue(this.$settingsDialogue),this.isLeftPanelEnabled()?this.leftPanel.init():this.shell.$leftPanel.hide(),this.isRightPanelEnabled()?this.rightPanel.init():this.shell.$rightPanel.hide()},t.prototype.render=function(){e.prototype.render.call(this)},t.prototype.dependencyLoaded=function(e,t){0===e&&(window.THREE=t)},t.prototype.isLeftPanelEnabled=function(){return Utils.Bools.getBool(this.data.config.options.leftPanelEnabled,!0)&&(this.helper.isMultiCanvas()||this.helper.isMultiSequence())},t.prototype.bookmark=function(){e.prototype.bookmark.call(this);var t=this.helper.getCurrentCanvas(),r=new s.Bookmark;r.index=this.helper.canvasIndex,r.label=n.LanguageMap.getValue(t.getLabel()),r.thumb=t.getProperty("thumbnail"),r.title=this.helper.getLabel(),r.trackingLabel=window.trackingLabel,r.type=i.ExternalResourceType.PHYSICAL_OBJECT.toString(),this.fire(o.BaseEvents.BOOKMARK,r)},t.prototype.getEmbedScript=function(e,t,n){var i=this.getAppUri(),o=i+"#?manifest="+this.helper.manifestUri+"&c="+this.helper.collectionIndex+"&m="+this.helper.manifestIndex+"&s="+this.helper.sequenceIndex+"&cv="+this.helper.canvasIndex;return Utils.Strings.format(e,o,t.toString(),n.toString())},t}(r.BaseExtension);t.Extension=g}),define("PubSub",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.events={}}return e.prototype.publish=function(e,t){var n=this,i=this.events[e];void 0!==i&&i.forEach(function(e){e.call(n,t)})},e.prototype.subscribe=function(e,t){var n=this.events[e];void 0===n&&(n=this.events[e]=[]),n.push(t)},e.prototype.unsubscribe=function(e,t){var n=this.events[e];if(void 0!==n){var i=n.indexOf(t);n.splice(i)}},e.prototype.dispose=function(){this.events={}},e}();t.PubSub=n}),Element.prototype.scrollIntoViewIfNeeded||(Element.prototype.scrollIntoViewIfNeeded=function(e){e=0===arguments.length?!0:!!e;var t=this.parentNode,n=window.getComputedStyle(t,void 0),i=parseInt(n.getPropertyValue("border-top-width")),o=parseInt(n.getPropertyValue("border-left-width")),r=this.offsetTop-t.offsetTop<t.scrollTop,s=this.offsetTop-t.offsetTop+this.clientHeight-i>t.scrollTop+t.clientHeight,a=this.offsetLeft-t.offsetLeft<t.scrollLeft,u=this.offsetLeft-t.offsetLeft+this.clientWidth-o>t.scrollLeft+t.clientWidth,l=r&&!s;(r||s)&&e&&(t.scrollTop=this.offsetTop-t.offsetTop-t.clientHeight/2-i+this.clientHeight/2),(a||u)&&e&&(t.scrollLeft=this.offsetLeft-t.offsetLeft-t.clientWidth/2-o+this.clientWidth/2),(r||s||a||u)&&!e&&this.scrollIntoView(l)}),define("Polyfills",function(){});var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();define("UVComponent",["require","exports","@iiif/manifold","@iiif/vocabulary","./modules/uv-shared-module/BaseEvents","./extensions/uv-av-extension/Extension","./extensions/uv-default-extension/Extension","./extensions/uv-ebook-extension/Extension","./extensions/uv-mediaelement-extension/Extension","./extensions/uv-seadragon-extension/Extension","./extensions/uv-pdf-extension/Extension","./extensions/uv-virtex-extension/Extension","./Utils","./PubSub","./Polyfills"],function(e,t,n,i,o,r,s,a,u,l,c,h,p,d){
"use strict";Object.defineProperty(t,"__esModule",{value:!0});var f=function(e){function t(t){var n=e.call(this,t)||this;return n.isFullScreen=!1,n._pubsub=new d.PubSub,n._init(),n._resize(),n}return __extends(t,e),t.prototype._init=function(){var t=e.prototype._init.call(this);return t||console.error("UV failed to initialise"),this._extensions={},this._extensions[i.IIIFResourceType.CANVAS.toString()]={type:l.Extension,name:"uv-seadragon-extension"},this._extensions[i.ExternalResourceType.IMAGE.toString()]={type:l.Extension,name:"uv-seadragon-extension"},this._extensions[i.ExternalResourceType.MOVING_IMAGE.toString()]={type:u.Extension,name:"uv-mediaelement-extension"},this._extensions[i.ExternalResourceType.PHYSICAL_OBJECT.toString()]={type:h.Extension,name:"uv-virtex-extension"},this._extensions.Model={type:h.Extension,name:"uv-virtex-extension"},this._extensions[i.ExternalResourceType.SOUND.toString()]={type:u.Extension,name:"uv-mediaelement-extension"},this._extensions[i.RenderingFormat.PDF.toString()]={type:c.Extension,name:"uv-pdf-extension"},this._extensions[i.MediaType.JPG.toString()]={type:l.Extension,name:"uv-seadragon-extension"},this._extensions[i.MediaType.PDF.toString()]={type:c.Extension,name:"uv-pdf-extension"},this._extensions[i.MediaType.VIDEO_MP4.toString()]={type:r.Extension,name:"uv-av-extension"},this._extensions[i.MediaType.WEBM.toString()]={type:r.Extension,name:"uv-av-extension"},this._extensions[i.MediaType.THREEJS.toString()]={type:h.Extension,name:"uv-virtex-extension"},this._extensions["model/gltf+json"]={type:h.Extension,name:"uv-virtex-extension"},this._extensions["model/gltf+json"]={type:h.Extension,name:"uv-virtex-extension"},this._extensions["model/gltf-binary"]={type:h.Extension,name:"uv-virtex-extension"},this._extensions.av={type:r.Extension,name:"uv-av-extension"},this._extensions.video={type:r.Extension,name:"uv-av-extension"},this._extensions["audio/mp3"]={type:r.Extension,name:"uv-av-extension"},this._extensions["audio/mp4"]={type:r.Extension,name:"uv-av-extension"},this._extensions["application/vnd.apple.mpegurl"]={type:r.Extension,name:"uv-av-extension"},this._extensions["application/dash+xml"]={type:r.Extension,name:"uv-av-extension"},this._extensions["application/epub+zip"]={type:a.Extension,name:"uv-ebook-extension"},this._extensions["application/oebps-package+xml"]={type:a.Extension,name:"uv-ebook-extension"},this._extensions["default"]={type:s.Extension,name:"uv-default-extension"},this.set(this.options.data),t},t.prototype.data=function(){return{annotations:void 0,root:"./uv",canvasIndex:0,collectionIndex:void 0,config:void 0,configUri:void 0,embedded:!1,iiifResourceUri:"",isLightbox:!1,isReload:!1,limitLocales:!1,locales:[{name:"en-GB"}],manifestIndex:0,rangeId:void 0,rotation:0,sequenceIndex:0,xywh:""}},t.prototype.set=function(e){if(this.extension)p.UVUtils.propertiesChanged(e,this.extension.data,["collectionIndex","manifestIndex","config","configUri","domain","embedDomain","embedScriptUri","iiifResourceUri","isHomeDomain","isLightbox","isOnlyInstance","isReload","locales","root"])?(this.extension.data=Object.assign({},this.extension.data,e),this._reload(this.extension.data)):(this.extension.data=Object.assign({},this.extension.data,e),this.extension.render());else{if(!e.iiifResourceUri)return void this._error("iiifResourceUri is required.");e.root&&e.root.endsWith("/")&&(e.root=e.root.substring(0,e.root.length-1)),this._reload(e)}},t.prototype.get=function(e){return this.extension?this.extension.data[e]:void 0},t.prototype.publish=function(e,t){this._pubsub.publish(e,t)},t.prototype.subscribe=function(e,t){this._pubsub.subscribe(e,t)},t.prototype._reload=function(e){var t=this;this._pubsub.dispose(),this.subscribe(o.BaseEvents.RELOAD,function(e){t.fire(o.BaseEvents.RELOAD,e)});var i=$(this.options.target);i.empty(),i.addClass("loading"),jQuery.support.cors=!0;var r=this;n.loadManifest({manifestUri:e.iiifResourceUri,collectionIndex:e.collectionIndex,manifestIndex:e.manifestIndex||0,sequenceIndex:e.sequenceIndex||0,canvasIndex:e.canvasIndex||0,rangeId:e.rangeId,locale:e.locales?e.locales[0].name:void 0}).then(function(t){var n=t.getTrackingLabel();n&&(n+=document.referrer,window.trackingLabel=n);var i;if(void 0!==e.sequenceIndex&&(i=t.getSequenceByIndex(e.sequenceIndex),!i))return void r._error("Sequence "+e.sequenceIndex+" not found.");var o;if(void 0!==e.canvasIndex&&(o=t.getCanvasByIndex(e.canvasIndex)),!o)return void r._error("Canvas "+e.canvasIndex+" not found.");var s=void 0,a=o.getContent();if(a.length){var u=a[0],l=u.getBody();if(l&&l.length){var c=l[0].getFormat();if(c){if(s=r._extensions[c.toString()],!s){var h=l[0].getType();h&&(s=r._extensions[h.toString()])}}else{var h=l[0].getType();h&&(s=r._extensions[h.toString()])}}}else{var p=o.getType();if(p&&(s=r._extensions[p.toString()]),!s){var c=o.getProperty("format");s=r._extensions[c]}}var d=t.getRanges().length>0;"uv-av-extension"!==s.name||d||(s=r._getExtensionByName("uv-mediaelement-extension")),s||(s=r._extensions["default"]),r._configure(e,s,function(n){e.config=n,r._injectCss(e,s,function(){r._createExtension(s,e,t)})})})["catch"](function(){r._error("Failed to load manifest.")})},t.prototype._getExtensionByName=function(e){for(var t=Object.keys(this._extensions),n=0;n<t.length;n++){var i=this._extensions[t[n]];if(i.name===e)return i}},t.prototype._isCORSEnabled=function(){return Modernizr.cors},t.prototype._error=function(e){this.fire(o.BaseEvents.ERROR,e)},t.prototype._configure=function(e,t,n){var i=this;this._getConfigExtension(e,t,function(o){if(e.locales){var r=e.root+"/lib/"+t.name+"."+e.locales[0].name+".config.json";$.getJSON(r,function(r){i._extendConfig(e,t,r,o,n)})}})},t.prototype._extendConfig=function(e,t,n,i,o){n.name=t.name,i&&(n.uri=e.configUri,$.extend(!0,n,i)),o(n)},t.prototype._getConfigExtension=function(e,t,n){if(e.locales){var i=sessionStorage.getItem(t.name+"."+e.locales[0].name),o=e.configUri;if(i)n(JSON.parse(i));else if(o)if(this._isCORSEnabled())$.getJSON(o,function(e){n(e)});else{var r={url:o,type:"GET",dataType:"jsonp",jsonp:"callback",jsonpCallback:"configExtensionCallback"};$.ajax(r),window.configExtensionCallback=function(e){n(e)}}else n(null)}},t.prototype._injectCss=function(e,t,n){if(e.locales){var i=e.root+"/themes/"+e.config.options.theme+"/css/"+t.name+"/theme.css",o=e.locales[0].name,r=t.name.toLowerCase()+"-theme-"+o.toLowerCase(),s=$("#"+r.toLowerCase());s.length?n():($("head").append('<link rel="stylesheet" id="'+r+'" href="'+i.toLowerCase()+'" />'),n())}},t.prototype._createExtension=function(e,t,n){this.extension=new e.type,this.extension&&(this.extension.component=this,this.extension.data=t,this.extension.helper=n,this.extension.name=e.name,this.extension.create())},t.prototype.exitFullScreen=function(){this.extension&&this.extension.exitFullScreen()},t.prototype.resize=function(){this.extension&&this.extension.resize()},t}(_Components.BaseComponent);t["default"]=f}),"function"==typeof jQuery&&define("jquery",[],function(){return jQuery}),function(){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}return"function"==typeof window.CustomEvent?!1:(e.prototype=window.Event.prototype,void(window.CustomEvent=e))}(),define("@iiif/manifold",["require","../lib/manifold.js","manifold"],function(e,t){var n=e("manifold");return window.Manifold=n,n}),define("manifesto.js",["require","./lib/manifesto.js","manifesto"],function(e,t){var n=e("manifesto");return window.Manifesto=n,window.manifesto=n,n}),define("@iiif/vocabulary",["require","../lib/vocabulary.js","vocabulary"],function(e,t){return e("vocabulary")}),define("@iiif/iiif-metadata-component",["require","../lib/IIIFMetadataComponent.js","IIIFMetadataComponent"],function(e,t){return e("IIIFMetadataComponent")}),define("@iiif/iiif-gallery-component",["require","../lib/GalleryComponent.js"],function(e,t){return t}),define("@iiif/iiif-av-component",["require","../lib/IIIFAVComponent.js","IIIFAVComponent"],function(e,t){return e("IIIFAVComponent")}),requirejs(["./lib/base64.min.js","./lib/browserdetect.js","./lib/detectmobilebrowser.js","./lib/jquery.xdomainrequest.js","./lib/modernizr.js","./lib/ex.es3.min.js","./lib/BaseComponent.js","./lib/KeyCodes.js","./lib/HTTPStatusCode.js","./lib/jquery-plugins.js","./lib/ba-tiny-pubsub.js","manifesto.js","@iiif/manifold","./lib/Utils.js","./lib/xss.min.js","./lib/fetch.umd.js","URLDataProvider","UVComponent","@iiif/iiif-metadata-component","@iiif/iiif-gallery-component","@iiif/vocabulary","@iiif/iiif-av-component"],function(e,t,n,i,o,r,s,a,u,l,c,h,p,d,f,g,v,_){window.UV=_["default"],window.UV.URLDataProvider=v["default"],window.dispatchEvent(new CustomEvent("uvLoaded",{}))}),define("app",function(){});