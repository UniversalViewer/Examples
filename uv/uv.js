/** vim: et:ts=4:sw=4:sts=4
 * @license RequireJS 2.2.0 Copyright jQuery Foundation and other contributors.
 * Released under MIT license, http://github.com/requirejs/requirejs/LICENSE
 */
var requirejs,require,define;(function(global){var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.2.0",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;function commentReplace(match,multi,multiText,singlePrefix){return singlePrefix||""}function isFunction(it){return"[object Function]"===ostring.call(it)}function isArray(it){return"[object Array]"===ostring.call(it)}function each(ary,func){var i;if(ary)for(i=0;i<ary.length&&(!ary[i]||!func(ary[i],i,ary));i+=1);}function eachReverse(ary,func){var i;if(ary)for(i=ary.length-1;i>-1&&(!ary[i]||!func(ary[i],i,ary));i-=1);}function hasProp(obj,prop){return hasOwn.call(obj,prop)}function getOwn(obj,prop){return hasProp(obj,prop)&&obj[prop]}function eachProp(obj,func){var prop;for(prop in obj)if(hasProp(obj,prop)&&func(obj[prop],prop))break}function mixin(target,source,force,deepStringMixin){return source&&eachProp(source,(function(value,prop){!force&&hasProp(target,prop)||(!deepStringMixin||"object"!=typeof value||!value||isArray(value)||isFunction(value)||value instanceof RegExp?target[prop]=value:(target[prop]||(target[prop]={}),mixin(target[prop],value,force,deepStringMixin)))})),target}function bind(obj,fn){return function(){return fn.apply(obj,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(err){throw err}function getGlobal(value){if(!value)return value;var g=global;return each(value.split("."),(function(part){g=g[part]})),g}function makeError(id,msg,err,requireModules){var e=new Error(msg+"\nhttp://requirejs.org/docs/errors.html#"+id);return e.requireType=id,e.requireModules=requireModules,err&&(e.originalError=err),e}if(void 0===define){if(void 0!==requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}void 0===require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(deps,callback,errback,optional){var context,config,contextName=defContextName;return isArray(deps)||"string"==typeof deps||(config=deps,isArray(callback)?(deps=callback,callback=errback,errback=optional):deps=[]),config&&config.context&&(contextName=config.context),(context=getOwn(contexts,contextName))||(context=contexts[contextName]=req.s.newContext(contextName)),config&&context.configure(config),context.require(deps,callback,errback)},req.config=function(config){return req(config)},req.nextTick="undefined"!=typeof setTimeout?function(fn){setTimeout(fn,4)}:function(fn){fn()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],(function(prop){req[prop]=function(){var ctx=contexts[defContextName];return ctx.require[prop].apply(ctx,arguments)}})),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(config,moduleName,url){var node=config.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return node.type=config.scriptType||"text/javascript",node.charset="utf-8",node.async=!0,node},req.load=function(context,moduleName,url){var node,config=context&&context.config||{};if(isBrowser)return(node=req.createNode(config,moduleName,url)).setAttribute("data-requirecontext",context.contextName),node.setAttribute("data-requiremodule",moduleName),!node.attachEvent||node.attachEvent.toString&&node.attachEvent.toString().indexOf("[native code")<0||isOpera?(node.addEventListener("load",context.onScriptLoad,!1),node.addEventListener("error",context.onScriptError,!1)):(useInteractive=!0,node.attachEvent("onreadystatechange",context.onScriptLoad)),node.src=url,config.onNodeCreated&&config.onNodeCreated(node,config,moduleName,url),currentlyAddingScript=node,baseElement?head.insertBefore(node,baseElement):head.appendChild(node),currentlyAddingScript=null,node;if(isWebWorker)try{setTimeout((function(){}),0),importScripts(url),context.completeLoad(moduleName)}catch(e){context.onError(makeError("importscripts","importScripts failed for "+moduleName+" at "+url,e,[moduleName]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),(function(script){if(head||(head=script.parentNode),dataMain=script.getAttribute("data-main"))return mainScript=dataMain,cfg.baseUrl||-1!==mainScript.indexOf("!")||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0})),define=function(name,deps,callback){var node,context;"string"!=typeof name&&(callback=deps,deps=name,name=null),isArray(deps)||(callback=deps,deps=null),!deps&&isFunction(callback)&&(deps=[],callback.length&&(callback.toString().replace(commentRegExp,commentReplace).replace(cjsRequireRegExp,(function(match,dep){deps.push(dep)})),deps=(1===callback.length?["require"]:["require","exports","module"]).concat(deps))),useInteractive&&(node=currentlyAddingScript||getInteractiveScript())&&(name||(name=node.getAttribute("data-requiremodule")),context=contexts[node.getAttribute("data-requirecontext")]),context?(context.defQueue.push([name,deps,callback]),context.defQueueMap[name]=!0):globalDefQueue.push([name,deps,callback])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}function newContext(contextName){var inCheckLoaded,Module,context,handlers,checkLoadedTimeoutId,config={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},registry={},enabledRegistry={},undefEvents={},defQueue=[],defined={},urlFetched={},bundlesMap={},requireCounter=1,unnormalizedCounter=1;function normalize(name,baseName,applyMap){var mapValue,nameParts,i,j,nameSegment,lastIndex,foundMap,foundI,foundStarMap,starI,baseParts=baseName&&baseName.split("/"),map=config.map,starMap=map&&map["*"];if(name&&(lastIndex=(name=name.split("/")).length-1,config.nodeIdCompat&&jsSuffixRegExp.test(name[lastIndex])&&(name[lastIndex]=name[lastIndex].replace(jsSuffixRegExp,"")),"."===name[0].charAt(0)&&baseParts&&(name=baseParts.slice(0,baseParts.length-1).concat(name)),function(ary){var i,part;for(i=0;i<ary.length;i++)if("."===(part=ary[i]))ary.splice(i,1),i-=1;else if(".."===part){if(0===i||1===i&&".."===ary[2]||".."===ary[i-1])continue;i>0&&(ary.splice(i-1,2),i-=2)}}(name),name=name.join("/")),applyMap&&map&&(baseParts||starMap)){outerLoop:for(i=(nameParts=name.split("/")).length;i>0;i-=1){if(nameSegment=nameParts.slice(0,i).join("/"),baseParts)for(j=baseParts.length;j>0;j-=1)if((mapValue=getOwn(map,baseParts.slice(0,j).join("/")))&&(mapValue=getOwn(mapValue,nameSegment))){foundMap=mapValue,foundI=i;break outerLoop}!foundStarMap&&starMap&&getOwn(starMap,nameSegment)&&(foundStarMap=getOwn(starMap,nameSegment),starI=i)}!foundMap&&foundStarMap&&(foundMap=foundStarMap,foundI=starI),foundMap&&(nameParts.splice(0,foundI,foundMap),name=nameParts.join("/"))}return getOwn(config.pkgs,name)||name}function removeScript(name){isBrowser&&each(scripts(),(function(scriptNode){if(scriptNode.getAttribute("data-requiremodule")===name&&scriptNode.getAttribute("data-requirecontext")===context.contextName)return scriptNode.parentNode.removeChild(scriptNode),!0}))}function hasPathFallback(id){var pathConfig=getOwn(config.paths,id);if(pathConfig&&isArray(pathConfig)&&pathConfig.length>1)return pathConfig.shift(),context.require.undef(id),context.makeRequire(null,{skipMap:!0})([id]),!0}function splitPrefix(name){var prefix,index=name?name.indexOf("!"):-1;return index>-1&&(prefix=name.substring(0,index),name=name.substring(index+1,name.length)),[prefix,name]}function makeModuleMap(name,parentModuleMap,isNormalized,applyMap){var url,pluginModule,suffix,nameParts,prefix=null,parentName=parentModuleMap?parentModuleMap.name:null,originalName=name,isDefine=!0,normalizedName="";return name||(isDefine=!1,name="_@r"+(requireCounter+=1)),prefix=(nameParts=splitPrefix(name))[0],name=nameParts[1],prefix&&(prefix=normalize(prefix,parentName,applyMap),pluginModule=getOwn(defined,prefix)),name&&(prefix?normalizedName=pluginModule&&pluginModule.normalize?pluginModule.normalize(name,(function(name){return normalize(name,parentName,applyMap)})):-1===name.indexOf("!")?normalize(name,parentName,applyMap):name:(prefix=(nameParts=splitPrefix(normalizedName=normalize(name,parentName,applyMap)))[0],normalizedName=nameParts[1],isNormalized=!0,url=context.nameToUrl(normalizedName))),{prefix:prefix,name:normalizedName,parentMap:parentModuleMap,unnormalized:!!(suffix=!prefix||pluginModule||isNormalized?"":"_unnormalized"+(unnormalizedCounter+=1)),url:url,originalName:originalName,isDefine:isDefine,id:(prefix?prefix+"!"+normalizedName:normalizedName)+suffix}}function getModule(depMap){var id=depMap.id,mod=getOwn(registry,id);return mod||(mod=registry[id]=new context.Module(depMap)),mod}function on(depMap,name,fn){var id=depMap.id,mod=getOwn(registry,id);!hasProp(defined,id)||mod&&!mod.defineEmitComplete?(mod=getModule(depMap)).error&&"error"===name?fn(mod.error):mod.on(name,fn):"defined"===name&&fn(defined[id])}function onError(err,errback){var ids=err.requireModules,notified=!1;errback?errback(err):(each(ids,(function(id){var mod=getOwn(registry,id);mod&&(mod.error=err,mod.events.error&&(notified=!0,mod.emit("error",err)))})),notified||req.onError(err))}function takeGlobalQueue(){globalDefQueue.length&&(each(globalDefQueue,(function(queueItem){var id=queueItem[0];"string"==typeof id&&(context.defQueueMap[id]=!0),defQueue.push(queueItem)})),globalDefQueue=[])}function cleanRegistry(id){delete registry[id],delete enabledRegistry[id]}function breakCycle(mod,traced,processed){var id=mod.map.id;mod.error?mod.emit("error",mod.error):(traced[id]=!0,each(mod.depMaps,(function(depMap,i){var depId=depMap.id,dep=getOwn(registry,depId);!dep||mod.depMatched[i]||processed[depId]||(getOwn(traced,depId)?(mod.defineDep(i,defined[depId]),mod.check()):breakCycle(dep,traced,processed))})),processed[id]=!0)}function checkLoaded(){var err,usingPathFallback,waitInterval=1e3*config.waitSeconds,expired=waitInterval&&context.startTime+waitInterval<(new Date).getTime(),noLoads=[],reqCalls=[],stillLoading=!1,needCycleCheck=!0;if(!inCheckLoaded){if(inCheckLoaded=!0,eachProp(enabledRegistry,(function(mod){var map=mod.map,modId=map.id;if(mod.enabled&&(map.isDefine||reqCalls.push(mod),!mod.error))if(!mod.inited&&expired)hasPathFallback(modId)?(usingPathFallback=!0,stillLoading=!0):(noLoads.push(modId),removeScript(modId));else if(!mod.inited&&mod.fetched&&map.isDefine&&(stillLoading=!0,!map.prefix))return needCycleCheck=!1})),expired&&noLoads.length)return(err=makeError("timeout","Load timeout for modules: "+noLoads,null,noLoads)).contextName=context.contextName,onError(err);needCycleCheck&&each(reqCalls,(function(mod){breakCycle(mod,{},{})})),expired&&!usingPathFallback||!stillLoading||!isBrowser&&!isWebWorker||checkLoadedTimeoutId||(checkLoadedTimeoutId=setTimeout((function(){checkLoadedTimeoutId=0,checkLoaded()}),50)),inCheckLoaded=!1}}function callGetModule(args){hasProp(defined,args[0])||getModule(makeModuleMap(args[0],null,!0)).init(args[1],args[2])}function removeListener(node,func,name,ieName){node.detachEvent&&!isOpera?ieName&&node.detachEvent(ieName,func):node.removeEventListener(name,func,!1)}function getScriptData(evt){var node=evt.currentTarget||evt.srcElement;return removeListener(node,context.onScriptLoad,"load","onreadystatechange"),removeListener(node,context.onScriptError,"error"),{node:node,id:node&&node.getAttribute("data-requiremodule")}}function intakeDefines(){var args;for(takeGlobalQueue();defQueue.length;){if(null===(args=defQueue.shift())[0])return onError(makeError("mismatch","Mismatched anonymous define() module: "+args[args.length-1]));callGetModule(args)}context.defQueueMap={}}return handlers={require:function(mod){return mod.require?mod.require:mod.require=context.makeRequire(mod.map)},exports:function(mod){if(mod.usingExports=!0,mod.map.isDefine)return mod.exports?defined[mod.map.id]=mod.exports:mod.exports=defined[mod.map.id]={}},module:function(mod){return mod.module?mod.module:mod.module={id:mod.map.id,uri:mod.map.url,config:function(){return getOwn(config.config,mod.map.id)||{}},exports:mod.exports||(mod.exports={})}}},(Module=function(map){this.events=getOwn(undefEvents,map.id)||{},this.map=map,this.shim=getOwn(config.shim,map.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0}).prototype={init:function(depMaps,factory,errback,options){options=options||{},this.inited||(this.factory=factory,errback?this.on("error",errback):this.events.error&&(errback=bind(this,(function(err){this.emit("error",err)}))),this.depMaps=depMaps&&depMaps.slice(0),this.errback=errback,this.inited=!0,this.ignore=options.ignore,options.enabled||this.enabled?this.enable():this.check())},defineDep:function(i,depExports){this.depMatched[i]||(this.depMatched[i]=!0,this.depCount-=1,this.depExports[i]=depExports)},fetch:function(){if(!this.fetched){this.fetched=!0,context.startTime=(new Date).getTime();var map=this.map;if(!this.shim)return map.prefix?this.callPlugin():this.load();context.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,(function(){return map.prefix?this.callPlugin():this.load()})))}},load:function(){var url=this.map.url;urlFetched[url]||(urlFetched[url]=!0,context.load(this.map.id,url))},check:function(){if(this.enabled&&!this.enabling){var err,cjsModule,id=this.map.id,depExports=this.depExports,exports=this.exports,factory=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(factory)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)try{exports=context.execCb(id,factory,depExports,exports)}catch(e){err=e}else exports=context.execCb(id,factory,depExports,exports);if(this.map.isDefine&&void 0===exports&&((cjsModule=this.module)?exports=cjsModule.exports:this.usingExports&&(exports=this.exports)),err)return err.requireMap=this.map,err.requireModules=this.map.isDefine?[this.map.id]:null,err.requireType=this.map.isDefine?"define":"require",onError(this.error=err)}else exports=factory;if(this.exports=exports,this.map.isDefine&&!this.ignore&&(defined[id]=exports,req.onResourceLoad)){var resLoadMaps=[];each(this.depMaps,(function(depMap){resLoadMaps.push(depMap.normalizedMap||depMap)})),req.onResourceLoad(context,this.map,resLoadMaps)}cleanRegistry(id),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else hasProp(context.defQueueMap,id)||this.fetch()}},callPlugin:function(){var map=this.map,id=map.id,pluginMap=makeModuleMap(map.prefix);this.depMaps.push(pluginMap),on(pluginMap,"defined",bind(this,(function(plugin){var load,normalizedMap,normalizedMod,bundleId=getOwn(bundlesMap,this.map.id),name=this.map.name,parentName=this.map.parentMap?this.map.parentMap.name:null,localRequire=context.makeRequire(map.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(plugin.normalize&&(name=plugin.normalize(name,(function(name){return normalize(name,parentName,!0)}))||""),on(normalizedMap=makeModuleMap(map.prefix+"!"+name,this.map.parentMap),"defined",bind(this,(function(value){this.map.normalizedMap=normalizedMap,this.init([],(function(){return value}),null,{enabled:!0,ignore:!0})}))),void((normalizedMod=getOwn(registry,normalizedMap.id))&&(this.depMaps.push(normalizedMap),this.events.error&&normalizedMod.on("error",bind(this,(function(err){this.emit("error",err)}))),normalizedMod.enable()))):bundleId?(this.map.url=context.nameToUrl(bundleId),void this.load()):((load=bind(this,(function(value){this.init([],(function(){return value}),null,{enabled:!0})}))).error=bind(this,(function(err){this.inited=!0,this.error=err,err.requireModules=[id],eachProp(registry,(function(mod){0===mod.map.id.indexOf(id+"_unnormalized")&&cleanRegistry(mod.map.id)})),onError(err)})),load.fromText=bind(this,(function(text,textAlt){var moduleName=map.name,moduleMap=makeModuleMap(moduleName),hasInteractive=useInteractive;textAlt&&(text=textAlt),hasInteractive&&(useInteractive=!1),getModule(moduleMap),hasProp(config.config,id)&&(config.config[moduleName]=config.config[id]);try{req.exec(text)}catch(e){return onError(makeError("fromtexteval","fromText eval for "+id+" failed: "+e,e,[id]))}hasInteractive&&(useInteractive=!0),this.depMaps.push(moduleMap),context.completeLoad(moduleName),localRequire([moduleName],load)})),void plugin.load(map.name,localRequire,load,config))}))),context.enable(pluginMap,this),this.pluginMaps[pluginMap.id]=pluginMap},enable:function(){enabledRegistry[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,(function(depMap,i){var id,mod,handler;if("string"==typeof depMap){if(depMap=makeModuleMap(depMap,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[i]=depMap,handler=getOwn(handlers,depMap.id))return void(this.depExports[i]=handler(this));this.depCount+=1,on(depMap,"defined",bind(this,(function(depExports){this.undefed||(this.defineDep(i,depExports),this.check())}))),this.errback?on(depMap,"error",bind(this,this.errback)):this.events.error&&on(depMap,"error",bind(this,(function(err){this.emit("error",err)})))}id=depMap.id,mod=registry[id],hasProp(handlers,id)||!mod||mod.enabled||context.enable(depMap,this)}))),eachProp(this.pluginMaps,bind(this,(function(pluginMap){var mod=getOwn(registry,pluginMap.id);mod&&!mod.enabled&&context.enable(pluginMap,this)}))),this.enabling=!1,this.check()},on:function(name,cb){var cbs=this.events[name];cbs||(cbs=this.events[name]=[]),cbs.push(cb)},emit:function(name,evt){each(this.events[name],(function(cb){cb(evt)})),"error"===name&&delete this.events[name]}},context={config:config,contextName:contextName,registry:registry,defined:defined,urlFetched:urlFetched,defQueue:defQueue,defQueueMap:{},Module:Module,makeModuleMap:makeModuleMap,nextTick:req.nextTick,onError:onError,configure:function(cfg){if(cfg.baseUrl&&"/"!==cfg.baseUrl.charAt(cfg.baseUrl.length-1)&&(cfg.baseUrl+="/"),"string"==typeof cfg.urlArgs){var urlArgs=cfg.urlArgs;cfg.urlArgs=function(id,url){return(-1===url.indexOf("?")?"?":"&")+urlArgs}}var shim=config.shim,objs={paths:!0,bundles:!0,config:!0,map:!0};eachProp(cfg,(function(value,prop){objs[prop]?(config[prop]||(config[prop]={}),mixin(config[prop],value,!0,!0)):config[prop]=value})),cfg.bundles&&eachProp(cfg.bundles,(function(value,prop){each(value,(function(v){v!==prop&&(bundlesMap[v]=prop)}))})),cfg.shim&&(eachProp(cfg.shim,(function(value,id){isArray(value)&&(value={deps:value}),!value.exports&&!value.init||value.exportsFn||(value.exportsFn=context.makeShimExports(value)),shim[id]=value})),config.shim=shim),cfg.packages&&each(cfg.packages,(function(pkgObj){var name;name=(pkgObj="string"==typeof pkgObj?{name:pkgObj}:pkgObj).name,pkgObj.location&&(config.paths[name]=pkgObj.location),config.pkgs[name]=pkgObj.name+"/"+(pkgObj.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")})),eachProp(registry,(function(mod,id){mod.inited||mod.map.unnormalized||(mod.map=makeModuleMap(id,null,!0))})),(cfg.deps||cfg.callback)&&context.require(cfg.deps||[],cfg.callback)},makeShimExports:function(value){return function(){var ret;return value.init&&(ret=value.init.apply(global,arguments)),ret||value.exports&&getGlobal(value.exports)}},makeRequire:function(relMap,options){function localRequire(deps,callback,errback){var id,requireMod;return options.enableBuildCallback&&callback&&isFunction(callback)&&(callback.__requireJsBuild=!0),"string"==typeof deps?isFunction(callback)?onError(makeError("requireargs","Invalid require call"),errback):relMap&&hasProp(handlers,deps)?handlers[deps](registry[relMap.id]):req.get?req.get(context,deps,relMap,localRequire):(id=makeModuleMap(deps,relMap,!1,!0).id,hasProp(defined,id)?defined[id]:onError(makeError("notloaded",'Module name "'+id+'" has not been loaded yet for context: '+contextName+(relMap?"":". Use require([])")))):(intakeDefines(),context.nextTick((function(){intakeDefines(),(requireMod=getModule(makeModuleMap(null,relMap))).skipMap=options.skipMap,requireMod.init(deps,callback,errback,{enabled:!0}),checkLoaded()})),localRequire)}return options=options||{},mixin(localRequire,{isBrowser:isBrowser,toUrl:function(moduleNamePlusExt){var ext,index=moduleNamePlusExt.lastIndexOf("."),segment=moduleNamePlusExt.split("/")[0];return-1!==index&&(!("."===segment||".."===segment)||index>1)&&(ext=moduleNamePlusExt.substring(index,moduleNamePlusExt.length),moduleNamePlusExt=moduleNamePlusExt.substring(0,index)),context.nameToUrl(normalize(moduleNamePlusExt,relMap&&relMap.id,!0),ext,!0)},defined:function(id){return hasProp(defined,makeModuleMap(id,relMap,!1,!0).id)},specified:function(id){return id=makeModuleMap(id,relMap,!1,!0).id,hasProp(defined,id)||hasProp(registry,id)}}),relMap||(localRequire.undef=function(id){takeGlobalQueue();var map=makeModuleMap(id,relMap,!0),mod=getOwn(registry,id);mod.undefed=!0,removeScript(id),delete defined[id],delete urlFetched[map.url],delete undefEvents[id],eachReverse(defQueue,(function(args,i){args[0]===id&&defQueue.splice(i,1)})),delete context.defQueueMap[id],mod&&(mod.events.defined&&(undefEvents[id]=mod.events),cleanRegistry(id))}),localRequire},enable:function(depMap){getOwn(registry,depMap.id)&&getModule(depMap).enable()},completeLoad:function(moduleName){var found,args,mod,shim=getOwn(config.shim,moduleName)||{},shExports=shim.exports;for(takeGlobalQueue();defQueue.length;){if(null===(args=defQueue.shift())[0]){if(args[0]=moduleName,found)break;found=!0}else args[0]===moduleName&&(found=!0);callGetModule(args)}if(context.defQueueMap={},mod=getOwn(registry,moduleName),!found&&!hasProp(defined,moduleName)&&mod&&!mod.inited){if(!(!config.enforceDefine||shExports&&getGlobal(shExports)))return hasPathFallback(moduleName)?void 0:onError(makeError("nodefine","No define call for "+moduleName,null,[moduleName]));callGetModule([moduleName,shim.deps||[],shim.exportsFn])}checkLoaded()},nameToUrl:function(moduleName,ext,skipExt){var paths,syms,i,url,parentPath,bundleId,pkgMain=getOwn(config.pkgs,moduleName);if(pkgMain&&(moduleName=pkgMain),bundleId=getOwn(bundlesMap,moduleName))return context.nameToUrl(bundleId,ext,skipExt);if(req.jsExtRegExp.test(moduleName))url=moduleName+(ext||"");else{for(paths=config.paths,i=(syms=moduleName.split("/")).length;i>0;i-=1)if(parentPath=getOwn(paths,syms.slice(0,i).join("/"))){isArray(parentPath)&&(parentPath=parentPath[0]),syms.splice(0,i,parentPath);break}url=syms.join("/"),url=("/"===(url+=ext||(/^data\:|^blob\:|\?/.test(url)||skipExt?"":".js")).charAt(0)||url.match(/^[\w\+\.\-]+:/)?"":config.baseUrl)+url}return config.urlArgs&&!/^blob\:/.test(url)?url+config.urlArgs(moduleName,url):url},load:function(id,url){req.load(context,id,url)},execCb:function(name,callback,args,exports){return callback.apply(exports,args)},onScriptLoad:function(evt){if("load"===evt.type||readyRegExp.test((evt.currentTarget||evt.srcElement).readyState)){interactiveScript=null;var data=getScriptData(evt);context.completeLoad(data.id)}},onScriptError:function(evt){var data=getScriptData(evt);if(!hasPathFallback(data.id)){var parents=[];return eachProp(registry,(function(value,key){0!==key.indexOf("_@r")&&each(value.depMaps,(function(depMap){if(depMap.id===data.id)return parents.push(key),!0}))})),onError(makeError("scripterror",'Script error for "'+data.id+(parents.length?'", needed by: '+parents.join(", "):'"'),evt,[data.id]))}}},context.require=context.makeRequire(),context}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState||eachReverse(scripts(),(function(script){if("interactive"===script.readyState)return interactiveScript=script})),interactiveScript}})(this),define("requireLib",(function(){})),function(){function t(t){this.message=t}var r="undefined"!=typeof exports?exports:self,e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";t.prototype=new Error,t.prototype.name="InvalidCharacterError",r.btoa||(r.btoa=function(r){for(var o,n,a=String(r),i=0,c=e,d="";a.charAt(0|i)||(c="=",i%1);d+=c.charAt(63&o>>8-i%1*8)){if((n=a.charCodeAt(i+=.75))>255)throw new t("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");o=o<<8|n}return d}),r.atob||(r.atob=function(r){var o=String(r).replace(/=+$/,"");if(o.length%4==1)throw new t("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,a,i=0,c=0,d="";a=o.charAt(c++);~a&&(n=i%4?64*n+a:a,i++%4)?d+=String.fromCharCode(255&n>>(-2*i&6)):0)a=e.indexOf(a);return d})}(),define("lib/base64.min.js",(function(){})),window.browserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"Other",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"Unknown","Explorer"==this.browser&&"7"==this.version&&navigator.userAgent.match(/Trident/i)&&(this.version=this.searchVersionIE())},searchString:function(data){for(var i=0;i<data.length;i++){var dataString=data[i].string;if(this.versionSearchString=data[i].subString,-1!=dataString.indexOf(data[i].subString))return data[i].identity}},searchVersion:function(dataString){var index=dataString.indexOf(this.versionSearchString);if(-1!=index)return parseFloat(dataString.substring(index+this.versionSearchString.length+1))},searchVersionIE:function(){var ver,ua=navigator.userAgent.toString().toLowerCase(),match=/(trident)(?:.*rv:([\w.]+))?/.exec(ua)||/(msie) ([\w.]+)/.exec(ua)||["",null,-1];try{ver=match[2].split(".")[0]}catch(err){ver="unknown"}return ver},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer"},{string:navigator.userAgent,subString:"Trident",identity:"Explorer"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.userAgent,subString:"Safari",identity:"Safari"},{string:navigator.userAgent,subString:"Opera",identity:"Opera"}]},window.browserDetect.init(),define("lib/browserdetect.js",(function(){})),function(a){(jQuery.browser=jQuery.browser||{}).mobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|android|ipad|playbook|silk|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))}(navigator.userAgent||navigator.vendor||window.opera),define("lib/detectmobilebrowser.js",(function(){})),function($){if($.support.cors||!$.ajaxTransport||!window.XDomainRequest)return $;var httpRegEx=/^(https?:)?\/\//i,getOrPostRegEx=/^get|post$/i,sameSchemeRegEx=new RegExp("^(//|"+location.protocol+")","i");$.ajaxTransport("* text html xml json",(function(options,userOptions,jqXHR){if(options.crossDomain&&options.async&&getOrPostRegEx.test(options.type)&&httpRegEx.test(options.url)&&sameSchemeRegEx.test(options.url)){var xdr=null;return{send:function(headers,complete){var postData="",userType=(userOptions.dataType||"").toLowerCase();xdr=new XDomainRequest,/^\d+$/.test(userOptions.timeout)&&(xdr.timeout=userOptions.timeout),xdr.ontimeout=function(){complete(500,"timeout")},xdr.onload=function(){var allResponseHeaders="Content-Length: "+xdr.responseText.length+"\r\nContent-Type: "+xdr.contentType,status={code:200,message:"success"},responses={text:xdr.responseText};try{if("html"===userType||/text\/html/i.test(xdr.contentType))responses.html=xdr.responseText;else if("json"===userType||"text"!==userType&&/\/json/i.test(xdr.contentType))try{responses.json=$.parseJSON(xdr.responseText)}catch(e){status.code=500,status.message="parseerror"}else if("xml"===userType||"text"!==userType&&/\/xml/i.test(xdr.contentType)){var doc=new ActiveXObject("Microsoft.XMLDOM");doc.async=!1;try{doc.loadXML(xdr.responseText)}catch(e){doc=void 0}if(!doc||!doc.documentElement||doc.getElementsByTagName("parsererror").length)throw status.code=500,status.message="parseerror","Invalid XML: "+xdr.responseText;responses.xml=doc}}catch(parseMessage){throw parseMessage}finally{complete(status.code,status.message,responses,allResponseHeaders)}},xdr.onprogress=function(){},xdr.onerror=function(){complete(401,"error",{text:xdr.responseText})},userOptions.data&&(postData="string"===$.type(userOptions.data)?userOptions.data:$.param(userOptions.data)),xdr.open(options.type,options.url),xdr.send(postData)},abort:function(){xdr&&xdr.abort()}}}}))}(jQuery),define("lib/jquery.xdomainrequest.js",(function(){})),window.Modernizr=function(a,b,c){function v(a){j.cssText=a}function x(a,b){return typeof a===b}var s,u,e={},g=b.documentElement,i=b.createElement("modernizr"),j=i.style,k=b.createElement("input"),l=":)",n={},o={},p={},q=[],r=q.slice,t={}.hasOwnProperty;for(var B in u=x(t,"undefined")||x(t.call,"undefined")?function(a,b){return b in a&&x(a.constructor.prototype[b],"undefined")}:function(a,b){return t.call(a,b)},Function.prototype.bind||(Function.prototype.bind=function(b){var c=this;if("function"!=typeof c)throw new TypeError;var d=r.call(arguments,1),e=function(){if(this instanceof e){var a=function(){};a.prototype=c.prototype;var f=new a,g=c.apply(f,d.concat(r.call(arguments)));return Object(g)===g?g:f}return c.apply(b,d.concat(r.call(arguments)))};return e}),n)u(n,B)&&(s=B.toLowerCase(),e[s]=n[B](),q.push((e[s]?"":"no-")+s));return e.input||(e.input=function(c){for(var d=0,e=c.length;d<e;d++)p[c[d]]=c[d]in k;return p.list&&(p.list=!!b.createElement("datalist")&&!!a.HTMLDataListElement),p}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),e.inputtypes=function(a){for(var e,f,h,d=0,i=a.length;d<i;d++)k.setAttribute("type",f=a[d]),(e="text"!==k.type)&&(k.value=l,k.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(f)&&k.style.WebkitAppearance!==c?(g.appendChild(k),e=(h=b.defaultView).getComputedStyle&&"textfield"!==h.getComputedStyle(k,null).WebkitAppearance&&0!==k.offsetHeight,g.removeChild(k)):/^(search|tel)$/.test(f)||(e=/^(url|email)$/.test(f)?k.checkValidity&&!1===k.checkValidity():k.value!=l)),o[a[d]]=!!e;return o}("search tel url email datetime date month week time datetime-local number range color".split(" "))),e.addTest=function(a,b){if("object"==typeof a)for(var d in a)u(a,d)&&e.addTest(d,a[d]);else{if(a=a.toLowerCase(),e[a]!==c)return e;b="function"==typeof b?b():b,g.className+=" "+(b?"":"no-")+a,e[a]=b}return e},v(""),i=k=null,e._version="2.8.3",g.className=g.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+" js "+q.join(" "),e}(this,this.document),function(a,b,c){function d(a){return"[object Function]"==o.call(a)}function e(a){return"string"==typeof a}function f(){}function g(a){return!a||"loaded"==a||"complete"==a||"uninitialized"==a}function h(){var a=p.shift();q=1,a?a.t?m((function(){("c"==a.t?B.injectCss:B.injectJs)(a.s,0,a.a,a.x,a.e,1)}),0):(a(),h()):q=0}function i(a,c,d,e,f,i,j){function k(b){if(!o&&g(l.readyState)&&(u.r=o=1,!q&&h(),l.onload=l.onreadystatechange=null,b))for(var d in"img"!=a&&m((function(){t.removeChild(l)}),50),y[c])y[c].hasOwnProperty(d)&&y[c][d].onload()}j=j||B.errorTimeout;var l=b.createElement(a),o=0,r=0,u={t:d,s:c,e:f,a:i,x:j};1===y[c]&&(r=1,y[c]=[]),"object"==a?l.data=c:(l.src=c,l.type=a),l.width=l.height="0",l.onerror=l.onload=l.onreadystatechange=function(){k.call(this,r)},p.splice(e,0,u),"img"!=a&&(r||2===y[c]?(t.insertBefore(l,s?null:n),m(k,j)):y[c].push(l))}function j(a,b,c,d,f){return q=0,b=b||"j",e(a)?i("c"==b?v:u,a,b,this.i++,c,d,f):(p.splice(this.i++,0,a),1==p.length&&h()),this}function k(){var a=B;return a.loader={load:j,i:0},a}var A,B,l=b.documentElement,m=a.setTimeout,n=b.getElementsByTagName("script")[0],o={}.toString,p=[],q=0,r="MozAppearance"in l.style,s=r&&!!b.createRange().compareNode,t=s?l:n.parentNode,u=(l=a.opera&&"[object Opera]"==o.call(a.opera),l=!!b.attachEvent&&!l,r?"object":l?"script":"img"),v=l?"script":u,w=Array.isArray||function(a){return"[object Array]"==o.call(a)},x=[],y={},z={timeout:function(a,b){return b.length&&(a.timeout=b[0]),a}};B=function(a){function g(a,e,f,g,h){var i=function(a){a=a.split("!");var e,f,g,b=x.length,c=a.pop(),d=a.length;for(c={url:c,origUrl:c,prefixes:a},f=0;f<d;f++)g=a[f].split("="),(e=z[g.shift()])&&(c=e(c,g));for(f=0;f<b;f++)c=x[f](c);return c}(a),j=i.autoCallback;i.url.split(".").pop().split("?").shift(),i.bypass||(e&&(e=d(e)?e:e[a]||e[g]||e[a.split("/").pop().split("?")[0]]),i.instead?i.instead(a,e,f,g,h):(y[i.url]?i.noexec=!0:y[i.url]=1,f.load(i.url,i.forceCSS||!i.forceJS&&"css"==i.url.split(".").pop().split("?").shift()?"c":undefined,i.noexec,i.attrs,i.timeout),(d(e)||d(j))&&f.load((function(){k(),e&&e(i.origUrl,h,g),j&&j(i.origUrl,h,g),y[i.url]=2}))))}function h(a,b){function c(a,c){if(a){if(e(a))c||(j=function(){var a=[].slice.call(arguments);k.apply(this,a),l()}),g(a,j,b,0,h);else if(Object(a)===a)for(n in m=function(){var c,b=0;for(c in a)a.hasOwnProperty(c)&&b++;return b}(),a)a.hasOwnProperty(n)&&(!c&&!--m&&(d(j)?j=function(){var a=[].slice.call(arguments);k.apply(this,a),l()}:j[n]=function(a){return function(){var b=[].slice.call(arguments);a&&a.apply(this,b),l()}}(k[n])),g(a[n],j,b,n,h))}else!c&&l()}var m,n,h=!!a.test,i=a.load||a.both,j=a.callback||f,k=j,l=a.complete||f;c(h?a.yep:a.nope,!!i),i&&c(i)}var i,j,l=this.yepnope.loader;if(e(a))g(a,0,l,0);else if(w(a))for(i=0;i<a.length;i++)e(j=a[i])?g(j,0,l,0):w(j)?B(j):Object(j)===j&&h(j,l);else Object(a)===a&&h(a,l)},B.addPrefix=function(a,b){z[a]=b},B.addFilter=function(a){x.push(a)},B.errorTimeout=1e4,null==b.readyState&&b.addEventListener&&(b.readyState="loading",b.addEventListener("DOMContentLoaded",A=function(){b.removeEventListener("DOMContentLoaded",A,0),b.readyState="complete"},0)),a.yepnope=k(),a.yepnope.executeStack=h,a.yepnope.injectJs=function(a,c,d,e,i,j){var l,o,k=b.createElement("script");e=e||B.errorTimeout;for(o in k.src=a,d)k.setAttribute(o,d[o]);c=j?h:c||f,k.onreadystatechange=k.onload=function(){!l&&g(k.readyState)&&(l=1,c(),k.onload=k.onreadystatechange=null)},m((function(){l||(l=1,c(1))}),e),i?k.onload():n.parentNode.insertBefore(k,n)},a.yepnope.injectCss=function(a,c,d,e,g,i){var j;e=b.createElement("link"),c=i?h:c||f;for(j in e.href=a,e.rel="stylesheet",e.type="text/css",d)e.setAttribute(j,d[j]);g||(n.parentNode.insertBefore(e,n),m(c,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))},Modernizr.addTest("cors",!(!window.XMLHttpRequest||!("withCredentials"in new XMLHttpRequest))),define("lib/modernizr.js",(function(){}));var __extends=this&&this.__extends||function(){var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,e){r.__proto__=e}||function(r,e){for(var t in e)e.hasOwnProperty(t)&&(r[t]=e[t])};return function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),exjs,exjs,exjs,exjs,exjs,exjs,exjs,exjs,exjs,exjs,exjs,exjs,exjs,exjs,exjs,exjs,exjs,exjs,exjs,exjs,exjs,exjs,exjs,exjs,exjs,exjs,exjs,exjs;(exjs||(exjs={})).version="0.5.1",exjs||(exjs={}),Array.isArray||(Array.isArray=function(r){return"[object Array]"===Object.prototype.toString.call(r)}),function(r){var e=function(){function r(){}return r.prototype.getEnumerator=function(){return{moveNext:function(){return!1},current:void 0}},r.prototype.aggregate=function(r,e){for(var t=r,n=this.getEnumerator();n.moveNext();)t=e(t,n.current);return t},r.prototype.all=function(r){if(r)for(var e=this.getEnumerator(),t=0;e.moveNext();){if(!r(e.current,t))return!1;t++}return!0},r.prototype.any=function(r){for(var e=this.getEnumerator(),t=0;e.moveNext();){if(!r)return!0;if(r(e.current,t))return!0;t++}return!1},r.prototype.append=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];throw new Error("Not implemented")},r.prototype.apply=function(r){throw new Error("Not implemented")},r.prototype.at=function(r){for(var e=this.getEnumerator(),t=0;e.moveNext();){if(t===r)return e.current;t++}},r.prototype.average=function(r){var e=0,t=0;r=r||function(r){if("number"!=typeof r)throw new Error("Object is not a number.");return r};for(var n=this.getEnumerator();n.moveNext();)t+=r(n.current),e++;return 0===e?0:t/e},r.prototype.concat=function(r){throw new Error("Not implemented")},r.prototype.count=function(r){for(var e=0,t=this.getEnumerator();t.moveNext();)r&&!r(t.current)||e++;return e},r.prototype.difference=function(r,e){return e=e||function(r,e){return r===e},r instanceof Array&&(r=r.en()),{intersection:this.intersect(r,e).toArray().en(),aNotB:this.except(r,e).toArray().en(),bNotA:r.except(this,e).toArray().en()}},r.prototype.distinct=function(r){throw new Error("Not implemented")},r.prototype.except=function(r,e){throw new Error("Not implemented")},r.prototype.first=function(r){for(var e=this.getEnumerator();e.moveNext();)if(!r||r(e.current))return e.current},r.prototype.firstIndex=function(r){for(var e=this.getEnumerator(),t=0;e.moveNext();t++)if(!r||r(e.current))return t;return-1},r.prototype.forEach=function(r){for(var e=this.getEnumerator();e.moveNext();)r(e.current)},r.prototype.groupBy=function(r,e){throw new Error("Not implemented")},r.prototype.intersect=function(r,e){throw new Error("Not implemented")},r.prototype.join=function(r,e,t,n,o){throw new Error("Not implemented")},r.prototype.last=function(r){for(var e,t=this.getEnumerator();t.moveNext();)r&&!r(t.current)||(e=t.current);return e},r.prototype.lastIndex=function(r){for(var e=-1,t=this.getEnumerator(),n=0;t.moveNext();n++)r&&!r(t.current)||(e=n);return e},r.prototype.max=function(r){var e=this.getEnumerator();if(!e.moveNext())return 0;for(var t=(r=r||function(r){if("number"!=typeof r)throw new Error("Object is not a number.");return r})(e.current);e.moveNext();)t=Math.max(t,r(e.current));return t},r.prototype.min=function(r){var e=this.getEnumerator();if(!e.moveNext())return 0;for(var t=(r=r||function(r){if("number"!=typeof r)throw new Error("Object is not a number.");return r})(e.current);e.moveNext();)t=Math.min(t,r(e.current));return t},r.prototype.orderBy=function(r,e){throw new Error("Not implemented")},r.prototype.orderByDescending=function(r,e){throw new Error("Not implemented")},r.prototype.prepend=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];throw new Error("Not implemented")},r.prototype.reverse=function(){throw new Error("Not implemented")},r.prototype.select=function(r){throw new Error("Not implemented")},r.prototype.selectMany=function(r){throw new Error("Not implemented")},r.prototype.skip=function(r){throw new Error("Not implemented")},r.prototype.skipWhile=function(r){throw new Error("Not implemented")},r.prototype.standardDeviation=function(r){var e=this.average(r),t=0,n=0;r=r||function(r){if("number"!=typeof r)throw new Error("Object is not a number.");return r};for(var o=this.getEnumerator();o.moveNext();){var u=r(o.current)-e;t+=u*u,n++}return Math.sqrt(t/n)},r.prototype.sum=function(r){var e=0;r=r||function(r){if("number"!=typeof r)throw new Error("Object is not a number.");return r};for(var t=this.getEnumerator();t.moveNext();)e+=r(t.current);return e},r.prototype.take=function(r){throw new Error("Not implemented")},r.prototype.takeWhile=function(r){throw new Error("Not implemented")},r.prototype.traverse=function(r){throw new Error("Not implemented")},r.prototype.traverseUnique=function(r,e){throw new Error("Not implemented")},r.prototype.toArray=function(){for(var r=[],e=this.getEnumerator();e.moveNext();)r.push(e.current);return r},r.prototype.toMap=function(r,e){throw new Error("Not implemented")},r.prototype.toList=function(){throw new Error("Not implemented")},r.prototype.union=function(r,e){throw new Error("Not implemented")},r.prototype.where=function(r){throw new Error("Not implemented")},r.prototype.zip=function(r,e){throw new Error("Not implemented")},r}();r.Enumerable=e}(exjs||(exjs={})),function(r){var e=function(){function e(r){var e;if(this.size=0,this._keys=[],this._values=[],r instanceof Array?e=r.en():r&&r.getEnumerator instanceof Function&&(e=r),e)for(var t=e.getEnumerator();t&&t.moveNext();)this.set(t.current[0],t.current[1])}return e.prototype.clear=function(){this._keys.length=0,this._values.length=0,this.size=0},e.prototype.delete=function(r){var e=this._keys.indexOf(r);return e>-1&&(this._keys.splice(e,1),this._values.splice(e,1),this.size--,!0)},e.prototype.entries=function(){var e=this;return r.range(0,this.size).select((function(r){return[e._keys[r],e._values[r]]}))},e.prototype.forEach=function(r,e){null==e&&(e=this);for(var t=0,n=this._keys,o=this._values,u=n.length;t<u;t++)r.call(e,o[t],n[t],this)},e.prototype.get=function(r){var e=this._keys.indexOf(r);return this._values[e]},e.prototype.has=function(r){return this._keys.indexOf(r)>-1},e.prototype.keys=function(){return this._keys.en()},e.prototype.set=function(r,e){var t=this._keys.indexOf(r);t>-1?this._values[t]=e:(this._keys.push(r),this._values.push(e),this.size++)},e.prototype.values=function(){return this._values.en()},e}();r.Map3=e,r.Enumerable.prototype.toMap=function(r,t){for(var n=new e,o=this.getEnumerator();o.moveNext();)n.set(r(o.current),t(o.current));return n},r.List&&(r.List.prototype.toMap=r.Enumerable.prototype.toMap)}(exjs||(exjs={})),function(r){r.Map||(r.Map=exjs.Map3)}("undefined"==typeof window?global:window),function(r){r.anonymous=function(e){var t=new r.Enumerable;return t.getEnumerator=function(){var r={current:void 0,moveNext:function(){return e(r)}};return r},t}}(exjs||(exjs={})),function(r){function e(r,e){var t,n,o=1,u={current:void 0,moveNext:function(){if(o<2){if((t=t||r.getEnumerator()).moveNext())return u.current=t.current,!0;o++}return(n=n||e.en().getEnumerator()).moveNext()?(u.current=n.current,!0):(u.current=void 0,!1)}};return u}r.Enumerable.prototype.append=function(){for(var t=this,n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];var u=new r.Enumerable;return u.getEnumerator=function(){return e(t,n)},u},r.List&&(r.List.prototype.append=r.Enumerable.prototype.append)}(exjs||(exjs={})),function(r){r.Enumerable.prototype.apply=function(t){var n=this,o=new r.Enumerable;return o.getEnumerator=function(){return function(r,e){var t,n=0,o={current:void 0,moveNext:function(){return t||(t=r.getEnumerator()),!!t.moveNext()&&(e(o.current=t.current,n),n++,!0)}};return o}(n,t)},o},r.List&&(r.List.prototype.apply=r.Enumerable.prototype.apply)}(exjs||(exjs={})),function(r){function t(){return this&&Array.isArray(this)?new n(this):new r.Enumerable}var n=function(r){function t(t){var n=r.call(this)||this;return n.getEnumerator=function(){return function(r){var e=r.length,t={moveNext:void 0,current:void 0},n=-1;return t.moveNext=function(){return++n>=e?(t.current=void 0,!1):(t.current=r[n],!0)},t}(t)},n.toArray=function(){return t.slice(0)},n}return __extends(t,r),t}(r.Enumerable);try{Object.defineProperty(Array.prototype,"en",{value:t,enumerable:!1,writable:!1,configurable:!1})}catch(r){Array.prototype.en=t}}(exjs||(exjs={})),function(r){r.Enumerable.prototype.concat=function(t){var n=this,o=t instanceof Array?t.en():t,u=new r.Enumerable;return u.getEnumerator=function(){return function(r,e){var t,n=!1,o={current:void 0,moveNext:function(){return t||(t=r.getEnumerator()),o.current=void 0,t.moveNext()?(o.current=t.current,!0):!n&&(n=!0,!!(t=e.getEnumerator()).moveNext()&&(o.current=t.current,!0))}};return o}(n,o)},u},r.List&&(r.List.prototype.concat=r.Enumerable.prototype.concat)}(exjs||(exjs={})),function(r){r.Enumerable.prototype.distinct=function(t){var n=this,o=new r.Enumerable;return o.getEnumerator=function(){return function(r,e){var t,n=[],o={current:void 0,moveNext:function(){if(t||(t=r.getEnumerator()),o.current=void 0,!e){for(;t.moveNext();)if(n.indexOf(t.current)<0)return n.push(o.current=t.current),!0;return!1}for(;t.moveNext();){for(var u=0,i=n.length,c=!1;u<i&&!c;u++)c=!!e(n[u],t.current);if(!c)return n.push(o.current=t.current),!0}return!1}};return o}(n,t)},o},r.List&&(r.List.prototype.distinct=r.Enumerable.prototype.distinct)}(exjs||(exjs={})),function(r){r.Enumerable.prototype.except=function(t,n){var o=this,u=t instanceof Array?t.en():t,i=new r.Enumerable;return i.getEnumerator=function(){return function(r,e,t){t=t||function(r,e){return r===e};var n,o={current:void 0,moveNext:function(){for(n||(n=r.getEnumerator()),o.current=void 0;n.moveNext();){for(var u=!1,i=e.getEnumerator();i.moveNext()&&!u;)u=t(n.current,i.current);if(!u)return o.current=n.current,!0}return!1}};return o}(o,u,n)},i},r.List&&(r.List.prototype.except=r.Enumerable.prototype.except)}(exjs||(exjs={})),Function.prototype.fromJson=function(r,e){function t(r,e){if(null==r)return r;if(e instanceof Function)return e(r);if(e instanceof Array){if(!((e=e[0])instanceof Function&&r instanceof Array))return;for(var t=[],n=0;n<r.length;n++)t.push(e(r[n]));return t}}var n=new this;if(null==r)return n;var o=[];for(var u in e){void 0!==(i=t(r[u],e[u]))&&(n[u]=i,o.push(u))}for(var u in this.$jsonMappings)if(!(o.indexOf(u)>-1)){var i;void 0!==(i=t(r[u],this.$jsonMappings[u]))&&(n[u]=i,o.push(u))}for(var u in r)o.indexOf(u)>-1||(n[u]=r[u]);return n},function(r){function e(r,e,n){var o,u=0,i={current:void 0,moveNext:function(){return o||(o=t(r,e,n)),i.current=void 0,!(u>=o.length||(i.current=o[u],u++,0))}};return i}function t(r,e,t){t=t||function(r,e){return r===e};for(var o,u=[],i=[],c=r.getEnumerator();c.moveNext();){o=e(c.current);for(var a=-1,p=0,f=i.length;p<f;p++)if(t(o,i[p])){a=p;break}var s;a<0?(i.push(o),u.push(s=new n(o))):s=u[a],s._add(c.current)}return u}var n=function(r){function e(e){var t=r.call(this)||this;return t.key=e,t._arr=[],t.getEnumerator=function(){return t._arr.en().getEnumerator()},t}return __extends(e,r),e.prototype._add=function(r){this._arr.push(r)},e}(r.Enumerable);r.Enumerable.prototype.groupBy=function(t,n){var o=this,u=new r.Enumerable;return u.getEnumerator=function(){return e(o,t,n)},u},r.List&&(r.List.prototype.groupBy=r.Enumerable.prototype.groupBy)}(exjs||(exjs={})),function(r){r.Enumerable.prototype.intersect=function(t,n){var o=this,u=t instanceof Array?t.en():t,i=new r.Enumerable;return i.getEnumerator=function(){return function(e,t,n){n=n||function(r,e){return r===e};var o,u={current:void 0,moveNext:function(){for(o||(o=r.en(e).distinct().getEnumerator()),u.current=void 0;o.moveNext();){for(var i=!1,c=t.getEnumerator();c.moveNext()&&!i;)i=n(o.current,c.current);if(i)return u.current=o.current,!0}return!1}};return u}(o,u,n)},i},r.List&&(r.List.prototype.intersect=r.Enumerable.prototype.intersect)}(exjs||(exjs={})),function(r){r.Enumerable.prototype.join=function(t,n,o,u,i){var c=this,a=t instanceof Array?t.en():t,p=new r.Enumerable;return p.getEnumerator=function(){return function(e,t,n,o,u,i){i=i||function(r,e){return r===e};var c,a,p=0,f={current:void 0,moveNext:function(){if(f.current=void 0,!c){if(!(c=e.getEnumerator()).moveNext())return!1;a=r.en(t).toArray()}var s;do{for(;p<a.length;p++)if(s=a[p],i(n(c.current),o(s)))return p++,f.current=u(c.current,s),!0;p=0}while(c.moveNext());return!1}};return f}(c,a,n,o,u,i)},p},r.List&&(r.List.prototype.join=r.Enumerable.prototype.join)}(exjs||(exjs={})),function(r){function e(){this.constructor=t}r.Enumerable.prototype.toList=function(){for(var r=new t,e=this.getEnumerator();e.moveNext();)r.push(e.current);return r};var t=function(r){function e(){return null!==r&&r.apply(this,arguments)||this}return __extends(e,r),e.prototype.toString=function(){throw new Error("Not implemented")},e.prototype.toLocaleString=function(){throw new Error("Not implemented")},e.prototype.pop=function(){throw new Error("Not implemented")},e.prototype.push=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];throw new Error("Not implemented")},e.prototype.shift=function(){throw new Error("Not implemented")},e.prototype.slice=function(r,e){throw new Error("Not implemented")},e.prototype.sort=function(r){throw new Error("Not implemented")},e.prototype.splice=function(){throw new Error("Not implemented")},e.prototype.unshift=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];throw new Error("Not implemented")},e.prototype.indexOf=function(r,e){throw new Error("Not implemented")},e.prototype.lastIndexOf=function(r,e){throw new Error("Not implemented")},e.prototype.every=function(r,e){throw new Error("Not implemented")},e.prototype.some=function(r,e){throw new Error("Not implemented")},e.prototype.forEach=function(r,e){throw new Error("Not implemented")},e.prototype.map=function(r,e){throw new Error("Not implemented")},e.prototype.filter=function(r,e){throw new Error("Not implemented")},e.prototype.reduce=function(r,e){throw new Error("Not implemented")},e.prototype.reduceRight=function(r,e){throw new Error("Not implemented")},e.prototype.remove=function(r){throw new Error("Not implemented")},e.prototype.removeWhere=function(r){throw new Error("Not implemented")},e}(r.Enumerable);for(var n in r.List=t,Array)Array.hasOwnProperty(n)&&(t[n]=Array[n]);for(var o in e.prototype=Array.prototype,t.prototype=new e,r.Enumerable.prototype)"getEnumerator"!==o&&(t.prototype[o]=r.Enumerable.prototype[o]);t.prototype.getEnumerator=function(){var r=this,e=r.length,t={moveNext:void 0,current:void 0},n=-1;return t.moveNext=function(){return++n>=e?(t.current=void 0,!1):(t.current=r[n],!0)},t},t.prototype.remove=function(r){return this.removeWhere((function(e){return e===r})).any()},t.prototype.removeWhere=function(r){for(var e,t=[],n=this.length-1;n>=0;n--)!0===r(e=this[n],n)&&(this.splice(n,1),t.push(e));return t.en().reverse()}}(exjs||(exjs={})),function(r){function e(r,e,n,o){return new t(r,e,n,o)}var t=function(e){function t(r,t,n,o){var u=e.call(this)||this;u.Source=r,o=o||function(r,e){return r>e?1:r<e?-1:0};var i=!0===n?-1:1;return u.Sorter=function(r,e){return i*o(t(r),t(e))},u}return __extends(t,e),t.prototype.getEnumerator=function(){var e,t=this.Source,n=this.Sorter,o=0,u={current:void 0,moveNext:function(){return e||(e=r.en(t).toArray()).sort(n),u.current=void 0,!(o>=e.length||(u.current=e[o],o++,0))}};return u},t.prototype.thenBy=function(r,e){return new n(this,r,!1,e)},t.prototype.thenByDescending=function(r,e){return new n(this,r,!0,e)},t}(r.Enumerable),n=function(r){function e(e,t,n,o){var u=r.call(this,e,t,n,o)||this,i=e.Sorter,c=u.Sorter;return u.Sorter=function(r,e){return i(r,e)||c(r,e)},u}return __extends(e,r),e}(t),o=r.Enumerable.prototype;o.orderBy=function(r,t){return e(this,r,!1,t)},o.orderByDescending=function(r,t){return e(this,r,!0,t)},r.List&&(r.List.prototype.orderBy=r.Enumerable.prototype.orderBy,r.List.prototype.orderByDescending=r.Enumerable.prototype.orderByDescending)}(exjs||(exjs={})),function(r){function e(r,e){var t,n,o=1,u={current:void 0,moveNext:function(){if(o<2){if((t=t||e.en().getEnumerator()).moveNext())return u.current=t.current,!0;o++}return(n=n||r.getEnumerator()).moveNext()?(u.current=n.current,!0):(u.current=void 0,!1)}};return u}r.Enumerable.prototype.prepend=function(){for(var t=this,n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];var u=new r.Enumerable;return u.getEnumerator=function(){return e(t,n)},u},r.List&&(r.List.prototype.prepend=r.Enumerable.prototype.prepend)}(exjs||(exjs={})),function(r){r.range=function(t,n,o){if((t=t||0)>(n=n||0))throw new Error("Start cannot be greater than end.");null==o&&(o=1);var u=new r.Enumerable;return u.getEnumerator=function(){return function(r,e,t){var n=r-t,o={current:void 0,moveNext:function(){return!((n+=t)>=e||(o.current=n,0))}};return o}(t,n,o)},u}}(exjs||(exjs={})),function(r){r.Enumerable.prototype.reverse=function(){var t=this,n=new r.Enumerable;return n.getEnumerator=function(){return function(e){var t,n=0,o={current:void 0,moveNext:function(){return t||(t=r.en(e).toArray(),n=t.length),n--,o.current=t[n],n>=0}};return o}(t)},n},r.List&&(r.List.prototype.reverse=r.Enumerable.prototype.reverse)}(exjs||(exjs={})),(exjs||(exjs={})).round=function(r,e){if(0===(e=e||0))return Math.round(r);var t=Math.pow(10,e);return Math.round(r*t)/t},function(r){r.Enumerable.prototype.select=function(t){var n=this,o=new r.Enumerable;return o.getEnumerator=function(){return function(r,e){var t,n=0,o={current:void 0,moveNext:function(){return t||(t=r.getEnumerator()),!!t.moveNext()&&(o.current=e(t.current,n),n++,!0)}};return o}(n,t)},o},r.Enumerable.prototype.selectMany=function(e){var n=this,o=new r.Enumerable;return o.getEnumerator=function(){return function(e,t){var n,o,u={current:void 0,moveNext:function(){for(u.current=void 0,n||(n=e.getEnumerator());!o||!o.moveNext();){if(!n.moveNext())return!1;o=r.selectorEnumerator(t(n.current))}return u.current=o.current,!0}};return u}(n,e)},o},r.List&&(r.List.prototype.select=r.Enumerable.prototype.select,r.List.prototype.selectMany=r.Enumerable.prototype.selectMany)}(exjs||(exjs={})),(exjs||(exjs={})).selectorEnumerator=function(r){return Array.isArray(r)?r.en().getEnumerator():null!=r&&"function"==typeof r.getEnumerator?r.getEnumerator():null},function(r){r.Enumerable.prototype.skip=function(t){var n=this,o=new r.Enumerable;return o.getEnumerator=function(){return function(r,e){var t,n={current:void 0,moveNext:function(){if(!t){t=r.getEnumerator();for(var o=0;o<e;o++)if(!t.moveNext())return!1}return t.moveNext()?(n.current=t.current,!0):(n.current=void 0,!1)}};return n}(n,t)},o},r.Enumerable.prototype.skipWhile=function(e){var n=this,o=new r.Enumerable;return o.getEnumerator=function(){return function(r,e){var t,n={current:void 0,moveNext:function(){if(!t){t=r.getEnumerator();for(var o=0;t.moveNext();o++)if(!e(n.current=t.current,o))return!0;return n.current=void 0,!1}return t.moveNext()?(n.current=t.current,!0):(n.current=void 0,!1)}};return n}(n,e)},o},r.List&&(r.List.prototype.skip=r.Enumerable.prototype.skip,r.List.prototype.skipWhile=r.Enumerable.prototype.skipWhile)}(exjs||(exjs={})),function(r){r.Enumerable.prototype.take=function(t){var n=this,o=new r.Enumerable;return o.getEnumerator=function(){return function(r,e){var t,n=0,o={current:void 0,moveNext:function(){return t||(t=r.getEnumerator()),!(++n>e||(o.current=void 0,!t.moveNext()||(o.current=t.current,0)))}};return o}(n,t)},o},r.Enumerable.prototype.takeWhile=function(e){var n=this,o=new r.Enumerable;return o.getEnumerator=function(){return function(r,e){var t,n=0,o={current:void 0,moveNext:function(){return t||(t=r.getEnumerator()),t.moveNext()&&e(t.current,n)?(n++,o.current=t.current,!0):(o.current=void 0,!1)}};return o}(n,e)},o},r.List&&(r.List.prototype.take=r.Enumerable.prototype.take,r.List.prototype.takeWhile=r.Enumerable.prototype.takeWhile)}(exjs||(exjs={})),function(r){function t(e,t,n){var o,u=!1,i=[],c={current:void 0,moveNext:function(){if(u){if(null==o)return!1;i.push(o),o=r.selectorEnumerator(t(c.current))}else o=e.getEnumerator(),u=!0;do{for(;!(o&&o.moveNext()||i.length<1);)o=i.pop();c.current=null==o?void 0:o.current}while(n(c.current));return void 0!==c.current}};return c}r.Enumerable.prototype.traverse=function(t){var n=this,o=new r.Enumerable;return o.getEnumerator=function(){return function(e,t){var n,o=!1,u=[],i={current:void 0,moveNext:function(){if(o){if(null==n)return!1;u.push(n),n=r.selectorEnumerator(t(i.current))}else n=e.getEnumerator(),o=!0;for(;!(n&&n.moveNext()||u.length<1);)n=u.pop();return i.current=null==n?void 0:n.current,void 0!==i.current}};return i}(n,t)},o},r.Enumerable.prototype.traverseUnique=function(e,n){var o=this,u=[],i=new r.Enumerable;return i.getEnumerator=n?function(){return t(o,e,(function(r){return!!u.some((function(e){return n(r,e)}))||(u.push(r),!1)}))}:function(){return t(o,e,(function(r){return u.indexOf(r)>-1||(u.push(r),!1)}))},i},r.List&&(r.List.prototype.traverse=r.Enumerable.prototype.traverse,r.List.prototype.traverseUnique=r.Enumerable.prototype.traverseUnique)}(exjs||(exjs={})),function(r){r.Enumerable.prototype.union=function(t,n){var o=this,u=t instanceof Array?t.en():t,i=new r.Enumerable;return i.getEnumerator=function(){return function(e,t,n){n=n||function(r,e){return r===e};var o,u,i=[],c={current:void 0,moveNext:function(){if(o||(o=r.en(e).distinct().getEnumerator()),c.current=void 0,!u&&o.moveNext())return i.push(c.current=o.current),!0;for(u=u||r.en(t).distinct().getEnumerator();u.moveNext();){for(var a=0,p=!1,f=i.length;a<f&&!p;a++)p=n(i[a],u.current);if(!p)return c.current=u.current,!0}return!1}};return c}(o,u,n)},i},r.List&&(r.List.prototype.union=r.Enumerable.prototype.union)}(exjs||(exjs={})),function(r){r.Enumerable.prototype.where=function(t){var n=this,o=new r.Enumerable;return o.getEnumerator=function(){return function(r,e){var t,n={current:void 0,moveNext:function(){t||(t=r.getEnumerator());for(var o;t.moveNext();)if(e(o=t.current))return n.current=o,!0;return!1}};return n}(n,t)},o},r.List&&(r.List.prototype.where=r.Enumerable.prototype.where)}(exjs||(exjs={})),function(r){r.en=function(e){var n=new r.Enumerable;return n.getEnumerator=function(){return function(r){var e=r.getEnumerator(),t={current:void 0,moveNext:void 0};return t.moveNext=function(){return e.moveNext()?(t.current=e.current,!0):(t.current=void 0,!1)},t}(e)},n}}(exjs||(exjs={}));var ex=exjs.en,exjs,_Components,KeyCodes,HTTPStatusCode,Utils;!function(r){r.Enumerable.prototype.zip=function(t,n){var o=this,u=t instanceof Array?t.en():t,i=new r.Enumerable;return i.getEnumerator=function(){return function(r,e,t){var n,o,u={current:void 0,moveNext:function(){return n||(n=r.getEnumerator()),o||(o=e.getEnumerator()),u.current=void 0,!(!n.moveNext()||!o.moveNext()||(u.current=t(n.current,o.current),0))}};return u}(o,u,n)},i},r.List&&(r.List.prototype.zip=r.Enumerable.prototype.zip)}(exjs||(exjs={})),define("lib/ex.es3.min.js",(function(){})),function(_Components){var BaseComponent=function(){function BaseComponent(options){this.options=options,this.options.data=$.extend(this.data(),options.data)}return BaseComponent.prototype._init=function(){return this._$element=$(this.options.target),this._$element.length?(this._$element.empty(),!0):(console.warn("element not found"),!1)},BaseComponent.prototype.data=function(){return{}},BaseComponent.prototype.on=function(name,callback,ctx){var e=this._e||(this._e={});(e[name]||(e[name]=[])).push({fn:callback,ctx:ctx})},BaseComponent.prototype.fire=function(name){for(var args=[],_i=1;_i<arguments.length;_i++)args[_i-1]=arguments[_i];for(var data=[].slice.call(arguments,1),evtArr=((this._e||(this._e={}))[name]||[]).slice(),i=0,len=evtArr.length;i<len;i++)evtArr[i].fn.apply(evtArr[i].ctx,data)},BaseComponent.prototype._resize=function(){},BaseComponent.prototype.set=function(data){},BaseComponent}();_Components.BaseComponent=BaseComponent}(_Components||(_Components={})),function(g){g._Components||(g._Components=_Components)}(window),define("lib/BaseComponent.js",(function(){})),function(KeyCodes){!function(KeyDown){KeyDown.Backspace=8,KeyDown.Tab=9,KeyDown.Enter=13,KeyDown.Shift=16,KeyDown.Ctrl=17,KeyDown.Alt=18,KeyDown.PauseBreak=19,KeyDown.CapsLock=20,KeyDown.Escape=27,KeyDown.Spacebar=32,KeyDown.PageUp=33,KeyDown.PageDown=34,KeyDown.End=35,KeyDown.Home=36,KeyDown.LeftArrow=37,KeyDown.UpArrow=38,KeyDown.RightArrow=39,KeyDown.DownArrow=40,KeyDown.PrintScrn=44,KeyDown.Insert=45,KeyDown.Delete=46,KeyDown.Zero=48,KeyDown.One=49,KeyDown.Two=50,KeyDown.Three=51,KeyDown.Four=52,KeyDown.Five=53,KeyDown.Six=54,KeyDown.Seven=55,KeyDown.Eight=56,KeyDown.Nine=57,KeyDown.a=65,KeyDown.b=66,KeyDown.c=67,KeyDown.d=68,KeyDown.e=69,KeyDown.f=70,KeyDown.g=71,KeyDown.h=72,KeyDown.i=73,KeyDown.j=74,KeyDown.k=75,KeyDown.l=76,KeyDown.m=77,KeyDown.n=78,KeyDown.o=79,KeyDown.p=80,KeyDown.q=81,KeyDown.r=82,KeyDown.s=83,KeyDown.t=84,KeyDown.u=85,KeyDown.v=86,KeyDown.w=87,KeyDown.x=88,KeyDown.y=89,KeyDown.z=90,KeyDown.LeftWindowKey=91,KeyDown.RightWindowKey=92,KeyDown.SelectKey=93,KeyDown.Numpad0=96,KeyDown.Numpad1=97,KeyDown.Numpad2=98,KeyDown.Numpad3=99,KeyDown.Numpad4=100,KeyDown.Numpad5=101,KeyDown.Numpad6=102,KeyDown.Numpad7=103,KeyDown.Numpad8=104,KeyDown.Numpad9=105,KeyDown.Multiply=106,KeyDown.NumpadPlus=107,KeyDown.NumpadMinus=109,KeyDown.DecimalPoint=110,KeyDown.Divide=111,KeyDown.F1=112,KeyDown.F2=113,KeyDown.F3=114,KeyDown.F4=115,KeyDown.F5=116,KeyDown.F6=117,KeyDown.F7=118,KeyDown.F8=119,KeyDown.F9=120,KeyDown.F10=121,KeyDown.F11=122,KeyDown.F12=123,KeyDown.NumLock=144,KeyDown.ScrollLock=145,KeyDown.Semicolon=186,KeyDown.Equals=187,KeyDown.Comma=188,KeyDown.LessThan=188,KeyDown.Dash=189,KeyDown.Period=190,KeyDown.GreaterThan=190,KeyDown.ForwardSlash=191,KeyDown.QuestionMark=191,KeyDown.GraveAccent=192,KeyDown.Tilde=192,KeyDown.OpenCurlyBracket=219,KeyDown.OpenSquareBracket=219,KeyDown.BackSlash=220,KeyDown.VerticalPipe=220,KeyDown.CloseCurlyBracket=221,KeyDown.CloseSquareBracket=221,KeyDown.Quote=222,KeyDown.CommandFF=224}(KeyCodes.KeyDown||(KeyCodes.KeyDown={}))}(KeyCodes||(KeyCodes={})),function(KeyCodes){!function(KeyPress){KeyPress.Backspace=8,KeyPress.Enter=13,KeyPress.Spacebar=32,KeyPress.Hash=35,KeyPress.GraveAccent=39,KeyPress.DoubleQuote=34,KeyPress.Asterisk=42,KeyPress.Plus=43,KeyPress.Comma=44,KeyPress.Minus=45,KeyPress.Period=46,KeyPress.ForwardSlash=47,KeyPress.Zero=48,KeyPress.One=49,KeyPress.Two=50,KeyPress.Three=51,KeyPress.Four=52,KeyPress.Five=53,KeyPress.Six=54,KeyPress.Seven=55,KeyPress.Eight=56,KeyPress.Nine=57,KeyPress.Colon=58,KeyPress.Semicolon=59,KeyPress.LessThan=60,KeyPress.Equals=61,KeyPress.GreaterThan=62,KeyPress.QuestionMark=63,KeyPress.At=64,KeyPress.OpenSquareBracket=91,KeyPress.BackSlash=92,KeyPress.CloseSquareBracket=93,KeyPress.a=97,KeyPress.b=98,KeyPress.c=99,KeyPress.d=100,KeyPress.e=101,KeyPress.f=102,KeyPress.g=103,KeyPress.h=104,KeyPress.i=105,KeyPress.j=106,KeyPress.k=107,KeyPress.l=108,KeyPress.m=109,KeyPress.n=110,KeyPress.o=111,KeyPress.p=112,KeyPress.q=113,KeyPress.r=114,KeyPress.s=115,KeyPress.t=116,KeyPress.u=117,KeyPress.v=118,KeyPress.w=119,KeyPress.x=120,KeyPress.y=121,KeyPress.z=122,KeyPress.OpenCurlyBracket=123,KeyPress.VerticalPipe=124,KeyPress.CloseCurlyBracket=125,KeyPress.Tilde=126}(KeyCodes.KeyPress||(KeyCodes.KeyPress={}))}(KeyCodes||(KeyCodes={})),function(g){g.KeyCodes||(g.KeyCodes=KeyCodes)}(window),define("lib/KeyCodes.js",(function(){})),function(HTTPStatusCode){HTTPStatusCode.CONTINUE=100,HTTPStatusCode.SWITCHING_PROTOCOLS=101,HTTPStatusCode.PROCESSING=102,HTTPStatusCode.OK=200,HTTPStatusCode.CREATED=201,HTTPStatusCode.ACCEPTED=202,HTTPStatusCode.NON_AUTHORITATIVE_INFORMATION=203,HTTPStatusCode.NO_CONTENT=204,HTTPStatusCode.RESET_CONTENT=205,HTTPStatusCode.PARTIAL_CONTENT=206,HTTPStatusCode.MULTI_STATUS=207,HTTPStatusCode.MULTIPLE_CHOICES=300,HTTPStatusCode.MOVED_PERMANENTLY=301,HTTPStatusCode.MOVED_TEMPORARILY=302,HTTPStatusCode.SEE_OTHER=303,HTTPStatusCode.NOT_MODIFIED=304,HTTPStatusCode.USE_PROXY=305,HTTPStatusCode.TEMPORARY_REDIRECT=307,HTTPStatusCode.BAD_REQUEST=400,HTTPStatusCode.UNAUTHORIZED=401,HTTPStatusCode.PAYMENT_REQUIRED=402,HTTPStatusCode.FORBIDDEN=403,HTTPStatusCode.NOT_FOUND=404,HTTPStatusCode.METHOD_NOT_ALLOWED=405,HTTPStatusCode.NOT_ACCEPTABLE=406,HTTPStatusCode.PROXY_AUTHENTICATION_REQUIRED=407,HTTPStatusCode.REQUEST_TIME_OUT=408,HTTPStatusCode.CONFLICT=409,HTTPStatusCode.GONE=410,HTTPStatusCode.LENGTH_REQUIRED=411,HTTPStatusCode.PRECONDITION_FAILED=412,HTTPStatusCode.REQUEST_ENTITY_TOO_LARGE=413,HTTPStatusCode.REQUEST_URI_TOO_LARGE=414,HTTPStatusCode.UNSUPPORTED_MEDIA_TYPE=415,HTTPStatusCode.REQUESTED_RANGE_NOT_SATISFIABLE=416,HTTPStatusCode.EXPECTATION_FAILED=417,HTTPStatusCode.IM_A_TEAPOT=418,HTTPStatusCode.UNPROCESSABLE_ENTITY=422,HTTPStatusCode.LOCKED=423,HTTPStatusCode.FAILED_DEPENDENCY=424,HTTPStatusCode.UNORDERED_COLLECTION=425,HTTPStatusCode.UPGRADE_REQUIRED=426,HTTPStatusCode.PRECONDITION_REQUIRED=428,HTTPStatusCode.TOO_MANY_REQUESTS=429,HTTPStatusCode.REQUEST_HEADER_FIELDS_TOO_LARGE=431,HTTPStatusCode.INTERNAL_SERVER_ERROR=500,HTTPStatusCode.NOT_IMPLEMENTED=501,HTTPStatusCode.BAD_GATEWAY=502,HTTPStatusCode.SERVICE_UNAVAILABLE=503,HTTPStatusCode.GATEWAY_TIME_OUT=504,HTTPStatusCode.HTTP_VERSION_NOT_SUPPORTED=505,HTTPStatusCode.VARIANT_ALSO_NEGOTIATES=506,HTTPStatusCode.INSUFFICIENT_STORAGE=507,HTTPStatusCode.BANDWIDTH_LIMIT_EXCEEDED=509,HTTPStatusCode.NOT_EXTENDED=510,HTTPStatusCode.NETWORK_AUTHENTICATION_REQUIRED=511}(HTTPStatusCode||(HTTPStatusCode={})),function(g){g.HTTPStatusCode||(g.HTTPStatusCode=HTTPStatusCode)}(window),define("lib/HTTPStatusCode.js",(function(){})),function($){$.fn.checkboxButton=function(onClick){return this.each((function(){$(this).on("click",(function(e){var tagName=e.target.tagName,$checkbox=$(this).find(":checkbox");"INPUT"!==tagName&&(e.preventDefault(),$checkbox.prop("checked",!$checkbox.prop("checked")));var checked=$checkbox.is(":checked");onClick.call(this,checked)}))}))},$.fn.disable=function(){return this.each((function(){var $this=$(this);$this.addClass("disabled"),$this.data("tabindex",$this.attr("tabindex")),$this.removeAttr("tabindex")}))},$.fn.ellipsis=function(chars){return this.each((function(){var $self=$(this),text=$self.text();if(text.length>chars){var trimmedText=text.substr(0,chars);trimmedText=trimmedText.substr(0,Math.min(trimmedText.length,trimmedText.lastIndexOf(" "))),$self.empty().html(trimmedText+"&hellip;")}}))},$.fn.ellipsisFill=function(text){var textPassed=!0;return text||(textPassed=!1),this.each((function(){var $self=$(this);textPassed||(text=$self.text()),$self.empty();var $spanElem=$('<span title="'+text+'"></span>');if($self.append($spanElem),$self.css("overflow","hidden"),$spanElem.css("white-space","nowrap"),$spanElem.html(text),$spanElem.width()>$self.width())for(var lastText=null;$spanElem.width()>$self.width();){var t=$spanElem.html();if((t=t.substring(0,t.lastIndexOf(" "))+"&hellip;")===lastText)break;$spanElem.html(t),lastText=t}}))},$.fn.ellipsisHtmlFixed=function(chars,cb){return this.each((function(){var $self=$(this),expandedText=$self.html(),$trunc=$("<span></span>");if($trunc.html($self.html().replace(/\s[\s]*/g," ").trim()),!($trunc.text().trim().length<=chars)){for(;$trunc.text().trim().length>chars;)$trunc.removeLastWord(chars);var collapsedText=$trunc.html(),expanded=!1;$self.toggle=function(){$self.empty();var $toggleButton=$('<a href="#" class="toggle"></a>');expanded?($self.html(expandedText+" "),$toggleButton.text("less"),$toggleButton.switchClass("less","more")):($self.html(collapsedText+"&hellip; "),$toggleButton.text("more"),$toggleButton.switchClass("more","less")),$toggleButton.one("click",(function(e){e.preventDefault(),$self.toggle()})),expanded=!expanded,$self.append($toggleButton),cb&&cb()},$self.toggle()}}))},$.fn.enable=function(){return this.each((function(){var $self=$(this);$self.removeClass("disabled"),$self.attr("tabindex",$self.data("tabindex"))}))},$.fn.equaliseHeight=function(reset,average){var maxHeight=-1,minHeight=Number.MAX_VALUE,heights=[];reset&&this.each((function(){$(this).height("auto")})),this.each((function(){var currentHeight=$(this).height();heights.push(currentHeight),maxHeight=maxHeight>currentHeight?maxHeight:currentHeight,minHeight=minHeight<currentHeight?minHeight:currentHeight}));var finalHeight=maxHeight;if(average){heights.sort((function(a,b){return a-b}));var half=Math.floor(heights.length/2);finalHeight=heights.length%2?heights[half]:(heights[half-1]+heights[half])/2}return this.each((function(){$(this).height(finalHeight)})),this},$.fn.getVisibleElementWithGreatestTabIndex=function(){var $self=$(this),maxTabIndex=0,$elementWithGreatestTabIndex=null;return $self.find("*:visible[tabindex]").each((function(index,el){var $el=$(el),tabIndex=parseInt($el.attr("tabindex"));tabIndex>maxTabIndex&&(maxTabIndex=tabIndex,$elementWithGreatestTabIndex=$el)})),$elementWithGreatestTabIndex},$.fn.horizontalMargins=function(){var $self=$(this);return parseInt($self.css("marginLeft"))+parseInt($self.css("marginRight"))},$.fn.leftMargin=function(){var $self=$(this);return parseInt($self.css("marginLeft"))},$.fn.rightMargin=function(){var $self=$(this);return parseInt($self.css("marginRight"))},$.fn.horizontalPadding=function(){var $self=$(this);return parseInt($self.css("paddingLeft"))+parseInt($self.css("paddingRight"))},$.fn.leftPadding=function(){var $self=$(this);return parseInt($self.css("paddingLeft"))},$.fn.rightPadding=function(){var $self=$(this);return parseInt($self.css("paddingRight"))},$.mlp={x:0,y:0},$((function documentHandler(){var $current=this===document?$(this):$(this).contents();$current.mousemove((function(e){jQuery.mlp={x:e.pageX,y:e.pageY}})),$current.find("iframe").on("load",documentHandler)})),$.fn.ismouseover=function(){var result=!1;return this.eq(0).each((function(){var $current=$(this).is("iframe")?$(this).contents().find("body"):$(this),offset=$current.offset();result=offset.left<=$.mlp.x&&offset.left+$current.outerWidth()>$.mlp.x&&offset.top<=$.mlp.y&&offset.top+$current.outerHeight()>$.mlp.y})),result};var timer,on=$.fn.on;$.fn.on=function(){var args=Array.apply(null,arguments),last=args[args.length-1];if(isNaN(last)||1===last&&args.pop())return on.apply(this,args);var delay=args.pop(),fn=args.pop();return args.push((function(){var self=this,params=arguments;clearTimeout(timer),timer=setTimeout((function(){fn.apply(self,params)}),delay)})),on.apply(this,args)},$.fn.onEnter=function(cb){return this.each((function(){$(this).on("keyup",(function(e){13===e.keyCode&&(e.preventDefault(),cb())}))}))},$.fn.onPressed=function(cb){return this.each((function(){var $this=$(this);$this.on("touchstart click",(function(e){e.preventDefault(),cb(e)})),$this.on("keyup",(function(e){13===e.keyCode&&(e.preventDefault(),cb(e))}))}))},$.fn.removeLastWord=function(chars,depth){return void 0===chars&&(chars=8),void 0===depth&&(depth=0),this.each((function(){var $self=$(this);if($self.contents().length>0){var $lastElement=$self.contents().last();if(3===$lastElement[0].nodeType){var words=$lastElement.text().trim().split(" ");if(words.length>1)return words.splice(words.length-1,1),void($lastElement[0].data=words.join(" "));if(void 0!==chars&&1===words.length&&words[0].length>chars)return void($lastElement[0].data=words.join(" ").substring(0,chars))}$lastElement.removeLastWord(chars,depth+1)}else depth>0&&$self.remove()}))},$.fn.switchClass=function(class1,class2){return this.each((function(){$(this).removeClass(class1).addClass(class2)}))},$.fn.targetBlank=function(){return this.each((function(){$(this).find("a").prop("target","_blank")}))},$.fn.toggleExpandText=function(chars,lessText,moreText,cb){return this.each((function(){var $self=$(this),expandedText=$self.html();if(!(chars>expandedText.length)){var expanded=!1,collapsedText=expandedText.substr(0,chars);collapsedText=collapsedText.substr(0,Math.min(collapsedText.length,collapsedText.lastIndexOf(" "))),$self.toggle=function(){$self.empty();var $toggleButton=$('<a href="#" class="toggle"></a>');expanded?($self.html(expandedText+"&nbsp;"),$toggleButton.text(lessText),$toggleButton.switchClass("less","more")):($self.html(collapsedText+"&nbsp;"),$toggleButton.text(moreText),$toggleButton.switchClass("more","less")),$toggleButton.one("click",(function(e){e.preventDefault(),$self.toggle()})),expanded=!expanded,$self.append($toggleButton),cb&&cb()},$self.toggle()}}))},$.fn.toggleExpandTextByLines=function(lines,lessText,moreText,cb){return this.each((function(){for(var $self=$(this),expandedText=$self.html(),$buttonPad=$('<span>&hellip; <a href="#" class="toggle more">morepad</a></span>'),stringsByLine=[expandedText],lastHeight=$self.height();$self.text().length>0;){$self.removeLastWord();var html=$self.html();$self.append($buttonPad),lastHeight>$self.height()&&(stringsByLine.unshift(html),lastHeight=$self.height()),$buttonPad.remove()}if(stringsByLine.length<=lines)$self.html(expandedText);else{var collapsedText=stringsByLine[lines-1],expanded=!1;$self.toggle=function(){$self.empty();var $toggleButton=$('<a href="#" class="toggle"></a>');expanded?($self.html(expandedText+" "),$toggleButton.text(lessText),$toggleButton.switchClass("less","more")):($self.html(collapsedText+"&hellip; "),$toggleButton.text(moreText),$toggleButton.switchClass("more","less")),$toggleButton.one("click",(function(e){e.preventDefault(),$self.toggle()})),expanded=!expanded,$self.append($toggleButton),cb&&cb()},$self.toggle()}}))},$.fn.toggleText=function(text1,text2){return this.each((function(){$(this).text()===text1?$(this).text(text2):$(this).text(text1)}))},$.fn.updateAttr=function(attrName,oldVal,newVal){return this.each((function(){var $self=$(this),attr=$self.attr(attrName);attr&&0===attr.indexOf(oldVal)&&(attr=attr.replace(oldVal,newVal),$self.attr(attrName,attr))}))},$.fn.verticalMargins=function(){var $self=$(this);return parseInt($self.css("marginTop"))+parseInt($self.css("marginBottom"))},$.fn.verticalPadding=function(){var $self=$(this);return parseInt($self.css("paddingTop"))+parseInt($self.css("paddingBottom"))}}(jQuery),define("lib/jquery-plugins.js",(function(){})),
/*! Tiny Pub/Sub - v0.7.0 - 2018-10-11
* https://github.com/cowboy/jquery-tiny-pubsub
* Copyright (c) 2018 "Cowboy" Ben Alman; Licensed MIT */
function($){var o=null;$.initPubSub=function(){o=$({})},$.subscribe=function(){o||$.initPubSub(),o.on.apply(o,arguments)},$.unsubscribe=function(){o||$.initPubSub(),o.off.apply(o,arguments)},$.disposePubSub=function(){o=null},$.publish=function(){o||$.initPubSub(),o.trigger.apply(o,arguments)}}(jQuery),define("lib/ba-tiny-pubsub.js",(function(){})),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("manifesto",[],t):"object"==typeof exports?exports.manifesto=t():e.manifesto=t()}("undefined"!=typeof self?self:this,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=7)}([function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(9)),n(r(10)),n(r(11)),n(r(12)),n(r(13)),n(r(14)),n(r(15)),n(r(16)),n(r(17)),n(r(31)),n(r(32)),n(r(33)),n(r(34)),n(r(35)),n(r(38)),n(r(39)),n(r(40)),n(r(41)),n(r(42)),n(r(43)),n(r(44)),n(r(45)),n(r(46)),n(r(47)),n(r(48)),n(r(49)),n(r(50)),n(r(3))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.BOOKMARKING="oa:bookmarking",e.CLASSIFYING="oa:classifying",e.COMMENTING="oa:commenting",e.DESCRIBING="oa:describing",e.EDITING="oa:editing",e.HIGHLIGHTING="oa:highlighting",e.IDENTIFYING="oa:identifying",e.LINKING="oa:linking",e.MODERATING="oa:moderating",e.PAINTING="sc:painting",e.QUESTIONING="oa:questioning",e.REPLYING="oa:replying",e.TAGGING="oa:tagging",e.TRANSCRIBING="oad:transcribing"}(t.AnnotationMotivation||(t.AnnotationMotivation={})),function(e){e.AUTO_ADVANCE="auto-advance",e.CONTINUOUS="continuous",e.FACING_PAGES="facing-pages",e.HIDDEN="hidden",e.INDIVIDUALS="individuals",e.MULTI_PART="multi-part",e.NO_NAV="no-nav",e.NON_PAGED="non-paged",e.PAGED="paged",e.REPEAT="repeat",e.SEQUENCE="sequence",e.THUMBNAIL_NAV="thumbnail-nav",e.TOGETHER="together",e.UNORDERED="unordered"}(t.Behavior||(t.Behavior={})),function(e){e.CANVAS="canvas",e.CHOICE="choice",e.OA_CHOICE="oa:choice",e.CONTENT_AS_TEXT="contentastext",e.DATASET="dataset",e.DOCUMENT="document",e.IMAGE="image",e.MODEL="model",e.MOVING_IMAGE="movingimage",e.PDF="pdf",e.PHYSICAL_OBJECT="physicalobject",e.SOUND="sound",e.TEXT="text",e.TEXTUALBODY="textualbody",e.VIDEO="video"}(t.ExternalResourceType||(t.ExternalResourceType={})),function(e){e.ANNOTATION="annotation",e.CANVAS="canvas",e.COLLECTION="collection",e.MANIFEST="manifest",e.RANGE="range",e.SEQUENCE="sequence"}(t.IIIFResourceType||(t.IIIFResourceType={})),function(e){e.AUDIO_MP4="audio/mp4",e.CORTO="application/corto",e.DICOM="application/dicom",e.DRACO="application/draco",e.EPUB="application/epub+zip",e.GLB="model/gltf-binary",e.GLTF="model/gltf+json",e.IIIF_PRESENTATION_2='application/ld+json;profile="http://iiif.io/api/presentation/2/context.json"',e.IIIF_PRESENTATION_3='application/ld+json;profile="http://iiif.io/api/presentation/3/context.json"',e.JPG="image/jpeg",e.M3U8="application/vnd.apple.mpegurl",e.MP3="audio/mp3",e.MPEG_DASH="application/dash+xml",e.OBJ="text/plain",e.OPF="application/oebps-package+xml",e.PDF="application/pdf",e.PLY="application/ply",e.THREEJS="application/vnd.threejs+json",e.USDZ="model/vnd.usd+zip",e.VIDEO_MP4="video/mp4",e.WEBM="video/webm"}(t.MediaType||(t.MediaType={})),function(e){e.DOC="application/msword",e.DOCX="application/vnd.openxmlformats-officedocument.wordprocessingml.document",e.PDF="application/pdf"}(t.RenderingFormat||(t.RenderingFormat={})),function(e){e.IMAGE_0_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0",e.IMAGE_0_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1",e.IMAGE_0_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2",e.IMAGE_0_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0",e.IMAGE_0_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1",e.IMAGE_0_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2",e.IMAGE_1_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",e.IMAGE_1_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",e.IMAGE_1_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",e.IMAGE_1_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",e.IMAGE_1_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",e.IMAGE_1_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",e.IMAGE_1_LEVEL_0="http://iiif.io/api/image/1/level0.json",e.IMAGE_1_PROFILE_LEVEL_0="http://iiif.io/api/image/1/profiles/level0.json",e.IMAGE_1_LEVEL_1="http://iiif.io/api/image/1/level1.json",e.IMAGE_1_PROFILE_LEVEL_1="http://iiif.io/api/image/1/profiles/level1.json",e.IMAGE_1_LEVEL_2="http://iiif.io/api/image/1/level2.json",e.IMAGE_1_PROFILE_LEVEL_2="http://iiif.io/api/image/1/profiles/level2.json",e.IMAGE_2_LEVEL_0="http://iiif.io/api/image/2/level0.json",e.IMAGE_2_PROFILE_LEVEL_0="http://iiif.io/api/image/2/profiles/level0.json",e.IMAGE_2_LEVEL_1="http://iiif.io/api/image/2/level1.json",e.IMAGE_2_PROFILE_LEVEL_1="http://iiif.io/api/image/2/profiles/level1.json",e.IMAGE_2_LEVEL_2="http://iiif.io/api/image/2/level2.json",e.IMAGE_2_PROFILE_LEVEL_2="http://iiif.io/api/image/2/profiles/level2.json",e.AUTH_0_CLICK_THROUGH="http://iiif.io/api/auth/0/login/clickthrough",e.AUTH_0_LOGIN="http://iiif.io/api/auth/0/login",e.AUTH_0_LOGOUT="http://iiif.io/api/auth/0/logout",e.AUTH_0_RESTRICTED="http://iiif.io/api/auth/0/login/restricted",e.AUTH_0_TOKEN="http://iiif.io/api/auth/0/token",e.AUTH_1_CLICK_THROUGH="http://iiif.io/api/auth/1/clickthrough",e.AUTH_1_EXTERNAL="http://iiif.io/api/auth/1/external",e.AUTH_1_KIOSK="http://iiif.io/api/auth/1/kiosk",e.AUTH_1_LOGIN="http://iiif.io/api/auth/1/login",e.AUTH_1_LOGOUT="http://iiif.io/api/auth/1/logout",e.AUTH_1_PROBE="http://iiif.io/api/auth/1/probe",e.AUTH_1_TOKEN="http://iiif.io/api/auth/1/token",e.SEARCH_0="http://iiif.io/api/search/0/search",e.SEARCH_0_AUTO_COMPLETE="http://iiif.io/api/search/0/autocomplete",e.SEARCH_1="http://iiif.io/api/search/1/search",e.SEARCH_1_AUTO_COMPLETE="http://iiif.io/api/search/1/autocomplete",e.TRACKING_EXTENSIONS="http://universalviewer.io/tracking-extensions-profile",e.UI_EXTENSIONS="http://universalviewer.io/ui-extensions-profile",e.PRINT_EXTENSIONS="http://universalviewer.io/print-extensions-profile",e.SHARE_EXTENSIONS="http://universalviewer.io/share-extensions-profile",e.OTHER_MANIFESTATIONS="http://iiif.io/api/otherManifestations.json",e.IXIF="http://wellcomelibrary.org/ld/ixif/0/alpha.json"}(t.ServiceProfile||(t.ServiceProfile={})),function(e){e.BOTTOM_TO_TOP="bottom-to-top",e.LEFT_TO_RIGHT="left-to-right",e.RIGHT_TO_LEFT="right-to-left",e.TOP_TO_BOTTOM="top-to-bottom"}(t.ViewingDirection||(t.ViewingDirection={})),function(e){e.CONTINUOUS="continuous",e.INDIVIDUALS="individuals",e.NON_PAGED="non-paged",e.PAGED="paged",e.TOP="top"}(t.ViewingHint||(t.ViewingHint={}))},function(e,t,r){var n=r(21).Symbol;e.exports=n},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),a=r(1),s=r(36);r(37);var u=function(){function e(){}return e.getMediaType=function(e){return(e=(e=e.toLowerCase()).split(";")[0]).trim()},e.getImageQuality=function(e){return e===a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1||e===a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2||e===a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_1||e===a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2||e===a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1||e===a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2||e===a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1||e===a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2||e===a.ServiceProfile.IMAGE_1_LEVEL_1||e===a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1||e===a.ServiceProfile.IMAGE_1_LEVEL_2||e===a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2?"native":"default"},e.getInexactLocale=function(e){return-1!==e.indexOf("-")?e.substr(0,e.indexOf("-")):e},e.getLocalisedValue=function(e,t){if(!Array.isArray(e))return e;for(var r=0;r<e.length;r++){var n=e[r];if(t===n["@language"])return n["@value"]}var i=t.substr(0,t.indexOf("-"));for(r=0;r<e.length;r++){var o=e[r];if(o["@language"]===i)return o["@value"]}return null},e.generateTreeNodeIds=function(t,r){var n;void 0===r&&(r=0),n=t.parentNode?t.parentNode.id+"-"+r:"0",t.id=n;for(var i=0;i<t.nodes.length;i++){var o=t.nodes[i];e.generateTreeNodeIds(o,i)}},e.normaliseType=function(e){return-1!==(e=(e||"").toLowerCase()).indexOf(":")?e.split(":")[1]:e},e.normaliseUrl=function(e){return-1!==(e=e.substr(e.indexOf("://"))).indexOf("#")&&(e=e.split("#")[0]),e},e.normalisedUrlsMatch=function(t,r){return e.normaliseUrl(t)===e.normaliseUrl(r)},e.isImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_PROFILE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_PROFILE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_PROFILE_LEVEL_2))},e.isLevel0ImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_PROFILE_LEVEL_0))},e.isLevel1ImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_PROFILE_LEVEL_1))},e.isLevel2ImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_PROFILE_LEVEL_2))},e.parseManifest=function(e,t){return o.Deserialiser.parse(e,t)},e.checkStatus=function(e){if(e.ok)return e;var t=new Error(e.statusText);return t.response=e,Promise.reject(t)},e.loadManifest=function(t){return new Promise((function(r,n){fetch(t).then(e.checkStatus).then((function(e){return e.json()})).then((function(e){r(e)})).catch((function(e){n()}))}))},e.loadExternalResourcesAuth1=function(t,r,n,i,o,a,s,u){return new Promise((function(c,l){var p=t.map((function(t){return e.loadExternalResourceAuth1(t,r,n,i,o,a,s,u)}));Promise.all(p).then((function(){c(t)})).catch((function(e){l(e)}))}))},e.loadExternalResourceAuth1=function(t,r,o,a,u,c,l,p){return n(this,void 0,void 0,(function(){var n;return i(this,(function(i){switch(i.label){case 0:return[4,a(t)];case 1:return(n=i.sent())?[4,t.getData(n)]:[3,6];case 2:return i.sent(),t.status!==s.OK?[3,3]:[2,t];case 3:return[4,e.doAuthChain(t,r,o,u,c,l,p)];case 4:i.sent(),i.label=5;case 5:if(t.status===s.OK||t.status===s.MOVED_TEMPORARILY)return[2,t];throw e.createAuthorizationFailedError();case 6:return[4,t.getData()];case 7:return i.sent(),t.status!==s.MOVED_TEMPORARILY&&t.status!==s.UNAUTHORIZED?[3,9]:[4,e.doAuthChain(t,r,o,u,c,l,p)];case 8:i.sent(),i.label=9;case 9:if(t.status===s.OK||t.status===s.MOVED_TEMPORARILY)return[2,t];throw e.createAuthorizationFailedError()}}))}))},e.doAuthChain=function(t,r,o,a,u,c,l){return n(this,void 0,void 0,(function(){var n,p,f,h,_,g,d,v;return i(this,(function(i){switch(i.label){case 0:return t.isAccessControlled()?((n=t.externalService)&&(n.options=t.options),(p=t.kioskService)&&(p.options=t.options),(f=t.clickThroughService)&&(f.options=t.options),(h=t.loginService)&&(h.options=t.options),t.isResponseHandled||t.status!==s.MOVED_TEMPORARILY?[3,2]:[4,c(t)]):[2,t];case 1:case 3:case 6:case 10:case 14:return i.sent(),[2,t];case 2:return _=null,g=null,(_=n)?(g=_,[4,e.attemptResourceWithToken(t,o,_)]):[3,4];case 4:return(_=p)?(g=_,(d=r(_))?[4,a(d)]:[3,7]):[3,7];case 5:case 9:case 13:return i.sent(),[4,e.attemptResourceWithToken(t,o,_)];case 7:return(_=f)?(g=_,[4,u(t,_)]):[3,11];case 8:return(v=i.sent())?[4,a(v)]:[3,11];case 11:return(_=h)?(g=_,[4,u(t,_)]):[3,15];case 12:return(v=i.sent())?[4,a(v)]:[3,15];case 15:return g&&l(t,g),[2]}}))}))},e.attemptResourceWithToken=function(e,t,r){return n(this,void 0,void 0,(function(){var n,o;return i(this,(function(i){switch(i.label){case 0:return(n=r.getService(a.ServiceProfile.AUTH_1_TOKEN))?[4,t(e,n)]:[3,3];case 1:return(o=i.sent())&&o.accessToken?[4,e.getData(o)]:[3,3];case 2:return i.sent(),[2,e];case 3:return[2]}}))}))},e.loadExternalResourcesAuth09=function(t,r,n,i,o,a,s,u,c,l){return new Promise((function(p,f){var h=t.map((function(t){return e.loadExternalResourceAuth09(t,r,n,i,o,a,s,u,c,l)}));Promise.all(h).then((function(){p(t)})).catch((function(e){f(e)}))}))},e.loadExternalResourceAuth09=function(t,r,n,i,o,a,u,c,l,p){return new Promise((function(f,h){p&&p.pessimisticAccessControl?t.getData().then((function(){t.isAccessControlled()?t.clickThroughService?(f(n(t)),f(i(t))):o(t).then((function(){a(t,!0).then((function(r){t.getData(r).then((function(){f(l(t))})).catch((function(t){h(e.createInternalServerError(t))}))})).catch((function(t){h(e.createInternalServerError(t))}))})).catch((function(t){h(e.createInternalServerError(t))})):f(t)})).catch((function(t){h(e.createInternalServerError(t))})):c(t,r).then((function(p){p?t.getData(p).then((function(){t.status===s.OK?f(l(t)):e.authorize(t,r,n,i,o,a,u,c).then((function(){f(l(t))})).catch((function(t){h(e.createAuthorizationFailedError())}))})).catch((function(t){h(e.createAuthorizationFailedError())})):e.authorize(t,r,n,i,o,a,u,c).then((function(){f(l(t))})).catch((function(t){h(e.createAuthorizationFailedError())}))})).catch((function(t){h(e.createAuthorizationFailedError())}))}))},e.createError=function(e,t){var r=new Error;return r.message=t,r.name=String(e),r},e.createAuthorizationFailedError=function(){return e.createError(o.StatusCode.AUTHORIZATION_FAILED,"Authorization failed")},e.createRestrictedError=function(){return e.createError(o.StatusCode.RESTRICTED,"Restricted")},e.createInternalServerError=function(t){return e.createError(o.StatusCode.INTERNAL_SERVER_ERROR,t)},e.authorize=function(t,r,n,i,o,a,u,c){return new Promise((function(l,p){t.getData().then((function(){t.isAccessControlled()?c(t,r).then((function(c){c?t.getData(c).then((function(){t.status===s.OK?l(t):e.showAuthInteraction(t,r,n,i,o,a,u,l,p)})).catch((function(t){p(e.createInternalServerError(t))})):a(t,!1).then((function(c){c?u(t,c,r).then((function(){t.getData(c).then((function(){t.status===s.OK?l(t):e.showAuthInteraction(t,r,n,i,o,a,u,l,p)})).catch((function(t){p(e.createInternalServerError(t))}))})).catch((function(t){p(e.createInternalServerError(t))})):e.showAuthInteraction(t,r,n,i,o,a,u,l,p)}))})).catch((function(t){p(e.createInternalServerError(t))})):l(t)}))}))},e.showAuthInteraction=function(t,r,n,i,o,a,u,c,l){t.status!==s.MOVED_TEMPORARILY||t.isResponseHandled?t.clickThroughService&&!t.isResponseHandled?n(t).then((function(){a(t,!0).then((function(n){u(t,n,r).then((function(){t.getData(n).then((function(){c(t)})).catch((function(t){l(e.createInternalServerError(t))}))})).catch((function(t){l(e.createInternalServerError(t))}))})).catch((function(t){l(e.createInternalServerError(t))}))})):o(t).then((function(){a(t,!0).then((function(n){u(t,n,r).then((function(){t.getData(n).then((function(){c(t)})).catch((function(t){l(e.createInternalServerError(t))}))})).catch((function(t){l(e.createInternalServerError(t))}))})).catch((function(t){l(e.createInternalServerError(t))}))})):c(t)},e.getService=function(e,t){for(var r=this.getServices(e),n=0;n<r.length;n++){var i=r[n];if(i.getProfile()===t)return i}return null},e.getResourceById=function(t,r){return e.traverseAndFind(t.__jsonld,"@id",r)},e.traverseAndFind=function(t,r,n){if(t.hasOwnProperty(r)&&t[r]===n)return t;for(var i=0;i<Object.keys(t).length;i++)if("object"==typeof t[Object.keys(t)[i]]){var o=e.traverseAndFind(t[Object.keys(t)[i]],r,n);if(null!=o)return o}},e.getServices=function(e){var t,r=[];if(!(t=e.__jsonld?e.__jsonld.service:e.service))return r;Array.isArray(t)||(t=[t]);for(var n=0;n<t.length;n++){var i=t[n];if("string"==typeof i){var a=this.getResourceById(e.options.resource,i);a&&r.push(new o.Service(a.__jsonld||a,e.options))}else r.push(new o.Service(i,e.options))}return r},e.getTemporalComponent=function(e){var t=/t=([^&]+)/g.exec(e),r=null;return t&&t[1]&&(r=t[1].split(",")),r},e}();t.Utils=u},function(e,t,r){var n=r(19),i=r(20);e.exports=function e(t,r,o,a,s){var u=-1,c=t.length;for(o||(o=i),s||(s=[]);++u<c;){var l=t[u];r>0&&o(l)?r>1?e(l,r-1,o,a,s):n(s,l):a||(s[s.length]=l)}return s}},function(e,t){e.exports=function(e){return null!=e&&"object"==typeof e}},function(e,t,r){"use strict";r.r(t),t.default=function(e,t){return t=t||{},new Promise((function(r,n){var i=new XMLHttpRequest,o=[],a=[],s={},u=function(){return{ok:2==(i.status/100|0),statusText:i.statusText,status:i.status,url:i.responseURL,text:function(){return Promise.resolve(i.responseText)},json:function(){return Promise.resolve(JSON.parse(i.responseText))},blob:function(){return Promise.resolve(new Blob([i.response]))},clone:u,headers:{keys:function(){return o},entries:function(){return a},get:function(e){return s[e.toLowerCase()]},has:function(e){return e.toLowerCase()in s}}}};for(var c in i.open(t.method||"get",e,!0),i.onload=function(){i.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,(function(e,t,r){o.push(t=t.toLowerCase()),a.push([t,r]),s[t]=s[t]?s[t]+","+r:r})),r(u())},i.onerror=n,i.withCredentials="include"==t.credentials,t.headers)i.setRequestHeader(c,t.headers[c]);i.send(t.body||null)}))}},function(e,t,r){e.exports=r(8)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r(0));var n=r(3);t.loadManifest=function(e){return n.Utils.loadManifest(e)},t.parseManifest=function(e,t){return n.Utils.parseManifest(e,t)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.__jsonld=e,this.context=this.getProperty("context"),this.id=this.getProperty("id")}return e.prototype.getProperty=function(e){var t=null;return this.__jsonld&&((t=this.__jsonld[e])||(t=this.__jsonld["@"+e])),t},e}();t.JSONLDResource=n},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),a=r(1),s=function(e){function t(t,r){var n=e.call(this,t)||this;return n.options=r,n}return i(t,e),t.prototype.getIIIFResourceType=function(){return o.Utils.normaliseType(this.getProperty("type"))},t.prototype.getLabel=function(){var e=this.getProperty("label");return e?o.PropertyValue.parse(e,this.options.locale):new o.PropertyValue([],this.options.locale)},t.prototype.getDefaultLabel=function(){return this.getLabel().getValue(this.options.locale)},t.prototype.getMetadata=function(){var e=this.getProperty("metadata"),t=[];if(!e)return t;for(var r=0;r<e.length;r++){var n=e[r],i=new o.LabelValuePair(this.options.locale);i.parse(n),t.push(i)}return t},t.prototype.getRendering=function(e){for(var t=this.getRenderings(),r=0;r<t.length;r++){var n=t[r];if(n.getFormat()===e)return n}return null},t.prototype.getRenderings=function(){var e,t=[];if(!(e=this.__jsonld?this.__jsonld.rendering:this.rendering))return t;Array.isArray(e)||(e=[e]);for(var r=0;r<e.length;r++){var n=e[r];t.push(new o.Rendering(n,this.options))}return t},t.prototype.getService=function(e){return o.Utils.getService(this,e)},t.prototype.getServices=function(){return o.Utils.getServices(this)},t.prototype.getThumbnail=function(){var e=this.getProperty("thumbnail");return Array.isArray(e)&&(e=e[0]),e?new o.Thumbnail(e,this.options):null},t.prototype.isAnnotation=function(){return this.getIIIFResourceType()===a.IIIFResourceType.ANNOTATION},t.prototype.isCanvas=function(){return this.getIIIFResourceType()===a.IIIFResourceType.CANVAS},t.prototype.isCollection=function(){return this.getIIIFResourceType()===a.IIIFResourceType.COLLECTION},t.prototype.isManifest=function(){return this.getIIIFResourceType()===a.IIIFResourceType.MANIFEST},t.prototype.isRange=function(){return this.getIIIFResourceType()===a.IIIFResourceType.RANGE},t.prototype.isSequence=function(){return this.getIIIFResourceType()===a.IIIFResourceType.SEQUENCE},t}(o.JSONLDResource);t.ManifestResource=s},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),a=function(e){function t(t,r){return e.call(this,t,r)||this}return i(t,e),t.prototype.getFormat=function(){var e=this.getProperty("format");return e?e.toLowerCase():null},t.prototype.getResources=function(){var e=[];if(!this.__jsonld.resources)return e;for(var t=0;t<this.__jsonld.resources.length;t++){var r=this.__jsonld.resources[t],n=new o.Annotation(r,this.options);e.push(n)}return e},t.prototype.getType=function(){var e=this.getProperty("type");return e?o.Utils.normaliseType(e):null},t.prototype.getWidth=function(){return this.getProperty("width")},t.prototype.getHeight=function(){return this.getProperty("height")},t.prototype.getMaxWidth=function(){return this.getProperty("maxWidth")},t.prototype.getMaxHeight=function(){return this.getProperty("maxHeight")?null:this.getMaxWidth()},t}(o.ManifestResource);t.Resource=a},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),a=r(1),s=function(e){function t(t,r){var n=e.call(this,t,r)||this;n.index=-1,n.isLoaded=!1;var i={defaultLabel:"-",locale:"en-GB",resource:n,pessimisticAccessControl:!1};return n.options=Object.assign(i,r),n}return i(t,e),t.prototype.getAttribution=function(){var e=this.getProperty("attribution");return e?o.PropertyValue.parse(e,this.options.locale):new o.PropertyValue([],this.options.locale)},t.prototype.getDescription=function(){var e=this.getProperty("description");return e?o.PropertyValue.parse(e,this.options.locale):new o.PropertyValue([],this.options.locale)},t.prototype.getHomepage=function(){var e=this.getProperty("homepage");return e?"string"==typeof e?e:(Array.isArray(e)&&e.length&&(e=e[0]),e["@id"]||e.id):null},t.prototype.getIIIFResourceType=function(){return o.Utils.normaliseType(this.getProperty("type"))},t.prototype.getLogo=function(){var e=this.getProperty("logo");return e?"string"==typeof e?e:(Array.isArray(e)&&e.length&&(e=e[0]),e["@id"]||e.id):null},t.prototype.getLicense=function(){return o.Utils.getLocalisedValue(this.getProperty("license"),this.options.locale)},t.prototype.getNavDate=function(){return new Date(this.getProperty("navDate"))},t.prototype.getRelated=function(){return this.getProperty("related")},t.prototype.getSeeAlso=function(){return this.getProperty("seeAlso")},t.prototype.getTrackingLabel=function(){var e=this.getService(a.ServiceProfile.TRACKING_EXTENSIONS);return e?e.getProperty("trackingLabel"):""},t.prototype.getDefaultTree=function(){return this.defaultTree=new o.TreeNode("root"),this.defaultTree.data=this,this.defaultTree},t.prototype.getRequiredStatement=function(){var e=null,t=this.getProperty("requiredStatement");if(t)(e=new o.LabelValuePair(this.options.locale)).parse(t);else{var r=this.getAttribution();r&&((e=new o.LabelValuePair(this.options.locale)).value=r)}return e},t.prototype.isCollection=function(){return this.getIIIFResourceType()===a.IIIFResourceType.COLLECTION},t.prototype.isManifest=function(){return this.getIIIFResourceType()===a.IIIFResourceType.MANIFEST},t.prototype.load=function(){var e=this;return new Promise((function(t){if(e.isLoaded)t(e);else{var r=e.options;r.navDate=e.getNavDate();var n=e.__jsonld.id;n||(n=e.__jsonld["@id"]),o.Utils.loadManifest(n).then((function(n){e.parentLabel=e.getLabel().getValue(r.locale);var i=o.Deserialiser.parse(n,r);(e=Object.assign(e,i)).index=r.index,t(e)}))}}))},t}(o.ManifestResource);t.IIIFResource=s},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),a=function(e){function t(t,r){return e.call(this,t,r)||this}return i(t,e),t.prototype.getBody=function(){var e=[],t=this.getProperty("body");if(t)if(Array.isArray(t))for(var r=0;r<t.length;r++)if((a=t[r]).items)for(var n=0;n<a.items.length;n++){var i=a.items[n];e.push(new o.AnnotationBody(i,this.options))}else e.push(new o.AnnotationBody(a,this.options));else if(t.items)for(r=0;r<t.items.length;r++){var a=t.items[r];e.push(new o.AnnotationBody(a,this.options))}else e.push(new o.AnnotationBody(t,this.options));return e},t.prototype.getMotivation=function(){return this.getProperty("motivation")||null},t.prototype.getOn=function(){return this.getProperty("on")},t.prototype.getTarget=function(){return this.getProperty("target")},t.prototype.getResource=function(){return new o.Resource(this.getProperty("resource"),this.options)},t}(o.ManifestResource);t.Annotation=a},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),a=function(e){function t(t,r){return e.call(this,t,r)||this}return i(t,e),t.prototype.getFormat=function(){var e=this.getProperty("format");return e?o.Utils.getMediaType(e):null},t.prototype.getType=function(){return this.getProperty("type")?o.Utils.normaliseType(this.getProperty("type")):null},t.prototype.getWidth=function(){return this.getProperty("width")},t.prototype.getHeight=function(){return this.getProperty("height")},t}(o.ManifestResource);t.AnnotationBody=a},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),a=function(e){function t(t,r,n){var i=e.call(this,r)||this;return i.label=t,i.options=n,i}return i(t,e),t.prototype.getIIIFResourceType=function(){return o.Utils.normaliseType(this.getProperty("type"))},t.prototype.getLabel=function(){return this.label},t.prototype.getResources=function(){var e=this;return this.getProperty("resources").map((function(t){return new o.Annotation(t,e.options)}))},t.prototype.load=function(){var e=this;return new Promise((function(t,r){if(e.isLoaded)t(e);else{var n=e.__jsonld.id;n||(n=e.__jsonld["@id"]),o.Utils.loadManifest(n).then((function(r){e.__jsonld=r,e.context=e.getProperty("context"),e.id=e.getProperty("id"),e.isLoaded=!0,t(e)})).catch(r)}}))},t}(o.JSONLDResource);t.AnnotationList=a},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,r){return e.call(this,t,r)||this}return i(t,e),t.prototype.getItems=function(){return this.getProperty("items")},t}(r(0).ManifestResource);t.AnnotationPage=o},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),a=r(0),s=r(18),u=r(30),c=function(e){function t(t,r){return e.call(this,t,r)||this}return i(t,e),t.prototype.getCanonicalImageUri=function(e){var t,r=null,n="default",i=e;if(this.externalResource&&this.externalResource.data&&this.externalResource.data["@id"])r=this.externalResource.data["@id"],i||(i=this.externalResource.data.width),this.externalResource.data["@context"]&&(this.externalResource.data["@context"].indexOf("/1.0/context.json")>-1||this.externalResource.data["@context"].indexOf("/1.1/context.json")>-1||this.externalResource.data["@context"].indexOf("/1/context.json")>-1)&&(n="native");else{var o=this.getImages();if(o&&o.length){var s=o[0].getResource(),u=s.getServices();if(i||(i=s.getWidth()),u.length){var c=u[0];r=c.id,n=a.Utils.getImageQuality(c.getProfile())}else if(i===s.getWidth())return s.id}if(!r){var l=this.getProperty("thumbnail");if(l){if("string"==typeof l)return l;if(l["@id"])return l["@id"];if(l.length)return l[0].id}}}return t=i+",",r&&r.endsWith("/")&&(r=r.substr(0,r.length-1)),[r,"full",t,0,n+".jpg"].join("/")},t.prototype.getMaxDimensions=function(){var e,t=null;return this.externalResource&&this.externalResource.data&&this.externalResource.data.profile&&(e=this.externalResource.data.profile,Array.isArray(e)&&(e=e.filter((function(e){return e.maxWidth}))[0])&&(t=new a.Size(e.maxWidth,e.maxHeight?e.maxHeight:e.maxWidth))),t},t.prototype.getContent=function(){var e=[],t=this.__jsonld.items||this.__jsonld.content;if(!t)return e;var r=null;if(t.length&&(r=new a.AnnotationPage(t[0],this.options)),!r)return e;for(var n=r.getItems(),i=0;i<n.length;i++){var o=n[i],s=new a.Annotation(o,this.options);e.push(s)}return e},t.prototype.getDuration=function(){return this.getProperty("duration")},t.prototype.getImages=function(){var e=[];if(!this.__jsonld.images)return e;for(var t=0;t<this.__jsonld.images.length;t++){var r=this.__jsonld.images[t],n=new a.Annotation(r,this.options);e.push(n)}return e},t.prototype.getIndex=function(){return this.getProperty("index")},t.prototype.getOtherContent=function(){var e=this,r=(Array.isArray(this.getProperty("otherContent"))?this.getProperty("otherContent"):[this.getProperty("otherContent")]).filter((function(e){return e&&("sc:AnnotationList","string"==typeof(t=e["@type"])&&t.toLowerCase()==t.toLowerCase());var t})).map((function(t,r){return new a.AnnotationList(t.label||"Annotation list "+r,t,e.options)})).map((function(e){return e.load()}));return Promise.all(r)},t.prototype.getWidth=function(){return this.getProperty("width")},t.prototype.getHeight=function(){return this.getProperty("height")},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},Object.defineProperty(t.prototype,"imageResources",{get:function(){var e=this,r=u.default([this.getImages().map((function(e){return e.getResource()})),this.getContent().map((function(e){return e.getBody()}))]);return s.default(r.map((function(r){switch(r.getProperty("type").toLowerCase()){case o.ExternalResourceType.CHOICE:case o.ExternalResourceType.OA_CHOICE:return new t({images:s.default([r.getProperty("default"),r.getProperty("item")]).map((function(e){return{resource:e}}))},e.options).getImages().map((function(e){return e.getResource()}));default:return r}})))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resourceAnnotations",{get:function(){return u.default([this.getImages(),this.getContent()])},enumerable:!0,configurable:!0}),t.prototype.resourceAnnotation=function(e){return this.resourceAnnotations.find((function(t){return t.getResource().id===e||s.default(new Array(t.getBody())).some((function(t){return t.id===e}))}))},t.prototype.onFragment=function(e){var t=this.resourceAnnotation(e);if(t){var r=t.getProperty("on"),n=t.getProperty("target"),i=(r||n).match(/xywh=(.*)$/);if(i)return i[1].split(",").map((function(e){return parseInt(e,10)}))}},Object.defineProperty(t.prototype,"iiifImageResources",{get:function(){return this.imageResources.filter((function(e){return e&&e.getServices()[0]&&e.getServices()[0].id}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageServiceIds",{get:function(){return this.iiifImageResources.map((function(e){return e.getServices()[0].id}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"aspectRatio",{get:function(){return this.getWidth()/this.getHeight()},enumerable:!0,configurable:!0}),t}(a.Resource);t.Canvas=c},function(e,t,r){var n=r(4);e.exports=function(e){return null!=e&&e.length?n(e,1):[]}},function(e,t){e.exports=function(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}},function(e,t,r){var n=r(2),i=r(24),o=r(29),a=n?n.isConcatSpreadable:void 0;e.exports=function(e){return o(e)||i(e)||!!(a&&e&&e[a])}},function(e,t,r){var n=r(22),i="object"==typeof self&&self&&self.Object===Object&&self,o=n||i||Function("return this")();e.exports=o},function(e,t,r){(function(t){var r="object"==typeof t&&t&&t.Object===Object&&t;e.exports=r}).call(this,r(23))},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){var n=r(25),i=r(5),o=Object.prototype,a=o.hasOwnProperty,s=o.propertyIsEnumerable,u=n(function(){return arguments}())?n:function(e){return i(e)&&a.call(e,"callee")&&!s.call(e,"callee")};e.exports=u},function(e,t,r){var n=r(26),i=r(5);e.exports=function(e){return i(e)&&"[object Arguments]"==n(e)}},function(e,t,r){var n=r(2),i=r(27),o=r(28),u=n?n.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":u&&u in Object(e)?i(e):o(e)}},function(e,t,r){var n=r(2),i=Object.prototype,o=i.hasOwnProperty,a=i.toString,s=n?n.toStringTag:void 0;e.exports=function(e){var t=o.call(e,s),r=e[s];try{e[s]=void 0;var n=!0}catch(e){}var i=a.call(e);return n&&(t?e[s]=r:delete e[s]),i}},function(e,t){var r=Object.prototype.toString;e.exports=function(e){return r.call(e)}},function(e,t){var r=Array.isArray;e.exports=r},function(e,t,r){var n=r(4);e.exports=function(e){return null!=e&&e.length?n(e,Infinity):[]}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),a=r(0),s=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.items=[],n._collections=null,n._manifests=null,t.__collection=n,n}return i(t,e),t.prototype.getCollections=function(){return this._collections?this._collections:this._collections=this.items.filter((function(e){return e.isCollection()}))},t.prototype.getManifests=function(){return this._manifests?this._manifests:this._manifests=this.items.filter((function(e){return e.isManifest()}))},t.prototype.getCollectionByIndex=function(e){for(var t,r=this.getCollections(),n=0;n<r.length;n++){var i=r[n];i.index===e&&(t=i)}if(t)return t.options.index=e,t.load();throw new Error("Collection index not found")},t.prototype.getManifestByIndex=function(e){for(var t,r=this.getManifests(),n=0;n<r.length;n++){var i=r[n];i.index===e&&(t=i)}if(t)return t.options.index=e,t.load();throw new Error("Manifest index not found")},t.prototype.getTotalCollections=function(){return this.getCollections().length},t.prototype.getTotalManifests=function(){return this.getManifests().length},t.prototype.getTotalItems=function(){return this.items.length},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?this.getProperty("viewingDirection"):o.ViewingDirection.LEFT_TO_RIGHT},t.prototype.getBehavior=function(){var e=this.getProperty("behavior");return Array.isArray(e)&&(e=e[0]),e||null},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t.prototype.getDefaultTree=function(){return e.prototype.getDefaultTree.call(this),this.defaultTree.data.type=a.Utils.normaliseType(a.TreeNodeType.COLLECTION),this._parseManifests(this),this._parseCollections(this),a.Utils.generateTreeNodeIds(this.defaultTree),this.defaultTree},t.prototype._parseManifests=function(e){if(e.getManifests()&&e.getManifests().length)for(var t=0;t<e.getManifests().length;t++){var r=e.getManifests()[t],n=r.getDefaultTree();n.label=r.parentLabel||r.getLabel().getValue(this.options.locale)||"manifest "+(t+1),n.navDate=r.getNavDate(),n.data.id=r.id,n.data.type=a.Utils.normaliseType(a.TreeNodeType.MANIFEST),e.defaultTree.addNode(n)}},t.prototype._parseCollections=function(e){if(e.getCollections()&&e.getCollections().length)for(var t=0;t<e.getCollections().length;t++){var r=e.getCollections()[t],n=r.getDefaultTree();n.label=r.parentLabel||r.getLabel().getValue(this.options.locale)||"collection "+(t+1),n.navDate=r.getNavDate(),n.data.id=r.id,n.data.type=a.Utils.normaliseType(a.TreeNodeType.COLLECTION),e.defaultTree.addNode(n)}},t}(a.IIIFResource);t.Collection=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.start=e,this.end=t}return e.prototype.getLength=function(){return this.end-this.start},e}();t.Duration=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=function(){function e(e){this.defaultLocale=e}return e.prototype.parse=function(e){this.resource=e,this.label=n.PropertyValue.parse(this.resource.label,this.defaultLocale),this.value=n.PropertyValue.parse(this.resource.value,this.defaultLocale)},e.prototype.getLabel=function(e){return null===this.label?null:(Array.isArray(e)&&!e.length&&(e=void 0),this.label.getValue(e||this.defaultLocale))},e.prototype.setLabel=function(e){null===this.label&&(this.label=new n.PropertyValue([])),this.label.setValue(e,this.defaultLocale)},e.prototype.getValue=function(e,t){return void 0===t&&(t="<br/>"),null===this.value?null:(Array.isArray(e)&&!e.length&&(e=void 0),this.value.getValue(e||this.defaultLocale,t))},e.prototype.getValues=function(e){return null===this.value?[]:(Array.isArray(e)&&!e.length&&(e=void 0),this.value.getValues(e||this.defaultLocale))},e.prototype.setValue=function(e){null===this.value&&(this.value=new n.PropertyValue([])),this.value.setValue(e,this.defaultLocale)},e}();t.LabelValuePair=i},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.getValue=function(e,t){return e.getValue(t,"<br/>")},t.getValues=function(e,t){return e.getValues(t)},t}(Array);t.LanguageMap=o},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<r;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)n[i]=o[a];return n};Object.defineProperty(t,"__esModule",{value:!0});var a=r(3),s=function(){function e(e,t,r){void 0===r&&(r="none"),Array.isArray(e)&&1===e.length?this._value=e[0]:this._value=e,"none"!==t&&"@none"!==t||(t=void 0),this._locale=t,this._defaultLocale=r}return e.parseV2Value=function(t,r){return"string"==typeof t?new e(t,void 0,r):t["@value"]?new e(t["@value"],t["@language"],r):null},Object.defineProperty(e.prototype,"value",{get:function(){return Array.isArray(this._value)?this._value.join("<br/>"):this._value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"locale",{get:function(){return void 0===this._locale?this._defaultLocale:this._locale},enumerable:!0,configurable:!0}),e.prototype.addValue=function(e){Array.isArray(this._value)||(this._value=[this._value]),Array.isArray(e)?this._value=this._value.concat(e):this._value.push(e)},e}();t.LocalizedValue=s;var u=function(e){function t(r,n){void 0===r&&(r=[]);var i=e.apply(this,r)||this;return i.__proto__=t.prototype,i._defaultLocale=n,i}return i(t,e),t.parse=function(e,r){if(!e)return new t([],r);if(Array.isArray(e)){var n=(i=e.map((function(e){return s.parseV2Value(e,r)})).filter((function(e){return null!==e}))).reduce((function(e,t){var r=t._locale;return r||(r="none"),e[r]?e[r].addValue(t._value):e[r]=t,e}),{});return new t(Object.values(n),r)}return"string"==typeof e?new t([new s(e,void 0,r)],r):e["@language"]?new t(null!==(i=s.parseV2Value(e))?[i]:[],r):new t(Object.keys(e).map((function(t){var n=e[t];if(!Array.isArray(n))throw new Error("A IIIF v3 localized property value must have an array as the value for a given language.");return new s(n,t,r)})),r);var i},t.prototype.getSuitableLocale=function(e){for(var t=o(this).map((function(e){return e._locale})).filter((function(e){return void 0!==e})),r=function(e){var r=t.find((function(t){return t===e}));if(r)return{value:r}},n=0,i=e;n<i.length;n++){var s=r(i[n]);if("object"==typeof s)return s.value}for(var u=function(e){var r=t.find((function(t){return a.Utils.getInexactLocale(t)===a.Utils.getInexactLocale(e)}));if(r)return{value:r}},c=0,l=e;c<l.length;c++){var p=u(l[c]);if("object"==typeof p)return p.value}},t.prototype.setValue=function(e,t){var r=void 0;if(t){var n=this.getSuitableLocale([t]);n&&(r=this.find((function(e){return e._locale===n})))}else r=this.find((function(e){return void 0===e._locale}));r?r._value=e:this.push(new s(e,t,this._defaultLocale))},t.prototype.getValue=function(e,t){var r=this.getValues(e);return 0===r.length?null:t?r.join(t):r[0]},t.prototype.getValues=function(e){if(!this.length)return[];var t;if(t=e?Array.isArray(e)?e:[e]:[],1===this.length&&void 0===this[0]._locale){var r=this[0]._value;return Array.isArray(r)?r:[r]}var n=this.getSuitableLocale(t);if(n)return r=this.find((function(e){return e._locale===n}))._value,Array.isArray(r)?r:[r];if(!this.find((function(e){return void 0===e._locale})))return r=this[0]._value,Array.isArray(r)?r:[r];var i=this.find((function(e){return void 0===e._locale}));return i?Array.isArray(i._value)?i._value:[i._value]:[]},t}(Array);t.PropertyValue=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONTINUE=100,t.SWITCHING_PROTOCOLS=101,t.PROCESSING=102,t.OK=200,t.CREATED=201,t.ACCEPTED=202,t.NON_AUTHORITATIVE_INFORMATION=203,t.NO_CONTENT=204,t.RESET_CONTENT=205,t.PARTIAL_CONTENT=206,t.MULTI_STATUS=207,t.MULTIPLE_CHOICES=300,t.MOVED_PERMANENTLY=301,t.MOVED_TEMPORARILY=302,t.SEE_OTHER=303,t.NOT_MODIFIED=304,t.USE_PROXY=305,t.TEMPORARY_REDIRECT=307,t.BAD_REQUEST=400,t.UNAUTHORIZED=401,t.PAYMENT_REQUIRED=402,t.FORBIDDEN=403,t.NOT_FOUND=404,t.METHOD_NOT_ALLOWED=405,t.NOT_ACCEPTABLE=406,t.PROXY_AUTHENTICATION_REQUIRED=407,t.REQUEST_TIME_OUT=408,t.CONFLICT=409,t.GONE=410,t.LENGTH_REQUIRED=411,t.PRECONDITION_FAILED=412,t.REQUEST_ENTITY_TOO_LARGE=413,t.REQUEST_URI_TOO_LARGE=414,t.UNSUPPORTED_MEDIA_TYPE=415,t.REQUESTED_RANGE_NOT_SATISFIABLE=416,t.EXPECTATION_FAILED=417,t.IM_A_TEAPOT=418,t.UNPROCESSABLE_ENTITY=422,t.LOCKED=423,t.FAILED_DEPENDENCY=424,t.UNORDERED_COLLECTION=425,t.UPGRADE_REQUIRED=426,t.PRECONDITION_REQUIRED=428,t.TOO_MANY_REQUESTS=429,t.REQUEST_HEADER_FIELDS_TOO_LARGE=431,t.INTERNAL_SERVER_ERROR=500,t.NOT_IMPLEMENTED=501,t.BAD_GATEWAY=502,t.SERVICE_UNAVAILABLE=503,t.GATEWAY_TIME_OUT=504,t.HTTP_VERSION_NOT_SUPPORTED=505,t.VARIANT_ALSO_NEGOTIATES=506,t.INSUFFICIENT_STORAGE=507,t.BANDWIDTH_LIMIT_EXCEEDED=509,t.NOT_EXTENDED=510,t.NETWORK_AUTHENTICATION_REQUIRED=511},function(e,t,r){e.exports=window.fetch||(window.fetch=r(6).default||r(6))},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),a=r(0),s=function(e){function t(t,r){var n=e.call(this,t,r)||this;if(n.index=0,n._allRanges=null,n.items=[],n._topRanges=[],n.__jsonld.structures&&n.__jsonld.structures.length)for(var i=n._getTopRanges(),o=0;o<i.length;o++){var a=i[o];n._parseRanges(a,String(o))}return n}return i(t,e),t.prototype.getPosterCanvas=function(){var e=this.getProperty("posterCanvas");return e&&(e=new a.Canvas(e,this.options)),e},t.prototype.getAccompanyingCanvas=function(){var e=this.getProperty("accompanyingCanvas");return e&&(e=new a.Canvas(e,this.options)),e},t.prototype.getBehavior=function(){var e=this.getProperty("behavior");return Array.isArray(e)&&(e=e[0]),e||null},t.prototype.getDefaultTree=function(){if(e.prototype.getDefaultTree.call(this),this.defaultTree.data.type=a.Utils.normaliseType(a.TreeNodeType.MANIFEST),!this.isLoaded)return this.defaultTree;var t=this.getTopRanges();return t.length&&t[0].getTree(this.defaultTree),a.Utils.generateTreeNodeIds(this.defaultTree),this.defaultTree},t.prototype._getTopRanges=function(){var e=[];if(this.__jsonld.structures&&this.__jsonld.structures.length){for(var t=0;t<this.__jsonld.structures.length;t++){var r=this.__jsonld.structures[t];r.viewingHint===o.ViewingHint.TOP&&e.push(r)}if(!e.length){var n={};n.ranges=this.__jsonld.structures,e.push(n)}}return e},t.prototype.getTopRanges=function(){return this._topRanges},t.prototype._getRangeById=function(e){if(this.__jsonld.structures&&this.__jsonld.structures.length)for(var t=0;t<this.__jsonld.structures.length;t++){var r=this.__jsonld.structures[t];if(r["@id"]===e||r.id===e)return r}return null},t.prototype._parseRanges=function(e,t,r){var n,i=null;if("string"==typeof e&&(i=e,e=this._getRangeById(i)),e){(n=new a.Range(e,this.options)).parentRange=r,n.path=t,r?r.items.push(n):this._topRanges.push(n);var o=e.items||e.members;if(o)for(var s=0;s<o.length;s++){var u=o[s];if(u["@type"]&&"sc:range"===u["@type"].toLowerCase()||u.type&&"range"===u.type.toLowerCase())this._parseRanges(u,t+"/"+s,n);else if(u["@type"]&&"sc:canvas"===u["@type"].toLowerCase()||u.type&&"canvas"===u.type.toLowerCase()){n.canvases||(n.canvases=[]);var c=u.id||u["@id"];n.canvases.push(c)}}else if(e.ranges)for(s=0;s<e.ranges.length;s++)this._parseRanges(e.ranges[s],t+"/"+s,n)}else console.warn("Range:",i,"does not exist")},t.prototype.getAllRanges=function(){if(null!=this._allRanges)return this._allRanges;this._allRanges=[];for(var e=this.getTopRanges(),t=function(t){var n=e[t];n.id&&r._allRanges.push(n);var i=function(e,t){e.add(t);var r=t.getRanges();return r.length?r.reduce(i,e):e},o=Array.from(n.getRanges().reduce(i,new Set));r._allRanges=r._allRanges.concat(o)},r=this,n=0;n<e.length;n++)t(n);return this._allRanges},t.prototype.getRangeById=function(e){for(var t=this.getAllRanges(),r=0;r<t.length;r++){var n=t[r];if(n.id===e)return n}return null},t.prototype.getRangeByPath=function(e){for(var t=this.getAllRanges(),r=0;r<t.length;r++){var n=t[r];if(n.path===e)return n}return null},t.prototype.getSequences=function(){if(this.items.length)return this.items;var e=this.__jsonld.mediaSequences||this.__jsonld.sequences;if(e)for(var t=0;t<e.length;t++){var r=e[t],n=new a.Sequence(r,this.options);this.items.push(n)}else this.__jsonld.items&&(n=new a.Sequence(this.__jsonld.items,this.options),this.items.push(n));return this.items},t.prototype.getSequenceByIndex=function(e){return this.getSequences()[e]},t.prototype.getTotalSequences=function(){return this.getSequences().length},t.prototype.getManifestType=function(){var e=this.getService(o.ServiceProfile.UI_EXTENSIONS);return e?e.getProperty("manifestType"):a.ManifestType.EMPTY},t.prototype.isMultiSequence=function(){return this.getTotalSequences()>1},t.prototype.isPagingEnabled=function(){var e=this.getViewingHint();if(e)return e===o.ViewingHint.PAGED;var t=this.getBehavior();return!!t&&t===o.Behavior.PAGED},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t}(a.IIIFResource);t.Manifest=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.EMPTY="",e.MANUSCRIPT="manuscript",e.MONOGRAPH="monograph"}(t.ManifestType||(t.ManifestType={}))},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),a=r(1),s=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n._ranges=null,n.canvases=null,n.items=[],n}return i(t,e),t.prototype.getCanvasIds=function(){return this.__jsonld.canvases?this.__jsonld.canvases:this.canvases?this.canvases:[]},t.prototype.getDuration=function(){if(this.canvases&&this.canvases.length){for(var e=[],t=[],r=0,n=this.canvases;r<n.length;r++)if(_=n[r]){var i=_.match(/(.*)#t=([0-9.]+),?([0-9.]+)?/)||[void 0,_],a=i[1],s=i[2],u=i[3];a&&(e.push(parseFloat(s)),t.push(parseFloat(u)))}if(e.length&&t.length)return new o.Duration(Math.min.apply(Math,e),Math.max.apply(Math,t))}else{e=[],t=[];for(var c=0,l=d=this.getRanges();c<l.length;c++)(v=l[c].getDuration())&&(e.push(v.start),t.push(v.end));if(e.length&&t.length)return new o.Duration(Math.min.apply(Math,e),Math.max.apply(Math,t))}var p,f;if(this.canvases&&this.canvases.length)for(var h=0;h<this.canvases.length;h++){var _=this.canvases[h],g=o.Utils.getTemporalComponent(_);g&&g.length>1&&(0===h&&(p=Number(g[0])),h===this.canvases.length-1&&(f=Number(g[1])))}else{var d=this.getRanges();for(h=0;h<d.length;h++){var v;(v=d[h].getDuration())&&(0===h&&(p=v.start),h===d.length-1&&(f=v.end))}}if(void 0!==p&&void 0!==f)return new o.Duration(p,f)},t.prototype.getRanges=function(){return this._ranges?this._ranges:this._ranges=this.items.filter((function(e){return e.isRange()}))},t.prototype.getBehavior=function(){var e=this.getProperty("behavior");return Array.isArray(e)&&(e=e[0]),e||null},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t.prototype.getTree=function(e){e.data=this,this.treeNode=e;var t=this.getRanges();if(t&&t.length)for(var r=0;r<t.length;r++){var n=t[r],i=new o.TreeNode;e.addNode(i),this._parseTreeNode(i,n)}return o.Utils.generateTreeNodeIds(e),e},t.prototype.spansTime=function(e){var t=this.getDuration();return!!(t&&e>=t.start&&e<=t.end)},t.prototype._parseTreeNode=function(e,t){e.label=t.getLabel().getValue(this.options.locale),e.data=t,e.data.type=o.Utils.normaliseType(o.TreeNodeType.RANGE),t.treeNode=e;var r=t.getRanges();if(r&&r.length)for(var n=0;n<r.length;n++){var i=r[n];if(i.getBehavior()!==a.Behavior.NO_NAV){var s=new o.TreeNode;e.addNode(s),this._parseTreeNode(s,i)}}},t}(o.ManifestResource);t.Range=s},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,r){return e.call(this,t,r)||this}return i(t,e),t.prototype.getFormat=function(){return this.getProperty("format")},t}(r(0).ManifestResource);t.Rendering=o},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),a=r(0),s=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.items=[],n._thumbnails=null,n}return i(t,e),t.prototype.getCanvases=function(){if(this.items.length)return this.items;var e=this.__jsonld.canvases||this.__jsonld.elements;if(e)for(var t=0;t<e.length;t++){var r=e[t];(n=new a.Canvas(r,this.options)).index=t,this.items.push(n)}else if(this.__jsonld)for(t=0;t<this.__jsonld.length;t++){var n;r=this.__jsonld[t],(n=new a.Canvas(r,this.options)).index=t,this.items.push(n)}return this.items},t.prototype.getCanvasById=function(e){for(var t=0;t<this.getTotalCanvases();t++){var r=this.getCanvasByIndex(t),n=a.Utils.normaliseUrl(r.id);if(a.Utils.normaliseUrl(e)===n)return r}return null},t.prototype.getCanvasByIndex=function(e){return this.getCanvases()[e]},t.prototype.getCanvasIndexById=function(e){for(var t=0;t<this.getTotalCanvases();t++)if(this.getCanvasByIndex(t).id===e)return t;return null},t.prototype.getCanvasIndexByLabel=function(e,t){e=e.trim(),isNaN(e)||(e=parseInt(e,10).toString(),t&&(e+="r"));for(var r,n,i,o=/(\d*)\D+(\d*)/,a=0;a<this.getTotalCanvases();a++){var s=this.getCanvasByIndex(a);if(s.getLabel().getValue(this.options.locale)===e)return a;if((r=o.exec(e))&&(n=r[1],(i=r[2])&&new RegExp("^"+n+"\\D+"+i+"$").test(s.getLabel().toString())))return a}return-1},t.prototype.getLastCanvasLabel=function(e){for(var t=this.getTotalCanvases()-1;t>=0;t--){var r=this.getCanvasByIndex(t).getLabel().getValue(this.options.locale);if(e){if(/^[a-zA-Z0-9]*$/.test(r))return r}else if(r)return r}return this.options.defaultLabel},t.prototype.getLastPageIndex=function(){return this.getTotalCanvases()-1},t.prototype.getNextPageIndex=function(e,t){var r;if(t){var n=this.getPagedIndices(e),i=this.getViewingDirection();r=i&&i===o.ViewingDirection.RIGHT_TO_LEFT?n[0]+1:n[n.length-1]+1}else r=e+1;return r>this.getLastPageIndex()?-1:r},t.prototype.getPagedIndices=function(e,t){var r=[];if(t){r=this.isFirstCanvas(e)||this.isLastCanvas(e)?[e]:e%2?[e,e+1]:[e-1,e];var n=this.getViewingDirection();n&&n===o.ViewingDirection.RIGHT_TO_LEFT&&(r=r.reverse())}else r.push(e);return r},t.prototype.getPrevPageIndex=function(e,t){var r;if(t){var n=this.getPagedIndices(e),i=this.getViewingDirection();r=i&&i===o.ViewingDirection.RIGHT_TO_LEFT?n[n.length-1]-1:n[0]-1}else r=e-1;return r},t.prototype.getStartCanvasIndex=function(){var e=this.getStartCanvas();if(e)for(var t=0;t<this.getTotalCanvases();t++)if(this.getCanvasByIndex(t).id===e)return t;return 0},t.prototype.getThumbs=function(e,t){for(var r=[],n=this.getTotalCanvases(),i=0;i<n;i++){var o=this.getCanvasByIndex(i),s=new a.Thumb(e,o);r.push(s)}return r},t.prototype.getThumbnails=function(){if(null!=this._thumbnails)return this._thumbnails;this._thumbnails=[];for(var e=this.getCanvases(),t=0;t<e.length;t++){var r=e[t].getThumbnail();r&&this._thumbnails.push(r)}return this._thumbnails},t.prototype.getStartCanvas=function(){return this.getProperty("startCanvas")},t.prototype.getTotalCanvases=function(){return this.getCanvases().length},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?this.getProperty("viewingDirection"):this.options.resource.getViewingDirection?this.options.resource.getViewingDirection():null},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t.prototype.isCanvasIndexOutOfRange=function(e){return e>this.getTotalCanvases()-1},t.prototype.isFirstCanvas=function(e){return 0===e},t.prototype.isLastCanvas=function(e){return e===this.getTotalCanvases()-1},t.prototype.isMultiCanvas=function(){return this.getTotalCanvases()>1},t.prototype.isPagingEnabled=function(){var e=this.getViewingHint();return!!e&&e===o.ViewingHint.PAGED},t.prototype.isTotalCanvasesEven=function(){return this.getTotalCanvases()%2==0},t}(a.ManifestResource);t.Sequence=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=function(){function e(){}return e.parse=function(e,t){return"string"==typeof e&&(e=JSON.parse(e)),this.parseJson(e,t)},e.parseJson=function(e,t){var r;if(t&&t.navDate&&!isNaN(t.navDate.getTime())&&(e.navDate=t.navDate.toString()),e["@type"])switch(e["@type"]){case"sc:Collection":r=this.parseCollection(e,t);break;case"sc:Manifest":r=this.parseManifest(e,t);break;default:return null}else switch(e.type){case"Collection":r=this.parseCollection(e,t);break;case"Manifest":r=this.parseManifest(e,t);break;default:return null}return r.isLoaded=!0,r},e.parseCollection=function(e,t){var r=new n.Collection(e,t);return t?(r.index=t.index||0,t.resource&&(r.parentCollection=t.resource.parentCollection)):r.index=0,this.parseCollections(r,t),this.parseManifests(r,t),this.parseItems(r,t),r},e.parseCollections=function(e,t){var r;if(e.__jsonld.collections?r=e.__jsonld.collections:e.__jsonld.items&&(r=e.__jsonld.items.filter((function(e){return"collection"===e.type.toLowerCase()}))),r)for(var n=0;n<r.length;n++){t&&(t.index=n);var i=this.parseCollection(r[n],t);i.index=n,i.parentCollection=e,e.items.push(i)}},e.parseManifest=function(e,t){return new n.Manifest(e,t)},e.parseManifests=function(e,t){var r;if(e.__jsonld.manifests?r=e.__jsonld.manifests:e.__jsonld.items&&(r=e.__jsonld.items.filter((function(e){return"manifest"===e.type.toLowerCase()}))),r)for(var n=0;n<r.length;n++){var i=this.parseManifest(r[n],t);i.index=n,i.parentCollection=e,e.items.push(i)}},e.parseItem=function(e,t){if(e["@type"]){if("sc:manifest"===e["@type"].toLowerCase())return this.parseManifest(e,t);if("sc:collection"===e["@type"].toLowerCase())return this.parseCollection(e,t)}else if(e.type){if("manifest"===e.type.toLowerCase())return this.parseManifest(e,t);if("collection"===e.type.toLowerCase())return this.parseCollection(e,t)}return null},e.parseItems=function(e,t){var r=e.__jsonld.members||e.__jsonld.items;if(r)for(var n=function(n){t&&(t.index=n);var o=i.parseItem(r[n],t);return o?e.items.filter((function(e){return e.id===o.id}))[0]?"continue":(o.index=n,o.parentCollection=e,void e.items.push(o)):{value:void 0}},i=this,o=0;o<r.length;o++){var a=n(o);if("object"==typeof a)return a.value}},e}();t.Deserialiser=i},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),a=function(e){function t(t,r){return e.call(this,t,r)||this}return i(t,e),t.prototype.getProfile=function(){var e=this.getProperty("profile");return e||(e=this.getProperty("dcterms:conformsTo")),Array.isArray(e)?e[0]:e},t.prototype.getConfirmLabel=function(){return o.Utils.getLocalisedValue(this.getProperty("confirmLabel"),this.options.locale)},t.prototype.getDescription=function(){return o.Utils.getLocalisedValue(this.getProperty("description"),this.options.locale)},t.prototype.getFailureDescription=function(){return o.Utils.getLocalisedValue(this.getProperty("failureDescription"),this.options.locale)},t.prototype.getFailureHeader=function(){return o.Utils.getLocalisedValue(this.getProperty("failureHeader"),this.options.locale)},t.prototype.getHeader=function(){return o.Utils.getLocalisedValue(this.getProperty("header"),this.options.locale)},t.prototype.getServiceLabel=function(){return o.Utils.getLocalisedValue(this.getProperty("label"),this.options.locale)},t.prototype.getInfoUri=function(){var e=this.id;return e.endsWith("/")||(e+="/"),e+"info.json"},t}(o.ManifestResource);t.Service=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Size=function(e,t){this.width=e,this.height=t}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.AUTHORIZATION_FAILED=1]="AUTHORIZATION_FAILED",e[e.FORBIDDEN=2]="FORBIDDEN",e[e.INTERNAL_SERVER_ERROR=3]="INTERNAL_SERVER_ERROR",e[e.RESTRICTED=4]="RESTRICTED"}(t.StatusCode||(t.StatusCode={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Thumb=function(e,t){this.data=t,this.index=t.index,this.width=e;var r=t.getHeight()/t.getWidth();this.height=r?Math.floor(this.width*r):e,this.uri=t.getCanonicalImageUri(e),this.label=t.getLabel().getValue()}},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,r){return e.call(this,t,r)||this}return i(t,e),t}(r(0).Resource);t.Thumbnail=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=function(){function e(e,t){this.label=e,this.data=t||{},this.nodes=[]}return e.prototype.addNode=function(e){this.nodes.push(e),e.parentNode=this},e.prototype.isCollection=function(){return this.data.type===n.Utils.normaliseType(n.TreeNodeType.COLLECTION)},e.prototype.isManifest=function(){return this.data.type===n.Utils.normaliseType(n.TreeNodeType.MANIFEST)},e.prototype.isRange=function(){return this.data.type===n.Utils.normaliseType(n.TreeNodeType.RANGE)},e}();t.TreeNode=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.COLLECTION="collection",e.MANIFEST="manifest",e.RANGE="range"}(t.TreeNodeType||(t.TreeNodeType={}))}])})),define("lib/manifesto.js",(function(){})),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("manifold",[],t):"object"==typeof exports?exports.manifold=t():e.manifold=t()}(window,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=15)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.BOOKMARKING="oa:bookmarking",e.CLASSIFYING="oa:classifying",e.COMMENTING="oa:commenting",e.DESCRIBING="oa:describing",e.EDITING="oa:editing",e.HIGHLIGHTING="oa:highlighting",e.IDENTIFYING="oa:identifying",e.LINKING="oa:linking",e.MODERATING="oa:moderating",e.PAINTING="sc:painting",e.QUESTIONING="oa:questioning",e.REPLYING="oa:replying",e.TAGGING="oa:tagging",e.TRANSCRIBING="oad:transcribing"}(t.AnnotationMotivation||(t.AnnotationMotivation={})),function(e){e.AUTO_ADVANCE="auto-advance",e.CONTINUOUS="continuous",e.FACING_PAGES="facing-pages",e.HIDDEN="hidden",e.INDIVIDUALS="individuals",e.MULTI_PART="multi-part",e.NO_NAV="no-nav",e.NON_PAGED="non-paged",e.PAGED="paged",e.REPEAT="repeat",e.SEQUENCE="sequence",e.THUMBNAIL_NAV="thumbnail-nav",e.TOGETHER="together",e.UNORDERED="unordered"}(t.Behavior||(t.Behavior={})),function(e){e.CANVAS="canvas",e.CHOICE="choice",e.OA_CHOICE="oa:choice",e.CONTENT_AS_TEXT="contentastext",e.DATASET="dataset",e.DOCUMENT="document",e.IMAGE="image",e.MODEL="model",e.MOVING_IMAGE="movingimage",e.PDF="pdf",e.PHYSICAL_OBJECT="physicalobject",e.SOUND="sound",e.TEXT="text",e.TEXTUALBODY="textualbody",e.VIDEO="video"}(t.ExternalResourceType||(t.ExternalResourceType={})),function(e){e.ANNOTATION="annotation",e.CANVAS="canvas",e.COLLECTION="collection",e.MANIFEST="manifest",e.RANGE="range",e.SEQUENCE="sequence"}(t.IIIFResourceType||(t.IIIFResourceType={})),function(e){e.AUDIO_MP4="audio/mp4",e.CORTO="application/corto",e.DICOM="application/dicom",e.DRACO="application/draco",e.EPUB="application/epub+zip",e.GLB="model/gltf-binary",e.GLTF="model/gltf+json",e.IIIF_PRESENTATION_2='application/ld+json;profile="http://iiif.io/api/presentation/2/context.json"',e.IIIF_PRESENTATION_3='application/ld+json;profile="http://iiif.io/api/presentation/3/context.json"',e.JPG="image/jpeg",e.M3U8="application/vnd.apple.mpegurl",e.MP3="audio/mp3",e.MPEG_DASH="application/dash+xml",e.OBJ="text/plain",e.OPF="application/oebps-package+xml",e.PDF="application/pdf",e.PLY="application/ply",e.THREEJS="application/vnd.threejs+json",e.USDZ="model/vnd.usd+zip",e.VIDEO_MP4="video/mp4",e.WEBM="video/webm"}(t.MediaType||(t.MediaType={})),function(e){e.DOC="application/msword",e.DOCX="application/vnd.openxmlformats-officedocument.wordprocessingml.document",e.PDF="application/pdf"}(t.RenderingFormat||(t.RenderingFormat={})),function(e){e.IMAGE_0_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0",e.IMAGE_0_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1",e.IMAGE_0_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2",e.IMAGE_0_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0",e.IMAGE_0_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1",e.IMAGE_0_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2",e.IMAGE_1_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",e.IMAGE_1_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",e.IMAGE_1_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",e.IMAGE_1_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",e.IMAGE_1_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",e.IMAGE_1_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",e.IMAGE_1_LEVEL_0="http://iiif.io/api/image/1/level0.json",e.IMAGE_1_PROFILE_LEVEL_0="http://iiif.io/api/image/1/profiles/level0.json",e.IMAGE_1_LEVEL_1="http://iiif.io/api/image/1/level1.json",e.IMAGE_1_PROFILE_LEVEL_1="http://iiif.io/api/image/1/profiles/level1.json",e.IMAGE_1_LEVEL_2="http://iiif.io/api/image/1/level2.json",e.IMAGE_1_PROFILE_LEVEL_2="http://iiif.io/api/image/1/profiles/level2.json",e.IMAGE_2_LEVEL_0="http://iiif.io/api/image/2/level0.json",e.IMAGE_2_PROFILE_LEVEL_0="http://iiif.io/api/image/2/profiles/level0.json",e.IMAGE_2_LEVEL_1="http://iiif.io/api/image/2/level1.json",e.IMAGE_2_PROFILE_LEVEL_1="http://iiif.io/api/image/2/profiles/level1.json",e.IMAGE_2_LEVEL_2="http://iiif.io/api/image/2/level2.json",e.IMAGE_2_PROFILE_LEVEL_2="http://iiif.io/api/image/2/profiles/level2.json",e.AUTH_0_CLICK_THROUGH="http://iiif.io/api/auth/0/login/clickthrough",e.AUTH_0_LOGIN="http://iiif.io/api/auth/0/login",e.AUTH_0_LOGOUT="http://iiif.io/api/auth/0/logout",e.AUTH_0_RESTRICTED="http://iiif.io/api/auth/0/login/restricted",e.AUTH_0_TOKEN="http://iiif.io/api/auth/0/token",e.AUTH_1_CLICK_THROUGH="http://iiif.io/api/auth/1/clickthrough",e.AUTH_1_EXTERNAL="http://iiif.io/api/auth/1/external",e.AUTH_1_KIOSK="http://iiif.io/api/auth/1/kiosk",e.AUTH_1_LOGIN="http://iiif.io/api/auth/1/login",e.AUTH_1_LOGOUT="http://iiif.io/api/auth/1/logout",e.AUTH_1_PROBE="http://iiif.io/api/auth/1/probe",e.AUTH_1_TOKEN="http://iiif.io/api/auth/1/token",e.SEARCH_0="http://iiif.io/api/search/0/search",e.SEARCH_0_AUTO_COMPLETE="http://iiif.io/api/search/0/autocomplete",e.SEARCH_1="http://iiif.io/api/search/1/search",e.SEARCH_1_AUTO_COMPLETE="http://iiif.io/api/search/1/autocomplete",e.TRACKING_EXTENSIONS="http://universalviewer.io/tracking-extensions-profile",e.UI_EXTENSIONS="http://universalviewer.io/ui-extensions-profile",e.PRINT_EXTENSIONS="http://universalviewer.io/print-extensions-profile",e.SHARE_EXTENSIONS="http://universalviewer.io/share-extensions-profile",e.OTHER_MANIFESTATIONS="http://iiif.io/api/otherManifestations.json",e.IXIF="http://wellcomelibrary.org/ld/ixif/0/alpha.json"}(t.ServiceProfile||(t.ServiceProfile={})),function(e){e.BOTTOM_TO_TOP="bottom-to-top",e.LEFT_TO_RIGHT="left-to-right",e.RIGHT_TO_LEFT="right-to-left",e.TOP_TO_BOTTOM="top-to-bottom"}(t.ViewingDirection||(t.ViewingDirection={})),function(e){e.CONTINUOUS="continuous",e.INDIVIDUALS="individuals",e.NON_PAGED="non-paged",e.PAGED="paged",e.TOP="top"}(t.ViewingHint||(t.ViewingHint={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONTINUE=100,t.SWITCHING_PROTOCOLS=101,t.PROCESSING=102,t.OK=200,t.CREATED=201,t.ACCEPTED=202,t.NON_AUTHORITATIVE_INFORMATION=203,t.NO_CONTENT=204,t.RESET_CONTENT=205,t.PARTIAL_CONTENT=206,t.MULTI_STATUS=207,t.MULTIPLE_CHOICES=300,t.MOVED_PERMANENTLY=301,t.MOVED_TEMPORARILY=302,t.SEE_OTHER=303,t.NOT_MODIFIED=304,t.USE_PROXY=305,t.TEMPORARY_REDIRECT=307,t.BAD_REQUEST=400,t.UNAUTHORIZED=401,t.PAYMENT_REQUIRED=402,t.FORBIDDEN=403,t.NOT_FOUND=404,t.METHOD_NOT_ALLOWED=405,t.NOT_ACCEPTABLE=406,t.PROXY_AUTHENTICATION_REQUIRED=407,t.REQUEST_TIME_OUT=408,t.CONFLICT=409,t.GONE=410,t.LENGTH_REQUIRED=411,t.PRECONDITION_FAILED=412,t.REQUEST_ENTITY_TOO_LARGE=413,t.REQUEST_URI_TOO_LARGE=414,t.UNSUPPORTED_MEDIA_TYPE=415,t.REQUESTED_RANGE_NOT_SATISFIABLE=416,t.EXPECTATION_FAILED=417,t.IM_A_TEAPOT=418,t.UNPROCESSABLE_ENTITY=422,t.LOCKED=423,t.FAILED_DEPENDENCY=424,t.UNORDERED_COLLECTION=425,t.UPGRADE_REQUIRED=426,t.PRECONDITION_REQUIRED=428,t.TOO_MANY_REQUESTS=429,t.REQUEST_HEADER_FIELDS_TOO_LARGE=431,t.INTERNAL_SERVER_ERROR=500,t.NOT_IMPLEMENTED=501,t.BAD_GATEWAY=502,t.SERVICE_UNAVAILABLE=503,t.GATEWAY_TIME_OUT=504,t.HTTP_VERSION_NOT_SUPPORTED=505,t.VARIANT_ALSO_NEGOTIATES=506,t.INSUFFICIENT_STORAGE=507,t.BANDWIDTH_LIMIT_EXCEEDED=509,t.NOT_EXTENDED=510,t.NETWORK_AUTHENTICATION_REQUIRED=511},function(e,t,r){"use strict";r.r(t);var n,i,o=function(){function e(e){this.__jsonld=e,this.context=this.getProperty("context"),this.id=this.getProperty("id")}return e.prototype.getProperty=function(e){var t=null;return this.__jsonld&&((t=this.__jsonld[e])||(t=this.__jsonld["@"+e])),t},e}(),a=r(0),s=(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),u=function(e){function t(t,r){var n=e.call(this,t)||this;return n.options=r,n}return s(t,e),t.prototype.getIIIFResourceType=function(){return x.normaliseType(this.getProperty("type"))},t.prototype.getLabel=function(){var e=this.getProperty("label");return e?H.parse(e,this.options.locale):new H([],this.options.locale)},t.prototype.getDefaultLabel=function(){return this.getLabel().getValue(this.options.locale)},t.prototype.getMetadata=function(){var e=this.getProperty("metadata"),t=[];if(!e)return t;for(var r=0;r<e.length;r++){var n=e[r],i=new C(this.options.locale);i.parse(n),t.push(i)}return t},t.prototype.getRendering=function(e){for(var t=this.getRenderings(),r=0;r<t.length;r++){var n=t[r];if(n.getFormat()===e)return n}return null},t.prototype.getRenderings=function(){var e,t=[];if(!(e=this.__jsonld?this.__jsonld.rendering:this.rendering))return t;Array.isArray(e)||(e=[e]);for(var r=0;r<e.length;r++){var n=e[r];t.push(new W(n,this.options))}return t},t.prototype.getService=function(e){return x.getService(this,e)},t.prototype.getServices=function(){return x.getServices(this)},t.prototype.getThumbnail=function(){var e=this.getProperty("thumbnail");return Array.isArray(e)&&(e=e[0]),e?new ne(e,this.options):null},t.prototype.isAnnotation=function(){return this.getIIIFResourceType()===a.IIIFResourceType.ANNOTATION},t.prototype.isCanvas=function(){return this.getIIIFResourceType()===a.IIIFResourceType.CANVAS},t.prototype.isCollection=function(){return this.getIIIFResourceType()===a.IIIFResourceType.COLLECTION},t.prototype.isManifest=function(){return this.getIIIFResourceType()===a.IIIFResourceType.MANIFEST},t.prototype.isRange=function(){return this.getIIIFResourceType()===a.IIIFResourceType.RANGE},t.prototype.isSequence=function(){return this.getIIIFResourceType()===a.IIIFResourceType.SEQUENCE},t}(o),c=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),l=function(e){function t(t,r){return e.call(this,t,r)||this}return c(t,e),t.prototype.getFormat=function(){var e=this.getProperty("format");return e?e.toLowerCase():null},t.prototype.getResources=function(){var e=[];if(!this.__jsonld.resources)return e;for(var t=0;t<this.__jsonld.resources.length;t++){var r=this.__jsonld.resources[t],n=new g(r,this.options);e.push(n)}return e},t.prototype.getType=function(){var e=this.getProperty("type");return e?x.normaliseType(e):null},t.prototype.getWidth=function(){return this.getProperty("width")},t.prototype.getHeight=function(){return this.getProperty("height")},t.prototype.getMaxWidth=function(){return this.getProperty("maxWidth")},t.prototype.getMaxHeight=function(){return this.getProperty("maxHeight")?null:this.getMaxWidth()},t}(u),f=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),p=function(e){function t(t,r){var n=e.call(this,t,r)||this;n.index=-1,n.isLoaded=!1;var i={defaultLabel:"-",locale:"en-GB",resource:n,pessimisticAccessControl:!1};return n.options=Object.assign(i,r),n}return f(t,e),t.prototype.getAttribution=function(){var e=this.getProperty("attribution");return e?H.parse(e,this.options.locale):new H([],this.options.locale)},t.prototype.getDescription=function(){var e=this.getProperty("description");return e?H.parse(e,this.options.locale):new H([],this.options.locale)},t.prototype.getHomepage=function(){var e=this.getProperty("homepage");return e?"string"==typeof e?e:(Array.isArray(e)&&e.length&&(e=e[0]),e["@id"]||e.id):null},t.prototype.getIIIFResourceType=function(){return x.normaliseType(this.getProperty("type"))},t.prototype.getLogo=function(){var e=this.getProperty("logo");return e?"string"==typeof e?e:(Array.isArray(e)&&e.length&&(e=e[0]),e["@id"]||e.id):null},t.prototype.getLicense=function(){return x.getLocalisedValue(this.getProperty("license"),this.options.locale)},t.prototype.getNavDate=function(){return new Date(this.getProperty("navDate"))},t.prototype.getRelated=function(){return this.getProperty("related")},t.prototype.getSeeAlso=function(){return this.getProperty("seeAlso")},t.prototype.getTrackingLabel=function(){var e=this.getService(a.ServiceProfile.TRACKING_EXTENSIONS);return e?e.getProperty("trackingLabel"):""},t.prototype.getDefaultTree=function(){return this.defaultTree=new ie("root"),this.defaultTree.data=this,this.defaultTree},t.prototype.getRequiredStatement=function(){var e=null,t=this.getProperty("requiredStatement");if(t)(e=new C(this.options.locale)).parse(t);else{var r=this.getAttribution();r&&((e=new C(this.options.locale)).value=r)}return e},t.prototype.isCollection=function(){return this.getIIIFResourceType()===a.IIIFResourceType.COLLECTION},t.prototype.isManifest=function(){return this.getIIIFResourceType()===a.IIIFResourceType.MANIFEST},t.prototype.load=function(){var e=this;return new Promise((function(t){if(e.isLoaded)t(e);else{var r=e.options;r.navDate=e.getNavDate();var n=e.__jsonld.id;n||(n=e.__jsonld["@id"]),x.loadManifest(n).then((function(n){e.parentLabel=e.getLabel().getValue(r.locale);var i=z.parse(n,r);(e=Object.assign(e,i)).index=r.index,t(e)}))}}))},t}(u),h=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),g=function(e){function t(t,r){return e.call(this,t,r)||this}return h(t,e),t.prototype.getBody=function(){var e=[],t=this.getProperty("body");if(t)if(Array.isArray(t))for(var r=0;r<t.length;r++)if((o=t[r]).items)for(var n=0;n<o.items.length;n++){var i=o.items[n];e.push(new v(i,this.options))}else e.push(new v(o,this.options));else if(t.items)for(r=0;r<t.items.length;r++){var o=t.items[r];e.push(new v(o,this.options))}else e.push(new v(t,this.options));return e},t.prototype.getMotivation=function(){return this.getProperty("motivation")||null},t.prototype.getOn=function(){return this.getProperty("on")},t.prototype.getTarget=function(){return this.getProperty("target")},t.prototype.getResource=function(){return new l(this.getProperty("resource"),this.options)},t}(u),d=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),v=function(e){function t(t,r){return e.call(this,t,r)||this}return d(t,e),t.prototype.getFormat=function(){var e=this.getProperty("format");return e?x.getMediaType(e):null},t.prototype.getType=function(){return this.getProperty("type")?x.normaliseType(this.getProperty("type")):null},t.prototype.getWidth=function(){return this.getProperty("width")},t.prototype.getHeight=function(){return this.getProperty("height")},t}(u),_=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),E=function(e){function t(t,r,n){var i=e.call(this,r)||this;return i.label=t,i.options=n,i}return _(t,e),t.prototype.getIIIFResourceType=function(){return x.normaliseType(this.getProperty("type"))},t.prototype.getLabel=function(){return this.label},t.prototype.getResources=function(){var e=this;return this.getProperty("resources").map((function(t){return new g(t,e.options)}))},t.prototype.load=function(){var e=this;return new Promise((function(t,r){if(e.isLoaded)t(e);else{var n=e.__jsonld.id;n||(n=e.__jsonld["@id"]),x.loadManifest(n).then((function(r){e.__jsonld=r,e.context=e.getProperty("context"),e.id=e.getProperty("id"),e.isLoaded=!0,t(e)})).catch(r)}}))},t}(o),y=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),I=function(e){function t(t,r){return e.call(this,t,r)||this}return y(t,e),t.prototype.getItems=function(){return this.getProperty("items")},t}(u),T=r(3),O=r.n(T),m=r(5),A=r.n(m),S=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),L=function(e){function t(t,r){return e.call(this,t,r)||this}return S(t,e),t.prototype.getCanonicalImageUri=function(e){var t,r=null,n="default",i=e;if(this.externalResource&&this.externalResource.data&&this.externalResource.data["@id"])r=this.externalResource.data["@id"],i||(i=this.externalResource.data.width),this.externalResource.data["@context"]&&(this.externalResource.data["@context"].indexOf("/1.0/context.json")>-1||this.externalResource.data["@context"].indexOf("/1.1/context.json")>-1||this.externalResource.data["@context"].indexOf("/1/context.json")>-1)&&(n="native");else{var o=this.getImages();if(o&&o.length){var a=o[0].getResource(),s=a.getServices();if(i||(i=a.getWidth()),s.length){var u=s[0];r=u.id,n=x.getImageQuality(u.getProfile())}else if(i===a.getWidth())return a.id}if(!r){var c=this.getProperty("thumbnail");if(c){if("string"==typeof c)return c;if(c["@id"])return c["@id"];if(c.length)return c[0].id}}}return t=i+",",r&&r.endsWith("/")&&(r=r.substr(0,r.length-1)),[r,"full",t,0,n+".jpg"].join("/")},t.prototype.getMaxDimensions=function(){var e,t=null;return this.externalResource&&this.externalResource.data&&this.externalResource.data.profile&&(e=this.externalResource.data.profile,Array.isArray(e)&&(e=e.filter((function(e){return e.maxWidth}))[0])&&(t=new $(e.maxWidth,e.maxHeight?e.maxHeight:e.maxWidth))),t},t.prototype.getContent=function(){var e=[],t=this.__jsonld.items||this.__jsonld.content;if(!t)return e;var r=null;if(t.length&&(r=new I(t[0],this.options)),!r)return e;for(var n=r.getItems(),i=0;i<n.length;i++){var o=n[i],a=new g(o,this.options);e.push(a)}return e},t.prototype.getDuration=function(){return this.getProperty("duration")},t.prototype.getImages=function(){var e=[];if(!this.__jsonld.images)return e;for(var t=0;t<this.__jsonld.images.length;t++){var r=this.__jsonld.images[t],n=new g(r,this.options);e.push(n)}return e},t.prototype.getIndex=function(){return this.getProperty("index")},t.prototype.getOtherContent=function(){var e=this,r=(Array.isArray(this.getProperty("otherContent"))?this.getProperty("otherContent"):[this.getProperty("otherContent")]).filter((function(e){return e&&("sc:AnnotationList","string"==typeof(t=e["@type"])&&t.toLowerCase()==t.toLowerCase());var t})).map((function(t,r){return new E(t.label||"Annotation list "+r,t,e.options)})).map((function(e){return e.load()}));return Promise.all(r)},t.prototype.getWidth=function(){return this.getProperty("width")},t.prototype.getHeight=function(){return this.getProperty("height")},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},Object.defineProperty(t.prototype,"imageResources",{get:function(){var e=this,r=A()([this.getImages().map((function(e){return e.getResource()})),this.getContent().map((function(e){return e.getBody()}))]);return O()(r.map((function(r){switch(r.getProperty("type").toLowerCase()){case a.ExternalResourceType.CHOICE:case a.ExternalResourceType.OA_CHOICE:return new t({images:O()([r.getProperty("default"),r.getProperty("item")]).map((function(e){return{resource:e}}))},e.options).getImages().map((function(e){return e.getResource()}));default:return r}})))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resourceAnnotations",{get:function(){return A()([this.getImages(),this.getContent()])},enumerable:!0,configurable:!0}),t.prototype.resourceAnnotation=function(e){return this.resourceAnnotations.find((function(t){return t.getResource().id===e||O()(new Array(t.getBody())).some((function(t){return t.id===e}))}))},t.prototype.onFragment=function(e){var t=this.resourceAnnotation(e);if(t){var r=t.getProperty("on"),n=t.getProperty("target"),i=(r||n).match(/xywh=(.*)$/);if(i)return i[1].split(",").map((function(e){return parseInt(e,10)}))}},Object.defineProperty(t.prototype,"iiifImageResources",{get:function(){return this.imageResources.filter((function(e){return e&&e.getServices()[0]&&e.getServices()[0].id}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageServiceIds",{get:function(){return this.iiifImageResources.map((function(e){return e.getServices()[0].id}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"aspectRatio",{get:function(){return this.getWidth()/this.getHeight()},enumerable:!0,configurable:!0}),t}(l),R=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),P=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.items=[],n._collections=null,n._manifests=null,t.__collection=n,n}return R(t,e),t.prototype.getCollections=function(){return this._collections?this._collections:this._collections=this.items.filter((function(e){return e.isCollection()}))},t.prototype.getManifests=function(){return this._manifests?this._manifests:this._manifests=this.items.filter((function(e){return e.isManifest()}))},t.prototype.getCollectionByIndex=function(e){for(var t,r=this.getCollections(),n=0;n<r.length;n++){var i=r[n];i.index===e&&(t=i)}if(t)return t.options.index=e,t.load();throw new Error("Collection index not found")},t.prototype.getManifestByIndex=function(e){for(var t,r=this.getManifests(),n=0;n<r.length;n++){var i=r[n];i.index===e&&(t=i)}if(t)return t.options.index=e,t.load();throw new Error("Manifest index not found")},t.prototype.getTotalCollections=function(){return this.getCollections().length},t.prototype.getTotalManifests=function(){return this.getManifests().length},t.prototype.getTotalItems=function(){return this.items.length},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?this.getProperty("viewingDirection"):a.ViewingDirection.LEFT_TO_RIGHT},t.prototype.getBehavior=function(){var e=this.getProperty("behavior");return Array.isArray(e)&&(e=e[0]),e||null},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t.prototype.getDefaultTree=function(){return e.prototype.getDefaultTree.call(this),this.defaultTree.data.type=x.normaliseType(ee.COLLECTION),this._parseManifests(this),this._parseCollections(this),x.generateTreeNodeIds(this.defaultTree),this.defaultTree},t.prototype._parseManifests=function(e){if(e.getManifests()&&e.getManifests().length)for(var t=0;t<e.getManifests().length;t++){var r=e.getManifests()[t],n=r.getDefaultTree();n.label=r.parentLabel||r.getLabel().getValue(this.options.locale)||"manifest "+(t+1),n.navDate=r.getNavDate(),n.data.id=r.id,n.data.type=x.normaliseType(ee.MANIFEST),e.defaultTree.addNode(n)}},t.prototype._parseCollections=function(e){if(e.getCollections()&&e.getCollections().length)for(var t=0;t<e.getCollections().length;t++){var r=e.getCollections()[t],n=r.getDefaultTree();n.label=r.parentLabel||r.getLabel().getValue(this.options.locale)||"collection "+(t+1),n.navDate=r.getNavDate(),n.data.id=r.id,n.data.type=x.normaliseType(ee.COLLECTION),e.defaultTree.addNode(n)}},t}(p),N=function(){function e(e,t){this.start=e,this.end=t}return e.prototype.getLength=function(){return this.end-this.start},e}(),C=function(){function e(e){this.defaultLocale=e}return e.prototype.parse=function(e){this.resource=e,this.label=H.parse(this.resource.label,this.defaultLocale),this.value=H.parse(this.resource.value,this.defaultLocale)},e.prototype.getLabel=function(e){return null===this.label?null:(Array.isArray(e)&&!e.length&&(e=void 0),this.label.getValue(e||this.defaultLocale))},e.prototype.setLabel=function(e){null===this.label&&(this.label=new H([])),this.label.setValue(e,this.defaultLocale)},e.prototype.getValue=function(e,t){return void 0===t&&(t="<br/>"),null===this.value?null:(Array.isArray(e)&&!e.length&&(e=void 0),this.value.getValue(e||this.defaultLocale,t))},e.prototype.getValues=function(e){return null===this.value?[]:(Array.isArray(e)&&!e.length&&(e=void 0),this.value.getValues(e||this.defaultLocale))},e.prototype.setValue=function(e){null===this.value&&(this.value=new H([])),this.value.setValue(e,this.defaultLocale)},e}(),M=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),b=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return M(t,e),t.getValue=function(e,t){return e.getValue(t,"<br/>")},t.getValues=function(e,t){return e.getValues(t)},t}(Array),w=r(1),D=(r(29),function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(a,s)}u((n=n.apply(e,t||[])).next())}))}),U=function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},x=function(){function e(){}return e.getMediaType=function(e){return(e=(e=e.toLowerCase()).split(";")[0]).trim()},e.getImageQuality=function(e){return e===a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1||e===a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2||e===a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_1||e===a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2||e===a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1||e===a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2||e===a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1||e===a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2||e===a.ServiceProfile.IMAGE_1_LEVEL_1||e===a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1||e===a.ServiceProfile.IMAGE_1_LEVEL_2||e===a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2?"native":"default"},e.getInexactLocale=function(e){return-1!==e.indexOf("-")?e.substr(0,e.indexOf("-")):e},e.getLocalisedValue=function(e,t){if(!Array.isArray(e))return e;for(var r=0;r<e.length;r++){var n=e[r];if(t===n["@language"])return n["@value"]}var i=t.substr(0,t.indexOf("-"));for(r=0;r<e.length;r++){var o=e[r];if(o["@language"]===i)return o["@value"]}return null},e.generateTreeNodeIds=function(t,r){var n;void 0===r&&(r=0),n=t.parentNode?t.parentNode.id+"-"+r:"0",t.id=n;for(var i=0;i<t.nodes.length;i++){var o=t.nodes[i];e.generateTreeNodeIds(o,i)}},e.normaliseType=function(e){return-1!==(e=(e||"").toLowerCase()).indexOf(":")?e.split(":")[1]:e},e.normaliseUrl=function(e){return-1!==(e=e.substr(e.indexOf("://"))).indexOf("#")&&(e=e.split("#")[0]),e},e.normalisedUrlsMatch=function(t,r){return e.normaliseUrl(t)===e.normaliseUrl(r)},e.isImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_PROFILE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_PROFILE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_PROFILE_LEVEL_2))},e.isLevel0ImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_PROFILE_LEVEL_0))},e.isLevel1ImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_PROFILE_LEVEL_1))},e.isLevel2ImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_PROFILE_LEVEL_2))},e.parseManifest=function(e,t){return z.parse(e,t)},e.checkStatus=function(e){if(e.ok)return e;var t=new Error(e.statusText);return t.response=e,Promise.reject(t)},e.loadManifest=function(t){return new Promise((function(r,n){fetch(t).then(e.checkStatus).then((function(e){return e.json()})).then((function(e){r(e)})).catch((function(e){n()}))}))},e.loadExternalResourcesAuth1=function(t,r,n,i,o,a,s,u){return new Promise((function(c,l){var f=t.map((function(t){return e.loadExternalResourceAuth1(t,r,n,i,o,a,s,u)}));Promise.all(f).then((function(){c(t)})).catch((function(e){l(e)}))}))},e.loadExternalResourceAuth1=function(t,r,n,i,o,a,s,u){return D(this,void 0,void 0,(function(){var c;return U(this,(function(l){switch(l.label){case 0:return[4,i(t)];case 1:return(c=l.sent())?[4,t.getData(c)]:[3,6];case 2:return l.sent(),t.status!==w.OK?[3,3]:[2,t];case 3:return[4,e.doAuthChain(t,r,n,o,a,s,u)];case 4:l.sent(),l.label=5;case 5:if(t.status===w.OK||t.status===w.MOVED_TEMPORARILY)return[2,t];throw e.createAuthorizationFailedError();case 6:return[4,t.getData()];case 7:return l.sent(),t.status!==w.MOVED_TEMPORARILY&&t.status!==w.UNAUTHORIZED?[3,9]:[4,e.doAuthChain(t,r,n,o,a,s,u)];case 8:l.sent(),l.label=9;case 9:if(t.status===w.OK||t.status===w.MOVED_TEMPORARILY)return[2,t];throw e.createAuthorizationFailedError()}}))}))},e.doAuthChain=function(t,r,n,i,o,a,s){return D(this,void 0,void 0,(function(){var u,c,l,f,p,h,g,d;return U(this,(function(v){switch(v.label){case 0:return t.isAccessControlled()?((u=t.externalService)&&(u.options=t.options),(c=t.kioskService)&&(c.options=t.options),(l=t.clickThroughService)&&(l.options=t.options),(f=t.loginService)&&(f.options=t.options),t.isResponseHandled||t.status!==w.MOVED_TEMPORARILY?[3,2]:[4,a(t)]):[2,t];case 1:case 3:case 6:case 10:case 14:return v.sent(),[2,t];case 2:return p=null,h=null,(p=u)?(h=p,[4,e.attemptResourceWithToken(t,n,p)]):[3,4];case 4:return(p=c)?(h=p,(g=r(p))?[4,i(g)]:[3,7]):[3,7];case 5:case 9:case 13:return v.sent(),[4,e.attemptResourceWithToken(t,n,p)];case 7:return(p=l)?(h=p,[4,o(t,p)]):[3,11];case 8:return(d=v.sent())?[4,i(d)]:[3,11];case 11:return(p=f)?(h=p,[4,o(t,p)]):[3,15];case 12:return(d=v.sent())?[4,i(d)]:[3,15];case 15:return h&&s(t,h),[2]}}))}))},e.attemptResourceWithToken=function(e,t,r){return D(this,void 0,void 0,(function(){var n,i;return U(this,(function(o){switch(o.label){case 0:return(n=r.getService(a.ServiceProfile.AUTH_1_TOKEN))?[4,t(e,n)]:[3,3];case 1:return(i=o.sent())&&i.accessToken?[4,e.getData(i)]:[3,3];case 2:return o.sent(),[2,e];case 3:return[2]}}))}))},e.loadExternalResourcesAuth09=function(t,r,n,i,o,a,s,u,c,l){return new Promise((function(f,p){var h=t.map((function(t){return e.loadExternalResourceAuth09(t,r,n,i,o,a,s,u,c,l)}));Promise.all(h).then((function(){f(t)})).catch((function(e){p(e)}))}))},e.loadExternalResourceAuth09=function(t,r,n,i,o,a,s,u,c,l){return new Promise((function(f,p){l&&l.pessimisticAccessControl?t.getData().then((function(){t.isAccessControlled()?t.clickThroughService?(f(n(t)),f(i(t))):o(t).then((function(){a(t,!0).then((function(r){t.getData(r).then((function(){f(c(t))})).catch((function(t){p(e.createInternalServerError(t))}))})).catch((function(t){p(e.createInternalServerError(t))}))})).catch((function(t){p(e.createInternalServerError(t))})):f(t)})).catch((function(t){p(e.createInternalServerError(t))})):u(t,r).then((function(l){l?t.getData(l).then((function(){t.status===w.OK?f(c(t)):e.authorize(t,r,n,i,o,a,s,u).then((function(){f(c(t))})).catch((function(t){p(e.createAuthorizationFailedError())}))})).catch((function(t){p(e.createAuthorizationFailedError())})):e.authorize(t,r,n,i,o,a,s,u).then((function(){f(c(t))})).catch((function(t){p(e.createAuthorizationFailedError())}))})).catch((function(t){p(e.createAuthorizationFailedError())}))}))},e.createError=function(e,t){var r=new Error;return r.message=t,r.name=String(e),r},e.createAuthorizationFailedError=function(){return e.createError(k.AUTHORIZATION_FAILED,"Authorization failed")},e.createRestrictedError=function(){return e.createError(k.RESTRICTED,"Restricted")},e.createInternalServerError=function(t){return e.createError(k.INTERNAL_SERVER_ERROR,t)},e.authorize=function(t,r,n,i,o,a,s,u){return new Promise((function(c,l){t.getData().then((function(){t.isAccessControlled()?u(t,r).then((function(u){u?t.getData(u).then((function(){t.status===w.OK?c(t):e.showAuthInteraction(t,r,n,i,o,a,s,c,l)})).catch((function(t){l(e.createInternalServerError(t))})):a(t,!1).then((function(u){u?s(t,u,r).then((function(){t.getData(u).then((function(){t.status===w.OK?c(t):e.showAuthInteraction(t,r,n,i,o,a,s,c,l)})).catch((function(t){l(e.createInternalServerError(t))}))})).catch((function(t){l(e.createInternalServerError(t))})):e.showAuthInteraction(t,r,n,i,o,a,s,c,l)}))})).catch((function(t){l(e.createInternalServerError(t))})):c(t)}))}))},e.showAuthInteraction=function(t,r,n,i,o,a,s,u,c){t.status!==w.MOVED_TEMPORARILY||t.isResponseHandled?t.clickThroughService&&!t.isResponseHandled?n(t).then((function(){a(t,!0).then((function(n){s(t,n,r).then((function(){t.getData(n).then((function(){u(t)})).catch((function(t){c(e.createInternalServerError(t))}))})).catch((function(t){c(e.createInternalServerError(t))}))})).catch((function(t){c(e.createInternalServerError(t))}))})):o(t).then((function(){a(t,!0).then((function(n){s(t,n,r).then((function(){t.getData(n).then((function(){u(t)})).catch((function(t){c(e.createInternalServerError(t))}))})).catch((function(t){c(e.createInternalServerError(t))}))})).catch((function(t){c(e.createInternalServerError(t))}))})):u(t)},e.getService=function(e,t){for(var r=this.getServices(e),n=0;n<r.length;n++){var i=r[n];if(i.getProfile()===t)return i}return null},e.getResourceById=function(t,r){return e.traverseAndFind(t.__jsonld,"@id",r)},e.traverseAndFind=function(t,r,n){if(t.hasOwnProperty(r)&&t[r]===n)return t;for(var i=0;i<Object.keys(t).length;i++)if("object"==typeof t[Object.keys(t)[i]]){var o=e.traverseAndFind(t[Object.keys(t)[i]],r,n);if(null!=o)return o}},e.getServices=function(e){var t,r=[];if(!(t=e.__jsonld?e.__jsonld.service:e.service))return r;Array.isArray(t)||(t=[t]);for(var n=0;n<t.length;n++){var i=t[n];if("string"==typeof i){var o=this.getResourceById(e.options.resource,i);o&&r.push(new Z(o.__jsonld||o,e.options))}else r.push(new Z(i,e.options))}return r},e.getTemporalComponent=function(e){var t=/t=([^&]+)/g.exec(e),r=null;return t&&t[1]&&(r=t[1].split(",")),r},e}(),V=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),G=function(){function e(e,t,r){void 0===r&&(r="none"),Array.isArray(e)&&1===e.length?this._value=e[0]:this._value=e,"none"!==t&&"@none"!==t||(t=void 0),this._locale=t,this._defaultLocale=r}return e.parseV2Value=function(t,r){return"string"==typeof t?new e(t,void 0,r):t["@value"]?new e(t["@value"],t["@language"],r):null},Object.defineProperty(e.prototype,"value",{get:function(){return Array.isArray(this._value)?this._value.join("<br/>"):this._value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"locale",{get:function(){return void 0===this._locale?this._defaultLocale:this._locale},enumerable:!0,configurable:!0}),e.prototype.addValue=function(e){Array.isArray(this._value)||(this._value=[this._value]),Array.isArray(e)?this._value=this._value.concat(e):this._value.push(e)},e}(),H=function(e){function t(r,n){void 0===r&&(r=[]);var i=e.apply(this,r)||this;return i.__proto__=t.prototype,i._defaultLocale=n,i}return V(t,e),t.parse=function(e,r){if(!e)return new t([],r);if(Array.isArray(e)){var n=(i=e.map((function(e){return G.parseV2Value(e,r)})).filter((function(e){return null!==e}))).reduce((function(e,t){var r=t._locale;return r||(r="none"),e[r]?e[r].addValue(t._value):e[r]=t,e}),{});return new t(Object.values(n),r)}return"string"==typeof e?new t([new G(e,void 0,r)],r):e["@language"]?new t(null!==(i=G.parseV2Value(e))?[i]:[],r):new t(Object.keys(e).map((function(t){var n=e[t];if(!Array.isArray(n))throw new Error("A IIIF v3 localized property value must have an array as the value for a given language.");return new G(n,t,r)})),r);var i},t.prototype.getSuitableLocale=function(e){for(var t=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<r;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)n[i]=o[a];return n}(this).map((function(e){return e._locale})).filter((function(e){return void 0!==e})),r=function(e){var r=t.find((function(t){return t===e}));if(r)return{value:r}},n=0,i=e;n<i.length;n++){var o=r(i[n]);if("object"==typeof o)return o.value}for(var a=function(e){var r=t.find((function(t){return x.getInexactLocale(t)===x.getInexactLocale(e)}));if(r)return{value:r}},s=0,u=e;s<u.length;s++){var c=a(u[s]);if("object"==typeof c)return c.value}},t.prototype.setValue=function(e,t){var r=void 0;if(t){var n=this.getSuitableLocale([t]);n&&(r=this.find((function(e){return e._locale===n})))}else r=this.find((function(e){return void 0===e._locale}));r?r._value=e:this.push(new G(e,t,this._defaultLocale))},t.prototype.getValue=function(e,t){var r=this.getValues(e);return 0===r.length?null:t?r.join(t):r[0]},t.prototype.getValues=function(e){if(!this.length)return[];var t;if(t=e?Array.isArray(e)?e:[e]:[],1===this.length&&void 0===this[0]._locale){var r=this[0]._value;return Array.isArray(r)?r:[r]}var n=this.getSuitableLocale(t);if(n)return r=this.find((function(e){return e._locale===n}))._value,Array.isArray(r)?r:[r];if(!this.find((function(e){return void 0===e._locale})))return r=this[0]._value,Array.isArray(r)?r:[r];var i=this.find((function(e){return void 0===e._locale}));return i?Array.isArray(i._value)?i._value:[i._value]:[]},t}(Array),F=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),B=function(e){function t(t,r){var n=e.call(this,t,r)||this;if(n.index=0,n._allRanges=null,n.items=[],n._topRanges=[],n.__jsonld.structures&&n.__jsonld.structures.length)for(var i=n._getTopRanges(),o=0;o<i.length;o++){var a=i[o];n._parseRanges(a,String(o))}return n}return F(t,e),t.prototype.getPosterCanvas=function(){var e=this.getProperty("posterCanvas");return e&&(e=new L(e,this.options)),e},t.prototype.getAccompanyingCanvas=function(){var e=this.getProperty("accompanyingCanvas");return e&&(e=new L(e,this.options)),e},t.prototype.getBehavior=function(){var e=this.getProperty("behavior");return Array.isArray(e)&&(e=e[0]),e||null},t.prototype.getDefaultTree=function(){if(e.prototype.getDefaultTree.call(this),this.defaultTree.data.type=x.normaliseType(ee.MANIFEST),!this.isLoaded)return this.defaultTree;var t=this.getTopRanges();return t.length&&t[0].getTree(this.defaultTree),x.generateTreeNodeIds(this.defaultTree),this.defaultTree},t.prototype._getTopRanges=function(){var e=[];if(this.__jsonld.structures&&this.__jsonld.structures.length){for(var t=0;t<this.__jsonld.structures.length;t++){var r=this.__jsonld.structures[t];r.viewingHint===a.ViewingHint.TOP&&e.push(r)}if(!e.length){var n={};n.ranges=this.__jsonld.structures,e.push(n)}}return e},t.prototype.getTopRanges=function(){return this._topRanges},t.prototype._getRangeById=function(e){if(this.__jsonld.structures&&this.__jsonld.structures.length)for(var t=0;t<this.__jsonld.structures.length;t++){var r=this.__jsonld.structures[t];if(r["@id"]===e||r.id===e)return r}return null},t.prototype._parseRanges=function(e,t,r){var n,i=null;if("string"==typeof e&&(i=e,e=this._getRangeById(i)),e){(n=new q(e,this.options)).parentRange=r,n.path=t,r?r.items.push(n):this._topRanges.push(n);var o=e.items||e.members;if(o)for(var a=0;a<o.length;a++){var s=o[a];if(s["@type"]&&"sc:range"===s["@type"].toLowerCase()||s.type&&"range"===s.type.toLowerCase())this._parseRanges(s,t+"/"+a,n);else if(s["@type"]&&"sc:canvas"===s["@type"].toLowerCase()||s.type&&"canvas"===s.type.toLowerCase()){n.canvases||(n.canvases=[]);var u=s.id||s["@id"];n.canvases.push(u)}}else if(e.ranges)for(a=0;a<e.ranges.length;a++)this._parseRanges(e.ranges[a],t+"/"+a,n)}else console.warn("Range:",i,"does not exist")},t.prototype.getAllRanges=function(){if(null!=this._allRanges)return this._allRanges;this._allRanges=[];for(var e=this.getTopRanges(),t=function(t){var n=e[t];n.id&&r._allRanges.push(n);var i=function(e,t){e.add(t);var r=t.getRanges();return r.length?r.reduce(i,e):e},o=Array.from(n.getRanges().reduce(i,new Set));r._allRanges=r._allRanges.concat(o)},r=this,n=0;n<e.length;n++)t(n);return this._allRanges},t.prototype.getRangeById=function(e){for(var t=this.getAllRanges(),r=0;r<t.length;r++){var n=t[r];if(n.id===e)return n}return null},t.prototype.getRangeByPath=function(e){for(var t=this.getAllRanges(),r=0;r<t.length;r++){var n=t[r];if(n.path===e)return n}return null},t.prototype.getSequences=function(){if(this.items.length)return this.items;var e=this.__jsonld.mediaSequences||this.__jsonld.sequences;if(e)for(var t=0;t<e.length;t++){var r=e[t],n=new X(r,this.options);this.items.push(n)}else this.__jsonld.items&&(n=new X(this.__jsonld.items,this.options),this.items.push(n));return this.items},t.prototype.getSequenceByIndex=function(e){return this.getSequences()[e]},t.prototype.getTotalSequences=function(){return this.getSequences().length},t.prototype.getManifestType=function(){var e=this.getService(a.ServiceProfile.UI_EXTENSIONS);return e?e.getProperty("manifestType"):i.EMPTY},t.prototype.isMultiSequence=function(){return this.getTotalSequences()>1},t.prototype.isPagingEnabled=function(){var e=this.getViewingHint();if(e)return e===a.ViewingHint.PAGED;var t=this.getBehavior();return!!t&&t===a.Behavior.PAGED},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t}(p);!function(e){e.EMPTY="",e.MANUSCRIPT="manuscript",e.MONOGRAPH="monograph"}(i||(i={}));var k,Y=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),q=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n._ranges=null,n.canvases=null,n.items=[],n}return Y(t,e),t.prototype.getCanvasIds=function(){return this.__jsonld.canvases?this.__jsonld.canvases:this.canvases?this.canvases:[]},t.prototype.getDuration=function(){if(this.canvases&&this.canvases.length){for(var e=[],t=[],r=0,n=this.canvases;r<n.length;r++)if(h=n[r]){var i=h.match(/(.*)#t=([0-9.]+),?([0-9.]+)?/)||[void 0,h],o=i[1],a=i[2],s=i[3];o&&(e.push(parseFloat(a)),t.push(parseFloat(s)))}if(e.length&&t.length)return new N(Math.min.apply(Math,e),Math.max.apply(Math,t))}else{e=[],t=[];for(var u=0,c=d=this.getRanges();u<c.length;u++)(v=c[u].getDuration())&&(e.push(v.start),t.push(v.end));if(e.length&&t.length)return new N(Math.min.apply(Math,e),Math.max.apply(Math,t))}var l,f;if(this.canvases&&this.canvases.length)for(var p=0;p<this.canvases.length;p++){var h=this.canvases[p],g=x.getTemporalComponent(h);g&&g.length>1&&(0===p&&(l=Number(g[0])),p===this.canvases.length-1&&(f=Number(g[1])))}else{var d=this.getRanges();for(p=0;p<d.length;p++){var v;(v=d[p].getDuration())&&(0===p&&(l=v.start),p===d.length-1&&(f=v.end))}}if(void 0!==l&&void 0!==f)return new N(l,f)},t.prototype.getRanges=function(){return this._ranges?this._ranges:this._ranges=this.items.filter((function(e){return e.isRange()}))},t.prototype.getBehavior=function(){var e=this.getProperty("behavior");return Array.isArray(e)&&(e=e[0]),e||null},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t.prototype.getTree=function(e){e.data=this,this.treeNode=e;var t=this.getRanges();if(t&&t.length)for(var r=0;r<t.length;r++){var n=t[r],i=new ie;e.addNode(i),this._parseTreeNode(i,n)}return x.generateTreeNodeIds(e),e},t.prototype.spansTime=function(e){var t=this.getDuration();return!!(t&&e>=t.start&&e<=t.end)},t.prototype._parseTreeNode=function(e,t){e.label=t.getLabel().getValue(this.options.locale),e.data=t,e.data.type=x.normaliseType(ee.RANGE),t.treeNode=e;var r=t.getRanges();if(r&&r.length)for(var n=0;n<r.length;n++){var i=r[n];if(i.getBehavior()!==a.Behavior.NO_NAV){var o=new ie;e.addNode(o),this._parseTreeNode(o,i)}}},t}(u),K=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),W=function(e){function t(t,r){return e.call(this,t,r)||this}return K(t,e),t.prototype.getFormat=function(){return this.getProperty("format")},t}(u),Q=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),X=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.items=[],n._thumbnails=null,n}return Q(t,e),t.prototype.getCanvases=function(){if(this.items.length)return this.items;var e=this.__jsonld.canvases||this.__jsonld.elements;if(e)for(var t=0;t<e.length;t++){var r=e[t];(n=new L(r,this.options)).index=t,this.items.push(n)}else if(this.__jsonld)for(t=0;t<this.__jsonld.length;t++){var n;r=this.__jsonld[t],(n=new L(r,this.options)).index=t,this.items.push(n)}return this.items},t.prototype.getCanvasById=function(e){for(var t=0;t<this.getTotalCanvases();t++){var r=this.getCanvasByIndex(t),n=x.normaliseUrl(r.id);if(x.normaliseUrl(e)===n)return r}return null},t.prototype.getCanvasByIndex=function(e){return this.getCanvases()[e]},t.prototype.getCanvasIndexById=function(e){for(var t=0;t<this.getTotalCanvases();t++)if(this.getCanvasByIndex(t).id===e)return t;return null},t.prototype.getCanvasIndexByLabel=function(e,t){e=e.trim(),isNaN(e)||(e=parseInt(e,10).toString(),t&&(e+="r"));for(var r,n,i,o=/(\d*)\D+(\d*)/,a=0;a<this.getTotalCanvases();a++){var s=this.getCanvasByIndex(a);if(s.getLabel().getValue(this.options.locale)===e)return a;if((r=o.exec(e))&&(n=r[1],(i=r[2])&&new RegExp("^"+n+"\\D+"+i+"$").test(s.getLabel().toString())))return a}return-1},t.prototype.getLastCanvasLabel=function(e){for(var t=this.getTotalCanvases()-1;t>=0;t--){var r=this.getCanvasByIndex(t).getLabel().getValue(this.options.locale);if(e){if(/^[a-zA-Z0-9]*$/.test(r))return r}else if(r)return r}return this.options.defaultLabel},t.prototype.getLastPageIndex=function(){return this.getTotalCanvases()-1},t.prototype.getNextPageIndex=function(e,t){var r;if(t){var n=this.getPagedIndices(e),i=this.getViewingDirection();r=i&&i===a.ViewingDirection.RIGHT_TO_LEFT?n[0]+1:n[n.length-1]+1}else r=e+1;return r>this.getLastPageIndex()?-1:r},t.prototype.getPagedIndices=function(e,t){var r=[];if(t){r=this.isFirstCanvas(e)||this.isLastCanvas(e)?[e]:e%2?[e,e+1]:[e-1,e];var n=this.getViewingDirection();n&&n===a.ViewingDirection.RIGHT_TO_LEFT&&(r=r.reverse())}else r.push(e);return r},t.prototype.getPrevPageIndex=function(e,t){var r;if(t){var n=this.getPagedIndices(e),i=this.getViewingDirection();r=i&&i===a.ViewingDirection.RIGHT_TO_LEFT?n[n.length-1]-1:n[0]-1}else r=e-1;return r},t.prototype.getStartCanvasIndex=function(){var e=this.getStartCanvas();if(e)for(var t=0;t<this.getTotalCanvases();t++)if(this.getCanvasByIndex(t).id===e)return t;return 0},t.prototype.getThumbs=function(e,t){for(var r=[],n=this.getTotalCanvases(),i=0;i<n;i++){var o=this.getCanvasByIndex(i),a=new te(e,o);r.push(a)}return r},t.prototype.getThumbnails=function(){if(null!=this._thumbnails)return this._thumbnails;this._thumbnails=[];for(var e=this.getCanvases(),t=0;t<e.length;t++){var r=e[t].getThumbnail();r&&this._thumbnails.push(r)}return this._thumbnails},t.prototype.getStartCanvas=function(){return this.getProperty("startCanvas")},t.prototype.getTotalCanvases=function(){return this.getCanvases().length},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?this.getProperty("viewingDirection"):this.options.resource.getViewingDirection?this.options.resource.getViewingDirection():null},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t.prototype.isCanvasIndexOutOfRange=function(e){return e>this.getTotalCanvases()-1},t.prototype.isFirstCanvas=function(e){return 0===e},t.prototype.isLastCanvas=function(e){return e===this.getTotalCanvases()-1},t.prototype.isMultiCanvas=function(){return this.getTotalCanvases()>1},t.prototype.isPagingEnabled=function(){var e=this.getViewingHint();return!!e&&e===a.ViewingHint.PAGED},t.prototype.isTotalCanvasesEven=function(){return this.getTotalCanvases()%2==0},t}(u),z=function(){function e(){}return e.parse=function(e,t){return"string"==typeof e&&(e=JSON.parse(e)),this.parseJson(e,t)},e.parseJson=function(e,t){var r;if(t&&t.navDate&&!isNaN(t.navDate.getTime())&&(e.navDate=t.navDate.toString()),e["@type"])switch(e["@type"]){case"sc:Collection":r=this.parseCollection(e,t);break;case"sc:Manifest":r=this.parseManifest(e,t);break;default:return null}else switch(e.type){case"Collection":r=this.parseCollection(e,t);break;case"Manifest":r=this.parseManifest(e,t);break;default:return null}return r.isLoaded=!0,r},e.parseCollection=function(e,t){var r=new P(e,t);return t?(r.index=t.index||0,t.resource&&(r.parentCollection=t.resource.parentCollection)):r.index=0,this.parseCollections(r,t),this.parseManifests(r,t),this.parseItems(r,t),r},e.parseCollections=function(e,t){var r;if(e.__jsonld.collections?r=e.__jsonld.collections:e.__jsonld.items&&(r=e.__jsonld.items.filter((function(e){return"collection"===e.type.toLowerCase()}))),r)for(var n=0;n<r.length;n++){t&&(t.index=n);var i=this.parseCollection(r[n],t);i.index=n,i.parentCollection=e,e.items.push(i)}},e.parseManifest=function(e,t){return new B(e,t)},e.parseManifests=function(e,t){var r;if(e.__jsonld.manifests?r=e.__jsonld.manifests:e.__jsonld.items&&(r=e.__jsonld.items.filter((function(e){return"manifest"===e.type.toLowerCase()}))),r)for(var n=0;n<r.length;n++){var i=this.parseManifest(r[n],t);i.index=n,i.parentCollection=e,e.items.push(i)}},e.parseItem=function(e,t){if(e["@type"]){if("sc:manifest"===e["@type"].toLowerCase())return this.parseManifest(e,t);if("sc:collection"===e["@type"].toLowerCase())return this.parseCollection(e,t)}else if(e.type){if("manifest"===e.type.toLowerCase())return this.parseManifest(e,t);if("collection"===e.type.toLowerCase())return this.parseCollection(e,t)}return null},e.parseItems=function(e,t){var r=e.__jsonld.members||e.__jsonld.items;if(r)for(var n=function(n){t&&(t.index=n);var o=i.parseItem(r[n],t);return o?e.items.filter((function(e){return e.id===o.id}))[0]?"continue":(o.index=n,o.parentCollection=e,void e.items.push(o)):{value:void 0}},i=this,o=0;o<r.length;o++){var a=n(o);if("object"==typeof a)return a.value}},e}(),J=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Z=function(e){function t(t,r){return e.call(this,t,r)||this}return J(t,e),t.prototype.getProfile=function(){var e=this.getProperty("profile");return e||(e=this.getProperty("dcterms:conformsTo")),Array.isArray(e)?e[0]:e},t.prototype.getConfirmLabel=function(){return x.getLocalisedValue(this.getProperty("confirmLabel"),this.options.locale)},t.prototype.getDescription=function(){return x.getLocalisedValue(this.getProperty("description"),this.options.locale)},t.prototype.getFailureDescription=function(){return x.getLocalisedValue(this.getProperty("failureDescription"),this.options.locale)},t.prototype.getFailureHeader=function(){return x.getLocalisedValue(this.getProperty("failureHeader"),this.options.locale)},t.prototype.getHeader=function(){return x.getLocalisedValue(this.getProperty("header"),this.options.locale)},t.prototype.getServiceLabel=function(){return x.getLocalisedValue(this.getProperty("label"),this.options.locale)},t.prototype.getInfoUri=function(){var e=this.id;return e.endsWith("/")||(e+="/"),e+"info.json"},t}(u),$=function(e,t){this.width=e,this.height=t};!function(e){e[e.AUTHORIZATION_FAILED=1]="AUTHORIZATION_FAILED",e[e.FORBIDDEN=2]="FORBIDDEN",e[e.INTERNAL_SERVER_ERROR=3]="INTERNAL_SERVER_ERROR",e[e.RESTRICTED=4]="RESTRICTED"}(k||(k={}));var ee,te=function(e,t){this.data=t,this.index=t.index,this.width=e;var r=t.getHeight()/t.getWidth();this.height=r?Math.floor(this.width*r):e,this.uri=t.getCanonicalImageUri(e),this.label=t.getLabel().getValue()},re=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ne=function(e){function t(t,r){return e.call(this,t,r)||this}return re(t,e),t}(l),ie=function(){function e(e,t){this.label=e,this.data=t||{},this.nodes=[]}return e.prototype.addNode=function(e){this.nodes.push(e),e.parentNode=this},e.prototype.isCollection=function(){return this.data.type===x.normaliseType(ee.COLLECTION)},e.prototype.isManifest=function(){return this.data.type===x.normaliseType(ee.MANIFEST)},e.prototype.isRange=function(){return this.data.type===x.normaliseType(ee.RANGE)},e}();!function(e){e.COLLECTION="collection",e.MANIFEST="manifest",e.RANGE="range"}(ee||(ee={})),r.d(t,"loadManifest",(function(){return oe})),r.d(t,"parseManifest",(function(){return ae})),r.d(t,"Utils",(function(){return x})),r.d(t,"JSONLDResource",(function(){return o})),r.d(t,"ManifestResource",(function(){return u})),r.d(t,"Resource",(function(){return l})),r.d(t,"IIIFResource",(function(){return p})),r.d(t,"Annotation",(function(){return g})),r.d(t,"AnnotationBody",(function(){return v})),r.d(t,"AnnotationList",(function(){return E})),r.d(t,"AnnotationPage",(function(){return I})),r.d(t,"Canvas",(function(){return L})),r.d(t,"Collection",(function(){return P})),r.d(t,"Duration",(function(){return N})),r.d(t,"LabelValuePair",(function(){return C})),r.d(t,"LanguageMap",(function(){return b})),r.d(t,"LocalizedValue",(function(){return G})),r.d(t,"PropertyValue",(function(){return H})),r.d(t,"Manifest",(function(){return B})),r.d(t,"ManifestType",(function(){return i})),r.d(t,"Range",(function(){return q})),r.d(t,"Rendering",(function(){return W})),r.d(t,"Sequence",(function(){return X})),r.d(t,"Deserialiser",(function(){return z})),r.d(t,"Service",(function(){return Z})),r.d(t,"Size",(function(){return $})),r.d(t,"StatusCode",(function(){return k})),r.d(t,"Thumb",(function(){return te})),r.d(t,"Thumbnail",(function(){return ne})),r.d(t,"TreeNode",(function(){return ie})),r.d(t,"TreeNodeType",(function(){return ee}));var oe=function(e){return x.loadManifest(e)},ae=function(e,t){return x.parseManifest(e,t)}},function(e,t,r){var n=r(10);e.exports=function(e){return null!=e&&e.length?n(e,1):[]}},function(e,t,r){var n=r(20).Symbol;e.exports=n},function(e,t,r){var n=r(10);e.exports=function(e){return null!=e&&e.length?n(e,Infinity):[]}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.AnnotationRect=function(e){this.isVisible=!0;var t=e.on.match(/.*xywh=(\d*),(\d*),(\d*),(\d*)/);this.x=Number(t[1]),this.y=Number(t[2]),this.width=Number(t[3]),this.height=Number(t[4]),this.chars=e.resource.chars}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(8),i=r(0),o=r(2),a=function(){function e(e){this._options=e,this._options.locale=this._options.locale||"en-GB"}return e.prototype.bootstrap=function(e,t){var r=this;return new Promise((function(n,i){e&&t&&(n=e,i=t),o.Utils.loadManifest(r._options.manifestUri).then((function(e){r._loaded(r,e,n,i)}))}))},e.prototype._loaded=function(e,t,r,a){var s=o.Utils.parseManifest(t,{locale:e._options.locale});if(s){e._options.iiifResource||(e._options.iiifResource=s);var u=e._options.collectionIndex,c=e._options.manifestIndex;if(s.getIIIFResourceType()===i.IIIFResourceType.COLLECTION){var l=s.getManifests(),f=s.getCollections();l.length||void 0!==u||(u=0),void 0!==u&&f&&f.length?s.getCollectionByIndex(u).then((function(t){t||a("Collection index not found"),0===t.getTotalManifests()&&0===c&&t.getTotalCollections()>0?(e._options.collectionIndex=0,e._options.manifestUri=t.id,e.bootstrap(r,a)):void 0!==c&&t.getManifestByIndex(c).then((function(t){e._options.manifest=t;var i=new n.Helper(e._options);r(i)}))})):s.getManifestByIndex(e._options.manifestIndex).then((function(t){e._options.manifest=t;var i=new n.Helper(e._options);r(i)}))}else{e._options.manifest=s;var p=new n.Helper(e._options);r(p)}}else console.error("Unable to load IIIF resource")},e}();t.Bootstrapper=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(9),i=r(13),o=r(14),a=r(0),s=r(30),u=r(2),c=function(){function e(e){this.options=e,this.iiifResource=this.options.iiifResource,this.manifestUri=this.options.manifestUri,this.manifest=this.options.manifest,this.collectionIndex=this.options.collectionIndex||0,this.manifestIndex=this.options.manifestIndex||0,this.sequenceIndex=this.options.sequenceIndex||0,this.canvasIndex=this.options.canvasIndex||0}return e.prototype.getAutoCompleteService=function(){var e=this.getSearchService(),t=null;return e&&((t=e.getService(a.ServiceProfile.SEARCH_0_AUTO_COMPLETE))||(t=e.getService(a.ServiceProfile.SEARCH_1_AUTO_COMPLETE))),t},e.prototype.getAttribution=function(){if(!this.manifest)throw new Error(s.Errors.manifestNotLoaded);var e=this.manifest.getAttribution();return e?e.getValue(this.options.locale):null},e.prototype.getCanvases=function(){return this.getCurrentSequence().getCanvases()},e.prototype.getCanvasById=function(e){return this.getCurrentSequence().getCanvasById(e)},e.prototype.getCanvasesById=function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r],i=this.getCanvasById(n);i&&t.push(i)}return t},e.prototype.getCanvasByIndex=function(e){return this.getCurrentSequence().getCanvasByIndex(e)},e.prototype.getCanvasIndexById=function(e){return this.getCurrentSequence().getCanvasIndexById(e)},e.prototype.getCanvasIndexByLabel=function(e){var t=this.getManifestType()===u.ManifestType.MANUSCRIPT;return this.getCurrentSequence().getCanvasIndexByLabel(e,t)},e.prototype.getCanvasRange=function(e,t){var r=this.getCanvasRanges(e);if(t){for(var n=0;n<r.length;n++){var i=r[n];if(i.path===t)return i}return null}return r[0]},e.prototype.getCanvasRanges=function(e){if(!this.manifest)throw new Error(s.Errors.manifestNotLoaded);return e.ranges||(e.ranges=this.manifest.getAllRanges().filter((function(t){return t.getCanvasIds().some((function(t){return u.Utils.normaliseUrl(t)===u.Utils.normaliseUrl(e.id)}))}))),e.ranges},e.prototype.getCollectionIndex=function(e){if(!e.parentCollection||e.parentCollection.parentCollection)return e.parentCollection?e.parentCollection.index:void 0},e.prototype.getCurrentCanvas=function(){return this.getCurrentSequence().getCanvasByIndex(this.canvasIndex)},e.prototype.getCurrentSequence=function(){return this.getSequenceByIndex(this.sequenceIndex)},e.prototype.getDescription=function(){if(!this.manifest)throw new Error(s.Errors.manifestNotLoaded);var e=this.manifest.getDescription();return e?e.getValue(this.options.locale):null},e.prototype.getLabel=function(){if(!this.manifest)throw new Error(s.Errors.manifestNotLoaded);var e=this.manifest.getLabel();return e?e.getValue(this.options.locale):null},e.prototype.getLastCanvasLabel=function(e){return this.getCurrentSequence().getLastCanvasLabel(e)},e.prototype.getFirstPageIndex=function(){return 0},e.prototype.getLastPageIndex=function(){return this.getTotalCanvases()-1},e.prototype.getLicense=function(){if(!this.manifest)throw new Error(s.Errors.manifestNotLoaded);return this.manifest.getLicense()},e.prototype.getLogo=function(){if(!this.manifest)throw new Error(s.Errors.manifestNotLoaded);return this.manifest.getLogo()},e.prototype.getManifestType=function(){if(!this.manifest)throw new Error(s.Errors.manifestNotLoaded);var e=this.manifest.getManifestType();return e===u.ManifestType.EMPTY&&(e=u.ManifestType.MONOGRAPH),e},e.prototype.getMetadata=function(e){if(!this.manifest)throw new Error(s.Errors.manifestNotLoaded);var t=[],r=this.manifest.getMetadata(),n=new i.MetadataGroup(this.manifest),o=this.options.locale;r&&r.length&&n.addMetadata(r,!0),this.manifest.getDescription().length&&((l=new u.LabelValuePair(o)).label=new u.PropertyValue([new u.LocalizedValue("description",o)]),l.value=this.manifest.getDescription(),l.isRootLevel=!0,n.addItem(l)),this.manifest.getAttribution().length&&((l=new u.LabelValuePair(o)).label=new u.PropertyValue([new u.LocalizedValue("attribution",o)]),l.value=this.manifest.getAttribution(),l.isRootLevel=!0,n.addItem(l));var l,a=this.manifest.getLicense();if(a){var c={label:"license",value:e&&e.licenseFormatter?e.licenseFormatter.format(a):a};(l=new u.LabelValuePair(o)).parse(c),l.isRootLevel=!0,n.addItem(l)}this.manifest.getLogo()&&(c={label:"logo",value:'<img alt="logo" src="'+this.manifest.getLogo()+'"/>'},(l=new u.LabelValuePair(o)).parse(c),l.isRootLevel=!0,n.addItem(l));return t.push(n),e?this._parseMetadataOptions(e,t):t},e.prototype.getRequiredStatement=function(){if(!this.manifest)throw new Error(s.Errors.manifestNotLoaded);var e=this.manifest.getRequiredStatement();return e?{label:e.label?e.getLabel():"",value:e.value&&e.value.length?e.getValue():""}:null},e.prototype._parseMetadataOptions=function(e,t){var r=this.getCurrentSequence(),n=r.getMetadata();if(n&&n.length){var o=new i.MetadataGroup(r);o.addMetadata(n),t.push(o)}if(e.range){var a=this._getRangeMetadata([],e.range);a=a.reverse(),t=t.concat(a)}if(e.canvases&&e.canvases.length)for(var s=0;s<e.canvases.length;s++){var u=e.canvases[s],c=u.getMetadata();if(c&&c.length){var l=new i.MetadataGroup(u);l.addMetadata(u.getMetadata()),t.push(l)}for(var f=u.getImages(),p=0;p<f.length;p++){var h=f[p],g=h.getMetadata();if(g&&g.length){var d=new i.MetadataGroup(h);d.addMetadata(g),t.push(d)}}}return t},e.prototype._getRangeMetadata=function(e,t){var r=t.getMetadata();if(r&&r.length){var n=new i.MetadataGroup(t);n.addMetadata(r),e.push(n)}else if(t.parentRange)return this._getRangeMetadata(e,t.parentRange);return e},e.prototype.getMultiSelectState=function(){return this._multiSelectState||(this._multiSelectState=new n.MultiSelectState,this._multiSelectState.ranges=this.getRanges().slice(0),this._multiSelectState.canvases=this.getCurrentSequence().getCanvases().slice(0)),this._multiSelectState},e.prototype.getCurrentRange=function(){return this.rangeId?this.getRangeById(this.rangeId):null},e.prototype.getPosterCanvas=function(){if(!this.manifest)throw new Error(s.Errors.manifestNotLoaded);return this.manifest.getPosterCanvas()},e.prototype.getAccompanyingCanvas=function(){if(!this.manifest)throw new Error(s.Errors.manifestNotLoaded);return this.manifest.getAccompanyingCanvas()},e.prototype.getPosterImage=function(){var e=this.getPosterCanvas();if(e){var t=e.getContent();if(t&&t.length)return t[0].getBody()[0].id}return null},e.prototype.getAccompanyingCanvasImage=function(){var e=this.getAccompanyingCanvas();if(e){var t=e.getContent();if(t&&t.length)return t[0].getBody()[0].id}return null},e.prototype.getPreviousRange=function(e){var t;if(t=e||this.getCurrentRange()){var r=this.getFlattenedTree();if(r)for(var n=0;n<r.length;n++){var i=r[n];if(i&&i.data.id===t.id){for(;n>0;)return r[--n].data;break}}}return null},e.prototype.getNextRange=function(e){var t;if(t=e||this.getCurrentRange()){var r=this.getFlattenedTree();if(r)for(var n=0;n<r.length;n++){var i=r[n];if(i&&i.data.id===t.id){for(;n<r.length-1;){var o=r[++n];if(o.data.canvases&&o.data.canvases.length)return o.data}break}}}return null},e.prototype.getFlattenedTree=function(e){var t;return(t=e||this.getTree())?this._flattenTree(t,"nodes"):null},e.prototype._flattenTree=function(e,t){var r=this,n=[e];return e[t]&&e[t].length>0?n.concat(e[t].map((function(e){return r._flattenTree(e,t)})).reduce((function(e,t){return e.concat(t)}),[])):n},e.prototype.getRanges=function(){return this.manifest.getAllRanges()},e.prototype.getRangeByPath=function(e){if(!this.manifest)throw new Error(s.Errors.manifestNotLoaded);return this.manifest.getRangeByPath(e)},e.prototype.getRangeById=function(e){if(!this.manifest)throw new Error(s.Errors.manifestNotLoaded);return this.manifest.getRangeById(e)},e.prototype.getRangeCanvases=function(e){var t=e.getCanvasIds();return this.getCanvasesById(t)},e.prototype.getRelated=function(){if(!this.manifest)throw new Error(s.Errors.manifestNotLoaded);return this.manifest.getRelated()},e.prototype.getSearchService=function(){if(!this.manifest)throw new Error(s.Errors.manifestNotLoaded);var e=this.manifest.getService(a.ServiceProfile.SEARCH_0);return e||(e=this.manifest.getService(a.ServiceProfile.SEARCH_1)),e},e.prototype.getSeeAlso=function(){if(!this.manifest)throw new Error(s.Errors.manifestNotLoaded);return this.manifest.getSeeAlso()},e.prototype.getSequenceByIndex=function(e){if(!this.manifest)throw new Error(s.Errors.manifestNotLoaded);return this.manifest.getSequenceByIndex(e)},e.prototype.getShareServiceUrl=function(){if(!this.manifest)throw new Error(s.Errors.manifestNotLoaded);var e=null,t=this.manifest.getService(a.ServiceProfile.SHARE_EXTENSIONS);return t&&(t.length&&(t=t[0]),e=t.__jsonld.shareUrl),e},e.prototype._getSortedTreeNodesByDate=function(e,t){var r=this.getFlattenedTree(t);if(r){var n=r.filter((function(e){return e.data.type===u.TreeNodeType.MANIFEST}));this.createDecadeNodes(e,r),this.sortDecadeNodes(e),this.createYearNodes(e,r),this.sortYearNodes(e),this.createMonthNodes(e,n),this.sortMonthNodes(e),this.createDateNodes(e,n),this.pruneDecadeNodes(e)}},e.prototype.getStartCanvasIndex=function(){return this.getCurrentSequence().getStartCanvasIndex()},e.prototype.getThumbs=function(e,t){return this.getCurrentSequence().getThumbs(e,t)},e.prototype.getTopRanges=function(){if(!this.manifest)throw new Error(s.Errors.manifestNotLoaded);return this.manifest.getTopRanges()},e.prototype.getTotalCanvases=function(){return this.getCurrentSequence().getTotalCanvases()},e.prototype.getTrackingLabel=function(){if(!this.manifest)throw new Error(s.Errors.manifestNotLoaded);return this.manifest.getTrackingLabel()},e.prototype._getTopRanges=function(){return this.iiifResource.getTopRanges()},e.prototype.getTree=function(e,t){if(void 0===e&&(e=0),void 0===t&&(t=o.TreeSortType.NONE),!this.iiifResource)return null;var r;if(this.iiifResource.isCollection())r=this.iiifResource.getDefaultTree();else{var n=this._getTopRanges(),i=new u.TreeNode;if(i.label="root",i.data=this.iiifResource,!n.length)return i;r=n[e].getTree(i)}var a=new u.TreeNode;if(t.toString()===o.TreeSortType.DATE.toString())if(this.treeHasNavDates(r))return this._getSortedTreeNodesByDate(a,r),a;return r},e.prototype.treeHasNavDates=function(e){var t=this.getFlattenedTree(e);return!!t&&t.some((function(e){return!isNaN(e.navDate)}))},e.prototype.getViewingDirection=function(){if(!this.manifest)throw new Error(s.Errors.manifestNotLoaded);var e=this.getCurrentSequence().getViewingDirection();return e||(e=this.manifest.getViewingDirection()),e},e.prototype.getViewingHint=function(){if(!this.manifest)throw new Error(s.Errors.manifestNotLoaded);var e=this.getCurrentSequence().getViewingHint();return e||(e=this.manifest.getViewingHint()),e},e.prototype.hasParentCollection=function(){if(!this.manifest)throw new Error(s.Errors.manifestNotLoaded);return!!this.manifest.parentCollection},e.prototype.hasRelatedPage=function(){var e=this.getRelated();return!!e&&(e.length&&(e=e[0]),"text/html"===e.format)},e.prototype.hasResources=function(){return this.getCurrentCanvas().getResources().length>0},e.prototype.isBottomToTop=function(){var e=this.getViewingDirection();return!!e&&e===a.ViewingDirection.BOTTOM_TO_TOP},e.prototype.isCanvasIndexOutOfRange=function(e){return this.getCurrentSequence().isCanvasIndexOutOfRange(e)},e.prototype.isContinuous=function(){var e=this.getViewingHint();return!!e&&e===a.ViewingHint.CONTINUOUS},e.prototype.isFirstCanvas=function(e){return void 0!==e?this.getCurrentSequence().isFirstCanvas(e):this.getCurrentSequence().isFirstCanvas(this.canvasIndex)},e.prototype.isHorizontallyAligned=function(){return this.isLeftToRight()||this.isRightToLeft()},e.prototype.isLastCanvas=function(e){return void 0!==e?this.getCurrentSequence().isLastCanvas(e):this.getCurrentSequence().isLastCanvas(this.canvasIndex)},e.prototype.isLeftToRight=function(){var e=this.getViewingDirection();return!!e&&e===a.ViewingDirection.LEFT_TO_RIGHT},e.prototype.isMultiCanvas=function(){return this.getCurrentSequence().isMultiCanvas()},e.prototype.isMultiSequence=function(){if(!this.manifest)throw new Error(s.Errors.manifestNotLoaded);return this.manifest.isMultiSequence()},e.prototype.isPaged=function(){if(!this.manifest)throw new Error(s.Errors.manifestNotLoaded);var e=this.getViewingHint();return e?e===a.ViewingHint.PAGED:this.manifest.isPagingEnabled()},e.prototype.isPagingAvailable=function(){return this.isPagingEnabled()&&this.getTotalCanvases()>2},e.prototype.isPagingEnabled=function(){if(!this.manifest)throw new Error(s.Errors.manifestNotLoaded);return this.manifest.isPagingEnabled()||this.getCurrentSequence().isPagingEnabled()},e.prototype.isRightToLeft=function(){var e=this.getViewingDirection();return!!e&&e===a.ViewingDirection.RIGHT_TO_LEFT},e.prototype.isTopToBottom=function(){var e=this.getViewingDirection();return!!e&&e===a.ViewingDirection.TOP_TO_BOTTOM},e.prototype.isTotalCanvasesEven=function(){return this.getCurrentSequence().isTotalCanvasesEven()},e.prototype.isUIEnabled=function(e){if(!this.manifest)throw new Error(s.Errors.manifestNotLoaded);var t=this.manifest.getService(a.ServiceProfile.UI_EXTENSIONS);if(t){var r=t.getProperty("disableUI");if(r&&(-1!==r.indexOf(e)||-1!==r.indexOf(e.toLowerCase())))return!1}return!0},e.prototype.isVerticallyAligned=function(){return this.isTopToBottom()||this.isBottomToTop()},e.prototype.createDateNodes=function(e,t){for(var r=0;r<t.length;r++){var n=t[r],i=this.getNodeYear(n),o=this.getNodeMonth(n),a=new u.TreeNode;a.id=n.id,a.label=this.getNodeDisplayDate(n),a.data=n.data,a.data.type=u.TreeNodeType.MANIFEST,a.data.year=i,a.data.month=o;var s=this.getDecadeNode(e,i);if(s){var c=this.getYearNode(s,i);if(c){var l=this.getMonthNode(c,o);l&&l.addNode(a)}}}},e.prototype.createDecadeNodes=function(e,t){for(var r=0;r<t.length;r++){var n=t[r];if(n.navDate){var i=this.getNodeYear(n),o=Number(i.toString().substr(0,3)+"9");if(!this.getDecadeNode(e,i)){var a=new u.TreeNode;a.label=i+" - "+o,a.navDate=n.navDate,a.data.startYear=i,a.data.endYear=o,e.addNode(a)}}}},e.prototype.createMonthNodes=function(e,t){for(var r=0;r<t.length;r++){var n=t[r];if(n.navDate){var i=this.getNodeYear(n),o=this.getNodeMonth(n),a=this.getDecadeNode(e,i),s=null;if(a&&(s=this.getYearNode(a,i)),a&&s&&!this.getMonthNode(s,o)){var c=new u.TreeNode;c.label=this.getNodeDisplayMonth(n),c.navDate=n.navDate,c.data.year=i,c.data.month=o,s.addNode(c)}}}},e.prototype.createYearNodes=function(e,t){for(var r=0;r<t.length;r++){var n=t[r];if(n.navDate){var i=this.getNodeYear(n),o=this.getDecadeNode(e,i);if(o&&!this.getYearNode(o,i)){var a=new u.TreeNode;a.label=i.toString(),a.navDate=n.navDate,a.data.year=i,o.addNode(a)}}}},e.prototype.getDecadeNode=function(e,t){for(var r=0;r<e.nodes.length;r++){var n=e.nodes[r];if(t>=n.data.startYear&&t<=n.data.endYear)return n}return null},e.prototype.getMonthNode=function(e,t){for(var r=0;r<e.nodes.length;r++){var n=e.nodes[r];if(t===this.getNodeMonth(n))return n}return null},e.prototype.getNodeDisplayDate=function(e){return e.navDate.toDateString()},e.prototype.getNodeDisplayMonth=function(e){return["January","February","March","April","May","June","July","August","September","October","November","December"][e.navDate.getMonth()]},e.prototype.getNodeMonth=function(e){return e.navDate.getMonth()},e.prototype.getNodeYear=function(e){return e.navDate.getFullYear()},e.prototype.getYearNode=function(e,t){for(var r=0;r<e.nodes.length;r++){var n=e.nodes[r];if(t===this.getNodeYear(n))return n}return null},e.prototype.pruneDecadeNodes=function(e){for(var t=[],r=0;r<e.nodes.length;r++){var n=e.nodes[r];n.nodes.length||t.push(n)}for(var i=0;i<t.length;i++){var o=t[i],a=e.nodes.indexOf(o);a>-1&&e.nodes.splice(a,1)}},e.prototype.sortDecadeNodes=function(e){e.nodes=e.nodes.sort((function(e,t){return e.data.startYear-t.data.startYear}))},e.prototype.sortMonthNodes=function(e){for(var t=this,r=0;r<e.nodes.length;r++)for(var n=e.nodes[r],i=0;i<n.nodes.length;i++){var o=n.nodes[i];o.nodes=o.nodes.sort((function(e,r){return t.getNodeMonth(e)-t.getNodeMonth(r)}))}},e.prototype.sortYearNodes=function(e){for(var t=this,r=0;r<e.nodes.length;r++){var n=e.nodes[r];n.nodes=n.nodes.sort((function(e,r){return t.getNodeYear(e)-t.getNodeYear(r)}))}},e}();t.Helper=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),i=function(){function e(){this.isEnabled=!1,this.ranges=[],this.canvases=[]}return e.prototype.allCanvasesSelected=function(){return this.canvases.length>0&&this.getAllSelectedCanvases().length===this.canvases.length},e.prototype.allRangesSelected=function(){return this.ranges.length>0&&this.getAllSelectedRanges().length===this.ranges.length},e.prototype.allSelected=function(){return this.allRangesSelected()&&this.allCanvasesSelected()},e.prototype.getAll=function(){return this.canvases.concat(this.ranges)},e.prototype.getAllSelectedCanvases=function(){return this.canvases.filter((function(e){return e.multiSelected}))},e.prototype.getAllSelectedRanges=function(){return this.ranges.filter((function(e){return e.multiSelected}))},e.prototype.getCanvasById=function(e){return this.canvases.filter((function(t){return n.Utils.normaliseUrl(t.id)===n.Utils.normaliseUrl(e)}))[0]},e.prototype.getCanvasesByIds=function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];t.push(this.getCanvasById(n))}return t},e.prototype.getRangeCanvases=function(e){var t=e.getCanvasIds();return this.getCanvasesByIds(t)},e.prototype.selectAll=function(e){this.selectRanges(this.ranges,e),this.selectCanvases(this.canvases,e)},e.prototype.selectCanvas=function(e,t){this.canvases.filter((function(t){return t.id===e.id}))[0].multiSelected=t},e.prototype.selectAllCanvases=function(e){this.selectCanvases(this.canvases,e)},e.prototype.selectCanvases=function(e,t){for(var r=0;r<e.length;r++)e[r].multiSelected=t},e.prototype.selectRange=function(e,t){var r=this.ranges.filter((function(t){return t.id===e.id}))[0];r.multiSelected=t;var n=this.getRangeCanvases(r);this.selectCanvases(n,t)},e.prototype.selectAllRanges=function(e){this.selectRanges(this.ranges,e)},e.prototype.selectRanges=function(e,t){for(var r=0;r<e.length;r++){var n=e[r];n.multiSelected=t;var i=this.getCanvasesByIds(n.getCanvasIds());this.selectCanvases(i,t)}},e.prototype.setEnabled=function(e){this.isEnabled=e;for(var t=this.getAll(),r=0;r<t.length;r++){var n=t[r];n.multiSelectEnabled=this.isEnabled,e||(n.multiSelected=!1)}},e}();t.MultiSelectState=i},function(e,t,r){var n=r(18),i=r(19);e.exports=function e(t,r,o,a,s){var u=-1,c=t.length;for(o||(o=i),s||(s=[]);++u<c;){var l=t[u];r>0&&o(l)?r>1?e(l,r-1,o,a,s):n(s,l):a||(s[s.length]=l)}return s}},function(e,t){e.exports=function(e){return null!=e&&"object"==typeof e}},function(e,t,r){"use strict";r.r(t),t.default=function(e,t){return t=t||{},new Promise((function(r,n){var i=new XMLHttpRequest,o=[],a=[],s={},u=function(){return{ok:2==(i.status/100|0),statusText:i.statusText,status:i.status,url:i.responseURL,text:function(){return Promise.resolve(i.responseText)},json:function(){return Promise.resolve(i.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([i.response]))},clone:u,headers:{keys:function(){return o},entries:function(){return a},get:function(e){return s[e.toLowerCase()]},has:function(e){return e.toLowerCase()in s}}}};for(var c in i.open(t.method||"get",e,!0),i.onload=function(){i.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,(function(e,t,r){o.push(t=t.toLowerCase()),a.push([t,r]),s[t]=s[t]?s[t]+","+r:r})),r(u())},i.onerror=n,i.withCredentials="include"==t.credentials,t.headers)i.setRequestHeader(c,t.headers[c]);i.send(t.body||null)}))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.items=[],this.resource=e,this.label=t}return e.prototype.addItem=function(e){this.items.push(e)},e.prototype.addMetadata=function(e,t){void 0===t&&(t=!1);for(var r=0;r<e.length;r++){var n=e[r];n.isRootLevel=t,this.addItem(n)}},e}();t.MetadataGroup=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.DATE="date",e.NONE="none"}(t.TreeSortType||(t.TreeSortType={}))},function(e,t,r){e.exports=r(16)},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(17)),n(r(6)),n(r(7)),n(r(31)),n(r(8)),n(r(33)),n(r(13)),n(r(34)),n(r(9)),n(r(35)),n(r(14)),n(r(36));var i=r(7);t.loadManifest=function(e){return new i.Bootstrapper(e).bootstrap()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(6),i=function(){function e(e,t){this.rects=[],this.canvasIndex=t,this.addRect(e)}return e.prototype.addRect=function(e){var t=new n.AnnotationRect(e);t.canvasIndex=this.canvasIndex,t.index=this.rects.length,this.rects.push(t),this.rects.sort((function(e,t){return e.index-t.index}))},e}();t.AnnotationGroup=i},function(e,t){e.exports=function(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}},function(e,t,r){var n=r(4),i=r(23),o=r(28),a=n?n.isConcatSpreadable:void 0;e.exports=function(e){return o(e)||i(e)||!!(a&&e&&e[a])}},function(e,t,r){var n=r(21),i="object"==typeof self&&self&&self.Object===Object&&self,o=n||i||Function("return this")();e.exports=o},function(e,t,r){(function(t){var r="object"==typeof t&&t&&t.Object===Object&&t;e.exports=r}).call(this,r(22))},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){var n=r(24),i=r(11),o=Object.prototype,a=o.hasOwnProperty,s=o.propertyIsEnumerable,u=n(function(){return arguments}())?n:function(e){return i(e)&&a.call(e,"callee")&&!s.call(e,"callee")};e.exports=u},function(e,t,r){var n=r(25),i=r(11);e.exports=function(e){return i(e)&&"[object Arguments]"==n(e)}},function(e,t,r){var n=r(4),i=r(26),o=r(27),u=n?n.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":u&&u in Object(e)?i(e):o(e)}},function(e,t,r){var n=r(4),i=Object.prototype,o=i.hasOwnProperty,a=i.toString,s=n?n.toStringTag:void 0;e.exports=function(e){var t=o.call(e,s),r=e[s];try{e[s]=void 0;var n=!0}catch(e){}var i=a.call(e);return n&&(t?e[s]=r:delete e[s]),i}},function(e,t){var r=Object.prototype.toString;e.exports=function(e){return r.call(e)}},function(e,t){var r=Array.isArray;e.exports=r},function(e,t,r){e.exports=self.fetch||(self.fetch=r(12).default||r(12))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.manifestNotLoaded="Manifest has not loaded yet",e}();t.Errors=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(32),o=r(2),a=function(){function e(e,t){this.authHoldingPage=null,this.clickThroughService=null,this.externalService=null,this.isProbed=!1,this.isResponseHandled=!1,this.kioskService=null,this.loginService=null,this.logoutService=null,this.probeService=null,this.restrictedService=null,this.tokenService=null,e.externalResource=this,this.dataUri=this._getDataUri(e),this.index=e.index,this.authAPIVersion=t.authApiVersion,this._parseAuthServices(e),this._parseCanvasDimensions(e)}return e.prototype._getImageServiceDescriptor=function(e){for(var t=null,r=0;r<e.length;r++){var n=e[r],i=n.id;i.endsWith("/")||(i+="/"),o.Utils.isImageProfile(n.getProfile())&&(t=i+"info.json")}return t},e.prototype._getDataUri=function(e){var t=e.getContent(),r=e.getImages(),i=null;if(t&&t.length){var o=t[0].getBody();return o.length?(a=o[0].getServices()).length&&(i=this._getImageServiceDescriptor(a))?i:o[0].id:null}if(r&&r.length){var a,s=r[0].getResource();return(a=s.getServices()).length&&(i=this._getImageServiceDescriptor(a))?i:s.id}var u=e.getService(n.ServiceProfile.IXIF);return u?u.getInfoUri():e.id},e.prototype._parseAuthServices=function(e){if(.9===this.authAPIVersion)this.clickThroughService=o.Utils.getService(e,n.ServiceProfile.AUTH_0_CLICK_THROUGH),this.loginService=o.Utils.getService(e,n.ServiceProfile.AUTH_0_LOGIN),this.restrictedService=o.Utils.getService(e,n.ServiceProfile.AUTH_0_RESTRICTED),this.clickThroughService?(this.logoutService=this.clickThroughService.getService(n.ServiceProfile.AUTH_0_LOGOUT),this.tokenService=this.clickThroughService.getService(n.ServiceProfile.AUTH_0_TOKEN)):this.loginService?(this.logoutService=this.loginService.getService(n.ServiceProfile.AUTH_0_LOGOUT),this.tokenService=this.loginService.getService(n.ServiceProfile.AUTH_0_TOKEN)):this.restrictedService&&(this.logoutService=this.restrictedService.getService(n.ServiceProfile.AUTH_0_LOGOUT),this.tokenService=this.restrictedService.getService(n.ServiceProfile.AUTH_0_TOKEN));else{if(void 0!==e.isCanvas&&e.isCanvas()){var t=e.getContent();if(t&&t.length){var r=t[0].getBody();r&&r.length&&(e=r[0])}}this.clickThroughService=o.Utils.getService(e,n.ServiceProfile.AUTH_1_CLICK_THROUGH),this.loginService=o.Utils.getService(e,n.ServiceProfile.AUTH_1_LOGIN),this.externalService=o.Utils.getService(e,n.ServiceProfile.AUTH_1_EXTERNAL),this.kioskService=o.Utils.getService(e,n.ServiceProfile.AUTH_1_KIOSK),this.clickThroughService?(this.logoutService=this.clickThroughService.getService(n.ServiceProfile.AUTH_1_LOGOUT),this.tokenService=this.clickThroughService.getService(n.ServiceProfile.AUTH_1_TOKEN),this.probeService=this.clickThroughService.getService(n.ServiceProfile.AUTH_1_PROBE)):this.loginService?(this.logoutService=this.loginService.getService(n.ServiceProfile.AUTH_1_LOGOUT),this.tokenService=this.loginService.getService(n.ServiceProfile.AUTH_1_TOKEN),this.probeService=this.loginService.getService(n.ServiceProfile.AUTH_1_PROBE)):this.externalService?(this.logoutService=this.externalService.getService(n.ServiceProfile.AUTH_1_LOGOUT),this.tokenService=this.externalService.getService(n.ServiceProfile.AUTH_1_TOKEN),this.probeService=this.externalService.getService(n.ServiceProfile.AUTH_1_PROBE)):this.kioskService&&(this.logoutService=this.kioskService.getService(n.ServiceProfile.AUTH_1_LOGOUT),this.tokenService=this.kioskService.getService(n.ServiceProfile.AUTH_1_TOKEN),this.probeService=this.kioskService.getService(n.ServiceProfile.AUTH_1_PROBE))}},e.prototype._parseCanvasDimensions=function(e){var t=e.getImages();if(t&&t.length){var r=t[0].getResource();this.width=r.getWidth(),this.height=r.getHeight()}else if((t=e.getContent()).length){var n=t[0].getBody();n.length&&(this.width=n[0].getWidth(),this.height=n[0].getHeight())}},e.prototype._parseDescriptorDimensions=function(e){void 0!==e.width&&(this.width=e.width),void 0!==e.height&&(this.height=e.height)},e.prototype.isAccessControlled=function(){return!!(this.clickThroughService||this.loginService||this.externalService||this.kioskService||this.probeService)},e.prototype.hasServiceDescriptor=function(){return!!this.dataUri&&this.dataUri.endsWith("info.json")},e.prototype.getData=function(e){var t=this;return t.data={},new Promise((function(r,n){if(t.dataUri)if(t.probeService){t.isProbed=!0;var o=new XMLHttpRequest;o.open("GET",t.probeService.id,!0),o.withCredentials=!0,o.onload=function(){var e=JSON.parse(o.responseText);unescape(e.contentLocation)!==t.dataUri?t.status=i.MOVED_TEMPORARILY:t.status=i.OK,r(t)},o.onerror=function(){t.status=o.status,r(t)},o.send()}else{var a="GET";if(!t.hasServiceDescriptor()){if(!t.isAccessControlled())return t.status=i.OK,void r(t);a="HEAD"}var s=new XMLHttpRequest;s.open(a,t.dataUri,!0),e&&s.setRequestHeader("Authorization","Bearer "+e.accessToken),s.onload=function(){if(s.responseText){var e=JSON.parse(s.responseText),n=unescape(e["@id"]);t.data=e,t._parseAuthServices(t.data),t._parseDescriptorDimensions(t.data),n.endsWith("/info.json")&&(n=n.substr(0,n.lastIndexOf("/")));var o=t.dataUri;o&&o.endsWith("/info.json")&&(o=o.substr(0,o.lastIndexOf("/"))),n!==o&&t.loginService?t.status=i.MOVED_TEMPORARILY:t.status=i.OK,r(t)}else t.status=i.OK,r(t)},s.onerror=function(){t.status=s.status,s.responseText&&t._parseAuthServices(JSON.parse(s.responseText)),r(t)},s.send()}else n("There is no dataUri to fetch")}))},e}();t.ExternalResource=a},function(e,t,r){window,e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){e.exports=r(1)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONTINUE=100,t.SWITCHING_PROTOCOLS=101,t.PROCESSING=102,t.OK=200,t.CREATED=201,t.ACCEPTED=202,t.NON_AUTHORITATIVE_INFORMATION=203,t.NO_CONTENT=204,t.RESET_CONTENT=205,t.PARTIAL_CONTENT=206,t.MULTI_STATUS=207,t.MULTIPLE_CHOICES=300,t.MOVED_PERMANENTLY=301,t.MOVED_TEMPORARILY=302,t.SEE_OTHER=303,t.NOT_MODIFIED=304,t.USE_PROXY=305,t.TEMPORARY_REDIRECT=307,t.BAD_REQUEST=400,t.UNAUTHORIZED=401,t.PAYMENT_REQUIRED=402,t.FORBIDDEN=403,t.NOT_FOUND=404,t.METHOD_NOT_ALLOWED=405,t.NOT_ACCEPTABLE=406,t.PROXY_AUTHENTICATION_REQUIRED=407,t.REQUEST_TIME_OUT=408,t.CONFLICT=409,t.GONE=410,t.LENGTH_REQUIRED=411,t.PRECONDITION_FAILED=412,t.REQUEST_ENTITY_TOO_LARGE=413,t.REQUEST_URI_TOO_LARGE=414,t.UNSUPPORTED_MEDIA_TYPE=415,t.REQUESTED_RANGE_NOT_SATISFIABLE=416,t.EXPECTATION_FAILED=417,t.IM_A_TEAPOT=418,t.UNPROCESSABLE_ENTITY=422,t.LOCKED=423,t.FAILED_DEPENDENCY=424,t.UNORDERED_COLLECTION=425,t.UPGRADE_REQUIRED=426,t.PRECONDITION_REQUIRED=428,t.TOO_MANY_REQUESTS=429,t.REQUEST_HEADER_FIELDS_TOO_LARGE=431,t.INTERNAL_SERVER_ERROR=500,t.NOT_IMPLEMENTED=501,t.BAD_GATEWAY=502,t.SERVICE_UNAVAILABLE=503,t.GATEWAY_TIME_OUT=504,t.HTTP_VERSION_NOT_SUPPORTED=505,t.VARIANT_ALSO_NEGOTIATES=506,t.INSUFFICIENT_STORAGE=507,t.BANDWIDTH_LIMIT_EXCEEDED=509,t.NOT_EXTENDED=510,t.NETWORK_AUTHENTICATION_REQUIRED=511}])},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ILabelValuePair=function(){}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MetadataOptions=function(){}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Translation=function(e,t){this.value=e,this.locale=t}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.labels=e}return e.prototype.format=function(e){return-1!=e.indexOf("<a")?e:'<a href="'+e+'">'+(this.labels[e]?this.labels[e]:e)+"</a>"},e}();t.UriLabeller=n}])})),define("lib/manifold.js",(function(){})),function(Utils){var Async=function(){function Async(){}return Async.waitFor=function(test,successCallback,failureCallback,interval,maxTries,numTries){interval||(interval=200),maxTries||(maxTries=100),numTries||(numTries=0),(numTries+=1)>maxTries?failureCallback&&failureCallback():test()?successCallback():setTimeout((function(){Async.waitFor(test,successCallback,failureCallback,interval,maxTries,numTries)}),interval)},Async}();Utils.Async=Async;var Bools=function(){function Bools(){}return Bools.getBool=function(val,defaultVal){return null==val?defaultVal:val},Bools}();Utils.Bools=Bools;var Clipboard=function(){function Clipboard(){}return Clipboard.supportsCopy=function(){return document.queryCommandSupported&&document.queryCommandSupported("copy")},Clipboard.copy=function(text){text=Clipboard.convertBrToNewLine(text);var textArea=document.createElement("textarea");textArea.value=text,Clipboard.hideButKeepEnabled(textArea),document.body.appendChild(textArea),textArea.focus(),textArea.select(),document.execCommand("copy"),document.body.removeChild(textArea)},Clipboard.hideButKeepEnabled=function(textArea){textArea.style.position="fixed",textArea.style.top="0",textArea.style.left="0",textArea.style.width="2em",textArea.style.height="2em",textArea.style.padding="0",textArea.style.border="none",textArea.style.outline="none",textArea.style.boxShadow="none",textArea.style.background="transparent"},Clipboard.convertBrToNewLine=function(text){return text=text.replace(/<br\s*[\/]?>/gi,"\n")},Clipboard}();Utils.Clipboard=Clipboard;var Colors=function(){function Colors(){}return Colors.float32ColorToARGB=function(float32Color){return[(4278190080&float32Color)>>>24,(16711680&float32Color)>>>16,(65280&float32Color)>>>8,255&float32Color]},Colors._componentToHex=function(c){var hex=c.toString(16);return 1==hex.length?"0"+hex:hex},Colors.rgbToHexString=function(rgb){return Colors.coalesce(rgb),"#"+Colors._componentToHex(rgb[0])+Colors._componentToHex(rgb[1])+Colors._componentToHex(rgb[2])},Colors.argbToHexString=function(argb){return"#"+Colors._componentToHex(argb[0])+Colors._componentToHex(argb[1])+Colors._componentToHex(argb[2])+Colors._componentToHex(argb[3])},Colors.coalesce=function(arr){for(var i=1;i<arr.length;i++)void 0===arr[i]&&(arr[i]=arr[i-1])},Colors}();Utils.Colors=Colors;var Dates=function(){function Dates(){}return Dates.getTimeStamp=function(){return(new Date).getTime()},Dates}();Utils.Dates=Dates;var Device=function(){function Device(){}return Device.getPixelRatio=function(ctx){return(window.devicePixelRatio||1)/(ctx.webkitBackingStorePixelRatio||ctx.mozBackingStorePixelRatio||ctx.msBackingStorePixelRatio||ctx.oBackingStorePixelRatio||ctx.backingStorePixelRatio||1)},Device.isTouch=function(){return!!("ontouchstart"in window)||window.navigator.msMaxTouchPoints>0},Device}();Utils.Device=Device;var Documents=function(){function Documents(){}return Documents.isInIFrame=function(){try{return window.self!==window.top}catch(e){return!0}},Documents.supportsFullscreen=function(){var doc=document.documentElement;return void 0!==(doc.requestFullscreen||doc.mozRequestFullScreen||doc.webkitRequestFullScreen||doc.msRequestFullscreen)},Documents.isHidden=function(){return!!Documents.getHiddenProp()},Documents.getHiddenProp=function(){var prefixes=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var i=0;i<prefixes.length;i++)if(prefixes[i]+"Hidden"in document)return prefixes[i]+"Hidden";return null},Documents}();Utils.Documents=Documents;var Events=function(){function Events(){}return Events.debounce=function(fn,debounceDuration){return debounceDuration=debounceDuration||100,function(){if(!fn.debouncing){var args=Array.prototype.slice.apply(arguments);fn.lastReturnVal=fn.apply(window,args),fn.debouncing=!0}return clearTimeout(fn.debounceTimeout),fn.debounceTimeout=setTimeout((function(){fn.debouncing=!1}),debounceDuration),fn.lastReturnVal}},Events}();Utils.Events=Events;var Files=function(){function Files(){}return Files.simplifyMimeType=function(mime){switch(mime){case"text/plain":return"txt";case"image/jpeg":return"jpg";case"application/msword":return"doc";case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":return"docx";default:var parts=mime.split("/");return parts[parts.length-1]}},Files}();Utils.Files=Files;var Keyboard=function(){function Keyboard(){}return Keyboard.getCharCode=function(e){return"number"==typeof e.which?e.which:e.keyCode},Keyboard}();Utils.Keyboard=Keyboard;var Maths=function(){function Maths(){}return Maths.normalise=function(num,min,max){return(num-min)/(max-min)},Maths.median=function(values){values.sort((function(a,b){return a-b}));var half=Math.floor(values.length/2);return values.length%2?values[half]:(values[half-1]+values[half])/2},Maths.clamp=function(value,min,max){return Math.min(Math.max(value,min),max)},Maths}();Utils.Maths=Maths;var Size=function(width,height){this.width=width,this.height=height};Utils.Size=Size;var Dimensions=function(){function Dimensions(){}return Dimensions.fitRect=function(width1,height1,width2,height2){var scale,width=0,height=0;return height1/width1<height2/width2?(width=width1*(scale=width2/width1),height=height1*scale):(width=width1*(scale=height2/height1),height=height1*scale),new Size(Math.floor(width),Math.floor(height))},Dimensions.hitRect=function(x,y,w,h,mx,my){return mx>x&&mx<x+w&&my>y&&my<y+h},Dimensions}();Utils.Dimensions=Dimensions;var Numbers=function(){function Numbers(){}return Numbers.numericalInput=function(event){return 46==event.keyCode||8==event.keyCode||9==event.keyCode||27==event.keyCode||65==event.keyCode&&!0===event.ctrlKey||event.keyCode>=35&&event.keyCode<=39||(!(event.shiftKey||(event.keyCode<48||event.keyCode>57)&&(event.keyCode<96||event.keyCode>105))||(event.preventDefault(),!1))},Numbers}();Utils.Numbers=Numbers;var Objects=function(){function Objects(){}return Objects.toPlainObject=function(value){value=Object(value);var result={};for(var key in value)result[key]=value[key];return result},Objects}();Utils.Objects=Objects;var Storage=function(){function Storage(){}return Storage.clear=function(storageType){switch(void 0===storageType&&(storageType=StorageType.memory),storageType.value){case StorageType.memory.value:this._memoryStorage={};break;case StorageType.session.value:sessionStorage.clear();break;case StorageType.local.value:localStorage.clear()}},Storage.clearExpired=function(storageType){void 0===storageType&&(storageType=StorageType.memory);for(var items=this.getItems(storageType),i=0;i<items.length;i++){var item=items[i];this._isExpired(item)&&this.remove(item.key)}},Storage.get=function(key,storageType){void 0===storageType&&(storageType=StorageType.memory);var data=null;switch(storageType.value){case StorageType.memory.value:data=this._memoryStorage[key];break;case StorageType.session.value:data=sessionStorage.getItem(key);break;case StorageType.local.value:data=localStorage.getItem(key)}if(!data)return null;var item=null;try{item=JSON.parse(data)}catch(error){return null}return item?this._isExpired(item)?null:(item.key=key,item):null},Storage._isExpired=function(item){return!((new Date).getTime()<item.expiresAt)},Storage.getItems=function(storageType){void 0===storageType&&(storageType=StorageType.memory);var items=[];switch(storageType.value){case StorageType.memory.value:for(var keys=Object.keys(this._memoryStorage),i=0;i<keys.length;i++){(item=this.get(keys[i],StorageType.memory))&&items.push(item)}break;case StorageType.session.value:for(i=0;i<sessionStorage.length;i++){if(key=sessionStorage.key(i))(item=this.get(key,StorageType.session))&&items.push(item)}break;case StorageType.local.value:for(i=0;i<localStorage.length;i++){var key,item;if(key=localStorage.key(i))(item=this.get(key,StorageType.local))&&items.push(item)}}return items},Storage.remove=function(key,storageType){switch(void 0===storageType&&(storageType=StorageType.memory),storageType.value){case StorageType.memory.value:delete this._memoryStorage[key];break;case StorageType.session.value:sessionStorage.removeItem(key);break;case StorageType.local.value:localStorage.removeItem(key)}},Storage.set=function(key,value,expirationSecs,storageType){void 0===storageType&&(storageType=StorageType.memory);var expirationMS=1e3*expirationSecs,record=new StorageItem;switch(record.value=value,record.expiresAt=(new Date).getTime()+expirationMS,storageType.value){case StorageType.memory.value:this._memoryStorage[key]=JSON.stringify(record);break;case StorageType.session.value:sessionStorage.setItem(key,JSON.stringify(record));break;case StorageType.local.value:localStorage.setItem(key,JSON.stringify(record))}return record},Storage._memoryStorage={},Storage}();Utils.Storage=Storage;var StorageItem=function(){};Utils.StorageItem=StorageItem;var StorageType=function(){function StorageType(value){this.value=value}return StorageType.prototype.toString=function(){return this.value},StorageType.memory=new StorageType("memory"),StorageType.session=new StorageType("session"),StorageType.local=new StorageType("local"),StorageType}();Utils.StorageType=StorageType;var Strings=function(){function Strings(){}return Strings.ellipsis=function(text,chars){if(text.length<=chars)return text;var trimmedText=text.substr(0,chars),lastSpaceIndex=trimmedText.lastIndexOf(" ");return-1!=lastSpaceIndex&&(trimmedText=trimmedText.substr(0,Math.min(trimmedText.length,lastSpaceIndex))),trimmedText+"&hellip;"},Strings.htmlDecode=function(encoded){var div=document.createElement("div");return div.innerHTML=encoded,div.firstChild.nodeValue},Strings.format=function(str){for(var values=[],_i=1;_i<arguments.length;_i++)values[_i-1]=arguments[_i];for(var i=0;i<values.length;i++){var reg=new RegExp("\\{"+i+"\\}","gm");str=str.replace(reg,values[i])}return str},Strings.isAlphanumeric=function(str){return/^[a-zA-Z0-9]*$/.test(str)},Strings.toCssClass=function(str){return str.replace(/[^a-z0-9]/g,(function(s){var c=s.charCodeAt(0);return 32==c?"-":c>=65&&c<=90?"_"+s.toLowerCase():"__"+("000"+c.toString(16)).slice(-4)}))},Strings.toFileName=function(str){return str.replace(/[^a-z0-9]/gi,"_").toLowerCase()},Strings.utf8_to_b64=function(str){return window.btoa(unescape(encodeURIComponent(str)))},Strings}();Utils.Strings=Strings;var Urls=function(){function Urls(){}return Urls.getHashParameter=function(key,doc){return doc||(doc=window.document),doc&&doc.location?this.getHashParameterFromString(key,doc.location.hash):null},Urls.getHashParameterFromString=function(key,url){var match=new RegExp("#.*[?&]"+key+"=([^&]+)(&|$)").exec(url);return match?decodeURIComponent(match[1].replace(/\+/g," ")):null},Urls.setHashParameter=function(key,value,doc){if(doc||(doc=window.document),doc&&doc.location){var newHash="#?"+this.updateURIKeyValuePair(doc.location.hash.replace("#?",""),key,value),url=doc.URL;-1!=url.indexOf("#")&&(url=url.substr(0,url.indexOf("#"))),doc.location.replace(url+newHash)}},Urls.getQuerystringParameter=function(key,w){return w||(w=window),this.getQuerystringParameterFromString(key,w.location.search)},Urls.getQuerystringParameterFromString=function(key,querystring){key=key.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var match=new RegExp("[\\?&]"+key+"=([^&#]*)").exec(querystring);return match?decodeURIComponent(match[1].replace(/\+/g," ")):null},Urls.setQuerystringParameter=function(key,value,doc){if(doc||(doc=window.document),doc&&doc.location){var kvp=this.updateURIKeyValuePair(doc.location.hash.replace("#?",""),key,value);window.location.search=kvp}},Urls.updateURIKeyValuePair=function(uriSegment,key,value){key=encodeURIComponent(key),value=encodeURIComponent(value);var kvp=uriSegment.split("&");""==kvp[0]&&kvp.shift();for(var x,i=kvp.length;i--;)if((x=kvp[i].split("="))[0]==key){x[1]=value,kvp[i]=x.join("=");break}return i<0&&(kvp[kvp.length]=[key,value].join("=")),kvp.join("&")},Urls.getUrlParts=function(url){var a=document.createElement("a");return a.href=url,a},Urls.convertToRelativeUrl=function(url){var parts=this.getUrlParts(url),relUri=parts.pathname+parts.searchWithin;return relUri.startsWith("/")||(relUri="/"+relUri),relUri},Urls}();Utils.Urls=Urls}(Utils||(Utils={})),window.Utils=Utils,define("lib/Utils.js",(function(){})),function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,(function(e){var n=t[o][1][e];return s(n||e)}),l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){var FilterCSS=require("cssfilter").FilterCSS,getDefaultCSSWhiteList=require("cssfilter").getDefaultWhiteList,_=require("./util");function getDefaultWhiteList(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","loop","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],sup:[],strong:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","loop","preload","src","height","width"]}}var defaultCSSFilter=new FilterCSS;function escapeHtml(html){return html.replace(REGEXP_LT,"&lt;").replace(REGEXP_GT,"&gt;")}var REGEXP_LT=/</g,REGEXP_GT=/>/g,REGEXP_QUOTE=/"/g,REGEXP_QUOTE_2=/&quot;/g,REGEXP_ATTR_VALUE_1=/&#([a-zA-Z0-9]*);?/gim,REGEXP_ATTR_VALUE_COLON=/&colon;?/gim,REGEXP_ATTR_VALUE_NEWLINE=/&newline;?/gim,REGEXP_DEFAULT_ON_TAG_ATTR_4=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a)\:/gi,REGEXP_DEFAULT_ON_TAG_ATTR_7=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,REGEXP_DEFAULT_ON_TAG_ATTR_8=/u\s*r\s*l\s*\(.*/gi;function escapeQuote(str){return str.replace(REGEXP_QUOTE,"&quot;")}function unescapeQuote(str){return str.replace(REGEXP_QUOTE_2,'"')}function escapeHtmlEntities(str){return str.replace(REGEXP_ATTR_VALUE_1,(function(str,code){return"x"===code[0]||"X"===code[0]?String.fromCharCode(parseInt(code.substr(1),16)):String.fromCharCode(parseInt(code,10))}))}function escapeDangerHtml5Entities(str){return str.replace(REGEXP_ATTR_VALUE_COLON,":").replace(REGEXP_ATTR_VALUE_NEWLINE," ")}function clearNonPrintableCharacter(str){for(var str2="",i=0,len=str.length;i<len;i++)str2+=str.charCodeAt(i)<32?" ":str.charAt(i);return _.trim(str2)}function friendlyAttrValue(str){return str=clearNonPrintableCharacter(str=escapeDangerHtml5Entities(str=escapeHtmlEntities(str=unescapeQuote(str))))}function escapeAttrValue(str){return str=escapeHtml(str=escapeQuote(str))}var STRIP_COMMENT_TAG_REGEXP=/<!--[\s\S]*?-->/g;exports.whiteList={a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","loop","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],sup:[],strong:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","loop","preload","src","height","width"]},exports.getDefaultWhiteList=getDefaultWhiteList,exports.onTag=function(tag,html,options){},exports.onIgnoreTag=function(tag,html,options){},exports.onTagAttr=function(tag,name,value){},exports.onIgnoreTagAttr=function(tag,name,value){},exports.safeAttrValue=function(tag,name,value,cssFilter){if(value=friendlyAttrValue(value),"href"===name||"src"===name){if("#"===(value=_.trim(value)))return"#";if("http://"!==value.substr(0,7)&&"https://"!==value.substr(0,8)&&"mailto:"!==value.substr(0,7)&&"tel:"!==value.substr(0,4)&&"#"!==value[0]&&"/"!==value[0])return""}else if("background"===name){if(REGEXP_DEFAULT_ON_TAG_ATTR_4.lastIndex=0,REGEXP_DEFAULT_ON_TAG_ATTR_4.test(value))return""}else if("style"===name){if(REGEXP_DEFAULT_ON_TAG_ATTR_7.lastIndex=0,REGEXP_DEFAULT_ON_TAG_ATTR_7.test(value))return"";if(REGEXP_DEFAULT_ON_TAG_ATTR_8.lastIndex=0,REGEXP_DEFAULT_ON_TAG_ATTR_8.test(value)&&(REGEXP_DEFAULT_ON_TAG_ATTR_4.lastIndex=0,REGEXP_DEFAULT_ON_TAG_ATTR_4.test(value)))return"";!1!==cssFilter&&(value=(cssFilter=cssFilter||defaultCSSFilter).process(value))}return value=escapeAttrValue(value)},exports.escapeHtml=escapeHtml,exports.escapeQuote=escapeQuote,exports.unescapeQuote=unescapeQuote,exports.escapeHtmlEntities=escapeHtmlEntities,exports.escapeDangerHtml5Entities=escapeDangerHtml5Entities,exports.clearNonPrintableCharacter=clearNonPrintableCharacter,exports.friendlyAttrValue=friendlyAttrValue,exports.escapeAttrValue=escapeAttrValue,exports.onIgnoreTagStripAll=function(){return""},exports.StripTagBody=function(tags,next){"function"!=typeof next&&(next=function(){});var isRemoveAllTag=!Array.isArray(tags),removeList=[],posStart=!1;return{onIgnoreTag:function(tag,html,options){if(function(tag){return!!isRemoveAllTag||-1!==_.indexOf(tags,tag)}(tag)){if(options.isClosing){var ret="[/removed]",end=options.position+ret.length;return removeList.push([!1!==posStart?posStart:options.position,end]),posStart=!1,ret}return posStart||(posStart=options.position),"[removed]"}return next(tag,html,options)},remove:function(html){var rethtml="",lastPos=0;return _.forEach(removeList,(function(pos){rethtml+=html.slice(lastPos,pos[0]),lastPos=pos[1]})),rethtml+=html.slice(lastPos)}}},exports.stripCommentTag=function(html){return html.replace(STRIP_COMMENT_TAG_REGEXP,"")},exports.stripBlankChar=function(html){var chars=html.split("");return(chars=chars.filter((function(char){var c=char.charCodeAt(0);return 127!==c&&(!(c<=31)||(10===c||13===c))}))).join("")},exports.cssFilter=defaultCSSFilter,exports.getDefaultCSSWhiteList=getDefaultCSSWhiteList},{"./util":4,cssfilter:8}],2:[function(require,module,exports){var DEFAULT=require("./default"),parser=require("./parser"),FilterXSS=require("./xss");for(var i in(exports=module.exports=function(html,options){return new FilterXSS(options).process(html)}).FilterXSS=FilterXSS,DEFAULT)exports[i]=DEFAULT[i];for(var i in parser)exports[i]=parser[i];"undefined"!=typeof window&&(window.filterXSS=module.exports),"undefined"!=typeof self&&"undefined"!=typeof DedicatedWorkerGlobalScope&&self instanceof DedicatedWorkerGlobalScope&&(self.filterXSS=module.exports)},{"./default":1,"./parser":3,"./xss":5}],3:[function(require,module,exports){var _=require("./util");function getTagName(html){var i=_.spaceIndex(html);if(-1===i)var tagName=html.slice(1,-1);else tagName=html.slice(1,i+1);return"/"===(tagName=_.trim(tagName).toLowerCase()).slice(0,1)&&(tagName=tagName.slice(1)),"/"===tagName.slice(-1)&&(tagName=tagName.slice(0,-1)),tagName}function isClosing(html){return"</"===html.slice(0,2)}var REGEXP_ILLEGAL_ATTR_NAME=/[^a-zA-Z0-9_:\.\-]/gim;function findNextEqual(str,i){for(;i<str.length;i++){var c=str[i];if(" "!==c)return"="===c?i:-1}}function findBeforeEqual(str,i){for(;i>0;i--){var c=str[i];if(" "!==c)return"="===c?i:-1}}function stripQuoteWrap(text){return function(text){return'"'===text[0]&&'"'===text[text.length-1]||"'"===text[0]&&"'"===text[text.length-1]}(text)?text.substr(1,text.length-2):text}exports.parseTag=function(html,onTag,escapeHtml){var rethtml="",lastPos=0,tagStart=!1,quoteStart=!1,currentPos=0,len=html.length,currentTagName="",currentHtml="";for(currentPos=0;currentPos<len;currentPos++){var c=html.charAt(currentPos);if(!1===tagStart){if("<"===c){tagStart=currentPos;continue}}else if(!1===quoteStart){if("<"===c){rethtml+=escapeHtml(html.slice(lastPos,currentPos)),tagStart=currentPos,lastPos=currentPos;continue}if(">"===c){rethtml+=escapeHtml(html.slice(lastPos,tagStart)),currentTagName=getTagName(currentHtml=html.slice(tagStart,currentPos+1)),rethtml+=onTag(tagStart,rethtml.length,currentTagName,currentHtml,isClosing(currentHtml)),lastPos=currentPos+1,tagStart=!1;continue}if(('"'===c||"'"===c)&&"="===html.charAt(currentPos-1)){quoteStart=c;continue}}else if(c===quoteStart){quoteStart=!1;continue}}return lastPos<html.length&&(rethtml+=escapeHtml(html.substr(lastPos))),rethtml},exports.parseAttr=function(html,onAttr){var lastPos=0,retAttrs=[],tmpName=!1,len=html.length;function addAttr(name,value){if(!((name=(name=_.trim(name)).replace(REGEXP_ILLEGAL_ATTR_NAME,"").toLowerCase()).length<1)){var ret=onAttr(name,value||"");ret&&retAttrs.push(ret)}}for(var i=0;i<len;i++){var j,c=html.charAt(i);if(!1!==tmpName||"="!==c)if(!1===tmpName||i!==lastPos||'"'!==c&&"'"!==c||"="!==html.charAt(i-1))if(/\s|\n|\t/.test(c)){if(html=html.replace(/\s|\n|\t/g," "),!1===tmpName){if(-1===(j=findNextEqual(html,i))){addAttr(_.trim(html.slice(lastPos,i))),tmpName=!1,lastPos=i+1;continue}i=j-1;continue}if(-1===(j=findBeforeEqual(html,i-1))){addAttr(tmpName,stripQuoteWrap(_.trim(html.slice(lastPos,i)))),tmpName=!1,lastPos=i+1;continue}}else;else{if(-1===(j=html.indexOf(c,i+1)))break;addAttr(tmpName,_.trim(html.slice(lastPos+1,j))),tmpName=!1,lastPos=(i=j)+1}else tmpName=html.slice(lastPos,i),lastPos=i+1}return lastPos<html.length&&(!1===tmpName?addAttr(html.slice(lastPos)):addAttr(tmpName,stripQuoteWrap(_.trim(html.slice(lastPos))))),_.trim(retAttrs.join(" "))}},{"./util":4}],4:[function(require,module,exports){module.exports={indexOf:function(arr,item){var i,j;if(Array.prototype.indexOf)return arr.indexOf(item);for(i=0,j=arr.length;i<j;i++)if(arr[i]===item)return i;return-1},forEach:function(arr,fn,scope){var i,j;if(Array.prototype.forEach)return arr.forEach(fn,scope);for(i=0,j=arr.length;i<j;i++)fn.call(scope,arr[i],i,arr)},trim:function(str){return String.prototype.trim?str.trim():str.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(str){var match=/\s|\n|\t/.exec(str);return match?match.index:-1}}},{}],5:[function(require,module,exports){var FilterCSS=require("cssfilter").FilterCSS,DEFAULT=require("./default"),parser=require("./parser"),parseTag=parser.parseTag,parseAttr=parser.parseAttr,_=require("./util");function isNull(obj){return null==obj}function FilterXSS(options){(options=function(obj){var ret={};for(var i in obj)ret[i]=obj[i];return ret}(options||{})).stripIgnoreTag&&(options.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),options.onIgnoreTag=DEFAULT.onIgnoreTagStripAll),options.whiteList=options.whiteList||DEFAULT.whiteList,options.onTag=options.onTag||DEFAULT.onTag,options.onTagAttr=options.onTagAttr||DEFAULT.onTagAttr,options.onIgnoreTag=options.onIgnoreTag||DEFAULT.onIgnoreTag,options.onIgnoreTagAttr=options.onIgnoreTagAttr||DEFAULT.onIgnoreTagAttr,options.safeAttrValue=options.safeAttrValue||DEFAULT.safeAttrValue,options.escapeHtml=options.escapeHtml||DEFAULT.escapeHtml,this.options=options,!1===options.css?this.cssFilter=!1:(options.css=options.css||{},this.cssFilter=new FilterCSS(options.css))}FilterXSS.prototype.process=function(html){if(!(html=(html=html||"").toString()))return"";var options=this.options,whiteList=options.whiteList,onTag=options.onTag,onIgnoreTag=options.onIgnoreTag,onTagAttr=options.onTagAttr,onIgnoreTagAttr=options.onIgnoreTagAttr,safeAttrValue=options.safeAttrValue,escapeHtml=options.escapeHtml,cssFilter=this.cssFilter;options.stripBlankChar&&(html=DEFAULT.stripBlankChar(html)),options.allowCommentTag||(html=DEFAULT.stripCommentTag(html));var stripIgnoreTagBody=!1;if(options.stripIgnoreTagBody){stripIgnoreTagBody=DEFAULT.StripTagBody(options.stripIgnoreTagBody,onIgnoreTag);onIgnoreTag=stripIgnoreTagBody.onIgnoreTag}var retHtml=parseTag(html,(function(sourcePosition,position,tag,html,isClosing){var ret,info={sourcePosition:sourcePosition,position:position,isClosing:isClosing,isWhite:whiteList.hasOwnProperty(tag)};if(!isNull(ret=onTag(tag,html,info)))return ret;if(info.isWhite){if(info.isClosing)return"</"+tag+">";var attrs=function(html){var i=_.spaceIndex(html);if(-1===i)return{html:"",closing:"/"===html[html.length-2]};var isClosing="/"===(html=_.trim(html.slice(i+1,-1)))[html.length-1];return isClosing&&(html=_.trim(html.slice(0,-1))),{html:html,closing:isClosing}}(html),whiteAttrList=whiteList[tag],attrsHtml=parseAttr(attrs.html,(function(name,value){var ret,isWhiteAttr=-1!==_.indexOf(whiteAttrList,name);return isNull(ret=onTagAttr(tag,name,value,isWhiteAttr))?isWhiteAttr?(value=safeAttrValue(tag,name,value,cssFilter))?name+'="'+value+'"':name:isNull(ret=onIgnoreTagAttr(tag,name,value,isWhiteAttr))?void 0:ret:ret}));html="<"+tag;return attrsHtml&&(html+=" "+attrsHtml),attrs.closing&&(html+=" /"),html+=">"}return isNull(ret=onIgnoreTag(tag,html,info))?escapeHtml(html):ret}),escapeHtml);return stripIgnoreTagBody&&(retHtml=stripIgnoreTagBody.remove(retHtml)),retHtml},module.exports=FilterXSS},{"./default":1,"./parser":3,"./util":4,cssfilter:8}],6:[function(require,module,exports){var DEFAULT=require("./default"),parseStyle=require("./parser");require("./util");function isNull(obj){return null==obj}function FilterCSS(options){(options=function(obj){var ret={};for(var i in obj)ret[i]=obj[i];return ret}(options||{})).whiteList=options.whiteList||DEFAULT.whiteList,options.onAttr=options.onAttr||DEFAULT.onAttr,options.onIgnoreAttr=options.onIgnoreAttr||DEFAULT.onIgnoreAttr,options.safeAttrValue=options.safeAttrValue||DEFAULT.safeAttrValue,this.options=options}FilterCSS.prototype.process=function(css){if(!(css=(css=css||"").toString()))return"";var options=this.options,whiteList=options.whiteList,onAttr=options.onAttr,onIgnoreAttr=options.onIgnoreAttr,safeAttrValue=options.safeAttrValue;return parseStyle(css,(function(sourcePosition,position,name,value,source){var check=whiteList[name],isWhite=!1;if(!0===check?isWhite=check:"function"==typeof check?isWhite=check(value):check instanceof RegExp&&(isWhite=check.test(value)),!0!==isWhite&&(isWhite=!1),value=safeAttrValue(name,value)){var ret,opts={position:position,sourcePosition:sourcePosition,source:source,isWhite:isWhite};return isWhite?isNull(ret=onAttr(name,value,opts))?name+":"+value:ret:isNull(ret=onIgnoreAttr(name,value,opts))?void 0:ret}}))},module.exports=FilterCSS},{"./default":7,"./parser":9,"./util":10}],7:[function(require,module,exports){function getDefaultWhiteList(){var whiteList={"align-content":!1,"align-items":!1,"align-self":!1,"alignment-adjust":!1,"alignment-baseline":!1,all:!1,"anchor-point":!1,animation:!1,"animation-delay":!1,"animation-direction":!1,"animation-duration":!1,"animation-fill-mode":!1,"animation-iteration-count":!1,"animation-name":!1,"animation-play-state":!1,"animation-timing-function":!1,azimuth:!1,"backface-visibility":!1,background:!0,"background-attachment":!0,"background-clip":!0,"background-color":!0,"background-image":!0,"background-origin":!0,"background-position":!0,"background-repeat":!0,"background-size":!0,"baseline-shift":!1,binding:!1,bleed:!1,"bookmark-label":!1,"bookmark-level":!1,"bookmark-state":!1,border:!0,"border-bottom":!0,"border-bottom-color":!0,"border-bottom-left-radius":!0,"border-bottom-right-radius":!0,"border-bottom-style":!0,"border-bottom-width":!0,"border-collapse":!0,"border-color":!0,"border-image":!0,"border-image-outset":!0,"border-image-repeat":!0,"border-image-slice":!0,"border-image-source":!0,"border-image-width":!0,"border-left":!0,"border-left-color":!0,"border-left-style":!0,"border-left-width":!0,"border-radius":!0,"border-right":!0,"border-right-color":!0,"border-right-style":!0,"border-right-width":!0,"border-spacing":!0,"border-style":!0,"border-top":!0,"border-top-color":!0,"border-top-left-radius":!0,"border-top-right-radius":!0,"border-top-style":!0,"border-top-width":!0,"border-width":!0,bottom:!1,"box-decoration-break":!0,"box-shadow":!0,"box-sizing":!0,"box-snap":!0,"box-suppress":!0,"break-after":!0,"break-before":!0,"break-inside":!0,"caption-side":!1,chains:!1,clear:!0,clip:!1,"clip-path":!1,"clip-rule":!1,color:!0,"color-interpolation-filters":!0,"column-count":!1,"column-fill":!1,"column-gap":!1,"column-rule":!1,"column-rule-color":!1,"column-rule-style":!1,"column-rule-width":!1,"column-span":!1,"column-width":!1,columns:!1,contain:!1,content:!1,"counter-increment":!1,"counter-reset":!1,"counter-set":!1,crop:!1,cue:!1,"cue-after":!1,"cue-before":!1,cursor:!1,direction:!1,display:!0,"display-inside":!0,"display-list":!0,"display-outside":!0,"dominant-baseline":!1,elevation:!1,"empty-cells":!1,filter:!1,flex:!1,"flex-basis":!1,"flex-direction":!1,"flex-flow":!1,"flex-grow":!1,"flex-shrink":!1,"flex-wrap":!1,float:!1,"float-offset":!1,"flood-color":!1,"flood-opacity":!1,"flow-from":!1,"flow-into":!1,font:!0,"font-family":!0,"font-feature-settings":!0,"font-kerning":!0,"font-language-override":!0,"font-size":!0,"font-size-adjust":!0,"font-stretch":!0,"font-style":!0,"font-synthesis":!0,"font-variant":!0,"font-variant-alternates":!0,"font-variant-caps":!0,"font-variant-east-asian":!0,"font-variant-ligatures":!0,"font-variant-numeric":!0,"font-variant-position":!0,"font-weight":!0,grid:!1,"grid-area":!1,"grid-auto-columns":!1,"grid-auto-flow":!1,"grid-auto-rows":!1,"grid-column":!1,"grid-column-end":!1,"grid-column-start":!1,"grid-row":!1,"grid-row-end":!1,"grid-row-start":!1,"grid-template":!1,"grid-template-areas":!1,"grid-template-columns":!1,"grid-template-rows":!1,"hanging-punctuation":!1,height:!0,hyphens:!1,icon:!1,"image-orientation":!1,"image-resolution":!1,"ime-mode":!1,"initial-letters":!1,"inline-box-align":!1,"justify-content":!1,"justify-items":!1,"justify-self":!1,left:!1,"letter-spacing":!0,"lighting-color":!0,"line-box-contain":!1,"line-break":!1,"line-grid":!1,"line-height":!1,"line-snap":!1,"line-stacking":!1,"line-stacking-ruby":!1,"line-stacking-shift":!1,"line-stacking-strategy":!1,"list-style":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,margin:!0,"margin-bottom":!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"marker-offset":!1,"marker-side":!1,marks:!1,mask:!1,"mask-box":!1,"mask-box-outset":!1,"mask-box-repeat":!1,"mask-box-slice":!1,"mask-box-source":!1,"mask-box-width":!1,"mask-clip":!1,"mask-image":!1,"mask-origin":!1,"mask-position":!1,"mask-repeat":!1,"mask-size":!1,"mask-source-type":!1,"mask-type":!1,"max-height":!0,"max-lines":!1,"max-width":!0,"min-height":!0,"min-width":!0,"move-to":!1,"nav-down":!1,"nav-index":!1,"nav-left":!1,"nav-right":!1,"nav-up":!1,"object-fit":!1,"object-position":!1,opacity:!1,order:!1,orphans:!1,outline:!1,"outline-color":!1,"outline-offset":!1,"outline-style":!1,"outline-width":!1,overflow:!1,"overflow-wrap":!1,"overflow-x":!1,"overflow-y":!1,padding:!0,"padding-bottom":!0,"padding-left":!0,"padding-right":!0,"padding-top":!0,page:!1,"page-break-after":!1,"page-break-before":!1,"page-break-inside":!1,"page-policy":!1,pause:!1,"pause-after":!1,"pause-before":!1,perspective:!1,"perspective-origin":!1,pitch:!1,"pitch-range":!1,"play-during":!1,position:!1,"presentation-level":!1,quotes:!1,"region-fragment":!1,resize:!1,rest:!1,"rest-after":!1,"rest-before":!1,richness:!1,right:!1,rotation:!1,"rotation-point":!1,"ruby-align":!1,"ruby-merge":!1,"ruby-position":!1,"shape-image-threshold":!1,"shape-outside":!1,"shape-margin":!1,size:!1,speak:!1,"speak-as":!1,"speak-header":!1,"speak-numeral":!1,"speak-punctuation":!1,"speech-rate":!1,stress:!1,"string-set":!1,"tab-size":!1,"table-layout":!1,"text-align":!0,"text-align-last":!0,"text-combine-upright":!0,"text-decoration":!0,"text-decoration-color":!0,"text-decoration-line":!0,"text-decoration-skip":!0,"text-decoration-style":!0,"text-emphasis":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-height":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-overflow":!0,"text-shadow":!0,"text-space-collapse":!0,"text-transform":!0,"text-underline-position":!0,"text-wrap":!0,top:!1,transform:!1,"transform-origin":!1,"transform-style":!1,transition:!1,"transition-delay":!1,"transition-duration":!1,"transition-property":!1,"transition-timing-function":!1,"unicode-bidi":!1,"vertical-align":!1,visibility:!1,"voice-balance":!1,"voice-duration":!1,"voice-family":!1,"voice-pitch":!1,"voice-range":!1,"voice-rate":!1,"voice-stress":!1,"voice-volume":!1,volume:!1,"white-space":!1,widows:!1,width:!0,"will-change":!1,"word-break":!0,"word-spacing":!0,"word-wrap":!0,"wrap-flow":!1,"wrap-through":!1,"writing-mode":!1,"z-index":!1};return whiteList}var REGEXP_URL_JAVASCRIPT=/javascript\s*\:/gim;exports.whiteList=getDefaultWhiteList(),exports.getDefaultWhiteList=getDefaultWhiteList,exports.onAttr=function(name,value,options){},exports.onIgnoreAttr=function(name,value,options){},exports.safeAttrValue=function(name,value){return REGEXP_URL_JAVASCRIPT.test(value)?"":value}},{}],8:[function(require,module,exports){var DEFAULT=require("./default"),FilterCSS=require("./css");for(var i in(exports=module.exports=function(html,options){return new FilterCSS(options).process(html)}).FilterCSS=FilterCSS,DEFAULT)exports[i]=DEFAULT[i];"undefined"!=typeof window&&(window.filterCSS=module.exports)},{"./css":6,"./default":7}],9:[function(require,module,exports){var _=require("./util");module.exports=function(css,onAttr){";"!==(css=_.trimRight(css))[css.length-1]&&(css+=";");var cssLength=css.length,isParenthesisOpen=!1,lastPos=0,i=0,retCSS="";function addNewAttr(){if(!isParenthesisOpen){var source=_.trim(css.slice(lastPos,i)),j=source.indexOf(":");if(-1!==j){var name=_.trim(source.slice(0,j)),value=_.trim(source.slice(j+1));if(name){var ret=onAttr(lastPos,retCSS.length,name,value,source);ret&&(retCSS+=ret+"; ")}}}lastPos=i+1}for(;i<cssLength;i++){var c=css[i];if("/"===c&&"*"===css[i+1]){var j=css.indexOf("*/",i+2);if(-1===j)break;lastPos=(i=j+1)+1,isParenthesisOpen=!1}else"("===c?isParenthesisOpen=!0:")"===c?isParenthesisOpen=!1:";"===c?isParenthesisOpen||addNewAttr():"\n"===c&&addNewAttr()}return _.trim(retCSS)}},{"./util":10}],10:[function(require,module,exports){module.exports={indexOf:function(arr,item){var i,j;if(Array.prototype.indexOf)return arr.indexOf(item);for(i=0,j=arr.length;i<j;i++)if(arr[i]===item)return i;return-1},forEach:function(arr,fn,scope){var i,j;if(Array.prototype.forEach)return arr.forEach(fn,scope);for(i=0,j=arr.length;i<j;i++)fn.call(scope,arr[i],i,arr)},trim:function(str){return String.prototype.trim?str.trim():str.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(str){return String.prototype.trimRight?str.trimRight():str.replace(/(\s*$)/g,"")}}},{}]},{},[2]),define("lib/xss.min.js",(function(){})),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?factory(exports):"function"==typeof define&&define.amd?define("lib/fetch.umd.js",["exports"],factory):factory(global.WHATWGFetch={})}(this,(function(exports){"use strict";var support_searchParams="URLSearchParams"in self,support_iterable="Symbol"in self&&"iterator"in Symbol,support_blob="FileReader"in self&&"Blob"in self&&function(){try{return new Blob,!0}catch(e){return!1}}(),support_formData="FormData"in self,support_arrayBuffer="ArrayBuffer"in self;if(support_arrayBuffer)var viewClasses=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],isArrayBufferView=ArrayBuffer.isView||function(obj){return obj&&viewClasses.indexOf(Object.prototype.toString.call(obj))>-1};function normalizeName(name){if("string"!=typeof name&&(name=String(name)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(name))throw new TypeError("Invalid character in header field name");return name.toLowerCase()}function normalizeValue(value){return"string"!=typeof value&&(value=String(value)),value}function iteratorFor(items){var iterator={next:function(){var value=items.shift();return{done:void 0===value,value:value}}};return support_iterable&&(iterator[Symbol.iterator]=function(){return iterator}),iterator}function Headers(headers){this.map={},headers instanceof Headers?headers.forEach((function(value,name){this.append(name,value)}),this):Array.isArray(headers)?headers.forEach((function(header){this.append(header[0],header[1])}),this):headers&&Object.getOwnPropertyNames(headers).forEach((function(name){this.append(name,headers[name])}),this)}function consumed(body){if(body.bodyUsed)return Promise.reject(new TypeError("Already read"));body.bodyUsed=!0}function fileReaderReady(reader){return new Promise((function(resolve,reject){reader.onload=function(){resolve(reader.result)},reader.onerror=function(){reject(reader.error)}}))}function readBlobAsArrayBuffer(blob){var reader=new FileReader,promise=fileReaderReady(reader);return reader.readAsArrayBuffer(blob),promise}function bufferClone(buf){if(buf.slice)return buf.slice(0);var view=new Uint8Array(buf.byteLength);return view.set(new Uint8Array(buf)),view.buffer}function Body(){return this.bodyUsed=!1,this._initBody=function(body){var obj;this._bodyInit=body,body?"string"==typeof body?this._bodyText=body:support_blob&&Blob.prototype.isPrototypeOf(body)?this._bodyBlob=body:support_formData&&FormData.prototype.isPrototypeOf(body)?this._bodyFormData=body:support_searchParams&&URLSearchParams.prototype.isPrototypeOf(body)?this._bodyText=body.toString():support_arrayBuffer&&support_blob&&((obj=body)&&DataView.prototype.isPrototypeOf(obj))?(this._bodyArrayBuffer=bufferClone(body.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):support_arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(body)||isArrayBufferView(body))?this._bodyArrayBuffer=bufferClone(body):this._bodyText=body=Object.prototype.toString.call(body):this._bodyText="",this.headers.get("content-type")||("string"==typeof body?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):support_searchParams&&URLSearchParams.prototype.isPrototypeOf(body)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},support_blob&&(this.blob=function(){var rejected=consumed(this);if(rejected)return rejected;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?consumed(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(readBlobAsArrayBuffer)}),this.text=function(){var blob,reader,promise,rejected=consumed(this);if(rejected)return rejected;if(this._bodyBlob)return blob=this._bodyBlob,reader=new FileReader,promise=fileReaderReady(reader),reader.readAsText(blob),promise;if(this._bodyArrayBuffer)return Promise.resolve(function(buf){for(var view=new Uint8Array(buf),chars=new Array(view.length),i=0;i<view.length;i++)chars[i]=String.fromCharCode(view[i]);return chars.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},support_formData&&(this.formData=function(){return this.text().then(decode)}),this.json=function(){return this.text().then(JSON.parse)},this}Headers.prototype.append=function(name,value){name=normalizeName(name),value=normalizeValue(value);var oldValue=this.map[name];this.map[name]=oldValue?oldValue+", "+value:value},Headers.prototype.delete=function(name){delete this.map[normalizeName(name)]},Headers.prototype.get=function(name){return name=normalizeName(name),this.has(name)?this.map[name]:null},Headers.prototype.has=function(name){return this.map.hasOwnProperty(normalizeName(name))},Headers.prototype.set=function(name,value){this.map[normalizeName(name)]=normalizeValue(value)},Headers.prototype.forEach=function(callback,thisArg){for(var name in this.map)this.map.hasOwnProperty(name)&&callback.call(thisArg,this.map[name],name,this)},Headers.prototype.keys=function(){var items=[];return this.forEach((function(value,name){items.push(name)})),iteratorFor(items)},Headers.prototype.values=function(){var items=[];return this.forEach((function(value){items.push(value)})),iteratorFor(items)},Headers.prototype.entries=function(){var items=[];return this.forEach((function(value,name){items.push([name,value])})),iteratorFor(items)},support_iterable&&(Headers.prototype[Symbol.iterator]=Headers.prototype.entries);var methods=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function Request(input,options){var method,upcased,body=(options=options||{}).body;if(input instanceof Request){if(input.bodyUsed)throw new TypeError("Already read");this.url=input.url,this.credentials=input.credentials,options.headers||(this.headers=new Headers(input.headers)),this.method=input.method,this.mode=input.mode,this.signal=input.signal,body||null==input._bodyInit||(body=input._bodyInit,input.bodyUsed=!0)}else this.url=String(input);if(this.credentials=options.credentials||this.credentials||"same-origin",!options.headers&&this.headers||(this.headers=new Headers(options.headers)),this.method=(method=options.method||this.method||"GET",upcased=method.toUpperCase(),methods.indexOf(upcased)>-1?upcased:method),this.mode=options.mode||this.mode||null,this.signal=options.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&body)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(body)}function decode(body){var form=new FormData;return body.trim().split("&").forEach((function(bytes){if(bytes){var split=bytes.split("="),name=split.shift().replace(/\+/g," "),value=split.join("=").replace(/\+/g," ");form.append(decodeURIComponent(name),decodeURIComponent(value))}})),form}function Response(bodyInit,options){options||(options={}),this.type="default",this.status=void 0===options.status?200:options.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in options?options.statusText:"OK",this.headers=new Headers(options.headers),this.url=options.url||"",this._initBody(bodyInit)}Request.prototype.clone=function(){return new Request(this,{body:this._bodyInit})},Body.call(Request.prototype),Body.call(Response.prototype),Response.prototype.clone=function(){return new Response(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new Headers(this.headers),url:this.url})},Response.error=function(){var response=new Response(null,{status:0,statusText:""});return response.type="error",response};var redirectStatuses=[301,302,303,307,308];Response.redirect=function(url,status){if(-1===redirectStatuses.indexOf(status))throw new RangeError("Invalid status code");return new Response(null,{status:status,headers:{location:url}})},exports.DOMException=self.DOMException;try{new exports.DOMException}catch(err){exports.DOMException=function(message,name){this.message=message,this.name=name;var error=Error(message);this.stack=error.stack},exports.DOMException.prototype=Object.create(Error.prototype),exports.DOMException.prototype.constructor=exports.DOMException}function fetch(input,init){return new Promise((function(resolve,reject){var request=new Request(input,init);if(request.signal&&request.signal.aborted)return reject(new exports.DOMException("Aborted","AbortError"));var xhr=new XMLHttpRequest;function abortXhr(){xhr.abort()}xhr.onload=function(){var rawHeaders,headers,options={status:xhr.status,statusText:xhr.statusText,headers:(rawHeaders=xhr.getAllResponseHeaders()||"",headers=new Headers,rawHeaders.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(line){var parts=line.split(":"),key=parts.shift().trim();if(key){var value=parts.join(":").trim();headers.append(key,value)}})),headers)};options.url="responseURL"in xhr?xhr.responseURL:options.headers.get("X-Request-URL");var body="response"in xhr?xhr.response:xhr.responseText;resolve(new Response(body,options))},xhr.onerror=function(){reject(new TypeError("Network request failed"))},xhr.ontimeout=function(){reject(new TypeError("Network request failed"))},xhr.onabort=function(){reject(new exports.DOMException("Aborted","AbortError"))},xhr.open(request.method,request.url,!0),"include"===request.credentials?xhr.withCredentials=!0:"omit"===request.credentials&&(xhr.withCredentials=!1),"responseType"in xhr&&support_blob&&(xhr.responseType="blob"),request.headers.forEach((function(value,name){xhr.setRequestHeader(name,value)})),request.signal&&(request.signal.addEventListener("abort",abortXhr),xhr.onreadystatechange=function(){4===xhr.readyState&&request.signal.removeEventListener("abort",abortXhr)}),xhr.send(void 0===request._bodyInit?null:request._bodyInit)}))}fetch.polyfill=!0,self.fetch||(self.fetch=fetch,self.Headers=Headers,self.Request=Request,self.Response=Response),exports.Headers=Headers,exports.Request=Request,exports.Response=Response,exports.fetch=fetch,Object.defineProperty(exports,"__esModule",{value:!0})})),define("UVDataProvider",["require","exports"],(function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var UVDataProvider=function(){function UVDataProvider(readonly){this.readonly=!1,this.readonly=readonly}return UVDataProvider.prototype.get=function(key,defaultValue){return null},UVDataProvider.prototype.set=function(key,value){},UVDataProvider}();exports.UVDataProvider=UVDataProvider}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("URLDataProvider",["require","exports","./UVDataProvider"],(function(require,exports,UVDataProvider_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var URLDataProvider=function(_super){function URLDataProvider(readonly){return _super.call(this,readonly)||this}return __extends(URLDataProvider,_super),URLDataProvider.prototype.get=function(key,defaultValue){return Utils.Urls.getHashParameter(key,document)||defaultValue},URLDataProvider.prototype.set=function(key,value){this.readonly||(value?Utils.Urls.setHashParameter(key,value.toString(),document):Utils.Urls.setHashParameter(key,"",document))},URLDataProvider}(UVDataProvider_1.UVDataProvider);exports.default=URLDataProvider})),function(i,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("vocabulary",[],e):"object"==typeof exports?exports.vocabulary=e():i.vocabulary=e()}("undefined"!=typeof self?self:this,(function(){return function(i){var e={};function t(o){if(e[o])return e[o].exports;var a=e[o]={i:o,l:!1,exports:{}};return i[o].call(a.exports,a,a.exports,t),a.l=!0,a.exports}return t.m=i,t.c=e,t.d=function(i,e,o){t.o(i,e)||Object.defineProperty(i,e,{enumerable:!0,get:o})},t.r=function(i){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},t.t=function(i,e){if(1&e&&(i=t(i)),8&e)return i;if(4&e&&"object"==typeof i&&i&&i.__esModule)return i;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:i}),2&e&&"string"!=typeof i)for(var a in i)t.d(o,a,function(e){return i[e]}.bind(null,a));return o},t.n=function(i){var e=i&&i.__esModule?function(){return i.default}:function(){return i};return t.d(e,"a",e),e},t.o=function(i,e){return Object.prototype.hasOwnProperty.call(i,e)},t.p="",t(t.s=0)}([function(i,e,t){i.exports=t(1)},function(i,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(i){i.BOOKMARKING="oa:bookmarking",i.CLASSIFYING="oa:classifying",i.COMMENTING="oa:commenting",i.DESCRIBING="oa:describing",i.EDITING="oa:editing",i.HIGHLIGHTING="oa:highlighting",i.IDENTIFYING="oa:identifying",i.LINKING="oa:linking",i.MODERATING="oa:moderating",i.PAINTING="sc:painting",i.QUESTIONING="oa:questioning",i.REPLYING="oa:replying",i.TAGGING="oa:tagging",i.TRANSCRIBING="oad:transcribing"}(e.AnnotationMotivation||(e.AnnotationMotivation={})),function(i){i.AUTO_ADVANCE="auto-advance",i.CONTINUOUS="continuous",i.FACING_PAGES="facing-pages",i.HIDDEN="hidden",i.INDIVIDUALS="individuals",i.MULTI_PART="multi-part",i.NO_NAV="no-nav",i.NON_PAGED="non-paged",i.PAGED="paged",i.REPEAT="repeat",i.SEQUENCE="sequence",i.THUMBNAIL_NAV="thumbnail-nav",i.TOGETHER="together",i.UNORDERED="unordered"}(e.Behavior||(e.Behavior={})),function(i){i.CANVAS="canvas",i.CHOICE="choice",i.OA_CHOICE="oa:choice",i.CONTENT_AS_TEXT="contentastext",i.DATASET="dataset",i.DOCUMENT="document",i.IMAGE="image",i.MODEL="model",i.MOVING_IMAGE="movingimage",i.PDF="pdf",i.PHYSICAL_OBJECT="physicalobject",i.SOUND="sound",i.TEXT="text",i.TEXTUALBODY="textualbody",i.VIDEO="video"}(e.ExternalResourceType||(e.ExternalResourceType={})),function(i){i.ANNOTATION="annotation",i.CANVAS="canvas",i.COLLECTION="collection",i.MANIFEST="manifest",i.RANGE="range",i.SEQUENCE="sequence"}(e.IIIFResourceType||(e.IIIFResourceType={})),function(i){i.AUDIO_MP4="audio/mp4",i.CORTO="application/corto",i.DICOM="application/dicom",i.DRACO="application/draco",i.EPUB="application/epub+zip",i.GLB="model/gltf-binary",i.GLTF="model/gltf+json",i.IIIF_PRESENTATION_2='application/ld+json;profile="http://iiif.io/api/presentation/2/context.json"',i.IIIF_PRESENTATION_3='application/ld+json;profile="http://iiif.io/api/presentation/3/context.json"',i.JPG="image/jpeg",i.M3U8="application/vnd.apple.mpegurl",i.MP3="audio/mp3",i.MPEG_DASH="application/dash+xml",i.OBJ="text/plain",i.OPF="application/oebps-package+xml",i.PDF="application/pdf",i.PLY="application/ply",i.THREEJS="application/vnd.threejs+json",i.USDZ="model/vnd.usd+zip",i.VIDEO_MP4="video/mp4",i.WEBM="video/webm"}(e.MediaType||(e.MediaType={})),function(i){i.DOC="application/msword",i.DOCX="application/vnd.openxmlformats-officedocument.wordprocessingml.document",i.PDF="application/pdf"}(e.RenderingFormat||(e.RenderingFormat={})),function(i){i.IMAGE_0_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0",i.IMAGE_0_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1",i.IMAGE_0_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2",i.IMAGE_0_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0",i.IMAGE_0_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1",i.IMAGE_0_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2",i.IMAGE_1_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",i.IMAGE_1_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",i.IMAGE_1_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",i.IMAGE_1_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",i.IMAGE_1_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",i.IMAGE_1_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",i.IMAGE_1_LEVEL_0="http://iiif.io/api/image/1/level0.json",i.IMAGE_1_PROFILE_LEVEL_0="http://iiif.io/api/image/1/profiles/level0.json",i.IMAGE_1_LEVEL_1="http://iiif.io/api/image/1/level1.json",i.IMAGE_1_PROFILE_LEVEL_1="http://iiif.io/api/image/1/profiles/level1.json",i.IMAGE_1_LEVEL_2="http://iiif.io/api/image/1/level2.json",i.IMAGE_1_PROFILE_LEVEL_2="http://iiif.io/api/image/1/profiles/level2.json",i.IMAGE_2_LEVEL_0="http://iiif.io/api/image/2/level0.json",i.IMAGE_2_PROFILE_LEVEL_0="http://iiif.io/api/image/2/profiles/level0.json",i.IMAGE_2_LEVEL_1="http://iiif.io/api/image/2/level1.json",i.IMAGE_2_PROFILE_LEVEL_1="http://iiif.io/api/image/2/profiles/level1.json",i.IMAGE_2_LEVEL_2="http://iiif.io/api/image/2/level2.json",i.IMAGE_2_PROFILE_LEVEL_2="http://iiif.io/api/image/2/profiles/level2.json",i.AUTH_0_CLICK_THROUGH="http://iiif.io/api/auth/0/login/clickthrough",i.AUTH_0_LOGIN="http://iiif.io/api/auth/0/login",i.AUTH_0_LOGOUT="http://iiif.io/api/auth/0/logout",i.AUTH_0_RESTRICTED="http://iiif.io/api/auth/0/login/restricted",i.AUTH_0_TOKEN="http://iiif.io/api/auth/0/token",i.AUTH_1_CLICK_THROUGH="http://iiif.io/api/auth/1/clickthrough",i.AUTH_1_EXTERNAL="http://iiif.io/api/auth/1/external",i.AUTH_1_KIOSK="http://iiif.io/api/auth/1/kiosk",i.AUTH_1_LOGIN="http://iiif.io/api/auth/1/login",i.AUTH_1_LOGOUT="http://iiif.io/api/auth/1/logout",i.AUTH_1_PROBE="http://iiif.io/api/auth/1/probe",i.AUTH_1_TOKEN="http://iiif.io/api/auth/1/token",i.SEARCH_0="http://iiif.io/api/search/0/search",i.SEARCH_0_AUTO_COMPLETE="http://iiif.io/api/search/0/autocomplete",i.SEARCH_1="http://iiif.io/api/search/1/search",i.SEARCH_1_AUTO_COMPLETE="http://iiif.io/api/search/1/autocomplete",i.TRACKING_EXTENSIONS="http://universalviewer.io/tracking-extensions-profile",i.UI_EXTENSIONS="http://universalviewer.io/ui-extensions-profile",i.PRINT_EXTENSIONS="http://universalviewer.io/print-extensions-profile",i.SHARE_EXTENSIONS="http://universalviewer.io/share-extensions-profile",i.OTHER_MANIFESTATIONS="http://iiif.io/api/otherManifestations.json",i.IXIF="http://wellcomelibrary.org/ld/ixif/0/alpha.json"}(e.ServiceProfile||(e.ServiceProfile={})),function(i){i.BOTTOM_TO_TOP="bottom-to-top",i.LEFT_TO_RIGHT="left-to-right",i.RIGHT_TO_LEFT="right-to-left",i.TOP_TO_BOTTOM="top-to-bottom"}(e.ViewingDirection||(e.ViewingDirection={})),function(i){i.CONTINUOUS="continuous",i.INDIVIDUALS="individuals",i.NON_PAGED="non-paged",i.PAGED="paged",i.TOP="top"}(e.ViewingHint||(e.ViewingHint={}))}])})),define("lib/vocabulary.js",(function(){})),define("modules/uv-shared-module/BaseEvents",["require","exports"],(function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var BaseEvents=function(){function BaseEvents(){}return BaseEvents.ACCEPT_TERMS="acceptTerms",BaseEvents.ANNOTATION_CANVAS_CHANGED="annotationCanvasChanged",BaseEvents.ANNOTATION_CHANGED="annotationChanged",BaseEvents.ANNOTATIONS_CLEARED="annotationsCleared",BaseEvents.ANNOTATIONS_EMPTY="annotationsEmpty",BaseEvents.ANNOTATIONS="annotations",BaseEvents.BOOKMARK="bookmark",BaseEvents.CANVAS_INDEX_CHANGE_FAILED="canvasIndexChangeFailed",BaseEvents.CANVAS_INDEX_CHANGED="canvasIndexChanged",BaseEvents.CLEAR_ANNOTATIONS="clearAnnotations",BaseEvents.CLICKTHROUGH="clickthrough",BaseEvents.CLOSE_ACTIVE_DIALOGUE="closeActiveDialogue",BaseEvents.CLOSE_LEFT_PANEL="closeLeftPanel",BaseEvents.CLOSE_RIGHT_PANEL="closeRightPanel",BaseEvents.COLLECTION_INDEX_CHANGED="collectionIndexChanged",BaseEvents.CREATE="create",BaseEvents.CREATED="created",BaseEvents.CURRENT_TIME_CHANGED="currentTimeChanged",BaseEvents.DOWN_ARROW="downArrow",BaseEvents.DOWNLOAD="download",BaseEvents.DROP="drop",BaseEvents.END="end",BaseEvents.ERROR="error",BaseEvents.ESCAPE="escape",BaseEvents.EXIT_FULLSCREEN="exitFullScreen",BaseEvents.EXTERNAL_LINK_CLICKED="externalLinkClicked",BaseEvents.FEEDBACK="feedback",BaseEvents.FIRST="first",BaseEvents.FORBIDDEN="forbidden",BaseEvents.GALLERY_DECREASE_SIZE="galleryDecreaseSize",BaseEvents.GALLERY_INCREASE_SIZE="galleryIncreaseSize",BaseEvents.GALLERY_THUMB_SELECTED="galleryThumbSelected",BaseEvents.HIDE_AUTH_DIALOGUE="hideAuthDialogue",BaseEvents.HIDE_CLICKTHROUGH_DIALOGUE="hideClickthroughDialogue",BaseEvents.HIDE_DOWNLOAD_DIALOGUE="hideDownloadDialogue",BaseEvents.HIDE_EMBED_DIALOGUE="hideEmbedDialogue",BaseEvents.HIDE_EXTERNALCONTENT_DIALOGUE="hideExternalContentDialogue",BaseEvents.HIDE_GENERIC_DIALOGUE="hideGenericDialogue",BaseEvents.HIDE_HELP_DIALOGUE="hideHelpDialogue",BaseEvents.HIDE_INFORMATION="hideInformation",BaseEvents.HIDE_LOGIN_DIALOGUE="hideLoginDialogue",BaseEvents.HIDE_MOREINFO_DIALOGUE="hideMoreInfoDialogue",BaseEvents.HIDE_MULTISELECT_DIALOGUE="hideMultiSelectDialogue",BaseEvents.HIDE_OVERLAY="hideOverlay",BaseEvents.HIDE_RESTRICTED_DIALOGUE="hideRestrictedDialogue",BaseEvents.HIDE_SETTINGS_DIALOGUE="hideSettingsDialogue",BaseEvents.HIDE_SHARE_DIALOGUE="hideShareDialogue",BaseEvents.HOME="home",BaseEvents.INFO_DISPLAYED="infoDisplayed",BaseEvents.LAST="last",BaseEvents.LEFT_ARROW="leftArrow",BaseEvents.LEFTPANEL_COLLAPSE_FULL_FINISH="leftPanelCollapseFullFinish",BaseEvents.LEFTPANEL_COLLAPSE_FULL_START="leftPanelCollapseFullStart",BaseEvents.LEFTPANEL_EXPAND_FULL_FINISH="leftPanelExpandFullFinish",BaseEvents.LEFTPANEL_EXPAND_FULL_START="leftPanelExpandFullStart",BaseEvents.LOAD_FAILED="loadFailed",BaseEvents.LOGIN_FAILED="loginFailed",BaseEvents.LOGIN="login",BaseEvents.LOGOUT="logout",BaseEvents.MANIFEST_INDEX_CHANGED="manifestIndexChanged",BaseEvents.METRIC_CHANGED="metricChanged",BaseEvents.MINUS="minus",BaseEvents.MULTISELECT_CHANGE="multiSelectChange",BaseEvents.MULTISELECTION_MADE="multiSelectionMade",BaseEvents.NEXT="next",BaseEvents.NOT_FOUND="notFound",BaseEvents.OPEN_EXTERNAL_RESOURCE="openExternalResource",BaseEvents.OPEN_LEFT_PANEL="openLeftPanel",BaseEvents.OPEN_RIGHT_PANEL="openRightPanel",BaseEvents.OPEN_THUMBS_VIEW="openThumbsView",BaseEvents.OPEN_TREE_VIEW="openTreeView",BaseEvents.OPEN="open",BaseEvents.PAGE_DOWN="pageDown",BaseEvents.PAGE_UP="pageUp",BaseEvents.PAUSE="pause",BaseEvents.PLUS="plus",BaseEvents.PREV="prev",BaseEvents.RANGE_CHANGED="rangeChanged",BaseEvents.RANGE_NOT_FOUND="rangeNotFound",BaseEvents.REDIRECT="redirect",BaseEvents.REFRESH="refresh",BaseEvents.RELOAD="reload",BaseEvents.RESIZE="resize",BaseEvents.RESOURCE_DEGRADED="resourceDegraded",BaseEvents.RETRY="retry",BaseEvents.RETURN="return",BaseEvents.RIGHT_ARROW="rightArrow",BaseEvents.RIGHTPANEL_COLLAPSE_FULL_FINISH="rightPanelCollapseFullFinish",BaseEvents.RIGHTPANEL_COLLAPSE_FULL_START="rightPanelCollapseFullStart",BaseEvents.RIGHTPANEL_EXPAND_FULL_FINISH="rightPanelExpandFullFinish",BaseEvents.RIGHTPANEL_EXPAND_FULL_START="rightPanelExpandFullStart",BaseEvents.SEQUENCE_INDEX_CHANGED="sequenceIndexChanged",BaseEvents.SETTINGS_CHANGED="settingsChanged",BaseEvents.SHOW_AUTH_DIALOGUE="showAuthDialogue",BaseEvents.SHOW_CLICKTHROUGH_DIALOGUE="showClickThroughDialogue",BaseEvents.SHOW_DOWNLOAD_DIALOGUE="showDownloadDialogue",BaseEvents.SHOW_EMBED_DIALOGUE="showEmbedDialogue",BaseEvents.SHOW_EXTERNALCONTENT_DIALOGUE="showExternalContentDialogue",BaseEvents.SHOW_GENERIC_DIALOGUE="showGenericDialogue",BaseEvents.SHOW_HELP_DIALOGUE="showHelpDialogue",BaseEvents.SHOW_INFORMATION="showInformation",BaseEvents.SHOW_LOGIN_DIALOGUE="showLoginDialogue",BaseEvents.SHOW_MESSAGE="showMessage",BaseEvents.SHOW_MOREINFO_DIALOGUE="showMoreInfoDialogue",BaseEvents.SHOW_MULTISELECT_DIALOGUE="showMultiSelectDialogue",BaseEvents.SHOW_OVERLAY="showOverlay",BaseEvents.SHOW_RESTRICTED_DIALOGUE="showRestrictedDialogue",BaseEvents.SHOW_SETTINGS_DIALOGUE="showSettingsDialogue",BaseEvents.SHOW_SHARE_DIALOGUE="showShareDialogue",BaseEvents.SHOW_TERMS_OF_USE="showTermsOfUse",BaseEvents.THUMB_MULTISELECTED="thumbMultiSelected",BaseEvents.THUMB_SELECTED="thumbSelected",BaseEvents.TOGGLE_EXPAND_LEFT_PANEL="toggleExpandLeftPanel",BaseEvents.TOGGLE_EXPAND_RIGHT_PANEL="toggleExpandRightPanel",BaseEvents.TOGGLE_FULLSCREEN="toggleFullScreen",BaseEvents.TREE_NODE_MULTISELECTED="treeNodeMultiSelected",BaseEvents.TREE_NODE_SELECTED="treeNodeSelected",BaseEvents.UP_ARROW="upArrow",BaseEvents.UPDATE_SETTINGS="updateSettings",BaseEvents.VIEW_FULL_TERMS="viewFullTerms",BaseEvents.WINDOW_UNLOAD="windowUnload",BaseEvents}();exports.BaseEvents=BaseEvents})),define("modules/uv-shared-module/Panel",["require","exports","./BaseEvents"],(function(require,exports,BaseEvents_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Panel=function(){function Panel($element,fitToParentWidth,fitToParentHeight){this.isResized=!1,this.$element=$element,this.fitToParentWidth=fitToParentWidth||!1,this.fitToParentHeight=fitToParentHeight||!1,this.create()}return Panel.prototype.create=function(){var _this=this;this.component.subscribe(BaseEvents_1.BaseEvents.RESIZE,(function(){_this.resize()}))},Panel.prototype.whenResized=function(cb){var _this=this;Utils.Async.waitFor((function(){return _this.isResized}),cb)},Panel.prototype.resize=function(){var $parent=this.$element.parent();this.fitToParentWidth&&this.$element.width($parent.width()),this.fitToParentHeight&&this.$element.height($parent.height()),this.isResized=!0},Panel}();exports.Panel=Panel}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-shared-module/BaseView",["require","exports","./Panel"],(function(require,exports,Panel_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var BaseView=function(_super){function BaseView($element,fitToParentWidth,fitToParentHeight){return _super.call(this,$element,fitToParentWidth,fitToParentHeight)||this}return __extends(BaseView,_super),BaseView.prototype.create=function(){this.component=this.$element.closest(".uv").data("component"),_super.prototype.create.call(this),this.extension=this.component.extension,this.config={},this.config.content={},this.config.options={};var that=this;that.modules&&that.modules.length&&(that.modules=that.modules.reverse(),that.modules.forEach((function(moduleName){that.config=$.extend(!0,that.config,that.extension.data.config.modules[moduleName])}))),this.content=this.config.content,this.options=this.config.options},BaseView.prototype.init=function(){},BaseView.prototype.setConfig=function(moduleName){this.modules||(this.modules=[]),this.modules.push(moduleName)},BaseView.prototype.resize=function(){_super.prototype.resize.call(this)},BaseView}(Panel_1.Panel);exports.BaseView=BaseView})),define("modules/uv-shared-module/Position",["require","exports"],(function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),function(Position){Position[Position.TOP_LEFT=0]="TOP_LEFT",Position[Position.TOP_CENTER=1]="TOP_CENTER",Position[Position.TOP_RIGHT=2]="TOP_RIGHT",Position[Position.CENTER_LEFT=3]="CENTER_LEFT",Position[Position.CENTER=4]="CENTER",Position[Position.CENTER_RIGHT=5]="CENTER_RIGHT",Position[Position.BOTTOM_LEFT=6]="BOTTOM_LEFT",Position[Position.BOTTOM_CENTER=7]="BOTTOM_CENTER",Position[Position.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(exports.Position||(exports.Position={}))})),define("Utils",["require","exports"],(function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var UVUtils=function(){function UVUtils(){}return UVUtils.sanitize=function(html){return filterXSS(html,{whiteList:{a:["href","title","target","class","data-uv-navigate"],b:[],br:[],i:[],img:["src","alt"],p:[],small:[],span:["data-uv-navigate"],strong:[],sub:[],sup:[]}})},UVUtils.isValidUrl=function(value){var a=document.createElement("a");return a.href=value,!!a.host&&a.host!==window.location.host},UVUtils.propertiesChanged=function(newData,currentData,properties){for(var propChanged=!1,i=0;i<properties.length&&!(propChanged=UVUtils.propertyChanged(newData,currentData,properties[i]));i++);return propChanged},UVUtils.propertyChanged=function(newData,currentData,propertyName){return currentData[propertyName]!==newData[propertyName]},UVUtils}();exports.UVUtils=UVUtils}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-shared-module/CenterPanel",["require","exports","./BaseView","./Position","../../Utils"],(function(require,exports,BaseView_1,Position_1,Utils_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var CenterPanel=function(_super){function CenterPanel($element){var _this=_super.call(this,$element,!1,!0)||this;return _this.subtitleExpanded=!1,_this.isAttributionOpen=!1,_this.attributionPosition=Position_1.Position.BOTTOM_LEFT,_this}return __extends(CenterPanel,_super),CenterPanel.prototype.create=function(){var _this=this;_super.prototype.create.call(this),this.$title=$('<div class="title"></div>'),this.$element.append(this.$title),this.$subtitle=$('<div class="subtitle">\n                                <div class="wrapper">\n                                    <button type="button" class="expand-btn" aria-label="Expand">\n                                        <span aria-hidden="true">+</span>\n                                    </button>\n                                    <span class="text"></span>\n                                </div>\n                            </div>'),this.$element.append(this.$subtitle),this.$subtitleWrapper=this.$subtitle.find(".wrapper"),this.$subtitleExpand=this.$subtitle.find(".expand-btn"),this.$subtitleText=this.$subtitle.find(".text"),this.$content=$('<div class="content"></div>'),this.$element.append(this.$content),this.$attribution=$('\n                                <div class="attribution">\n                                  <div class="header">\n                                    <div class="title"></div>\n                                    <button type="button" class="close" aria-label="Close">\n                                      <span aria-hidden="true">&#215;</span>\n                                    </button>\n                                  </div>\n                                  <div class="main">\n                                    <div class="attribution-text"></div>\n                                    <div class="license"></div>\n                                    <div class="logo"></div>\n                                  </div>\n                                </div>\n        '),this.$attribution.find(".header .title").text(this.content.attribution),this.$content.append(this.$attribution),this.closeAttribution(),this.$closeAttributionButton=this.$attribution.find(".header .close"),this.$closeAttributionButton.on("click",(function(e){e.preventDefault(),_this.closeAttribution()})),this.$subtitleExpand.on("click",(function(e){e.preventDefault(),_this.subtitleExpanded=!_this.subtitleExpanded,_this.subtitleExpanded?(_this.$subtitleWrapper.addClass("expanded"),_this.$subtitleExpand.text("-")):(_this.$subtitleWrapper.removeClass("expanded"),_this.$subtitleExpand.text("+")),_this.resize()})),Utils.Bools.getBool(this.options.titleEnabled,!0)?this.$title.removeClass("hidden"):this.$title.addClass("hidden"),Utils.Bools.getBool(this.options.subtitleEnabled,!1)?this.$subtitle.removeClass("hidden"):this.$subtitle.addClass("hidden"),this.whenResized((function(){_this.updateRequiredStatement()}))},CenterPanel.prototype.openAttribution=function(){this.$attribution.show(),this.isAttributionOpen=!0},CenterPanel.prototype.closeAttribution=function(){this.$attribution.hide(),this.isAttributionOpen=!1},CenterPanel.prototype.updateRequiredStatement=function(){var _this=this,requiredStatement=this.extension.helper.getRequiredStatement(),enabled=Utils.Bools.getBool(this.options.requiredStatementEnabled,!0);if(requiredStatement&&requiredStatement.value&&enabled){this.openAttribution();var $attributionTitle=this.$attribution.find(".title"),$attributionText=this.$attribution.find(".attribution-text"),$license=this.$attribution.find(".license"),$logo=this.$attribution.find(".logo");if(requiredStatement.label){var sanitizedTitle=Utils_1.UVUtils.sanitize(requiredStatement.label);$attributionTitle.html(sanitizedTitle)}else $attributionTitle.text(this.content.attribution);if(requiredStatement.value){var sanitizedText=Utils_1.UVUtils.sanitize(requiredStatement.value);$attributionText.html(sanitizedText),$attributionText.find("img").one("load",(function(){_this.resize()})).each((function(){this.complete&&$(this).load()})),$attributionText.targetBlank()}$license.hide(),$logo.hide(),this.resize()}},CenterPanel.prototype.resize=function(){_super.prototype.resize.call(this);var titleHeight,subtitleHeight,leftPanelWidth=this.extension.shell.$leftPanel.is(":visible")?Math.floor(this.extension.shell.$leftPanel.width()):0,rightPanelWidth=this.extension.shell.$rightPanel.is(":visible")?Math.floor(this.extension.shell.$rightPanel.width()):0,width=Math.floor(this.$element.parent().width()-leftPanelWidth-rightPanelWidth);if(this.$element.css({left:leftPanelWidth,width:width}),titleHeight=this.options&&!1===this.options.titleEnabled||!this.$title.is(":visible")?0:this.$title.height(),subtitleHeight=this.options&&!1===this.options.subtitleEnabled||!this.$subtitle.is(":visible")?0:this.$subtitle.height(),this.$content.height(this.$element.height()-titleHeight-subtitleHeight),this.$content.width(this.$element.width()),this.$attribution&&this.isAttributionOpen){switch(this.attributionPosition){case Position_1.Position.BOTTOM_LEFT:this.$attribution.css("top",this.$content.height()-this.$attribution.outerHeight()-this.$attribution.verticalMargins()),this.$attribution.css("left",0);break;case Position_1.Position.BOTTOM_RIGHT:this.$attribution.css("top",this.$content.height()-this.$attribution.outerHeight()-this.$attribution.verticalMargins()),this.$attribution.css("left",this.$content.width()-this.$attribution.outerWidth()-this.$attribution.horizontalMargins())}this.$content.width()<=this.$attribution.width()?this.$attribution.hide():this.$attribution.show()}this.subtitle&&this.options.subtitleEnabled?(this.$subtitleText.html(Utils_1.UVUtils.sanitize(this.subtitle.replace(/<br\s*[\/]?>/gi,"; "))),this.$subtitleText.removeClass("elided"),this.$subtitle.removeClass("hidden"),this.$subtitleWrapper.css("max-height",this.$content.height()+this.$subtitle.outerHeight()),this.$subtitleWrapper.width(this.$content.width()),this.subtitleExpanded?this.$subtitleText.width(this.$content.width()-this.$subtitleText.horizontalMargins()-2):(this.$subtitleText.width("auto"),this.$subtitleWrapper.width("auto"),this.$subtitleExpand.hide(),this.$subtitleText.width()>this.$content.width()&&(this.$subtitleExpand.show(),this.$subtitleText.addClass("elided"),this.$subtitleText.width(this.$content.width()-(this.$subtitleExpand.outerWidth()+this.$subtitleText.horizontalMargins()))))):this.$subtitle.addClass("hidden")},CenterPanel}(BaseView_1.BaseView);exports.CenterPanel=CenterPanel})),function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("IIIFAVComponent",[],e):"object"==typeof exports?exports.IIIFAVComponent=e():t.IIIFAVComponent=e()}("undefined"!=typeof self?self:this,(function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=36)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.BOOKMARKING="oa:bookmarking",t.CLASSIFYING="oa:classifying",t.COMMENTING="oa:commenting",t.DESCRIBING="oa:describing",t.EDITING="oa:editing",t.HIGHLIGHTING="oa:highlighting",t.IDENTIFYING="oa:identifying",t.LINKING="oa:linking",t.MODERATING="oa:moderating",t.PAINTING="sc:painting",t.QUESTIONING="oa:questioning",t.REPLYING="oa:replying",t.TAGGING="oa:tagging",t.TRANSCRIBING="oad:transcribing"}(e.AnnotationMotivation||(e.AnnotationMotivation={})),function(t){t.AUTO_ADVANCE="auto-advance",t.CONTINUOUS="continuous",t.FACING_PAGES="facing-pages",t.HIDDEN="hidden",t.INDIVIDUALS="individuals",t.MULTI_PART="multi-part",t.NO_NAV="no-nav",t.NON_PAGED="non-paged",t.PAGED="paged",t.REPEAT="repeat",t.SEQUENCE="sequence",t.THUMBNAIL_NAV="thumbnail-nav",t.TOGETHER="together",t.UNORDERED="unordered"}(e.Behavior||(e.Behavior={})),function(t){t.CANVAS="canvas",t.CHOICE="choice",t.OA_CHOICE="oa:choice",t.CONTENT_AS_TEXT="contentastext",t.DATASET="dataset",t.DOCUMENT="document",t.IMAGE="image",t.MODEL="model",t.MOVING_IMAGE="movingimage",t.PDF="pdf",t.PHYSICAL_OBJECT="physicalobject",t.SOUND="sound",t.TEXT="text",t.TEXTUALBODY="textualbody",t.VIDEO="video"}(e.ExternalResourceType||(e.ExternalResourceType={})),function(t){t.ANNOTATION="annotation",t.CANVAS="canvas",t.COLLECTION="collection",t.MANIFEST="manifest",t.RANGE="range",t.SEQUENCE="sequence"}(e.IIIFResourceType||(e.IIIFResourceType={})),function(t){t.AUDIO_MP4="audio/mp4",t.CORTO="application/corto",t.DICOM="application/dicom",t.DRACO="application/draco",t.EPUB="application/epub+zip",t.GLB="model/gltf-binary",t.GLTF="model/gltf+json",t.IIIF_PRESENTATION_2='application/ld+json;profile="http://iiif.io/api/presentation/2/context.json"',t.IIIF_PRESENTATION_3='application/ld+json;profile="http://iiif.io/api/presentation/3/context.json"',t.JPG="image/jpeg",t.M3U8="application/vnd.apple.mpegurl",t.MP3="audio/mp3",t.MPEG_DASH="application/dash+xml",t.OBJ="text/plain",t.OPF="application/oebps-package+xml",t.PDF="application/pdf",t.PLY="application/ply",t.THREEJS="application/vnd.threejs+json",t.USDZ="model/vnd.usd+zip",t.VIDEO_MP4="video/mp4",t.WEBM="video/webm"}(e.MediaType||(e.MediaType={})),function(t){t.DOC="application/msword",t.DOCX="application/vnd.openxmlformats-officedocument.wordprocessingml.document",t.PDF="application/pdf"}(e.RenderingFormat||(e.RenderingFormat={})),function(t){t.IMAGE_0_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0",t.IMAGE_0_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1",t.IMAGE_0_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2",t.IMAGE_0_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0",t.IMAGE_0_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1",t.IMAGE_0_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2",t.IMAGE_1_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",t.IMAGE_1_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",t.IMAGE_1_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",t.IMAGE_1_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",t.IMAGE_1_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",t.IMAGE_1_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",t.IMAGE_1_LEVEL_0="http://iiif.io/api/image/1/level0.json",t.IMAGE_1_PROFILE_LEVEL_0="http://iiif.io/api/image/1/profiles/level0.json",t.IMAGE_1_LEVEL_1="http://iiif.io/api/image/1/level1.json",t.IMAGE_1_PROFILE_LEVEL_1="http://iiif.io/api/image/1/profiles/level1.json",t.IMAGE_1_LEVEL_2="http://iiif.io/api/image/1/level2.json",t.IMAGE_1_PROFILE_LEVEL_2="http://iiif.io/api/image/1/profiles/level2.json",t.IMAGE_2_LEVEL_0="http://iiif.io/api/image/2/level0.json",t.IMAGE_2_PROFILE_LEVEL_0="http://iiif.io/api/image/2/profiles/level0.json",t.IMAGE_2_LEVEL_1="http://iiif.io/api/image/2/level1.json",t.IMAGE_2_PROFILE_LEVEL_1="http://iiif.io/api/image/2/profiles/level1.json",t.IMAGE_2_LEVEL_2="http://iiif.io/api/image/2/level2.json",t.IMAGE_2_PROFILE_LEVEL_2="http://iiif.io/api/image/2/profiles/level2.json",t.AUTH_0_CLICK_THROUGH="http://iiif.io/api/auth/0/login/clickthrough",t.AUTH_0_LOGIN="http://iiif.io/api/auth/0/login",t.AUTH_0_LOGOUT="http://iiif.io/api/auth/0/logout",t.AUTH_0_RESTRICTED="http://iiif.io/api/auth/0/login/restricted",t.AUTH_0_TOKEN="http://iiif.io/api/auth/0/token",t.AUTH_1_CLICK_THROUGH="http://iiif.io/api/auth/1/clickthrough",t.AUTH_1_EXTERNAL="http://iiif.io/api/auth/1/external",t.AUTH_1_KIOSK="http://iiif.io/api/auth/1/kiosk",t.AUTH_1_LOGIN="http://iiif.io/api/auth/1/login",t.AUTH_1_LOGOUT="http://iiif.io/api/auth/1/logout",t.AUTH_1_PROBE="http://iiif.io/api/auth/1/probe",t.AUTH_1_TOKEN="http://iiif.io/api/auth/1/token",t.SEARCH_0="http://iiif.io/api/search/0/search",t.SEARCH_0_AUTO_COMPLETE="http://iiif.io/api/search/0/autocomplete",t.SEARCH_1="http://iiif.io/api/search/1/search",t.SEARCH_1_AUTO_COMPLETE="http://iiif.io/api/search/1/autocomplete",t.TRACKING_EXTENSIONS="http://universalviewer.io/tracking-extensions-profile",t.UI_EXTENSIONS="http://universalviewer.io/ui-extensions-profile",t.PRINT_EXTENSIONS="http://universalviewer.io/print-extensions-profile",t.SHARE_EXTENSIONS="http://universalviewer.io/share-extensions-profile",t.OTHER_MANIFESTATIONS="http://iiif.io/api/otherManifestations.json",t.IXIF="http://wellcomelibrary.org/ld/ixif/0/alpha.json"}(e.ServiceProfile||(e.ServiceProfile={})),function(t){t.BOTTOM_TO_TOP="bottom-to-top",t.LEFT_TO_RIGHT="left-to-right",t.RIGHT_TO_LEFT="right-to-left",t.TOP_TO_BOTTOM="top-to-bottom"}(e.ViewingDirection||(e.ViewingDirection={})),function(t){t.CONTINUOUS="continuous",t.INDIVIDUALS="individuals",t.NON_PAGED="non-paged",t.PAGED="paged",t.TOP="top"}(e.ViewingHint||(e.ViewingHint={}))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CONTINUE=100,e.SWITCHING_PROTOCOLS=101,e.PROCESSING=102,e.OK=200,e.CREATED=201,e.ACCEPTED=202,e.NON_AUTHORITATIVE_INFORMATION=203,e.NO_CONTENT=204,e.RESET_CONTENT=205,e.PARTIAL_CONTENT=206,e.MULTI_STATUS=207,e.MULTIPLE_CHOICES=300,e.MOVED_PERMANENTLY=301,e.MOVED_TEMPORARILY=302,e.SEE_OTHER=303,e.NOT_MODIFIED=304,e.USE_PROXY=305,e.TEMPORARY_REDIRECT=307,e.BAD_REQUEST=400,e.UNAUTHORIZED=401,e.PAYMENT_REQUIRED=402,e.FORBIDDEN=403,e.NOT_FOUND=404,e.METHOD_NOT_ALLOWED=405,e.NOT_ACCEPTABLE=406,e.PROXY_AUTHENTICATION_REQUIRED=407,e.REQUEST_TIME_OUT=408,e.CONFLICT=409,e.GONE=410,e.LENGTH_REQUIRED=411,e.PRECONDITION_FAILED=412,e.REQUEST_ENTITY_TOO_LARGE=413,e.REQUEST_URI_TOO_LARGE=414,e.UNSUPPORTED_MEDIA_TYPE=415,e.REQUESTED_RANGE_NOT_SATISFIABLE=416,e.EXPECTATION_FAILED=417,e.IM_A_TEAPOT=418,e.UNPROCESSABLE_ENTITY=422,e.LOCKED=423,e.FAILED_DEPENDENCY=424,e.UNORDERED_COLLECTION=425,e.UPGRADE_REQUIRED=426,e.PRECONDITION_REQUIRED=428,e.TOO_MANY_REQUESTS=429,e.REQUEST_HEADER_FIELDS_TOO_LARGE=431,e.INTERNAL_SERVER_ERROR=500,e.NOT_IMPLEMENTED=501,e.BAD_GATEWAY=502,e.SERVICE_UNAVAILABLE=503,e.GATEWAY_TIME_OUT=504,e.HTTP_VERSION_NOT_SUPPORTED=505,e.VARIANT_ALSO_NEGOTIATES=506,e.INSUFFICIENT_STORAGE=507,e.BANDWIDTH_LIMIT_EXCEEDED=509,e.NOT_EXTENDED=510,e.NETWORK_AUTHENTICATION_REQUIRED=511},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){return window&&window.__DEBUG_AV_COMPONENT__};e.Logger={log:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];i()&&console.log.apply(console,t)},warn:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];i()&&console.warn.apply(console,t)},error:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];i()&&console.error.apply(console,t)},groupCollapsed:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];i()&&console.groupCollapsed.apply(console,t)},group:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];i()&&console.group.apply(console,t)},groupEnd:function(){i()&&console.groupEnd()}}},function(t,e,n){"use strict";n.r(e),n.d(e,"JSONLDResource",(function(){return a})),n.d(e,"ManifestResource",(function(){return u})),n.d(e,"Resource",(function(){return c})),n.d(e,"IIIFResource",(function(){return p})),n.d(e,"Annotation",(function(){return d})),n.d(e,"AnnotationBody",(function(){return v})),n.d(e,"AnnotationList",(function(){return m})),n.d(e,"AnnotationPage",(function(){return E})),n.d(e,"Canvas",(function(){return A})),n.d(e,"Collection",(function(){return O})),n.d(e,"Duration",(function(){return b})),n.d(e,"LabelValuePair",(function(){return M})),n.d(e,"LanguageMap",(function(){return L})),n.d(e,"LocalizedValue",(function(){return $})),n.d(e,"PropertyValue",(function(){return k})),n.d(e,"Manifest",(function(){return H})),n.d(e,"ManifestType",(function(){return r})),n.d(e,"Range",(function(){return W})),n.d(e,"Rendering",(function(){return Y})),n.d(e,"Sequence",(function(){return q})),n.d(e,"Deserialiser",(function(){return Q})),n.d(e,"Service",(function(){return J})),n.d(e,"Size",(function(){return Z})),n.d(e,"StatusCode",(function(){return G})),n.d(e,"Thumb",(function(){return et})),n.d(e,"Thumbnail",(function(){return it})),n.d(e,"TreeNode",(function(){return rt})),n.d(e,"TreeNodeType",(function(){return tt})),n.d(e,"Utils",(function(){return V})),n.d(e,"loadManifest",(function(){return at})),n.d(e,"parseManifest",(function(){return ot}));var i,r,a=function(){function t(t){this.__jsonld=t,this.context=this.getProperty("context"),this.id=this.getProperty("id")}return t.prototype.getProperty=function(t){var e=null;return this.__jsonld&&((e=this.__jsonld[t])||(e=this.__jsonld["@"+t])),e},t}(),o=n(0),s=(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),u=function(t){function e(e,n){var i=t.call(this,e)||this;return i.options=n,i}return s(e,t),e.prototype.getIIIFResourceType=function(){return V.normaliseType(this.getProperty("type"))},e.prototype.getLabel=function(){var t=this.getProperty("label");return t?k.parse(t,this.options.locale):new k([],this.options.locale)},e.prototype.getDefaultLabel=function(){return this.getLabel().getValue(this.options.locale)},e.prototype.getMetadata=function(){var t=this.getProperty("metadata"),e=[];if(!t)return e;for(var n=0;n<t.length;n++){var i=t[n],r=new M(this.options.locale);r.parse(i),e.push(r)}return e},e.prototype.getRendering=function(t){for(var e=this.getRenderings(),n=0;n<e.length;n++){var i=e[n];if(i.getFormat()===t)return i}return null},e.prototype.getRenderings=function(){var t,e=[];if(!(t=this.__jsonld?this.__jsonld.rendering:this.rendering))return e;Array.isArray(t)||(t=[t]);for(var n=0;n<t.length;n++){var i=t[n];e.push(new Y(i,this.options))}return e},e.prototype.getService=function(t){return V.getService(this,t)},e.prototype.getServices=function(){return V.getServices(this)},e.prototype.getThumbnail=function(){var t=this.getProperty("thumbnail");return Array.isArray(t)&&(t=t[0]),t?new it(t,this.options):null},e.prototype.isAnnotation=function(){return this.getIIIFResourceType()===o.IIIFResourceType.ANNOTATION},e.prototype.isCanvas=function(){return this.getIIIFResourceType()===o.IIIFResourceType.CANVAS},e.prototype.isCollection=function(){return this.getIIIFResourceType()===o.IIIFResourceType.COLLECTION},e.prototype.isManifest=function(){return this.getIIIFResourceType()===o.IIIFResourceType.MANIFEST},e.prototype.isRange=function(){return this.getIIIFResourceType()===o.IIIFResourceType.RANGE},e.prototype.isSequence=function(){return this.getIIIFResourceType()===o.IIIFResourceType.SEQUENCE},e}(a),l=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),c=function(t){function e(e,n){return t.call(this,e,n)||this}return l(e,t),e.prototype.getFormat=function(){var t=this.getProperty("format");return t?t.toLowerCase():null},e.prototype.getResources=function(){var t=[];if(!this.__jsonld.resources)return t;for(var e=0;e<this.__jsonld.resources.length;e++){var n=this.__jsonld.resources[e],i=new d(n,this.options);t.push(i)}return t},e.prototype.getType=function(){var t=this.getProperty("type");return t?V.normaliseType(t):null},e.prototype.getWidth=function(){return this.getProperty("width")},e.prototype.getHeight=function(){return this.getProperty("height")},e.prototype.getMaxWidth=function(){return this.getProperty("maxWidth")},e.prototype.getMaxHeight=function(){return this.getProperty("maxHeight")?null:this.getMaxWidth()},e}(u),h=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),p=function(t){function e(e,n){var i=t.call(this,e,n)||this;i.index=-1,i.isLoaded=!1;var r={defaultLabel:"-",locale:"en-GB",resource:i,pessimisticAccessControl:!1};return i.options=Object.assign(r,n),i}return h(e,t),e.prototype.getAttribution=function(){var t=this.getProperty("attribution");return t?k.parse(t,this.options.locale):new k([],this.options.locale)},e.prototype.getDescription=function(){var t=this.getProperty("description");return t?k.parse(t,this.options.locale):new k([],this.options.locale)},e.prototype.getHomepage=function(){var t=this.getProperty("homepage");return t?"string"==typeof t?t:(Array.isArray(t)&&t.length&&(t=t[0]),t["@id"]||t.id):null},e.prototype.getIIIFResourceType=function(){return V.normaliseType(this.getProperty("type"))},e.prototype.getLogo=function(){var t=this.getProperty("logo");return t?"string"==typeof t?t:(Array.isArray(t)&&t.length&&(t=t[0]),t["@id"]||t.id):null},e.prototype.getLicense=function(){return V.getLocalisedValue(this.getProperty("license"),this.options.locale)},e.prototype.getNavDate=function(){return new Date(this.getProperty("navDate"))},e.prototype.getRelated=function(){return this.getProperty("related")},e.prototype.getSeeAlso=function(){return this.getProperty("seeAlso")},e.prototype.getTrackingLabel=function(){var t=this.getService(o.ServiceProfile.TRACKING_EXTENSIONS);return t?t.getProperty("trackingLabel"):""},e.prototype.getDefaultTree=function(){return this.defaultTree=new rt("root"),this.defaultTree.data=this,this.defaultTree},e.prototype.getRequiredStatement=function(){var t=null,e=this.getProperty("requiredStatement");if(e)(t=new M(this.options.locale)).parse(e);else{var n=this.getAttribution();n&&((t=new M(this.options.locale)).value=n)}return t},e.prototype.isCollection=function(){return this.getIIIFResourceType()===o.IIIFResourceType.COLLECTION},e.prototype.isManifest=function(){return this.getIIIFResourceType()===o.IIIFResourceType.MANIFEST},e.prototype.load=function(){var t=this;return new Promise((function(e){if(t.isLoaded)e(t);else{var n=t.options;n.navDate=t.getNavDate();var i=t.__jsonld.id;i||(i=t.__jsonld["@id"]),V.loadManifest(i).then((function(i){t.parentLabel=t.getLabel().getValue(n.locale);var r=Q.parse(i,n);(t=Object.assign(t,r)).index=n.index,e(t)}))}}))},e}(u),f=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),d=function(t){function e(e,n){return t.call(this,e,n)||this}return f(e,t),e.prototype.getBody=function(){var t=[],e=this.getProperty("body");if(e)if(Array.isArray(e))for(var n=0;n<e.length;n++)if((a=e[n]).items)for(var i=0;i<a.items.length;i++){var r=a.items[i];t.push(new v(r,this.options))}else t.push(new v(a,this.options));else if(e.items)for(n=0;n<e.items.length;n++){var a=e.items[n];t.push(new v(a,this.options))}else t.push(new v(e,this.options));return t},e.prototype.getMotivation=function(){return this.getProperty("motivation")||null},e.prototype.getOn=function(){return this.getProperty("on")},e.prototype.getTarget=function(){return this.getProperty("target")},e.prototype.getResource=function(){return new c(this.getProperty("resource"),this.options)},e}(u),g=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),v=function(t){function e(e,n){return t.call(this,e,n)||this}return g(e,t),e.prototype.getFormat=function(){var t=this.getProperty("format");return t?V.getMediaType(t):null},e.prototype.getType=function(){return this.getProperty("type")?V.normaliseType(this.getProperty("type")):null},e.prototype.getWidth=function(){return this.getProperty("width")},e.prototype.getHeight=function(){return this.getProperty("height")},e}(u),_=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),m=function(t){function e(e,n,i){var r=t.call(this,n)||this;return r.label=e,r.options=i,r}return _(e,t),e.prototype.getIIIFResourceType=function(){return V.normaliseType(this.getProperty("type"))},e.prototype.getLabel=function(){return this.label},e.prototype.getResources=function(){var t=this;return this.getProperty("resources").map((function(e){return new d(e,t.options)}))},e.prototype.load=function(){var t=this;return new Promise((function(e,n){if(t.isLoaded)e(t);else{var i=t.__jsonld.id;i||(i=t.__jsonld["@id"]),V.loadManifest(i).then((function(n){t.__jsonld=n,t.context=t.getProperty("context"),t.id=t.getProperty("id"),t.isLoaded=!0,e(t)})).catch(n)}}))},e}(a),y=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),E=function(t){function e(e,n){return t.call(this,e,n)||this}return y(e,t),e.prototype.getItems=function(){return this.getProperty("items")},e}(u),T=n(7),C=n.n(T),I=n(21),P=n.n(I),w=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),A=function(t){function e(e,n){return t.call(this,e,n)||this}return w(e,t),e.prototype.getCanonicalImageUri=function(t){var e,n=null,i="default",r=t;if(this.externalResource&&this.externalResource.data&&this.externalResource.data["@id"])n=this.externalResource.data["@id"],r||(r=this.externalResource.data.width),this.externalResource.data["@context"]&&(this.externalResource.data["@context"].indexOf("/1.0/context.json")>-1||this.externalResource.data["@context"].indexOf("/1.1/context.json")>-1||this.externalResource.data["@context"].indexOf("/1/context.json")>-1)&&(i="native");else{var a=this.getImages();if(a&&a.length){var o=a[0].getResource(),s=o.getServices();if(r||(r=o.getWidth()),s.length){var u=s[0];n=u.id,i=V.getImageQuality(u.getProfile())}else if(r===o.getWidth())return o.id}if(!n){var l=this.getProperty("thumbnail");if(l){if("string"==typeof l)return l;if(l["@id"])return l["@id"];if(l.length)return l[0].id}}}return e=r+",",n&&n.endsWith("/")&&(n=n.substr(0,n.length-1)),[n,"full",e,0,i+".jpg"].join("/")},e.prototype.getMaxDimensions=function(){var t,e=null;return this.externalResource&&this.externalResource.data&&this.externalResource.data.profile&&(t=this.externalResource.data.profile,Array.isArray(t)&&(t=t.filter((function(t){return t.maxWidth}))[0])&&(e=new Z(t.maxWidth,t.maxHeight?t.maxHeight:t.maxWidth))),e},e.prototype.getContent=function(){var t=[],e=this.__jsonld.items||this.__jsonld.content;if(!e)return t;var n=null;if(e.length&&(n=new E(e[0],this.options)),!n)return t;for(var i=n.getItems(),r=0;r<i.length;r++){var a=i[r],o=new d(a,this.options);t.push(o)}return t},e.prototype.getDuration=function(){return this.getProperty("duration")},e.prototype.getImages=function(){var t=[];if(!this.__jsonld.images)return t;for(var e=0;e<this.__jsonld.images.length;e++){var n=this.__jsonld.images[e],i=new d(n,this.options);t.push(i)}return t},e.prototype.getIndex=function(){return this.getProperty("index")},e.prototype.getOtherContent=function(){var t=this,n=(Array.isArray(this.getProperty("otherContent"))?this.getProperty("otherContent"):[this.getProperty("otherContent")]).filter((function(t){return t&&("sc:AnnotationList","string"==typeof(e=t["@type"])&&e.toLowerCase()==e.toLowerCase());var e})).map((function(e,n){return new m(e.label||"Annotation list "+n,e,t.options)})).map((function(t){return t.load()}));return Promise.all(n)},e.prototype.getWidth=function(){return this.getProperty("width")},e.prototype.getHeight=function(){return this.getProperty("height")},e.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},Object.defineProperty(e.prototype,"imageResources",{get:function(){var t=this,n=P()([this.getImages().map((function(t){return t.getResource()})),this.getContent().map((function(t){return t.getBody()}))]);return C()(n.map((function(n){switch(n.getProperty("type").toLowerCase()){case o.ExternalResourceType.CHOICE:case o.ExternalResourceType.OA_CHOICE:return new e({images:C()([n.getProperty("default"),n.getProperty("item")]).map((function(t){return{resource:t}}))},t.options).getImages().map((function(t){return t.getResource()}));default:return n}})))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"resourceAnnotations",{get:function(){return P()([this.getImages(),this.getContent()])},enumerable:!0,configurable:!0}),e.prototype.resourceAnnotation=function(t){return this.resourceAnnotations.find((function(e){return e.getResource().id===t||C()(new Array(e.getBody())).some((function(e){return e.id===t}))}))},e.prototype.onFragment=function(t){var e=this.resourceAnnotation(t);if(e){var n=e.getProperty("on"),i=e.getProperty("target"),r=(n||i).match(/xywh=(.*)$/);if(r)return r[1].split(",").map((function(t){return parseInt(t,10)}))}},Object.defineProperty(e.prototype,"iiifImageResources",{get:function(){return this.imageResources.filter((function(t){return t&&t.getServices()[0]&&t.getServices()[0].id}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageServiceIds",{get:function(){return this.iiifImageResources.map((function(t){return t.getServices()[0].id}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"aspectRatio",{get:function(){return this.getWidth()/this.getHeight()},enumerable:!0,configurable:!0}),e}(c),R=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),O=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i.items=[],i._collections=null,i._manifests=null,e.__collection=i,i}return R(e,t),e.prototype.getCollections=function(){return this._collections?this._collections:this._collections=this.items.filter((function(t){return t.isCollection()}))},e.prototype.getManifests=function(){return this._manifests?this._manifests:this._manifests=this.items.filter((function(t){return t.isManifest()}))},e.prototype.getCollectionByIndex=function(t){for(var e,n=this.getCollections(),i=0;i<n.length;i++){var r=n[i];r.index===t&&(e=r)}if(e)return e.options.index=t,e.load();throw new Error("Collection index not found")},e.prototype.getManifestByIndex=function(t){for(var e,n=this.getManifests(),i=0;i<n.length;i++){var r=n[i];r.index===t&&(e=r)}if(e)return e.options.index=t,e.load();throw new Error("Manifest index not found")},e.prototype.getTotalCollections=function(){return this.getCollections().length},e.prototype.getTotalManifests=function(){return this.getManifests().length},e.prototype.getTotalItems=function(){return this.items.length},e.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?this.getProperty("viewingDirection"):o.ViewingDirection.LEFT_TO_RIGHT},e.prototype.getBehavior=function(){var t=this.getProperty("behavior");return Array.isArray(t)&&(t=t[0]),t||null},e.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},e.prototype.getDefaultTree=function(){return t.prototype.getDefaultTree.call(this),this.defaultTree.data.type=V.normaliseType(tt.COLLECTION),this._parseManifests(this),this._parseCollections(this),V.generateTreeNodeIds(this.defaultTree),this.defaultTree},e.prototype._parseManifests=function(t){if(t.getManifests()&&t.getManifests().length)for(var e=0;e<t.getManifests().length;e++){var n=t.getManifests()[e],i=n.getDefaultTree();i.label=n.parentLabel||n.getLabel().getValue(this.options.locale)||"manifest "+(e+1),i.navDate=n.getNavDate(),i.data.id=n.id,i.data.type=V.normaliseType(tt.MANIFEST),t.defaultTree.addNode(i)}},e.prototype._parseCollections=function(t){if(t.getCollections()&&t.getCollections().length)for(var e=0;e<t.getCollections().length;e++){var n=t.getCollections()[e],i=n.getDefaultTree();i.label=n.parentLabel||n.getLabel().getValue(this.options.locale)||"collection "+(e+1),i.navDate=n.getNavDate(),i.data.id=n.id,i.data.type=V.normaliseType(tt.COLLECTION),t.defaultTree.addNode(i)}},e}(p),b=function(){function t(t,e){this.start=t,this.end=e}return t.prototype.getLength=function(){return this.end-this.start},t}(),M=function(){function t(t){this.defaultLocale=t}return t.prototype.parse=function(t){this.resource=t,this.label=k.parse(this.resource.label,this.defaultLocale),this.value=k.parse(this.resource.value,this.defaultLocale)},t.prototype.getLabel=function(t){return null===this.label?null:(Array.isArray(t)&&!t.length&&(t=void 0),this.label.getValue(t||this.defaultLocale))},t.prototype.setLabel=function(t){null===this.label&&(this.label=new k([])),this.label.setValue(t,this.defaultLocale)},t.prototype.getValue=function(t,e){return void 0===e&&(e="<br/>"),null===this.value?null:(Array.isArray(t)&&!t.length&&(t=void 0),this.value.getValue(t||this.defaultLocale,e))},t.prototype.getValues=function(t){return null===this.value?[]:(Array.isArray(t)&&!t.length&&(t=void 0),this.value.getValues(t||this.defaultLocale))},t.prototype.setValue=function(t){null===this.value&&(this.value=new k([])),this.value.setValue(t,this.defaultLocale)},t}(),S=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),L=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return S(e,t),e.getValue=function(t,e){return t.getValue(e,"<br/>")},e.getValues=function(t,e){return t.getValues(e)},e}(Array),x=n(1),N=(n(49),function(t,e,n,i){return new(n||(n=Promise))((function(r,a){function o(t){try{u(i.next(t))}catch(t){a(t)}}function s(t){try{u(i.throw(t))}catch(t){a(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}u((i=i.apply(t,e||[])).next())}))}),D=function(t,e){var n,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},V=function(){function t(){}return t.getMediaType=function(t){return(t=(t=t.toLowerCase()).split(";")[0]).trim()},t.getImageQuality=function(t){return t===o.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1||t===o.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2||t===o.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_1||t===o.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2||t===o.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1||t===o.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2||t===o.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1||t===o.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2||t===o.ServiceProfile.IMAGE_1_LEVEL_1||t===o.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1||t===o.ServiceProfile.IMAGE_1_LEVEL_2||t===o.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2?"native":"default"},t.getInexactLocale=function(t){return-1!==t.indexOf("-")?t.substr(0,t.indexOf("-")):t},t.getLocalisedValue=function(t,e){if(!Array.isArray(t))return t;for(var n=0;n<t.length;n++){var i=t[n];if(e===i["@language"])return i["@value"]}var r=e.substr(0,e.indexOf("-"));for(n=0;n<t.length;n++){var a=t[n];if(a["@language"]===r)return a["@value"]}return null},t.generateTreeNodeIds=function(e,n){var i;void 0===n&&(n=0),i=e.parentNode?e.parentNode.id+"-"+n:"0",e.id=i;for(var r=0;r<e.nodes.length;r++){var a=e.nodes[r];t.generateTreeNodeIds(a,r)}},t.normaliseType=function(t){return-1!==(t=(t||"").toLowerCase()).indexOf(":")?t.split(":")[1]:t},t.normaliseUrl=function(t){return-1!==(t=t.substr(t.indexOf("://"))).indexOf("#")&&(t=t.split("#")[0]),t},t.normalisedUrlsMatch=function(e,n){return t.normaliseUrl(e)===t.normaliseUrl(n)},t.isImageProfile=function(e){return!!(t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_0)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_0)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_0)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_LEVEL_0)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_PROFILE_LEVEL_0)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_LEVEL_1)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_LEVEL_2)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_2_LEVEL_0)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_2_PROFILE_LEVEL_0)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_2_LEVEL_1)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_2_PROFILE_LEVEL_1)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_2_LEVEL_2)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_2_PROFILE_LEVEL_2))},t.isLevel0ImageProfile=function(e){return!!(t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_0)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_0)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_0)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_0)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_LEVEL_0)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_PROFILE_LEVEL_0)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_2_LEVEL_0)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_2_PROFILE_LEVEL_0))},t.isLevel1ImageProfile=function(e){return!!(t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_1)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_LEVEL_1)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_2_LEVEL_1)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_2_PROFILE_LEVEL_1))},t.isLevel2ImageProfile=function(e){return!!(t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_LEVEL_2)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_2_LEVEL_2)||t.normalisedUrlsMatch(e,o.ServiceProfile.IMAGE_2_PROFILE_LEVEL_2))},t.parseManifest=function(t,e){return Q.parse(t,e)},t.checkStatus=function(t){if(t.ok)return t;var e=new Error(t.statusText);return e.response=t,Promise.reject(e)},t.loadManifest=function(e){return new Promise((function(n,i){fetch(e).then(t.checkStatus).then((function(t){return t.json()})).then((function(t){n(t)})).catch((function(t){i()}))}))},t.loadExternalResourcesAuth1=function(e,n,i,r,a,o,s,u){return new Promise((function(l,c){var h=e.map((function(e){return t.loadExternalResourceAuth1(e,n,i,r,a,o,s,u)}));Promise.all(h).then((function(){l(e)})).catch((function(t){c(t)}))}))},t.loadExternalResourceAuth1=function(e,n,i,r,a,o,s,u){return N(this,void 0,void 0,(function(){var l;return D(this,(function(c){switch(c.label){case 0:return[4,r(e)];case 1:return(l=c.sent())?[4,e.getData(l)]:[3,6];case 2:return c.sent(),e.status!==x.OK?[3,3]:[2,e];case 3:return[4,t.doAuthChain(e,n,i,a,o,s,u)];case 4:c.sent(),c.label=5;case 5:if(e.status===x.OK||e.status===x.MOVED_TEMPORARILY)return[2,e];throw t.createAuthorizationFailedError();case 6:return[4,e.getData()];case 7:return c.sent(),e.status!==x.MOVED_TEMPORARILY&&e.status!==x.UNAUTHORIZED?[3,9]:[4,t.doAuthChain(e,n,i,a,o,s,u)];case 8:c.sent(),c.label=9;case 9:if(e.status===x.OK||e.status===x.MOVED_TEMPORARILY)return[2,e];throw t.createAuthorizationFailedError()}}))}))},t.doAuthChain=function(e,n,i,r,a,o,s){return N(this,void 0,void 0,(function(){var u,l,c,h,p,f,d,g;return D(this,(function(v){switch(v.label){case 0:return e.isAccessControlled()?((u=e.externalService)&&(u.options=e.options),(l=e.kioskService)&&(l.options=e.options),(c=e.clickThroughService)&&(c.options=e.options),(h=e.loginService)&&(h.options=e.options),e.isResponseHandled||e.status!==x.MOVED_TEMPORARILY?[3,2]:[4,o(e)]):[2,e];case 1:case 3:case 6:case 10:case 14:return v.sent(),[2,e];case 2:return p=null,f=null,(p=u)?(f=p,[4,t.attemptResourceWithToken(e,i,p)]):[3,4];case 4:return(p=l)?(f=p,(d=n(p))?[4,r(d)]:[3,7]):[3,7];case 5:case 9:case 13:return v.sent(),[4,t.attemptResourceWithToken(e,i,p)];case 7:return(p=c)?(f=p,[4,a(e,p)]):[3,11];case 8:return(g=v.sent())?[4,r(g)]:[3,11];case 11:return(p=h)?(f=p,[4,a(e,p)]):[3,15];case 12:return(g=v.sent())?[4,r(g)]:[3,15];case 15:return f&&s(e,f),[2]}}))}))},t.attemptResourceWithToken=function(t,e,n){return N(this,void 0,void 0,(function(){var i,r;return D(this,(function(a){switch(a.label){case 0:return(i=n.getService(o.ServiceProfile.AUTH_1_TOKEN))?[4,e(t,i)]:[3,3];case 1:return(r=a.sent())&&r.accessToken?[4,t.getData(r)]:[3,3];case 2:return a.sent(),[2,t];case 3:return[2]}}))}))},t.loadExternalResourcesAuth09=function(e,n,i,r,a,o,s,u,l,c){return new Promise((function(h,p){var f=e.map((function(e){return t.loadExternalResourceAuth09(e,n,i,r,a,o,s,u,l,c)}));Promise.all(f).then((function(){h(e)})).catch((function(t){p(t)}))}))},t.loadExternalResourceAuth09=function(e,n,i,r,a,o,s,u,l,c){return new Promise((function(h,p){c&&c.pessimisticAccessControl?e.getData().then((function(){e.isAccessControlled()?e.clickThroughService?(h(i(e)),h(r(e))):a(e).then((function(){o(e,!0).then((function(n){e.getData(n).then((function(){h(l(e))})).catch((function(e){p(t.createInternalServerError(e))}))})).catch((function(e){p(t.createInternalServerError(e))}))})).catch((function(e){p(t.createInternalServerError(e))})):h(e)})).catch((function(e){p(t.createInternalServerError(e))})):u(e,n).then((function(c){c?e.getData(c).then((function(){e.status===x.OK?h(l(e)):t.authorize(e,n,i,r,a,o,s,u).then((function(){h(l(e))})).catch((function(e){p(t.createAuthorizationFailedError())}))})).catch((function(e){p(t.createAuthorizationFailedError())})):t.authorize(e,n,i,r,a,o,s,u).then((function(){h(l(e))})).catch((function(e){p(t.createAuthorizationFailedError())}))})).catch((function(e){p(t.createAuthorizationFailedError())}))}))},t.createError=function(t,e){var n=new Error;return n.message=e,n.name=String(t),n},t.createAuthorizationFailedError=function(){return t.createError(G.AUTHORIZATION_FAILED,"Authorization failed")},t.createRestrictedError=function(){return t.createError(G.RESTRICTED,"Restricted")},t.createInternalServerError=function(e){return t.createError(G.INTERNAL_SERVER_ERROR,e)},t.authorize=function(e,n,i,r,a,o,s,u){return new Promise((function(l,c){e.getData().then((function(){e.isAccessControlled()?u(e,n).then((function(u){u?e.getData(u).then((function(){e.status===x.OK?l(e):t.showAuthInteraction(e,n,i,r,a,o,s,l,c)})).catch((function(e){c(t.createInternalServerError(e))})):o(e,!1).then((function(u){u?s(e,u,n).then((function(){e.getData(u).then((function(){e.status===x.OK?l(e):t.showAuthInteraction(e,n,i,r,a,o,s,l,c)})).catch((function(e){c(t.createInternalServerError(e))}))})).catch((function(e){c(t.createInternalServerError(e))})):t.showAuthInteraction(e,n,i,r,a,o,s,l,c)}))})).catch((function(e){c(t.createInternalServerError(e))})):l(e)}))}))},t.showAuthInteraction=function(e,n,i,r,a,o,s,u,l){e.status!==x.MOVED_TEMPORARILY||e.isResponseHandled?e.clickThroughService&&!e.isResponseHandled?i(e).then((function(){o(e,!0).then((function(i){s(e,i,n).then((function(){e.getData(i).then((function(){u(e)})).catch((function(e){l(t.createInternalServerError(e))}))})).catch((function(e){l(t.createInternalServerError(e))}))})).catch((function(e){l(t.createInternalServerError(e))}))})):a(e).then((function(){o(e,!0).then((function(i){s(e,i,n).then((function(){e.getData(i).then((function(){u(e)})).catch((function(e){l(t.createInternalServerError(e))}))})).catch((function(e){l(t.createInternalServerError(e))}))})).catch((function(e){l(t.createInternalServerError(e))}))})):u(e)},t.getService=function(t,e){for(var n=this.getServices(t),i=0;i<n.length;i++){var r=n[i];if(r.getProfile()===e)return r}return null},t.getResourceById=function(e,n){return t.traverseAndFind(e.__jsonld,"@id",n)},t.traverseAndFind=function(e,n,i){if(e.hasOwnProperty(n)&&e[n]===i)return e;for(var r=0;r<Object.keys(e).length;r++)if("object"==typeof e[Object.keys(e)[r]]){var a=t.traverseAndFind(e[Object.keys(e)[r]],n,i);if(null!=a)return a}},t.getServices=function(t){var e,n=[];if(!(e=t.__jsonld?t.__jsonld.service:t.service))return n;Array.isArray(e)||(e=[e]);for(var i=0;i<e.length;i++){var r=e[i];if("string"==typeof r){var a=this.getResourceById(t.options.resource,r);a&&n.push(new J(a.__jsonld||a,t.options))}else n.push(new J(r,t.options))}return n},t.getTemporalComponent=function(t){var e=/t=([^&]+)/g.exec(t),n=null;return e&&e[1]&&(n=e[1].split(",")),n},t}(),j=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),$=function(){function t(t,e,n){void 0===n&&(n="none"),Array.isArray(t)&&1===t.length?this._value=t[0]:this._value=t,"none"!==e&&"@none"!==e||(e=void 0),this._locale=e,this._defaultLocale=n}return t.parseV2Value=function(e,n){return"string"==typeof e?new t(e,void 0,n):e["@value"]?new t(e["@value"],e["@language"],n):null},Object.defineProperty(t.prototype,"value",{get:function(){return Array.isArray(this._value)?this._value.join("<br/>"):this._value},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"locale",{get:function(){return void 0===this._locale?this._defaultLocale:this._locale},enumerable:!0,configurable:!0}),t.prototype.addValue=function(t){Array.isArray(this._value)||(this._value=[this._value]),Array.isArray(t)?this._value=this._value.concat(t):this._value.push(t)},t}(),k=function(t){function e(n,i){void 0===n&&(n=[]);var r=t.apply(this,n)||this;return r.__proto__=e.prototype,r._defaultLocale=i,r}return j(e,t),e.parse=function(t,n){if(!t)return new e([],n);if(Array.isArray(t)){var i=(r=t.map((function(t){return $.parseV2Value(t,n)})).filter((function(t){return null!==t}))).reduce((function(t,e){var n=e._locale;return n||(n="none"),t[n]?t[n].addValue(e._value):t[n]=e,t}),{});return new e(Object.values(i),n)}return"string"==typeof t?new e([new $(t,void 0,n)],n):t["@language"]?new e(null!==(r=$.parseV2Value(t))?[r]:[],n):new e(Object.keys(t).map((function(e){var i=t[e];if(!Array.isArray(i))throw new Error("A IIIF v3 localized property value must have an array as the value for a given language.");return new $(i,e,n)})),n);var r},e.prototype.getSuitableLocale=function(t){for(var e=function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var i=Array(t),r=0;for(e=0;e<n;e++)for(var a=arguments[e],o=0,s=a.length;o<s;o++,r++)i[r]=a[o];return i}(this).map((function(t){return t._locale})).filter((function(t){return void 0!==t})),n=function(t){var n=e.find((function(e){return e===t}));if(n)return{value:n}},i=0,r=t;i<r.length;i++){var a=n(r[i]);if("object"==typeof a)return a.value}for(var o=function(t){var n=e.find((function(e){return V.getInexactLocale(e)===V.getInexactLocale(t)}));if(n)return{value:n}},s=0,u=t;s<u.length;s++){var l=o(u[s]);if("object"==typeof l)return l.value}},e.prototype.setValue=function(t,e){var n=void 0;if(e){var i=this.getSuitableLocale([e]);i&&(n=this.find((function(t){return t._locale===i})))}else n=this.find((function(t){return void 0===t._locale}));n?n._value=t:this.push(new $(t,e,this._defaultLocale))},e.prototype.getValue=function(t,e){var n=this.getValues(t);return 0===n.length?null:e?n.join(e):n[0]},e.prototype.getValues=function(t){if(!this.length)return[];var e;if(e=t?Array.isArray(t)?t:[t]:[],1===this.length&&void 0===this[0]._locale){var n=this[0]._value;return Array.isArray(n)?n:[n]}var i=this.getSuitableLocale(e);if(i)return n=this.find((function(t){return t._locale===i}))._value,Array.isArray(n)?n:[n];if(!this.find((function(t){return void 0===t._locale})))return n=this[0]._value,Array.isArray(n)?n:[n];var r=this.find((function(t){return void 0===t._locale}));return r?Array.isArray(r._value)?r._value:[r._value]:[]},e}(Array),U=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),H=function(t){function e(e,n){var i=t.call(this,e,n)||this;if(i.index=0,i._allRanges=null,i.items=[],i._topRanges=[],i.__jsonld.structures&&i.__jsonld.structures.length)for(var r=i._getTopRanges(),a=0;a<r.length;a++){var o=r[a];i._parseRanges(o,String(a))}return i}return U(e,t),e.prototype.getPosterCanvas=function(){var t=this.getProperty("posterCanvas");return t&&(t=new A(t,this.options)),t},e.prototype.getAccompanyingCanvas=function(){var t=this.getProperty("accompanyingCanvas");return t&&(t=new A(t,this.options)),t},e.prototype.getBehavior=function(){var t=this.getProperty("behavior");return Array.isArray(t)&&(t=t[0]),t||null},e.prototype.getDefaultTree=function(){if(t.prototype.getDefaultTree.call(this),this.defaultTree.data.type=V.normaliseType(tt.MANIFEST),!this.isLoaded)return this.defaultTree;var e=this.getTopRanges();return e.length&&e[0].getTree(this.defaultTree),V.generateTreeNodeIds(this.defaultTree),this.defaultTree},e.prototype._getTopRanges=function(){var t=[];if(this.__jsonld.structures&&this.__jsonld.structures.length){for(var e=0;e<this.__jsonld.structures.length;e++){var n=this.__jsonld.structures[e];n.viewingHint===o.ViewingHint.TOP&&t.push(n)}if(!t.length){var i={};i.ranges=this.__jsonld.structures,t.push(i)}}return t},e.prototype.getTopRanges=function(){return this._topRanges},e.prototype._getRangeById=function(t){if(this.__jsonld.structures&&this.__jsonld.structures.length)for(var e=0;e<this.__jsonld.structures.length;e++){var n=this.__jsonld.structures[e];if(n["@id"]===t||n.id===t)return n}return null},e.prototype._parseRanges=function(t,e,n){var i,r=null;if("string"==typeof t&&(r=t,t=this._getRangeById(r)),t){(i=new W(t,this.options)).parentRange=n,i.path=e,n?n.items.push(i):this._topRanges.push(i);var a=t.items||t.members;if(a)for(var o=0;o<a.length;o++){var s=a[o];if(s["@type"]&&"sc:range"===s["@type"].toLowerCase()||s.type&&"range"===s.type.toLowerCase())this._parseRanges(s,e+"/"+o,i);else if(s["@type"]&&"sc:canvas"===s["@type"].toLowerCase()||s.type&&"canvas"===s.type.toLowerCase()){i.canvases||(i.canvases=[]);var u=s.id||s["@id"];i.canvases.push(u)}}else if(t.ranges)for(o=0;o<t.ranges.length;o++)this._parseRanges(t.ranges[o],e+"/"+o,i)}else console.warn("Range:",r,"does not exist")},e.prototype.getAllRanges=function(){if(null!=this._allRanges)return this._allRanges;this._allRanges=[];for(var t=this.getTopRanges(),e=function(e){var i=t[e];i.id&&n._allRanges.push(i);var r=function(t,e){t.add(e);var n=e.getRanges();return n.length?n.reduce(r,t):t},a=Array.from(i.getRanges().reduce(r,new Set));n._allRanges=n._allRanges.concat(a)},n=this,i=0;i<t.length;i++)e(i);return this._allRanges},e.prototype.getRangeById=function(t){for(var e=this.getAllRanges(),n=0;n<e.length;n++){var i=e[n];if(i.id===t)return i}return null},e.prototype.getRangeByPath=function(t){for(var e=this.getAllRanges(),n=0;n<e.length;n++){var i=e[n];if(i.path===t)return i}return null},e.prototype.getSequences=function(){if(this.items.length)return this.items;var t=this.__jsonld.mediaSequences||this.__jsonld.sequences;if(t)for(var e=0;e<t.length;e++){var n=t[e],i=new q(n,this.options);this.items.push(i)}else this.__jsonld.items&&(i=new q(this.__jsonld.items,this.options),this.items.push(i));return this.items},e.prototype.getSequenceByIndex=function(t){return this.getSequences()[t]},e.prototype.getTotalSequences=function(){return this.getSequences().length},e.prototype.getManifestType=function(){var t=this.getService(o.ServiceProfile.UI_EXTENSIONS);return t?t.getProperty("manifestType"):r.EMPTY},e.prototype.isMultiSequence=function(){return this.getTotalSequences()>1},e.prototype.isPagingEnabled=function(){var t=this.getViewingHint();if(t)return t===o.ViewingHint.PAGED;var e=this.getBehavior();return!!e&&e===o.Behavior.PAGED},e.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")},e.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},e}(p);!function(t){t.EMPTY="",t.MANUSCRIPT="manuscript",t.MONOGRAPH="monograph"}(r||(r={}));var G,B=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),W=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i._ranges=null,i.canvases=null,i.items=[],i}return B(e,t),e.prototype.getCanvasIds=function(){return this.__jsonld.canvases?this.__jsonld.canvases:this.canvases?this.canvases:[]},e.prototype.getDuration=function(){if(this.canvases&&this.canvases.length){for(var t=[],e=[],n=0,i=this.canvases;n<i.length;n++)if(f=i[n]){var r=f.match(/(.*)#t=([0-9.]+),?([0-9.]+)?/)||[void 0,f],a=r[1],o=r[2],s=r[3];a&&(t.push(parseFloat(o)),e.push(parseFloat(s)))}if(t.length&&e.length)return new b(Math.min.apply(Math,t),Math.max.apply(Math,e))}else{t=[],e=[];for(var u=0,l=g=this.getRanges();u<l.length;u++)(v=l[u].getDuration())&&(t.push(v.start),e.push(v.end));if(t.length&&e.length)return new b(Math.min.apply(Math,t),Math.max.apply(Math,e))}var c,h;if(this.canvases&&this.canvases.length)for(var p=0;p<this.canvases.length;p++){var f=this.canvases[p],d=V.getTemporalComponent(f);d&&d.length>1&&(0===p&&(c=Number(d[0])),p===this.canvases.length-1&&(h=Number(d[1])))}else{var g=this.getRanges();for(p=0;p<g.length;p++){var v;(v=g[p].getDuration())&&(0===p&&(c=v.start),p===g.length-1&&(h=v.end))}}if(void 0!==c&&void 0!==h)return new b(c,h)},e.prototype.getRanges=function(){return this._ranges?this._ranges:this._ranges=this.items.filter((function(t){return t.isRange()}))},e.prototype.getBehavior=function(){var t=this.getProperty("behavior");return Array.isArray(t)&&(t=t[0]),t||null},e.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")},e.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},e.prototype.getTree=function(t){t.data=this,this.treeNode=t;var e=this.getRanges();if(e&&e.length)for(var n=0;n<e.length;n++){var i=e[n],r=new rt;t.addNode(r),this._parseTreeNode(r,i)}return V.generateTreeNodeIds(t),t},e.prototype.spansTime=function(t){var e=this.getDuration();return!!(e&&t>=e.start&&t<=e.end)},e.prototype._parseTreeNode=function(t,e){t.label=e.getLabel().getValue(this.options.locale),t.data=e,t.data.type=V.normaliseType(tt.RANGE),e.treeNode=t;var n=e.getRanges();if(n&&n.length)for(var i=0;i<n.length;i++){var r=n[i];if(r.getBehavior()!==o.Behavior.NO_NAV){var a=new rt;t.addNode(a),this._parseTreeNode(a,r)}}},e}(u),z=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),Y=function(t){function e(e,n){return t.call(this,e,n)||this}return z(e,t),e.prototype.getFormat=function(){return this.getProperty("format")},e}(u),X=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),q=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i.items=[],i._thumbnails=null,i}return X(e,t),e.prototype.getCanvases=function(){if(this.items.length)return this.items;var t=this.__jsonld.canvases||this.__jsonld.elements;if(t)for(var e=0;e<t.length;e++){var n=t[e];(i=new A(n,this.options)).index=e,this.items.push(i)}else if(this.__jsonld)for(e=0;e<this.__jsonld.length;e++){var i;n=this.__jsonld[e],(i=new A(n,this.options)).index=e,this.items.push(i)}return this.items},e.prototype.getCanvasById=function(t){for(var e=0;e<this.getTotalCanvases();e++){var n=this.getCanvasByIndex(e),i=V.normaliseUrl(n.id);if(V.normaliseUrl(t)===i)return n}return null},e.prototype.getCanvasByIndex=function(t){return this.getCanvases()[t]},e.prototype.getCanvasIndexById=function(t){for(var e=0;e<this.getTotalCanvases();e++)if(this.getCanvasByIndex(e).id===t)return e;return null},e.prototype.getCanvasIndexByLabel=function(t,e){t=t.trim(),isNaN(t)||(t=parseInt(t,10).toString(),e&&(t+="r"));for(var n,i,r,a=/(\d*)\D+(\d*)/,o=0;o<this.getTotalCanvases();o++){var s=this.getCanvasByIndex(o);if(s.getLabel().getValue(this.options.locale)===t)return o;if((n=a.exec(t))&&(i=n[1],(r=n[2])&&new RegExp("^"+i+"\\D+"+r+"$").test(s.getLabel().toString())))return o}return-1},e.prototype.getLastCanvasLabel=function(t){for(var e=this.getTotalCanvases()-1;e>=0;e--){var n=this.getCanvasByIndex(e).getLabel().getValue(this.options.locale);if(t){if(/^[a-zA-Z0-9]*$/.test(n))return n}else if(n)return n}return this.options.defaultLabel},e.prototype.getLastPageIndex=function(){return this.getTotalCanvases()-1},e.prototype.getNextPageIndex=function(t,e){var n;if(e){var i=this.getPagedIndices(t),r=this.getViewingDirection();n=r&&r===o.ViewingDirection.RIGHT_TO_LEFT?i[0]+1:i[i.length-1]+1}else n=t+1;return n>this.getLastPageIndex()?-1:n},e.prototype.getPagedIndices=function(t,e){var n=[];if(e){n=this.isFirstCanvas(t)||this.isLastCanvas(t)?[t]:t%2?[t,t+1]:[t-1,t];var i=this.getViewingDirection();i&&i===o.ViewingDirection.RIGHT_TO_LEFT&&(n=n.reverse())}else n.push(t);return n},e.prototype.getPrevPageIndex=function(t,e){var n;if(e){var i=this.getPagedIndices(t),r=this.getViewingDirection();n=r&&r===o.ViewingDirection.RIGHT_TO_LEFT?i[i.length-1]-1:i[0]-1}else n=t-1;return n},e.prototype.getStartCanvasIndex=function(){var t=this.getStartCanvas();if(t)for(var e=0;e<this.getTotalCanvases();e++)if(this.getCanvasByIndex(e).id===t)return e;return 0},e.prototype.getThumbs=function(t,e){for(var n=[],i=this.getTotalCanvases(),r=0;r<i;r++){var a=this.getCanvasByIndex(r),o=new et(t,a);n.push(o)}return n},e.prototype.getThumbnails=function(){if(null!=this._thumbnails)return this._thumbnails;this._thumbnails=[];for(var t=this.getCanvases(),e=0;e<t.length;e++){var n=t[e].getThumbnail();n&&this._thumbnails.push(n)}return this._thumbnails},e.prototype.getStartCanvas=function(){return this.getProperty("startCanvas")},e.prototype.getTotalCanvases=function(){return this.getCanvases().length},e.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?this.getProperty("viewingDirection"):this.options.resource.getViewingDirection?this.options.resource.getViewingDirection():null},e.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},e.prototype.isCanvasIndexOutOfRange=function(t){return t>this.getTotalCanvases()-1},e.prototype.isFirstCanvas=function(t){return 0===t},e.prototype.isLastCanvas=function(t){return t===this.getTotalCanvases()-1},e.prototype.isMultiCanvas=function(){return this.getTotalCanvases()>1},e.prototype.isPagingEnabled=function(){var t=this.getViewingHint();return!!t&&t===o.ViewingHint.PAGED},e.prototype.isTotalCanvasesEven=function(){return this.getTotalCanvases()%2==0},e}(u),Q=function(){function t(){}return t.parse=function(t,e){return"string"==typeof t&&(t=JSON.parse(t)),this.parseJson(t,e)},t.parseJson=function(t,e){var n;if(e&&e.navDate&&!isNaN(e.navDate.getTime())&&(t.navDate=e.navDate.toString()),t["@type"])switch(t["@type"]){case"sc:Collection":n=this.parseCollection(t,e);break;case"sc:Manifest":n=this.parseManifest(t,e);break;default:return null}else switch(t.type){case"Collection":n=this.parseCollection(t,e);break;case"Manifest":n=this.parseManifest(t,e);break;default:return null}return n.isLoaded=!0,n},t.parseCollection=function(t,e){var n=new O(t,e);return e?(n.index=e.index||0,e.resource&&(n.parentCollection=e.resource.parentCollection)):n.index=0,this.parseCollections(n,e),this.parseManifests(n,e),this.parseItems(n,e),n},t.parseCollections=function(t,e){var n;if(t.__jsonld.collections?n=t.__jsonld.collections:t.__jsonld.items&&(n=t.__jsonld.items.filter((function(t){return"collection"===t.type.toLowerCase()}))),n)for(var i=0;i<n.length;i++){e&&(e.index=i);var r=this.parseCollection(n[i],e);r.index=i,r.parentCollection=t,t.items.push(r)}},t.parseManifest=function(t,e){return new H(t,e)},t.parseManifests=function(t,e){var n;if(t.__jsonld.manifests?n=t.__jsonld.manifests:t.__jsonld.items&&(n=t.__jsonld.items.filter((function(t){return"manifest"===t.type.toLowerCase()}))),n)for(var i=0;i<n.length;i++){var r=this.parseManifest(n[i],e);r.index=i,r.parentCollection=t,t.items.push(r)}},t.parseItem=function(t,e){if(t["@type"]){if("sc:manifest"===t["@type"].toLowerCase())return this.parseManifest(t,e);if("sc:collection"===t["@type"].toLowerCase())return this.parseCollection(t,e)}else if(t.type){if("manifest"===t.type.toLowerCase())return this.parseManifest(t,e);if("collection"===t.type.toLowerCase())return this.parseCollection(t,e)}return null},t.parseItems=function(t,e){var n=t.__jsonld.members||t.__jsonld.items;if(n)for(var i=function(i){e&&(e.index=i);var a=r.parseItem(n[i],e);return a?t.items.filter((function(t){return t.id===a.id}))[0]?"continue":(a.index=i,a.parentCollection=t,void t.items.push(a)):{value:void 0}},r=this,a=0;a<n.length;a++){var o=i(a);if("object"==typeof o)return o.value}},t}(),K=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),J=function(t){function e(e,n){return t.call(this,e,n)||this}return K(e,t),e.prototype.getProfile=function(){var t=this.getProperty("profile");return t||(t=this.getProperty("dcterms:conformsTo")),Array.isArray(t)?t[0]:t},e.prototype.getConfirmLabel=function(){return V.getLocalisedValue(this.getProperty("confirmLabel"),this.options.locale)},e.prototype.getDescription=function(){return V.getLocalisedValue(this.getProperty("description"),this.options.locale)},e.prototype.getFailureDescription=function(){return V.getLocalisedValue(this.getProperty("failureDescription"),this.options.locale)},e.prototype.getFailureHeader=function(){return V.getLocalisedValue(this.getProperty("failureHeader"),this.options.locale)},e.prototype.getHeader=function(){return V.getLocalisedValue(this.getProperty("header"),this.options.locale)},e.prototype.getServiceLabel=function(){return V.getLocalisedValue(this.getProperty("label"),this.options.locale)},e.prototype.getInfoUri=function(){var t=this.id;return t.endsWith("/")||(t+="/"),t+"info.json"},e}(u),Z=function(t,e){this.width=t,this.height=e};!function(t){t[t.AUTHORIZATION_FAILED=1]="AUTHORIZATION_FAILED",t[t.FORBIDDEN=2]="FORBIDDEN",t[t.INTERNAL_SERVER_ERROR=3]="INTERNAL_SERVER_ERROR",t[t.RESTRICTED=4]="RESTRICTED"}(G||(G={}));var tt,et=function(t,e){this.data=e,this.index=e.index,this.width=t;var n=e.getHeight()/e.getWidth();this.height=n?Math.floor(this.width*n):t,this.uri=e.getCanonicalImageUri(t),this.label=e.getLabel().getValue()},nt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),it=function(t){function e(e,n){return t.call(this,e,n)||this}return nt(e,t),e}(c),rt=function(){function t(t,e){this.label=t,this.data=e||{},this.nodes=[]}return t.prototype.addNode=function(t){this.nodes.push(t),t.parentNode=this},t.prototype.isCollection=function(){return this.data.type===V.normaliseType(tt.COLLECTION)},t.prototype.isManifest=function(){return this.data.type===V.normaliseType(tt.MANIFEST)},t.prototype.isRange=function(){return this.data.type===V.normaliseType(tt.RANGE)},t}();!function(t){t.COLLECTION="collection",t.MANIFEST="manifest",t.RANGE="range"}(tt||(tt={}));var at=function(t){return V.loadManifest(t)},ot=function(t,e){return V.parseManifest(t,e)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.VOLUME_CHANGED="volumechanged",t}();e.VolumeEvents=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){void 0===e&&(e={}),this.source=t,this.options=e}return t.prototype.attachTo=function(t){t.setAttribute("src",this.source)},t}();e.MediaFormat=i},function(t,e,n){"use strict";function i(t,e){return t*e}Object.defineProperty(e,"__esModule",{value:!0}),e.timelineTime=function(t){return t},e.canvasTime=function(t){return t},e.annotationTime=function(t){return t},e.addTime=function(t,e){return t+e},e.minusTime=function(t,e){return t-e},e.multiplyTime=i,e.toMs=function(t){return i(t,1e3)},e.fromMs=function(t){return t/1e3}},function(t,e,n){var i=n(23);t.exports=function(t){return null!=t&&t.length?i(t,1):[]}},function(t,e,n){var i=n(40).Symbol;t.exports=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.NEXT_RANGE="nextrange",t.PAUSECANVAS="pause",t.PLAYCANVAS="play",t.PREVIOUS_RANGE="previousrange",t}();e.CanvasInstanceEvents=i},function(t,e,n){"use strict";n.r(e),n.d(e,"BaseComponent",(function(){return i}));var i=function(){function t(t){this.options=t,this.options.data=Object.assign({},this.data(),t.data)}return t.prototype._init=function(){return this.el=this.options.target,this.el?(this.el.innerHTML="",!0):(console.warn("element not found"),!1)},t.prototype.data=function(){return{}},t.prototype.on=function(t,e,n){var i=this._e||(this._e={});(i[t]||(i[t]=[])).push({fn:e,ctx:n})},t.prototype.fire=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var i=[].slice.call(arguments,1),r=((this._e||(this._e={}))[t]||[]).slice(),a=0,o=r.length;a<o;a++)r[a].fn.apply(r[a].ctx,i)},t.prototype._resize=function(){},t.prototype.set=function(t){},t}()},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),r=n(26),a=n(12),o=function(){function t(){this.canvases=[],this.durationMap={},this.totalDuration=0,this.id=r.getTimestamp()}return t.prototype.addCanvas=function(t){this.canvases.push(jQuery.extend(!0,{},t));var e=t.getDuration()||0;this.totalDuration+=e,this.durationMap[t.id]={duration:e,runningDuration:this.totalDuration}},t.prototype.getContent=function(){var t=this,e=[];return this.canvases.forEach((function(n){var r=n.getContent();r.forEach((function(t){var e=t.getTarget();e&&(i.Utils.getTemporalComponent(e)||(t.__jsonld.target+="#t=0,"+n.getDuration()))})),r.forEach((function(e){var n=e.getTarget();n&&(e.__jsonld.target=a.retargetTemporalComponent(t.canvases,n))})),e.push.apply(e,r)})),e},t.prototype.getDuration=function(){var t=0;return this.canvases.forEach((function(e){var n=e.getDuration();n&&(t+=n)})),Math.floor(t)},t.prototype.getWidth=function(){return this.canvases.length?this.canvases[0].getWidth():0},t.prototype.getHeight=function(){return this.canvases.length?this.canvases[0].getHeight():0},t}();e.VirtualCanvas=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(3);e.retargetTemporalComponent=function(t,e){var n=i.Utils.getTemporalComponent(e);if(n){for(var r=0,a=e.substr(0,e.indexOf("#")),o=0;o<t.length;o++){var s=t[o];if(s.id.includes(a))break;var u=s.getDuration();u&&(r+=u)}return n[0]=Number(n[0])+r,n[1]=Number(n[1])+r,a+"#t="+n[0]+","+n[1]}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(14);e.isHLSFormat=function(t){return i.hlsMimeTypes.includes(t.toString())}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.hlsMimeTypes=["application/vnd.apple.mpegurl","vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"]},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isMpegDashFormat=function(t){return"application/dash+xml"===t.toString()}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(14);e.canPlayHls=function(){var t="object"==typeof document&&document,e=t&&t.createElement("video");return Boolean(e&&e.canPlayType)&&i.hlsMimeTypes.some((function(t){return!!e&&/maybe|probably/i.test(e.canPlayType(t))}))}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isSafari=function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getSpatialComponent=function(t){var e=/xywh=([^&]+)/g.exec(t),n=null;return e&&e[1]&&(n=e[1].split(",")),n}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.PLAY="play",t.PAUSE="pause",t.MEDIA_READY="mediaready",t.LOG="log",t.RANGE_CHANGED="rangechanged",t.WAVEFORM_READY="waveformready",t.WAVEFORMS_READY="waveformsready",t}();e.Events=i},function(t,e,n){"use strict";function i(t,e){var n=[];return Object.keys(t).forEach((function(i){Object.is(e[i],t[i])||n.push(i)})),n}Object.defineProperty(e,"__esModule",{value:!0}),e.diffData=function(t,e){return Array.from(new Set(i(t,e).concat(i(e,t))))}},function(t,e,n){var i=n(23);t.exports=function(t){return null!=t&&t.length?i(t,1/0):[]}},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,a){function o(t){try{u(i.next(t))}catch(t){a(t)}}function s(t){try{u(i.throw(t))}catch(t){a(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}u((i=i.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var n,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(e,"__esModule",{value:!0});var s=n(3),u=n(9),l=n(10),c=n(4),h=n(11),p=n(27),f=n(20),d=n(35),g=n(19),v=n(2),_=function(t){function e(e){var n=t.call(this,e)||this;return n._data=n.data(),n.canvasInstances=[],n._readyMedia=0,n._readyWaveforms=0,n._posterCanvasWidth=0,n._posterCanvasHeight=0,n._posterImageExpanded=!1,n._init(),n._resize(),n}return r(e,t),e.prototype._init=function(){var e=t.prototype._init.call(this);return this._$element=$(this.el),e||v.Logger.error("Component failed to initialise"),e},e.prototype.getCurrentCanvasInstance=function(){var t=this._data.helper.getRangeById(this._data.range.id);if(!t)return null;var e=d.getFirstTargetedCanvasId(t);return e?this._data.helper.getCanvasById(e):null},e.prototype.data=function(){return{autoPlay:!1,constrainNavigationToRange:!1,defaultAspectRatio:.56,doubleClickMS:350,halveAtWidth:200,limitToRange:!1,posterImageRatio:.3,virtualCanvasEnabled:!0,content:{currentTime:"Current Time",collapse:"Collapse",duration:"Duration",expand:"Expand",mute:"Mute",next:"Next",pause:"Pause",play:"Play",previous:"Previous",unmute:"Unmute"},enableFastForward:!0,enableFastRewind:!0}},e.prototype.set=function(t){var e=this;v.Logger.groupCollapsed("AVComponent.set()"),v.Logger.log("Data",t);var n=Object.assign({},this._data);this._data=Object.assign(this._data,t);var i=f.diffData(n,this._data);if(i.includes("helper")&&this._reset(),this._data.helper){if(this.canvasInstances.forEach((function(t,n){var r={};i.includes("limitToRange")&&e._data.canvasId&&(r.limitToRange=e._data.limitToRange),i.includes("constrainNavigationToRange")&&e._data.canvasId&&(r.constrainNavigationToRange=e._data.constrainNavigationToRange),i.includes("autoSelectRange")&&e._data.canvasId&&(r.autoSelectRange=e._data.autoSelectRange),t.set(r)})),(i.includes("virtualCanvasEnabled")||i.includes("canvasId"))&&this._data.canvasId){var r=this._getCanvasInstanceById(this._data.canvasId);r&&this.canvasInstances.forEach((function(t){t.getCanvasId()!==r.getCanvasId()?t.set({visible:!1}):i.includes("range")?t.set({visible:!0,range:e._data.range?jQuery.extend(!0,{},e._data.range):void 0}):t.set({visible:!0})}))}if(i.includes("virtualCanvasEnabled")&&(this.set({range:void 0}),this._data.virtualCanvasEnabled&&this.canvasInstances.forEach((function(t){t.isVirtual()&&e.set({canvasId:t.getCanvasId(),range:void 0})}))),i.includes("range")&&this._data.range){var a=this._data.helper.getRangeById(this._data.range.id);if(a){var o=d.getFirstTargetedCanvasId(a);if(o){var u=this._getCanvasInstanceById(o);if(u){if(u.isVirtual()&&this._data.virtualCanvasEnabled&&u.includesVirtualSubCanvas(o)){o=u.getCanvasId();for(var l=0;l<u.ranges.length;l++){var c=u.ranges[l];if(c.id===a.id){a=c;break}}}this._data.canvasId&&(this._data.canvasId.includes("://")?s.Utils.normaliseUrl(this._data.canvasId):this._data.canvasId)!==o?this.set({canvasId:o,range:jQuery.extend(!0,{},a)}):u.set({range:jQuery.extend(!0,{},a)})}}}else v.Logger.warn("range not found",{id:this._data.range.id})}this._render(),this._resize(),v.Logger.groupEnd()}else v.Logger.warn("must pass a helper object")},e.prototype._render=function(){},e.prototype.reset=function(){this._reset()},e.prototype._reset=function(){var t=this;if(this._readyMedia=0,this._readyWaveforms=0,this._posterCanvasWidth=0,this._posterCanvasHeight=0,clearInterval(this._checkAllMediaReadyInterval),clearInterval(this._checkAllWaveformsReadyInterval),this.canvasInstances.forEach((function(t){t.destroy()})),this.canvasInstances=[],this._$element.empty(),this._data&&this._data.helper&&this._data.helper.manifest){var e=this._data.helper.manifest.getBehavior(),n=this._getCanvases();if(e&&"auto-advance"===e.toString()){var i=new h.VirtualCanvas;n.forEach((function(t){i.addCanvas(t)})),this._initCanvas(i)}n.forEach((function(e){t._initCanvas(e)})),this.canvasInstances.length>0&&(this._data.canvasId=this.canvasInstances[0].getCanvasId()),this._checkAllMediaReadyInterval=setInterval(this._checkAllMediaReady.bind(this),100),this._checkAllWaveformsReadyInterval=setInterval(this._checkAllWaveformsReady.bind(this),100),this._$posterContainer=$('<div class="poster-container"></div>'),this._$element.append(this._$posterContainer),this._$posterImage=$('<div class="poster-image"></div>'),this._$posterExpandButton=$('\n                    <button class="btn" title="'+(this._data&&this._data.content?this._data.content.expand:"")+'">\n                        <i class="av-icon  av-icon-expand expand" aria-hidden="true"></i><span>'+(this._data&&this._data.content?this._data.content.expand:"")+"</span>\n                    </button>\n                "),this._$posterImage.append(this._$posterExpandButton),this._$posterImage.on("touchstart click",(function(e){e.preventDefault();var n=t._getPosterImageCss(!t._posterImageExpanded);if(t._$posterImage.animate(n),t._posterImageExpanded=!t._posterImageExpanded,t._data.content)if(t._posterImageExpanded){var i=t._data.content.collapse;t._$posterExpandButton.prop("title",i),t._$posterExpandButton.find("i").switchClass("expand","collapse")}else i=t._data.content.expand,t._$posterExpandButton.prop("title",i),t._$posterExpandButton.find("i").switchClass("collapse","expand")}));var r=this._data.helper.getAccompanyingCanvas();if(r||(r=this._data.helper.getPosterCanvas()),r){this._posterCanvasWidth=r.getWidth(),this._posterCanvasHeight=r.getHeight();var a=this._data.helper.getPosterImage();if(a||(a=this._data.helper.getAccompanyingCanvasImage()),a){this._$posterContainer.append(this._$posterImage);var o=this._getPosterImageCss(this._posterImageExpanded);o=Object.assign({},o,{"background-image":"url("+a+")"}),this._$posterImage.css(o)}}}},e.prototype.setCurrentTime=function(t){return a(this,void 0,void 0,(function(){var e;return o(this,(function(n){return(e=this._getCurrentCanvas())?[2,e.setCurrentTime(t)]:[2]}))}))},e.prototype.getCurrentTime=function(){var t=this._getCurrentCanvas();return t?t.getClockTime():0},e.prototype.isPlaying=function(){return this.canvasInstances.reduce((function(t,e){return t||e.isPlaying()}),!1)},e.prototype._checkAllMediaReady=function(){this._readyMedia===this.canvasInstances.length&&(clearInterval(this._checkAllMediaReadyInterval),this.fire(g.Events.MEDIA_READY),this.resize())},e.prototype._checkAllWaveformsReady=function(){this._readyWaveforms===this._getCanvasInstancesWithWaveforms().length&&(clearInterval(this._checkAllWaveformsReadyInterval),this.fire(g.Events.WAVEFORMS_READY),this.resize())},e.prototype._getCanvasInstancesWithWaveforms=function(){return this.canvasInstances.filter((function(t){return t.waveforms.length>0}))},e.prototype._getCanvases=function(){return this._data.helper?this._data.helper.getCanvases():[]},e.prototype._initCanvas=function(t){var e=this,n=new p.CanvasInstance({target:document.createElement("div"),data:Object.assign({},{canvas:t},this._data)});n.logMessage=this._logMessage.bind(this),n.isOnlyCanvasInstance=1===this._getCanvases().length,this._$element.append(n.$playerElement),n.init(),this.canvasInstances.push(n),n.on("play",(function(){e.fire(g.Events.PLAY,n)}),!1),n.on("pause",(function(){e.fire(g.Events.PAUSE,n)}),!1),n.on(g.Events.MEDIA_READY,(function(){e._readyMedia++,n.loaded()}),!1),n.on(g.Events.WAVEFORM_READY,(function(){e._readyWaveforms++}),!1),n.on(u.CanvasInstanceEvents.PREVIOUS_RANGE,(function(){e._prevRange(),e.play()}),!1),n.on(u.CanvasInstanceEvents.NEXT_RANGE,(function(){e._nextRange(),e.play()}),!1),n.on(g.Events.RANGE_CHANGED,(function(t){e.fire(g.Events.RANGE_CHANGED,t)}),!1),n.on(c.VolumeEvents.VOLUME_CHANGED,(function(t){e._setCanvasInstanceVolumes(t),e.fire(c.VolumeEvents.VOLUME_CHANGED,t)}),!1)},e.prototype.getCurrentRange=function(){var t=this._data.helper.getCurrentRange().id;return this._getCurrentCanvas().ranges.find((function(e){return e.id===t}))||null},e.prototype._prevRange=function(){if(this._data&&this._data.helper){var t=this.getCurrentRange();if(t){var e=this.getCurrentTime(),n=t.getDuration().start||0;if(e-n>5)return void this.setCurrentTime(n)}var i=this._data.helper.getPreviousRange();i?this.playRange(i.id):this._rewind()}},e.prototype._nextRange=function(){if(this._data&&this._data.helper){var t=this._data.helper.getNextRange();t&&this.playRange(t.id)}},e.prototype._setCanvasInstanceVolumes=function(t){this.canvasInstances.forEach((function(e){e.set({volume:t})}))},e.prototype._getNormaliseCanvasId=function(t){return t.includes("://")?s.Utils.normaliseUrl(t):t},e.prototype._getCanvasInstanceById=function(t){if(t=this._getNormaliseCanvasId(t),this._data.virtualCanvasEnabled)for(var e=0;e<this.canvasInstances.length;e++){var n=(i=this.canvasInstances[e]).getCanvasId();if(n&&(n=this._getNormaliseCanvasId(n),(i.isVirtual()||1===this.canvasInstances.length)&&n===t||i.includesVirtualSubCanvas(t)))return i}else for(e=0;e<this.canvasInstances.length;e++){var i,r=(i=this.canvasInstances[e]).getCanvasId();if(r&&s.Utils.normaliseUrl(r)===t)return i}},e.prototype._getCurrentCanvas=function(){if(this._data.canvasId)return this._getCanvasInstanceById(this._data.canvasId)},e.prototype._rewind=function(){if(!this._data.limitToRange){var t=this._getCurrentCanvas();t&&t.set({range:void 0})}},e.prototype.play=function(){var t=this._getCurrentCanvas();t&&t.play()},e.prototype.viewRange=function(t){var e=this._getCurrentCanvas();e&&e.viewRange(t)},e.prototype.pause=function(){var t=this._getCurrentCanvas();t&&t.pause()},e.prototype.playRange=function(t,e){if(void 0===e&&(e=!1),this._data.helper){var n=this._data.helper.getRangeById(t);n&&this.set({range:jQuery.extend(!0,{autoChanged:e},n)})}},e.prototype.showCanvas=function(t){var e=this._getCurrentCanvas();this._data.virtualCanvasEnabled&&e&&e.getCanvasId()===t&&!e.isVisible()?e.set({visible:!0}):this.set({canvasId:t})},e.prototype._logMessage=function(t){this.fire(g.Events.LOG,t)},e.prototype._getPosterImageCss=function(t){var e=this._getCurrentCanvas();if(e){var n=e.$playerElement.find(".options-container"),i=e.$playerElement.parent().width(),r=e.$playerElement.parent().height()-n.height();if(t)return{top:0,left:0,width:i,height:r};var a=void 0,o=void 0,s=void 0;return this._posterCanvasWidth>this._posterCanvasHeight?(a=this._posterCanvasHeight/this._posterCanvasWidth,s=(o=i*(this._data.posterImageRatio||1))*a):(a=this._posterCanvasWidth/this._posterCanvasHeight,o=(s=r*(this._data.posterImageRatio||1))*a),{top:0,left:i-o,width:o,height:s}}return null},e.prototype.resize=function(){this.canvasInstances.forEach((function(t){t.resize()})),this._getCurrentCanvas()&&this._$posterImage&&this._$posterImage.is(":visible")&&(this._posterImageExpanded?this._$posterImage.css(this._getPosterImageCss(!0)):this._$posterImage.css(this._getPosterImageCss(!1)))},e.newRanges=!0,e}(l.BaseComponent);e.AVComponent=_},function(t,e,n){var i=n(38),r=n(39);t.exports=function t(e,n,a,o,s){var u=-1,l=e.length;for(a||(a=r),s||(s=[]);++u<l;){var c=e[u];n>0&&a(c)?n>1?t(c,n-1,a,o,s):i(s,c):o||(s[s.length]=c)}return s}},function(t,e){t.exports=function(t){return null!=t&&"object"==typeof t}},function(t,e,n){"use strict";n.r(e),e.default=function(t,e){return e=e||{},new Promise((function(n,i){var r=new XMLHttpRequest,a=[],o=[],s={},u=function(){return{ok:2==(r.status/100|0),statusText:r.statusText,status:r.status,url:r.responseURL,text:function(){return Promise.resolve(r.responseText)},json:function(){return Promise.resolve(r.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([r.response]))},clone:u,headers:{keys:function(){return a},entries:function(){return o},get:function(t){return s[t.toLowerCase()]},has:function(t){return t.toLowerCase()in s}}}};for(var l in r.open(e.method||"get",t,!0),r.onload=function(){r.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,(function(t,e,n){a.push(e=e.toLowerCase()),o.push([e,n]),s[e]=s[e]?s[e]+","+n:n})),n(u())},r.onerror=i,r.withCredentials="include"==e.credentials,e.headers)r.setRequestHeader(l,e.headers[l]);r.send(e.body||null)}))}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getTimestamp=function(){return String((new Date).valueOf())}},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,a){function o(t){try{u(i.next(t))}catch(t){a(t)}}function s(t){try{u(i.throw(t))}catch(t){a(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}u((i=i.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var n,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(e,"__esModule",{value:!0});var s=n(3),u=n(10),l=n(50),c=n(55),h=n(4),p=n(28),f=n(29),d=n(56),g=n(30),v=n(31),_=n(9),m=n(22),y=n(11),E=n(57),T=n(19),C=n(13),I=n(15),P=n(12),w=n(18),A=n(16),R=n(32),O=n(17),b=n(33),M=n(20),S=n(34),L=n(6),x=n(2),N=function(t){function e(e){var n=t.call(this,e)||this;return n._canvasClockFrequency=25,n._canvasClockStartDate=0,n._canvasClockTime=0,n._canvasHeight=0,n._canvasWidth=0,n._data=n.data(),n._highPriorityFrequency=25,n._isPlaying=!1,n._isStalled=!1,n._lowPriorityFrequency=250,n._mediaSyncMarginSecs=1,n._rangeSpanPadding=.25,n._readyMediaCount=0,n._stallRequestedBy=[],n._wasPlaying=!1,n.ranges=[],n.waveforms=[],n._buffering=!1,n._bufferShown=!1,n.isOnlyCanvasInstance=!1,n.waveformDeltaX=0,n.waveformPageX=0,n.waveFormInit=!1,n._scaleY=function(t,e){return Math.max(n._data.waveformBarWidth,t*e/256)},n._$element=$(n.options.target),n._data=n.options.data,n.$playerElement=$('<div class="player player--loading"></div>'),n}return r(e,t),e.prototype.loaded=function(){var t=this;setTimeout((function(){t.$playerElement.removeClass("player--loading")}),500)},e.prototype.isPlaying=function(){return this._isPlaying},e.prototype.getClockTime=function(){return this._canvasClockTime},e.prototype.createTimeStops=function(){var t=this,e=this._data.helper,n=this._data.canvas;if(e&&n){this.ranges=[],this._contentAnnotations=[];for(var i=[],r=0,a=n.canvases;r<a.length;r++)for(var o=a[r],s=0,u=o.getContent();s<u.length;s++){var h=u[s],f=p.extractMediaFromAnnotationBodies(h);if(f){var _=v.getMediaSourceFromAnnotationBody(h,f,{id:o.id,duration:o.getDuration()||0,height:o.getHeight(),width:o.getWidth()}),m=new l.MediaElement(_,{adaptiveAuthEnabled:this._data.adaptiveAuthEnabled});m.setSize(this._convertToPercentage(_.x||0,o.getHeight()),this._convertToPercentage(_.y||0,o.getWidth()),this._convertToPercentage(_.width||o.getWidth(),o.getWidth()),this._convertToPercentage(_.height||o.getHeight(),o.getHeight())),i.push(m);var y=h.getProperty("seeAlso");if(y&&y.length){var E=y[0].id;this.waveforms.push(E)}}}var C=new d.CompositeMediaElement(i);C.appendTo(this.$playerElement),C.load().then((function(){t.fire(T.Events.MEDIA_READY)}));var I=g.createTimePlansFromManifest(e.manifest,i);window.timePlanPlayer=this.timePlanPlayer=new c.TimePlanPlayer(C,I,(function(e){t.setCurrentRangeId(e,{autoChanged:!0})}),(function(e){t._canvasClockTime=e}),(function(e){e?t.play(!0):t.pause(!0)}))}},e.prototype.init=function(){var t=this;if(this._data&&this._data.content&&this._data.canvas){this._$hoverPreviewTemplate=$('<div class="hover-preview"><div class="label"></div><div class="pointer"><span class="arrow"></span></div></div>'),this._$canvasContainer=$('<div class="canvas-container"></div>'),this._$optionsContainer=$('<div class="options-container"></div>'),this._$rangeTimelineContainer=$('<div class="range-timeline-container"></div>'),this._$canvasTimelineContainer=$('<div class="canvas-timeline-container"></div>'),this._$canvasHoverPreview=this._$hoverPreviewTemplate.clone(),this._$canvasHoverHighlight=$('<div class="hover-highlight"></div>'),this._$rangeHoverPreview=this._$hoverPreviewTemplate.clone(),this._$rangeHoverHighlight=$('<div class="hover-highlight"></div>'),this._$durationHighlight=$('<div class="duration-highlight"></div>'),this._$timelineItemContainer=$('<div class="timeline-item-container"></div>'),this._$controlsContainer=$('<div class="controls-container"></div>'),this._$prevButton=$('\n                                <button class="btn" title="'+this._data.content.previous+'">\n                                    <i class="av-icon av-icon-previous" aria-hidden="true"></i>'+this._data.content.previous+"\n                                </button>"),this._$playButton=$('\n                                <button class="btn" title="'+this._data.content.play+'">\n                                    <i class="av-icon av-icon-play play" aria-hidden="true"></i>'+this._data.content.play+"\n                                </button>"),this._$nextButton=$('\n                                <button class="btn" title="'+this._data.content.next+'">\n                                    <i class="av-icon av-icon-next" aria-hidden="true"></i>'+this._data.content.next+"\n                                </button>"),this._$fastForward=$('\n                                <button class="btn" title="'+this._data.content.next+'">\n                                    <i class="av-icon av-icon-fast-forward" aria-hidden="true"></i>'+(this._data.content.fastForward||"")+"\n                                </button>"),this._$fastRewind=$('\n                                <button class="btn" title="'+this._data.content.next+'">\n                                    <i class="av-icon av-icon-fast-rewind" aria-hidden="true"></i>'+(this._data.content.fastRewind||"")+"\n                                </button>"),this._$timeDisplay=$('<div class="time-display"><span class="canvas-time"></span> / <span class="canvas-duration"></span></div>'),this._$canvasTime=this._$timeDisplay.find(".canvas-time"),this._$canvasDuration=this._$timeDisplay.find(".canvas-duration"),this.isVirtual()&&this.$playerElement.addClass("virtual");var e=$('<div class="volume"></div>');this._volume=new f.AVVolumeControl({target:e[0],data:Object.assign({},this._data)}),this._volume.on(h.VolumeEvents.VOLUME_CHANGED,(function(e){t.fire(h.VolumeEvents.VOLUME_CHANGED,e)}),!1),this._$controlsContainer.append(this._$prevButton,this._data.enableFastRewind?this._$fastRewind:null,this._$playButton,this._data.enableFastForward?this._$fastForward:null,this._$nextButton,this._$timeDisplay,e),this._$canvasTimelineContainer.append(this._$canvasHoverPreview,this._$canvasHoverHighlight,this._$durationHighlight),this._$rangeTimelineContainer.append(this._$rangeHoverPreview,this._$rangeHoverHighlight),this._$optionsContainer.append(this._$canvasTimelineContainer,this._$rangeTimelineContainer,this._$controlsContainer),this.$playerElement.append(this._$canvasContainer,this._$optionsContainer),this._$canvasHoverPreview.hide(),this._$rangeHoverPreview.hide();var n=this.isVirtual()&&m.AVComponent.newRanges;if(n&&this.createTimeStops(),!n&&this._data&&this._data.helper&&this._data.canvas){var i=[];S.isVirtual(this._data.canvas)?this._data.canvas.canvases.forEach((function(e){if(t._data&&t._data.helper){var n=t._data.helper.getCanvasRanges(e),r=[];n.forEach((function(e){var n=jQuery.extend(!0,{},e);if(r.push(n),n.canvases&&n.canvases.length)for(var i=0;i<n.canvases.length;i++)S.isVirtual(t._data.canvas)&&(n.canvases[i]=P.retargetTemporalComponent(t._data.canvas.canvases,n.__jsonld.items[i].id))})),i.push.apply(i,r)}})):i=i.concat(this._data.helper.getCanvasRanges(this._data.canvas)),i.forEach((function(e){t.ranges.push(e)}))}var r=this._data.canvas.getWidth(),a=this._data.canvas.getHeight();this._canvasWidth=r||this.$playerElement.parent().width(),this._canvasHeight=a||this._canvasWidth*(this._data.defaultAspectRatio||1);var o=this,u=0,l=0;if(this._$prevButton.on("touchstart click",(function(e){e.preventDefault(),1==++u?(t._previous(!1),l=setTimeout((function(){u=0,l=0}),t._data.doubleClickMS)):(t._previous(!0),clearTimeout(l),u=0,l=0)})),this._$playButton.on("touchstart click",(function(e){e.preventDefault(),t._isPlaying?t.pause():t.play()})),this._$nextButton.on("touchstart click",(function(e){e.preventDefault(),t._next()})),this._$fastForward.on("touchstart click",(function(e){var n=t.getRangeTiming().end,i=L.addTime(t.getClockTime(),20);return i<n?t._setCurrentTime(i):t._setCurrentTime(n)})),this._$fastRewind.on("touchstart click",(function(e){var n=t.getRangeTiming().start,i=L.minusTime(t.getClockTime(),20);return i>=n?t._setCurrentTime(i):t._setCurrentTime(n)})),n?this._$canvasTimelineContainer.slider({value:0,step:.01,orientation:"horizontal",range:"min",min:0,max:this.timePlanPlayer.getDuration(),animate:!1,slide:function(e,n){t._setCurrentTime(t.timePlanPlayer.plan.start+n.value)}}):this._$canvasTimelineContainer.slider({value:0,step:.01,orientation:"horizontal",range:"min",max:o._getDuration(),animate:!1,create:function(t,e){},slide:function(t,e){o._setCurrentTime(e.value)},stop:function(t,e){}}),this._$canvasTimelineContainer.mouseout((function(){o._$canvasHoverHighlight.width(0),o._$canvasHoverPreview.hide()})),this._$rangeTimelineContainer.mouseout((function(){o._$rangeHoverHighlight.width(0),o._$rangeHoverPreview.hide()})),this._$canvasTimelineContainer.on("mousemove",(function(e){n?t._updateHoverPreview(e,t._$canvasTimelineContainer,t.timePlanPlayer.getDuration()):t._updateHoverPreview(e,t._$canvasTimelineContainer,t._getDuration())})),this._$rangeTimelineContainer.on("mousemove",(function(e){if(n)t._updateHoverPreview(e,t._$canvasTimelineContainer,t.timePlanPlayer.getDuration());else if(t._data.range){var i=t._data.range.getDuration();t._updateHoverPreview(e,t._$rangeTimelineContainer,i?i.getLength():0)}})),!n){this._contentAnnotations=[];var c=this._data.canvas.getContent();this._$timelineItemContainer.hide();for(var p=0;p<c.length;p++){var d=c[p],g=void 0,v=d.getBody();if(!v.length)return void x.Logger.warn("item has no body");var _=this._getBody(v);if(_){var y=_.getType(),E=_.getFormat();y&&"textualbody"===y.toString()||(g=_.id.split("#")[0]);var T=d.getTarget();if(!T)return void x.Logger.warn("item has no target");var C=w.getSpatialComponent(T),I=s.Utils.getTemporalComponent(T);C||(C=[0,0,this._canvasWidth,this._canvasHeight]),I||(I=[0,this._getDuration()]);var U,A=parseInt(String(C[0])),R=parseInt(String(C[1])),O=parseInt(String(C[2])),b=parseInt(String(C[3])),M=parseInt(String(I[0])),N=parseInt(String(I[1])),D=this._convertToPercentage(R,this._canvasHeight),V=this._convertToPercentage(A,this._canvasWidth),j=this._convertToPercentage(O,this._canvasWidth),F=this._convertToPercentage(b,this._canvasHeight),k=/t=([^&]+)/g.exec(_.id),H=(U=k&&k[1]?k[1].split(","):[null,null])[0]?parseInt(U[0]):U[0],G={active:!1,end:N,endOffset:U[1]?parseInt(U[1]):U[1],format:E,height:F,left:V,source:g,start:M,startOffset:H,top:D,type:y,width:j};this._renderMediaElement(G);var B=d.getProperty("seeAlso");if(B&&B.length){var W=B[0].id;this.waveforms.push(W)}}else x.Logger.warn("unable to find suitable format for",d.id)}}}else x.Logger.warn("unable to initialise, missing canvas or content")},e.prototype._getBody=function(t){for(var e=0;e<t.length;e++)if((i=(n=t[e]).getFormat())&&C.isHLSFormat(i)&&A.canPlayHls())return n;for(e=0;e<t.length;e++)if((i=(n=t[e]).getFormat())&&I.isMpegDashFormat(i)&&!O.isSafari())return n;for(e=0;e<t.length;e++){var n,i;if((i=(n=t[e]).getFormat())&&!C.isHLSFormat(i)&&!I.isMpegDashFormat(i))return n}return null},e.prototype._getDuration=function(){return this.isVirtual()&&m.AVComponent.newRanges?this.timePlanPlayer.getDuration():this._data&&this._data.canvas?Math.floor(this._data.canvas.getDuration()):0},e.prototype.data=function(){return{waveformColor:"#fff",waveformBarSpacing:4,waveformBarWidth:2,volume:1}},e.prototype.isVirtual=function(){return this._data.canvas instanceof y.VirtualCanvas},e.prototype.isVisible=function(){return!!this._data.visible},e.prototype.includesVirtualSubCanvas=function(t){if(S.isVirtual(this._data.canvas)&&this._data.canvas&&this._data.canvas.canvases)for(var e=0;e<this._data.canvas.canvases.length;e++){var n=this._data.canvas.canvases[e];if(s.Utils.normaliseUrl(n.id)===t)return!0}return!1},e.prototype.setVisibility=function(t){this._data.visible!==t&&(this._data.visible=t,t?(this._rewind(),this.$playerElement.show()):(this.$playerElement.hide(),this.pause()),this.resize())},e.prototype.viewRange=function(t){if(this.currentRange!==t){if(x.Logger.log("Switching range from "+this.currentRange+" to "+t),this.setCurrentRangeId(t),m.AVComponent.newRanges&&this.isVirtual())this._setCurrentTime(this.timePlanPlayer.setRange(t),!0);else{var e=this._data.helper.getRangeById(t);this.set({range:jQuery.extend(!0,{autoChanged:!0},e)})}this._render()}},e.prototype.setCurrentRangeId=function(t,e){var n=void 0===e?{}:e;n.autoChanged,n.limitToRange,!this.currentRange&&t&&this.limitToRange,x.Logger.log("Setting current range id",t),t&&this.currentRange!==t?(this.currentRange=t,this.fire(T.Events.RANGE_CHANGED,t)):null===t&&(this.currentRange=void 0,this.fire(T.Events.RANGE_CHANGED,null)),this._render()},e.prototype.setVolume=function(t){this._volume.set({volume:t}),m.AVComponent.newRanges&&this.isVirtual()&&this.timePlanPlayer.setVolume(t)},e.prototype.setLimitToRange=function(t){x.Logger.log(this._data.constrainNavigationToRange),this.limitToRange!==t&&(this.limitToRange=t,this._render())},e.prototype.set=function(t){var e=this;if(m.AVComponent.newRanges&&this.isVirtual())return void 0!==t.range&&this.setCurrentRangeId(t.range.id,{limitToRange:t.limitToRange}),void 0!==t.rangeId&&this.setCurrentRangeId(t.rangeId,{limitToRange:t.limitToRange}),void 0!==t.volume&&this.setVolume(t.volume),void 0!==t.limitToRange&&this.setLimitToRange(t.limitToRange),void(void 0!==t.visible&&this.setVisibility(t.visible));var n=Object.assign({},this._data);this._data=Object.assign(this._data,t);var i=M.diffData(n,this._data);if(i.includes("visible")&&this._data.canvas&&(this._data.visible?(this._rewind(),this.$playerElement.show()):(this.$playerElement.hide(),this.pause()),this.resize()),i.includes("volume")?this._contentAnnotations.forEach((function(t){var n=void 0!==e._data.volume?e._data.volume:1;$(t.element).prop("volume",n),e._volume.set({volume:e._data.volume})})):this.isVisible()&&this._render(),i.includes("range")){if(this._data.helper)if(this._data.range){var r=this._data.range.getDuration();r&&void 0!==r&&((r.start>=this._canvasClockTime||r.end<=this._canvasClockTime)&&this._setCurrentTime(r.start),this._data.autoPlay&&this.play(),this.fire(T.Events.RANGE_CHANGED,this._data.range.id,this._data.range))}else this.fire(T.Events.RANGE_CHANGED,null);i.includes("limitToRange")&&this._render()}},e.prototype._hasRangeChanged=function(){if(!this.isVirtual()||!m.AVComponent.newRanges){var t=this._getRangeForCurrentTime();t&&!this._data.limitToRange&&(!this._data.range||this._data.range&&t.id!==this._data.range.id)&&this.set({range:jQuery.extend(!0,{autoChanged:!0},t)})}},e.prototype._getRangeForCurrentTime=function(t){var e;e=t?t.getRanges():this.ranges;for(var n=0;n<e.length;n++){var i=e[n],r=i.getBehavior();if((!r||"no-nav"===r)&&this._rangeSpansCurrentTime(i)){if(this._rangeNavigable(i))return i;for(var a=i.getRanges(),o=0;o<a.length;o++){var s=a[o];if(this._rangeSpansCurrentTime(s))return this._getRangeForCurrentTime(s)}return i.parentRange}}},e.prototype._rangeSpansCurrentTime=function(t){return!!t.spansTime(Math.ceil(this._canvasClockTime)+this._rangeSpanPadding)},e.prototype._rangeNavigable=function(t){var e=t.getBehavior();return!e||"no-nav"!==e.toString()},e.prototype._render=function(){if(this.isVirtual()&&m.AVComponent.newRanges&&this.isVisible()){x.Logger.groupCollapsed("CanvasInstance._render()"),x.Logger.log({dataRange:this._data.rangeId,range:this.currentRange,newLimitToRange:this.limitToRange,constraintToRange:this._data.constrainNavigationToRange,autoSelectRange:this._data.autoSelectRange}),this.limitToRange&&this.currentRange?(x.Logger.log("Selecting plan...",this.currentRange),this.timePlanPlayer.selectPlan({rangeId:this.currentRange})):(x.Logger.log("Resetting..."),this.timePlanPlayer.selectPlan({reset:!0}));var t=this._$canvasTimelineContainer.width()/this.timePlanPlayer.getDuration();this._$durationHighlight.show();var e=this.timePlanPlayer.getCurrentRange(),n=e.start,i=e.duration;return this._$canvasTimelineContainer.slider({value:this._canvasClockTime-this.timePlanPlayer.plan.start,max:this.timePlanPlayer.getDuration()}),this._$durationHighlight.css({left:n*t,width:i*t}),x.Logger.groupEnd(),this._updateCurrentTimeDisplay(),this._updateDurationDisplay(),void this._drawWaveform()}if(this._data.limitToRange&&this._data.range?(this._$canvasTimelineContainer.hide(),this._$rangeTimelineContainer.show()):(this._$canvasTimelineContainer.show(),this._$rangeTimelineContainer.hide()),this._data.range||this._$durationHighlight.hide(),this.isVisible()&&(this.isOnlyCanvasInstance||this.isVirtual())){if(this._data.range&&(!this.isVirtual()||!m.AVComponent.newRanges)&&(i=this._data.range.getDuration())){var r=this._getDuration(),a=r*(t=this._$canvasTimelineContainer.width()/r),o=(n=i.start*t,i.end*t);(o>a||o<n)&&(o=a);var s=o-n;this.isVirtual()||this.isOnlyCanvasInstance?(this._$durationHighlight.show(),this._$durationHighlight.css({left:n,width:s})):this._$durationHighlight.hide();var u=this;this._$rangeTimelineContainer.data("ui-sortable")&&this._$rangeTimelineContainer.slider("destroy"),this._$rangeTimelineContainer.slider({value:i.start,step:.01,orientation:"horizontal",range:"min",min:i.start,max:i.end,animate:!1,create:function(t,e){},slide:function(t,e){u._setCurrentTime(e.value)},stop:function(t,e){}})}this._updateCurrentTimeDisplay(),this._updateDurationDisplay(),this._drawWaveform()}},e.prototype.getCanvasId=function(){if(this._data&&this._data.canvas)return this._data.canvas.id},e.prototype._updateHoverPreview=function(t,e,n){var i=e.offset()||{left:0},r=t.pageX-i.left,a=e.find(".arrow"),o=e.find(".hover-highlight"),s=e.find(".hover-preview");o.width(r);var u=e.width(),l=r/u,c=Math.min(n*l);s.find(".label").text(R.formatTime(c));var h=s.outerWidth(),p=s.outerHeight(),f=r-.5*h,d=.5*h-6;f<0&&(f=0,d=r-6),f+h>u&&(f=u-h,d=h-(u-r)-6),s.css({left:f,top:-1*p+"px"}).show(),a.css({left:d})},e.prototype._previous=function(t){if(m.AVComponent.newRanges&&this.isVirtual()){x.Logger.group("prev");var e=this.timePlanPlayer.previous();return this._setCurrentTime(e),x.Logger.log("CanvasInstance.previous()",e),void x.Logger.groupEnd()}this._data.limitToRange?t?this._isNavigationConstrainedToRange()?this._rewind():this.fire(_.CanvasInstanceEvents.PREVIOUS_RANGE):this._rewind():this._data.range?t?(this.set({range:void 0}),this._rewind()):this.fire(_.CanvasInstanceEvents.PREVIOUS_RANGE):this._rewind()},e.prototype._next=function(){if(m.AVComponent.newRanges&&this.isVirtual()){x.Logger.groupCollapsed("next");var t=this.timePlanPlayer.next();return x.Logger.log("CanvasInstance.previous()",t),this._setCurrentTime(t,!1),void x.Logger.groupEnd()}this._data.limitToRange&&this._isNavigationConstrainedToRange()?this._fastforward():this.fire(_.CanvasInstanceEvents.NEXT_RANGE)},e.prototype.destroy=function(){window.clearInterval(this._highPriorityInterval),window.clearInterval(this._lowPriorityInterval),window.clearInterval(this._canvasClockInterval)},e.prototype._convertToPercentage=function(t,e){return t/e*100},e.prototype._renderMediaElement=function(t){var e,n=this;switch(t.type.toString().toLowerCase()){case"video":e=$('<video crossorigin="anonymous" class="anno" />');break;case"sound":case"audio":e=$('<audio crossorigin="anonymous" class="anno" />');break;default:return}var i=e[0];if(t.format&&"application/dash+xml"===t.format.toString()){e.attr("data-dashjs-player","");var r=dashjs.MediaPlayer().create();r.getDebug().setLogToBrowserConsole(!1),this._data.adaptiveAuthEnabled&&r.setXHRWithCredentialsForType("MPD",!0),r.initialize(i,t.source)}else if(t.format&&"application/vnd.apple.mpegurl"===t.format.toString())if(Hls.isSupported()){var a=new Hls;a=this._data.adaptiveAuthEnabled?new Hls({xhrSetup:function(t){t.withCredentials=!0}}):new Hls,this._data.adaptiveAuthEnabled,a.loadSource(t.source),a.attachMedia(i)}else i.canPlayType("application/vnd.apple.mpegurl")&&(i.src=t.source);else e.attr("src",t.source);e.css({top:t.top+"%",left:t.left+"%",width:t.width+"%",height:t.height+"%"}).hide(),t.element=e,t.timeout=null;var o=this;t.checkForStall=function(){var t=this;this.active?(o._checkMediaSynchronization(),this.element.get(0).readyState>0&&!this.outOfSync?o._playbackStalled(!1,t):(o._playbackStalled(!0,t),this.timeout&&window.clearTimeout(this.timeout),this.timeout=window.setTimeout((function(){t.checkForStall()}),1e3))):o._playbackStalled(!1,t)},this._contentAnnotations.push(t),this.$playerElement&&this._$canvasContainer.append(e),e.on("loadedmetadata",(function(){n._readyMediaCount++,n._readyMediaCount===n._contentAnnotations.length&&(n._data.autoPlay?n.play():n.pause(),n._updateDurationDisplay(),n.fire(T.Events.MEDIA_READY))})),e.attr("preload","metadata"),e.get(0).load(),this._renderSyncIndicator(t)},e.prototype._getWaveformData=function(t){return new Promise((function(e,n){$.ajax({url:t,type:"GET",dataType:"binary",responseType:"arraybuffer",processData:!1}).done((function(t){e(WaveformData.create(t))})).fail((function(){n(new Error("Network Error"))}))}))},e.prototype._renderWaveform=function(t){var e=this;if(void 0===t&&(t=!1),(!this.waveFormInit||t)&&(this.waveFormInit=!0,this.waveforms.length)){var n=this.waveforms.map((function(t){return e._getWaveformData(t)}));Promise.all(n).then((function(t){e._waveformCanvas=document.createElement("canvas"),e._waveformCanvas.classList.add("waveform"),e._$canvasContainer.append(e._waveformCanvas),e.waveformPageX=e._waveformCanvas.getBoundingClientRect().left;var n=e._drawWaveform.bind(e);e._waveformCanvas.addEventListener("mousein",(function(){e.waveformDeltaX=0})),e._$canvasTimelineContainer.on("mouseout",(function(){e.waveformDeltaX=0,requestAnimationFrame(n)})),e._waveformCanvas.addEventListener("mouseout",(function(){e.waveformDeltaX=0,requestAnimationFrame(n)})),e._waveformCanvas.addEventListener("mousemove",(function(t){e.waveformDeltaX=t.clientX-e.waveformPageX,requestAnimationFrame(n)})),e._$canvasTimelineContainer.on("mousemove",(function(t){e.waveformDeltaX=t.clientX-e.waveformPageX,requestAnimationFrame(n)})),e._waveformCanvas.addEventListener("click",(function(){var t=e._waveformCanvas.getBoundingClientRect().width||0;if(t){var n=e.getRangeTiming(),i=n.start,r=n.duration;e._setCurrentTime(L.multiplyTime(L.addTime(i,r),e.waveformDeltaX/t))}})),e._waveformCtx=e._waveformCanvas.getContext("2d"),e._waveformCtx&&(e._waveformCtx.fillStyle=e._data.waveformColor||"#fff",e._compositeWaveform=new E.CompositeWaveform(t),e.fire(T.Events.WAVEFORM_READY))})).catch((function(){x.Logger.warn("Could not load wave forms.")}))}},e.prototype.getRangeTiming=function(){if(m.AVComponent.newRanges&&this.isVirtual())return{start:this.timePlanPlayer.plan.start,end:this.timePlanPlayer.plan.end,duration:this.timePlanPlayer.plan.duration,percent:Math.min((this.timePlanPlayer.getTime()-this.timePlanPlayer.plan.start)/this.timePlanPlayer.plan.duration,1)};var t,e=0,n=L.timelineTime(this._compositeWaveform?this._compositeWaveform.duration:-1),i=n;return this._data.range&&(t=this._data.range.getDuration()),this.isVirtual()||(n=this._getDuration()),this._data.limitToRange&&t&&(e=t.start,n=t.end,i=L.minusTime(n,e)),-1===n&&t&&(e=t.start,n=t.end,i=L.minusTime(n,e)),-1===n&&x.Logger.warn("Duration not found...",{start:e,end:n,duration:i,durationObj:t}),{start:e,end:n,duration:L.minusTime(n,e),percent:Math.min((this.getClockTime()-e)/i,1)}},e.prototype._drawWaveform=function(){if(this._renderWaveform(),this._waveformCtx&&this.isVisible()){var t=this.getRangeTiming(),e=t.start,n=t.end,i=t.percent,r=e*this._compositeWaveform.pixelsPerSecond,a=n*this._compositeWaveform.pixelsPerSecond,o=this._waveformCtx.canvas.width,s=this._waveformCtx.canvas.height,u=this._data.waveformBarSpacing,l=this._data.waveformBarWidth,c=Math.floor((a-r)/o*u),h=o/u;this._waveformCtx.clearRect(0,0,o,s),this._waveformCtx.fillStyle=this._data.waveformColor||"#fff";var p=o/(n-e),f=[];if(this._contentAnnotations)for(var d=0;d<this._contentAnnotations.length;d++){var g=this._contentAnnotations[d];if(g&&g.element){var v=g.element[0],_=g.startOffest||0;if(g.active)for(var y=0;y<v.buffered.length;y++){var E=v.buffered.length-y-1,T=v.buffered.start(E),C=v.buffered.end(E);f.push([(_+T-e)*p,(_+C-e)*p])}}}var I=[];if(this.isVirtual()&&m.AVComponent.newRanges)for(var P=this.timePlanPlayer.plan,w=this._data.canvas,A=0,R=P.stops;A<R.length;A++){var O=R[A],M=w.durationMap[P.canvases[O.canvasIndex]],S=M.runningDuration-M.duration;I.push({start:(O.start-P.start)/P.duration,end:(O.end-P.start)/P.duration,duration:O.duration,startTime:S+O.canvasTime.start,endTime:S+O.canvasTime.start+O.canvasTime.end})}else I.push({start:0,duration:n-e,end:n,startTime:e});for(var L=0,x=r;x<a;x+=c){var N=b.normalise(x,r,a),D=N*o;I[L].end<N&&L++;var V=I[L],j=N-V.start,F=Math.floor((V.startTime+j*V.duration)*this._compositeWaveform.pixelsPerSecond),$=this._getWaveformMaxAndMin(this._compositeWaveform,F,h),k=this._scaleY($.max-$.min,s),U=D/o<i,H=this.waveformDeltaX/o,G=this._data.waveformColor||"#fff",B=(s-k)/2;if(U)G=0===this.waveformDeltaX?"#14A4C3":D/o<H?"#11758e":"#14A4C3";else if(D/o<H)G="#86b3c3";else{G="#8a9aa1";for(var W=0,z=f;W<z.length;W++){var Y=z[W],X=Y[0],q=Y[1];if(D>X&&D<q){G="#fff";break}}}this._waveformCtx.fillStyle=G,this._waveformCtx.fillRect(D,B,l,0|k)}}},e.prototype._getWaveformMaxAndMin=function(t,e,n){for(var i=-127,r=128,a=e;a<e+n;a++){var o=t.max(a),s=t.min(a);o>i&&(i=o),s<r&&(r=s)}return{max:i,min:r}},e.prototype.isLimitedToRange=function(){return this._data.limitToRange},e.prototype.hasCurrentRange=function(){return!!this._data.range},e.prototype._updateCurrentTimeDisplay=function(){var t;if(m.AVComponent.newRanges&&this.isVirtual())this._$canvasTime.text(R.formatTime(this._canvasClockTime-this.timePlanPlayer.getStartTime()));else if(this._data.range&&(t=this._data.range.getDuration()),this._data.limitToRange&&t){var e=this._canvasClockTime-t.start;this._$canvasTime.text(R.formatTime(e))}else this._$canvasTime.text(R.formatTime(this._canvasClockTime))},e.prototype._updateDurationDisplay=function(){var t;m.AVComponent.newRanges&&this.isVirtual()?this._$canvasDuration.text(R.formatTime(this.timePlanPlayer.getDuration())):(this._data.range&&(t=this._data.range.getDuration()),this._data.limitToRange&&t?this._$canvasDuration.text(R.formatTime(t.getLength())):this._$canvasDuration.text(R.formatTime(this._getDuration())))},e.prototype._renderSyncIndicator=function(t){if(m.AVComponent.newRanges&&this.isVirtual())x.Logger.log("_renderSyncIndicator");else{var e=this._convertToPercentage(t.start,this._getDuration()),n=this._convertToPercentage(t.end-t.start,this._getDuration()),i=$('<div class="timeline-item"></div>');i.css({left:e+"%",width:n+"%"});var r=$('<div class="line-wrapper"></div>');i.appendTo(r),t.timelineElement=i,this.$playerElement&&this._$timelineItemContainer.append(r)}},e.prototype.setCurrentTime=function(t){return x.Logger.log("External set current time?"),this._setCurrentTime(t,!1)},e.prototype.now=function(){return L.fromMs(Date.now())},e.prototype.nowMs=function(){return Date.now()},e.prototype._setCurrentTime=function(t,e){return void 0===e&&(e=!0),a(this,void 0,void 0,(function(){var n,i,r;return o(this,(function(a){switch(a.label){case 0:return m.AVComponent.newRanges&&this.isVirtual()?(this._buffering=!0,[4,this.timePlanPlayer.setTime(t,e)]):[3,2];case 1:return a.sent(),this._buffering=!1,this._canvasClockStartDate=L.toMs(L.minusTime(this.now(),this._canvasClockTime)),this._canvasClockUpdater(),this._highPriorityUpdater(),this._lowPriorityUpdater(),this._synchronizeMedia(),[2];case 2:return n=this.getRangeTiming(),i=n.start,r=n.end,t<i||i>r||(this._canvasClockTime=t,this._canvasClockStartDate=L.toMs(L.minusTime(this.now(),this._canvasClockTime)),this.logMessage("SET CURRENT TIME to: "+this._canvasClockTime+" seconds."),this._canvasClockUpdater(),this._highPriorityUpdater(),this._lowPriorityUpdater(),this._synchronizeMedia()),[2]}}))}))},e.prototype._rewind=function(t){var e;m.AVComponent.newRanges&&this.isVirtual()?x.Logger.log("Rewind"):(this.pause(),this._data.range&&(e=this._data.range.getDuration()),this._data.limitToRange&&e?this._setCurrentTime(e.start):this._setCurrentTime(0),this._data.limitToRange||this._data&&this._data.helper&&this.set({range:void 0}))},e.prototype._fastforward=function(){var t;m.AVComponent.newRanges&&this.isVirtual()?x.Logger.log("Fast forward"):(this._data.range&&(t=this._data.range.getDuration()),this._data.limitToRange&&t?this._canvasClockTime=L.timelineTime(t.end):this._canvasClockTime=this._getDuration(),this.pause())},e.prototype.play=function(t){return a(this,void 0,void 0,(function(){var e,n,i=this;return o(this,(function(r){switch(r.label){case 0:return this._isPlaying?[2]:m.AVComponent.newRanges&&this.isVirtual()?this.timePlanPlayer.hasEnded()?(this._buffering=!0,[4,this.timePlanPlayer.setTime(this.timePlanPlayer.currentStop.start)]):[3,2]:[3,3];case 1:r.sent(),this._buffering=!1,r.label=2;case 2:return this.timePlanPlayer.play(),[3,4];case 3:e=void 0,this._data.range&&(e=this._data.range.getDuration()),this._data.limitToRange&&e&&this._canvasClockTime>=e.end&&(this._canvasClockTime=e.start),this._canvasClockTime===this._getDuration()&&(this._canvasClockTime=0),r.label=4;case 4:return this._canvasClockStartDate=L.toMs(L.minusTime(this.now(),this._canvasClockTime)),this._highPriorityInterval&&clearInterval(this._highPriorityInterval),this._highPriorityInterval=window.setInterval((function(){i._highPriorityUpdater()}),this._highPriorityFrequency),this._lowPriorityInterval&&clearInterval(this._lowPriorityInterval),this._lowPriorityInterval=window.setInterval((function(){i._lowPriorityUpdater()}),this._lowPriorityFrequency),this._canvasClockInterval&&clearInterval(this._canvasClockInterval),this._canvasClockInterval=window.setInterval((function(){i._canvasClockUpdater()}),this._canvasClockFrequency),this._isPlaying=!0,t||this._synchronizeMedia(),n=this._data&&this._data.content?this._data.content.pause:"",this._$playButton.prop("title",n),this._$playButton.find("i").switchClass("play","pause"),this.fire(_.CanvasInstanceEvents.PLAYCANVAS),this.logMessage("PLAY canvas"),[2]}}))}))},e.prototype.pause=function(t){window.clearInterval(this._highPriorityInterval),window.clearInterval(this._lowPriorityInterval),window.clearInterval(this._canvasClockInterval),this._isPlaying=!1,t||(this._highPriorityUpdater(),this._lowPriorityUpdater(),this._synchronizeMedia()),m.AVComponent.newRanges&&this.isVirtual()&&this.timePlanPlayer.pause();var e=this._data&&this._data.content?this._data.content.play:"";this._$playButton.prop("title",e),this._$playButton.find("i").switchClass("pause","play"),this.fire(_.CanvasInstanceEvents.PAUSECANVAS),this.logMessage("PAUSE canvas")},e.prototype._isNavigationConstrainedToRange=function(){return this._data.constrainNavigationToRange||!1},e.prototype._canvasClockUpdater=function(){if(m.AVComponent.newRanges&&this.isVirtual()){if(this._buffering)return;var t=L.fromMs(this._canvasClockStartDate);return x.Logger.log("CanvasInstance._canvasClockUpdater()",{startDate:t,advanceToTime:L.minusTime(this.now(),t)}),void(this.timePlanPlayer.advanceToTime(L.minusTime(this.now(),t)).paused&&this.pause())}if(!this._buffering){var e,n=L.fromMs(this._canvasClockStartDate);this._canvasClockTime=L.minusTime(this.now(),n),this._data.range&&(e=this._data.range.getDuration()),this._data.limitToRange&&e&&this._canvasClockTime>=e.end&&this.pause(),this._canvasClockTime>=this._getDuration()&&(this._canvasClockTime=this._getDuration(),this.pause())}},e.prototype._highPriorityUpdater=function(){this._bufferShown&&!this._buffering&&(this.$playerElement.removeClass("player--loading"),this._bufferShown=!1),this._buffering&&!this._bufferShown&&(this.$playerElement.addClass("player--loading"),this._bufferShown=!0),m.AVComponent.newRanges&&this.isVirtual()?(this._$rangeTimelineContainer.slider({value:this._canvasClockTime-this.timePlanPlayer.plan.start}),this._$canvasTimelineContainer.slider({value:this._canvasClockTime-this.timePlanPlayer.plan.start})):(this._$rangeTimelineContainer.slider({value:this._canvasClockTime}),this._$canvasTimelineContainer.slider({value:this._canvasClockTime})),this._updateCurrentTimeDisplay(),this._updateDurationDisplay(),this._drawWaveform()},e.prototype._lowPriorityUpdater=function(){this._updateMediaActiveStates(),this._data.autoSelectRange&&(this.isVirtual()||this.isOnlyCanvasInstance)&&this._hasRangeChanged()},e.prototype._updateMediaActiveStates=function(){if(m.AVComponent.newRanges&&this.isVirtual()){if(this._isPlaying){if(this.timePlanPlayer.isBuffering())return void(this._buffering=!0);this._buffering&&(this._buffering=!1),this.timePlanPlayer.advanceToTime(this._canvasClockTime)}}else for(var t,e=0;e<this._contentAnnotations.length;e++)(t=this._contentAnnotations[e]).start<=this._canvasClockTime&&t.end>=this._canvasClockTime?(this._checkMediaSynchronization(),t.active||(this._synchronizeMedia(),t.active=!0,t.element.show(),t.timelineElement.addClass("active")),t.element[0].currentTime>t.element[0].duration-t.endOffset&&this._pauseMedia(t.element[0])):t.active&&(t.active=!1,t.element.hide(),t.timelineElement.removeClass("active"),this._pauseMedia(t.element[0]))},e.prototype._pauseMedia=function(t){t.pause()},e.prototype._setMediaCurrentTime=function(t,e){isNaN(t.duration)||(t.currentTime=e)},e.prototype._synchronizeMedia=function(){if(!m.AVComponent.newRanges||!this.isVirtual()){for(var t,e=0;e<this._contentAnnotations.length;e++){if(t=this._contentAnnotations[e],this._setMediaCurrentTime(t.element[0],this._canvasClockTime-t.start+t.startOffset),t.start<=this._canvasClockTime&&t.end>=this._canvasClockTime)if(this._isPlaying){if(t.element[0].paused){var n=t.element[0].play();n&&n.catch((function(){}))}}else this._pauseMedia(t.element[0]);else this._pauseMedia(t.element[0]);t.element[0].currentTime>t.element[0].duration-t.endOffset&&this._pauseMedia(t.element[0])}this.logMessage("SYNC MEDIA at: "+this._canvasClockTime+" seconds.")}},e.prototype._checkMediaSynchronization=function(){if(m.AVComponent.newRanges&&this.isVirtual())this._isPlaying&&(this.timePlanPlayer.isBuffering()?this._buffering=!0:this._buffering&&(this._buffering=!1));else for(var t,e=0,n=this._contentAnnotations.length;e<n;e++)if((t=this._contentAnnotations[e]).start<=this._canvasClockTime&&t.end>=this._canvasClockTime){this._isPlaying&&(t.element[0].readyState<3?this._buffering=!0:this._buffering&&(this._buffering=!1));var i=this._canvasClockTime-t.start+t.startOffset,r=t.element[0].currentTime;if(Math.abs(r-i)>this._mediaSyncMarginSecs){t.outOfSync=!0;var a=Math.abs(r-i);this.logMessage("DETECTED synchronization lag: "+Math.abs(a)),this._setMediaCurrentTime(t.element[0],i)}else t.outOfSync=!1}},e.prototype._playbackStalled=function(t,e){if(t)this._stallRequestedBy.indexOf(e)<0&&this._stallRequestedBy.push(e),this._isStalled||(this.$playerElement,this._wasPlaying=this._isPlaying,this.pause(!0),this._isStalled=t);else{var n=this._stallRequestedBy.indexOf(e);n>=0&&this._stallRequestedBy.splice(n,1),0===this._stallRequestedBy.length&&(this._isStalled&&this._wasPlaying&&this.play(!0),this._isStalled=t)}},e.prototype.resize=function(){if(this.$playerElement){var t=this._$canvasContainer.width();if(t){this._$canvasTimelineContainer.width(t);var e=this.$playerElement.find(".options-container");void 0!==this._data.halveAtWidth&&this.$playerElement.parent().width()<this._data.halveAtWidth?this._$canvasContainer.height(this.$playerElement.parent().height()/2):this._$canvasContainer.height(this.$playerElement.parent().height()-e.height())}if(this._waveformCanvas){var n=this._$canvasContainer.width(),i=this._$canvasContainer.height();this._waveformCanvas.width=n,this._waveformCanvas.height=i,this.waveformPageX=this._waveformCanvas.getBoundingClientRect().left}this._render(),this._drawWaveform()}},e}(u.BaseComponent);e.CanvasInstance=N},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(13),r=n(15),a=n(16),o=n(17);e.extractMediaFromAnnotationBodies=function(t){var e=t.getBody();if(!e.length)return null;for(var n=0;n<e.length;n++)if((u=(s=e[n]).getFormat())&&i.isHLSFormat(u)&&a.canPlayHls())return s;for(n=0;n<e.length;n++)if((u=(s=e[n]).getFormat())&&r.isMpegDashFormat(u)&&!o.isSafari())return s;for(n=0;n<e.length;n++){var s,u;if((u=(s=e[n]).getFormat())&&!i.isHLSFormat(u)&&!r.isMpegDashFormat(u))return s}return null}},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var a=n(10),o=n(4),s=n(2),u=function(t){function e(e){var n=t.call(this,e)||this;return n._lastVolume=1,n._data={volume:1},n._init(),n._resize(),n}return r(e,t),e.prototype._init=function(){var e=this,n=t.prototype._init.call(this);this._$element=$(this.el),n||s.Logger.error("Component failed to initialise"),this._$volumeMute=$('\n      <button class="btn volume-mute" title="'+this.options.data.content.mute+'">\n          <i class="av-icon av-icon-mute on" aria-hidden="true"></i>'+this.options.data.content.mute+"\n      </button>\n    "),this._$volumeSlider=$('<div class="volume-slider"></div>'),this._$element.append(this._$volumeMute,this._$volumeSlider);var i=this;return this._$volumeMute.on("touchstart click",(function(t){t.preventDefault(),0!==e._data.volume?(e._lastVolume=e._data.volume,e._data.volume=0):e._data.volume=e._lastVolume,e.fire(o.VolumeEvents.VOLUME_CHANGED,e._data.volume)})),this._$volumeSlider.slider({value:i._data.volume,step:.1,orientation:"horizontal",range:"min",min:0,max:1,animate:!1,create:function(){},slide:function(t,e){i._data.volume=e.value,0===i._data.volume&&(i._lastVolume=0),i.fire(o.VolumeEvents.VOLUME_CHANGED,i._data.volume)},stop:function(t,e){}}),n},e.prototype.set=function(t){this._data=Object.assign(this._data,t),this._render()},e.prototype._render=function(){if(void 0!==this._data.volume)if(this._$volumeSlider.slider({value:this._data.volume}),0===this._data.volume){var t=this.options.data.content.unmute;this._$volumeMute.prop("title",t),this._$volumeMute.find("i").switchClass("on","off")}else t=this.options.data.content.mute,this._$volumeMute.prop("title",t),this._$volumeMute.find("i").switchClass("off","on")},e.prototype._resize=function(){},e}(a.BaseComponent);e.AVVolumeControl=u},function(t,e,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},r=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var i=Array(t),r=0;for(e=0;e<n;e++)for(var a=arguments[e],o=0,s=a.length;o<s;o++,r++)i[r]=a[o];return i};Object.defineProperty(e,"__esModule",{value:!0});var a=n(6);e.createTimePlansFromManifest=function(t){var e=function(n,o,s){var u,l,c;void 0===o&&(o=[]),void 0===s&&(s=a.timelineTime(0));for(var h={type:"time-plan",canvases:[],duration:a.timelineTime(0),items:[],stops:[],rangeOrder:[n.id],end:a.timelineTime(0),start:s,rangeId:n.id,rangeStack:o},p=s,f=r(n.items,n.getCanvasIds()),d=0;d<f.length;d++){var g=f[d];if("string"==typeof g){var v=g.match(/(.*)#t=([0-9.]+),?([0-9.]+)?/)||[void 0,g,"0","0"],_=v[1],m=v[2],y=v[3];if(!_||void 0===m||void 0===y)continue;var E=t.getSequenceByIndex(0).getCanvasById(_);if(null===E)throw new Error("Canvas not found..");h.canvases.push(E.id);var T=a.canvasTime(parseFloat(m||"0")),C=a.canvasTime(parseFloat(y||"0")),I=a.timelineTime(C-T);p=a.addTime(I,p);var P={type:"time-stop",canvasIndex:d,start:a.minusTime(p,I),end:p,duration:I,rangeId:n.id,rawCanvasSelector:g,canvasTime:{start:T,end:C},rangeStack:o};h.stops.push(P),h.items.push(P)}else{var w=g.getBehavior();if(!w||"no-nav"!==w){var A=e(g,r(o,[g.id]),p);p=a.addTime(p,A.duration),(u=h.stops).push.apply(u,A.stops.map((function(t){return i(i({},t),{canvasIndex:t.canvasIndex+h.canvases.length})}))),(l=h.canvases).push.apply(l,A.canvases),h.items.push(A),(c=h.rangeOrder).push.apply(c,A.rangeOrder)}}}return h.end=p,h.duration=a.timelineTime(h.end-h.start),h},n=t.getTopRanges(),o=[];n||(n=t.getAllRanges()),1!==n.length||n[0].id||(n=n[0].getRanges());for(var s=0,u=n;s<u.length;s++){var l=u[s];l.getRanges()[0]&&l.id===l.getRanges()[0].id&&(l=l.getRanges()[0]);var c=e(l,[l.id]);o.push(c)}return o[0]}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),r=n(18),a=n(6);e.getMediaSourceFromAnnotationBody=function(t,e,n){var o=e.getType(),s=e.getFormat()||void 0,u=e.id.split("#")[0],l=t.getTarget();if(!l)throw new Error("No target");if(!o)throw new Error("Unknown media type");var c=r.getSpatialComponent(l)||[0,0,n.width||0,n.height||0],h=c[0],p=c[1],f=c[2],d=c[3],g=i.Utils.getTemporalComponent(l)||[0,n.duration],v=g[0],_=g[1],m=e.id.match(/(.*)#t=([0-9.]+),?([0-9.]+)?/)||[void 0,e.id,void 0,void 0],y=m[1],E=m[2],T=m[3];return{type:o,format:s,mediaSource:u,canvasId:n.id,x:h,y:p,width:void 0===f?void 0:parseInt(String(f),10),height:void 0===d?void 0:parseInt(String(d),10),start:a.annotationTime(Number(Number(v).toFixed(2))),end:a.annotationTime(Number(Number(_).toFixed(2))),bodyId:y,offsetStart:void 0===E?void 0:a.canvasTime(parseFloat(E)),offsetEnd:void 0===T?void 0:a.canvasTime(parseFloat(T))}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.formatTime=function(t){var e,n,i;return i=Math.ceil(t),((e=(e=Math.floor(i/3600))>=10?e:"0"+e)>=1?e+":":"")+(n=(n=Math.floor(i%3600/60))>=10?n:"0"+n)+":"+((i=Math.floor(i%3600%60))>=10?i:"0"+i)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.normalise=function(t,e,n){return(t-e)/(n-e)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(11);e.isVirtual=function(t){return!!t&&t instanceof i.VirtualCanvas}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(3);e.getFirstTargetedCanvasId=function t(e){var n;if(e.canvases&&e.canvases.length)n=e.canvases[0];else{var r=e.getRanges();if(r.length)return t(r[0])}if(void 0!==n)return i.Utils.normaliseUrl(n)}},function(t,e,n){t.exports=n(37)},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(22)),i(n(27)),i(n(29)),i(n(58)),i(n(19)),i(n(9)),i(n(4))},function(t,e){t.exports=function(t,e){for(var n=-1,i=e.length,r=t.length;++n<i;)t[r+n]=e[n];return t}},function(t,e,n){var i=n(8),r=n(43),a=n(48),o=i?i.isConcatSpreadable:void 0;t.exports=function(t){return a(t)||r(t)||!!(o&&t&&t[o])}},function(t,e,n){var i=n(41),r="object"==typeof self&&self&&self.Object===Object&&self,a=i||r||Function("return this")();t.exports=a},function(t,e,n){(function(e){var n="object"==typeof e&&e&&e.Object===Object&&e;t.exports=n}).call(this,n(42))},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){var i=n(44),r=n(24),a=Object.prototype,o=a.hasOwnProperty,s=a.propertyIsEnumerable,u=i(function(){return arguments}())?i:function(t){return r(t)&&o.call(t,"callee")&&!s.call(t,"callee")};t.exports=u},function(t,e,n){var i=n(45),r=n(24);t.exports=function(t){return r(t)&&"[object Arguments]"==i(t)}},function(t,e,n){var i=n(8),r=n(46),a=n(47),o=i?i.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":o&&o in Object(t)?r(t):a(t)}},function(t,e,n){var i=n(8),r=Object.prototype,a=r.hasOwnProperty,o=r.toString,s=i?i.toStringTag:void 0;t.exports=function(t){var e=a.call(t,s),n=t[s];try{t[s]=void 0;var i=!0}catch(t){}var r=o.call(t);return i&&(e?t[s]=n:delete t[s]),r}},function(t,e){var n=Object.prototype.toString;t.exports=function(t){return n.call(t)}},function(t,e){var n=Array.isArray;t.exports=n},function(t,e,n){t.exports=self.fetch||(self.fetch=n(25).default||n(25))},function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,a){function o(t){try{u(i.next(t))}catch(t){a(t)}}function s(t){try{u(i.throw(t))}catch(t){a(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}u((i=i.apply(t,e||[])).next())}))},r=this&&this.__generator||function(t,e){var n,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(e,"__esModule",{value:!0});var a=n(51),o=n(52),s=n(53),u=n(54),l=n(2),c=function(){function t(t,e){switch(void 0===e&&(e={}),this.source=t,this.mediaSource=t.mediaSource,this.type=t.type.toString().toLowerCase(),this.format=t.format?t.format.toString():void 0,this.mediaSyncMarginSecs=e.mediaSyncMarginSecs||1,this.type){case"video":this.element=document.createElement("video");break;case"sound":case"audio":this.element=document.createElement("audio");break;default:return}this.isDash()?this.instance=new a.DashFormat(this.mediaSource,e):this.isHls()?this.instance=new o.HlsFormat(this.mediaSource,e):this.isMpeg()?this.instance=new s.MpegFormat(this.mediaSource,e):this.instance=new u.DefaultFormat(this.mediaSource,e),this.element.classList.add("anno"),this.element.crossOrigin="anonymous",this.element.preload="metadata",this.element.pause(),this.instance.attachTo(this.element),this.element.currentTime=this.source.start}return t.prototype.syncClock=function(t){t>this.element.duration?l.Logger.error("Clock synced out of bounds (max: "+this.element.duration+", got: "+t+")"):Math.abs(this.element.currentTime-t)>this.mediaSyncMarginSecs&&(this.element.currentTime=t)},t.prototype.getCanvasId=function(){return this.source.canvasId},t.prototype.isWithinRange=function(t){return this.source.start<=t&&this.source.end>=t},t.prototype.load=function(t){return void 0===t&&(t=!1),i(this,void 0,void 0,(function(){var e=this;return r(this,(function(n){switch(n.label){case 0:return t&&this.element.load(),[4,new Promise((function(t){e.element.addEventListener("loadedmetadata",(function(){t()}))}))];case 1:return n.sent(),[2]}}))}))},t.prototype.setSize=function(t,e,n,i){$(this.element).css({top:t+"%",left:e+"%",width:n+"%",height:i+"%"})},t.prototype.isDash=function(){return this.format&&"application/dash+xml"===this.format.toString()&&"undefined"!=typeof dashjs},t.prototype.isHls=function(){return this.format&&"application/vnd.apple.mpegurl"===this.format.toString()&&"undefined"!=typeof Hls&&Hls.isSupported()},t.prototype.isMpeg=function(){return""!==this.element.canPlayType("application/vnd.apple.mpegurl")},t.prototype.stop=function(){this.element.pause(),this.element.currentTime=this.source.start},t.prototype.play=function(t){return l.Logger.log("MediaElement.play("+t+")"),void 0!==t&&(this.element.currentTime=t),this.element.play()},t.prototype.pause=function(){this.element.pause()},t.prototype.isBuffering=function(){return this.element.readyState<3},t}();e.MediaElement=c},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var a=function(t){function e(e,n){void 0===n&&(n={});var i=t.call(this,e,n)||this;return i.player=dashjs.MediaPlayer().create(),i.player.getDebug().setLogToBrowserConsole(!1),n.adaptiveAuthEnabled&&i.player.setXHRWithCredentialsForType("MPD",!0),i}return r(e,t),e.prototype.attachTo=function(t){this.player.initialize(t,this.source,!1)},e.prototype.debug=function(){this.player.getDebug().setLogToBrowserConsole(!0),this.player.getDebug().setLogLevel(4)},e}(n(5).MediaFormat);e.DashFormat=a},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var a=function(t){function e(e,n){void 0===n&&(n={});var i=t.call(this,e,n)||this;return n.adaptiveAuthEnabled?i.hls=new Hls({xhrSetup:function(t){t.withCredentials=!0}}):i.hls=new Hls,i.hls.loadSource(i.source),i}return r(e,t),e.prototype.attachTo=function(t){this.hls.attachMedia(t)},e}(n(5).MediaFormat);e.HlsFormat=a},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var a=function(t){function e(e,n){return void 0===n&&(n={}),t.call(this,e,n)||this}return r(e,t),e.prototype.attachTo=function(t){t.src=this.source},e}(n(5).MediaFormat);e.MpegFormat=a},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var a=function(t){function e(e,n){return void 0===n&&(n={}),t.call(this,e,n)||this}return r(e,t),e}(n(5).MediaFormat);e.DefaultFormat=a},function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,a){function o(t){try{u(i.next(t))}catch(t){a(t)}}function s(t){try{u(i.throw(t))}catch(t){a(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}u((i=i.apply(t,e||[])).next())}))},r=this&&this.__generator||function(t,e){var n,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},a=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var i=Array(t),r=0;for(e=0;e<n;e++)for(var a=arguments[e],o=0,s=a.length;o<s;o++,r++)i[r]=a[o];return i};Object.defineProperty(e,"__esModule",{value:!0});var o=n(6),s=n(2),u=function(){function t(t,e,n,i,r){var a=this;this.continuous=!0,this.playing=!1,this._time=o.timelineTime(0),this.media=t,this.plan=e,this.fullPlan=e,this.currentStop=e.stops[0];var s=function(){};this.notifyRangeChange=n||s,this.notifyTimeChange=i||s,this.notifyPlaying=r||s,this.logging=!0,this.currentRange=this.currentStop.rangeStack[0],this.setTime(this.currentStop.start),t.onPlay((function(t,e,n){t===a.plan.canvases[a.currentStop.canvasIndex]?a.playing||a.notifyPlaying(!0):n.pause()})),t.onPause((function(t){t===a.plan.canvases[a.currentStop.canvasIndex]&&a.playing&&a.notifyPlaying(!1)}))}return t.prototype.selectPlan=function(t){var e=void 0===t?{}:t,n=e.reset,i=e.rangeId;if(n)return this.initialisePlan(this.fullPlan);if(i){for(var r=[],a=0,o=this.fullPlan.stops;a<o.length;a++){var s=o[a],u=s.rangeStack.indexOf(i);-1!==s.rangeStack.indexOf(i)&&(r=s.rangeStack.slice(1,u+1))}for(var l=this.fullPlan,c=0,h=r;c<h.length;c++)for(var p=h[c],f=0,d=l.items;f<d.length;f++){var g=d[f];if("time-plan"===g.type&&g.rangeId===p){l=g;break}}if(l)return this.initialisePlan(l)}},t.prototype.initialisePlan=function(t){this.plan=t},t.prototype.getCurrentRange=function(){for(var t=this.currentRange,e=this.currentRange===this.currentStop.rangeId,n=e?this.plan.stops:this.fullPlan.stops,i=[],r=[],a=0,o=n;a<o.length;a++){var u=o[a];e?u.rangeId===t&&(i.push(u.start),r.push(u.end)):-1!==u.rangeStack.indexOf(t)&&(i.push(u.start),r.push(u.end))}var l=Math.min.apply(Math,i),c=Math.max.apply(Math,r);return s.Logger.log("Range",{rangeId:t,isRangeWithStop:e,stopsToCheck:n,start:l-this.plan.start,end:c-this.plan.start,duration:c-l}),{start:l-this.plan.start,end:c-this.plan.start,duration:c-l}},t.prototype.getTime=function(){return this._time},t.prototype.setInternalTime=function(t){return this._time=t,this.notifyTimeChange(t),this._time},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.logging&&s.Logger.log.apply(s.Logger,a(["TimePlanPlayer"],t))},t.prototype.setContinuousPlayback=function(t){this.continuous=t},t.prototype.setIsPlaying=function(t){this.playing=t},t.prototype.play=function(){return this.log("Play",this.getTime()),this.setIsPlaying(!0),this.media.play(this.plan.canvases[this.currentStop.canvasIndex]),this.getTime()},t.prototype.currentTimelineTime=function(){return this.getTime()},t.prototype.currentMediaTime=function(){s.Logger.log("Current media time:\n  - Current start: "+this.currentStop.start+"\n  - Current canvas: "+this.currentStop.canvasTime.start+"\n  - Current time: "+this.getTime()+"\n    ",this);var t=o.minusTime(this.getTime(),this.currentStop.start);return o.annotationTime(o.addTime(t,o.timelineTime(this.currentStop.canvasTime.start)))},t.prototype.pause=function(){return this.log("Pause",this.getTime()),this.setIsPlaying(!1),this.media.pause(),this.getTime()},t.prototype.setVolume=function(t){this.media.setVolume(t)},t.prototype.findStop=function(t){for(var e=0,n=this.plan.stops;e<n.length;e++){var i=n[e];if(i.start-.001<=t&&i.end-.001>t)return i}if(this.plan.stops[this.plan.stops.length-1].end===t)return this.plan.stops[this.plan.stops.length-1]},t.prototype.setTime=function(t,e){return void 0===e&&(e=!0),i(this,void 0,void 0,(function(){var n;return r(this,(function(i){switch(i.label){case 0:return s.Logger.groupCollapsed("TimeplanPlayer.setTime("+t+", "+(e?"true":"false")+")"),this.getTime()===t?[3,2]:(this.log("set time",{from:this.getTime(),to:t}),this.setInternalTime(t),(n=this.findStop(t))&&n!==this.currentStop?(e&&(this.currentRange=n.rangeId),[4,this.advanceToStop(this.currentStop,n)]):[3,2]);case 1:i.sent(),i.label=2;case 2:return s.Logger.groupEnd(),[2]}}))}))},t.prototype.next=function(){for(var t=this.plan.rangeOrder.indexOf(this.currentRange),e=t>=0&&t===this.plan.rangeOrder.length-1?void 0:this.plan.rangeOrder.indexOf(this.currentRange)+1,n=void 0!==e?this.plan.rangeOrder[e]:void 0,i=this.plan.stops.indexOf(this.currentStop),r=0,a=void 0,o=!0;o;){if(r++,!(a=this.plan.stops[i+r])){o=!1;break}if(a.rangeId!==this.currentStop.rangeId){o=!1;break}}return this.playing&&a&&(n=a.rangeId),n&&a&&a.rangeId!==n?(this.playing||-1===this.currentStop.rangeStack.indexOf(n)&&-1!==a.rangeStack.indexOf(n)?(this.currentRange=this.playing?a.rangeId:n,this.setInternalTime(a.start),this.advanceToStop(this.currentStop,a,this.playing?a.rangeId:n)):(this.currentRange=n,this.setInternalTime(this.currentStop.start),this.advanceToStop(this.currentStop,this.currentStop,n)),this.getTime()):(a?(this.setInternalTime(a.start),this.currentRange=a.rangeId,this.advanceToStop(this.currentStop,a,a.rangeId)):this.goToEndOfRange(this.currentStop.rangeId),this.getTime())},t.prototype.goToEndOfRange=function(t){for(var e=void 0,n=0;n<this.plan.stops.length;n++){var i=this.plan.stops[n];i.rangeId===t&&(!e||i.canvasIndex>=e.canvasIndex&&i.end>e.end)&&(e=i)}e&&(this.advanceToStop(this.currentStop,e,t),this.setInternalTime(e.end))},t.prototype.goToStartOfRange=function(t){for(var e=void 0,n=this.plan.stops.length-1;n>=0;n--){var i=this.plan.stops[n];i.rangeId===t&&(!e||i.canvasIndex<=e.canvasIndex&&i.start<e.start)&&(e=i)}e&&(e!==this.currentStop&&this.advanceToStop(this.currentStop,e,t),this.setInternalTime(e.start))},t.prototype.previous=function(){for(var t=0===this.plan.rangeOrder.indexOf(this.currentRange)?void 0:this.plan.rangeOrder.indexOf(this.currentRange)-1,e=void 0!==t?this.plan.rangeOrder[t]:void 0,n=this.currentStop,i=this.plan.stops.indexOf(this.currentStop),r=i,a=this.plan.stops[i-1],o=!0;o;){var s=this.plan.stops[r-1];if(!s){o=!1;break}if(s.rangeId===this.currentRange&&(n=s),a.rangeId!==s.rangeId){o=!1;break}s&&(a=s,r-=1)}var u=this._time-(n.start+2)>0,l=this.playing&&a&&a.rangeId!==this.currentStop.rangeId,c=0===i||!e&&0===r,h=e&&-1===this.currentStop.rangeStack.indexOf(e)&&(-1!==a.rangeStack.indexOf(e)||a.rangeId===e),p=e&&-1!==this.currentStop.rangeStack.indexOf(e);return u?(n!==this.currentStop&&this.advanceToStop(this.currentStop,n,n.rangeId),this.setInternalTime(n.start),this.getTime()):(l&&(e=a.rangeId),c?(this.goToStartOfRange(e||this.currentStop.rangeId),e&&this.currentStop.rangeId!==e&&(this.currentRange=e,this.advanceToStop(this.currentStop,n,e)),this.getTime()):e&&h?(this.setInternalTime(a.start),this.currentRange=e,this.advanceToStop(this.currentStop,a,e),this.getTime()):e&&p?(this.setInternalTime(this.currentStop.start),this.currentRange=e,this.advanceToStop(this.currentStop,n,e),this.getTime()):this.getTime())},t.prototype.setRange=function(t){if(s.Logger.log("setRange",t),t===this.currentRange)return this.getTime();if(this.currentRange=t,t===this.currentStop.rangeId)return this.getTime();for(var e=0,n=this.plan.stops;e<n.length;e++){var i=n[e];if(i.rangeId===t){this.setInternalTime(i.start),this.advanceToStop(this.currentStop,i,t);break}}for(var r=0,a=this.plan.stops;r<a.length;r++){var o=a[r];if(-1!==o.rangeStack.indexOf(t)){this.setInternalTime(o.start),this.advanceToStop(this.currentStop,o,t);break}}return this.getTime()},t.prototype.isBuffering=function(){return this.media.isBuffering()},t.prototype.advanceToTime=function(t){s.Logger.groupCollapsed("TimeplanPlayer.advanceToTime("+t+")");var e=this.findStop(t);return e&&this.currentStop!==e?(s.Logger.log("advanceToTime.a"),this.advanceToStop(this.currentStop,e),{buffering:this.isBuffering(),time:t}):(this.playing&&this.currentRange!==this.currentStop.rangeId&&(this.currentRange=this.currentStop.rangeId,this.notifyRangeChange(this.currentStop.rangeId,{from:this.currentStop,to:this.currentStop})),e?(s.Logger.log("advanceToTime.c",{time:this.getTime()}),this.setInternalTime(t),this.media.syncClock(this.currentMediaTime()),s.Logger.groupEnd(),{time:t}):(s.Logger.log("advanceToTime.b"),this.pause(),this.setTime(this.currentStop.end),s.Logger.groupEnd(),{paused:!0,buffering:this.isBuffering(),time:this.currentStop.end}))},t.prototype.hasEnded=function(){return this.currentStop.end===this.getTime()},t.prototype.advanceToStop=function(t,e,n){return i(this,void 0,void 0,(function(){var i;return r(this,(function(r){switch(r.label){case 0:return s.Logger.log("TimeplanPlayer.advanceToStop",{from:t,to:e,rangeId:n}),t===e?(n&&this.notifyRangeChange(n||e.rangeId,{to:e,from:t}),[2]):(this.log("advanceToStop",e.start),this.currentStop=e,i=this.media.seekToMediaTime(this.currentMediaTime()),this.notifyRangeChange(n||e.rangeId,{to:e,from:t}),[4,i]);case 1:return r.sent(),[2]}}))}))},t.prototype.getStartTime=function(){return this.plan.start},t.prototype.getDuration=function(){return this.plan.duration},t}();e.TimePlanPlayer=u},function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(r,a){function o(t){try{u(i.next(t))}catch(t){a(t)}}function s(t){try{u(i.throw(t))}catch(t){a(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}u((i=i.apply(t,e||[])).next())}))},r=this&&this.__generator||function(t,e){var n,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(e,"__esModule",{value:!0});var a=n(2),o=function(){function t(t){var e=this;this.elements=[],this.playing=!1,this.canvasMap={},this._onPlay=[],this._onPause=[],a.Logger.log("Composite media element",t),this.elements=t;for(var n=function(t){var n=t.getCanvasId();i.canvasMap[n]=i.canvasMap[n]?i.canvasMap[n]:[],i.canvasMap[n].push(t),t.element.addEventListener("play",(function(){e._onPlay.forEach((function(e){return e(n,t.element.currentTime,t)}))})),t.element.addEventListener("pause",(function(){e._onPause.forEach((function(e){return e(n,t.element.currentTime,t)}))}))},i=this,r=0,o=t;r<o.length;r++)n(o[r]);this.activeElement=t[0]}return t.prototype.syncClock=function(t){a.Logger.group("CompositeMediaElement.syncClock"),a.Logger.log("syncClock: "+t),a.Logger.log({fromTime:t,toTime:t,instance:this}),this.activeElement&&this.activeElement.syncClock(t),a.Logger.groupEnd()},t.prototype.onPlay=function(t){this._onPlay.push(t)},t.prototype.onPause=function(t){this._onPause.push(t)},t.prototype.findElementInRange=function(t,e){if(this.canvasMap[t])for(var n=0,i=this.canvasMap[t];n<i.length;n++){var r=i[n];if(r.isWithinRange(e))return r}},t.prototype.appendTo=function(t){a.Logger.log("Appending...",this.elements.map((function(t){return t.element}))),t.append(this.elements.map((function(t){return t.element})))},t.prototype.load=function(){return i(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,Promise.all(this.elements.map((function(t){return t.load()})))];case 1:return t.sent(),[2]}}))}))},t.prototype.seekToMediaTime=function(t){return i(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return this.activeElement?this.playing?[4,this.activeElement.play(t)]:[3,2]:[3,3];case 1:return e.sent(),[3,3];case 2:this.activeElement.syncClock(t),e.label=3;case 3:return[2]}}))}))},t.prototype.seekTo=function(t,e){return i(this,void 0,void 0,(function(){var n;return r(this,(function(i){return n=this.findElementInRange(t,e),a.Logger.log("CompositeMediaElement.seekTo()",{canvasId:n?n.source.canvasId:null,newElement:n}),this.activeElement&&n&&n!==this.activeElement&&(this.activeElement.stop(),this.activeElement=n),[2,this.seekToMediaTime(e)]}))}))},t.prototype.play=function(t,e){return i(this,void 0,void 0,(function(){return r(this,(function(n){switch(n.label){case 0:return this.playing=!0,t&&void 0!==e?[4,this.seekTo(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return this.activeElement?[2,this.activeElement.play(e)]:[2]}}))}))},t.prototype.pause=function(){this.playing=!1,this.activeElement&&this.activeElement.pause()},t.prototype.setVolume=function(t){for(var e=0,n=this.elements;e<n.length;e++)n[e].element.volume=t},t.prototype.isBuffering=function(){return!!this.activeElement&&this.activeElement.isBuffering()},t}();e.CompositeMediaElement=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){var e=this;this.length=0,this.duration=0,this.pixelsPerSecond=Number.MAX_VALUE,this.secondsPerPixel=Number.MAX_VALUE,this.timeIndex={},this.minIndex={},this.maxIndex={},this._waveforms=[],t.forEach((function(t){e._waveforms.push({start:e.length,end:e.length+t.adapter.length,waveform:t}),e.length+=t.adapter.length,e.duration+=t.duration,e.pixelsPerSecond=Math.min(e.pixelsPerSecond,t.pixels_per_second),e.secondsPerPixel=Math.min(e.secondsPerPixel,t.seconds_per_pixel)}))}return t.prototype.min=function(t){if(void 0===this.minIndex[t]){var e=this._find(t);this.minIndex[t]=e?e.waveform.min_sample(t-e.start):0}return this.minIndex[t]},t.prototype.max=function(t){if(void 0===this.maxIndex[t]){var e=this._find(t);this.maxIndex[t]=e?e.waveform.max_sample(t-e.start):0}return this.maxIndex[t]},t.prototype._find=function(t){if(void 0===this.timeIndex[t]){var e=this._waveforms.find((function(e){return t>=e.start&&t<e.end}));if(!e)return null;this.timeIndex[t]=e}return this.timeIndex[t]},t}();e.CompositeWaveform=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(16),r=n(30),a=n(59),o=n(20),s=n(28),u=n(32),l=n(35),c=n(31),h=n(18),p=n(26),f=n(14),d=n(13),g=n(60),v=n(15),_=n(17),m=n(34),y=n(33),E=n(12);e.AVComponentUtils={canPlayHls:i.canPlayHls,createTimePlansFromManifest:r.createTimePlansFromManifest,debounce:a.debounce,diffData:o.diffData,diff:o.diffData,extractMediaFromAnnotationBodies:s.extractMediaFromAnnotationBodies,formatTime:u.formatTime,getFirstTargetedCanvasId:l.getFirstTargetedCanvasId,getMediaSourceFromAnnotationBody:c.getMediaSourceFromAnnotationBody,getSpatialComponent:h.getSpatialComponent,getTimestamp:p.getTimestamp,hlsMimeTypes:f.hlsMimeTypes,hlsMediaTypes:f.hlsMimeTypes,isHLSFormat:d.isHLSFormat,isIE:g.isIE,isMpegDashFormat:v.isMpegDashFormat,isSafari:_.isSafari,isVirtual:m.isVirtual,normalise:y.normalise,normalize:y.normalise,normalizeNumber:y.normalise,normaliseNumber:y.normalise,retargetTemporalComponent:E.retargetTemporalComponent}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.debounce=function(t,e){return e=e||100,function(){if(!t.debouncing){var n=Array.prototype.slice.apply(arguments);t.lastReturnVal=t.apply(window,n),t.debouncing=!0}return clearTimeout(t.debounceTimeout),t.debounceTimeout=setTimeout((function(){t.debouncing=!1}),e),t.lastReturnVal}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isIE=function(){var t=window.navigator.userAgent,e=t.indexOf("MSIE ");if(e>0)return parseInt(t.substring(e+5,t.indexOf(".",e)),10);if(t.indexOf("Trident/")>0){var n=t.indexOf("rv:");return parseInt(t.substring(n+3,t.indexOf(".",n)),10)}var i=t.indexOf("Edge/");return i>0&&parseInt(t.substring(i+5,t.indexOf(".",i)),10)}}])})),define("lib/IIIFAVComponent.js",(function(){}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-avcenterpanel-module/AVCenterPanel",["require","exports","../uv-shared-module/BaseEvents","../uv-shared-module/CenterPanel","../uv-shared-module/Position","../../Utils","manifesto.js","@iiif/iiif-av-component"],(function(require,exports,BaseEvents_1,CenterPanel_1,Position_1,Utils_1,manifesto_js_1,iiif_av_component_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var AVCenterPanel=function(_super){function AVCenterPanel($element){var _this=_super.call(this,$element)||this;return _this._mediaReady=!1,_this._isThumbsViewOpen=!1,_this._mediaReadyQueue=[],_this.attributionPosition=Position_1.Position.BOTTOM_RIGHT,_this}return __extends(AVCenterPanel,_super),AVCenterPanel.prototype.create=function(){var _this=this;this.setConfig("avCenterPanel"),_super.prototype.create.call(this);var that=this;this.component.subscribe(BaseEvents_1.BaseEvents.OPEN_EXTERNAL_RESOURCE,(function(resources){that.openMedia(resources)})),this.component.subscribe(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,(function(canvasIndex){_this._lastCanvasIndex!==canvasIndex&&_this._viewCanvas(canvasIndex)})),this.component.subscribe(BaseEvents_1.BaseEvents.CURRENT_TIME_CHANGED,(function(e,currentTime){_this._whenMediaReady((function(){_this.avcomponent&&_this.avcomponent.setCurrentTime(currentTime)}))})),this.component.subscribe(BaseEvents_1.BaseEvents.RANGE_CHANGED,(function(range){_this._observeRangeChanges()&&_this._whenMediaReady((function(){that._viewRange(range),that._setTitle()}))})),this.component.subscribe(BaseEvents_1.BaseEvents.METRIC_CHANGED,(function(){_this._whenMediaReady((function(){_this.avcomponent&&_this.avcomponent.set({limitToRange:_this._limitToRange(),constrainNavigationToRange:_this._limitToRange()})}))})),this.component.subscribe(BaseEvents_1.BaseEvents.CREATED,(function(){_this._setTitle()})),this.component.subscribe(BaseEvents_1.BaseEvents.OPEN_THUMBS_VIEW,(function(){_this._isThumbsViewOpen=!0,_this._whenMediaReady((function(){_this.avcomponent&&(_this.avcomponent.set({virtualCanvasEnabled:!1}),_this.extension.helper.getCurrentCanvas()&&_this._viewCanvas(_this.extension.helper.canvasIndex))}))})),this.component.subscribe(BaseEvents_1.BaseEvents.OPEN_TREE_VIEW,(function(){_this._isThumbsViewOpen=!1,_this._whenMediaReady((function(){_this.avcomponent&&_this.avcomponent.set({virtualCanvasEnabled:!0})}))})),this._createAVComponent()},AVCenterPanel.prototype._flushMediaReadyQueue=function(){for(var _i=0,_a=this._mediaReadyQueue;_i<_a.length;_i++){(0,_a[_i])()}this._mediaReadyQueue=[]},AVCenterPanel.prototype._createAVComponent=function(){var _this=this;this.$avcomponent=$('<div class="iiif-av-component"></div>'),this.$content.prepend(this.$avcomponent),this.avcomponent=new iiif_av_component_1.AVComponent({target:this.$avcomponent[0],posterImageExpanded:this.options.posterImageExpanded}),this.avcomponent.on("mediaready",(function(){console.log("mediaready"),_this._mediaReady=!0,_this._flushMediaReadyQueue()}),!1),this.avcomponent.on("pause",(function(){_this.component.publish(BaseEvents_1.BaseEvents.PAUSE,_this.avcomponent.getCurrentTime())})),this.avcomponent.on("rangechanged",(function(rangeId){if(rangeId){var range=_this.extension.helper.getRangeById(rangeId);if(range)range!==_this.extension.helper.getCurrentRange()&&_this.component.publish(BaseEvents_1.BaseEvents.RANGE_CHANGED,range);else _this.component.publish(BaseEvents_1.BaseEvents.RANGE_CHANGED,null)}else _this.component.publish(BaseEvents_1.BaseEvents.RANGE_CHANGED,null);_this._setTitle()}),!1)},AVCenterPanel.prototype._observeRangeChanges=function(){return!this._isThumbsViewOpen},AVCenterPanel.prototype._setTitle=function(){var value,label,_this=this,title="",currentRange=this.extension.helper.getCurrentRange();label=currentRange?currentRange.getLabel():this.extension.helper.getCurrentCanvas().getLabel(),(value=manifesto_js_1.LanguageMap.getValue(label))&&(title=value),Utils.Bools.getBool(this.config.options.includeParentInTitleEnabled,!1)&&(currentRange?currentRange.parentRange&&(label=currentRange.parentRange.getLabel(),value=manifesto_js_1.LanguageMap.getValue(label)):value=this.extension.helper.getLabel(),value&&(title+=this.content.delimiter+value)),this.title=title;for(var groups=this.extension.helper.getMetadata({range:currentRange}),i=0;i<groups.length;i++){var item=groups[i].items.find((function(el){if(el.label){var label_1=manifesto_js_1.LanguageMap.getValue(el.label);if(label_1&&label_1.toLowerCase()===_this.config.options.subtitleMetadataField)return!0}return!1}));if(item){this.subtitle=manifesto_js_1.LanguageMap.getValue(item.value);break}}this.$title.text(Utils_1.UVUtils.sanitize(this.title)),this.resize(!1)},AVCenterPanel.prototype._isCurrentResourceAccessControlled=function(){return this.extension.helper.getCurrentCanvas().externalResource.isAccessControlled()},AVCenterPanel.prototype.openMedia=function(resources){var _this=this;this.extension.getExternalResources(resources).then((function(){_this.avcomponent&&(_this.extension.helper.canvasIndex===_this._lastCanvasIndex&&_this.avcomponent.reset(),_this._lastCanvasIndex=_this.extension.helper.canvasIndex,_this.avcomponent.set({helper:_this.extension.helper,adaptiveAuthEnabled:_this._isCurrentResourceAccessControlled(),autoPlay:_this.config.options.autoPlay,enableFastForward:_this.config.options.enableFastForward,enableFastRewind:_this.config.options.enableFastRewind,autoSelectRange:!0,constrainNavigationToRange:_this._limitToRange(),content:_this.content,defaultAspectRatio:.56,doubleClickMS:350,limitToRange:_this._limitToRange(),posterImageRatio:_this.config.options.posterImageRatio}),_this.resize())}))},AVCenterPanel.prototype._limitToRange=function(){return!this.extension.isDesktopMetric()},AVCenterPanel.prototype._whenMediaReady=function(cb){this._mediaReady?cb():this._mediaReadyQueue.push(cb)},AVCenterPanel.prototype._viewRange=function(range){var _this=this;this._whenMediaReady((function(){range&&_this.avcomponent&&_this.avcomponent.viewRange(range.id),_this.resize(!1)}))},AVCenterPanel.prototype._viewCanvas=function(canvasIndex){var _this=this;this._whenMediaReady((function(){var canvas=_this.extension.helper.getCanvasByIndex(canvasIndex);_this.avcomponent&&_this.avcomponent.showCanvas(canvas.id)}))},AVCenterPanel.prototype.resize=function(resizeAVComponent){void 0===resizeAVComponent&&(resizeAVComponent=!0),_super.prototype.resize.call(this),resizeAVComponent&&this.avcomponent&&(this.$avcomponent.height(this.$content.height()),this.avcomponent.resize())},AVCenterPanel}(CenterPanel_1.CenterPanel);exports.AVCenterPanel=AVCenterPanel})),define("modules/uv-shared-module/InformationArgs",["require","exports"],(function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var InformationArgs=function(informationType,param){this.informationType=informationType,this.param=param};exports.InformationArgs=InformationArgs})),define("modules/uv-shared-module/InformationType",["require","exports"],(function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),function(InformationType){InformationType[InformationType.AUTH_CORS_ERROR=0]="AUTH_CORS_ERROR",InformationType[InformationType.DEGRADED_RESOURCE=1]="DEGRADED_RESOURCE"}(exports.InformationType||(exports.InformationType={}))})),define("modules/uv-shared-module/LoginWarningMessages",["require","exports"],(function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var LoginWarningMessages=function(){function LoginWarningMessages(){}return LoginWarningMessages.FORBIDDEN="forbiddenResourceMessage",LoginWarningMessages}();exports.LoginWarningMessages=LoginWarningMessages})),define("modules/uv-shared-module/Auth09",["require","exports","manifesto.js","./BaseEvents","./InformationArgs","./InformationType","./LoginWarningMessages"],(function(require,exports,manifesto_js_1,BaseEvents_1,InformationArgs_1,InformationType_1,LoginWarningMessages_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Auth09=function(){function Auth09(){}return Auth09.loadExternalResources=function(resourcesToLoad,storageStrategy){return new Promise((function(resolve){manifesto_js_1.Utils.loadExternalResourcesAuth09(resourcesToLoad,storageStrategy,Auth09.clickThrough,Auth09.restricted,Auth09.login,Auth09.getAccessToken,Auth09.storeAccessToken,Auth09.getStoredAccessToken,Auth09.handleExternalResourceResponse).then((function(r){resolve(r)})).catch((function(error){switch(error.name){case manifesto_js_1.StatusCode.AUTHORIZATION_FAILED.toString():Auth09.publish(BaseEvents_1.BaseEvents.LOGIN_FAILED);break;case manifesto_js_1.StatusCode.FORBIDDEN.toString():Auth09.publish(BaseEvents_1.BaseEvents.FORBIDDEN);break;case manifesto_js_1.StatusCode.RESTRICTED.toString():break;default:Auth09.publish(BaseEvents_1.BaseEvents.SHOW_MESSAGE,[error.message||error])}}))}))},Auth09.clickThrough=function(resource){return new Promise((function(resolve){Auth09.publish(BaseEvents_1.BaseEvents.SHOW_CLICKTHROUGH_DIALOGUE,[{resource:resource,acceptCallback:function(){if(resource.clickThroughService)var win_1=window.open(resource.clickThroughService.id),pollTimer_1=window.setInterval((function(){win_1&&win_1.closed&&(window.clearInterval(pollTimer_1),Auth09.publish(BaseEvents_1.BaseEvents.CLICKTHROUGH),resolve())}),500)}}])}))},Auth09.restricted=function(resource){return new Promise((function(resolve,reject){Auth09.publish(BaseEvents_1.BaseEvents.SHOW_RESTRICTED_DIALOGUE,[{resource:resource,acceptCallback:function(){Auth09.publish(BaseEvents_1.BaseEvents.LOAD_FAILED),reject(resource)}}])}))},Auth09.login=function(resource){return new Promise((function(resolve){var options={};resource.status===HTTPStatusCode.FORBIDDEN&&(options.warningMessage=LoginWarningMessages_1.LoginWarningMessages.FORBIDDEN,options.showCancelButton=!0),Auth09.publish(BaseEvents_1.BaseEvents.SHOW_LOGIN_DIALOGUE,[{resource:resource,loginCallback:function(){if(resource.loginService)var win_2=window.open(resource.loginService.id+"?t="+(new Date).getTime()),pollTimer_2=window.setInterval((function(){win_2&&win_2.closed&&(window.clearInterval(pollTimer_2),Auth09.publish(BaseEvents_1.BaseEvents.LOGIN),resolve())}),500)},logoutCallback:function(){if(resource.logoutService)var win_3=window.open(resource.logoutService.id+"?t="+(new Date).getTime()),pollTimer_3=window.setInterval((function(){win_3&&win_3.closed&&(window.clearInterval(pollTimer_3),Auth09.publish(BaseEvents_1.BaseEvents.LOGOUT),resolve())}),500)},options:options}])}))},Auth09.getAccessToken=function(resource,rejectOnError){return new Promise((function(resolve,reject){if(resource.tokenService){var serviceUri=resource.tokenService.id,msgId=serviceUri+"|"+(new Date).getTime(),receiveAccessToken_1=function(e){window.removeEventListener("message",receiveAccessToken_1);var token=e.data;token.error?rejectOnError?reject(token.errorDescription):resolve(void 0):resolve(token)};window.addEventListener("message",receiveAccessToken_1,!1);var tokenUri=serviceUri+"?messageId="+msgId;$("#commsFrame").prop("src",tokenUri)}else reject("Token service not found")}))},Auth09.storeAccessToken=function(resource,token,storageStrategy){return new Promise((function(resolve,reject){resource.tokenService?(Utils.Storage.set(resource.tokenService.id,token,token.expiresIn,new Utils.StorageType(storageStrategy)),resolve()):reject("Token service not found")}))},Auth09.getStoredAccessToken=function(resource,storageStrategy){return new Promise((function(resolve,reject){var foundToken,foundItems=[],item=null;if(resource.tokenService&&(item=Utils.Storage.get(resource.tokenService.id,new Utils.StorageType(storageStrategy))),item)foundItems.push(item);else for(var domain=Utils.Urls.getUrlParts(resource.dataUri).hostname,items=Utils.Storage.getItems(new Utils.StorageType(storageStrategy)),i=0;i<items.length;i++)(item=items[i]).key.includes(domain)&&foundItems.push(item);(foundItems=foundItems.sort((function(a,b){return a.expiresAt-b.expiresAt}))).length&&(foundToken=foundItems[foundItems.length-1].value),resolve(foundToken)}))},Auth09.handleExternalResourceResponse=function(resource){return new Promise((function(resolve,reject){if(resource.isResponseHandled=!0,resource.status===HTTPStatusCode.OK)resolve(resource);else if(resource.status===HTTPStatusCode.MOVED_TEMPORARILY)resolve(resource),Auth09.publish(BaseEvents_1.BaseEvents.RESOURCE_DEGRADED,[resource]);else if(resource.error.status===HTTPStatusCode.UNAUTHORIZED||resource.error.status===HTTPStatusCode.INTERNAL_SERVER_ERROR)if(Modernizr.cors)reject(resource.error.statusText);else{var informationArgs=new InformationArgs_1.InformationArgs(InformationType_1.InformationType.AUTH_CORS_ERROR,null);Auth09.publish(BaseEvents_1.BaseEvents.SHOW_INFORMATION,[informationArgs]),resolve(resource)}else if(resource.error.status===HTTPStatusCode.FORBIDDEN){var error=new Error;error.message="Forbidden",error.name=manifesto_js_1.StatusCode.FORBIDDEN.toString(),reject(error)}else reject(resource.error.statusText)}))},Auth09.handleDegraded=function(resource){var informationArgs=new InformationArgs_1.InformationArgs(InformationType_1.InformationType.DEGRADED_RESOURCE,resource);Auth09.publish(BaseEvents_1.BaseEvents.SHOW_INFORMATION,[informationArgs])},Auth09}();exports.Auth09=Auth09})),define("modules/uv-shared-module/Auth1",["require","exports","manifesto.js","./BaseEvents","../../Utils","./InformationArgs","./InformationType"],(function(require,exports,manifesto_js_1,BaseEvents_1,Utils_1,InformationArgs_1,InformationType_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Auth1=function(){function Auth1(){}return Auth1.loadExternalResources=function(resourcesToLoad,storageStrategy,options){return new Promise((function(resolve){Auth1.storageStrategy=storageStrategy,resourcesToLoad=resourcesToLoad.map((function(resource){return resource.authAPIVersion=1,resource.options=options,resource})),manifesto_js_1.Utils.loadExternalResourcesAuth1(resourcesToLoad,Auth1.openContentProviderInteraction,Auth1.openTokenService,Auth1.getStoredAccessToken,Auth1.userInteractedWithContentProvider,Auth1.getContentProviderInteraction,Auth1.handleMovedTemporarily,Auth1.showOutOfOptionsMessages).then((function(r){resolve(r)})).catch((function(error){switch(error.name){case manifesto_js_1.StatusCode.AUTHORIZATION_FAILED.toString():Auth1.publish(BaseEvents_1.BaseEvents.LOGIN_FAILED);break;case manifesto_js_1.StatusCode.FORBIDDEN.toString():Auth1.publish(BaseEvents_1.BaseEvents.FORBIDDEN);break;case manifesto_js_1.StatusCode.RESTRICTED.toString():break;default:Auth1.publish(BaseEvents_1.BaseEvents.SHOW_MESSAGE,[error.message||error])}}))}))},Auth1.getCookieServiceUrl=function(service){return service.id+"?origin="+Auth1.getOrigin()},Auth1.openContentProviderInteraction=function(service){var cookieServiceUrl=Auth1.getCookieServiceUrl(service);return window.open(cookieServiceUrl)},Auth1.getOrigin=function(url){var urlHolder=window.location;return url&&((urlHolder=document.createElement("a")).href=url),urlHolder.protocol+"//"+urlHolder.hostname+(urlHolder.port?":"+urlHolder.port:"")},Auth1.userInteractedWithContentProvider=function(contentProviderWindow){return new Promise((function(resolve){var poll=window.setInterval((function(){contentProviderWindow.closed&&(window.clearInterval(poll),resolve(!0))}),500)}))},Auth1.handleMovedTemporarily=function(resource){return new Promise((function(resolve){Auth1.showDegradedMessage(resource),resource.isResponseHandled=!0,resolve()}))},Auth1.showDegradedMessage=function(resource){var informationArgs=new InformationArgs_1.InformationArgs(InformationType_1.InformationType.DEGRADED_RESOURCE,resource);Auth1.publish(BaseEvents_1.BaseEvents.SHOW_INFORMATION,[informationArgs])},Auth1.storeAccessToken=function(resource,token){return new Promise((function(resolve,reject){resource.tokenService?(Utils.Storage.set(resource.tokenService.id,token,token.expiresIn,new Utils.StorageType(Auth1.storageStrategy)),resolve()):reject("Token service not found")}))},Auth1.getStoredAccessToken=function(resource){return new Promise((function(resolve){var foundItems=[],item=null;if(resource.tokenService&&(item=Utils.Storage.get(resource.tokenService.id,new Utils.StorageType(Auth1.storageStrategy))),item)foundItems.push(item);else for(var domain=Utils.Urls.getUrlParts(resource.dataUri).hostname,items=Utils.Storage.getItems(new Utils.StorageType(Auth1.storageStrategy)),i=0;i<items.length;i++)(item=items[i]).key.includes(domain)&&foundItems.push(item);var foundToken=null;(foundItems=foundItems.sort((function(a,b){return a.expiresAt-b.expiresAt}))).length&&(foundToken=foundItems[foundItems.length-1].value),resolve(foundToken)}))},Auth1.getContentProviderInteraction=function(resource,service){return new Promise((function(resolve){resource.isResponseHandled&&!resource.authHoldingPage?(Auth1.showDegradedMessage(resource),resolve(null)):resource.authHoldingPage?(resource.authHoldingPage.location.href=Auth1.getCookieServiceUrl(service),resolve(resource.authHoldingPage)):Auth1.publish(BaseEvents_1.BaseEvents.SHOW_AUTH_DIALOGUE,[{service:service,closeCallback:function(){resolve(null)},confirmCallback:function(){var win=Auth1.openContentProviderInteraction(service);resolve(win)},cancelCallback:function(){resolve(null)}}])}))},Auth1.openTokenService=function(resource,tokenService){return new Promise((function(resolve,reject){var serviceOrigin=Auth1.getOrigin(tokenService.id),messageId=(new Date).getTime();Auth1.messages[messageId]={resolve:resolve,reject:reject,serviceOrigin:serviceOrigin,resource:resource},window.addEventListener("message",Auth1.receiveToken,!1);var tokenUrl=tokenService.id+"?messageId="+messageId+"&origin="+Auth1.getOrigin();$("#commsFrame").prop("src",tokenUrl);setTimeout((function(){Auth1.messages[messageId]&&(Auth1.messages[messageId].reject("Message unhandled after 5000ms, rejecting"),delete Auth1.messages[messageId])}),5e3)}))},Auth1.receiveToken=function(event){if(event.data.hasOwnProperty("messageId")){var message_1=Auth1.messages[event.data.messageId];message_1&&event.origin==message_1.serviceOrigin&&Auth1.storeAccessToken(message_1.resource,event.data).then((function(){message_1.resolve(event.data),delete Auth1.messages[event.data.messageId]}))}},Auth1.showOutOfOptionsMessages=function(resource,service){if(resource.status!=HTTPStatusCode.MOVED_TEMPORARILY){var errorMessage="";service.getFailureHeader()&&(errorMessage+="<p>"+service.getFailureHeader()+"</p>"),service.getFailureDescription()&&(errorMessage+=service.getFailureDescription()),Auth1.publish(BaseEvents_1.BaseEvents.SHOW_MESSAGE,[Utils_1.UVUtils.sanitize(errorMessage)])}},Auth1.messages={},Auth1}();exports.Auth1=Auth1}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-shared-module/Dialogue",["require","exports","./BaseView","./BaseEvents"],(function(require,exports,BaseView_1,BaseEvents_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Dialogue=function(_super){function Dialogue($element){var _this=_super.call(this,$element,!1,!1)||this;return _this.allowClose=!0,_this.isActive=!1,_this.isUnopened=!0,_this}return __extends(Dialogue,_super),Dialogue.prototype.create=function(){var _this=this;this.setConfig("dialogue"),_super.prototype.create.call(this),this.component.subscribe(BaseEvents_1.BaseEvents.CLOSE_ACTIVE_DIALOGUE,(function(){_this.isActive&&_this.allowClose&&_this.close()})),this.component.subscribe(BaseEvents_1.BaseEvents.ESCAPE,(function(){_this.isActive&&_this.allowClose&&_this.close()})),this.$top=$('<div class="top"></div>'),this.$element.append(this.$top),this.$closeButton=$('<button type="button" class="btn btn-default close" tabindex="0">'+this.content.close+"</button>"),this.$middle=$('<div class="middle"></div>'),this.$element.append(this.$middle),this.$content=$('<div class="content"></div>'),this.$middle.append(this.$content),this.$buttons=$('<div class="buttons"></div>'),this.$middle.append(this.$buttons),this.$bottom=$('<div class="bottom"></div>'),this.$element.append(this.$bottom),this.config.topCloseButtonEnabled?this.$top.append(this.$closeButton):this.$buttons.append(this.$closeButton),this.$closeButton.on("click",(function(e){e.preventDefault(),_this.close()})),this.returnFunc=this.close},Dialogue.prototype.enableClose=function(){this.allowClose=!0,this.$closeButton.show()},Dialogue.prototype.disableClose=function(){this.allowClose=!1,this.$closeButton.hide()},Dialogue.prototype.setDockedPosition=function(){var top=Math.floor(this.extension.height()-this.$element.outerHeight(!0)),left=0,arrowLeft=0,normalisedPos=0;if(this.$triggerButton){top=this.$triggerButton.offset().top-this.extension.$element.offset().top-this.$element.outerHeight(!0)+4;var h=this.$triggerButton.offset().left-this.extension.$element.offset().left;normalisedPos=Utils.Maths.normalise(h,0,this.extension.width()),left=Math.floor(this.extension.width()*normalisedPos-this.$element.width()*normalisedPos)+2,arrowLeft=Math.floor(this.$element.width()*normalisedPos)}this.$bottom.css("backgroundPosition",arrowLeft+"px 0px"),this.$element.css({top:top,left:left})},Dialogue.prototype.open=function(triggerButton){var _this=this;this.$element.attr("aria-hidden","false"),this.$element.show(),triggerButton?(this.$triggerButton=$(triggerButton),this.$bottom.show()):this.$bottom.hide(),this.isActive=!0,setTimeout((function(){var $defaultButton=_this.$element.find(".default");if($defaultButton.length)$defaultButton.focus();else{var $input=_this.$element.find("input:visible").first();$input.length?$input.focus():_this.$closeButton.focus()}}),1),this.component.publish(BaseEvents_1.BaseEvents.SHOW_OVERLAY),this.isUnopened&&(this.isUnopened=!1,this.afterFirstOpen()),this.resize()},Dialogue.prototype.afterFirstOpen=function(){},Dialogue.prototype.close=function(){this.isActive&&(this.$element.attr("aria-hidden","true"),this.$element.hide(),this.isActive=!1,this.component.publish(this.closeCommand),this.component.publish(BaseEvents_1.BaseEvents.HIDE_OVERLAY))},Dialogue.prototype.resize=function(){_super.prototype.resize.call(this),this.$element.css({top:Math.floor(this.extension.height()/2-this.$element.height()/2),left:Math.floor(this.extension.width()/2-this.$element.width()/2)})},Dialogue}(BaseView_1.BaseView);exports.Dialogue=Dialogue}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-dialogues-module/AuthDialogue",["require","exports","../uv-shared-module/BaseEvents","../uv-shared-module/Dialogue","../../Utils"],(function(require,exports,BaseEvents_1,Dialogue_1,Utils_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var AuthDialogue=function(_super){function AuthDialogue($element){return _super.call(this,$element)||this}return __extends(AuthDialogue,_super),AuthDialogue.prototype.create=function(){var _this=this;this.setConfig("authDialogue"),_super.prototype.create.call(this),this.openCommand=BaseEvents_1.BaseEvents.SHOW_AUTH_DIALOGUE,this.closeCommand=BaseEvents_1.BaseEvents.HIDE_AUTH_DIALOGUE,this.component.subscribe(this.openCommand,(function(e){_this.closeCallback=e.closeCallback,_this.confirmCallback=e.confirmCallback,_this.cancelCallback=e.cancelCallback,_this.service=e.service,_this.open()})),this.component.subscribe(this.closeCommand,(function(){_this.close()})),this.$title=$("<h1></h1>"),this.$content.append(this.$title),this.$content.append('            <div>                <p class="message scroll"></p>            </div>'),this.$buttons.prepend(this._buttonsToAdd()),this.$message=this.$content.find(".message"),this.$confirmButton=this.$buttons.find(".confirm"),this.$confirmButton.text(this.content.confirm),this.$cancelButton=this.$buttons.find(".close"),this.$cancelButton.text(this.content.cancel),this.$element.hide(),this.$confirmButton.on("click",(function(e){e.preventDefault(),_this.confirmCallback&&_this.confirmCallback(),_this.close()})),this.$cancelButton.on("click",(function(e){e.preventDefault(),_this.cancelCallback&&_this.cancelCallback(),_this.close()}))},AuthDialogue.prototype.open=function(){_super.prototype.open.call(this);var header=this.service.getHeader(),description=this.service.getDescription(),confirmLabel=this.service.getConfirmLabel();header&&this.$title.text(Utils_1.UVUtils.sanitize(header)),description&&(this.$message.html(Utils_1.UVUtils.sanitize(description)),this.$message.targetBlank(),this.$message.find("a").on("click",(function(){var url=$(this).attr("href");this.component.publish(BaseEvents_1.BaseEvents.EXTERNAL_LINK_CLICKED,url)}))),confirmLabel&&this.$confirmButton.text(Utils_1.UVUtils.sanitize(confirmLabel)),this.resize()},AuthDialogue.prototype.resize=function(){_super.prototype.resize.call(this)},AuthDialogue.prototype._buttonsToAdd=function(){var buttonsToAdd='<a class="confirm btn btn-primary" href="#" target="_parent"></a>';return this.config.topCloseButtonEnabled&&(buttonsToAdd+='<button class="close btn btn-default"></button>'),buttonsToAdd},AuthDialogue}(Dialogue_1.Dialogue);exports.AuthDialogue=AuthDialogue}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-dialogues-module/ClickThroughDialogue",["require","exports","../uv-shared-module/BaseEvents","../uv-shared-module/Dialogue"],(function(require,exports,BaseEvents_1,Dialogue_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ClickThroughDialogue=function(_super){function ClickThroughDialogue($element){return _super.call(this,$element)||this}return __extends(ClickThroughDialogue,_super),ClickThroughDialogue.prototype.create=function(){var _this=this;this.setConfig("clickThroughDialogue"),_super.prototype.create.call(this),this.openCommand=BaseEvents_1.BaseEvents.SHOW_CLICKTHROUGH_DIALOGUE,this.closeCommand=BaseEvents_1.BaseEvents.HIDE_CLICKTHROUGH_DIALOGUE,this.component.subscribe(this.openCommand,(function(params){_this.acceptCallback=params.acceptCallback,_this.resource=params.resource,_this.open()})),this.component.subscribe(this.closeCommand,(function(){_this.close()})),this.$title=$("<h1></h1>"),this.$content.append(this.$title),this.$content.append('            <div>                <p class="message scroll"></p>                <div class="buttons">                    <a class="acceptTerms btn btn-primary" href="#" target="_parent"></a>                </div>            </div>'),this.$message=this.$content.find(".message"),this.$acceptTermsButton=this.$content.find(".acceptTerms"),this.$acceptTermsButton.text("Accept Terms and Open"),this.$element.hide(),this.$acceptTermsButton.on("click",(function(e){e.preventDefault(),_this.close(),_this.component.publish(BaseEvents_1.BaseEvents.ACCEPT_TERMS),_this.acceptCallback&&_this.acceptCallback()}))},ClickThroughDialogue.prototype.open=function(){_super.prototype.open.call(this),this.resource.clickThroughService&&(this.$title.text(this.resource.clickThroughService.getProperty("label")),this.$message.html(this.resource.clickThroughService.getProperty("description")),this.$message.targetBlank()),this.$message.find("a").on("click",(function(){var url=$(this).attr("href");this.component.publish(BaseEvents_1.BaseEvents.EXTERNAL_LINK_CLICKED,url)})),this.resize()},ClickThroughDialogue.prototype.resize=function(){_super.prototype.resize.call(this)},ClickThroughDialogue}(Dialogue_1.Dialogue);exports.ClickThroughDialogue=ClickThroughDialogue}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-dialogues-module/LoginDialogue",["require","exports","../uv-shared-module/BaseEvents","../uv-shared-module/Dialogue"],(function(require,exports,BaseEvents_1,Dialogue_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var LoginDialogue=function(_super){function LoginDialogue($element){return _super.call(this,$element)||this}return __extends(LoginDialogue,_super),LoginDialogue.prototype.create=function(){var _this=this;this.setConfig("loginDialogue"),_super.prototype.create.call(this),this.openCommand=BaseEvents_1.BaseEvents.SHOW_LOGIN_DIALOGUE,this.closeCommand=BaseEvents_1.BaseEvents.HIDE_LOGIN_DIALOGUE,this.component.subscribe(this.openCommand,(function(e){_this.loginCallback=e.loginCallback,_this.logoutCallback=e.logoutCallback,_this.options=e.options,_this.resource=e.resource,_this.open()})),this.component.subscribe(this.closeCommand,(function(){_this.close()})),this.$title=$("<h1></h1>"),this.$content.append(this.$title),this.$content.append('            <div>                <p class="message scroll"></p>                <div class="buttons">                    <a class="logout btn btn-primary" href="#" target="_parent"></a>                    <a class="login btn btn-primary" href="#" target="_parent"></a>                    <a class="cancel btn btn-primary" href="#"></a>                </div>            </div>'),this.$message=this.$content.find(".message"),this.$loginButton=this.$content.find(".login"),this.$loginButton.text(this.content.login),this.$logoutButton=this.$content.find(".logout"),this.$logoutButton.text(this.content.logout),this.$cancelButton=this.$content.find(".cancel"),this.$cancelButton.text(this.content.cancel),this.$element.hide(),this.$loginButton.on("click",(function(e){e.preventDefault(),_this.close(),_this.loginCallback&&_this.loginCallback()})),this.$logoutButton.on("click",(function(e){e.preventDefault(),_this.close(),_this.logoutCallback&&_this.logoutCallback()})),this.$cancelButton.on("click",(function(e){e.preventDefault(),_this.close()})),this.updateLogoutButton()},LoginDialogue.prototype.open=function(){_super.prototype.open.call(this);var message="";this.resource.loginService&&(this.$title.text(this.resource.loginService.getProperty("label")),message=this.resource.loginService.getProperty("description")),this.options.warningMessage&&(message='<span class="warning">'+this.extension.data.config.content[this.options.warningMessage]+'</span><span class="description">'+message+"</span>"),this.updateLogoutButton(),this.$message.html(message),this.$message.targetBlank(),this.$message.find("a").on("click",(function(){var url=$(this).attr("href");this.component.publish(BaseEvents_1.BaseEvents.EXTERNAL_LINK_CLICKED,url)})),this.options.showCancelButton?this.$cancelButton.show():this.$cancelButton.hide(),this.resize()},LoginDialogue.prototype.updateLogoutButton=function(){this.extension.isLoggedIn?this.$logoutButton.show():this.$logoutButton.hide()},LoginDialogue.prototype.resize=function(){_super.prototype.resize.call(this)},LoginDialogue}(Dialogue_1.Dialogue);exports.LoginDialogue=LoginDialogue})),define("modules/uv-shared-module/StringValue",["require","exports"],(function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var StringValue=function(){function StringValue(value){this.value="",value&&(this.value=value.toLowerCase())}return StringValue.prototype.toString=function(){return this.value},StringValue}();exports.StringValue=StringValue}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-shared-module/MetricType",["require","exports","./StringValue"],(function(require,exports,StringValue_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MetricType=function(_super){function MetricType(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(MetricType,_super),MetricType.DESKTOP=new MetricType("desktop"),MetricType.MOBILELANDSCAPE=new MetricType("mobilelandscape"),MetricType.MOBILEPORTRAIT=new MetricType("mobileportrait"),MetricType.NONE=new MetricType("none"),MetricType.WATCH=new MetricType("watch"),MetricType}(StringValue_1.StringValue);exports.MetricType=MetricType}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-dialogues-module/RestrictedDialogue",["require","exports","../uv-shared-module/BaseEvents","../uv-shared-module/Dialogue"],(function(require,exports,BaseEvents_1,Dialogue_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var RestrictedDialogue=function(_super){function RestrictedDialogue($element){return _super.call(this,$element)||this}return __extends(RestrictedDialogue,_super),RestrictedDialogue.prototype.create=function(){var _this=this;this.setConfig("restrictedDialogue"),_super.prototype.create.call(this),this.openCommand=BaseEvents_1.BaseEvents.SHOW_RESTRICTED_DIALOGUE,this.closeCommand=BaseEvents_1.BaseEvents.HIDE_RESTRICTED_DIALOGUE,this.component.subscribe(this.openCommand,(function(e){_this.acceptCallback=e.acceptCallback,_this.options=e.options,_this.resource=e.resource,_this.open()})),this.component.subscribe(this.closeCommand,(function(){_this.close()})),this.$title=$("<h1></h1>"),this.$content.append(this.$title),this.$content.append('            <div>                <p class="message scroll"></p>                <div class="buttons">                    <a class="cancel btn btn-primary" href="#" target="_parent"></a>                </div>            </div>'),this.$message=this.$content.find(".message"),this.$message.targetBlank(),this.$cancelButton=this.$content.find(".cancel"),this.$cancelButton.text(this.content.cancel),this.$element.hide(),this.$cancelButton.on("click",(function(e){e.preventDefault(),_this.close()}))},RestrictedDialogue.prototype.open=function(){_super.prototype.open.call(this),this.isAccepted=!1;var message="";this.resource.restrictedService&&(this.$title.text(this.resource.restrictedService.getProperty("label")),message=this.resource.restrictedService.getProperty("description")),this.$message.html(message),this.$message.targetBlank(),this.$message.find("a").on("click",(function(){var url=$(this).attr("href");this.component.publish(BaseEvents_1.BaseEvents.EXTERNAL_LINK_CLICKED,url)})),this.resize()},RestrictedDialogue.prototype.close=function(){_super.prototype.close.call(this),!this.isAccepted&&this.acceptCallback&&(this.isAccepted=!0,this.acceptCallback())},RestrictedDialogue.prototype.resize=function(){_super.prototype.resize.call(this)},RestrictedDialogue}(Dialogue_1.Dialogue);exports.RestrictedDialogue=RestrictedDialogue}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-shared-module/GenericDialogue",["require","exports","./BaseEvents","./Dialogue"],(function(require,exports,BaseEvents_1,Dialogue_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var GenericDialogue=function(_super){function GenericDialogue($element){return _super.call(this,$element)||this}return __extends(GenericDialogue,_super),GenericDialogue.prototype.create=function(){var _this=this;this.setConfig("genericDialogue"),_super.prototype.create.call(this),this.openCommand=BaseEvents_1.BaseEvents.SHOW_GENERIC_DIALOGUE,this.closeCommand=BaseEvents_1.BaseEvents.HIDE_GENERIC_DIALOGUE,this.component.subscribe(this.openCommand,(function(params){_this.acceptCallback=params.acceptCallback,_this.showMessage(params)})),this.component.subscribe(this.closeCommand,(function(){_this.close()})),this.$message=$("<p></p>"),this.$content.append(this.$message),this.$acceptButton=$('\n          <button class="btn btn-primary accept default">\n            '+this.content.ok+"\n          </button>\n        "),this.$buttons.append(this.$acceptButton),this.$buttons.find(".close").hide(),this.$acceptButton.onPressed((function(){_this.accept()})),this.returnFunc=function(){_this.isActive&&_this.accept()},this.$element.hide()},GenericDialogue.prototype.accept=function(){this.component.publish(BaseEvents_1.BaseEvents.CLOSE_ACTIVE_DIALOGUE),this.acceptCallback&&this.acceptCallback()},GenericDialogue.prototype.showMessage=function(params){this.$message.html(params.message),params.buttonText?this.$acceptButton.text(params.buttonText):this.$acceptButton.text(this.content.ok),!1===params.allowClose&&this.disableClose(),this.open()},GenericDialogue.prototype.resize=function(){_super.prototype.resize.call(this)},GenericDialogue}(Dialogue_1.Dialogue);exports.GenericDialogue=GenericDialogue}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-shared-module/Shell",["require","exports","./BaseEvents","./BaseView","./GenericDialogue"],(function(require,exports,BaseEvents_1,BaseView_1,GenericDialogue_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Shell=function(_super){function Shell($element){return _super.call(this,$element,!0,!0)||this}return __extends(Shell,_super),Shell.prototype.create=function(){var _this=this;_super.prototype.create.call(this),this.component.subscribe(BaseEvents_1.BaseEvents.SHOW_OVERLAY,(function(){_this.$overlays.show()})),this.component.subscribe(BaseEvents_1.BaseEvents.HIDE_OVERLAY,(function(){_this.$overlays.hide()})),this.$headerPanel=$('<div class="headerPanel"></div>'),this.$element.append(this.$headerPanel),this.$mainPanel=$('<div class="mainPanel"></div>'),this.$element.append(this.$mainPanel),this.$centerPanel=$('<div class="centerPanel"></div>'),this.$mainPanel.append(this.$centerPanel),this.$leftPanel=$('<div class="leftPanel"></div>'),this.$mainPanel.append(this.$leftPanel),this.$rightPanel=$('<div class="rightPanel"></div>'),this.$mainPanel.append(this.$rightPanel),this.$footerPanel=$('<div class="footerPanel"></div>'),this.$element.append(this.$footerPanel),this.$mobileFooterPanel=$('<div class="mobileFooterPanel"></div>'),this.$element.append(this.$mobileFooterPanel),this.$overlays=$('<div class="overlays"></div>'),this.$element.append(this.$overlays),this.$genericDialogue=$('<div class="overlay genericDialogue" aria-hidden="true"></div>'),this.$overlays.append(this.$genericDialogue),this.$overlays.on("click",(function(e){$(e.target).hasClass("overlays")&&(e.preventDefault(),_this.component.publish(BaseEvents_1.BaseEvents.CLOSE_ACTIVE_DIALOGUE))})),new GenericDialogue_1.GenericDialogue(this.$genericDialogue)},Shell.prototype.resize=function(){var _this=this;_super.prototype.resize.call(this),setTimeout((function(){_this.$overlays.width(_this.extension.width()),_this.$overlays.height(_this.extension.height())}),1);var mainHeight=this.$element.height()-parseInt(this.$mainPanel.css("paddingTop"))-(this.$headerPanel.is(":visible")?this.$headerPanel.height():0)-(this.$footerPanel.is(":visible")?this.$footerPanel.height():0)-(this.$mobileFooterPanel.is(":visible")?this.$mobileFooterPanel.height():0);this.$mainPanel.height(mainHeight)},Shell}(BaseView_1.BaseView);exports.Shell=Shell})),define("SynchronousRequire",["require","exports"],(function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var SynchronousRequire=function(){function SynchronousRequire(){}return SynchronousRequire.load=function(deps,cb){for(var loaders=[],i=0;i<deps.length;i++){var depLoader=new DependencyLoader(i,deps[i],deps,cb);loaders.push(depLoader)}var sequence=Promise.resolve();return loaders.forEach((function(loader){sequence=sequence.then((function(){return loader.load()}))})),sequence},SynchronousRequire}();exports.SynchronousRequire=SynchronousRequire;var DependencyLoader=function(){function DependencyLoader(index,dep,deps,cb){this._dep=dep,this._deps=deps,this._cb=cb,this._index=index}return DependencyLoader.prototype.getDependencyIndex=function(dep){return this._deps.findIndex((function(el){return el.includes(dep)}))},DependencyLoader.prototype.load=function(){var that=this;return new Promise((function(resolve){requirejs([that._dep],(function(dep){that._cb(that._index,dep),resolve()}))}))},DependencyLoader}();exports.DependencyLoader=DependencyLoader})),define("modules/uv-shared-module/BaseExtension",["require","exports","@iiif/manifold","@iiif/vocabulary","../../Utils","./Auth09","./Auth1","../uv-dialogues-module/AuthDialogue","./BaseEvents","../uv-dialogues-module/ClickThroughDialogue","../uv-dialogues-module/LoginDialogue","./MetricType","../uv-dialogues-module/RestrictedDialogue","./Shell","../../SynchronousRequire"],(function(require,exports,manifold_1,vocabulary_1,Utils_1,Auth09_1,Auth1_1,AuthDialogue_1,BaseEvents_1,ClickThroughDialogue_1,LoginDialogue_1,MetricType_1,RestrictedDialogue_1,Shell_1,SynchronousRequire_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var BaseExtension=function(){function BaseExtension(){this.isCreated=!1,this.isLoggedIn=!1,this.metric=MetricType_1.MetricType.NONE,this.metrics=[],this.shifted=!1,this.tabbing=!1}return BaseExtension.prototype.create=function(){var _this=this,that=this;if(Auth09_1.Auth09.publish=this.component.publish.bind(this.component),Auth1_1.Auth1.publish=this.component.publish.bind(this.component),this.$element=$(this.component.options.target),this.$element.data("component",this.component),this.fire(BaseEvents_1.BaseEvents.CREATE,{data:this.data,settings:this.getSettings(),preview:this.getSharePreview()}),this._parseMetrics(),this._initLocales(),this.$element.empty(),this.$element.removeClass(),this.$element.addClass("uv"),this.data.locales&&this.$element.addClass(this.data.locales[0].name.toLowerCase()),this.$element.addClass(this.name),this.$element.addClass("browser-"+window.browserDetect.browser),this.$element.addClass("browser-version-"+window.browserDetect.version),this.$element.prop("tabindex",0),this.data.embedded&&this.$element.addClass("embedded"),this.isMobile()&&this.$element.addClass("mobile"),this.data.isLightbox&&this.$element.addClass("lightbox"),Utils.Documents.supportsFullscreen()&&this.$element.addClass("fullscreen-supported"),this.$element.on("mousemove",(function(e){_this.mouseX=e.pageX,_this.mouseY=e.pageY})),this.isFullScreen()&&this.$element.addClass("fullscreen"),!this.data.isReload){var visibilityProp=Utils.Documents.getHiddenProp();if(visibilityProp){var event_1=visibilityProp.replace(/[H|h]idden/,"")+"visibilitychange";document.addEventListener(event_1,(function(){Utils.Documents.isHidden()||_this.resize()}))}Utils.Bools.getBool(this.data.config.options.dropEnabled,!0)&&this.$element.on("drop",(function(e){e.preventDefault();var dropUrl=e.originalEvent.dataTransfer.getData("URL"),a=Utils.Urls.getUrlParts(dropUrl),iiifResourceUri=Utils.Urls.getQuerystringParameterFromString("manifest",a.search);if(iiifResourceUri||(iiifResourceUri=Utils.Urls.getQuerystringParameterFromString("collection",a.search)),iiifResourceUri){_this.fire(BaseEvents_1.BaseEvents.DROP,iiifResourceUri);var data={};data.iiifResourceUri=iiifResourceUri,_this.reload(data)}})),this.$element.on("dragover",(function(e){e.preventDefault()})),this.$element.on("keyup keydown",(function(e){_this.shifted=e.shiftKey,_this.tabbing=e.keyCode===KeyCodes.KeyDown.Tab})),this.$element.on("keydown",(function(e){var event=null,preventDefault=!0;e.ctrlKey||e.altKey||e.shiftKey||(e.keyCode===KeyCodes.KeyDown.Enter&&(event=BaseEvents_1.BaseEvents.RETURN,preventDefault=!1),e.keyCode===KeyCodes.KeyDown.Escape&&(event=BaseEvents_1.BaseEvents.ESCAPE),e.keyCode===KeyCodes.KeyDown.PageUp&&(event=BaseEvents_1.BaseEvents.PAGE_UP),e.keyCode===KeyCodes.KeyDown.PageDown&&(event=BaseEvents_1.BaseEvents.PAGE_DOWN),e.keyCode===KeyCodes.KeyDown.End&&(event=BaseEvents_1.BaseEvents.END),e.keyCode===KeyCodes.KeyDown.Home&&(event=BaseEvents_1.BaseEvents.HOME),e.keyCode!==KeyCodes.KeyDown.NumpadPlus&&171!==e.keyCode&&e.keyCode!==KeyCodes.KeyDown.Equals||(event=BaseEvents_1.BaseEvents.PLUS,preventDefault=!1),e.keyCode!==KeyCodes.KeyDown.NumpadMinus&&173!==e.keyCode&&e.keyCode!==KeyCodes.KeyDown.Dash||(event=BaseEvents_1.BaseEvents.MINUS,preventDefault=!1),that.useArrowKeysToNavigate()&&(e.keyCode===KeyCodes.KeyDown.LeftArrow&&(event=BaseEvents_1.BaseEvents.LEFT_ARROW),e.keyCode===KeyCodes.KeyDown.UpArrow&&(event=BaseEvents_1.BaseEvents.UP_ARROW),e.keyCode===KeyCodes.KeyDown.RightArrow&&(event=BaseEvents_1.BaseEvents.RIGHT_ARROW),e.keyCode===KeyCodes.KeyDown.DownArrow&&(event=BaseEvents_1.BaseEvents.DOWN_ARROW))),event&&(preventDefault&&e.preventDefault(),_this.component.publish(event))}))}this.component.subscribe(BaseEvents_1.BaseEvents.EXIT_FULLSCREEN,(function(){_this.isOverlayActive()&&_this.component.publish(BaseEvents_1.BaseEvents.ESCAPE),_this.component.publish(BaseEvents_1.BaseEvents.ESCAPE),_this.component.publish(BaseEvents_1.BaseEvents.RESIZE)})),this.$element.append('<a href="/" id="top"></a>'),this.$element.append('<iframe id="commsFrame" style="display:none"></iframe>'),this.component.subscribe(BaseEvents_1.BaseEvents.ACCEPT_TERMS,(function(){_this.fire(BaseEvents_1.BaseEvents.ACCEPT_TERMS)})),this.component.subscribe(BaseEvents_1.BaseEvents.LOGIN_FAILED,(function(){_this.fire(BaseEvents_1.BaseEvents.LOGIN_FAILED),_this.showMessage(_this.data.config.content.authorisationFailedMessage)})),this.component.subscribe(BaseEvents_1.BaseEvents.LOGIN,(function(){_this.isLoggedIn=!0,_this.fire(BaseEvents_1.BaseEvents.LOGIN)})),this.component.subscribe(BaseEvents_1.BaseEvents.LOGOUT,(function(){_this.isLoggedIn=!1,_this.fire(BaseEvents_1.BaseEvents.LOGOUT)})),this.component.subscribe(BaseEvents_1.BaseEvents.BOOKMARK,(function(){_this.bookmark(),_this.fire(BaseEvents_1.BaseEvents.BOOKMARK)})),this.component.subscribe(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGE_FAILED,(function(){_this.fire(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGE_FAILED)})),this.component.subscribe(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,(function(canvasIndex){_this.data.canvasIndex=canvasIndex,_this.lastCanvasIndex=_this.helper.canvasIndex,_this.helper.canvasIndex=canvasIndex,_this.fire(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,_this.data.canvasIndex)})),this.component.subscribe(BaseEvents_1.BaseEvents.CLICKTHROUGH,(function(){_this.fire(BaseEvents_1.BaseEvents.CLICKTHROUGH)})),this.component.subscribe(BaseEvents_1.BaseEvents.CLOSE_ACTIVE_DIALOGUE,(function(){_this.fire(BaseEvents_1.BaseEvents.CLOSE_ACTIVE_DIALOGUE)})),this.component.subscribe(BaseEvents_1.BaseEvents.CLOSE_LEFT_PANEL,(function(){_this.fire(BaseEvents_1.BaseEvents.CLOSE_LEFT_PANEL),_this.resize()})),this.component.subscribe(BaseEvents_1.BaseEvents.CLOSE_RIGHT_PANEL,(function(){_this.fire(BaseEvents_1.BaseEvents.CLOSE_RIGHT_PANEL),_this.resize()})),this.component.subscribe(BaseEvents_1.BaseEvents.COLLECTION_INDEX_CHANGED,(function(collectionIndex){_this.data.collectionIndex=collectionIndex,_this.fire(BaseEvents_1.BaseEvents.COLLECTION_INDEX_CHANGED,_this.data.collectionIndex)})),this.component.subscribe(BaseEvents_1.BaseEvents.CREATED,(function(){_this.isCreated=!0,_this.fire(BaseEvents_1.BaseEvents.CREATED)})),this.component.subscribe(BaseEvents_1.BaseEvents.DOWN_ARROW,(function(){_this.fire(BaseEvents_1.BaseEvents.DOWN_ARROW)})),this.component.subscribe(BaseEvents_1.BaseEvents.DOWNLOAD,(function(obj){_this.fire(BaseEvents_1.BaseEvents.DOWNLOAD,obj)})),this.component.subscribe(BaseEvents_1.BaseEvents.END,(function(){_this.fire(BaseEvents_1.BaseEvents.END)})),this.component.subscribe(BaseEvents_1.BaseEvents.ESCAPE,(function(){_this.fire(BaseEvents_1.BaseEvents.ESCAPE),_this.isFullScreen()&&!_this.isOverlayActive()&&_this.component.publish(BaseEvents_1.BaseEvents.TOGGLE_FULLSCREEN)})),this.component.subscribe(BaseEvents_1.BaseEvents.EXTERNAL_LINK_CLICKED,(function(url){_this.fire(BaseEvents_1.BaseEvents.EXTERNAL_LINK_CLICKED,url)})),this.component.subscribe(BaseEvents_1.BaseEvents.FEEDBACK,(function(){_this.feedback()})),this.component.subscribe(BaseEvents_1.BaseEvents.FORBIDDEN,(function(){_this.fire(BaseEvents_1.BaseEvents.FORBIDDEN),_this.component.publish(BaseEvents_1.BaseEvents.OPEN_EXTERNAL_RESOURCE)})),this.component.subscribe(BaseEvents_1.BaseEvents.HIDE_DOWNLOAD_DIALOGUE,(function(){_this.fire(BaseEvents_1.BaseEvents.HIDE_DOWNLOAD_DIALOGUE)})),this.component.subscribe(BaseEvents_1.BaseEvents.HIDE_EMBED_DIALOGUE,(function(){_this.fire(BaseEvents_1.BaseEvents.HIDE_EMBED_DIALOGUE)})),this.component.subscribe(BaseEvents_1.BaseEvents.HIDE_EXTERNALCONTENT_DIALOGUE,(function(){_this.fire(BaseEvents_1.BaseEvents.HIDE_EXTERNALCONTENT_DIALOGUE)})),this.component.subscribe(BaseEvents_1.BaseEvents.HIDE_GENERIC_DIALOGUE,(function(){_this.fire(BaseEvents_1.BaseEvents.HIDE_GENERIC_DIALOGUE)})),this.component.subscribe(BaseEvents_1.BaseEvents.HIDE_HELP_DIALOGUE,(function(){_this.fire(BaseEvents_1.BaseEvents.HIDE_HELP_DIALOGUE)})),this.component.subscribe(BaseEvents_1.BaseEvents.HIDE_INFORMATION,(function(){_this.fire(BaseEvents_1.BaseEvents.HIDE_INFORMATION)})),this.component.subscribe(BaseEvents_1.BaseEvents.HIDE_LOGIN_DIALOGUE,(function(){_this.fire(BaseEvents_1.BaseEvents.HIDE_LOGIN_DIALOGUE)})),this.component.subscribe(BaseEvents_1.BaseEvents.HIDE_OVERLAY,(function(){_this.fire(BaseEvents_1.BaseEvents.HIDE_OVERLAY)})),this.component.subscribe(BaseEvents_1.BaseEvents.HIDE_RESTRICTED_DIALOGUE,(function(){_this.fire(BaseEvents_1.BaseEvents.HIDE_RESTRICTED_DIALOGUE)})),this.component.subscribe(BaseEvents_1.BaseEvents.HIDE_SETTINGS_DIALOGUE,(function(){_this.fire(BaseEvents_1.BaseEvents.HIDE_SETTINGS_DIALOGUE)})),this.component.subscribe(BaseEvents_1.BaseEvents.HOME,(function(){_this.fire(BaseEvents_1.BaseEvents.HOME)})),this.component.subscribe(BaseEvents_1.BaseEvents.LEFT_ARROW,(function(){_this.fire(BaseEvents_1.BaseEvents.LEFT_ARROW)})),this.component.subscribe(BaseEvents_1.BaseEvents.LEFTPANEL_COLLAPSE_FULL_FINISH,(function(){_this.fire(BaseEvents_1.BaseEvents.LEFTPANEL_COLLAPSE_FULL_FINISH)})),this.component.subscribe(BaseEvents_1.BaseEvents.LEFTPANEL_COLLAPSE_FULL_START,(function(){_this.fire(BaseEvents_1.BaseEvents.LEFTPANEL_COLLAPSE_FULL_START)})),this.component.subscribe(BaseEvents_1.BaseEvents.LEFTPANEL_EXPAND_FULL_FINISH,(function(){_this.fire(BaseEvents_1.BaseEvents.LEFTPANEL_EXPAND_FULL_FINISH)})),this.component.subscribe(BaseEvents_1.BaseEvents.LEFTPANEL_EXPAND_FULL_START,(function(){_this.fire(BaseEvents_1.BaseEvents.LEFTPANEL_EXPAND_FULL_START)})),this.component.subscribe(BaseEvents_1.BaseEvents.LOAD_FAILED,(function(){_this.fire(BaseEvents_1.BaseEvents.LOAD_FAILED),null==!that.lastCanvasIndex&&that.lastCanvasIndex!==that.helper.canvasIndex&&_this.component.publish(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,that.lastCanvasIndex)})),this.component.subscribe(BaseEvents_1.BaseEvents.MANIFEST_INDEX_CHANGED,(function(manifestIndex){_this.data.manifestIndex=manifestIndex,_this.fire(BaseEvents_1.BaseEvents.MANIFEST_INDEX_CHANGED,_this.data.manifestIndex)})),this.component.subscribe(BaseEvents_1.BaseEvents.NOT_FOUND,(function(){_this.fire(BaseEvents_1.BaseEvents.NOT_FOUND)})),this.component.subscribe(BaseEvents_1.BaseEvents.OPEN,(function(){_this.fire(BaseEvents_1.BaseEvents.OPEN);var openUri=Utils.Strings.format(_this.data.config.options.openTemplate,_this.helper.manifestUri);window.open(openUri)})),this.component.subscribe(BaseEvents_1.BaseEvents.OPEN_LEFT_PANEL,(function(){_this.fire(BaseEvents_1.BaseEvents.OPEN_LEFT_PANEL),_this.resize()})),this.component.subscribe(BaseEvents_1.BaseEvents.OPEN_EXTERNAL_RESOURCE,(function(){_this.fire(BaseEvents_1.BaseEvents.OPEN_EXTERNAL_RESOURCE)})),this.component.subscribe(BaseEvents_1.BaseEvents.OPEN_RIGHT_PANEL,(function(){_this.fire(BaseEvents_1.BaseEvents.OPEN_RIGHT_PANEL),_this.resize()})),this.component.subscribe(BaseEvents_1.BaseEvents.PAGE_DOWN,(function(){_this.fire(BaseEvents_1.BaseEvents.PAGE_DOWN)})),this.component.subscribe(BaseEvents_1.BaseEvents.PAGE_UP,(function(){_this.fire(BaseEvents_1.BaseEvents.PAGE_UP)})),this.component.subscribe(BaseEvents_1.BaseEvents.RANGE_NOT_FOUND,(function(e,rangeId){_this.fire(BaseEvents_1.BaseEvents.RANGE_NOT_FOUND,rangeId)})),this.component.subscribe(BaseEvents_1.BaseEvents.RANGE_CHANGED,(function(range){range?(_this.data.rangeId=range.id,_this.helper.rangeId=range.id,_this.fire(BaseEvents_1.BaseEvents.RANGE_CHANGED,_this.data.rangeId,range)):(_this.data.rangeId=void 0,_this.helper.rangeId=void 0,_this.fire(BaseEvents_1.BaseEvents.RANGE_CHANGED,null))})),this.component.subscribe(BaseEvents_1.BaseEvents.RESOURCE_DEGRADED,(function(resource){_this.fire(BaseEvents_1.BaseEvents.RESOURCE_DEGRADED),Auth09_1.Auth09.handleDegraded(resource)})),this.component.subscribe(BaseEvents_1.BaseEvents.RETURN,(function(){_this.fire(BaseEvents_1.BaseEvents.RETURN)})),this.component.subscribe(BaseEvents_1.BaseEvents.RIGHT_ARROW,(function(){_this.fire(BaseEvents_1.BaseEvents.RIGHT_ARROW)})),this.component.subscribe(BaseEvents_1.BaseEvents.RIGHTPANEL_COLLAPSE_FULL_FINISH,(function(){_this.fire(BaseEvents_1.BaseEvents.RIGHTPANEL_COLLAPSE_FULL_FINISH)})),this.component.subscribe(BaseEvents_1.BaseEvents.RIGHTPANEL_COLLAPSE_FULL_START,(function(){_this.fire(BaseEvents_1.BaseEvents.RIGHTPANEL_COLLAPSE_FULL_START)})),this.component.subscribe(BaseEvents_1.BaseEvents.RIGHTPANEL_EXPAND_FULL_FINISH,(function(){_this.fire(BaseEvents_1.BaseEvents.RIGHTPANEL_EXPAND_FULL_FINISH)})),this.component.subscribe(BaseEvents_1.BaseEvents.RIGHTPANEL_EXPAND_FULL_START,(function(){_this.fire(BaseEvents_1.BaseEvents.RIGHTPANEL_EXPAND_FULL_START)})),this.component.subscribe(BaseEvents_1.BaseEvents.SEQUENCE_INDEX_CHANGED,(function(sequenceIndex){_this.data.sequenceIndex=sequenceIndex,_this.fire(BaseEvents_1.BaseEvents.SEQUENCE_INDEX_CHANGED,_this.data.sequenceIndex)})),this.component.subscribe(BaseEvents_1.BaseEvents.SETTINGS_CHANGED,(function(args){_this.fire(BaseEvents_1.BaseEvents.SETTINGS_CHANGED,args)})),this.component.subscribe(BaseEvents_1.BaseEvents.SHOW_DOWNLOAD_DIALOGUE,(function(){_this.fire(BaseEvents_1.BaseEvents.SHOW_DOWNLOAD_DIALOGUE)})),this.component.subscribe(BaseEvents_1.BaseEvents.SHOW_EMBED_DIALOGUE,(function(){_this.fire(BaseEvents_1.BaseEvents.SHOW_EMBED_DIALOGUE)})),this.component.subscribe(BaseEvents_1.BaseEvents.SHOW_EXTERNALCONTENT_DIALOGUE,(function(){_this.fire(BaseEvents_1.BaseEvents.SHOW_EXTERNALCONTENT_DIALOGUE)})),this.component.subscribe(BaseEvents_1.BaseEvents.SHOW_GENERIC_DIALOGUE,(function(){_this.fire(BaseEvents_1.BaseEvents.SHOW_GENERIC_DIALOGUE)})),this.component.subscribe(BaseEvents_1.BaseEvents.SHOW_HELP_DIALOGUE,(function(){_this.fire(BaseEvents_1.BaseEvents.SHOW_HELP_DIALOGUE)})),this.component.subscribe(BaseEvents_1.BaseEvents.SHOW_INFORMATION,(function(){_this.fire(BaseEvents_1.BaseEvents.SHOW_INFORMATION)})),this.component.subscribe(BaseEvents_1.BaseEvents.SHOW_LOGIN_DIALOGUE,(function(){_this.fire(BaseEvents_1.BaseEvents.SHOW_LOGIN_DIALOGUE)})),this.component.subscribe(BaseEvents_1.BaseEvents.SHOW_CLICKTHROUGH_DIALOGUE,(function(){_this.fire(BaseEvents_1.BaseEvents.SHOW_CLICKTHROUGH_DIALOGUE)})),this.component.subscribe(BaseEvents_1.BaseEvents.SHOW_MESSAGE,(function(message){_this.showMessage(message)})),this.component.subscribe(BaseEvents_1.BaseEvents.SHOW_RESTRICTED_DIALOGUE,(function(){_this.fire(BaseEvents_1.BaseEvents.SHOW_RESTRICTED_DIALOGUE)})),this.component.subscribe(BaseEvents_1.BaseEvents.SHOW_OVERLAY,(function(){_this.fire(BaseEvents_1.BaseEvents.SHOW_OVERLAY)})),this.component.subscribe(BaseEvents_1.BaseEvents.SHOW_SETTINGS_DIALOGUE,(function(){_this.fire(BaseEvents_1.BaseEvents.SHOW_SETTINGS_DIALOGUE)})),this.component.subscribe(BaseEvents_1.BaseEvents.INFO_DISPLAYED,(function(e,message){_this.fire(BaseEvents_1.BaseEvents.INFO_DISPLAYED,message)})),this.component.subscribe(BaseEvents_1.BaseEvents.SHOW_TERMS_OF_USE,(function(){_this.fire(BaseEvents_1.BaseEvents.SHOW_TERMS_OF_USE);var terms=_this.helper.getLicense();if(!terms){var requiredStatement=_this.helper.getRequiredStatement();requiredStatement&&requiredStatement.value&&(terms=requiredStatement.value)}terms&&_this.showMessage(terms)})),this.component.subscribe(BaseEvents_1.BaseEvents.THUMB_SELECTED,(function(thumb){_this.fire(BaseEvents_1.BaseEvents.THUMB_SELECTED,thumb.index)})),this.component.subscribe(BaseEvents_1.BaseEvents.TOGGLE_FULLSCREEN,(function(){$("#top").focus(),_this.component.isFullScreen=!_this.component.isFullScreen,_this.component.isFullScreen?_this.$element.addClass("fullscreen"):_this.$element.removeClass("fullscreen"),_this.fire(BaseEvents_1.BaseEvents.TOGGLE_FULLSCREEN,{isFullScreen:_this.component.isFullScreen,overrideFullScreen:_this.data.config.options.overrideFullScreen})})),this.component.subscribe(BaseEvents_1.BaseEvents.UP_ARROW,(function(){_this.fire(BaseEvents_1.BaseEvents.UP_ARROW)})),this.component.subscribe(BaseEvents_1.BaseEvents.UPDATE_SETTINGS,(function(){_this.fire(BaseEvents_1.BaseEvents.UPDATE_SETTINGS)})),this.component.subscribe(BaseEvents_1.BaseEvents.VIEW_FULL_TERMS,(function(){_this.fire(BaseEvents_1.BaseEvents.VIEW_FULL_TERMS)})),this.component.subscribe(BaseEvents_1.BaseEvents.WINDOW_UNLOAD,(function(){_this.fire(BaseEvents_1.BaseEvents.WINDOW_UNLOAD)})),this.shell=new Shell_1.Shell(this.$element),this.getDependencies((function(deps){_this.loadDependencies(deps)}))},BaseExtension.prototype.createModules=function(){this.$authDialogue=$('<div class="overlay auth" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$authDialogue),this.authDialogue=new AuthDialogue_1.AuthDialogue(this.$authDialogue),this.$clickThroughDialogue=$('<div class="overlay clickthrough" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$clickThroughDialogue),this.clickThroughDialogue=new ClickThroughDialogue_1.ClickThroughDialogue(this.$clickThroughDialogue),this.$restrictedDialogue=$('<div class="overlay login" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$restrictedDialogue),this.restrictedDialogue=new RestrictedDialogue_1.RestrictedDialogue(this.$restrictedDialogue),this.$loginDialogue=$('<div class="overlay login" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$loginDialogue),this.loginDialogue=new LoginDialogue_1.LoginDialogue(this.$loginDialogue)},BaseExtension.prototype.modulesCreated=function(){},BaseExtension.prototype.getDependencies=function(cb){var that=this,depsUri=this.data.root+"/lib/"+this.name+"-dependencies";$("script[data-requiremodule]").filter((function(){var attr=$(this).attr("data-requiremodule");return-1!==attr.indexOf(that.name)&&-1!==attr.indexOf("dependencies")})).length?cb(null):requirejs([depsUri],(function(getDeps){var canvas=that.helper.getCurrentCanvas(),mediaFormats=that.getMediaFormats(canvas),formats=[];mediaFormats&&mediaFormats.length&&(formats=mediaFormats.map((function(f){return f.getFormat().toString()})));var deps=getDeps(formats),baseUri=that.data.root+"/lib/";if(deps.sync)for(var i=0;i<deps.sync.length;i++){(dep=deps.sync[i]).startsWith("!")||(deps.sync[i]=baseUri+dep)}if(deps.async)for(i=0;i<deps.async.length;i++){var dep;(dep=deps.async[i]).startsWith("!")||(deps.async[i]=baseUri+dep)}cb(deps)}))},BaseExtension.prototype.loadDependencies=function(deps){var that=this;deps?deps.sync?SynchronousRequire_1.SynchronousRequire.load(deps.sync,that.dependencyLoaded).then((function(){deps.async?requirejs(deps.async,(function(){that.dependenciesLoaded(arguments)})):that.dependenciesLoaded()})):deps.async?requirejs(deps.async,(function(){that.dependenciesLoaded(arguments)})):that.dependenciesLoaded():that.dependenciesLoaded()},BaseExtension.prototype.dependencyLoaded=function(index,dep){},BaseExtension.prototype.dependenciesLoaded=function(){for(var _this=this,args=[],_i=0;_i<arguments.length;_i++)args[_i]=arguments[_i];this.createModules(),this.modulesCreated(),this.component.publish(BaseEvents_1.BaseEvents.RESIZE),setTimeout((function(){_this.render(),_this.component.publish(BaseEvents_1.BaseEvents.CREATED),_this._setDefaultFocus()}),1)},BaseExtension.prototype.render=function(){if(this.isCreated&&this.data.collectionIndex===this.helper.collectionIndex||this.component.publish(BaseEvents_1.BaseEvents.COLLECTION_INDEX_CHANGED,this.data.collectionIndex),this.isCreated&&this.data.manifestIndex===this.helper.manifestIndex||this.component.publish(BaseEvents_1.BaseEvents.MANIFEST_INDEX_CHANGED,this.data.manifestIndex),this.isCreated&&this.data.sequenceIndex===this.helper.sequenceIndex||this.component.publish(BaseEvents_1.BaseEvents.SEQUENCE_INDEX_CHANGED,this.data.sequenceIndex),this.isCreated&&this.data.canvasIndex===this.helper.canvasIndex||this.component.publish(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,this.data.canvasIndex),(!this.isCreated||this.data.rangeId!==this.helper.rangeId)&&this.data.rangeId){var range=this.helper.getRangeById(this.data.rangeId);range?this.component.publish(BaseEvents_1.BaseEvents.RANGE_CHANGED,range):this.component.publish(BaseEvents_1.BaseEvents.RANGE_NOT_FOUND,[this.data.rangeId])}this.isCreated||this.data.startTime&&this.component.publish(BaseEvents_1.BaseEvents.CURRENT_TIME_CHANGED,[this.data.startTime])},BaseExtension.prototype._setDefaultFocus=function(){var _this=this;setTimeout((function(){_this.data.config.options.allowStealFocus&&$("[tabindex=0]").focus()}),1)},BaseExtension.prototype.width=function(){return this.$element.width()},BaseExtension.prototype.height=function(){return this.$element.height()},BaseExtension.prototype.exitFullScreen=function(){this.component.publish(BaseEvents_1.BaseEvents.EXIT_FULLSCREEN)},BaseExtension.prototype.fire=function(name){for(var args=[],_i=1;_i<arguments.length;_i++)args[_i-1]=arguments[_i];this.component.fire(name,arguments[1])},BaseExtension.prototype.redirect=function(uri){this.fire(BaseEvents_1.BaseEvents.REDIRECT,uri)},BaseExtension.prototype.refresh=function(){this.fire(BaseEvents_1.BaseEvents.REFRESH,null)},BaseExtension.prototype._initLocales=function(){console.log("initLocales");var availableLocales=this.data.config.localisation.locales.slice(0),configuredLocales=this.data.locales,finalLocales=[];configuredLocales?(configuredLocales.forEach((function(configuredLocale){var match=availableLocales.filter((function(item){return item.name===configuredLocale.name}));if(match.length){var m=match[0];configuredLocale.label&&(m.label=configuredLocale.label),m.added=!0,finalLocales.push(m)}})),Utils.Bools.getBool(this.data.config.options.limitLocales,!1)||availableLocales.forEach((function(availableLocale){availableLocale.added||finalLocales.push(availableLocale),delete availableLocale.added})),this.data.locales=finalLocales):console.warn("No locales configured")},BaseExtension.prototype._parseMetrics=function(){var metrics=this.data.config.options.metrics;if(metrics)for(var i=0;i<metrics.length;i++){var m=metrics[i];"string"==typeof m.type&&(m.type=new MetricType_1.MetricType(m.type)),this.metrics.push(m)}},BaseExtension.prototype._updateMetric=function(){var _this=this;setTimeout((function(){for(var metricFound=!1,i=0;i<_this.metrics.length;i++){var metric=_this.metrics[i];_this.width()>=metric.minWidth&&_this.width()<=metric.maxWidth&&_this.height()>=metric.minHeight&&_this.height()<=metric.maxHeight&&(metricFound=!0,_this.metric!==metric.type&&(_this.metric=metric.type,_this.component.publish(BaseEvents_1.BaseEvents.METRIC_CHANGED)))}metricFound||_this.metric!==MetricType_1.MetricType.NONE&&(_this.metric=MetricType_1.MetricType.NONE,_this.component.publish(BaseEvents_1.BaseEvents.METRIC_CHANGED))}),1)},BaseExtension.prototype.resize=function(){this._updateMetric(),this.component.publish(BaseEvents_1.BaseEvents.RESIZE)},BaseExtension.prototype.reload=function(data){this.component.publish(BaseEvents_1.BaseEvents.RELOAD,data)},BaseExtension.prototype.isSeeAlsoEnabled=function(){return!1!==this.data.config.options.seeAlsoEnabled},BaseExtension.prototype.getShareUrl=function(){if(!this.data.embedded)return Utils.Documents.isInIFrame()?parent.document.location.href:document.location.href;if(this.helper.hasRelatedPage()){var related=this.helper.getRelated();return related&&related.length&&(related=related[0]),related["@id"]}return null},BaseExtension.prototype.getIIIFShareUrl=function(shareManifests){void 0===shareManifests&&(shareManifests=!1);var manifestUri=shareManifests&&this.helper.manifest?this.helper.manifest.id:this.helper.manifestUri;return manifestUri+"?manifest="+manifestUri},BaseExtension.prototype.addTimestamp=function(uri){return uri+"?t="+Utils.Dates.getTimeStamp()},BaseExtension.prototype.getDomain=function(){return Utils.Urls.getUrlParts(this.helper.manifestUri).host},BaseExtension.prototype.getAppUri=function(){var parts=Utils.Urls.getUrlParts(document.location.href),embedFile=this.data.config.modules.shareDialogue.options.embedFile||"uv.html",origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""),pathname=parts.pathname;pathname.startsWith("/")||(pathname="/"+pathname);var appUri=origin+(pathname=pathname.substr(0,pathname.lastIndexOf("/")+1)),root="";return Utils.Documents.isInIFrame()||((root=this.data.root||"").startsWith("./")&&(root=root.substr(2)),root&&!root.endsWith("/")&&(root+="/")),Utils_1.UVUtils.isValidUrl(root)?root+embedFile:appUri+root+embedFile},BaseExtension.prototype.getSettings=function(){if(Utils.Bools.getBool(this.data.config.options.saveUserSettings,!1)){var settings=Utils.Storage.get("uv.settings",Utils.StorageType.local);if(settings)return $.extend(this.data.config.options,settings.value)}return this.data.config.options},BaseExtension.prototype.updateSettings=function(settings){if(Utils.Bools.getBool(this.data.config.options.saveUserSettings,!1)){var storedSettings=Utils.Storage.get("uv.settings",Utils.StorageType.local);storedSettings&&(settings=$.extend(storedSettings.value,settings)),Utils.Storage.set("uv.settings",settings,31536e4,Utils.StorageType.local)}this.data.config.options=$.extend(this.data.config.options,settings)},BaseExtension.prototype.getLocale=function(){return this.helper.options.locale},BaseExtension.prototype.getSharePreview=function(){var title=this.helper.getLabel(),canvas=this.helper.getCurrentCanvas(),thumbnail=canvas.getProperty("thumbnail");return thumbnail&&"string"==typeof thumbnail||(thumbnail=canvas.getCanonicalImageUri(this.data.config.options.bookmarkThumbWidth)),{title:title,image:thumbnail}},BaseExtension.prototype.getPagedIndices=function(canvasIndex){return void 0===canvasIndex&&(canvasIndex=this.helper.canvasIndex),[canvasIndex]},BaseExtension.prototype.getCurrentCanvases=function(){for(var indices=this.getPagedIndices(this.helper.canvasIndex),canvases=[],i=0;i<indices.length;i++){var index=indices[i],canvas=this.helper.getCanvasByIndex(index);canvases.push(canvas)}return canvases},BaseExtension.prototype.getCanvasLabels=function(label){var indices=this.getPagedIndices(),labels="";if(1===indices.length)labels=label;else for(var i=1;i<=indices.length;i++)labels.length&&(labels+=","),labels+=label+" "+i;return labels},BaseExtension.prototype.getCurrentCanvasRange=function(){return this.helper.getCanvasRange(this.helper.getCurrentCanvas())},BaseExtension.prototype.getExternalResources=function(resources){var _this=this,indices=this.getPagedIndices(),resourcesToLoad=[];indices.forEach((function(index){var r,canvas=_this.helper.getCanvasByIndex(index);if(r=canvas.externalResource?canvas.externalResource:new manifold_1.ExternalResource(canvas,{authApiVersion:_this.data.config.options.authAPIVersion}),resources){var found=resources.find((function(f){return f.dataUri===r.dataUri}));found?resourcesToLoad.push(found):resourcesToLoad.push(r)}else resourcesToLoad.push(r)}));var storageStrategy=this.data.config.options.tokenStorage,authAPIVersion=this.data.config.options.authAPIVersion;return new Promise(1===authAPIVersion?function(resolve){var options={locale:_this.helper.options.locale};Auth1_1.Auth1.loadExternalResources(resourcesToLoad,storageStrategy,options).then((function(r){_this.resources=r.map((function(resource){return _this._prepareResourceData(resource)})),resolve(_this.resources)}))}:function(resolve){Auth09_1.Auth09.loadExternalResources(resourcesToLoad,storageStrategy).then((function(r){_this.resources=r.map((function(resource){return _this._prepareResourceData(resource)})),resolve(_this.resources)}))})},BaseExtension.prototype._prepareResourceData=function(resource){return resource.data.hasServiceDescriptor=resource.hasServiceDescriptor(),resource.hasServiceDescriptor()||(resource.data.id=resource.dataUri,resource.data.width=resource.width,resource.data.height=resource.height),resource.data.index=resource.index,Utils.Objects.toPlainObject(resource.data)},BaseExtension.prototype.getMediaFormats=function(canvas){var annotations=canvas.getContent();return annotations&&annotations.length?annotations[0].getBody():[{id:canvas.id,type:canvas.getType(),getFormat:function(){return""}}]},BaseExtension.prototype.viewCanvas=function(canvasIndex){this.helper.isCanvasIndexOutOfRange(canvasIndex)?this.showMessage(this.data.config.content.canvasIndexOutOfRange):this.component.publish(BaseEvents_1.BaseEvents.OPEN_EXTERNAL_RESOURCE)},BaseExtension.prototype.showMessage=function(message,acceptCallback,buttonText,allowClose){this.closeActiveDialogue(),this.component.publish(BaseEvents_1.BaseEvents.SHOW_GENERIC_DIALOGUE,{message:message,acceptCallback:acceptCallback,buttonText:buttonText,allowClose:allowClose})},BaseExtension.prototype.closeActiveDialogue=function(){this.component.publish(BaseEvents_1.BaseEvents.CLOSE_ACTIVE_DIALOGUE)},BaseExtension.prototype.isOverlayActive=function(){return this.shell.$overlays.is(":visible")},BaseExtension.prototype.isDesktopMetric=function(){return this.metric.toString()===MetricType_1.MetricType.DESKTOP.toString()},BaseExtension.prototype.isWatchMetric=function(){return this.metric.toString()===MetricType_1.MetricType.WATCH.toString()},BaseExtension.prototype.isCatchAllMetric=function(){return this.metric.toString()===MetricType_1.MetricType.NONE.toString()},BaseExtension.prototype.viewManifest=function(manifest){var data={};data.iiifResourceUri=this.helper.manifestUri,data.collectionIndex=this.helper.getCollectionIndex(manifest),data.manifestIndex=manifest.index,data.sequenceIndex=0,data.canvasIndex=0,this.reload(data)},BaseExtension.prototype.viewCollection=function(collection){var data={};data.iiifResourceUri=collection.parentCollection?collection.parentCollection.id:this.helper.manifestUri,data.collectionIndex=collection.index,data.manifestIndex=0,data.sequenceIndex=0,data.canvasIndex=0,this.reload(data)},BaseExtension.prototype.isFullScreen=function(){return this.component.isFullScreen},BaseExtension.prototype.isHeaderPanelEnabled=function(){return Utils.Bools.getBool(this.data.config.options.headerPanelEnabled,!0)},BaseExtension.prototype.isLeftPanelEnabled=function(){if(Utils.Bools.getBool(this.data.config.options.leftPanelEnabled,!0)){if(this.helper.hasParentCollection())return!0;if(this.helper.isMultiCanvas()){var viewingHint=this.helper.getViewingHint();if(!viewingHint||viewingHint&&viewingHint.toString()!==vocabulary_1.ViewingHint.CONTINUOUS.toString())return!0}}return!1},BaseExtension.prototype.isRightPanelEnabled=function(){return Utils.Bools.getBool(this.data.config.options.rightPanelEnabled,!0)},BaseExtension.prototype.isFooterPanelEnabled=function(){return Utils.Bools.getBool(this.data.config.options.footerPanelEnabled,!0)},BaseExtension.prototype.isMobile=function(){return $.browser.mobile},BaseExtension.prototype.useArrowKeysToNavigate=function(){return Utils.Bools.getBool(this.data.config.options.useArrowKeysToNavigate,!0)},BaseExtension.prototype.bookmark=function(){},BaseExtension.prototype.feedback=function(){this.fire(BaseEvents_1.BaseEvents.FEEDBACK,this.data)},BaseExtension.prototype.getAlternateLocale=function(){var alternateLocale=null;return this.data.locales&&this.data.locales.length>1&&(alternateLocale=this.data.locales[1]),alternateLocale},BaseExtension.prototype.getSerializedLocales=function(){return this.data.locales?this.serializeLocales(this.data.locales):null},BaseExtension.prototype.serializeLocales=function(locales){for(var serializedLocales="",i=0;i<locales.length;i++){var l=locales[i];i>0&&(serializedLocales+=","),serializedLocales+=l.name,l.label&&(serializedLocales+=":"+l.label)}return serializedLocales},BaseExtension.prototype.changeLocale=function(locale){var data={};if(this.data.locales){data.locales=this.data.locales.slice(0);var fromIndex=data.locales.findIndex((function(l){return l.name===locale}));data.locales.splice(0,0,data.locales.splice(fromIndex,1)[0]),this.reload(data)}},BaseExtension}();exports.BaseExtension=BaseExtension})),function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define("lib/GalleryComponent.js",[],e);else{var i=e();for(var n in i)("object"==typeof exports?exports:t)[n]=i[n]}}(window,(function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){t.exports=i(1)},function(t,e,i){"use strict";var n,o=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var a=i(2),r=i(3),s=i(4),l=function(t){function e(e){var i=t.call(this,e)||this;return i._data=i.data(),i._data=i.options.data,i._init(),i._resize(),i}return o(e,t),e.prototype._init=function(){var e=this;t.prototype._init.call(this),this._$element=$(this.el),this._$header=$('<div class="header"></div>'),this._$element.append(this._$header),this._$leftOptions=$('<div class="left"></div>'),this._$header.append(this._$leftOptions),this._$rightOptions=$('<div class="right"></div>'),this._$header.append(this._$rightOptions),this._$sizeDownButton=$('<input class="btn btn-default size-down" type="button" value="-" />'),this._$leftOptions.append(this._$sizeDownButton),this._$sizeRange=$('<input type="range" name="size" min="1" max="10" value="'+this.options.data.initialZoom+'" />'),this._$leftOptions.append(this._$sizeRange),this._$sizeUpButton=$('<input class="btn btn-default size-up" type="button" value="+" />'),this._$leftOptions.append(this._$sizeUpButton),this._$multiSelectOptions=$('<div class="multiSelectOptions"></div>'),this._$rightOptions.append(this._$multiSelectOptions),this._$selectAllButton=$('<div class="multiSelectAll"><input id="multiSelectAll" type="checkbox" tabindex="0" /><label for="multiSelectAll">'+this.options.data.content.selectAll+"</label></div>"),this._$multiSelectOptions.append(this._$selectAllButton),this._$selectAllButtonCheckbox=$(this._$selectAllButton.find("input:checkbox")),this._$selectButton=$('<a class="select" href="#">'+this.options.data.content.select+"</a>"),this._$multiSelectOptions.append(this._$selectButton),this._$main=$('<div class="main"></div>'),this._$element.append(this._$main),this._$thumbs=$('<div class="thumbs"></div>'),this._$main.append(this._$thumbs),this._$sizeDownButton.on("click",(function(){var t=Number(e._$sizeRange.val())-1;t>=Number(e._$sizeRange.attr("min"))&&(e._$sizeRange.val(t.toString()),e._$sizeRange.trigger("change"),e.fire(u.DECREASE_SIZE))})),this._$sizeUpButton.on("click",(function(){var t=Number(e._$sizeRange.val())+1;t<=Number(e._$sizeRange.attr("max"))&&(e._$sizeRange.val(t.toString()),e._$sizeRange.trigger("change"),e.fire(u.INCREASE_SIZE))})),this._$sizeRange.on("change",(function(){e._updateThumbs(),e._scrollToThumb(e._getSelectedThumbIndex())})),this._$selectAllButton.checkboxButton((function(t){var i=e._getMultiSelectState();i&&(t?i.selectAll(!0):i.selectAll(!1)),e.set(e.options.data)})),this._$selectButton.on("click",(function(){var t=e._getMultiSelectState();if(t){var i=t.getAllSelectedCanvases().map((function(t){return t.id}));e.fire(u.MULTISELECTION_MADE,i)}})),this._setRange(),$.templates({galleryThumbsTemplate:'\t\t\t\t<div class="{{:~galleryThumbClassName()}}" data-src="{{>uri}}" data-index="{{>index}}" data-visible="{{>visible}}" data-width="{{>width}}" data-height="{{>height}}" data-initialwidth="{{>initialWidth}}" data-initialheight="{{>initialHeight}}">\t\t\t\t\t\t<div class="wrap" style="width:{{>initialWidth}}px; height:{{>initialHeight}}px" data-link="class{merge:multiSelected toggle=\'multiSelected\'}">\t\t\t\t\t\t{^{if multiSelectEnabled}}\t\t\t\t\t\t\t\t<input id="thumb-checkbox-{{>id}}" type="checkbox" data-link="checked{:multiSelected ? \'checked\' : \'\'}" class="multiSelect" />\t\t\t\t\t\t{{/if}}\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="info">\t\t\t\t\t\t\t\t<span class="index" style="width:{{>initialWidth}}px">{{:#index + 1}}</span>\t\t\t\t\t\t\t\t<span class="label" style="width:{{>initialWidth}}px" title="{{>label}}">{{>label}}&nbsp;</span>\t\t\t\t\t\t\t\t<span class="searchResults" title="{{:~galleryThumbSearchResultsTitle()}}">{{>data.searchResults}}</span>\t\t\t\t\t\t</div>\t\t\t\t</div>'});var i=this;return $.views.helpers({galleryThumbClassName:function(){var t="thumb preLoad";return 0===this.data.index&&(t+=" first"),this.data.uri||(t+=" placeholder"),t},galleryThumbSearchResultsTitle:function(){var t=Number(this.data.data.searchResults);return t?t>1?s.Strings.format(i.options.data.content.searchResults,t.toString()):s.Strings.format(i.options.data.content.searchResult,t.toString()):null}}),this._$main.on("scroll",(function(){e._updateThumbs()}),this.options.data.scrollStopDuration),this.options.data.sizingEnabled||this._$sizeRange.hide(),!0},e.prototype.data=function(){return{chunkedResizingThreshold:400,content:{searchResult:"{0} search result",searchResults:"{0} search results",select:"Select",selectAll:"Select All"},debug:!1,helper:null,imageFadeInDuration:300,initialZoom:6,minLabelWidth:20,pageModeEnabled:!1,scrollStopDuration:100,searchResults:[],sizingEnabled:!0,thumbHeight:320,thumbLoadPadding:3,thumbWidth:200,viewingDirection:a.ViewingDirection.LEFT_TO_RIGHT}},e.prototype.set=function(t){if(this._data=Object.assign(this._data,t),this._data.helper&&void 0!==this._data.thumbWidth&&void 0!==this._data.thumbHeight&&(this._thumbs=this._data.helper.getThumbs(this._data.thumbWidth,this._data.thumbHeight)),this._data.viewingDirection&&(this._data.viewingDirection===a.ViewingDirection.BOTTOM_TO_TOP&&this._thumbs.reverse(),this._$thumbs.addClass(this._data.viewingDirection)),this._data.searchResults&&this._data.searchResults.length)for(var e=0;e<this._data.searchResults.length;e++){var i=this._data.searchResults[e],n=this._thumbs.filter((function(t){return t.index===i.canvasIndex}))[0],o=$.extend(!0,{},n.data);o.searchResults=i.rects.length,n.data=o}this._thumbsCache=null,this._createThumbs(),this._data.helper&&this.selectIndex(this._data.helper.canvasIndex);var r=this._getMultiSelectState();if(r&&r.isEnabled){for(this._$multiSelectOptions.show(),this._$thumbs.addClass("multiSelect"),e=0;e<r.canvases.length;e++){var s=r.canvases[e];n=this._getThumbByCanvas(s),this._setThumbMultiSelected(n,s.multiSelected)}for(e=0;e<r.ranges.length;e++)for(var l=r.ranges[e],u=this._getThumbsByRange(l),c=0;c<u.length;c++)n=u[c],this._setThumbMultiSelected(n,l.multiSelected)}else this._$multiSelectOptions.hide(),this._$thumbs.removeClass("multiSelect");this._update()},e.prototype._update=function(){var t=this._getMultiSelectState();t&&t.isEnabled&&(this._$selectAllButtonCheckbox.prop("checked",t.allSelected()),t.getAll().filter((function(t){return t.multiSelected})).length>0?this._$selectButton.show():this._$selectButton.hide())},e.prototype._getMultiSelectState=function(){return this._data.helper?this._data.helper.getMultiSelectState():null},e.prototype._createThumbs=function(){var t=this;if(this._thumbs){this._$thumbs.undelegate(".thumb","click"),this._$thumbs.empty();for(var e=this._getMultiSelectState(),i=[],n=0;n<this._thumbs.length;n++){var o=(c=this._thumbs[n]).width,a=c.height;c.initialWidth=o,i.push(a),c.multiSelectEnabled=!!e&&e.isEnabled}for(var r=s.Maths.median(i),l=0;l<this._thumbs.length;l++){var c;(c=this._thumbs[l]).initialHeight=r}if(this._$thumbs.link($.templates.galleryThumbsTemplate,this._thumbs),e&&!e.isEnabled)this._$thumbs.delegate(".thumb","click",(function(e){e.preventDefault();var i=$.view(this).data;t.fire(u.THUMB_SELECTED,i)}));else for(var h=this._$thumbs.find(".thumb"),d=function(){var t=p;$(h[f]).checkboxButton((function(e){var i=$.view(this).data;t._setThumbMultiSelected(i,!i.multiSelected);var n=t.options.data.helper.getCanvasRange(i.data),o=t._getMultiSelectState();o&&(n?o.selectRange(n,i.multiSelected):o.selectCanvas(i.data,i.multiSelected)),t._update(),t.fire(u.THUMB_MULTISELECTED,i)}))},p=this,f=0;f<h.length;f++)d()}},e.prototype._getThumbByCanvas=function(t){return this._thumbs.filter((function(e){return e.data.id===t.id}))[0]},e.prototype._sizeThumb=function(t){var e=t.data().initialwidth,i=t.data().initialheight,n=Number(e),o=Number(i),a=Math.floor(n*this._range),r=Math.floor(o*this._range),s=t.find(".wrap"),l=t.find(".label"),u=t.find(".index"),c=t.find(".searchResults"),h=a;this._data.searchResults&&this._data.searchResults.length&&(c.show(),h=a-c.outerWidth(),void 0!==this._data.minLabelWidth&&h<this._data.minLabelWidth?(c.hide(),h=a):c.show()),this._data.pageModeEnabled?(u.hide(),l.show()):(u.show(),l.hide()),s.outerWidth(a),s.outerHeight(r),u.outerWidth(h),l.outerWidth(h)},e.prototype._loadThumb=function(t,e){var i=t.find(".wrap");if(!i.hasClass("loading")&&!i.hasClass("loaded")){t.removeClass("preLoad");var n=t.attr("data-visible"),o=this._data.imageFadeInDuration||0;if("false"!==n){i.addClass("loading");var a=t.attr("data-src"),r=$('<img class="thumbImage" src="'+a+'" />');r.hide(),r.on("load",(function(){$(this).fadeIn(o,(function(){$(this).parent().switchClass("loading","loaded")}))})),i.prepend(r),e&&e(r)}else i.addClass("hidden")}},e.prototype._getThumbsByRange=function(t){var e=[];if(!this._data.helper)return e;for(var i=0;i<this._thumbs.length;i++){var n=this._thumbs[i],o=n.data,a=this._data.helper.getCanvasRange(o,t.path);a&&a.id===t.id&&e.push(n)}return e},e.prototype._updateThumbs=function(){var t=!!this._data.debug;this._setRange();var e=this._$main.scrollTop(),i=e+this._$main.height();t&&console.log("scrollTop %s, scrollBottom %s",e,i);for(var n=this._getAllThumbs(),o=0,a=0;a<n.length;a++){var r=$(n[a]),s=r.position().top,l=r.outerHeight(),u=s+l,c=l*this._data.thumbLoadPadding;s<=i+c&&u>=e-c?(o+=1,this._sizeThumb(r),r.addClass("insideScrollArea"),this._loadThumb(r)):r.removeClass("insideScrollArea")}t&&console.log("number of thumbs to update: "+o)},e.prototype._getSelectedThumbIndex=function(){return Number(this._$selectedThumb.data("index"))},e.prototype._getAllThumbs=function(){return this._thumbsCache||(this._thumbsCache=this._$thumbs.find(".thumb")),this._thumbsCache},e.prototype._getThumbByIndex=function(t){return this._$thumbs.find('[data-index="'+t+'"]')},e.prototype._scrollToThumb=function(t){var e=this._getThumbByIndex(t);this._$main.scrollTop(e.position().top)},e.prototype.selectIndex=function(t){this._thumbs&&this._thumbs.length&&(this._getAllThumbs().removeClass("selected"),this._$selectedThumb=this._getThumbByIndex(t),this._$selectedThumb.addClass("selected"),this._scrollToThumb(t),this._updateThumbs())},e.prototype._setRange=function(){var t=s.Maths.normalise(Number(this._$sizeRange.val()),0,10);this._range=s.Maths.clamp(t,.05,1)},e.prototype._setThumbMultiSelected=function(t,e){$.observable(t).setProperty("multiSelected",e)},e.prototype._resize=function(){},e}(r.BaseComponent);e.GalleryComponent=l;var u=function(){function t(){}return t.DECREASE_SIZE="decreaseSize",t.INCREASE_SIZE="increaseSize",t.MULTISELECTION_MADE="multiSelectionMade",t.THUMB_SELECTED="thumbSelected",t.THUMB_MULTISELECTED="thumbMultiSelected",t}()},function(t,e,i){"use strict";var n,o,a,r,s,l,u,c,h;i.r(e),i.d(e,"AnnotationMotivation",(function(){return n})),i.d(e,"Behavior",(function(){return o})),i.d(e,"ExternalResourceType",(function(){return a})),i.d(e,"IIIFResourceType",(function(){return r})),i.d(e,"MediaType",(function(){return s})),i.d(e,"RenderingFormat",(function(){return l})),i.d(e,"ServiceProfile",(function(){return u})),i.d(e,"ViewingDirection",(function(){return c})),i.d(e,"ViewingHint",(function(){return h})),function(t){t.BOOKMARKING="oa:bookmarking",t.CLASSIFYING="oa:classifying",t.COMMENTING="oa:commenting",t.DESCRIBING="oa:describing",t.EDITING="oa:editing",t.HIGHLIGHTING="oa:highlighting",t.IDENTIFYING="oa:identifying",t.LINKING="oa:linking",t.MODERATING="oa:moderating",t.PAINTING="sc:painting",t.QUESTIONING="oa:questioning",t.REPLYING="oa:replying",t.TAGGING="oa:tagging",t.TRANSCRIBING="oad:transcribing"}(n||(n={})),function(t){t.AUTO_ADVANCE="auto-advance",t.CONTINUOUS="continuous",t.FACING_PAGES="facing-pages",t.HIDDEN="hidden",t.INDIVIDUALS="individuals",t.MULTI_PART="multi-part",t.NO_NAV="no-nav",t.NON_PAGED="non-paged",t.PAGED="paged",t.REPEAT="repeat",t.SEQUENCE="sequence",t.THUMBNAIL_NAV="thumbnail-nav",t.TOGETHER="together",t.UNORDERED="unordered"}(o||(o={})),function(t){t.CANVAS="canvas",t.CHOICE="choice",t.CONTENT_AS_TEXT="contentastext",t.DOCUMENT="document",t.IMAGE="image",t.MOVING_IMAGE="movingimage",t.PDF="pdf",t.PHYSICAL_OBJECT="physicalobject",t.SOUND="sound",t.TEXTUALBODY="textualbody",t.VIDEO="video"}(a||(a={})),function(t){t.ANNOTATION="annotation",t.CANVAS="canvas",t.COLLECTION="collection",t.MANIFEST="manifest",t.RANGE="range",t.SEQUENCE="sequence"}(r||(r={})),function(t){t.AUDIO_MP4="audio/mp4",t.CORTO="application/corto",t.DRACO="application/draco",t.GLTF="model/gltf+json",t.JPG="image/jpeg",t.M3U8="application/vnd.apple.mpegurl",t.MP3="audio/mp3",t.MPEG_DASH="application/dash+xml",t.OBJ="text/plain",t.PDF="application/pdf",t.PLY="application/ply",t.THREEJS="application/vnd.threejs+json",t.VIDEO_MP4="video/mp4",t.WEBM="video/webm"}(s||(s={})),function(t){t.DOC="application/msword",t.DOCX="application/vnd.openxmlformats-officedocument.wordprocessingml.document",t.PDF="application/pdf"}(l||(l={})),function(t){t.IMAGE_0_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0",t.IMAGE_0_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1",t.IMAGE_0_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2",t.IMAGE_0_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0",t.IMAGE_0_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1",t.IMAGE_0_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2",t.IMAGE_1_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",t.IMAGE_1_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",t.IMAGE_1_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",t.IMAGE_1_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",t.IMAGE_1_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",t.IMAGE_1_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",t.IMAGE_1_LEVEL_0="http://iiif.io/api/image/1/level0.json",t.IMAGE_1_PROFILE_LEVEL_0="http://iiif.io/api/image/1/profiles/level0.json",t.IMAGE_1_LEVEL_1="http://iiif.io/api/image/1/level1.json",t.IMAGE_1_PROFILE_LEVEL_1="http://iiif.io/api/image/1/profiles/level1.json",t.IMAGE_1_LEVEL_2="http://iiif.io/api/image/1/level2.json",t.IMAGE_1_PROFILE_LEVEL_2="http://iiif.io/api/image/1/profiles/level2.json",t.IMAGE_2_LEVEL_0="http://iiif.io/api/image/2/level0.json",t.IMAGE_2_PROFILE_LEVEL_0="http://iiif.io/api/image/2/profiles/level0.json",t.IMAGE_2_LEVEL_1="http://iiif.io/api/image/2/level1.json",t.IMAGE_2_PROFILE_LEVEL_1="http://iiif.io/api/image/2/profiles/level1.json",t.IMAGE_2_LEVEL_2="http://iiif.io/api/image/2/level2.json",t.IMAGE_2_PROFILE_LEVEL_2="http://iiif.io/api/image/2/profiles/level2.json",t.AUTH_0_CLICK_THROUGH="http://iiif.io/api/auth/0/login/clickthrough",t.AUTH_0_LOGIN="http://iiif.io/api/auth/0/login",t.AUTH_0_LOGOUT="http://iiif.io/api/auth/0/logout",t.AUTH_0_RESTRICTED="http://iiif.io/api/auth/0/login/restricted",t.AUTH_0_TOKEN="http://iiif.io/api/auth/0/token",t.AUTH_1_CLICK_THROUGH="http://iiif.io/api/auth/1/clickthrough",t.AUTH_1_EXTERNAL="http://iiif.io/api/auth/1/external",t.AUTH_1_KIOSK="http://iiif.io/api/auth/1/kiosk",t.AUTH_1_LOGIN="http://iiif.io/api/auth/1/login",t.AUTH_1_LOGOUT="http://iiif.io/api/auth/1/logout",t.AUTH_1_PROBE="http://iiif.io/api/auth/1/probe",t.AUTH_1_TOKEN="http://iiif.io/api/auth/1/token",t.SEARCH_0="http://iiif.io/api/search/0/search",t.SEARCH_0_AUTO_COMPLETE="http://iiif.io/api/search/0/autocomplete",t.SEARCH_1="http://iiif.io/api/search/1/search",t.SEARCH_1_AUTO_COMPLETE="http://iiif.io/api/search/1/autocomplete",t.TRACKING_EXTENSIONS="http://universalviewer.io/tracking-extensions-profile",t.UI_EXTENSIONS="http://universalviewer.io/ui-extensions-profile",t.PRINT_EXTENSIONS="http://universalviewer.io/print-extensions-profile",t.SHARE_EXTENSIONS="http://universalviewer.io/share-extensions-profile",t.OTHER_MANIFESTATIONS="http://iiif.io/api/otherManifestations.json",t.IXIF="http://wellcomelibrary.org/ld/ixif/0/alpha.json"}(u||(u={})),function(t){t.BOTTOM_TO_TOP="bottom-to-top",t.LEFT_TO_RIGHT="left-to-right",t.RIGHT_TO_LEFT="right-to-left",t.TOP_TO_BOTTOM="top-to-bottom"}(c||(c={})),function(t){t.CONTINUOUS="continuous",t.INDIVIDUALS="individuals",t.NON_PAGED="non-paged",t.PAGED="paged",t.TOP="top"}(h||(h={}))},function(t,e,i){"use strict";i.r(e),i.d(e,"BaseComponent",(function(){return n}));var n=function(){function t(t){this.options=t,this.options.data=Object.assign({},this.data(),t.data)}return t.prototype._init=function(){return this.el=this.options.target,this.el?(this.el.innerHTML="",!0):(console.warn("element not found"),!1)},t.prototype.data=function(){return{}},t.prototype.on=function(t,e,i){var n=this._e||(this._e={});(n[t]||(n[t]=[])).push({fn:e,ctx:i})},t.prototype.fire=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];for(var n=[].slice.call(arguments,1),o=((this._e||(this._e={}))[t]||[]).slice(),a=0,r=o.length;a<r;a++)o[a].fn.apply(o[a].ctx,n)},t.prototype._resize=function(){},t.prototype.set=function(t){},t}()},function(t,e,i){"use strict";i.r(e),i.d(e,"Async",(function(){return o})),i.d(e,"Bools",(function(){return a})),i.d(e,"Clipboard",(function(){return r})),i.d(e,"Colors",(function(){return s})),i.d(e,"Dates",(function(){return l})),i.d(e,"Device",(function(){return u})),i.d(e,"Documents",(function(){return c})),i.d(e,"Events",(function(){return h})),i.d(e,"Files",(function(){return d})),i.d(e,"Keyboard",(function(){return p})),i.d(e,"Maths",(function(){return f})),i.d(e,"Size",(function(){return m})),i.d(e,"Dimensions",(function(){return _})),i.d(e,"Numbers",(function(){return g})),i.d(e,"Objects",(function(){return E})),i.d(e,"Storage",(function(){return b})),i.d(e,"StorageItem",(function(){return v})),i.d(e,"StorageType",(function(){return n})),i.d(e,"Strings",(function(){return S})),i.d(e,"Urls",(function(){return T}));var n,o=function(){function t(){}return t.waitFor=function(e,i,n,o,a,r){o||(o=200),a||(a=100),r||(r=0),(r+=1)>a?n&&n():e()?i():setTimeout((function(){t.waitFor(e,i,n,o,a,r)}),o)},t}(),a=function(){function t(){}return t.getBool=function(t,e){return null==t?e:t},t}(),r=function(){function t(){}return t.supportsCopy=function(){return document.queryCommandSupported&&document.queryCommandSupported("copy")},t.copy=function(e){e=t.convertBrToNewLine(e);var i=document.createElement("textarea");i.value=e,t.hideButKeepEnabled(i),document.body.appendChild(i),i.focus(),i.select(),document.execCommand("copy"),document.body.removeChild(i)},t.hideButKeepEnabled=function(t){t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="2em",t.style.height="2em",t.style.padding="0",t.style.border="none",t.style.outline="none",t.style.boxShadow="none",t.style.background="transparent"},t.convertBrToNewLine=function(t){return t.replace(/<br\s*[\/]?>/gi,"\n")},t}(),s=function(){function t(){}return t.float32ColorToARGB=function(t){return[(4278190080&t)>>>24,(16711680&t)>>>16,(65280&t)>>>8,255&t]},t._componentToHex=function(t){var e=t.toString(16);return 1==e.length?"0"+e:e},t.rgbToHexString=function(e){return t.coalesce(e),"#"+t._componentToHex(e[0])+t._componentToHex(e[1])+t._componentToHex(e[2])},t.argbToHexString=function(e){return"#"+t._componentToHex(e[0])+t._componentToHex(e[1])+t._componentToHex(e[2])+t._componentToHex(e[3])},t.coalesce=function(t){for(var e=1;e<t.length;e++)void 0===t[e]&&(t[e]=t[e-1])},t}(),l=function(){function t(){}return t.getTimeStamp=function(){return(new Date).getTime()},t}(),u=function(){function t(){}return t.getPixelRatio=function(t){return(window.devicePixelRatio||1)/(t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1)},t.isTouch=function(){return!!("ontouchstart"in window)||window.navigator.msMaxTouchPoints>0},t}(),c=function(){function t(){}return t.isInIFrame=function(){try{return window.self!==window.top}catch(t){return!0}},t.supportsFullscreen=function(){var t=document.documentElement;return void 0!==(t.requestFullscreen||t.mozRequestFullScreen||t.webkitRequestFullScreen||t.msRequestFullscreen)},t.isHidden=function(){return!!t.getHiddenProp()},t.getHiddenProp=function(){var t=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var e=0;e<t.length;e++)if(t[e]+"Hidden"in document)return t[e]+"Hidden";return null},t}(),h=function(){function t(){}return t.debounce=function(t,e){return e=e||100,function(){if(!t.debouncing){var i=Array.prototype.slice.apply(arguments);t.lastReturnVal=t.apply(window,i),t.debouncing=!0}return clearTimeout(t.debounceTimeout),t.debounceTimeout=setTimeout((function(){t.debouncing=!1}),e),t.lastReturnVal}},t}(),d=function(){function t(){}return t.simplifyMimeType=function(t){switch(t){case"text/plain":return"txt";case"image/jpeg":return"jpg";case"application/msword":return"doc";case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":return"docx";default:var e=t.split("/");return e[e.length-1]}},t}(),p=function(){function t(){}return t.getCharCode=function(t){return"number"==typeof t.which?t.which:t.keyCode},t}(),f=function(){function t(){}return t.normalise=function(t,e,i){return(t-e)/(i-e)},t.median=function(t){t.sort((function(t,e){return t-e}));var e=Math.floor(t.length/2);return t.length%2?t[e]:(t[e-1]+t[e])/2},t.clamp=function(t,e,i){return Math.min(Math.max(t,e),i)},t}(),m=function(t,e){this.width=t,this.height=e},_=function(){function t(){}return t.fitRect=function(t,e,i,n){var o,a=0,r=0;return e/t<n/i?(a=t*(o=i/t),r=e*o):(a=t*(o=n/e),r=e*o),new m(Math.floor(a),Math.floor(r))},t.hitRect=function(t,e,i,n,o,a){return o>t&&o<t+i&&a>e&&a<e+n},t}(),g=function(){function t(){}return t.numericalInput=function(t){return 46==t.keyCode||8==t.keyCode||9==t.keyCode||27==t.keyCode||65==t.keyCode&&!0===t.ctrlKey||t.keyCode>=35&&t.keyCode<=39||!(t.shiftKey||(t.keyCode<48||t.keyCode>57)&&(t.keyCode<96||t.keyCode>105))||(t.preventDefault(),!1)},t}(),E=function(){function t(){}return t.toPlainObject=function(t){t=Object(t);var e={};for(var i in t)e[i]=t[i];return e},t}(),b=function(){function t(){}return t.clear=function(t){switch(void 0===t&&(t=n.MEMORY),t){case n.MEMORY:this._memoryStorage={};break;case n.SESSION:sessionStorage.clear();break;case n.LOCAL:localStorage.clear()}},t.clearExpired=function(t){void 0===t&&(t=n.MEMORY);for(var e=this.getItems(t),i=0;i<e.length;i++){var o=e[i];this._isExpired(o)&&this.remove(o.key)}},t.get=function(t,e){void 0===e&&(e=n.MEMORY);var i=null;switch(e){case n.MEMORY:i=this._memoryStorage[t];break;case n.SESSION:i=sessionStorage.getItem(t);break;case n.LOCAL:i=localStorage.getItem(t)}if(!i)return null;var o=null;try{o=JSON.parse(i)}catch(t){return null}return o?this._isExpired(o)?null:(o.key=t,o):null},t._isExpired=function(t){return!((new Date).getTime()<t.expiresAt)},t.getItems=function(t){void 0===t&&(t=n.MEMORY);var e=[];switch(t){case n.MEMORY:for(var i=Object.keys(this._memoryStorage),o=0;o<i.length;o++)(r=this.get(i[o],n.MEMORY))&&e.push(r);break;case n.SESSION:for(o=0;o<sessionStorage.length;o++)(a=sessionStorage.key(o))&&(r=this.get(a,n.SESSION))&&e.push(r);break;case n.LOCAL:for(o=0;o<localStorage.length;o++){var a,r;(a=localStorage.key(o))&&(r=this.get(a,n.LOCAL))&&e.push(r)}}return e},t.remove=function(t,e){switch(void 0===e&&(e=n.MEMORY),e){case n.MEMORY:delete this._memoryStorage[t];break;case n.SESSION:sessionStorage.removeItem(t);break;case n.LOCAL:localStorage.removeItem(t)}},t.set=function(t,e,i,o){void 0===o&&(o=n.MEMORY);var a=1e3*i,r=new v;switch(r.value=e,r.expiresAt=(new Date).getTime()+a,o){case n.MEMORY:this._memoryStorage[t]=JSON.stringify(r);break;case n.SESSION:sessionStorage.setItem(t,JSON.stringify(r));break;case n.LOCAL:localStorage.setItem(t,JSON.stringify(r))}return r},t._memoryStorage={},t}(),v=function(){};!function(t){t.MEMORY="memory",t.SESSION="session",t.LOCAL="local"}(n||(n={}));var S=function(){function t(){}return t.ellipsis=function(t,e){if(t.length<=e)return t;var i=t.substr(0,e),n=i.lastIndexOf(" ");return-1!=n&&(i=i.substr(0,Math.min(i.length,n))),i+"&hellip;"},t.htmlDecode=function(t){var e=document.createElement("div");return e.innerHTML=t,e.firstChild.nodeValue},t.format=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];for(var n=0;n<e.length;n++){var o=new RegExp("\\{"+n+"\\}","gm");t=t.replace(o,e[n])}return t},t.isAlphanumeric=function(t){return/^[a-zA-Z0-9]*$/.test(t)},t.toCssClass=function(t){return t.replace(/[^a-z0-9]/g,(function(t){var e=t.charCodeAt(0);return 32==e?"-":e>=65&&e<=90?"_"+t.toLowerCase():"__"+("000"+e.toString(16)).slice(-4)}))},t.toFileName=function(t){return t.replace(/[^a-z0-9]/gi,"_").toLowerCase()},t.utf8_to_b64=function(t){return window.btoa(unescape(encodeURIComponent(t)))},t}(),T=function(){function t(){}return t.getHashParameter=function(t,e){return e||(e=window.document),e&&e.location?this.getHashParameterFromString(t,e.location.hash):null},t.getHashParameterFromString=function(t,e){var i=new RegExp("#.*[?&]"+t+"=([^&]+)(&|$)").exec(e);return i?decodeURIComponent(i[1].replace(/\+/g," ")):null},t.setHashParameter=function(t,e,i){if(i||(i=window.document),i&&i.location){var n="#?"+this.updateURIKeyValuePair(i.location.hash.replace("#?",""),t,e),o=i.URL;-1!=o.indexOf("#")&&(o=o.substr(0,o.indexOf("#"))),i.location.replace(o+n)}},t.getQuerystringParameter=function(t,e){return e||(e=window),this.getQuerystringParameterFromString(t,e.location.search)},t.getQuerystringParameterFromString=function(t,e){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(e);return i?decodeURIComponent(i[1].replace(/\+/g," ")):null},t.setQuerystringParameter=function(t,e,i){if(i||(i=window.document),i&&i.location){var n=this.updateURIKeyValuePair(i.location.hash.replace("#?",""),t,e);window.location.search=n}},t.updateURIKeyValuePair=function(t,e,i){e=encodeURIComponent(e),i=encodeURIComponent(i);var n=t.split("&");""==n[0]&&n.shift();for(var o,a=n.length;a--;)if((o=n[a].split("="))[0]==e){o[1]=i,n[a]=o.join("=");break}return a<0&&(n[n.length]=[e,i].join("=")),n.join("&")},t.getUrlParts=function(t){var e=document.createElement("a");return e.href=t,e},t.convertToRelativeUrl=function(t){var e=this.getUrlParts(t),i=e.pathname+e.searchWithin;return i.startsWith("/")||(i="/"+i),i},t}()}])}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-contentleftpanel-module/GalleryView",["require","exports","../uv-shared-module/BaseEvents","../uv-shared-module/BaseView","@iiif/iiif-gallery-component"],(function(require,exports,BaseEvents_1,BaseView_1,iiif_gallery_component_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var GalleryView=function(_super){function GalleryView($element){var _this=_super.call(this,$element,!0,!0)||this;return _this.isOpen=!1,_this}return __extends(GalleryView,_super),GalleryView.prototype.create=function(){this.setConfig("contentLeftPanel"),_super.prototype.create.call(this),this.$gallery=$('<div class="iiif-gallery-component"></div>'),this.$element.append(this.$gallery)},GalleryView.prototype.setup=function(){var that=this;this.galleryComponent=new iiif_gallery_component_1.GalleryComponent({target:this.$gallery[0]}),this.galleryComponent.on("thumbSelected",(function(thumb){that.component.publish(BaseEvents_1.BaseEvents.GALLERY_THUMB_SELECTED,thumb),that.component.publish(BaseEvents_1.BaseEvents.THUMB_SELECTED,thumb)}),!1),this.galleryComponent.on("decreaseSize",(function(){that.component.publish(BaseEvents_1.BaseEvents.GALLERY_DECREASE_SIZE)}),!1),this.galleryComponent.on("increaseSize",(function(){that.component.publish(BaseEvents_1.BaseEvents.GALLERY_INCREASE_SIZE)}),!1)},GalleryView.prototype.databind=function(){this.galleryComponent.options.data=this.galleryData,this.galleryComponent.set(this.galleryData),this.resize()},GalleryView.prototype.show=function(){var _this=this;this.isOpen=!0,this.$element.show(),setTimeout((function(){_this.galleryComponent.selectIndex(_this.extension.helper.canvasIndex)}),10)},GalleryView.prototype.hide=function(){this.isOpen=!1,this.$element.hide()},GalleryView.prototype.resize=function(){_super.prototype.resize.call(this);var $main=this.$gallery.find(".main"),$header=this.$gallery.find(".header");$main.height(this.$element.height()-$header.height())},GalleryView}(BaseView_1.BaseView);exports.GalleryView=GalleryView}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-shared-module/BaseExpandPanel",["require","exports","./BaseView"],(function(require,exports,BaseView_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var BaseExpandPanel=function(_super){function BaseExpandPanel($element){var _this=_super.call(this,$element,!1,!0)||this;return _this.isExpanded=!1,_this.isFullyExpanded=!1,_this.isUnopened=!0,_this.autoToggled=!1,_this.expandFullEnabled=!0,_this}return __extends(BaseExpandPanel,_super),BaseExpandPanel.prototype.create=function(){var _this=this;_super.prototype.create.call(this),this.$top=$('<div class="top"></div>'),this.$element.append(this.$top),this.$title=$('<div class="title"></div>'),this.$title.prop("title",this.content.title),this.$top.append(this.$title),this.$expandFullButton=$('<a class="expandFullButton" tabindex="0"></a>'),this.$expandFullButton.prop("title",this.content.expandFull),this.$top.append(this.$expandFullButton),Utils.Bools.getBool(this.config.options.expandFullEnabled,!0)||this.$expandFullButton.hide(),this.$collapseButton=$('<div class="collapseButton" tabindex="0"></div>'),this.$collapseButton.prop("title",this.content.collapse),this.$top.append(this.$collapseButton),this.$closed=$('<div class="closed"></div>'),this.$element.append(this.$closed),this.$expandButton=$('<a class="expandButton" tabindex="0"></a>'),this.$expandButton.prop("title",this.content.expand),this.$closed.append(this.$expandButton),this.$closedTitle=$('<a class="title"></a>'),this.$closedTitle.prop("title",this.content.title),this.$closed.append(this.$closedTitle),this.$main=$('<div class="main"></div>'),this.$element.append(this.$main),this.$expandButton.onPressed((function(){_this.toggle()})),this.$expandFullButton.onPressed((function(){_this.expandFull()})),this.$closedTitle.onPressed((function(){_this.toggle()})),this.$title.onPressed((function(){_this.isFullyExpanded?_this.collapseFull():_this.toggle()})),this.$collapseButton.onPressed((function(){_this.isFullyExpanded?_this.collapseFull():_this.toggle()})),this.$top.hide(),this.$main.hide()},BaseExpandPanel.prototype.init=function(){_super.prototype.init.call(this)},BaseExpandPanel.prototype.setTitle=function(title){this.$title.text(title),this.$closedTitle.text(title)},BaseExpandPanel.prototype.toggle=function(autoToggled){var _this=this;this.autoToggled=!!autoToggled,this.isExpanded&&(this.$top.attr("aria-hidden","true"),this.$main.attr("aria-hidden","true"),this.$closed.attr("aria-hidden","false"),this.$top.hide(),this.$main.hide(),this.$closed.show()),this.$element.stop().animate({width:this.getTargetWidth(),left:this.getTargetLeft()},this.options.panelAnimationDuration,(function(){_this.toggled()}))},BaseExpandPanel.prototype.toggled=function(){this.toggleStart(),this.isExpanded=!this.isExpanded,this.isExpanded&&(this.$top.attr("aria-hidden","false"),this.$main.attr("aria-hidden","false"),this.$closed.attr("aria-hidden","true"),this.$closed.hide(),this.$top.show(),this.$main.show()),this.toggleFinish(),this.isUnopened=!1},BaseExpandPanel.prototype.expandFull=function(){var _this=this;this.isExpanded||this.toggled();var targetWidth=this.getFullTargetWidth(),targetLeft=this.getFullTargetLeft();this.expandFullStart(),this.$element.stop().animate({width:targetWidth,left:targetLeft},this.options.panelAnimationDuration,(function(){_this.expandFullFinish()}))},BaseExpandPanel.prototype.collapseFull=function(){var _this=this,targetWidth=this.getTargetWidth(),targetLeft=this.getTargetLeft();this.collapseFullStart(),this.$element.stop().animate({width:targetWidth,left:targetLeft},this.options.panelAnimationDuration,(function(){_this.collapseFullFinish()}))},BaseExpandPanel.prototype.getTargetWidth=function(){return 0},BaseExpandPanel.prototype.getTargetLeft=function(){return 0},BaseExpandPanel.prototype.getFullTargetWidth=function(){return 0},BaseExpandPanel.prototype.getFullTargetLeft=function(){return 0},BaseExpandPanel.prototype.toggleStart=function(){},BaseExpandPanel.prototype.toggleFinish=function(){this.isExpanded&&!this.autoToggled?this.focusCollapseButton():this.focusExpandButton()},BaseExpandPanel.prototype.expandFullStart=function(){},BaseExpandPanel.prototype.expandFullFinish=function(){this.isFullyExpanded=!0,this.$expandFullButton.hide(),this.focusCollapseButton()},BaseExpandPanel.prototype.collapseFullStart=function(){},BaseExpandPanel.prototype.collapseFullFinish=function(){this.isFullyExpanded=!1,this.expandFullEnabled&&this.$expandFullButton.show(),this.focusExpandFullButton()},BaseExpandPanel.prototype.focusExpandButton=function(){var _this=this;setTimeout((function(){_this.$expandButton.focus()}),1)},BaseExpandPanel.prototype.focusExpandFullButton=function(){var _this=this;setTimeout((function(){_this.$expandFullButton.focus()}),1)},BaseExpandPanel.prototype.focusCollapseButton=function(){var _this=this;setTimeout((function(){_this.$collapseButton.focus()}),1)},BaseExpandPanel.prototype.resize=function(){_super.prototype.resize.call(this),this.$main.height(this.$element.parent().height()-this.$top.outerHeight(!0))},BaseExpandPanel}(BaseView_1.BaseView);exports.BaseExpandPanel=BaseExpandPanel}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-shared-module/LeftPanel",["require","exports","./BaseEvents","./BaseExpandPanel"],(function(require,exports,BaseEvents_1,BaseExpandPanel_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var LeftPanel=function(_super){function LeftPanel($element){return _super.call(this,$element)||this}return __extends(LeftPanel,_super),LeftPanel.prototype.create=function(){var _this=this;_super.prototype.create.call(this),this.$element.width(this.options.panelCollapsedWidth),this.component.subscribe(BaseEvents_1.BaseEvents.TOGGLE_EXPAND_LEFT_PANEL,(function(){_this.isFullyExpanded?_this.collapseFull():_this.expandFull()}))},LeftPanel.prototype.init=function(){_super.prototype.init.call(this),Utils.Bools.getBool(this.extension.getSettings().leftPanelOpen,this.options.panelOpen)&&this.toggle(!0)},LeftPanel.prototype.getTargetWidth=function(){return this.isFullyExpanded||!this.isExpanded?this.options.panelExpandedWidth:this.options.panelCollapsedWidth},LeftPanel.prototype.getFullTargetWidth=function(){return this.$element.parent().width()},LeftPanel.prototype.toggleFinish=function(){_super.prototype.toggleFinish.call(this),this.isExpanded?this.component.publish(BaseEvents_1.BaseEvents.OPEN_LEFT_PANEL):this.component.publish(BaseEvents_1.BaseEvents.CLOSE_LEFT_PANEL),this.extension.updateSettings({leftPanelOpen:this.isExpanded})},LeftPanel.prototype.resize=function(){_super.prototype.resize.call(this),this.isFullyExpanded&&this.$element.width(this.$element.parent().width())},LeftPanel}(BaseExpandPanel_1.BaseExpandPanel);exports.LeftPanel=LeftPanel})),define("extensions/uv-seadragon-extension/Mode",["require","exports"],(function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Mode=function(){function Mode(value){this.value=value}return Mode.prototype.toString=function(){return this.value},Mode.image=new Mode("image"),Mode.page=new Mode("page"),Mode}();exports.Mode=Mode}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-shared-module/ThumbsView",["require","exports","./BaseEvents","./BaseView","@iiif/vocabulary"],(function(require,exports,BaseEvents_1,BaseView_1,vocabulary_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ThumbsView=function(_super){function ThumbsView($element){var _this=_super.call(this,$element,!0,!0)||this;return _this.isCreated=!1,_this.isOpen=!1,_this}return __extends(ThumbsView,_super),ThumbsView.prototype.create=function(){var _this=this;_super.prototype.create.call(this),this.component.subscribe(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,(function(index){_this.selectIndex(parseInt(index))})),this.component.subscribe(BaseEvents_1.BaseEvents.LOGIN,(function(){_this.loadThumbs()})),this.component.subscribe(BaseEvents_1.BaseEvents.CLICKTHROUGH,(function(){_this.loadThumbs()})),this.$thumbs=$('<div class="thumbs"></div>'),this.$element.append(this.$thumbs);var viewingDirection=this.extension.helper.getViewingDirection()||vocabulary_1.ViewingDirection.LEFT_TO_RIGHT;this.$thumbs.addClass(viewingDirection.toString());var that=this;$.templates({thumbsTemplate:'<div id="thumb{{>index}}" class="{{:~className()}}" data-src="{{>uri}}" data-visible="{{>visible}}" data-index="{{>index}}">                                <div class="wrap" style="height:{{>height + ~extraHeight()}}px"></div>                                <div class="info">                                    <span class="index">{{:#index + 1}}</span>                                    <span class="label" title="{{>label}}">{{>label}}&nbsp;</span>                                    <span class="searchResults" title="{{:~searchResultsTitle()}}">{{>data.searchResults}}</span>                                </div>                             </div>                             {{if ~separator()}}                                  <div class="separator"></div>                              {{/if}}'});var extraHeight=this.options.thumbsExtraHeight;$.views.helpers({separator:function(){return!1},extraHeight:function(){return extraHeight},className:function(){var className="thumb";0===this.data.index&&(className+=" first"),this.data.uri||(className+=" placeholder");var viewingDirection=that.extension.helper.getViewingDirection();return!viewingDirection||viewingDirection.toString()!==vocabulary_1.ViewingDirection.LEFT_TO_RIGHT.toString()&&viewingDirection.toString()!==vocabulary_1.ViewingDirection.RIGHT_TO_LEFT.toString()?that.extension.helper.isPaged()?className+=" twoCol":className+=" oneCol":className+=" twoCol",className},searchResultsTitle:function(){var searchResults=Number(this.data.data.searchResults);return searchResults?searchResults>1?Utils.Strings.format(that.content.searchResults,searchResults.toString()):Utils.Strings.format(that.content.searchResult,searchResults.toString()):""}}),this.$element.on("scroll",(function(){_this.scrollStop()}),100),this.resize()},ThumbsView.prototype.databind=function(){this.thumbs&&(this._$thumbsCache=null,this.createThumbs(),this.loadThumbs(0),this.selectIndex(this.extension.helper.canvasIndex))},ThumbsView.prototype.createThumbs=function(){var that=this;if(this.thumbs){for(var heights=[],i=0;i<this.thumbs.length;i++){var thumb=this.thumbs[i];heights.push(thumb.height)}var medianHeight=Utils.Maths.median(heights);for(i=0;i<this.thumbs.length;i++){(thumb=this.thumbs[i]).height=medianHeight}this.$thumbs.link($.templates.thumbsTemplate,this.thumbs),this.$thumbs.undelegate(".thumb","click"),this.$thumbs.delegate(".thumb","click",(function(e){e.preventDefault();var data=$.view(this).data;that.lastThumbClickedIndex=data.index,that.component.publish(BaseEvents_1.BaseEvents.THUMB_SELECTED,data)})),this.setLabel(),this.isCreated=!0}},ThumbsView.prototype.scrollStop=function(){var scrollPos=1/((this.$thumbs.height()-this.$element.height())/this.$element.scrollTop());scrollPos>1&&(scrollPos=1);var thumbRangeMid=Math.floor((this.thumbs.length-1)*scrollPos);this.loadThumbs(thumbRangeMid)},ThumbsView.prototype.loadThumbs=function(index){if(void 0===index&&(index=this.extension.helper.canvasIndex),this.thumbs&&this.thumbs.length){var thumbType,annotations=this.extension.helper.getCanvasByIndex(index).getContent();if(annotations.length){var body=annotations[0].getBody();if(body.length){var type=body[0].getType();type&&(thumbType=type.toString().toLowerCase())}}for(var thumbRangeMid=index,thumbLoadRange=this.options.thumbsLoadRange,thumbRange={start:thumbRangeMid>thumbLoadRange?thumbRangeMid-thumbLoadRange:0,end:thumbRangeMid<this.thumbs.length-1-thumbLoadRange?thumbRangeMid+thumbLoadRange:this.thumbs.length-1},fadeDuration=this.options.thumbsImageFadeInDuration,i=thumbRange.start;i<=thumbRange.end;i++){var $thumb=this.getThumbByIndex(i),$wrap=$thumb.find(".wrap");if(!$wrap.hasClass("loading")&&!$wrap.hasClass("loaded"))if("false"!==$thumb.attr("data-visible")){$wrap.removeClass("loadingFailed"),$wrap.addClass("loading"),thumbType&&$wrap.addClass(thumbType);var src=$thumb.attr("data-src");this.config.options.thumbsCacheInvalidation&&this.config.options.thumbsCacheInvalidation.enabled&&(src+=this.config.options.thumbsCacheInvalidation.paramType+"t="+Utils.Dates.getTimeStamp());var $img=$('<img src="'+src+'" alt=""/>');$img.hide(),$img.on("load",(function(){$(this).fadeIn(fadeDuration,(function(){$(this).parent().switchClass("loading","loaded")}))})),$img.on("error",(function(){$(this).parent().switchClass("loading","loadingFailed")})),$wrap.append($img)}else $wrap.addClass("hidden")}}},ThumbsView.prototype.show=function(){var _this=this;this.isOpen=!0,this.$element.show(),setTimeout((function(){_this.selectIndex(_this.extension.helper.canvasIndex)}),1)},ThumbsView.prototype.hide=function(){this.isOpen=!1,this.$element.hide()},ThumbsView.prototype.isPDF=function(){var type=this.extension.helper.getCurrentCanvas().getType();return!!type&&type.toString().includes("pdf")},ThumbsView.prototype.setLabel=function(){$(this.$thumbs).find("span.index").hide(),$(this.$thumbs).find("span.label").show()},ThumbsView.prototype.addSelectedClassToThumbs=function(index){this.getThumbByIndex(index).addClass("selected")},ThumbsView.prototype.selectIndex=function(index){-1!==index&&(this.thumbs&&this.thumbs.length&&(this.getAllThumbs().removeClass("selected"),this.$selectedThumb=this.getThumbByIndex(index),this.addSelectedClassToThumbs(index),~this.extension.getPagedIndices(index).indexOf(this.lastThumbClickedIndex)||this.$element.scrollTop(this.$selectedThumb.position().top),this.loadThumbs(index)))},ThumbsView.prototype.getAllThumbs=function(){return this._$thumbsCache||(this._$thumbsCache=this.$thumbs.find(".thumb")),this._$thumbsCache},ThumbsView.prototype.getThumbByIndex=function(canvasIndex){return this.$thumbs.find('[data-index="'+canvasIndex+'"]')},ThumbsView.prototype.scrollToThumb=function(canvasIndex){var $thumb=this.getThumbByIndex(canvasIndex);this.$element.scrollTop($thumb.position().top)},ThumbsView.prototype.resize=function(){_super.prototype.resize.call(this)},ThumbsView}(BaseView_1.BaseView);exports.ThumbsView=ThumbsView})),define("extensions/uv-seadragon-extension/Events",["require","exports"],(function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Events=function(){function Events(){}return Events.namespace="openseadragonExtension.",Events.CURRENT_VIEW_URI=Events.namespace+"currentViewUri",Events.IMAGE_SEARCH=Events.namespace+"imageSearch",Events.MODE_CHANGED=Events.namespace+"modeChanged",Events.NEXT_SEARCH_RESULT=Events.namespace+"nextSearchResult",Events.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE=Events.namespace+"nextImagesSearchResultUnavailable",Events.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE=Events.namespace+"prevImagesSearchResultUnavailable",Events.PAGE_SEARCH=Events.namespace+"pageSearch",Events.PAGING_TOGGLED=Events.namespace+"pagingToggled",Events.PREV_SEARCH_RESULT=Events.namespace+"prevSearchResult",Events.PRINT=Events.namespace+"print",Events.ROTATE=Events.namespace+"rotate",Events.SEADRAGON_ANIMATION_FINISH=Events.namespace+"animationFinish",Events.SEADRAGON_ANIMATION_START=Events.namespace+"animationStart",Events.SEADRAGON_ANIMATION=Events.namespace+"animation",Events.SEADRAGON_OPEN=Events.namespace+"open",Events.SEADRAGON_RESIZE=Events.namespace+"resize",Events.SEADRAGON_ROTATION=Events.namespace+"rotationChanged",Events.SEARCH_PREVIEW_FINISH=Events.namespace+"searchPreviewFinish",Events.SEARCH_PREVIEW_START=Events.namespace+"searchPreviewStart",Events.SEARCH=Events.namespace+"search",Events.XYWH_CHANGED=Events.namespace+"xywhChanged",Events.ZOOM_IN=Events.namespace+"zoomIn",Events.ZOOM_OUT=Events.namespace+"zoomOut",Events}();exports.Events=Events}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-contentleftpanel-module/ThumbsView",["require","exports","../uv-shared-module/ThumbsView","../../extensions/uv-seadragon-extension/Events","../../extensions/uv-seadragon-extension/Mode"],(function(require,exports,ThumbsView_1,Events_1,Mode_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ThumbsView=function(_super){function ThumbsView(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(ThumbsView,_super),ThumbsView.prototype.create=function(){var _this=this;this.setConfig("contentLeftPanel"),_super.prototype.create.call(this),this.component.subscribe(Events_1.Events.MODE_CHANGED,(function(){_this.setLabel()})),this.component.subscribe(Events_1.Events.SEARCH_PREVIEW_START,(function(canvasIndex){_this.searchPreviewStart(canvasIndex)})),this.component.subscribe(Events_1.Events.SEARCH_PREVIEW_FINISH,(function(){_this.searchPreviewFinish()})),this.extension.helper.isPaged()&&this.$thumbs.addClass("paged");var that=this;$.views.helpers({separator:function(){return!that.extension.helper.isPaged()||(this.data.index-1)%2!=0}})},ThumbsView.prototype.addSelectedClassToThumbs=function(index){for(var indices=this.extension.getPagedIndices(index),i=0;i<indices.length;i++)this.getThumbByIndex(indices[i]).addClass("selected")},ThumbsView.prototype.isPageModeEnabled=function(){return"function"==typeof this.extension.getMode?this.config.options.pageModeEnabled&&this.extension.getMode().toString()===Mode_1.Mode.page.toString():this.config.options.pageModeEnabled},ThumbsView.prototype.searchPreviewStart=function(canvasIndex){this.scrollToThumb(canvasIndex),this.getThumbByIndex(canvasIndex).addClass("searchpreview")},ThumbsView.prototype.searchPreviewFinish=function(){this.scrollToThumb(this.extension.helper.canvasIndex),this.getAllThumbs().removeClass("searchpreview")},ThumbsView.prototype.setLabel=function(){this.isPDF()?($(this.$thumbs).find("span.index").hide(),$(this.$thumbs).find("span.label").hide()):this.isPageModeEnabled()?($(this.$thumbs).find("span.index").hide(),$(this.$thumbs).find("span.label").show()):($(this.$thumbs).find("span.index").show(),$(this.$thumbs).find("span.label").hide())},ThumbsView}(ThumbsView_1.ThumbsView);exports.ThumbsView=ThumbsView}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-contentleftpanel-module/TreeView",["require","exports","../uv-shared-module/BaseEvents","../uv-shared-module/BaseView"],(function(require,exports,BaseEvents_1,BaseView_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var TreeView=function(_super){function TreeView($element){var _this=_super.call(this,$element,!0,!0)||this;return _this.isOpen=!1,_this}return __extends(TreeView,_super),TreeView.prototype.create=function(){this.setConfig("contentLeftPanel"),_super.prototype.create.call(this),this.$tree=$('<div class="iiif-tree-component"></div>'),this.$element.append(this.$tree)},TreeView.prototype.setup=function(){var that=this;this.treeComponent=new IIIFComponents.TreeComponent({target:this.$tree[0],data:this.treeData}),this.treeComponent.on("treeNodeSelected",(function(node){that.component.publish(BaseEvents_1.BaseEvents.TREE_NODE_SELECTED,node)}),!1),this.treeComponent.on("treeNodeMultiSelected",(function(node){that.component.publish(BaseEvents_1.BaseEvents.TREE_NODE_MULTISELECTED,node)}),!1)},TreeView.prototype.databind=function(){this.treeComponent.set(this.treeData),this.resize()},TreeView.prototype.show=function(){this.isOpen=!0,this.$element.show()},TreeView.prototype.hide=function(){this.isOpen=!1,this.$element.hide()},TreeView.prototype.selectNode=function(node){if(!this.treeComponent.selectedNode){this.treeComponent.expandParents(node,!0);var link=this.$tree.find("#tree-link-"+node.id)[0];link&&link.scrollIntoViewIfNeeded()}this.treeComponent.selectNode(node)},TreeView.prototype.expandNode=function(node,expanded){this.treeComponent.expandNode(node,expanded)},TreeView.prototype.getAllNodes=function(){return this.treeComponent.getAllNodes()},TreeView.prototype.deselectCurrentNode=function(){this.treeComponent.deselectCurrentNode()},TreeView.prototype.getNodeById=function(id){return this.treeComponent.getNodeById(id)},TreeView.prototype.resize=function(){_super.prototype.resize.call(this)},TreeView}(BaseView_1.BaseView);exports.TreeView=TreeView}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-contentleftpanel-module/ContentLeftPanel",["require","exports","../uv-shared-module/BaseEvents","./GalleryView","../uv-shared-module/LeftPanel","../../extensions/uv-seadragon-extension/Mode","./ThumbsView","./TreeView","@iiif/vocabulary","manifesto.js","@iiif/manifold"],(function(require,exports,BaseEvents_1,GalleryView_1,LeftPanel_1,Mode_1,ThumbsView_1,TreeView_1,vocabulary_1,manifesto_js_1,manifold_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ContentLeftPanel=function(_super){function ContentLeftPanel($element){var _this=_super.call(this,$element)||this;return _this.expandFullEnabled=!1,_this.isThumbsViewOpen=!1,_this.isTreeViewOpen=!1,_this.treeSortType=manifold_1.TreeSortType.NONE,_this}return __extends(ContentLeftPanel,_super),ContentLeftPanel.prototype.create=function(){var _this=this;this.setConfig("contentLeftPanel"),_super.prototype.create.call(this),this.component.subscribe(BaseEvents_1.BaseEvents.SETTINGS_CHANGED,(function(){_this.databind()})),this.component.subscribe(BaseEvents_1.BaseEvents.GALLERY_THUMB_SELECTED,(function(){_this.collapseFull()})),this.component.subscribe(BaseEvents_1.BaseEvents.METRIC_CHANGED,(function(){_this.extension.isDesktopMetric()||_this.isFullyExpanded&&_this.collapseFull()})),this.component.subscribe(BaseEvents_1.BaseEvents.ANNOTATIONS,(function(){_this.databindThumbsView(),_this.databindGalleryView()})),this.component.subscribe(BaseEvents_1.BaseEvents.ANNOTATIONS_CLEARED,(function(){_this.databindThumbsView(),_this.databindGalleryView()})),this.component.subscribe(BaseEvents_1.BaseEvents.ANNOTATIONS_EMPTY,(function(){_this.databindThumbsView(),_this.databindGalleryView()})),this.component.subscribe(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,(function(){_this.isFullyExpanded&&_this.collapseFull(),_this.selectCurrentTreeNode(),_this.updateTreeTabBySelection()})),this.component.subscribe(BaseEvents_1.BaseEvents.RANGE_CHANGED,(function(){_this.isFullyExpanded&&_this.collapseFull(),_this.selectCurrentTreeNode(),_this.updateTreeTabBySelection()})),this.$tabs=$('<div class="tabs"></div>'),this.$main.append(this.$tabs),this.$treeButton=$('<a class="index tab" tabindex="0">'+this.content.index+"</a>"),this.$tabs.append(this.$treeButton),this.$thumbsButton=$('<a class="thumbs tab" tabindex="0">'+this.content.thumbnails+"</a>"),this.$thumbsButton.prop("title",this.content.thumbnails),this.$tabs.append(this.$thumbsButton),this.$tabsContent=$('<div class="tabsContent"></div>'),this.$main.append(this.$tabsContent),this.$options=$('<div class="options"></div>'),this.$tabsContent.append(this.$options),this.$topOptions=$('<div class="top"></div>'),this.$options.append(this.$topOptions),this.$treeSelect=$('<select aria-label="'+this.content.manifestRanges+'"></select>'),this.$topOptions.append(this.$treeSelect),this.$bottomOptions=$('<div class="bottom"></div>'),this.$options.append(this.$bottomOptions),this.$leftOptions=$('<div class="left"></div>'),this.$bottomOptions.append(this.$leftOptions),this.$rightOptions=$('<div class="right"></div>'),this.$bottomOptions.append(this.$rightOptions),this.$treeViewOptions=$('<div class="treeView"></div>'),this.$leftOptions.append(this.$treeViewOptions),this.$sortByLabel=$('<span class="sort">'+this.content.sortBy+"</span>"),this.$treeViewOptions.append(this.$sortByLabel),this.$sortButtonGroup=$('<div class="btn-group"></div>'),this.$treeViewOptions.append(this.$sortButtonGroup),this.$sortByDateButton=$('<button class="btn" tabindex="0">'+this.content.date+"</button>"),this.$sortButtonGroup.append(this.$sortByDateButton),this.$sortByVolumeButton=$('<button class="btn" tabindex="0">'+this.content.volume+"</button>"),this.$sortButtonGroup.append(this.$sortByVolumeButton),this.$views=$('<div class="views"></div>'),this.$tabsContent.append(this.$views),this.$treeView=$('<div class="treeView"></div>'),this.$views.append(this.$treeView),this.$thumbsView=$('<div class="thumbsView" tabindex="0"></div>'),this.$views.append(this.$thumbsView),this.$galleryView=$('<div class="galleryView"></div>'),this.$views.append(this.$galleryView),this.$treeSelect.hide(),this.$treeSelect.change((function(){_this.databindTreeView(),_this.selectCurrentTreeNode(),_this.updateTreeTabBySelection()})),this.$sortByDateButton.on("click",(function(){_this.sortByDate()})),this.$sortByVolumeButton.on("click",(function(){_this.sortByVolume()})),this.$treeViewOptions.hide(),this.$treeButton.onPressed((function(){_this.openTreeView()})),this.$thumbsButton.onPressed((function(){_this.openThumbsView()})),this.setTitle(this.content.title),this.$sortByVolumeButton.addClass("on");var tabOrderConfig=this.options.tabOrder;tabOrderConfig&&("thumbs"===(tabOrderConfig=(tabOrderConfig=tabOrderConfig.toLowerCase()).replace(/ /g,"")).split(",")[0]?(this.$treeButton.before(this.$thumbsButton),this.$thumbsButton.addClass("first")):this.$treeButton.addClass("first"))},ContentLeftPanel.prototype.createTreeView=function(){this.treeView=new TreeView_1.TreeView(this.$treeView),this.treeView.treeData=this.getTreeData(),this.treeView.setup(),this.databindTreeView();var topRanges=this.extension.helper.getTopRanges();if(topRanges.length>1)for(var i=0;i<topRanges.length;i++){var range=topRanges[i];this.$treeSelect.append('<option value="'+range.id+'">'+manifesto_js_1.LanguageMap.getValue(range.getLabel())+"</option>")}this.updateTreeViewOptions()},ContentLeftPanel.prototype.databind=function(){this.databindThumbsView(),this.databindTreeView(),this.databindGalleryView()},ContentLeftPanel.prototype.updateTreeViewOptions=function(){var treeData=this.getTree();treeData&&(this.isCollection()&&this.extension.helper.treeHasNavDates(treeData)?this.$treeViewOptions.show():this.$treeViewOptions.hide(),this.$treeSelect.find("option").length?this.$treeSelect.show():this.$treeSelect.hide())},ContentLeftPanel.prototype.sortByDate=function(){this.treeSortType=manifold_1.TreeSortType.DATE,this.treeView.treeData=this.getTreeData(),this.treeView.databind(),this.selectCurrentTreeNode(),this.$sortByDateButton.addClass("on"),this.$sortByVolumeButton.removeClass("on"),this.resize()},ContentLeftPanel.prototype.sortByVolume=function(){this.treeSortType=manifold_1.TreeSortType.NONE,this.treeView.treeData=this.getTreeData(),this.treeView.databind(),this.selectCurrentTreeNode(),this.$sortByDateButton.removeClass("on"),this.$sortByVolumeButton.addClass("on"),this.resize()},ContentLeftPanel.prototype.isCollection=function(){var treeData=this.getTree();if(treeData)return treeData.data.type===manifesto_js_1.TreeNodeType.COLLECTION.toString();throw new Error("Tree not available")},ContentLeftPanel.prototype.databindTreeView=function(){this.treeView&&(this.treeView.treeData=this.getTreeData(),this.treeView.databind(),this.selectCurrentTreeNode())},ContentLeftPanel.prototype.getTreeData=function(){return{autoExpand:this._isTreeAutoExpanded(),branchNodesExpandOnClick:Utils.Bools.getBool(this.config.options.branchNodesExpandOnClick,!0),branchNodesSelectable:Utils.Bools.getBool(this.config.options.branchNodesSelectable,!1),helper:this.extension.helper,topRangeIndex:this.getSelectedTopRangeIndex(),treeSortType:this.treeSortType}},ContentLeftPanel.prototype._isTreeAutoExpanded=function(){var autoExpandTreeEnabled=Utils.Bools.getBool(this.config.options.autoExpandTreeEnabled,!1),autoExpandTreeIfFewerThan=this.config.options.autoExpandTreeIfFewerThan||0;if(autoExpandTreeEnabled){var flatTree=this.extension.helper.getFlattenedTree();if(flatTree&&flatTree.length<autoExpandTreeIfFewerThan)return!0}return!1},ContentLeftPanel.prototype.updateTreeTabByCanvasIndex=function(){var topRanges=this.extension.helper.getTopRanges();if(topRanges.length>1){var index=this.getCurrentCanvasTopRangeIndex();if(-1===index)return;var currentRange=topRanges[index];this.setTreeTabTitle(manifesto_js_1.LanguageMap.getValue(currentRange.getLabel()))}else this.setTreeTabTitle(this.content.index)},ContentLeftPanel.prototype.setTreeTabTitle=function(title){this.$treeButton.text(title),this.$treeButton.prop("title",title)},ContentLeftPanel.prototype.updateTreeTabBySelection=function(){var title=null,topRanges=this.extension.helper.getTopRanges();topRanges.length>1&&(title=this.treeView?this.getSelectedTree().text():manifesto_js_1.LanguageMap.getValue(topRanges[0].getLabel())),title?this.setTreeTabTitle(title):this.setTreeTabTitle(this.content.index)},ContentLeftPanel.prototype.getViewingHint=function(){return this.extension.helper.getViewingHint()},ContentLeftPanel.prototype.getViewingDirection=function(){return this.extension.helper.getViewingDirection()},ContentLeftPanel.prototype.createThumbsView=function(){this.thumbsView=new ThumbsView_1.ThumbsView(this.$thumbsView),this.databindThumbsView()},ContentLeftPanel.prototype.databindThumbsView=function(){if(this.thumbsView){var width,height,viewingHint=this.getViewingHint(),viewingDirection=this.getViewingDirection();!viewingDirection||viewingDirection.toString()!==vocabulary_1.ViewingDirection.LEFT_TO_RIGHT.toString()&&viewingDirection.toString()!==vocabulary_1.ViewingDirection.RIGHT_TO_LEFT.toString()?viewingHint&&viewingHint.toString()===vocabulary_1.ViewingHint.PAGED.toString()?(width=this.config.options.twoColThumbWidth,height=this.config.options.twoColThumbHeight):(width=this.config.options.oneColThumbWidth,height=this.config.options.oneColThumbHeight):(width=this.config.options.twoColThumbWidth,height=this.config.options.twoColThumbHeight);var thumbs=this.extension.helper.getThumbs(width,height);viewingDirection&&viewingDirection.toString()===vocabulary_1.ViewingDirection.BOTTOM_TO_TOP.toString()&&thumbs.reverse();var searchResults=this.extension.annotations;if(searchResults&&searchResults.length)for(var _loop_1=function(i){var searchResult=searchResults[i],thumb=thumbs.en().where((function(t){return t.index===searchResult.canvasIndex})).first();if(thumb){var data=$.extend(!0,{},thumb.data);data.searchResults=searchResult.rects.length,thumb.data=data}},i=0;i<searchResults.length;i++)_loop_1(i);this.thumbsView.thumbs=thumbs,this.thumbsView.databind()}},ContentLeftPanel.prototype.createGalleryView=function(){this.galleryView=new GalleryView_1.GalleryView(this.$galleryView),this.galleryView.galleryData=this.getGalleryData(),this.galleryView.setup(),this.databindGalleryView()},ContentLeftPanel.prototype.databindGalleryView=function(){this.galleryView&&(this.galleryView.galleryData=this.getGalleryData(),this.galleryView.databind())},ContentLeftPanel.prototype.getGalleryData=function(){return{helper:this.extension.helper,chunkedResizingThreshold:this.config.options.galleryThumbChunkedResizingThreshold,content:this.config.content,debug:!1,imageFadeInDuration:300,initialZoom:6,minLabelWidth:20,pageModeEnabled:this.isPageModeEnabled(),scrollStopDuration:100,searchResults:this.extension.annotations,sizingEnabled:Modernizr.inputtypes.range,thumbHeight:this.config.options.galleryThumbHeight,thumbLoadPadding:this.config.options.galleryThumbLoadPadding,thumbWidth:this.config.options.galleryThumbWidth,viewingDirection:this.getViewingDirection()}},ContentLeftPanel.prototype.isPageModeEnabled=function(){return"function"==typeof this.extension.getMode?Utils.Bools.getBool(this.config.options.pageModeEnabled,!0)&&this.extension.getMode().toString()===Mode_1.Mode.page.toString():Utils.Bools.getBool(this.config.options.pageModeEnabled,!0)},ContentLeftPanel.prototype.getSelectedTree=function(){return this.$treeSelect.find(":selected")},ContentLeftPanel.prototype.getSelectedTopRangeIndex=function(){var topRangeIndex=this.getSelectedTree().index();return-1===topRangeIndex&&(topRangeIndex=0),topRangeIndex},ContentLeftPanel.prototype.getTree=function(){var topRangeIndex=this.getSelectedTopRangeIndex();return this.extension.helper.getTree(topRangeIndex,manifold_1.TreeSortType.NONE)},ContentLeftPanel.prototype.toggleFinish=function(){if(_super.prototype.toggleFinish.call(this),this.isUnopened){var treeEnabled=Utils.Bools.getBool(this.config.options.treeEnabled,!0),thumbsEnabled=Utils.Bools.getBool(this.config.options.thumbsEnabled,!0),treeData=this.getTree();treeData&&treeData.nodes.length||(treeEnabled=!1),treeEnabled&&thumbsEnabled||this.$tabs.hide(),thumbsEnabled&&this.defaultToThumbsView()?this.openThumbsView():treeEnabled&&this.openTreeView()}},ContentLeftPanel.prototype.defaultToThumbsView=function(){var defaultToTreeEnabled=Utils.Bools.getBool(this.config.options.defaultToTreeEnabled,!1),defaultToTreeIfGreaterThan=this.config.options.defaultToTreeIfGreaterThan||0,treeData=this.getTree();return!(defaultToTreeEnabled&&treeData&&treeData.nodes.length>defaultToTreeIfGreaterThan)},ContentLeftPanel.prototype.expandFullStart=function(){_super.prototype.expandFullStart.call(this),this.component.publish(BaseEvents_1.BaseEvents.LEFTPANEL_EXPAND_FULL_START)},ContentLeftPanel.prototype.expandFullFinish=function(){_super.prototype.expandFullFinish.call(this),this.$treeButton.hasClass("on")?this.openTreeView():this.$thumbsButton.hasClass("on")&&this.openThumbsView(),this.component.publish(BaseEvents_1.BaseEvents.LEFTPANEL_EXPAND_FULL_FINISH)},ContentLeftPanel.prototype.collapseFullStart=function(){_super.prototype.collapseFullStart.call(this),this.component.publish(BaseEvents_1.BaseEvents.LEFTPANEL_COLLAPSE_FULL_START)},ContentLeftPanel.prototype.collapseFullFinish=function(){_super.prototype.collapseFullFinish.call(this),this.$thumbsButton.hasClass("on")&&this.openThumbsView(),this.component.publish(BaseEvents_1.BaseEvents.LEFTPANEL_COLLAPSE_FULL_FINISH)},ContentLeftPanel.prototype.openTreeView=function(){this.isTreeViewOpen=!0,this.isThumbsViewOpen=!1,this.treeView||this.createTreeView(),this.$treeButton.addClass("on"),this.$thumbsButton.removeClass("on"),this.treeView.show(),this.thumbsView&&this.thumbsView.hide(),this.galleryView&&this.galleryView.hide(),this.updateTreeViewOptions(),this.selectCurrentTreeNode(),this.resize(),this.treeView.resize(),this.component.publish(BaseEvents_1.BaseEvents.OPEN_TREE_VIEW)},ContentLeftPanel.prototype.openThumbsView=function(){this.isTreeViewOpen=!1,this.isThumbsViewOpen=!0,this.thumbsView||this.createThumbsView(),this.isFullyExpanded&&!this.galleryView&&this.createGalleryView(),this.$treeButton.removeClass("on"),this.$thumbsButton.addClass("on"),this.treeView&&this.treeView.hide(),this.$treeSelect.hide(),this.$treeViewOptions.hide(),this.resize(),this.isFullyExpanded?(this.thumbsView.hide(),this.galleryView&&this.galleryView.show(),this.galleryView&&this.galleryView.resize()):(this.galleryView&&this.galleryView.hide(),this.thumbsView.show(),this.thumbsView.resize()),this.component.publish(BaseEvents_1.BaseEvents.OPEN_THUMBS_VIEW)},ContentLeftPanel.prototype.selectTopRangeIndex=function(index){this.$treeSelect.prop("selectedIndex",index)},ContentLeftPanel.prototype.getCurrentCanvasTopRangeIndex=function(){var topRangeIndex=-1,range=this.extension.getCurrentCanvasRange();return range&&(topRangeIndex=Number(range.path.split("/")[0])),topRangeIndex},ContentLeftPanel.prototype.selectCurrentTreeNode=function(){"uv-seadragon-extension"===this.extension.name?this.selectCurrentTreeNodeByCanvas():this.selectCurrentTreeNodeByRange()},ContentLeftPanel.prototype.selectCurrentTreeNodeByRange=function(){if(this.treeView){var range=this.extension.helper.getCurrentRange(),node=null;range&&range.treeNode&&(node=this.treeView.getNodeById(range.treeNode.id)),node?this.treeView.selectNode(node):this.selectTreeNodeByManifest()}},ContentLeftPanel.prototype.selectCurrentTreeNodeByCanvas=function(){if(this.treeView){var node=null,currentCanvasTopRangeIndex=this.getCurrentCanvasTopRangeIndex(),usingCorrectTree=currentCanvasTopRangeIndex===this.getSelectedTopRangeIndex(),range=null;-1!==currentCanvasTopRangeIndex&&(range=this.extension.getCurrentCanvasRange())&&range.treeNode&&(node=this.treeView.getNodeById(range.treeNode.id)),node&&usingCorrectTree?this.treeView.selectNode(node):((range=this.extension.helper.getCurrentRange())&&range.treeNode&&(node=this.treeView.getNodeById(range.treeNode.id)),node?this.treeView.selectNode(node):this.selectTreeNodeByManifest())}},ContentLeftPanel.prototype.selectTreeNodeByManifest=function(){var _this=this,collectionIndex=this.extension.helper.collectionIndex,manifestIndex=this.extension.helper.manifestIndex,allNodes=this.treeView.getAllNodes(),nodeFound=!1;allNodes.map((function(node){node.isCollection()&&node.data.index===collectionIndex&&(_this.treeView.selectNode(node),_this.treeView.expandNode(node,!0),nodeFound=!0),node.isManifest()&&node.data.index===manifestIndex&&(_this.treeView.selectNode(node),nodeFound=!0)})),nodeFound||this.treeView.deselectCurrentNode()},ContentLeftPanel.prototype.resize=function(){_super.prototype.resize.call(this),this.$tabsContent.height(this.$main.height()-(this.$tabs.is(":visible")?this.$tabs.height():0)-this.$tabsContent.verticalPadding()),this.$views.height(this.$tabsContent.height()-this.$options.outerHeight())},ContentLeftPanel}(LeftPanel_1.LeftPanel);exports.ContentLeftPanel=ContentLeftPanel})),define("modules/uv-shared-module/DownloadOption",["require","exports"],(function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),function(DownloadOption){DownloadOption.CANVAS_RENDERINGS="canvasRenderings",DownloadOption.CURRENT_VIEW="currentView",DownloadOption.ENTIRE_DOCUMENT_AS_PDF="entireDocumentAsPdf",DownloadOption.ENTIRE_DOCUMENT_AS_TEXT="entireDocumentAsText",DownloadOption.ENTIRE_FILE_AS_ORIGINAL="entireFileAsOriginal",DownloadOption.IMAGE_RENDERINGS="imageRenderings",DownloadOption.MANIFEST_RENDERINGS="manifestRenderings",DownloadOption.RANGE_RENDERINGS="rangeRenderings",DownloadOption.SELECTION="selection",DownloadOption.UNKNOWN="unknown",DownloadOption.WHOLE_IMAGE_HIGH_RES="wholeImageHighRes",DownloadOption.WHOLE_IMAGE_LOW_RES="wholeImageLowRes",DownloadOption.WHOLE_IMAGES_HIGH_RES="wholeImagesHighRes"}(exports.DownloadOption||(exports.DownloadOption={}))}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-dialogues-module/DownloadDialogue",["require","exports","../uv-shared-module/BaseEvents","../uv-shared-module/Dialogue","../uv-shared-module/DownloadOption","manifesto.js"],(function(require,exports,BaseEvents_1,Dialogue_1,DownloadOption_1,manifesto_js_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var DownloadDialogue=function(_super){function DownloadDialogue($element){return _super.call(this,$element)||this}return __extends(DownloadDialogue,_super),DownloadDialogue.prototype.create=function(){var _this=this;this.setConfig("downloadDialogue"),_super.prototype.create.call(this),this.openCommand=BaseEvents_1.BaseEvents.SHOW_DOWNLOAD_DIALOGUE,this.closeCommand=BaseEvents_1.BaseEvents.HIDE_DOWNLOAD_DIALOGUE,this.component.subscribe(this.openCommand,(function(triggerButton){_this.open(triggerButton)})),this.component.subscribe(this.closeCommand,(function(){_this.close()})),this.$title=$("<h1>"+this.content.title+"</h1>"),this.$content.append(this.$title),this.$noneAvailable=$('<div class="noneAvailable">'+this.content.noneAvailable+"</div>"),this.$content.append(this.$noneAvailable),this.$downloadOptions=$('<ol class="options"></ol>'),this.$content.append(this.$downloadOptions),this.$footer=$('<div class="footer"></div>'),this.$content.append(this.$footer),this.$termsOfUseButton=$('<a href="#">'+this.extension.data.config.content.termsOfUse+"</a>"),this.$footer.append(this.$termsOfUseButton),this.$termsOfUseButton.onPressed((function(){_this.component.publish(BaseEvents_1.BaseEvents.SHOW_TERMS_OF_USE)})),this.$element.hide(),this.updateTermsOfUseButton()},DownloadDialogue.prototype.addEntireFileDownloadOptions=function(){if(this.isDownloadOptionAvailable(DownloadOption_1.DownloadOption.ENTIRE_FILE_AS_ORIGINAL)){this.$downloadOptions.empty();for(var canvas=this.extension.helper.getCurrentCanvas(),renderingFound=!1,renderings=canvas.getRenderings(),i=0;i<renderings.length;i++){var rendering=renderings[i],renderingFormat=rendering.getFormat(),format="";renderingFormat&&(format=renderingFormat.toString()),this.addEntireFileDownloadOption(rendering.id,manifesto_js_1.LanguageMap.getValue(rendering.getLabel()),format),renderingFound=!0}if(!renderingFound){var annotationFound=!1,annotations=canvas.getContent();for(i=0;i<annotations.length;i++){var body=annotations[i].getBody();if(body.length)(format=body[0].getFormat())&&(this.addEntireFileDownloadOption(body[0].id,"",format.toString()),annotationFound=!0)}annotationFound||this.addEntireFileDownloadOption(canvas.id,"","")}}},DownloadDialogue.prototype.addEntireFileDownloadOption=function(uri,label,format){var fileType;fileType=format?Utils.Files.simplifyMimeType(format):this.getFileExtension(uri),label||(label=this.content.entireFileAsOriginal),fileType&&(label+=" ("+fileType+")"),this.$downloadOptions.append('<li><a href="'+uri+'" target="_blank" download tabindex="0">'+label+"</li>")},DownloadDialogue.prototype.resetDynamicDownloadOptions=function(){this.renderingUrls=[],this.renderingUrlsCount=0,this.$downloadOptions.find("li.dynamic").remove()},DownloadDialogue.prototype.getDownloadOptionsForRenderings=function(resource,defaultLabel,type){var downloadOptions=[];if(!resource)return downloadOptions;for(var renderings=resource.getRenderings(),i=0;i<renderings.length;i++){var rendering=renderings[i];if(rendering){var label=manifesto_js_1.LanguageMap.getValue(rendering.getLabel(),this.extension.getLocale()),currentId="downloadOption"+ ++this.renderingUrlsCount;label?label+=" ({0})":label=defaultLabel;var mime=Utils.Files.simplifyMimeType(rendering.getFormat().toString());label=Utils.Strings.format(label,mime),this.renderingUrls[currentId]=rendering.id;var $button=$('<li class="option dynamic"><input id="'+currentId+'" data-mime="'+mime+'" title="'+label+'" type="radio" name="downloadOptions" tabindex="0" /><label for="'+currentId+'">'+label+"</label></li>");downloadOptions.push({type:type,button:$button})}}return downloadOptions},DownloadDialogue.prototype.getSelectedOption=function(){return this.$downloadOptions.find("li.option input:checked")},DownloadDialogue.prototype.getCurrentResourceId=function(){return this.extension.helper.getCurrentCanvas().externalResource.data.id},DownloadDialogue.prototype.getCurrentResourceFormat=function(){var id=this.getCurrentResourceId();return id.substr(id.lastIndexOf(".")+1).toLowerCase()},DownloadDialogue.prototype.updateNoneAvailable=function(){this.$downloadOptions.find("li:visible").length?this.$noneAvailable.hide():this.$noneAvailable.show()},DownloadDialogue.prototype.updateTermsOfUseButton=function(){var requiredStatement=this.extension.helper.getRequiredStatement();Utils.Bools.getBool(this.extension.data.config.options.termsOfUseEnabled,!1)&&requiredStatement&&requiredStatement.value?this.$termsOfUseButton.show():this.$termsOfUseButton.hide()},DownloadDialogue.prototype.getFileExtension=function(fileUri){var extension=fileUri.split(".").pop();return extension.length>5||-1!==extension.indexOf("/")?null:extension},DownloadDialogue.prototype.isMediaDownloadEnabled=function(){return this.extension.helper.isUIEnabled("mediaDownload")},DownloadDialogue.prototype.isDownloadOptionAvailable=function(option){return option!==DownloadOption_1.DownloadOption.ENTIRE_FILE_AS_ORIGINAL||this.isMediaDownloadEnabled()},DownloadDialogue.prototype.close=function(){_super.prototype.close.call(this)},DownloadDialogue.prototype.resize=function(){this.setDockedPosition()},DownloadDialogue}(Dialogue_1.Dialogue);exports.DownloadDialogue=DownloadDialogue}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("extensions/uv-av-extension/DownloadDialogue",["require","exports","../../modules/uv-dialogues-module/DownloadDialogue","../../modules/uv-shared-module/DownloadOption","../../modules/uv-shared-module/BaseEvents"],(function(require,exports,DownloadDialogue_1,DownloadOption_1,BaseEvents_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var DownloadDialogue=function(_super){function DownloadDialogue($element){return _super.call(this,$element)||this}return __extends(DownloadDialogue,_super),DownloadDialogue.prototype.create=function(){var _this=this;this.setConfig("downloadDialogue"),_super.prototype.create.call(this),this.$entireFileAsOriginal=$('<li class="option single"><input id="'+DownloadOption_1.DownloadOption.ENTIRE_FILE_AS_ORIGINAL+'" type="radio" name="downloadOptions" tabindex="0" /><label id="'+DownloadOption_1.DownloadOption.ENTIRE_FILE_AS_ORIGINAL+'label" for="'+DownloadOption_1.DownloadOption.ENTIRE_FILE_AS_ORIGINAL+'"></label></li>'),this.$downloadOptions.append(this.$entireFileAsOriginal),this.$entireFileAsOriginal.hide(),this.$downloadButton=$('<a class="btn btn-primary" href="#" tabindex="0">'+this.content.download+"</a>"),this.$buttons.prepend(this.$downloadButton),this.$imageOptionsContainer=$('<li class="group image"></li>'),this.$imageOptions=$("<ul></ul>"),this.$imageOptionsContainer.append(this.$imageOptions),this.$canvasOptionsContainer=$('<li class="group canvas"></li>'),this.$canvasOptions=$("<ul></ul>"),this.$canvasOptionsContainer.append(this.$canvasOptions),this.$manifestOptionsContainer=$('<li class="group manifest"></li>'),this.$manifestOptions=$("<ul></ul>"),this.$manifestOptionsContainer.append(this.$manifestOptions);var that=this;this.$downloadButton.find(".btn-primary").on("click",(function(){_this.component.publish(BaseEvents_1.BaseEvents.EXIT_FULLSCREEN)})),this.$downloadButton.on("click",(function(e){e.preventDefault();var $selectedOption=that.getSelectedOption(),id=$selectedOption.attr("id"),label=$selectedOption.attr("title"),type=DownloadOption_1.DownloadOption.UNKNOWN;if(_this.renderingUrls[id])window.open(_this.renderingUrls[id]);else{var id_1=_this.getCurrentResourceId();window.open(id_1)}_this.component.publish(BaseEvents_1.BaseEvents.DOWNLOAD,{type:type,label:label}),_this.close()}))},DownloadDialogue.prototype._isAdaptive=function(){var format=this.getCurrentResourceFormat();return"mpd"===format||"m3u8"===format},DownloadDialogue.prototype.open=function(triggerButton){_super.prototype.open.call(this,triggerButton);var canvas=this.extension.helper.getCurrentCanvas();if(this.isDownloadOptionAvailable(DownloadOption_1.DownloadOption.ENTIRE_FILE_AS_ORIGINAL)&&!this._isAdaptive()){var $input=this.$entireFileAsOriginal.find("input"),$label=this.$entireFileAsOriginal.find("label"),label=Utils.Strings.format(this.content.entireFileAsOriginalWithFormat,this.getCurrentResourceFormat());$label.text(label),$input.prop("title",label),this.$entireFileAsOriginal.show()}if(this.resetDynamicDownloadOptions(),this.isDownloadOptionAvailable(DownloadOption_1.DownloadOption.RANGE_RENDERINGS)&&canvas.ranges&&canvas.ranges.length)for(var i=0;i<canvas.ranges.length;i++){var range=canvas.ranges[i],renderingOptions=this.getDownloadOptionsForRenderings(range,this.content.entireFileAsOriginal,DownloadOption_1.DownloadOption.CANVAS_RENDERINGS);this.addDownloadOptionsForRenderings(renderingOptions)}if(this.isDownloadOptionAvailable(DownloadOption_1.DownloadOption.IMAGE_RENDERINGS)){var images=canvas.getImages();images.length&&this.$downloadOptions.append(this.$imageOptionsContainer);for(i=0;i<images.length;i++){var renderingOptions=this.getDownloadOptionsForRenderings(images[i].getResource(),this.content.entireFileAsOriginal,DownloadOption_1.DownloadOption.IMAGE_RENDERINGS);this.addDownloadOptionsForRenderings(renderingOptions)}}this.isDownloadOptionAvailable(DownloadOption_1.DownloadOption.CANVAS_RENDERINGS)&&((renderingOptions=this.getDownloadOptionsForRenderings(canvas,this.content.entireFileAsOriginal,DownloadOption_1.DownloadOption.CANVAS_RENDERINGS)).length&&(this.$downloadOptions.append(this.$canvasOptionsContainer),this.addDownloadOptionsForRenderings(renderingOptions)));this.isDownloadOptionAvailable(DownloadOption_1.DownloadOption.MANIFEST_RENDERINGS)&&((renderingOptions=this.getDownloadOptionsForRenderings(this.extension.helper.getCurrentSequence(),this.content.entireDocument,DownloadOption_1.DownloadOption.MANIFEST_RENDERINGS)).length||(renderingOptions=this.getDownloadOptionsForRenderings(this.extension.helper.manifest,this.content.entireDocument,DownloadOption_1.DownloadOption.MANIFEST_RENDERINGS)),renderingOptions.length&&(this.$downloadOptions.append(this.$manifestOptionsContainer),this.addDownloadOptionsForRenderings(renderingOptions)));this.$downloadOptions.length&&this.$entireFileAsOriginal.hide(),this.$downloadOptions.find("li.option:visible").length?(this.$downloadOptions.find("li.option input:visible:first").prop("checked",!0),this.$noneAvailable.hide(),this.$downloadButton.show()):(this.$noneAvailable.show(),this.$downloadButton.hide()),this.resize()},DownloadDialogue.prototype.addDownloadOptionsForRenderings=function(renderingOptions){var _this=this;renderingOptions.forEach((function(option){switch(option.type){case DownloadOption_1.DownloadOption.IMAGE_RENDERINGS:_this.$imageOptions.append(option.button);break;case DownloadOption_1.DownloadOption.CANVAS_RENDERINGS:_this.$canvasOptions.append(option.button);break;case DownloadOption_1.DownloadOption.MANIFEST_RENDERINGS:_this.$manifestOptions.append(option.button)}}))},DownloadDialogue.prototype.isDownloadOptionAvailable=function(option){return this.isMediaDownloadEnabled()},DownloadDialogue}(DownloadDialogue_1.DownloadDialogue);exports.DownloadDialogue=DownloadDialogue}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-shared-module/FooterPanel",["require","exports","./BaseEvents","./BaseView"],(function(require,exports,BaseEvents_1,BaseView_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var FooterPanel=function(_super){function FooterPanel($element){return _super.call(this,$element)||this}return __extends(FooterPanel,_super),FooterPanel.prototype.create=function(){var _this=this;this.setConfig("footerPanel"),_super.prototype.create.call(this),this.component.subscribe(BaseEvents_1.BaseEvents.TOGGLE_FULLSCREEN,(function(){_this.updateFullScreenButton()})),this.component.subscribe(BaseEvents_1.BaseEvents.METRIC_CHANGED,(function(){_this.updateMinimisedButtons(),_this.updateMoreInfoButton()})),this.component.subscribe(BaseEvents_1.BaseEvents.SETTINGS_CHANGED,(function(){_this.updateDownloadButton()})),this.$options=$('<div class="options"></div>'),this.$element.append(this.$options),this.$feedbackButton=$('\n          <button class="feedback btn imageBtn" title="'+this.content.feedback+'" tabindex="0">\n            <i class="uv-icon uv-icon-feedback" aria-hidden="true"></i>'+this.content.feedback+"\n          </button>\n        "),this.$options.prepend(this.$feedbackButton),this.$openButton=$('\n          <button class="open btn imageBtn" title="'+this.content.open+'" tabindex="0">\n            <i class="uv-icon-open" aria-hidden="true"></i>'+this.content.open+"\n          </button>\n        "),this.$options.prepend(this.$openButton),this.$bookmarkButton=$('\n          <button class="bookmark btn imageBtn" title="'+this.content.bookmark+'" tabindex="0">\n            <i class="uv-icon uv-icon-bookmark" aria-hidden="true"></i>'+this.content.bookmark+"\n          </button>\n        "),this.$options.prepend(this.$bookmarkButton),this.$shareButton=$('\n          <button class="share btn imageBtn" title="'+this.content.share+'" tabindex="0">\n            <i class="uv-icon uv-icon-share" aria-hidden="true"></i>'+this.content.share+"\n          </button>\n        "),this.$options.append(this.$shareButton),this.$embedButton=$('\n          <button class="embed btn imageBtn" title="'+this.content.embed+'" tabindex="0">\n            <i class="uv-icon uv-icon-embed" aria-hidden="true"></i>'+this.content.embed+"\n          </button>\n        "),this.$options.append(this.$embedButton),this.$downloadButton=$('\n          <button class="download btn imageBtn" title="'+this.content.download+'" tabindex="0">\n            <i class="uv-icon uv-icon-download" aria-hidden="true"></i>'+this.content.download+"\n          </button>\n        "),this.$options.prepend(this.$downloadButton),this.$moreInfoButton=$('\n          <button class="moreInfo btn imageBtn" title="'+this.content.moreInfo+'" tabindex="0">\n            <i class="uv-icon uv-icon-more-info" aria-hidden="true"></i>'+this.content.moreInfo+"\n          </button>\n        "),this.$options.prepend(this.$moreInfoButton),this.$fullScreenBtn=$('\n          <button class="fullScreen btn imageBtn" title="'+this.content.fullScreen+'" tabindex="0">\n            <i class="uv-icon uv-icon-fullscreen" aria-hidden="true"></i>'+this.content.fullScreen+"\n          </button>\n        "),this.$options.append(this.$fullScreenBtn),this.$openButton.onPressed((function(){_this.component.publish(BaseEvents_1.BaseEvents.OPEN)})),this.$feedbackButton.onPressed((function(){_this.component.publish(BaseEvents_1.BaseEvents.FEEDBACK)})),this.$bookmarkButton.onPressed((function(){_this.component.publish(BaseEvents_1.BaseEvents.BOOKMARK)})),this.$shareButton.onPressed((function(){_this.component.publish(BaseEvents_1.BaseEvents.SHOW_SHARE_DIALOGUE,_this.$shareButton)})),this.$embedButton.onPressed((function(){_this.component.publish(BaseEvents_1.BaseEvents.SHOW_EMBED_DIALOGUE,_this.$embedButton)})),this.$downloadButton.onPressed((function(){_this.component.publish(BaseEvents_1.BaseEvents.SHOW_DOWNLOAD_DIALOGUE,_this.$downloadButton)})),this.$moreInfoButton.onPressed((function(){_this.component.publish(BaseEvents_1.BaseEvents.SHOW_MOREINFO_DIALOGUE,_this.$moreInfoButton)})),this.$fullScreenBtn.on("click",(function(e){e.preventDefault(),_this.component.publish(BaseEvents_1.BaseEvents.TOGGLE_FULLSCREEN)})),Utils.Bools.getBool(this.options.embedEnabled,!0)||this.$embedButton.hide(),this.updateMoreInfoButton(),this.updateOpenButton(),this.updateFeedbackButton(),this.updateBookmarkButton(),this.updateEmbedButton(),this.updateDownloadButton(),this.updateFullScreenButton(),this.updateShareButton(),this.updateMinimisedButtons()},FooterPanel.prototype.updateMinimisedButtons=function(){Utils.Bools.getBool(this.options.minimiseButtons,!1)?this.$options.addClass("minimiseButtons"):this.extension.isDesktopMetric()?this.$options.removeClass("minimiseButtons"):this.$options.addClass("minimiseButtons")},FooterPanel.prototype.updateMoreInfoButton=function(){!Utils.Bools.getBool(this.options.moreInfoEnabled,!1)||this.extension.isDesktopMetric()||this.extension.isCatchAllMetric()?this.$moreInfoButton.hide():this.$moreInfoButton.show()},FooterPanel.prototype.updateOpenButton=function(){Utils.Bools.getBool(this.options.openEnabled,!1)&&Utils.Documents.isInIFrame()?this.$openButton.show():this.$openButton.hide()},FooterPanel.prototype.updateFullScreenButton=function(){Utils.Bools.getBool(this.options.fullscreenEnabled,!0)&&Utils.Documents.supportsFullscreen()?(this.extension.data.isLightbox&&this.$fullScreenBtn.addClass("lightbox"),this.extension.isFullScreen()?(this.$fullScreenBtn.switchClass("fullScreen","exitFullscreen"),this.$fullScreenBtn.find("i").switchClass("uv-icon-fullscreen","uv-icon-exit-fullscreen"),this.$fullScreenBtn.attr("title",this.content.exitFullScreen),$(this.$fullScreenBtn[0].firstChild.nextSibling.nextSibling).replaceWith(this.content.exitFullScreen)):(this.$fullScreenBtn.switchClass("exitFullscreen","fullScreen"),this.$fullScreenBtn.find("i").switchClass("uv-icon-exit-fullscreen","uv-icon-fullscreen"),this.$fullScreenBtn.attr("title",this.content.fullScreen),$(this.$fullScreenBtn[0].firstChild.nextSibling.nextSibling).replaceWith(this.content.fullScreen))):this.$fullScreenBtn.hide()},FooterPanel.prototype.updateEmbedButton=function(){this.extension.helper.isUIEnabled("embed")&&Utils.Bools.getBool(this.options.embedEnabled,!1)?this.extension.isMobile()||this.$embedButton.show():this.$embedButton.hide()},FooterPanel.prototype.updateShareButton=function(){this.extension.helper.isUIEnabled("share")&&Utils.Bools.getBool(this.options.shareEnabled,!0)?this.$shareButton.show():this.$shareButton.hide()},FooterPanel.prototype.updateDownloadButton=function(){Utils.Bools.getBool(this.options.downloadEnabled,!0)?this.$downloadButton.show():this.$downloadButton.hide()},FooterPanel.prototype.updateFeedbackButton=function(){Utils.Bools.getBool(this.options.feedbackEnabled,!1)?this.$feedbackButton.show():this.$feedbackButton.hide()},FooterPanel.prototype.updateBookmarkButton=function(){Utils.Bools.getBool(this.options.bookmarkEnabled,!1)?this.$bookmarkButton.show():this.$bookmarkButton.hide()},FooterPanel.prototype.resize=function(){_super.prototype.resize.call(this)},FooterPanel}(BaseView_1.BaseView);exports.FooterPanel=FooterPanel}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-avmobilefooterpanel-module/MobileFooter",["require","exports","../uv-shared-module/FooterPanel"],(function(require,exports,FooterPanel_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var FooterPanel=function(_super){function FooterPanel($element){return _super.call(this,$element)||this}return __extends(FooterPanel,_super),FooterPanel.prototype.create=function(){this.setConfig("mobileFooterPanel"),_super.prototype.create.call(this)},FooterPanel.prototype.resize=function(){_super.prototype.resize.call(this),this.$options.css("left",Math.floor(this.$element.width()/2-this.$options.width()/2))},FooterPanel}(FooterPanel_1.FooterPanel);exports.FooterPanel=FooterPanel})),define("modules/uv-shared-module/Information",["require","exports"],(function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Information=function(message,actions){this.message=message,this.actions=actions};exports.Information=Information})),define("modules/uv-shared-module/InformationAction",["require","exports"],(function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var InformationAction=function(){};exports.InformationAction=InformationAction})),define("modules/uv-shared-module/InformationFactory",["require","exports","./BaseEvents","./Information","./InformationAction","./InformationType"],(function(require,exports,BaseEvents_1,Information_1,InformationAction_1,InformationType_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var InformationFactory=function(){function InformationFactory(extension){this.extension=extension}return InformationFactory.prototype.Get=function(args){var _this=this;switch(args.informationType){case InformationType_1.InformationType.AUTH_CORS_ERROR:return new Information_1.Information(this.extension.data.config.content.authCORSError,[]);case InformationType_1.InformationType.DEGRADED_RESOURCE:var actions=[],loginAction=new InformationAction_1.InformationAction,label=args.param.loginService.getConfirmLabel();label||(label=this.extension.data.config.content.fallbackDegradedLabel),loginAction.label=label;var resource_1=args.param;loginAction.action=function(){resource_1.authHoldingPage=window.open("","_blank"),_this.extension.component.publish(BaseEvents_1.BaseEvents.HIDE_INFORMATION),_this.extension.component.publish(BaseEvents_1.BaseEvents.OPEN_EXTERNAL_RESOURCE,[[resource_1]])},actions.push(loginAction);var message=args.param.loginService.getServiceLabel();return message||(message=this.extension.data.config.content.fallbackDegradedMessage),new Information_1.Information(message,actions)}},InformationFactory}();exports.InformationFactory=InformationFactory}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-shared-module/HeaderPanel",["require","exports","./BaseEvents","./BaseView","../uv-shared-module/InformationFactory"],(function(require,exports,BaseEvents_1,BaseView_1,InformationFactory_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var HeaderPanel=function(_super){function HeaderPanel($element){return _super.call(this,$element,!1,!1)||this}return __extends(HeaderPanel,_super),HeaderPanel.prototype.create=function(){var _this=this;this.setConfig("headerPanel"),_super.prototype.create.call(this),this.component.subscribe(BaseEvents_1.BaseEvents.SHOW_INFORMATION,(function(args){_this.showInformation(args)})),this.component.subscribe(BaseEvents_1.BaseEvents.HIDE_INFORMATION,(function(){_this.hideInformation()})),this.$options=$('<div class="options"></div>'),this.$element.append(this.$options),this.$centerOptions=$('<div class="centerOptions"></div>'),this.$options.append(this.$centerOptions),this.$rightOptions=$('<div class="rightOptions"></div>'),this.$options.append(this.$rightOptions),this.$localeToggleButton=$('<a class="localeToggle" tabindex="0"></a>'),this.$rightOptions.append(this.$localeToggleButton),this.$settingsButton=$('\n          <button class="btn imageBtn settings" tabindex="0" title="'+this.content.settings+'">\n            <i class="uv-icon-settings" aria-hidden="true"></i>'+this.content.settings+"\n          </button>\n        "),this.$settingsButton.attr("title",this.content.settings),this.$rightOptions.append(this.$settingsButton),this.$informationBox=$('<div class="informationBox" aria-hidden="true">                                     <div class="message"></div>                                     <div class="actions"></div>                                     <button type="button" class="close" aria-label="Close">                                         <span aria-hidden="true">&#215;</span>                                    </button>                                   </div>'),this.$element.append(this.$informationBox),this.$informationBox.hide(),this.$informationBox.find(".close").attr("title",this.content.close),this.$informationBox.find(".close").on("click",(function(e){e.preventDefault(),_this.component.publish(BaseEvents_1.BaseEvents.HIDE_INFORMATION)})),this.$localeToggleButton.on("click",(function(){_this.extension.changeLocale(String(_this.$localeToggleButton.data("locale")))})),this.$settingsButton.onPressed((function(){_this.component.publish(BaseEvents_1.BaseEvents.SHOW_SETTINGS_DIALOGUE)})),Utils.Bools.getBool(this.options.centerOptionsEnabled,!0)||this.$centerOptions.hide(),this.updateLocaleToggle(),this.updateSettingsButton()},HeaderPanel.prototype.updateLocaleToggle=function(){if(this.localeToggleIsVisible()){var alternateLocale=this.extension.getAlternateLocale(),text=alternateLocale.name.split("-")[0].toUpperCase();this.$localeToggleButton.data("locale",alternateLocale.name),this.$localeToggleButton.attr("title",alternateLocale.label),this.$localeToggleButton.text(text)}else this.$localeToggleButton.hide()},HeaderPanel.prototype.updateSettingsButton=function(){Utils.Bools.getBool(this.options.settingsButtonEnabled,!0)?this.$settingsButton.show():this.$settingsButton.hide()},HeaderPanel.prototype.localeToggleIsVisible=function(){var locales=this.extension.data.locales;return!!locales&&(locales.length>1&&Utils.Bools.getBool(this.options.localeToggleEnabled,!1))},HeaderPanel.prototype.showInformation=function(args){var informationFactory=new InformationFactory_1.InformationFactory(this.extension);this.information=informationFactory.Get(args),this.component.publish(BaseEvents_1.BaseEvents.INFO_DISPLAYED,[this.information]),this.$informationBox.find(".message").html(this.information.message).find("a").attr("target","_top");var $actions=this.$informationBox.find(".actions");$actions.empty();for(var i=0;i<this.information.actions.length;i++){var action=this.information.actions[i],$action=$('<a href="#" class="btn btn-default">'+action.label+"</a>");$action.on("click",action.action),$actions.append($action)}this.$informationBox.attr("aria-hidden","false"),this.$informationBox.show(),this.$element.addClass("showInformation"),this.extension.resize()},HeaderPanel.prototype.hideInformation=function(){this.$element.removeClass("showInformation"),this.$informationBox.attr("aria-hidden","true"),this.$informationBox.hide(),this.extension.resize()},HeaderPanel.prototype.getSettings=function(){return this.extension.getSettings()},HeaderPanel.prototype.updateSettings=function(settings){this.extension.updateSettings(settings),this.component.publish(BaseEvents_1.BaseEvents.UPDATE_SETTINGS,settings)},HeaderPanel.prototype.resize=function(){_super.prototype.resize.call(this);var pos=this.$element.width()/2-this.$centerOptions.outerWidth()/2;if(this.$centerOptions.css({left:pos}),this.$informationBox.is(":visible")){var $actions=this.$informationBox.find(".actions"),$message=this.$informationBox.find(".message");$message.width(Math.floor(this.$element.width())-Math.ceil($message.horizontalMargins())-Math.ceil($actions.outerWidth(!0))-Math.ceil(this.$informationBox.find(".close").outerWidth(!0))-2),$message.text(this.information.message)}this.extension.width()<this.extension.data.config.options.minWidthBreakPoint?this.localeToggleIsVisible()&&this.$localeToggleButton.hide():this.localeToggleIsVisible()&&this.$localeToggleButton.show()},HeaderPanel}(BaseView_1.BaseView);exports.HeaderPanel=HeaderPanel})),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("IIIFMetadataComponent",[],t):"object"==typeof exports?exports.IIIFMetadataComponent=t():e.IIIFMetadataComponent=t()}("undefined"!=typeof self?self:this,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o,a=n(2),s=n(3),u=n(4);!function(e){e.LINES="lines",e.CHARS="chars"}(o=t.LimitType||(t.LimitType={}));var c=function(e){function t(t){var n=e.call(this,t)||this;return n._data=n.data(),n._data=n.options.data,n._init(),n._resize(),n}return i(t,e),t.prototype._init=function(){return e.prototype._init.call(this),this._$element=$(this.el),this._$metadataGroupTemplate=$('<div class="group">          <div class="header"></div>          <div class="items"></div>      </div>'),this._$metadataItemTemplate=$('<div class="item">          <div class="label"></div>          <div class="values"></div>      </div>'),this._$metadataItemValueTemplate=$('<div class="value"></div>'),this._$metadataItemURIValueTemplate=$('<a class="value" href="" target="_blank"></a>'),this._$copyTextTemplate=$('<div class="copyText" alt="'+this.options.data.content.copyToClipboard+'" title="'+this.options.data.content.copyToClipboard+'">        <div class="copiedText">'+this.options.data.content.copiedToClipboard+" </div>        </div>"),this._$metadataGroups=$('<div class="groups"></div>'),this._$element.append(this._$metadataGroups),this._$noData=$('<div class="noData">'+this.options.data.content.noData+"</div>"),this._$element.append(this._$noData),!0},t.prototype.data=function(){return{aggregateValues:"",canvases:null,canvasDisplayOrder:"",metadataGroupOrder:"",canvasExclude:"",canvasLabels:"",content:{attribution:"Attribution",canvasHeader:"About the canvas",copiedToClipboard:"Copied to clipboard",copyToClipboard:"Copy to clipboard",description:"Description",imageHeader:"About the image",less:"less",license:"License",logo:"Logo",manifestHeader:"About the item",more:"more",noData:"No data to display",rangeHeader:"About the range",sequenceHeader:"About the sequence"},copiedMessageDuration:2e3,copyToClipboardEnabled:!1,helper:null,licenseFormatter:null,limit:4,limitType:o.LINES,limitToRange:!1,manifestDisplayOrder:"",manifestExclude:"",range:null,rtlLanguageCodes:"ar, ara, dv, div, he, heb, ur, urd",sanitizer:function(e){return e},showAllLanguages:!1}},t.prototype._getManifestGroup=function(){return this._metadataGroups.filter((function(e){return e.resource.isManifest()}))[0]},t.prototype._getCanvasGroups=function(){return this._metadataGroups.filter((function(e){return e.resource.isCanvas()}))},t.prototype.set=function(e){var t=this;if(this._data=Object.assign(this._data,e),this._data&&this._data.helper){var n,r={canvases:this._data.canvases,licenseFormatter:this._data.licenseFormatter,range:this._data.range};if(this._metadataGroups=this._data.helper.getMetadata(r),this._data.manifestDisplayOrder&&((n=this._getManifestGroup()).items=this._sortItems(n.items,this._readCSV(this._data.manifestDisplayOrder))),this._data.canvasDisplayOrder&&this._getCanvasGroups().forEach((function(e,n){e.items=t._sortItems(e.items,t._readCSV(t._data.canvasDisplayOrder))})),this._data.metadataGroupOrder&&(this._metadataGroups=this._sortGroups(this._metadataGroups,this._readCSV(this._data.metadataGroupOrder))),this._data.canvasLabels&&this._label(this._getCanvasGroups(),this._readCSV(this._data.canvasLabels,!1)),this._data.manifestExclude&&((n=this._getManifestGroup()).items=this._exclude(n.items,this._readCSV(this._data.manifestExclude))),this._data.canvasExclude&&this._getCanvasGroups().forEach((function(e,n){e.items=t._exclude(e.items,t._readCSV(t._data.canvasExclude))})),this._data.limitToRange){var i=[];this._metadataGroups.forEach((function(e,t){e.resource.isRange()&&i.push(e)})),i.length&&(this._metadataGroups=i)}this._render()}},t.prototype._sortItems=function(e,t){var n=this,r=[],i=e.slice(0);return t.forEach((function(e,t){var o=i.filter((function(t){return n._normalise(t.getLabel())===e}))[0];if(o){r.push(o);var a=i.indexOf(o);a>-1&&i.splice(a,1)}})),i.forEach((function(e,t){r.push(e)})),r},t.prototype._sortGroups=function(e,t){var n=[],r=e.slice(0);return t.forEach((function(e,t){var i=r.filter((function(t){return t.resource.getIIIFResourceType().toLowerCase()==e.toLowerCase()}))[0];if(i){n.push(i);var o=r.indexOf(i);o>-1&&r.splice(o,1)}})),n},t.prototype._label=function(e,t){e.forEach((function(e,n){e.label=t[n]}))},t.prototype._exclude=function(e,t){var n=this;return t.forEach((function(t,r){var i=e.filter((function(e){return n._normalise(e.getLabel())===t}))[0];if(i){var o=e.indexOf(i);o>-1&&e.splice(o,1)}})),e},t.prototype._normalise=function(e){return e?e.toLowerCase().replace(/ /g,""):null},t.prototype._render=function(){var e=this;this._metadataGroups.length?(this._$noData.hide(),this._$metadataGroups.empty(),this._metadataGroups.forEach((function(t,n){var r=e._buildMetadataGroup(t);e._$metadataGroups.append(r);var i=r.find(".value");e._data.limit&&e._data.content&&(e._data.limitType===o.LINES?i.toggleExpandTextByLines(e._data.limit,e._data.content.less,e._data.content.more,(function(){})):e._data.limitType===o.CHARS&&i.ellipsisHtmlFixed(e._data.limit,(function(){})))}))):this._$noData.show()},t.prototype._buildMetadataGroup=function(e){var t=this._$metadataGroupTemplate.clone(),n=t.find(">.header");if(this._data.content)if(e.resource.isManifest()&&this._data.content.manifestHeader)(i=this._sanitize(this._data.content.manifestHeader))&&n.html(i);else if(e.resource.isSequence()&&this._data.content.sequenceHeader)(i=this._sanitize(this._data.content.sequenceHeader))&&n.html(i);else if(e.resource.isRange()&&this._data.content.rangeHeader)(i=this._sanitize(this._data.content.rangeHeader))&&n.html(i);else if(e.resource.isCanvas()&&(e.label||this._data.content.canvasHeader)){var r=e.label||this._data.content.canvasHeader;n.html(this._sanitize(r))}else if(e.resource.isAnnotation()&&this._data.content.imageHeader){var i;(i=this._sanitize(this._data.content.imageHeader))&&n.html(i)}n.text()||n.hide();for(var o=t.find(".items"),a=0;a<e.items.length;a++){var s=e.items[a],u=this._buildMetadataItem(s);o.append(u)}return t},t.prototype._buildMetadataItem=function(e){var t,n=this._$metadataItemTemplate.clone(),r=n.find(".label"),i=n.find(".values"),o=e.getLabel(),a=o,s=new RegExp("/w+:(/?/?)[^s]+/gm","i");if(this._data.content&&a&&e.isRootLevel)switch(a.toLowerCase()){case"attribution":a=this._data.content.attribution;break;case"description":a=this._data.content.description;break;case"license":a=this._data.content.license;break;case"logo":a=this._data.content.logo}if(a=this._sanitize(a),r.html(a),this._addReadingDirection(r,this._getLabelLocale(e)),n.addClass(u.Strings.toCssClass(a)),o&&"license"===o.toLowerCase()&&null!==s.exec(e.value[0].value))t=this._buildMetadataItemURIValue(e.value[0].value),i.append(t);else if(this._data.showAllLanguages&&e.value&&e.value.length>1)for(var c=0;c<e.value.length;c++){var p=e.value[c];t=this._buildMetadataItemValue(p.value,p.locale),i.append(t)}else{var f=this._getValueLocale(e),h=!1;for(c=0;c<e.value.length;c++){p=e.value[c];f.toLowerCase()===p.locale.toLowerCase()&&(h=!0,t=this._buildMetadataItemValue(p.value,p.locale),i.append(t))}h||(p=e.value[0])&&(t=this._buildMetadataItemValue(p.value,p.locale),i.append(t))}this._data.copyToClipboardEnabled&&u.Clipboard.supportsCopy()&&r.text()&&this._addCopyButton(n,r,i);var d=this;return n.on("click","a.iiif-viewer-link",(function(e){e.preventDefault();var t=$(e.target),n=t.attr("data-uv-navigate")||t.prop("href");d.fire(l.IIIF_VIEWER_LINK_CLICKED,n)})),n.on("click","[data-uv-navigate]",(function(e){e.preventDefault();var t=$(e.target).attr("data-uv-navigate")||null;t&&d.fire(l.IIIF_VIEWER_LINK_CLICKED,t)})),n},t.prototype._getLabelLocale=function(e){if(!this._data||!this._data.helper)return"";var t=this._data.helper.options.locale;if(e.label.length){var n=e.label[0].locale;if(n.toLowerCase()!==t.toLowerCase())return n}return t},t.prototype._getValueLocale=function(e){return this._data&&this._data.helper?this._data.helper.options.locale:""},t.prototype._buildMetadataItemValue=function(e,t){e=(e=this._sanitize(e)).replace("\n","<br>");var n=this._$metadataItemValueTemplate.clone();return n.html(e),n.find("a").each((function(){var e=$(this);e.hasClass("iiif-viewer-link")||e.prop("target","_blank")})),t&&this._addReadingDirection(n,t),n},t.prototype._buildMetadataItemURIValue=function(e){e=this._sanitize(e);var t=this._$metadataItemURIValueTemplate.clone();return t.prop("href",e),t.text(e),t},t.prototype._addReadingDirection=function(e,t){t=a.Utils.getInexactLocale(t),this._readCSV(this._data.rtlLanguageCodes).filter((function(e){return e===t})).length>0&&(e.prop("dir","rtl"),e.addClass("rtl"))},t.prototype._addCopyButton=function(e,t,n){var r=this._$copyTextTemplate.clone(),i=r.children();t.append(r),u.Device.isTouch()?r.show():(e.on("mouseenter",(function(){r.show()})),e.on("mouseleave",(function(){r.hide()})),r.on("mouseleave",(function(){i.hide()})));var o=this,a=n.text();r.on("click",(function(e){o._copyItemValues(r,a)}))},t.prototype._copyItemValues=function(e,t){u.Clipboard.copy(t);var n=e.find(".copiedText");n.show(),setTimeout((function(){n.hide()}),this._data.copiedMessageDuration)},t.prototype._readCSV=function(e,t){void 0===t&&(t=!0);var n=[];if(e&&(n=e.split(","),t))for(var r=0;r<n.length;r++)n[r]=this._normalise(n[r]);return n},t.prototype._sanitize=function(e){return this._data.sanitizer?this._data.sanitizer(e):null},t.prototype._resize=function(){},t}(s.BaseComponent);t.MetadataComponent=c;var l=function(){function e(){}return e.IIIF_VIEWER_LINK_CLICKED="iiifViewerLinkClicked",e}();t.Events=l},function(e,t,n){"undefined"!=typeof self&&self,e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(6)),r(n(7)),r(n(8)),r(n(9)),r(n(10)),r(n(11)),r(n(12)),r(n(13)),r(n(14)),r(n(15)),r(n(16)),r(n(17)),r(n(18)),r(n(19)),r(n(20)),r(n(21)),r(n(22)),r(n(23)),r(n(24)),r(n(25)),r(n(26)),r(n(27)),r(n(28)),r(n(29)),r(n(30)),r(n(31)),r(n(32)),r(n(2))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.BOOKMARKING="oa:bookmarking",e.CLASSIFYING="oa:classifying",e.COMMENTING="oa:commenting",e.DESCRIBING="oa:describing",e.EDITING="oa:editing",e.HIGHLIGHTING="oa:highlighting",e.IDENTIFYING="oa:identifying",e.LINKING="oa:linking",e.MODERATING="oa:moderating",e.PAINTING="sc:painting",e.QUESTIONING="oa:questioning",e.REPLYING="oa:replying",e.TAGGING="oa:tagging",e.TRANSCRIBING="oad:transcribing"}(t.AnnotationMotivation||(t.AnnotationMotivation={})),function(e){e.AUTO_ADVANCE="auto-advance",e.CONTINUOUS="continuous",e.FACING_PAGES="facing-pages",e.HIDDEN="hidden",e.INDIVIDUALS="individuals",e.MULTI_PART="multi-part",e.NO_NAV="no-nav",e.NON_PAGED="non-paged",e.PAGED="paged",e.REPEAT="repeat",e.SEQUENCE="sequence",e.THUMBNAIL_NAV="thumbnail-nav",e.TOGETHER="together",e.UNORDERED="unordered"}(t.Behavior||(t.Behavior={})),function(e){e.CANVAS="canvas",e.CHOICE="choice",e.CONTENT_AS_TEXT="contentastext",e.DOCUMENT="document",e.IMAGE="image",e.MOVING_IMAGE="movingimage",e.PDF="pdf",e.PHYSICAL_OBJECT="physicalobject",e.SOUND="sound",e.TEXTUALBODY="textualbody",e.VIDEO="video"}(t.ExternalResourceType||(t.ExternalResourceType={})),function(e){e.ANNOTATION="annotation",e.CANVAS="canvas",e.COLLECTION="collection",e.MANIFEST="manifest",e.RANGE="range",e.SEQUENCE="sequence"}(t.IIIFResourceType||(t.IIIFResourceType={})),function(e){e.AUDIO_MP4="audio/mp4",e.CORTO="application/corto",e.DRACO="application/draco",e.GLTF="model/gltf+json",e.JPG="image/jpeg",e.M3U8="application/vnd.apple.mpegurl",e.MP3="audio/mp3",e.MPEG_DASH="application/dash+xml",e.OBJ="text/plain",e.PDF="application/pdf",e.PLY="application/ply",e.THREEJS="application/vnd.threejs+json",e.VIDEO_MP4="video/mp4",e.WEBM="video/webm"}(t.MediaType||(t.MediaType={})),function(e){e.DOC="application/msword",e.DOCX="application/vnd.openxmlformats-officedocument.wordprocessingml.document",e.PDF="application/pdf"}(t.RenderingFormat||(t.RenderingFormat={})),function(e){e.IMAGE_0_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0",e.IMAGE_0_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1",e.IMAGE_0_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2",e.IMAGE_0_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0",e.IMAGE_0_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1",e.IMAGE_0_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2",e.IMAGE_1_COMPLIANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",e.IMAGE_1_COMPLIANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",e.IMAGE_1_COMPLIANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",e.IMAGE_1_CONFORMANCE_LEVEL_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",e.IMAGE_1_CONFORMANCE_LEVEL_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",e.IMAGE_1_CONFORMANCE_LEVEL_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",e.IMAGE_1_LEVEL_0="http://iiif.io/api/image/1/level0.json",e.IMAGE_1_PROFILE_LEVEL_0="http://iiif.io/api/image/1/profiles/level0.json",e.IMAGE_1_LEVEL_1="http://iiif.io/api/image/1/level1.json",e.IMAGE_1_PROFILE_LEVEL_1="http://iiif.io/api/image/1/profiles/level1.json",e.IMAGE_1_LEVEL_2="http://iiif.io/api/image/1/level2.json",e.IMAGE_1_PROFILE_LEVEL_2="http://iiif.io/api/image/1/profiles/level2.json",e.IMAGE_2_LEVEL_0="http://iiif.io/api/image/2/level0.json",e.IMAGE_2_PROFILE_LEVEL_0="http://iiif.io/api/image/2/profiles/level0.json",e.IMAGE_2_LEVEL_1="http://iiif.io/api/image/2/level1.json",e.IMAGE_2_PROFILE_LEVEL_1="http://iiif.io/api/image/2/profiles/level1.json",e.IMAGE_2_LEVEL_2="http://iiif.io/api/image/2/level2.json",e.IMAGE_2_PROFILE_LEVEL_2="http://iiif.io/api/image/2/profiles/level2.json",e.AUTH_0_CLICK_THROUGH="http://iiif.io/api/auth/0/login/clickthrough",e.AUTH_0_LOGIN="http://iiif.io/api/auth/0/login",e.AUTH_0_LOGOUT="http://iiif.io/api/auth/0/logout",e.AUTH_0_RESTRICTED="http://iiif.io/api/auth/0/login/restricted",e.AUTH_0_TOKEN="http://iiif.io/api/auth/0/token",e.AUTH_1_CLICK_THROUGH="http://iiif.io/api/auth/1/clickthrough",e.AUTH_1_EXTERNAL="http://iiif.io/api/auth/1/external",e.AUTH_1_KIOSK="http://iiif.io/api/auth/1/kiosk",e.AUTH_1_LOGIN="http://iiif.io/api/auth/1/login",e.AUTH_1_LOGOUT="http://iiif.io/api/auth/1/logout",e.AUTH_1_PROBE="http://iiif.io/api/auth/1/probe",e.AUTH_1_TOKEN="http://iiif.io/api/auth/1/token",e.SEARCH_0="http://iiif.io/api/search/0/search",e.SEARCH_0_AUTO_COMPLETE="http://iiif.io/api/search/0/autocomplete",e.SEARCH_1="http://iiif.io/api/search/1/search",e.SEARCH_1_AUTO_COMPLETE="http://iiif.io/api/search/1/autocomplete",e.TRACKING_EXTENSIONS="http://universalviewer.io/tracking-extensions-profile",e.UI_EXTENSIONS="http://universalviewer.io/ui-extensions-profile",e.PRINT_EXTENSIONS="http://universalviewer.io/print-extensions-profile",e.SHARE_EXTENSIONS="http://universalviewer.io/share-extensions-profile",e.OTHER_MANIFESTATIONS="http://iiif.io/api/otherManifestations.json",e.IXIF="http://wellcomelibrary.org/ld/ixif/0/alpha.json"}(t.ServiceProfile||(t.ServiceProfile={})),function(e){e.BOTTOM_TO_TOP="bottom-to-top",e.LEFT_TO_RIGHT="left-to-right",e.RIGHT_TO_LEFT="right-to-left",e.TOP_TO_BOTTOM="top-to-bottom"}(t.ViewingDirection||(t.ViewingDirection={})),function(e){e.CONTINUOUS="continuous",e.INDIVIDUALS="individuals",e.NON_PAGED="non-paged",e.PAGED="paged",e.TOP="top"}(t.ViewingHint||(t.ViewingHint={}))},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=n(1),s=n(33);n(34);var u=function(){function e(){}return e.getMediaType=function(e){return(e=(e=e.toLowerCase()).split(";")[0]).trim()},e.getImageQuality=function(e){return e===a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1||e===a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2||e===a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_1||e===a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2||e===a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1||e===a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2||e===a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1||e===a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2||e===a.ServiceProfile.IMAGE_1_LEVEL_1||e===a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1||e===a.ServiceProfile.IMAGE_1_LEVEL_2||e===a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2?"native":"default"},e.getInexactLocale=function(e){return-1!==e.indexOf("-")?e.substr(0,e.indexOf("-")):e},e.getLocalisedValue=function(e,t){if(!Array.isArray(e))return e;for(var n=0;n<e.length;n++){var r=e[n];if(t===r["@language"])return r["@value"]}var i=t.substr(0,t.indexOf("-"));for(n=0;n<e.length;n++){var o=e[n];if(o["@language"]===i)return o["@value"]}return null},e.generateTreeNodeIds=function(t,n){var r;void 0===n&&(n=0),r=t.parentNode?t.parentNode.id+"-"+n:"0",t.id=r;for(var i=0;i<t.nodes.length;i++){var o=t.nodes[i];e.generateTreeNodeIds(o,i)}},e.normaliseType=function(e){return-1!==(e=e.toLowerCase()).indexOf(":")?e.split(":")[1]:e},e.normaliseUrl=function(e){return-1!==(e=e.substr(e.indexOf("://"))).indexOf("#")&&(e=e.split("#")[0]),e},e.normalisedUrlsMatch=function(t,n){return e.normaliseUrl(t)===e.normaliseUrl(n)},e.isImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_PROFILE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_PROFILE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_PROFILE_LEVEL_2))},e.isLevel0ImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_LEVEL_0)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_PROFILE_LEVEL_0))},e.isLevel1ImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_LEVEL_1)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_PROFILE_LEVEL_1))},e.isLevel2ImageProfile=function(t){return!!(e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_COMPLIANCE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_0_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_CONFORMANCE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_1_PROFILE_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_LEVEL_2)||e.normalisedUrlsMatch(t,a.ServiceProfile.IMAGE_2_PROFILE_LEVEL_2))},e.parseManifest=function(e,t){return o.Deserialiser.parse(e,t)},e.checkStatus=function(e){if(e.ok)return e;var t=new Error(e.statusText);return t.response=e,Promise.reject(t)},e.loadManifest=function(t){return new Promise((function(n){fetch(t).then(e.checkStatus).then((function(e){return e.json()})).then((function(e){n(e)}))}))},e.loadExternalResourcesAuth1=function(t,n,r,i,o,a,s,u){return new Promise((function(c,l){var p=t.map((function(t){return e.loadExternalResourceAuth1(t,n,r,i,o,a,s,u)}));Promise.all(p).then((function(){c(t)})).catch((function(e){l(e)}))}))},e.loadExternalResourceAuth1=function(t,n,o,a,u,c,l,p){return r(this,void 0,void 0,(function(){var r;return i(this,(function(i){switch(i.label){case 0:return[4,a(t)];case 1:return(r=i.sent())?[4,t.getData(r)]:[3,6];case 2:return i.sent(),t.status!==s.OK?[3,3]:[2,t];case 3:return[4,e.doAuthChain(t,n,o,u,c,l,p)];case 4:i.sent(),i.label=5;case 5:if(t.status===s.OK||t.status===s.MOVED_TEMPORARILY)return[2,t];throw e.createAuthorizationFailedError();case 6:return[4,t.getData()];case 7:return i.sent(),t.status!==s.MOVED_TEMPORARILY&&t.status!==s.UNAUTHORIZED?[3,9]:[4,e.doAuthChain(t,n,o,u,c,l,p)];case 8:i.sent(),i.label=9;case 9:if(t.status===s.OK||t.status===s.MOVED_TEMPORARILY)return[2,t];throw e.createAuthorizationFailedError()}}))}))},e.doAuthChain=function(t,n,o,a,u,c,l){return r(this,void 0,void 0,(function(){var r,p,f,h,d,_,g,v;return i(this,(function(i){switch(i.label){case 0:return t.isAccessControlled()?((r=t.externalService)&&(r.options=t.options),(p=t.kioskService)&&(p.options=t.options),(f=t.clickThroughService)&&(f.options=t.options),(h=t.loginService)&&(h.options=t.options),t.isResponseHandled||t.status!==s.MOVED_TEMPORARILY?[3,2]:[4,c(t)]):[2,t];case 1:case 3:case 6:case 10:case 14:return i.sent(),[2,t];case 2:return d=null,_=null,(d=r)?(_=d,[4,e.attemptResourceWithToken(t,o,d)]):[3,4];case 4:return(d=p)?(_=d,(g=n(d))?[4,a(g)]:[3,7]):[3,7];case 5:case 9:case 13:return i.sent(),[4,e.attemptResourceWithToken(t,o,d)];case 7:return(d=f)?(_=d,[4,u(t,d)]):[3,11];case 8:return(v=i.sent())?[4,a(v)]:[3,11];case 11:return(d=h)?(_=d,[4,u(t,d)]):[3,15];case 12:return(v=i.sent())?[4,a(v)]:[3,15];case 15:return _&&l(t,_),[2]}}))}))},e.attemptResourceWithToken=function(e,t,n){return r(this,void 0,void 0,(function(){var r,o;return i(this,(function(i){switch(i.label){case 0:return(r=n.getService(a.ServiceProfile.AUTH_1_TOKEN))?[4,t(e,r)]:[3,3];case 1:return(o=i.sent())&&o.accessToken?[4,e.getData(o)]:[3,3];case 2:return i.sent(),[2,e];case 3:return[2]}}))}))},e.loadExternalResourcesAuth09=function(t,n,r,i,o,a,s,u,c,l){return new Promise((function(p,f){var h=t.map((function(t){return e.loadExternalResourceAuth09(t,n,r,i,o,a,s,u,c,l)}));Promise.all(h).then((function(){p(t)})).catch((function(e){f(e)}))}))},e.loadExternalResourceAuth09=function(t,n,r,i,o,a,u,c,l,p){return new Promise((function(f,h){p&&p.pessimisticAccessControl?t.getData().then((function(){t.isAccessControlled()?t.clickThroughService?(f(r(t)),f(i(t))):o(t).then((function(){a(t,!0).then((function(n){t.getData(n).then((function(){f(l(t))})).catch((function(t){h(e.createInternalServerError(t))}))})).catch((function(t){h(e.createInternalServerError(t))}))})).catch((function(t){h(e.createInternalServerError(t))})):f(t)})).catch((function(t){h(e.createInternalServerError(t))})):c(t,n).then((function(p){p?t.getData(p).then((function(){t.status===s.OK?f(l(t)):e.authorize(t,n,r,i,o,a,u,c).then((function(){f(l(t))})).catch((function(t){h(e.createAuthorizationFailedError())}))})).catch((function(t){h(e.createAuthorizationFailedError())})):e.authorize(t,n,r,i,o,a,u,c).then((function(){f(l(t))})).catch((function(t){h(e.createAuthorizationFailedError())}))})).catch((function(t){h(e.createAuthorizationFailedError())}))}))},e.createError=function(e,t){var n=new Error;return n.message=t,n.name=String(e),n},e.createAuthorizationFailedError=function(){return e.createError(o.StatusCode.AUTHORIZATION_FAILED,"Authorization failed")},e.createRestrictedError=function(){return e.createError(o.StatusCode.RESTRICTED,"Restricted")},e.createInternalServerError=function(t){return e.createError(o.StatusCode.INTERNAL_SERVER_ERROR,t)},e.authorize=function(t,n,r,i,o,a,u,c){return new Promise((function(l,p){t.getData().then((function(){t.isAccessControlled()?c(t,n).then((function(c){c?t.getData(c).then((function(){t.status===s.OK?l(t):e.showAuthInteraction(t,n,r,i,o,a,u,l,p)})).catch((function(t){p(e.createInternalServerError(t))})):a(t,!1).then((function(c){c?u(t,c,n).then((function(){t.getData(c).then((function(){t.status===s.OK?l(t):e.showAuthInteraction(t,n,r,i,o,a,u,l,p)})).catch((function(t){p(e.createInternalServerError(t))}))})).catch((function(t){p(e.createInternalServerError(t))})):e.showAuthInteraction(t,n,r,i,o,a,u,l,p)}))})).catch((function(t){p(e.createInternalServerError(t))})):l(t)}))}))},e.showAuthInteraction=function(t,n,r,i,o,a,u,c,l){t.status!==s.MOVED_TEMPORARILY||t.isResponseHandled?t.clickThroughService&&!t.isResponseHandled?r(t).then((function(){a(t,!0).then((function(r){u(t,r,n).then((function(){t.getData(r).then((function(){c(t)})).catch((function(t){l(e.createInternalServerError(t))}))})).catch((function(t){l(e.createInternalServerError(t))}))})).catch((function(t){l(e.createInternalServerError(t))}))})):o(t).then((function(){a(t,!0).then((function(r){u(t,r,n).then((function(){t.getData(r).then((function(){c(t)})).catch((function(t){l(e.createInternalServerError(t))}))})).catch((function(t){l(e.createInternalServerError(t))}))})).catch((function(t){l(e.createInternalServerError(t))}))})):c(t)},e.getService=function(e,t){for(var n=this.getServices(e),r=0;r<n.length;r++){var i=n[r];if(i.getProfile()===t)return i}return null},e.getResourceById=function(t,n){return e.traverseAndFind(t.__jsonld,"@id",n)},e.traverseAndFind=function(t,n,r){if(t.hasOwnProperty(n)&&t[n]===r)return t;for(var i=0;i<Object.keys(t).length;i++)if("object"==typeof t[Object.keys(t)[i]]){var o=e.traverseAndFind(t[Object.keys(t)[i]],n,r);if(null!=o)return o}},e.getServices=function(e){var t,n=[];if(!(t=e.__jsonld?e.__jsonld.service:e.service))return n;Array.isArray(t)||(t=[t]);for(var r=0;r<t.length;r++){var i=t[r];if("string"==typeof i){var a=this.getResourceById(e.options.resource,i);a&&n.push(new o.Service(a.__jsonld||a,e.options))}else n.push(new o.Service(i,e.options))}return n},e.getTemporalComponent=function(e){var t=/t=([^&]+)/g.exec(e),n=null;return t&&t[1]&&(n=t[1].split(",")),n},e}();t.Utils=u},function(e,t,n){"use strict";n.r(t),t.default=function(e,t){return t=t||{},new Promise((function(n,r){var i=new XMLHttpRequest,o=[],a=[],s={},u=function(){return{ok:2==(i.status/100|0),statusText:i.statusText,status:i.status,url:i.responseURL,text:function(){return Promise.resolve(i.responseText)},json:function(){return Promise.resolve(JSON.parse(i.responseText))},blob:function(){return Promise.resolve(new Blob([i.response]))},clone:u,headers:{keys:function(){return o},entries:function(){return a},get:function(e){return s[e.toLowerCase()]},has:function(e){return e.toLowerCase()in s}}}};for(var c in i.open(t.method||"get",e,!0),i.onload=function(){i.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,(function(e,t,n){o.push(t=t.toLowerCase()),a.push([t,n]),s[t]=s[t]?s[t]+","+n:n})),n(u())},i.onerror=r,i.withCredentials="include"==t.credentials,t.headers)i.setRequestHeader(c,t.headers[c]);i.send(t.body||null)}))}},function(e,t,n){e.exports=n(5)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(0));var r=n(2);t.loadManifest=function(e){return r.Utils.loadManifest(e)},t.parseManifest=function(e,t){return r.Utils.parseManifest(e,t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.__jsonld=e,this.context=this.getProperty("context"),this.id=this.getProperty("id")}return e.prototype.getProperty=function(e){var t=null;return this.__jsonld&&((t=this.__jsonld[e])||(t=this.__jsonld["@"+e])),t},e}();t.JSONLDResource=r},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=n(1),s=function(e){function t(t,n){var r=e.call(this,t)||this;return r.options=n,r}return i(t,e),t.prototype.getIIIFResourceType=function(){return o.Utils.normaliseType(this.getProperty("type"))},t.prototype.getLabel=function(){var e=this.getProperty("label");return e?o.LanguageMap.parse(e,this.options.locale):[]},t.prototype.getDefaultLabel=function(){return o.LanguageMap.getValue(this.getLabel())},t.prototype.getMetadata=function(){var e=this.getProperty("metadata"),t=[];if(!e)return t;for(var n=0;n<e.length;n++){var r=e[n],i=new o.LabelValuePair(this.options.locale);i.parse(r),t.push(i)}return t},t.prototype.getRendering=function(e){for(var t=this.getRenderings(),n=0;n<t.length;n++){var r=t[n];if(r.getFormat()===e)return r}return null},t.prototype.getRenderings=function(){var e,t=[];if(!(e=this.__jsonld?this.__jsonld.rendering:this.rendering))return t;Array.isArray(e)||(e=[e]);for(var n=0;n<e.length;n++){var r=e[n];t.push(new o.Rendering(r,this.options))}return t},t.prototype.getService=function(e){return o.Utils.getService(this,e)},t.prototype.getServices=function(){return o.Utils.getServices(this)},t.prototype.getThumbnail=function(){var e=this.getProperty("thumbnail");return Array.isArray(e)&&(e=e[0]),e?new o.Thumbnail(e,this.options):null},t.prototype.isAnnotation=function(){return this.getIIIFResourceType()===a.IIIFResourceType.ANNOTATION},t.prototype.isCanvas=function(){return this.getIIIFResourceType()===a.IIIFResourceType.CANVAS},t.prototype.isCollection=function(){return this.getIIIFResourceType()===a.IIIFResourceType.COLLECTION},t.prototype.isManifest=function(){return this.getIIIFResourceType()===a.IIIFResourceType.MANIFEST},t.prototype.isRange=function(){return this.getIIIFResourceType()===a.IIIFResourceType.RANGE},t.prototype.isSequence=function(){return this.getIIIFResourceType()===a.IIIFResourceType.SEQUENCE},t}(o.JSONLDResource);t.ManifestResource=s},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=function(e){function t(t,n){return e.call(this,t,n)||this}return i(t,e),t.prototype.getFormat=function(){var e=this.getProperty("format");return e?e.toLowerCase():null},t.prototype.getResources=function(){var e=[];if(!this.__jsonld.resources)return e;for(var t=0;t<this.__jsonld.resources.length;t++){var n=this.__jsonld.resources[t],r=new o.Annotation(n,this.options);e.push(r)}return e},t.prototype.getType=function(){var e=this.getProperty("type");return e?o.Utils.normaliseType(e):null},t.prototype.getWidth=function(){return this.getProperty("width")},t.prototype.getHeight=function(){return this.getProperty("height")},t.prototype.getMaxWidth=function(){return this.getProperty("maxWidth")},t.prototype.getMaxHeight=function(){return this.getProperty("maxHeight")?null:this.getMaxWidth()},t}(o.ManifestResource);t.Resource=a},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=n(1),s=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.index=-1,r.isLoaded=!1;var i={defaultLabel:"-",locale:"en-GB",resource:r,pessimisticAccessControl:!1};return r.options=Object.assign(i,n),r}return i(t,e),t.prototype.getAttribution=function(){var e=this.getProperty("attribution");return e?o.LanguageMap.parse(e,this.options.locale):[]},t.prototype.getDescription=function(){var e=this.getProperty("description");return e?o.LanguageMap.parse(e,this.options.locale):[]},t.prototype.getIIIFResourceType=function(){return o.Utils.normaliseType(this.getProperty("type"))},t.prototype.getLogo=function(){var e=this.getProperty("logo");return e?"string"==typeof e?e:(Array.isArray(e)&&e.length&&(e=e[0]),e["@id"]||e.id):null},t.prototype.getLicense=function(){return o.Utils.getLocalisedValue(this.getProperty("license"),this.options.locale)},t.prototype.getNavDate=function(){return new Date(this.getProperty("navDate"))},t.prototype.getRelated=function(){return this.getProperty("related")},t.prototype.getSeeAlso=function(){return this.getProperty("seeAlso")},t.prototype.getTrackingLabel=function(){var e=this.getService(a.ServiceProfile.TRACKING_EXTENSIONS);return e?e.getProperty("trackingLabel"):""},t.prototype.getDefaultTree=function(){return this.defaultTree=new o.TreeNode("root"),this.defaultTree.data=this,this.defaultTree},t.prototype.getRequiredStatement=function(){var e=null,t=this.getProperty("requiredStatement");if(t)(e=new o.LabelValuePair(this.options.locale)).parse(t);else{var n=this.getAttribution();n&&((e=new o.LabelValuePair(this.options.locale)).value=n)}return e},t.prototype.isCollection=function(){return this.getIIIFResourceType()===a.IIIFResourceType.COLLECTION},t.prototype.isManifest=function(){return this.getIIIFResourceType()===a.IIIFResourceType.MANIFEST},t.prototype.load=function(){var e=this;return new Promise((function(t){if(e.isLoaded)t(e);else{var n=e.options;n.navDate=e.getNavDate();var r=e.__jsonld.id;r||(r=e.__jsonld["@id"]),o.Utils.loadManifest(r).then((function(r){e.parentLabel=o.LanguageMap.getValue(e.getLabel(),n.locale);var i=o.Deserialiser.parse(r,n);(e=Object.assign(e,i)).index=n.index,t(e)}))}}))},t}(o.ManifestResource);t.IIIFResource=s},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=function(e){function t(t,n){return e.call(this,t,n)||this}return i(t,e),t.prototype.getBody=function(){var e=[],t=this.getProperty("body");if(t)if(Array.isArray(t))for(var n=0;n<t.length;n++)if((a=t[n]).items)for(var r=0;r<a.items.length;r++){var i=a.items[r];e.push(new o.AnnotationBody(i,this.options))}else e.push(new o.AnnotationBody(a,this.options));else if(t.items)for(n=0;n<t.items.length;n++){var a=t.items[n];e.push(new o.AnnotationBody(a,this.options))}else e.push(new o.AnnotationBody(t,this.options));return e},t.prototype.getMotivation=function(){return this.getProperty("motivation")||null},t.prototype.getOn=function(){return this.getProperty("on")},t.prototype.getTarget=function(){return this.getProperty("target")},t.prototype.getResource=function(){return new o.Resource(this.getProperty("resource"),this.options)},t}(o.ManifestResource);t.Annotation=a},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=function(e){function t(t,n){return e.call(this,t,n)||this}return i(t,e),t.prototype.getFormat=function(){var e=this.getProperty("format");return e?o.Utils.getMediaType(e):null},t.prototype.getType=function(){return this.getProperty("type")?o.Utils.normaliseType(this.getProperty("type")):null},t.prototype.getWidth=function(){return this.getProperty("width")},t.prototype.getHeight=function(){return this.getProperty("height")},t}(o.ManifestResource);t.AnnotationBody=a},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=function(e){function t(t,n,r){var i=e.call(this,n)||this;return i.label=t,i.options=r,i}return i(t,e),t.prototype.getIIIFResourceType=function(){return o.Utils.normaliseType(this.getProperty("type"))},t.prototype.getLabel=function(){return this.label},t.prototype.getResources=function(){var e=this;return this.getProperty("resources").map((function(t){return new o.Annotation(t,e.options)}))},t.prototype.load=function(){var e=this;return new Promise((function(t,n){if(e.isLoaded)t(e);else{var r=e.__jsonld.id;r||(r=e.__jsonld["@id"]),o.Utils.loadManifest(r).then((function(n){e.__jsonld=n,e.context=e.getProperty("context"),e.id=e.getProperty("id"),e.isLoaded=!0,t(e)})).catch(n)}}))},t}(o.JSONLDResource);t.AnnotationList=a},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,n){return e.call(this,t,n)||this}return i(t,e),t.prototype.getItems=function(){return this.getProperty("items")},t}(n(0).ManifestResource);t.AnnotationPage=o},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=function(e){function t(t,n){return e.call(this,t,n)||this}return i(t,e),t.prototype.getCanonicalImageUri=function(e){var t,n=null,r="default",i=e;if(this.externalResource&&this.externalResource.data&&this.externalResource.data["@id"])n=this.externalResource.data["@id"],i||(i=this.externalResource.data.width),this.externalResource.data["@context"]&&(this.externalResource.data["@context"].indexOf("/1.0/context.json")>-1||this.externalResource.data["@context"].indexOf("/1.1/context.json")>-1||this.externalResource.data["@context"].indexOf("/1/context.json")>-1)&&(r="native");else{var a=this.getImages();if(a&&a.length){var s=a[0].getResource(),u=s.getServices();if(i||(i=s.getWidth()),u.length){var c=u[0];n=c.id,r=o.Utils.getImageQuality(c.getProfile())}else if(i===s.getWidth())return s.id}if(!n){var l=this.getProperty("thumbnail");if(l){if("string"==typeof l)return l;if(l["@id"])return l["@id"];if(l.length)return l[0].id}}}return t=i+",",n&&n.endsWith("/")&&(n=n.substr(0,n.length-1)),[n,"full",t,0,r+".jpg"].join("/")},t.prototype.getMaxDimensions=function(){var e,t=null;return this.externalResource&&this.externalResource.data&&this.externalResource.data.profile&&(e=this.externalResource.data.profile,Array.isArray(e)&&(e=e.filter((function(e){return e.maxWidth}))[0])&&(t=new o.Size(e.maxWidth,e.maxHeight?e.maxHeight:e.maxWidth))),t},t.prototype.getContent=function(){var e=[],t=this.__jsonld.items||this.__jsonld.content;if(!t)return e;var n=null;if(t.length&&(n=new o.AnnotationPage(t[0],this.options)),!n)return e;for(var r=n.getItems(),i=0;i<r.length;i++){var a=r[i],s=new o.Annotation(a,this.options);e.push(s)}return e},t.prototype.getDuration=function(){return this.getProperty("duration")},t.prototype.getImages=function(){var e=[];if(!this.__jsonld.images)return e;for(var t=0;t<this.__jsonld.images.length;t++){var n=this.__jsonld.images[t],r=new o.Annotation(n,this.options);e.push(r)}return e},t.prototype.getIndex=function(){return this.getProperty("index")},t.prototype.getOtherContent=function(){var e=this,t=(Array.isArray(this.getProperty("otherContent"))?this.getProperty("otherContent"):[this.getProperty("otherContent")]).filter((function(e){return e&&"string"==typeof(t=e["@type"])&&t.toLowerCase()==t.toLowerCase();var t})).map((function(t,n){return new o.AnnotationList(t.label||"Annotation list "+n,t,e.options)})).map((function(e){return e.load()}));return Promise.all(t)},t.prototype.getWidth=function(){return this.getProperty("width")},t.prototype.getHeight=function(){return this.getProperty("height")},t}(o.Resource);t.Canvas=a},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(0),s=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.items=[],r._collections=null,r._manifests=null,t.__collection=r,r}return i(t,e),t.prototype.getCollections=function(){return this._collections?this._collections:this._collections=this.items.filter((function(e){return e.isCollection()}))},t.prototype.getManifests=function(){return this._manifests?this._manifests:this._manifests=this.items.filter((function(e){return e.isManifest()}))},t.prototype.getCollectionByIndex=function(e){for(var t,n=this.getCollections(),r=0;r<n.length;r++){var i=n[r];i.index===e&&(t=i)}if(t)return t.options.index=e,t.load();throw new Error("Collection index not found")},t.prototype.getManifestByIndex=function(e){for(var t,n=this.getManifests(),r=0;r<n.length;r++){var i=n[r];i.index===e&&(t=i)}if(t)return t.options.index=e,t.load();throw new Error("Manifest index not found")},t.prototype.getTotalCollections=function(){return this.getCollections().length},t.prototype.getTotalManifests=function(){return this.getManifests().length},t.prototype.getTotalItems=function(){return this.items.length},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?this.getProperty("viewingDirection"):o.ViewingDirection.LEFT_TO_RIGHT},t.prototype.getDefaultTree=function(){return e.prototype.getDefaultTree.call(this),this.defaultTree.data.type=a.Utils.normaliseType(a.TreeNodeType.COLLECTION),this._parseManifests(this),this._parseCollections(this),a.Utils.generateTreeNodeIds(this.defaultTree),this.defaultTree},t.prototype._parseManifests=function(e){if(e.getManifests()&&e.getManifests().length)for(var t=0;t<e.getManifests().length;t++){var n=e.getManifests()[t],r=n.getDefaultTree();r.label=n.parentLabel||a.LanguageMap.getValue(n.getLabel(),this.options.locale)||"manifest "+(t+1),r.navDate=n.getNavDate(),r.data.id=n.id,r.data.type=a.Utils.normaliseType(a.TreeNodeType.MANIFEST),e.defaultTree.addNode(r)}},t.prototype._parseCollections=function(e){if(e.getCollections()&&e.getCollections().length)for(var t=0;t<e.getCollections().length;t++){var n=e.getCollections()[t],r=n.getDefaultTree();r.label=n.parentLabel||a.LanguageMap.getValue(n.getLabel(),this.options.locale)||"collection "+(t+1),r.navDate=n.getNavDate(),r.data.id=n.id,r.data.type=a.Utils.normaliseType(a.TreeNodeType.COLLECTION),e.defaultTree.addNode(r)}},t}(a.IIIFResource);t.Collection=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.start=e,this.end=t}return e.prototype.getLength=function(){return this.end-this.start},e}();t.Duration=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=function(){function e(e){this.defaultLocale=e}return e.prototype.parse=function(e){this.resource=e,this.label=r.LanguageMap.parse(this.resource.label,this.defaultLocale),this.value=r.LanguageMap.parse(this.resource.value,this.defaultLocale)},e.prototype.getLabel=function(){return this.label?r.LanguageMap.getValue(this.label,this.defaultLocale):null},e.prototype.setLabel=function(e){var t=this;if(this.label&&this.label.length){var n=this.label.filter((function(e){return e.locale===t.defaultLocale||e.locale===r.Utils.getInexactLocale(t.defaultLocale)}))[0];n&&(n.value=e)}},e.prototype.getValue=function(){if(this.value){var e=this.defaultLocale;return this.label&&this.label.length&&this.label[0].locale&&(e=this.label[0].locale),r.LanguageMap.getValue(this.value,e)}return null},e.prototype.setValue=function(e){var t=this;if(this.value&&this.value.length){var n=this.value.filter((function(e){return e.locale===t.defaultLocale||e.locale===r.Utils.getInexactLocale(t.defaultLocale)}))[0];n&&(n.value=e)}},e}();t.LabelValuePair=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Language=function(e,t){Array.isArray(e)?1===e.length?this.value=e[0]:this.value=e.join("<br/>"):this.value=e,this.locale=t}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.parse=function(e,t){var n,r=[];if(!e)return r;if(Array.isArray(e))for(var i=0;i<e.length;i++){var a=e[i];n="string"==typeof a?new o.Language(a,t):new o.Language(a["@value"],a["@language"]||t),r.push(n)}else{if("string"==typeof e)return n=new o.Language(e,t),r.push(n),r;e["@value"]?(n=new o.Language(e["@value"],e["@language"]||t),r.push(n)):Object.keys(e).forEach((function(t){if(!e[t].length)throw new Error("language must have a value");n=new o.Language(e[t],t),r.push(n)}))}return r},t.getValue=function(e,t){if(e.length){if(t){var n=e.filter((function(e){return e.locale===t||o.Utils.getInexactLocale(e.locale)===o.Utils.getInexactLocale(t)}))[0];if(n)return n.value}return e[0].value}return null},t}(Array);t.LanguageMap=a},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(0),s=function(e){function t(t,n){var r=e.call(this,t,n)||this;if(r.index=0,r._allRanges=null,r.items=[],r._topRanges=[],r.__jsonld.structures&&r.__jsonld.structures.length)for(var i=r._getTopRanges(),o=0;o<i.length;o++){var a=i[o];r._parseRanges(a,String(o))}return r}return i(t,e),t.prototype.getPosterCanvas=function(){var e=this.getProperty("posterCanvas");return e&&(e=new a.Canvas(e,this.options)),e},t.prototype.getBehavior=function(){var e=this.getProperty("behavior");return Array.isArray(e)&&(e=e[0]),e||null},t.prototype.getDefaultTree=function(){if(e.prototype.getDefaultTree.call(this),this.defaultTree.data.type=a.Utils.normaliseType(a.TreeNodeType.MANIFEST),!this.isLoaded)return this.defaultTree;var t=this.getTopRanges();return t.length&&t[0].getTree(this.defaultTree),a.Utils.generateTreeNodeIds(this.defaultTree),this.defaultTree},t.prototype._getTopRanges=function(){var e=[];if(this.__jsonld.structures&&this.__jsonld.structures.length){for(var t=0;t<this.__jsonld.structures.length;t++){var n=this.__jsonld.structures[t];n.viewingHint===o.ViewingHint.TOP&&e.push(n)}if(!e.length){var r={};r.ranges=this.__jsonld.structures,e.push(r)}}return e},t.prototype.getTopRanges=function(){return this._topRanges},t.prototype._getRangeById=function(e){if(this.__jsonld.structures&&this.__jsonld.structures.length)for(var t=0;t<this.__jsonld.structures.length;t++){var n=this.__jsonld.structures[t];if(n["@id"]===e||n.id===e)return n}return null},t.prototype._parseRanges=function(e,t,n){var r,i=null;if("string"==typeof e&&(i=e,e=this._getRangeById(i)),e){(r=new a.Range(e,this.options)).parentRange=n,r.path=t,n?n.items.push(r):this._topRanges.push(r);var o=e.items||e.members;if(o)for(var s=0;s<o.length;s++){var u=o[s];if(u["@type"]&&"sc:range"===u["@type"].toLowerCase()||u.type&&"range"===u.type.toLowerCase())this._parseRanges(u,t+"/"+s,r);else if(u["@type"]&&"sc:canvas"===u["@type"].toLowerCase()||u.type&&"canvas"===u.type.toLowerCase()){r.canvases||(r.canvases=[]);var c=u.id||u["@id"];r.canvases.push(c)}}else if(e.ranges)for(s=0;s<e.ranges.length;s++)this._parseRanges(e.ranges[s],t+"/"+s,r)}else console.warn("Range:",i,"does not exist")},t.prototype.getAllRanges=function(){if(null!=this._allRanges)return this._allRanges;this._allRanges=[];for(var e=this.getTopRanges(),t=function(t){var r=e[t];r.id&&n._allRanges.push(r);var i=function(e,t){e.add(t);var n=t.getRanges();return n.length?n.reduce(i,e):e},o=Array.from(r.getRanges().reduce(i,new Set));n._allRanges=n._allRanges.concat(o)},n=this,r=0;r<e.length;r++)t(r);return this._allRanges},t.prototype.getRangeById=function(e){for(var t=this.getAllRanges(),n=0;n<t.length;n++){var r=t[n];if(r.id===e)return r}return null},t.prototype.getRangeByPath=function(e){for(var t=this.getAllRanges(),n=0;n<t.length;n++){var r=t[n];if(r.path===e)return r}return null},t.prototype.getSequences=function(){if(this.items.length)return this.items;var e=this.__jsonld.mediaSequences||this.__jsonld.sequences;if(e)for(var t=0;t<e.length;t++){var n=e[t],r=new a.Sequence(n,this.options);this.items.push(r)}else this.__jsonld.items&&(r=new a.Sequence(this.__jsonld.items,this.options),this.items.push(r));return this.items},t.prototype.getSequenceByIndex=function(e){return this.getSequences()[e]},t.prototype.getTotalSequences=function(){return this.getSequences().length},t.prototype.getManifestType=function(){var e=this.getService(o.ServiceProfile.UI_EXTENSIONS);return e?e.getProperty("manifestType"):a.ManifestType.EMPTY},t.prototype.isMultiSequence=function(){return this.getTotalSequences()>1},t.prototype.isPagingEnabled=function(){var e=this.getViewingHint();if(e)return e===o.ViewingHint.PAGED;var t=this.getBehavior();return!!t&&t===o.Behavior.PAGED},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t}(a.IIIFResource);t.Manifest=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.EMPTY="",e.MANUSCRIPT="manuscript",e.MONOGRAPH="monograph"}(t.ManifestType||(t.ManifestType={}))},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=n(1),s=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r._ranges=null,r.canvases=null,r.items=[],r}return i(t,e),t.prototype.getCanvasIds=function(){return this.__jsonld.canvases?this.__jsonld.canvases:this.canvases?this.canvases:[]},t.prototype.getDuration=function(){var e,t;if(this.canvases&&this.canvases.length)for(var n=0;n<this.canvases.length;n++){var r=this.canvases[n],i=o.Utils.getTemporalComponent(r);i&&i.length>1&&(0===n&&(e=Number(i[0])),n===this.canvases.length-1&&(t=Number(i[1])))}else{var a=this.getRanges();for(n=0;n<a.length;n++){var s=a[n].getDuration();s&&(0===n&&(e=s.start),n===a.length-1&&(t=s.end))}}if(void 0!==e&&void 0!==t)return new o.Duration(e,t)},t.prototype.getRanges=function(){return this._ranges?this._ranges:this._ranges=this.items.filter((function(e){return e.isRange()}))},t.prototype.getBehavior=function(){var e=this.getProperty("behavior");return Array.isArray(e)&&(e=e[0]),e||null},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t.prototype.getTree=function(e){e.data=this,this.treeNode=e;var t=this.getRanges();if(t&&t.length)for(var n=0;n<t.length;n++){var r=t[n],i=new o.TreeNode;e.addNode(i),this._parseTreeNode(i,r)}return o.Utils.generateTreeNodeIds(e),e},t.prototype.spansTime=function(e){var t=this.getDuration();return!!(t&&e>=t.start&&e<=t.end)},t.prototype._parseTreeNode=function(e,t){e.label=o.LanguageMap.getValue(t.getLabel(),this.options.locale),e.data=t,e.data.type=o.Utils.normaliseType(o.TreeNodeType.RANGE),t.treeNode=e;var n=t.getRanges();if(n&&n.length)for(var r=0;r<n.length;r++){var i=n[r];if(i.getBehavior()!==a.Behavior.NO_NAV){var s=new o.TreeNode;e.addNode(s),this._parseTreeNode(s,i)}}},t}(o.ManifestResource);t.Range=s},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,n){return e.call(this,t,n)||this}return i(t,e),t.prototype.getFormat=function(){return this.getProperty("format")},t}(n(0).ManifestResource);t.Rendering=o},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(0),s=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.items=[],r._thumbnails=null,r}return i(t,e),t.prototype.getCanvases=function(){if(this.items.length)return this.items;var e=this.__jsonld.canvases||this.__jsonld.elements;if(e)for(var t=0;t<e.length;t++){var n=e[t];(r=new a.Canvas(n,this.options)).index=t,this.items.push(r)}else if(this.__jsonld)for(t=0;t<this.__jsonld.length;t++){var r;n=this.__jsonld[t],(r=new a.Canvas(n,this.options)).index=t,this.items.push(r)}return this.items},t.prototype.getCanvasById=function(e){for(var t=0;t<this.getTotalCanvases();t++){var n=this.getCanvasByIndex(t),r=a.Utils.normaliseUrl(n.id);if(a.Utils.normaliseUrl(e)===r)return n}return null},t.prototype.getCanvasByIndex=function(e){return this.getCanvases()[e]},t.prototype.getCanvasIndexById=function(e){for(var t=0;t<this.getTotalCanvases();t++)if(this.getCanvasByIndex(t).id===e)return t;return null},t.prototype.getCanvasIndexByLabel=function(e,t){e=e.trim(),isNaN(e)||(e=parseInt(e,10).toString(),t&&(e+="r"));for(var n,r,i,o=/(\d*)\D+(\d*)/,s=0;s<this.getTotalCanvases();s++){var u=this.getCanvasByIndex(s);if(a.LanguageMap.getValue(u.getLabel(),this.options.locale)===e)return s;if((n=o.exec(e))&&(r=n[1],(i=n[2])&&new RegExp("^"+r+"\\D+"+i+"$").test(u.getLabel().toString())))return s}return-1},t.prototype.getLastCanvasLabel=function(e){for(var t=this.getTotalCanvases()-1;t>=0;t--){var n=this.getCanvasByIndex(t),r=a.LanguageMap.getValue(n.getLabel(),this.options.locale);if(e){if(/^[a-zA-Z0-9]*$/.test(r))return r}else if(r)return r}return this.options.defaultLabel},t.prototype.getLastPageIndex=function(){return this.getTotalCanvases()-1},t.prototype.getNextPageIndex=function(e,t){var n;if(t){var r=this.getPagedIndices(e),i=this.getViewingDirection();n=i&&i===o.ViewingDirection.RIGHT_TO_LEFT?r[0]+1:r[r.length-1]+1}else n=e+1;return n>this.getLastPageIndex()?-1:n},t.prototype.getPagedIndices=function(e,t){var n=[];if(t){n=this.isFirstCanvas(e)||this.isLastCanvas(e)?[e]:e%2?[e,e+1]:[e-1,e];var r=this.getViewingDirection();r&&r===o.ViewingDirection.RIGHT_TO_LEFT&&(n=n.reverse())}else n.push(e);return n},t.prototype.getPrevPageIndex=function(e,t){var n;if(t){var r=this.getPagedIndices(e),i=this.getViewingDirection();n=i&&i===o.ViewingDirection.RIGHT_TO_LEFT?r[r.length-1]-1:r[0]-1}else n=e-1;return n},t.prototype.getStartCanvasIndex=function(){var e=this.getStartCanvas();if(e)for(var t=0;t<this.getTotalCanvases();t++)if(this.getCanvasByIndex(t).id===e)return t;return 0},t.prototype.getThumbs=function(e,t){for(var n=[],r=this.getTotalCanvases(),i=0;i<r;i++){var o=this.getCanvasByIndex(i),s=new a.Thumb(e,o);n.push(s)}return n},t.prototype.getThumbnails=function(){if(null!=this._thumbnails)return this._thumbnails;this._thumbnails=[];for(var e=this.getCanvases(),t=0;t<e.length;t++){var n=e[t].getThumbnail();n&&this._thumbnails.push(n)}return this._thumbnails},t.prototype.getStartCanvas=function(){return this.getProperty("startCanvas")},t.prototype.getTotalCanvases=function(){return this.getCanvases().length},t.prototype.getViewingDirection=function(){return this.getProperty("viewingDirection")?this.getProperty("viewingDirection"):this.options.resource.getViewingDirection?this.options.resource.getViewingDirection():null},t.prototype.getViewingHint=function(){return this.getProperty("viewingHint")},t.prototype.isCanvasIndexOutOfRange=function(e){return e>this.getTotalCanvases()-1},t.prototype.isFirstCanvas=function(e){return 0===e},t.prototype.isLastCanvas=function(e){return e===this.getTotalCanvases()-1},t.prototype.isMultiCanvas=function(){return this.getTotalCanvases()>1},t.prototype.isPagingEnabled=function(){var e=this.getViewingHint();return!!e&&e===o.ViewingHint.PAGED},t.prototype.isTotalCanvasesEven=function(){return this.getTotalCanvases()%2==0},t}(a.ManifestResource);t.Sequence=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=function(){function e(){}return e.parse=function(e,t){return"string"==typeof e&&(e=JSON.parse(e)),this.parseJson(e,t)},e.parseJson=function(e,t){var n;if(t&&t.navDate&&!isNaN(t.navDate.getTime())&&(e.navDate=t.navDate.toString()),e["@type"])switch(e["@type"]){case"sc:Collection":n=this.parseCollection(e,t);break;case"sc:Manifest":n=this.parseManifest(e,t);break;default:return null}else switch(e.type){case"Collection":n=this.parseCollection(e,t);break;case"Manifest":n=this.parseManifest(e,t);break;default:return null}return n.isLoaded=!0,n},e.parseCollection=function(e,t){var n=new r.Collection(e,t);return t?(n.index=t.index||0,t.resource&&(n.parentCollection=t.resource.parentCollection)):n.index=0,this.parseCollections(n,t),this.parseManifests(n,t),this.parseItems(n,t),n},e.parseCollections=function(e,t){var n;if(e.__jsonld.collections?n=e.__jsonld.collections:e.__jsonld.items&&(n=e.__jsonld.items.filter((function(e){return"collection"===e.type.toLowerCase()}))),n)for(var r=0;r<n.length;r++){t&&(t.index=r);var i=this.parseCollection(n[r],t);i.index=r,i.parentCollection=e,e.items.push(i)}},e.parseManifest=function(e,t){return new r.Manifest(e,t)},e.parseManifests=function(e,t){var n;if(e.__jsonld.manifests?n=e.__jsonld.manifests:e.__jsonld.items&&(n=e.__jsonld.items.filter((function(e){return"manifest"===e.type.toLowerCase()}))),n)for(var r=0;r<n.length;r++){var i=this.parseManifest(n[r],t);i.index=r,i.parentCollection=e,e.items.push(i)}},e.parseItem=function(e,t){if(e["@type"]){if("sc:manifest"===e["@type"].toLowerCase())return this.parseManifest(e,t);if("sc:collection"===e["@type"].toLowerCase())return this.parseCollection(e,t)}else if(e.type){if("manifest"===e.type.toLowerCase())return this.parseManifest(e,t);if("collection"===e.type.toLowerCase())return this.parseCollection(e,t)}return null},e.parseItems=function(e,t){var n=e.__jsonld.members||e.__jsonld.items;if(n)for(var r=function(r){t&&(t.index=r);var o=i.parseItem(n[r],t);return o?e.items.filter((function(e){return e.id===o.id}))[0]?"continue":(o.index=r,o.parentCollection=e,void e.items.push(o)):{value:void 0}},i=this,o=0;o<n.length;o++){var a=r(o);if("object"==typeof a)return a.value}},e}();t.Deserialiser=i},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=function(e){function t(t,n){return e.call(this,t,n)||this}return i(t,e),t.prototype.getProfile=function(){var e=this.getProperty("profile");return e||(e=this.getProperty("dcterms:conformsTo")),Array.isArray(e)?e[0]:e},t.prototype.getConfirmLabel=function(){return o.Utils.getLocalisedValue(this.getProperty("confirmLabel"),this.options.locale)},t.prototype.getDescription=function(){return o.Utils.getLocalisedValue(this.getProperty("description"),this.options.locale)},t.prototype.getFailureDescription=function(){return o.Utils.getLocalisedValue(this.getProperty("failureDescription"),this.options.locale)},t.prototype.getFailureHeader=function(){return o.Utils.getLocalisedValue(this.getProperty("failureHeader"),this.options.locale)},t.prototype.getHeader=function(){return o.Utils.getLocalisedValue(this.getProperty("header"),this.options.locale)},t.prototype.getServiceLabel=function(){return o.Utils.getLocalisedValue(this.getProperty("label"),this.options.locale)},t.prototype.getInfoUri=function(){var e=this.id;return e.endsWith("/")||(e+="/"),e+"info.json"},t}(o.ManifestResource);t.Service=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Size=function(e,t){this.width=e,this.height=t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.AUTHORIZATION_FAILED=1]="AUTHORIZATION_FAILED",e[e.FORBIDDEN=2]="FORBIDDEN",e[e.INTERNAL_SERVER_ERROR=3]="INTERNAL_SERVER_ERROR",e[e.RESTRICTED=4]="RESTRICTED"}(t.StatusCode||(t.StatusCode={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.Thumb=function(e,t){this.data=t,this.index=t.index,this.width=e;var n=t.getHeight()/t.getWidth();this.height=n?Math.floor(this.width*n):e,this.uri=t.getCanonicalImageUri(e),this.label=r.LanguageMap.getValue(t.getLabel())}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t,n){return e.call(this,t,n)||this}return i(t,e),t}(n(0).Resource);t.Thumbnail=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=function(){function e(e,t){this.label=e,this.data=t||{},this.nodes=[]}return e.prototype.addNode=function(e){this.nodes.push(e),e.parentNode=this},e.prototype.isCollection=function(){return this.data.type===r.Utils.normaliseType(r.TreeNodeType.COLLECTION)},e.prototype.isManifest=function(){return this.data.type===r.Utils.normaliseType(r.TreeNodeType.MANIFEST)},e.prototype.isRange=function(){return this.data.type===r.Utils.normaliseType(r.TreeNodeType.RANGE)},e}();t.TreeNode=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.COLLECTION="collection",e.MANIFEST="manifest",e.RANGE="range"}(t.TreeNodeType||(t.TreeNodeType={}))},function(e,t,n){window,e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONTINUE=100,t.SWITCHING_PROTOCOLS=101,t.PROCESSING=102,t.OK=200,t.CREATED=201,t.ACCEPTED=202,t.NON_AUTHORITATIVE_INFORMATION=203,t.NO_CONTENT=204,t.RESET_CONTENT=205,t.PARTIAL_CONTENT=206,t.MULTI_STATUS=207,t.MULTIPLE_CHOICES=300,t.MOVED_PERMANENTLY=301,t.MOVED_TEMPORARILY=302,t.SEE_OTHER=303,t.NOT_MODIFIED=304,t.USE_PROXY=305,t.TEMPORARY_REDIRECT=307,t.BAD_REQUEST=400,t.UNAUTHORIZED=401,t.PAYMENT_REQUIRED=402,t.FORBIDDEN=403,t.NOT_FOUND=404,t.METHOD_NOT_ALLOWED=405,t.NOT_ACCEPTABLE=406,t.PROXY_AUTHENTICATION_REQUIRED=407,t.REQUEST_TIME_OUT=408,t.CONFLICT=409,t.GONE=410,t.LENGTH_REQUIRED=411,t.PRECONDITION_FAILED=412,t.REQUEST_ENTITY_TOO_LARGE=413,t.REQUEST_URI_TOO_LARGE=414,t.UNSUPPORTED_MEDIA_TYPE=415,t.REQUESTED_RANGE_NOT_SATISFIABLE=416,t.EXPECTATION_FAILED=417,t.IM_A_TEAPOT=418,t.UNPROCESSABLE_ENTITY=422,t.LOCKED=423,t.FAILED_DEPENDENCY=424,t.UNORDERED_COLLECTION=425,t.UPGRADE_REQUIRED=426,t.PRECONDITION_REQUIRED=428,t.TOO_MANY_REQUESTS=429,t.REQUEST_HEADER_FIELDS_TOO_LARGE=431,t.INTERNAL_SERVER_ERROR=500,t.NOT_IMPLEMENTED=501,t.BAD_GATEWAY=502,t.SERVICE_UNAVAILABLE=503,t.GATEWAY_TIME_OUT=504,t.HTTP_VERSION_NOT_SUPPORTED=505,t.VARIANT_ALSO_NEGOTIATES=506,t.INSUFFICIENT_STORAGE=507,t.BANDWIDTH_LIMIT_EXCEEDED=509,t.NOT_EXTENDED=510,t.NETWORK_AUTHENTICATION_REQUIRED=511}])},function(e,t,n){e.exports=window.fetch||(window.fetch=n(3).default||n(3))}])},function(e,t,n){"use strict";n.r(t),n.d(t,"BaseComponent",(function(){return r}));var r=function(){function e(e){this.options=e,this.options.data=Object.assign({},this.data(),e.data)}return e.prototype._init=function(){return this.el=this.options.target,this.el?(this.el.innerHTML="",!0):(console.warn("element not found"),!1)},e.prototype.data=function(){return{}},e.prototype.on=function(e,t,n){var r=this._e||(this._e={});(r[e]||(r[e]=[])).push({fn:t,ctx:n})},e.prototype.fire=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=[].slice.call(arguments,1),i=((this._e||(this._e={}))[e]||[]).slice(),o=0,a=i.length;o<a;o++)i[o].fn.apply(i[o].ctx,r)},e.prototype._resize=function(){},e.prototype.set=function(e){},e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"Async",(function(){return i})),n.d(t,"Bools",(function(){return o})),n.d(t,"Clipboard",(function(){return a})),n.d(t,"Colors",(function(){return s})),n.d(t,"Dates",(function(){return u})),n.d(t,"Device",(function(){return c})),n.d(t,"Documents",(function(){return l})),n.d(t,"Events",(function(){return p})),n.d(t,"Files",(function(){return f})),n.d(t,"Keyboard",(function(){return h})),n.d(t,"Maths",(function(){return d})),n.d(t,"Size",(function(){return _})),n.d(t,"Dimensions",(function(){return g})),n.d(t,"Numbers",(function(){return v})),n.d(t,"Objects",(function(){return y})),n.d(t,"Storage",(function(){return E})),n.d(t,"StorageItem",(function(){return m})),n.d(t,"StorageType",(function(){return r})),n.d(t,"Strings",(function(){return I})),n.d(t,"Urls",(function(){return O}));var r,i=function(){function e(){}return e.waitFor=function(t,n,r,i,o,a){i||(i=200),o||(o=100),a||(a=0),(a+=1)>o?r&&r():t()?n():setTimeout((function(){e.waitFor(t,n,r,i,o,a)}),i)},e}(),o=function(){function e(){}return e.getBool=function(e,t){return null==e?t:e},e}(),a=function(){function e(){}return e.supportsCopy=function(){return document.queryCommandSupported&&document.queryCommandSupported("copy")},e.copy=function(t){t=e.convertBrToNewLine(t);var n=document.createElement("textarea");n.value=t,e.hideButKeepEnabled(n),document.body.appendChild(n),n.focus(),n.select(),document.execCommand("copy"),document.body.removeChild(n)},e.hideButKeepEnabled=function(e){e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="2em",e.style.height="2em",e.style.padding="0",e.style.border="none",e.style.outline="none",e.style.boxShadow="none",e.style.background="transparent"},e.convertBrToNewLine=function(e){return e.replace(/<br\s*[\/]?>/gi,"\n")},e}(),s=function(){function e(){}return e.float32ColorToARGB=function(e){return[(4278190080&e)>>>24,(16711680&e)>>>16,(65280&e)>>>8,255&e]},e._componentToHex=function(e){var t=e.toString(16);return 1==t.length?"0"+t:t},e.rgbToHexString=function(t){return e.coalesce(t),"#"+e._componentToHex(t[0])+e._componentToHex(t[1])+e._componentToHex(t[2])},e.argbToHexString=function(t){return"#"+e._componentToHex(t[0])+e._componentToHex(t[1])+e._componentToHex(t[2])+e._componentToHex(t[3])},e.coalesce=function(e){for(var t=1;t<e.length;t++)void 0===e[t]&&(e[t]=e[t-1])},e}(),u=function(){function e(){}return e.getTimeStamp=function(){return(new Date).getTime()},e}(),c=function(){function e(){}return e.getPixelRatio=function(e){return(window.devicePixelRatio||1)/(e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1)},e.isTouch=function(){return!!("ontouchstart"in window)||window.navigator.msMaxTouchPoints>0},e}(),l=function(){function e(){}return e.isInIFrame=function(){try{return window.self!==window.top}catch(e){return!0}},e.supportsFullscreen=function(){var e=document.documentElement;return void 0!==(e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullScreen||e.msRequestFullscreen)},e.isHidden=function(){return!!e.getHiddenProp()},e.getHiddenProp=function(){var e=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var t=0;t<e.length;t++)if(e[t]+"Hidden"in document)return e[t]+"Hidden";return null},e}(),p=function(){function e(){}return e.debounce=function(e,t){return t=t||100,function(){if(!e.debouncing){var n=Array.prototype.slice.apply(arguments);e.lastReturnVal=e.apply(window,n),e.debouncing=!0}return clearTimeout(e.debounceTimeout),e.debounceTimeout=setTimeout((function(){e.debouncing=!1}),t),e.lastReturnVal}},e}(),f=function(){function e(){}return e.simplifyMimeType=function(e){switch(e){case"text/plain":return"txt";case"image/jpeg":return"jpg";case"application/msword":return"doc";case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":return"docx";default:var t=e.split("/");return t[t.length-1]}},e}(),h=function(){function e(){}return e.getCharCode=function(e){return"number"==typeof e.which?e.which:e.keyCode},e}(),d=function(){function e(){}return e.normalise=function(e,t,n){return(e-t)/(n-t)},e.median=function(e){e.sort((function(e,t){return e-t}));var t=Math.floor(e.length/2);return e.length%2?e[t]:(e[t-1]+e[t])/2},e.clamp=function(e,t,n){return Math.min(Math.max(e,t),n)},e}(),_=function(e,t){this.width=e,this.height=t},g=function(){function e(){}return e.fitRect=function(e,t,n,r){var i,o=0,a=0;return t/e<r/n?(o=e*(i=n/e),a=t*i):(o=e*(i=r/t),a=t*i),new _(Math.floor(o),Math.floor(a))},e.hitRect=function(e,t,n,r,i,o){return i>e&&i<e+n&&o>t&&o<t+r},e}(),v=function(){function e(){}return e.numericalInput=function(e){return 46==e.keyCode||8==e.keyCode||9==e.keyCode||27==e.keyCode||65==e.keyCode&&!0===e.ctrlKey||e.keyCode>=35&&e.keyCode<=39||!(e.shiftKey||(e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105))||(e.preventDefault(),!1)},e}(),y=function(){function e(){}return e.toPlainObject=function(e){e=Object(e);var t={};for(var n in e)t[n]=e[n];return t},e}(),E=function(){function e(){}return e.clear=function(e){switch(void 0===e&&(e=r.MEMORY),e){case r.MEMORY:this._memoryStorage={};break;case r.SESSION:sessionStorage.clear();break;case r.LOCAL:localStorage.clear()}},e.clearExpired=function(e){void 0===e&&(e=r.MEMORY);for(var t=this.getItems(e),n=0;n<t.length;n++){var i=t[n];this._isExpired(i)&&this.remove(i.key)}},e.get=function(e,t){void 0===t&&(t=r.MEMORY);var n=null;switch(t){case r.MEMORY:n=this._memoryStorage[e];break;case r.SESSION:n=sessionStorage.getItem(e);break;case r.LOCAL:n=localStorage.getItem(e)}if(!n)return null;var i=null;try{i=JSON.parse(n)}catch(e){return null}return i?this._isExpired(i)?null:(i.key=e,i):null},e._isExpired=function(e){return!((new Date).getTime()<e.expiresAt)},e.getItems=function(e){void 0===e&&(e=r.MEMORY);var t=[];switch(e){case r.MEMORY:for(var n=Object.keys(this._memoryStorage),i=0;i<n.length;i++)(a=this.get(n[i],r.MEMORY))&&t.push(a);break;case r.SESSION:for(i=0;i<sessionStorage.length;i++)(o=sessionStorage.key(i))&&(a=this.get(o,r.SESSION))&&t.push(a);break;case r.LOCAL:for(i=0;i<localStorage.length;i++){var o,a;(o=localStorage.key(i))&&(a=this.get(o,r.LOCAL))&&t.push(a)}}return t},e.remove=function(e,t){switch(void 0===t&&(t=r.MEMORY),t){case r.MEMORY:delete this._memoryStorage[e];break;case r.SESSION:sessionStorage.removeItem(e);break;case r.LOCAL:localStorage.removeItem(e)}},e.set=function(e,t,n,i){void 0===i&&(i=r.MEMORY);var o=1e3*n,a=new m;switch(a.value=t,a.expiresAt=(new Date).getTime()+o,i){case r.MEMORY:this._memoryStorage[e]=JSON.stringify(a);break;case r.SESSION:sessionStorage.setItem(e,JSON.stringify(a));break;case r.LOCAL:localStorage.setItem(e,JSON.stringify(a))}return a},e._memoryStorage={},e}(),m=function(){};!function(e){e.MEMORY="memory",e.SESSION="session",e.LOCAL="local"}(r||(r={}));var I=function(){function e(){}return e.ellipsis=function(e,t){if(e.length<=t)return e;var n=e.substr(0,t),r=n.lastIndexOf(" ");return-1!=r&&(n=n.substr(0,Math.min(n.length,r))),n+"&hellip;"},e.htmlDecode=function(e){var t=document.createElement("div");return t.innerHTML=e,t.firstChild.nodeValue},e.format=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0;r<t.length;r++){var i=new RegExp("\\{"+r+"\\}","gm");e=e.replace(i,t[r])}return e},e.isAlphanumeric=function(e){return/^[a-zA-Z0-9]*$/.test(e)},e.toCssClass=function(e){return e.replace(/[^a-z0-9]/g,(function(e){var t=e.charCodeAt(0);return 32==t?"-":t>=65&&t<=90?"_"+e.toLowerCase():"__"+("000"+t.toString(16)).slice(-4)}))},e.toFileName=function(e){return e.replace(/[^a-z0-9]/gi,"_").toLowerCase()},e.utf8_to_b64=function(e){return window.btoa(unescape(encodeURIComponent(e)))},e}(),O=function(){function e(){}return e.getHashParameter=function(e,t){return t||(t=window.document),t&&t.location?this.getHashParameterFromString(e,t.location.hash):null},e.getHashParameterFromString=function(e,t){var n=new RegExp("#.*[?&]"+e+"=([^&]+)(&|$)").exec(t);return n?decodeURIComponent(n[1].replace(/\+/g," ")):null},e.setHashParameter=function(e,t,n){if(n||(n=window.document),n&&n.location){var r="#?"+this.updateURIKeyValuePair(n.location.hash.replace("#?",""),e,t),i=n.URL;-1!=i.indexOf("#")&&(i=i.substr(0,i.indexOf("#"))),n.location.replace(i+r)}},e.getQuerystringParameter=function(e,t){return t||(t=window),this.getQuerystringParameterFromString(e,t.location.search)},e.getQuerystringParameterFromString=function(e,t){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t);return n?decodeURIComponent(n[1].replace(/\+/g," ")):null},e.setQuerystringParameter=function(e,t,n){if(n||(n=window.document),n&&n.location){var r=this.updateURIKeyValuePair(n.location.hash.replace("#?",""),e,t);window.location.search=r}},e.updateURIKeyValuePair=function(e,t,n){t=encodeURIComponent(t),n=encodeURIComponent(n);var r=e.split("&");""==r[0]&&r.shift();for(var i,o=r.length;o--;)if((i=r[o].split("="))[0]==t){i[1]=n,r[o]=i.join("=");break}return o<0&&(r[r.length]=[t,n].join("=")),r.join("&")},e.getUrlParts=function(e){var t=document.createElement("a");return t.href=e,t},e.convertToRelativeUrl=function(e){var t=this.getUrlParts(e),n=t.pathname+t.searchWithin;return n.startsWith("/")||(n="/"+n),n},e}()}])})),define("lib/IIIFMetadataComponent.js",(function(){}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-shared-module/RightPanel",["require","exports","./BaseEvents","./BaseExpandPanel"],(function(require,exports,BaseEvents_1,BaseExpandPanel_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var RightPanel=function(_super){function RightPanel($element){return _super.call(this,$element)||this}return __extends(RightPanel,_super),RightPanel.prototype.create=function(){_super.prototype.create.call(this),this.$element.width(this.options.panelCollapsedWidth)},RightPanel.prototype.init=function(){var _this=this;_super.prototype.init.call(this),Utils.Bools.getBool(this.extension.getSettings().rightPanelOpen,this.options.panelOpen)&&this.toggle(!0),this.component.subscribe(BaseEvents_1.BaseEvents.TOGGLE_EXPAND_RIGHT_PANEL,(function(){_this.isFullyExpanded?_this.collapseFull():_this.expandFull()}))},RightPanel.prototype.getTargetWidth=function(){return this.isExpanded?this.options.panelCollapsedWidth:this.options.panelExpandedWidth},RightPanel.prototype.getTargetLeft=function(){return this.isExpanded?this.$element.parent().width()-this.options.panelCollapsedWidth:this.$element.parent().width()-this.options.panelExpandedWidth},RightPanel.prototype.toggleFinish=function(){_super.prototype.toggleFinish.call(this),this.isExpanded?this.component.publish(BaseEvents_1.BaseEvents.OPEN_RIGHT_PANEL):this.component.publish(BaseEvents_1.BaseEvents.CLOSE_RIGHT_PANEL),this.extension.updateSettings({rightPanelOpen:this.isExpanded})},RightPanel.prototype.resize=function(){_super.prototype.resize.call(this),this.$element.css({left:Math.floor(this.$element.parent().width()-this.$element.outerWidth())})},RightPanel}(BaseExpandPanel_1.BaseExpandPanel);exports.RightPanel=RightPanel}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-moreinforightpanel-module/MoreInfoRightPanel",["require","exports","@iiif/iiif-metadata-component","@iiif/manifold","../uv-shared-module/BaseEvents","../uv-shared-module/RightPanel","../../Utils"],(function(require,exports,iiif_metadata_component_1,manifold_1,BaseEvents_1,RightPanel_1,Utils_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MoreInfoRightPanel=function(_super){function MoreInfoRightPanel($element){return _super.call(this,$element)||this}return __extends(MoreInfoRightPanel,_super),MoreInfoRightPanel.prototype.create=function(){var _this=this;this.setConfig("moreInfoRightPanel"),_super.prototype.create.call(this),this.component.subscribe(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,(function(){_this.databind()})),this.component.subscribe(BaseEvents_1.BaseEvents.RANGE_CHANGED,(function(){_this.databind()})),this.setTitle(this.config.content.title),this.$metadata=$('<div class="iiif-metadata-component"></div>'),this.$main.append(this.$metadata),this.metadataComponent=new iiif_metadata_component_1.MetadataComponent({target:this.$metadata[0],data:this._getData()}),this.metadataComponent.on("iiifViewerLinkClicked",(function(href){var rangeId=Utils.Urls.getHashParameterFromString("rid",href),rawTime=Utils.Urls.getHashParameterFromString("t",href),time=rawTime?parseInt(rawTime,10):null,canvasId=Utils.Urls.getHashParameterFromString("c",href);if(canvasId){var canvasIndex=_this.extension.helper.getCanvasIndexById(canvasId);canvasIndex&&_this.component.publish(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,[canvasIndex])}if(rangeId){var range=_this.extension.helper.getRangeById(rangeId);range&&_this.component.publish(BaseEvents_1.BaseEvents.RANGE_CHANGED,range)}null!==time&&_this.component.publish(BaseEvents_1.BaseEvents.CURRENT_TIME_CHANGED,[time])}),!1)},MoreInfoRightPanel.prototype.toggleFinish=function(){_super.prototype.toggleFinish.call(this),this.databind()},MoreInfoRightPanel.prototype.databind=function(){this.metadataComponent.set(this._getData())},MoreInfoRightPanel.prototype._getCurrentRange=function(){return this.extension.helper.getCurrentRange()},MoreInfoRightPanel.prototype._getData=function(){return{canvasDisplayOrder:this.config.options.canvasDisplayOrder,canvases:this.extension.getCurrentCanvases(),canvasExclude:this.config.options.canvasExclude,canvasLabels:this.extension.getCanvasLabels(this.content.page),content:this.config.content,copiedMessageDuration:2e3,copyToClipboardEnabled:Utils.Bools.getBool(this.config.options.copyToClipboardEnabled,!1),helper:this.extension.helper,licenseFormatter:new manifold_1.UriLabeller(this.config.license?this.config.license:{}),limit:this.config.options.textLimit||4,limitType:"lines",limitToRange:Utils.Bools.getBool(this.config.options.limitToRange,!1),manifestDisplayOrder:this.config.options.manifestDisplayOrder,manifestExclude:this.config.options.manifestExclude,range:this._getCurrentRange(),rtlLanguageCodes:this.config.options.rtlLanguageCodes,sanitizer:function(html){return Utils_1.UVUtils.sanitize(html)},showAllLanguages:this.config.options.showAllLanguages}},MoreInfoRightPanel.prototype.resize=function(){_super.prototype.resize.call(this),this.$main.height(this.$element.height()-this.$top.height()-this.$main.verticalMargins())},MoreInfoRightPanel}(RightPanel_1.RightPanel);exports.MoreInfoRightPanel=MoreInfoRightPanel}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-dialogues-module/SettingsDialogue",["require","exports","../uv-shared-module/BaseEvents","../uv-shared-module/Dialogue"],(function(require,exports,BaseEvents_1,Dialogue_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var SettingsDialogue=function(_super){function SettingsDialogue($element){return _super.call(this,$element)||this}return __extends(SettingsDialogue,_super),SettingsDialogue.prototype.create=function(){var _this=this;this.setConfig("settingsDialogue"),_super.prototype.create.call(this),this.openCommand=BaseEvents_1.BaseEvents.SHOW_SETTINGS_DIALOGUE,this.closeCommand=BaseEvents_1.BaseEvents.HIDE_SETTINGS_DIALOGUE,this.component.subscribe(this.openCommand,(function(){_this.open()})),this.component.subscribe(this.closeCommand,(function(){_this.close()})),this.$title=$("<h1></h1>"),this.$content.append(this.$title),this.$scroll=$('<div class="scroll"></div>'),this.$content.append(this.$scroll),this.$version=$('<div class="version"></div>'),this.$content.append(this.$version),this.$website=$('<div class="website"></div>'),this.$content.append(this.$website),this.$locale=$('<div class="setting locale"></div>'),this.$scroll.append(this.$locale),this.$localeLabel=$('<label for="locale">'+this.content.locale+"</label>"),this.$locale.append(this.$localeLabel),this.$localeDropDown=$('<select id="locale"></select>'),this.$locale.append(this.$localeDropDown),this.$title.text(this.content.title),this.$website.html(this.content.website),this.$website.targetBlank(),this._createLocalesMenu(),this.$element.hide()},SettingsDialogue.prototype.getSettings=function(){return this.extension.getSettings()},SettingsDialogue.prototype.updateSettings=function(settings){this.extension.updateSettings(settings),this.component.publish(BaseEvents_1.BaseEvents.UPDATE_SETTINGS,settings)},SettingsDialogue.prototype.open=function(){_super.prototype.open.call(this),this.$version.text("v3.1.4")},SettingsDialogue.prototype._createLocalesMenu=function(){var _this=this,locales=this.extension.data.locales;if(locales&&locales.length>1){for(var i=0;i<locales.length;i++){var locale=locales[i];this.$localeDropDown.append('<option value="'+locale.name+'">'+locale.label+"</option>")}this.$localeDropDown.val(locales[0].name)}else this.$locale.hide();this.$localeDropDown.change((function(){_this.extension.changeLocale(_this.$localeDropDown.val())}))},SettingsDialogue.prototype.resize=function(){_super.prototype.resize.call(this)},SettingsDialogue}(Dialogue_1.Dialogue);exports.SettingsDialogue=SettingsDialogue}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("extensions/uv-av-extension/SettingsDialogue",["require","exports","../../modules/uv-dialogues-module/SettingsDialogue"],(function(require,exports,SettingsDialogue_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var SettingsDialogue=function(_super){function SettingsDialogue($element){return _super.call(this,$element)||this}return __extends(SettingsDialogue,_super),SettingsDialogue.prototype.create=function(){this.setConfig("settingsDialogue"),_super.prototype.create.call(this)},SettingsDialogue}(SettingsDialogue_1.SettingsDialogue);exports.SettingsDialogue=SettingsDialogue}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-dialogues-module/ShareDialogue",["require","exports","../uv-shared-module/BaseEvents","../uv-shared-module/Dialogue"],(function(require,exports,BaseEvents_1,Dialogue_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ShareDialogue=function(_super){function ShareDialogue($element){var _this=_super.call(this,$element)||this;return _this.aspectRatio=.75,_this.isEmbedViewVisible=!1,_this.isShareViewVisible=!1,_this.maxWidth=8e3,_this.maxHeight=_this.maxWidth*_this.aspectRatio,_this.minWidth=200,_this.minHeight=_this.minWidth*_this.aspectRatio,_this.shareManifests=!1,_this}return __extends(ShareDialogue,_super),ShareDialogue.prototype.create=function(){var _this=this;this.setConfig("shareDialogue"),_super.prototype.create.call(this),this.openCommand=BaseEvents_1.BaseEvents.SHOW_SHARE_DIALOGUE,this.closeCommand=BaseEvents_1.BaseEvents.HIDE_SHARE_DIALOGUE,this.shareManifests=this.options.shareManifests||!1,this.component.subscribe(this.openCommand,(function(triggerButton){_this.open(triggerButton),_this.isShareAvailable()?_this.openShareView():_this.openEmbedView()})),this.component.subscribe(this.closeCommand,(function(){_this.close()})),this.component.subscribe(BaseEvents_1.BaseEvents.SHOW_EMBED_DIALOGUE,(function(triggerButton){_this.open(triggerButton),_this.openEmbedView()})),this.$tabs=$('<div class="tabs"></div>'),this.$content.append(this.$tabs),this.$shareButton=$('<a class="share tab default" tabindex="0">'+this.content.share+"</a>"),this.$shareButton.prop("title",this.content.share),this.$tabs.append(this.$shareButton),this.$embedButton=$('<a class="embed tab" tabindex="0">'+this.content.embed+"</a>"),this.$embedButton.prop("title",this.content.embed),this.$tabs.append(this.$embedButton),this.$tabsContent=$('<div class="tabsContent"></div>'),this.$content.append(this.$tabsContent),this.$footer=$('<div class="footer"></div>'),this.$content.append(this.$footer),this.$shareView=$('<div class="shareView view"></div>'),this.$tabsContent.append(this.$shareView),this.$shareHeader=$('<div class="header"></div>'),this.$shareView.append(this.$shareHeader),this.$shareLink=$('<a class="shareLink" onclick="return false;"></a>'),this.$shareView.append(this.$shareLink),this.$shareInput=$('<input class="shareInput" type="text" readonly="readonly" aria-label="'+this.content.shareUrl+'"/>'),this.$shareView.append(this.$shareInput),this.$shareFrame=$('<iframe class="shareFrame"></iframe>'),this.$shareView.append(this.$shareFrame),this.$embedView=$('<div class="embedView view"></div>'),this.$tabsContent.append(this.$embedView),this.$embedHeader=$('<div class="header"></div>'),this.$embedView.append(this.$embedHeader),this.$code=$('<input class="code" type="text" readonly="readonly" aria-label="'+this.content.embed+'"/>'),this.$embedView.append(this.$code),this.$customSize=$('<div class="customSize"></div>'),this.$embedView.append(this.$customSize),this.$size=$('<span class="size">'+this.content.size+"</span>"),this.$customSize.append(this.$size),this.$customSizeDropDown=$('<select id="size" aria-label="'+this.content.size+'"></select>'),this.$customSize.append(this.$customSizeDropDown),this.$customSizeDropDown.append('<option value="small" data-width="560" data-height="420">560 x 420</option>'),this.$customSizeDropDown.append('<option value="medium" data-width="640" data-height="480">640 x 480</option>'),this.$customSizeDropDown.append('<option value="large" data-width="800" data-height="600">800 x 600</option>'),this.$customSizeDropDown.append('<option value="custom">'+this.content.customSize+"</option>"),this.$widthInput=$('<input class="width" type="text" maxlength="10" aria-label="'+this.content.width+'"/>'),this.$customSize.append(this.$widthInput),this.$x=$('<span class="x">x</span>'),this.$customSize.append(this.$x),this.$heightInput=$('<input class="height" type="text" maxlength="10" aria-label="'+this.content.height+'"/>'),this.$customSize.append(this.$heightInput);var iiifUrl=this.extension.getIIIFShareUrl(this.shareManifests);this.$iiifButton=$('<a class="imageBtn iiif" href="'+iiifUrl+'" title="'+this.content.iiif+'" target="_blank"></a>'),this.$footer.append(this.$iiifButton),this.$termsOfUseButton=$('<a href="#">'+this.extension.data.config.content.termsOfUse+"</a>"),this.$footer.append(this.$termsOfUseButton),this.$widthInput.on("keydown",(function(e){return Utils.Numbers.numericalInput(e)})),this.$heightInput.on("keydown",(function(e){return Utils.Numbers.numericalInput(e)})),this.$shareInput.focus((function(){$(this).select()})),this.$code.focus((function(){$(this).select()})),this.$shareButton.onPressed((function(){_this.openShareView()})),this.$embedButton.onPressed((function(){_this.openEmbedView()})),this.$customSizeDropDown.change((function(){_this.update()})),this.$widthInput.change((function(){_this.updateHeightRatio(),_this.update()})),this.$heightInput.change((function(){_this.updateWidthRatio(),_this.update()})),this.$termsOfUseButton.onPressed((function(){_this.component.publish(BaseEvents_1.BaseEvents.SHOW_TERMS_OF_USE)})),this.$element.hide(),this.update()},ShareDialogue.prototype.open=function(triggerButton){_super.prototype.open.call(this,triggerButton),this.update()},ShareDialogue.prototype.getShareUrl=function(){return this.extension.getShareUrl()},ShareDialogue.prototype.isShareAvailable=function(){return!!this.getShareUrl()},ShareDialogue.prototype.update=function(){this.isShareAvailable()?this.$shareButton.show():this.$shareButton.hide();var $selected=this.getSelectedSize();"custom"===$selected.val()?(this.$widthInput.show(),this.$x.show(),this.$heightInput.show()):(this.$widthInput.hide(),this.$x.hide(),this.$heightInput.hide(),this.currentWidth=Number($selected.data("width")),this.currentHeight=Number($selected.data("height")),this.$widthInput.val(String(this.currentWidth)),this.$heightInput.val(String(this.currentHeight))),this.updateInstructions(),this.updateShareOptions(),this.updateShareFrame(),this.updateTermsOfUseButton()},ShareDialogue.prototype.updateShareOptions=function(){var shareUrl=this.getShareUrl();shareUrl&&(this.$shareInput.val(shareUrl),this.$shareLink.prop("href",shareUrl),this.$shareLink.text(shareUrl)),this.extension.isMobile()?(this.$shareInput.hide(),this.$shareLink.show()):(this.$shareInput.show(),this.$shareLink.hide())},ShareDialogue.prototype.updateInstructions=function(){Utils.Bools.getBool(this.options.instructionsEnabled,!1)?(this.$shareHeader.show(),this.$embedHeader.show(),this.$shareHeader.text(this.content.shareInstructions),this.$embedHeader.text(this.content.embedInstructions)):(this.$shareHeader.hide(),this.$embedHeader.hide())},ShareDialogue.prototype.getSelectedSize=function(){return this.$customSizeDropDown.find(":selected")},ShareDialogue.prototype.updateWidthRatio=function(){this.currentHeight=Number(this.$heightInput.val()),this.currentHeight<this.minHeight?(this.currentHeight=this.minHeight,this.$heightInput.val(String(this.currentHeight))):this.currentHeight>this.maxHeight&&(this.currentHeight=this.maxHeight,this.$heightInput.val(String(this.currentHeight))),this.currentWidth=Math.floor(this.currentHeight/this.aspectRatio),this.$widthInput.val(String(this.currentWidth))},ShareDialogue.prototype.updateHeightRatio=function(){this.currentWidth=Number(this.$widthInput.val()),this.currentWidth<this.minWidth?(this.currentWidth=this.minWidth,this.$widthInput.val(String(this.currentWidth))):this.currentWidth>this.maxWidth&&(this.currentWidth=this.maxWidth,this.$widthInput.val(String(this.currentWidth))),this.currentHeight=Math.floor(this.currentWidth*this.aspectRatio),this.$heightInput.val(String(this.currentHeight))},ShareDialogue.prototype.updateShareFrame=function(){var shareUrl=this.extension.helper.getShareServiceUrl();shareUrl&&(Utils.Bools.getBool(this.config.options.shareFrameEnabled,!0)&&shareUrl?(this.$shareFrame.prop("src",shareUrl),this.$shareFrame.show()):this.$shareFrame.hide())},ShareDialogue.prototype.updateTermsOfUseButton=function(){var requiredStatement=this.extension.helper.getRequiredStatement();Utils.Bools.getBool(this.extension.data.config.options.termsOfUseEnabled,!1)&&requiredStatement&&requiredStatement.value?this.$termsOfUseButton.show():this.$termsOfUseButton.hide()},ShareDialogue.prototype.openShareView=function(){this.isShareViewVisible=!0,this.isEmbedViewVisible=!1,this.$embedView.hide(),this.$shareView.show(),this.$shareButton.addClass("on default"),this.$embedButton.removeClass("on default"),this.resize()},ShareDialogue.prototype.openEmbedView=function(){this.isShareViewVisible=!1,this.isEmbedViewVisible=!0,this.$embedView.show(),this.$shareView.hide(),this.$shareButton.removeClass("on default"),this.$embedButton.addClass("on default"),this.resize()},ShareDialogue.prototype.close=function(){_super.prototype.close.call(this)},ShareDialogue.prototype.getViews=function(){return this.$tabsContent.find(".view")},ShareDialogue.prototype.equaliseViewHeights=function(){this.getViews().equaliseHeight(!0)},ShareDialogue.prototype.resize=function(){this.equaliseViewHeights(),this.setDockedPosition()},ShareDialogue}(Dialogue_1.Dialogue);exports.ShareDialogue=ShareDialogue}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("extensions/uv-av-extension/ShareDialogue",["require","exports","../../modules/uv-dialogues-module/ShareDialogue"],(function(require,exports,ShareDialogue_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ShareDialogue=function(_super){function ShareDialogue($element){return _super.call(this,$element)||this}return __extends(ShareDialogue,_super),ShareDialogue.prototype.create=function(){this.setConfig("shareDialogue"),_super.prototype.create.call(this)},ShareDialogue.prototype.update=function(){_super.prototype.update.call(this),this.code=this.extension.getEmbedScript(this.options.embedTemplate,this.currentWidth,this.currentHeight),this.$code.val(this.code)},ShareDialogue.prototype.resize=function(){_super.prototype.resize.call(this)},ShareDialogue}(ShareDialogue_1.ShareDialogue);exports.ShareDialogue=ShareDialogue}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("extensions/uv-av-extension/Extension",["require","exports","@iiif/vocabulary","../../modules/uv-avcenterpanel-module/AVCenterPanel","../../modules/uv-shared-module/BaseEvents","../../modules/uv-shared-module/BaseExtension","../../modules/uv-contentleftpanel-module/ContentLeftPanel","./DownloadDialogue","../../modules/uv-shared-module/FooterPanel","../../modules/uv-avmobilefooterpanel-module/MobileFooter","../../modules/uv-shared-module/HeaderPanel","../../modules/uv-moreinforightpanel-module/MoreInfoRightPanel","./SettingsDialogue","./ShareDialogue"],(function(require,exports,vocabulary_1,AVCenterPanel_1,BaseEvents_1,BaseExtension_1,ContentLeftPanel_1,DownloadDialogue_1,FooterPanel_1,MobileFooter_1,HeaderPanel_1,MoreInfoRightPanel_1,SettingsDialogue_1,ShareDialogue_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Extension=function(_super){function Extension(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Extension,_super),Extension.prototype.create=function(){var _this=this;_super.prototype.create.call(this),this.component.subscribe(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,(function(canvasIndex){_this.viewCanvas(canvasIndex)})),this.component.subscribe(BaseEvents_1.BaseEvents.TREE_NODE_SELECTED,(function(node){_this.fire(BaseEvents_1.BaseEvents.TREE_NODE_SELECTED,node.data.path),_this.treeNodeSelected(node)})),this.component.subscribe(BaseEvents_1.BaseEvents.THUMB_SELECTED,(function(thumb){_this.data.canvasIndex!==thumb.index&&_this.component.publish(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,thumb.index)}))},Extension.prototype.dependencyLoaded=function(index,dep){index===this.getDependencyIndex("waveform-data")?window.WaveformData=dep:index===this.getDependencyIndex("hls")&&(window.Hls=dep)},Extension.prototype.createModules=function(){_super.prototype.createModules.call(this),this.isHeaderPanelEnabled()?this.headerPanel=new HeaderPanel_1.HeaderPanel(this.shell.$headerPanel):this.shell.$headerPanel.hide(),this.isLeftPanelEnabled()?this.leftPanel=new ContentLeftPanel_1.ContentLeftPanel(this.shell.$leftPanel):this.shell.$leftPanel.hide(),this.centerPanel=new AVCenterPanel_1.AVCenterPanel(this.shell.$centerPanel),this.isRightPanelEnabled()?this.rightPanel=new MoreInfoRightPanel_1.MoreInfoRightPanel(this.shell.$rightPanel):this.shell.$rightPanel.hide(),this.isFooterPanelEnabled()?(this.footerPanel=new FooterPanel_1.FooterPanel(this.shell.$footerPanel),this.mobileFooterPanel=new MobileFooter_1.FooterPanel(this.shell.$mobileFooterPanel)):this.shell.$footerPanel.hide(),this.$shareDialogue=$('<div class="overlay share" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$shareDialogue),this.shareDialogue=new ShareDialogue_1.ShareDialogue(this.$shareDialogue),this.$downloadDialogue=$('<div class="overlay download" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$downloadDialogue),this.downloadDialogue=new DownloadDialogue_1.DownloadDialogue(this.$downloadDialogue),this.$settingsDialogue=$('<div class="overlay settings" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$settingsDialogue),this.settingsDialogue=new SettingsDialogue_1.SettingsDialogue(this.$settingsDialogue),this.isHeaderPanelEnabled()&&this.headerPanel.init(),this.isLeftPanelEnabled()&&this.leftPanel.init(),this.isRightPanelEnabled()&&this.rightPanel.init(),this.isFooterPanelEnabled()&&this.footerPanel.init()},Extension.prototype.isLeftPanelEnabled=function(){var isEnabled=_super.prototype.isLeftPanelEnabled.call(this),tree=this.helper.getTree();return tree&&tree.nodes.length&&(isEnabled=!0),isEnabled},Extension.prototype.render=function(){_super.prototype.render.call(this)},Extension.prototype.isThumbsViewOpen=function(){return!!this.leftPanel&&this.leftPanel.isThumbsViewOpen},Extension.prototype.getEmbedScript=function(template,width,height){var iframeSrc=this.getAppUri()+"#?manifest="+this.helper.manifestUri+"&c="+this.helper.collectionIndex+"&m="+this.helper.manifestIndex+"&s="+this.helper.sequenceIndex+"&cv="+this.helper.canvasIndex+"&rid="+this.helper.rangeId;return Utils.Strings.format(template,iframeSrc,width.toString(),height.toString())},Extension.prototype.treeNodeSelected=function(node){var data=node.data;if(data.type)switch(data.type){case vocabulary_1.IIIFResourceType.MANIFEST.toString():case vocabulary_1.IIIFResourceType.COLLECTION.toString():break;default:this.viewRange(data.path)}},Extension.prototype.viewRange=function(path){var range=this.helper.getRangeByPath(path);range&&this.component.publish(BaseEvents_1.BaseEvents.RANGE_CHANGED,range)},Extension}(BaseExtension_1.BaseExtension);exports.Extension=Extension}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-filelinkcenterpanel-module/FileLinkCenterPanel",["require","exports","manifesto.js","../uv-shared-module/BaseEvents","../uv-shared-module/CenterPanel","../../Utils"],(function(require,exports,manifesto_js_1,BaseEvents_1,CenterPanel_1,Utils_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var FileLinkCenterPanel=function(_super){function FileLinkCenterPanel($element){return _super.call(this,$element)||this}return __extends(FileLinkCenterPanel,_super),FileLinkCenterPanel.prototype.create=function(){var _this=this;this.setConfig("fileLinkCenterPanel"),_super.prototype.create.call(this),this.component.subscribe(BaseEvents_1.BaseEvents.OPEN_EXTERNAL_RESOURCE,(function(resources){_this.openMedia(resources)})),this.$scroll=$('<div class="scroll"></div>'),this.$content.append(this.$scroll),this.$downloadItems=$("<ol></ol>"),this.$scroll.append(this.$downloadItems),this.$downloadItemTemplate=$('<li><img/><div class="col2"><a class="filename" target="_blank" download=""></a><span class="label"></span><a class="description" target="_blank" download=""></a></div></li>'),this.title=this.extension.helper.getLabel()},FileLinkCenterPanel.prototype.openMedia=function(resources){var _this=this;this.extension.getExternalResources(resources).then((function(){for(var $item,annotations=_this.extension.helper.getCurrentCanvas().getContent(),i=0;i<annotations.length;i++){var annotation=annotations[i];if(annotation.getBody().length){var $fileName=($item=_this.$downloadItemTemplate.clone()).find(".filename"),$label=$item.find(".label"),$thumb=$item.find("img"),$description=$item.find(".description"),annotationBody=annotation.getBody()[0],id=annotationBody.getProperty("id");id&&($fileName.prop("href",id),$fileName.text(id.substr(id.lastIndexOf("/")+1)));var label=manifesto_js_1.LanguageMap.getValue(annotationBody.getLabel());label&&$label.text(Utils_1.UVUtils.sanitize(label));var thumbnail=annotation.getProperty("thumbnail");thumbnail?$thumb.prop("src",thumbnail):$thumb.hide();var description=annotationBody.getProperty("description");description&&($description.text(Utils_1.UVUtils.sanitize(description)),id&&$description.prop("href",id)),_this.$downloadItems.append($item)}}}))},FileLinkCenterPanel.prototype.resize=function(){_super.prototype.resize.call(this),this.title&&this.$title.text(Utils_1.UVUtils.sanitize(this.title)),this.$scroll.height(this.$content.height()-this.$scroll.verticalMargins())},FileLinkCenterPanel}(CenterPanel_1.CenterPanel);exports.FileLinkCenterPanel=FileLinkCenterPanel}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-dialogues-module/HelpDialogue",["require","exports","../uv-shared-module/BaseEvents","../uv-shared-module/Dialogue"],(function(require,exports,BaseEvents_1,Dialogue_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var HelpDialogue=function(_super){function HelpDialogue($element){return _super.call(this,$element)||this}return __extends(HelpDialogue,_super),HelpDialogue.prototype.create=function(){var _this=this;this.setConfig("helpDialogue"),_super.prototype.create.call(this),this.openCommand=BaseEvents_1.BaseEvents.SHOW_HELP_DIALOGUE,this.closeCommand=BaseEvents_1.BaseEvents.HIDE_HELP_DIALOGUE,this.component.subscribe(this.openCommand,(function(){_this.open()})),this.component.subscribe(this.closeCommand,(function(){_this.close()})),this.$title=$("<h1></h1>"),this.$content.append(this.$title),this.$scroll=$('<div class="scroll"></div>'),this.$content.append(this.$scroll),this.$message=$("<p></p>"),this.$scroll.append(this.$message),this.$title.text(this.content.title),this.$message.html(this.content.text),this.$message.targetBlank(),this.$element.hide()},HelpDialogue.prototype.resize=function(){_super.prototype.resize.call(this)},HelpDialogue}(Dialogue_1.Dialogue);exports.HelpDialogue=HelpDialogue}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-resourcesleftpanel-module/ThumbsView",["require","exports","../uv-shared-module/ThumbsView"],(function(require,exports,ThumbsView_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ThumbsView=function(_super){function ThumbsView(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(ThumbsView,_super),ThumbsView.prototype.create=function(){this.setConfig("resourcesLeftPanel"),_super.prototype.create.call(this)},ThumbsView}(ThumbsView_1.ThumbsView);exports.ThumbsView=ThumbsView}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-resourcesleftpanel-module/ResourcesLeftPanel",["require","exports","../uv-shared-module/BaseEvents","../uv-shared-module/LeftPanel","./ThumbsView","manifesto.js","@iiif/vocabulary"],(function(require,exports,BaseEvents_1,LeftPanel_1,ThumbsView_1,manifesto_js_1,vocabulary_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ResourcesLeftPanel=function(_super){function ResourcesLeftPanel($element){return _super.call(this,$element)||this}return __extends(ResourcesLeftPanel,_super),ResourcesLeftPanel.prototype.create=function(){this.setConfig("resourcesLeftPanel"),_super.prototype.create.call(this),this.setTitle(this.content.title),this.$tabsContent=$('<div class="tabsContent"></div>'),this.$main.append(this.$tabsContent),this.$views=$('<div class="views"></div>'),this.$tabsContent.append(this.$views),this.$thumbsView=$('<div class="thumbsView"></div>'),this.$views.append(this.$thumbsView),this.$resourcesView=$('<div class="resourcesView"></div>'),this.$resources=$("<ul></ul>"),this.$resourcesView.append(this.$resources),this.$views.append(this.$resourcesView),this.thumbsView=new ThumbsView_1.ThumbsView(this.$thumbsView),this.dataBind()},ResourcesLeftPanel.prototype.dataBind=function(){this.dataBindThumbsView();var annotations=this.extension.helper.getCurrentCanvas().getResources();0===annotations.length&&this.$resourcesView.hide();for(var i=0;i<annotations.length;i++){var resource=annotations[i].getResource();if(resource){var label=manifesto_js_1.LanguageMap.getValue(resource.getLabel());if(label){var mime=Utils.Files.simplifyMimeType(resource.getFormat().toString()),$listItem=$('<li><a href="'+resource.id+'" target="_blank">'+label+" ("+mime+")</li>");this.$resources.append($listItem)}}}},ResourcesLeftPanel.prototype.dataBindThumbsView=function(){if(this.thumbsView){var width,height,viewingDirection=this.extension.helper.getViewingDirection();!viewingDirection||viewingDirection.toString()!==vocabulary_1.ViewingDirection.LEFT_TO_RIGHT.toString()&&viewingDirection.toString()!==vocabulary_1.ViewingDirection.RIGHT_TO_LEFT.toString()?(width=this.config.options.oneColThumbWidth,height=this.config.options.oneColThumbHeight):(width=this.config.options.twoColThumbWidth,height=this.config.options.twoColThumbHeight),void 0===width&&(width=100),void 0===height&&(height=100),this.thumbsView.thumbs=this.extension.helper.getThumbs(width,height),this.thumbsView.thumbs.length<2&&this.$thumbsView.hide(),this.thumbsView.databind()}},ResourcesLeftPanel.prototype.expandFullStart=function(){_super.prototype.expandFullStart.call(this),this.component.publish(BaseEvents_1.BaseEvents.LEFTPANEL_EXPAND_FULL_START)},ResourcesLeftPanel.prototype.expandFullFinish=function(){_super.prototype.expandFullFinish.call(this),this.component.publish(BaseEvents_1.BaseEvents.LEFTPANEL_EXPAND_FULL_FINISH)},ResourcesLeftPanel.prototype.collapseFullStart=function(){_super.prototype.collapseFullStart.call(this),this.component.publish(BaseEvents_1.BaseEvents.LEFTPANEL_COLLAPSE_FULL_START)},ResourcesLeftPanel.prototype.collapseFullFinish=function(){_super.prototype.collapseFullFinish.call(this),this.component.publish(BaseEvents_1.BaseEvents.LEFTPANEL_COLLAPSE_FULL_FINISH)},ResourcesLeftPanel.prototype.resize=function(){_super.prototype.resize.call(this),this.$views.height(this.$main.height()),this.$resources.height(this.$main.height())},ResourcesLeftPanel}(LeftPanel_1.LeftPanel);exports.ResourcesLeftPanel=ResourcesLeftPanel}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("extensions/uv-default-extension/SettingsDialogue",["require","exports","../../modules/uv-dialogues-module/SettingsDialogue"],(function(require,exports,SettingsDialogue_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var SettingsDialogue=function(_super){function SettingsDialogue($element){return _super.call(this,$element)||this}return __extends(SettingsDialogue,_super),SettingsDialogue.prototype.create=function(){this.setConfig("settingsDialogue"),_super.prototype.create.call(this)},SettingsDialogue}(SettingsDialogue_1.SettingsDialogue);exports.SettingsDialogue=SettingsDialogue}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("extensions/uv-default-extension/ShareDialogue",["require","exports","../../modules/uv-dialogues-module/ShareDialogue"],(function(require,exports,ShareDialogue_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ShareDialogue=function(_super){function ShareDialogue($element){return _super.call(this,$element)||this}return __extends(ShareDialogue,_super),ShareDialogue.prototype.create=function(){this.setConfig("shareDialogue"),_super.prototype.create.call(this)},ShareDialogue.prototype.update=function(){_super.prototype.update.call(this),this.code=this.extension.getEmbedScript(this.options.embedTemplate,this.currentWidth,this.currentHeight),this.$code.val(this.code)},ShareDialogue.prototype.resize=function(){_super.prototype.resize.call(this)},ShareDialogue}(ShareDialogue_1.ShareDialogue);exports.ShareDialogue=ShareDialogue}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("extensions/uv-default-extension/Extension",["require","exports","../../modules/uv-shared-module/BaseEvents","../../modules/uv-shared-module/BaseExtension","../../modules/uv-filelinkcenterpanel-module/FileLinkCenterPanel","../../modules/uv-shared-module/FooterPanel","../../modules/uv-shared-module/HeaderPanel","../../modules/uv-dialogues-module/HelpDialogue","../../modules/uv-moreinforightpanel-module/MoreInfoRightPanel","../../modules/uv-resourcesleftpanel-module/ResourcesLeftPanel","./SettingsDialogue","./ShareDialogue"],(function(require,exports,BaseEvents_1,BaseExtension_1,FileLinkCenterPanel_1,FooterPanel_1,HeaderPanel_1,HelpDialogue_1,MoreInfoRightPanel_1,ResourcesLeftPanel_1,SettingsDialogue_1,ShareDialogue_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Extension=function(_super){function Extension(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Extension,_super),Extension.prototype.create=function(){var _this=this;_super.prototype.create.call(this),$(window).bind("enterfullscreen",(function(){_this.component.publish(BaseEvents_1.BaseEvents.TOGGLE_FULLSCREEN)})),$(window).bind("exitfullscreen",(function(){_this.component.publish(BaseEvents_1.BaseEvents.TOGGLE_FULLSCREEN)})),this.component.subscribe(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,(function(canvasIndex){_this.viewCanvas(canvasIndex)})),this.component.subscribe(BaseEvents_1.BaseEvents.THUMB_SELECTED,(function(canvasIndex){_this.component.publish(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,canvasIndex)}))},Extension.prototype.createModules=function(){_super.prototype.createModules.call(this),this.isHeaderPanelEnabled()?this.headerPanel=new HeaderPanel_1.HeaderPanel(this.shell.$headerPanel):this.shell.$headerPanel.hide(),this.isLeftPanelEnabled()&&(this.leftPanel=new ResourcesLeftPanel_1.ResourcesLeftPanel(this.shell.$leftPanel)),this.centerPanel=new FileLinkCenterPanel_1.FileLinkCenterPanel(this.shell.$centerPanel),this.isRightPanelEnabled()&&(this.rightPanel=new MoreInfoRightPanel_1.MoreInfoRightPanel(this.shell.$rightPanel)),this.isFooterPanelEnabled()?this.footerPanel=new FooterPanel_1.FooterPanel(this.shell.$footerPanel):this.shell.$footerPanel.hide(),this.$helpDialogue=$('<div class="overlay help" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$helpDialogue),this.helpDialogue=new HelpDialogue_1.HelpDialogue(this.$helpDialogue),this.$shareDialogue=$('<div class="overlay share" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$shareDialogue),this.shareDialogue=new ShareDialogue_1.ShareDialogue(this.$shareDialogue),this.$settingsDialogue=$('<div class="overlay settings" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$settingsDialogue),this.settingsDialogue=new SettingsDialogue_1.SettingsDialogue(this.$settingsDialogue),this.isLeftPanelEnabled()&&this.leftPanel.init(),this.isRightPanelEnabled()&&this.rightPanel.init()},Extension.prototype.render=function(){_super.prototype.render.call(this)},Extension.prototype.isLeftPanelEnabled=function(){return Utils.Bools.getBool(this.data.config.options.leftPanelEnabled,!0)&&(this.helper.isMultiCanvas()||this.helper.isMultiSequence()||this.helper.hasResources())},Extension.prototype.getEmbedScript=function(template,width,height){var iframeSrc=this.getAppUri()+"#?manifest="+this.helper.manifestUri+"&c="+this.helper.collectionIndex+"&m="+this.helper.manifestIndex+"&s="+this.helper.sequenceIndex+"&cv="+this.helper.canvasIndex;return Utils.Strings.format(template,iframeSrc,width.toString(),height.toString())},Extension}(BaseExtension_1.BaseExtension);exports.Extension=Extension})),define("extensions/uv-ebook-extension/Events",["require","exports"],(function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Events=function(){function Events(){}return Events.namespace="ebookExtension.",Events.CFI_FRAGMENT_CHANGED=Events.namespace+"cfiFragmentChanged",Events.ITEM_CLICKED=Events.namespace+"itemClicked",Events.LOADED_NAVIGATION=Events.namespace+"loadedNavigation",Events.RELOCATED=Events.namespace+"relocated",Events.RENDITION_ATTACHED=Events.namespace+"renditionAttached",Events.TOC_READY=Events.namespace+"tocReady",Events}();exports.Events=Events}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-ebookleftpanel-module/EbookLeftPanel",["require","exports","../uv-shared-module/BaseEvents","../uv-shared-module/LeftPanel","../../extensions/uv-ebook-extension/Events"],(function(require,exports,BaseEvents_1,LeftPanel_1,Events_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var EbookLeftPanel=function(_super){function EbookLeftPanel($element){return _super.call(this,$element)||this}return __extends(EbookLeftPanel,_super),EbookLeftPanel.prototype.create=function(){var _this=this;this.setConfig("ebookLeftPanel"),_super.prototype.create.call(this),this._$container=$('<div class="container"></div>'),this._ebookTOC=document.createElement("uv-ebook-toc"),this._$ebookTOC=$(this._ebookTOC),this.$main.addClass("disabled"),this.$main.append(this._$container),this._$container.append(this._$ebookTOC),this.setTitle(this.content.title),this.component.subscribe(Events_1.Events.LOADED_NAVIGATION,(function(navigation){_this.$main.removeClass("disabled"),_this._ebookTOC.toc=navigation.toc})),this.component.subscribe(Events_1.Events.RELOCATED,(function(location){_this._ebookTOC.selected=location.start.href})),this._ebookTOC.addEventListener("itemClicked",(function(e){_this.component.publish(Events_1.Events.ITEM_CLICKED,e.detail)}),!1),Utils.Async.waitFor((function(){return void 0!==window.customElements}),(function(){customElements.whenDefined("uv-ebook-toc").then((function(){_this.component.publish(Events_1.Events.TOC_READY)}))}))},EbookLeftPanel.prototype.expandFullStart=function(){_super.prototype.expandFullStart.call(this),this.component.publish(BaseEvents_1.BaseEvents.LEFTPANEL_EXPAND_FULL_START)},EbookLeftPanel.prototype.expandFullFinish=function(){_super.prototype.expandFullFinish.call(this),this.component.publish(BaseEvents_1.BaseEvents.LEFTPANEL_EXPAND_FULL_FINISH)},EbookLeftPanel.prototype.collapseFullStart=function(){_super.prototype.collapseFullStart.call(this),this.component.publish(BaseEvents_1.BaseEvents.LEFTPANEL_COLLAPSE_FULL_START)},EbookLeftPanel.prototype.collapseFullFinish=function(){_super.prototype.collapseFullFinish.call(this),this.component.publish(BaseEvents_1.BaseEvents.LEFTPANEL_COLLAPSE_FULL_FINISH)},EbookLeftPanel.prototype.resize=function(){_super.prototype.resize.call(this),this._$container.height(this.$main.height()-this._$container.verticalPadding())},EbookLeftPanel}(LeftPanel_1.LeftPanel);exports.EbookLeftPanel=EbookLeftPanel}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("extensions/uv-ebook-extension/DownloadDialogue",["require","exports","../../modules/uv-dialogues-module/DownloadDialogue"],(function(require,exports,DownloadDialogue_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var DownloadDialogue=function(_super){function DownloadDialogue($element){return _super.call(this,$element)||this}return __extends(DownloadDialogue,_super),DownloadDialogue.prototype.create=function(){this.setConfig("downloadDialogue"),_super.prototype.create.call(this)},DownloadDialogue.prototype.open=function($triggerButton){_super.prototype.open.call(this,$triggerButton),this.addEntireFileDownloadOptions(),this.updateNoneAvailable(),this.resize()},DownloadDialogue.prototype.isDownloadOptionAvailable=function(option){return _super.prototype.isDownloadOptionAvailable.call(this,option)},DownloadDialogue}(DownloadDialogue_1.DownloadDialogue);exports.DownloadDialogue=DownloadDialogue}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-ebookcenterpanel-module/EbookCenterPanel",["require","exports","../uv-shared-module/BaseEvents","../uv-shared-module/CenterPanel","../../extensions/uv-ebook-extension/Events","../uv-shared-module/Position"],(function(require,exports,BaseEvents_1,CenterPanel_1,Events_1,Position_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var EbookCenterPanel=function(_super){function EbookCenterPanel($element){var _this=_super.call(this,$element)||this;return _this._ebookReaderReady=!1,_this._state={},_this._prevState={},_this.attributionPosition=Position_1.Position.BOTTOM_RIGHT,_this}return __extends(EbookCenterPanel,_super),EbookCenterPanel.prototype.create=function(){var _this=this;this.setConfig("ebookCenterPanel"),_super.prototype.create.call(this),this._ebookReader=document.createElement("uv-ebook-reader"),this.$content.prepend(this._ebookReader),this._ebookReader.setAttribute("width","100%"),this._ebookReader.setAttribute("height","100%"),this._ebookReader.addEventListener("loadedNavigation",(function(e){_this.component.publish(Events_1.Events.LOADED_NAVIGATION,e.detail)}),!1),this._ebookReader.addEventListener("relocated",(function(e){_this.component.publish(Events_1.Events.RELOCATED,e.detail),_this._cfi=e.detail.start.cfi,_this.component.publish(Events_1.Events.CFI_FRAGMENT_CHANGED,_this._cfi)}),!1),Utils.Async.waitFor((function(){return void 0!==window.customElements}),(function(){customElements.whenDefined("uv-ebook-reader").then((function(){_this._ebookReaderReady=!0}))}));var that=this;this.component.subscribe(BaseEvents_1.BaseEvents.OPEN_EXTERNAL_RESOURCE,(function(e,resources){that.openMedia(resources)})),this.component.subscribe(Events_1.Events.ITEM_CLICKED,(function(href){_this._nextState({cfi:href})})),this.component.subscribe(Events_1.Events.CFI_FRAGMENT_CHANGED,(function(cfi){Utils.Async.waitFor((function(){return _this._ebookReaderReady}),(function(){cfi!==_this._cfi&&_this._nextState({cfi:cfi})}))}))},EbookCenterPanel.prototype.openMedia=function(resources){var _this=this;this.extension.getExternalResources(resources).then((function(){var annotations=_this.extension.helper.getCurrentCanvas().getContent();if(annotations.length){var body=annotations[0].getBody();if(body.length){var media=body[0];_this._nextState({bookPath:media.id})}}_this.component.publish(BaseEvents_1.BaseEvents.RESIZE)}))},EbookCenterPanel.prototype._nextState=function(s){var _this=this;this._state=Object.assign({},this._state,s),Utils.Async.waitFor((function(){return _this._ebookReaderReady}),(function(){_this._state.bookPath&&_this._state.bookPath!==_this._prevState.bookPath&&_this._ebookReader.load(_this._state.bookPath),_this._state.cfi&&_this._state.cfi!==_this._prevState.cfi&&_this._ebookReader.display(_this._state.cfi),_this._prevState=Object.assign({},_this._state)}))},EbookCenterPanel.prototype.resize=function(){var _this=this;_super.prototype.resize.call(this),this._ebookReaderReady&&setTimeout((function(){_this._ebookReader.resize()}),10)},EbookCenterPanel}(CenterPanel_1.CenterPanel);exports.EbookCenterPanel=EbookCenterPanel}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-ebookmobilefooterpanel-module/MobileFooter",["require","exports","../uv-shared-module/FooterPanel"],(function(require,exports,FooterPanel_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var FooterPanel=function(_super){function FooterPanel($element){return _super.call(this,$element)||this}return __extends(FooterPanel,_super),FooterPanel.prototype.create=function(){this.setConfig("mobileFooterPanel"),_super.prototype.create.call(this)},FooterPanel.prototype.resize=function(){_super.prototype.resize.call(this),this.$options.css("left",Math.floor(this.$element.width()/2-this.$options.width()/2))},FooterPanel}(FooterPanel_1.FooterPanel);exports.FooterPanel=FooterPanel}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-dialogues-module/MoreInfoDialogue",["require","exports","../uv-shared-module/BaseEvents","../uv-shared-module/Dialogue","../../Utils","@iiif/iiif-metadata-component"],(function(require,exports,BaseEvents_1,Dialogue_1,Utils_1,iiif_metadata_component_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MoreInfoDialogue=function(_super){function MoreInfoDialogue($element){return _super.call(this,$element)||this}return __extends(MoreInfoDialogue,_super),MoreInfoDialogue.prototype.create=function(){var _this=this;this.setConfig("moreInfoDialogue"),_super.prototype.create.call(this),this.openCommand=BaseEvents_1.BaseEvents.SHOW_MOREINFO_DIALOGUE,this.closeCommand=BaseEvents_1.BaseEvents.HIDE_MOREINFO_DIALOGUE,this.component.subscribe(this.openCommand,(function(triggerButton){_this.open(triggerButton)})),this.component.subscribe(this.closeCommand,(function(){_this.close()})),this.config.content=this.extension.data.config.modules.moreInfoRightPanel.content,this.config.options=this.extension.data.config.modules.moreInfoRightPanel.options,this.$title=$("<h1>"+this.config.content.title+"</h1>"),this.$content.append(this.$title),this.$metadata=$('<div class="iiif-metadata-component"></div>'),this.$content.append(this.$metadata),this.metadataComponent=new iiif_metadata_component_1.MetadataComponent({target:this.$metadata[0]}),this.$element.hide()},MoreInfoDialogue.prototype.open=function(triggerButton){_super.prototype.open.call(this,triggerButton),this.metadataComponent.set(this._getData())},MoreInfoDialogue.prototype._getData=function(){return{canvasDisplayOrder:this.config.options.canvasDisplayOrder,canvases:this.extension.getCurrentCanvases(),canvasExclude:this.config.options.canvasExclude,canvasLabels:this.extension.getCanvasLabels(this.content.page),content:this.config.content,copiedMessageDuration:2e3,copyToClipboardEnabled:Utils.Bools.getBool(this.config.options.copyToClipboardEnabled,!1),helper:this.extension.helper,licenseFormatter:null,limit:this.config.options.textLimit||4,limitType:iiif_metadata_component_1.LimitType.LINES,manifestDisplayOrder:this.config.options.manifestDisplayOrder,manifestExclude:this.config.options.manifestExclude,range:this.extension.getCurrentCanvasRange(),rtlLanguageCodes:this.config.options.rtlLanguageCodes,sanitizer:function(html){return Utils_1.UVUtils.sanitize(html)},showAllLanguages:this.config.options.showAllLanguages}},MoreInfoDialogue.prototype.close=function(){_super.prototype.close.call(this)},MoreInfoDialogue.prototype.resize=function(){this.setDockedPosition()},MoreInfoDialogue}(Dialogue_1.Dialogue);exports.MoreInfoDialogue=MoreInfoDialogue}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("extensions/uv-ebook-extension/SettingsDialogue",["require","exports","../../modules/uv-dialogues-module/SettingsDialogue"],(function(require,exports,SettingsDialogue_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var SettingsDialogue=function(_super){function SettingsDialogue($element){return _super.call(this,$element)||this}return __extends(SettingsDialogue,_super),SettingsDialogue.prototype.create=function(){this.setConfig("settingsDialogue"),_super.prototype.create.call(this)},SettingsDialogue}(SettingsDialogue_1.SettingsDialogue);exports.SettingsDialogue=SettingsDialogue}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("extensions/uv-ebook-extension/ShareDialogue",["require","exports","../../modules/uv-dialogues-module/ShareDialogue"],(function(require,exports,ShareDialogue_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ShareDialogue=function(_super){function ShareDialogue($element){return _super.call(this,$element)||this}return __extends(ShareDialogue,_super),ShareDialogue.prototype.create=function(){this.setConfig("shareDialogue"),_super.prototype.create.call(this)},ShareDialogue.prototype.update=function(){_super.prototype.update.call(this),this.code=this.extension.getEmbedScript(this.options.embedTemplate,this.currentWidth,this.currentHeight),this.$code.val(this.code)},ShareDialogue.prototype.resize=function(){_super.prototype.resize.call(this)},ShareDialogue}(ShareDialogue_1.ShareDialogue);exports.ShareDialogue=ShareDialogue}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("extensions/uv-ebook-extension/Extension",["require","exports","../../modules/uv-shared-module/BaseEvents","../../modules/uv-shared-module/BaseExtension","../../modules/uv-ebookleftpanel-module/EbookLeftPanel","./Events","./DownloadDialogue","../../modules/uv-ebookcenterpanel-module/EbookCenterPanel","../../modules/uv-shared-module/FooterPanel","../../modules/uv-ebookmobilefooterpanel-module/MobileFooter","../../modules/uv-shared-module/HeaderPanel","../../modules/uv-dialogues-module/MoreInfoDialogue","../../modules/uv-moreinforightpanel-module/MoreInfoRightPanel","./SettingsDialogue","./ShareDialogue"],(function(require,exports,BaseEvents_1,BaseExtension_1,EbookLeftPanel_1,Events_1,DownloadDialogue_1,EbookCenterPanel_1,FooterPanel_1,MobileFooter_1,HeaderPanel_1,MoreInfoDialogue_1,MoreInfoRightPanel_1,SettingsDialogue_1,ShareDialogue_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Extension=function(_super){function Extension(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Extension,_super),Extension.prototype.create=function(){var _this=this;_super.prototype.create.call(this),this.component.subscribe(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,(function(canvasIndex){_this.viewCanvas(canvasIndex)})),this.component.subscribe(Events_1.Events.CFI_FRAGMENT_CHANGED,(function(cfi){_this.cfiFragement=cfi,_this.fire(Events_1.Events.CFI_FRAGMENT_CHANGED,_this.cfiFragement)}))},Extension.prototype.dependencyLoaded=function(_index,_dep){},Extension.prototype.createModules=function(){_super.prototype.createModules.call(this),this.isHeaderPanelEnabled()?this.headerPanel=new HeaderPanel_1.HeaderPanel(this.shell.$headerPanel):this.shell.$headerPanel.hide(),this.isLeftPanelEnabled()?this.leftPanel=new EbookLeftPanel_1.EbookLeftPanel(this.shell.$leftPanel):this.shell.$leftPanel.hide(),this.centerPanel=new EbookCenterPanel_1.EbookCenterPanel(this.shell.$centerPanel),this.isRightPanelEnabled()?this.rightPanel=new MoreInfoRightPanel_1.MoreInfoRightPanel(this.shell.$rightPanel):this.shell.$rightPanel.hide(),this.isFooterPanelEnabled()?(this.footerPanel=new FooterPanel_1.FooterPanel(this.shell.$footerPanel),this.mobileFooterPanel=new MobileFooter_1.FooterPanel(this.shell.$mobileFooterPanel)):this.shell.$footerPanel.hide(),this.$moreInfoDialogue=$('<div class="overlay moreInfo" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$moreInfoDialogue),this.moreInfoDialogue=new MoreInfoDialogue_1.MoreInfoDialogue(this.$moreInfoDialogue),this.$shareDialogue=$('<div class="overlay share" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$shareDialogue),this.shareDialogue=new ShareDialogue_1.ShareDialogue(this.$shareDialogue),this.$downloadDialogue=$('<div class="overlay download" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$downloadDialogue),this.downloadDialogue=new DownloadDialogue_1.DownloadDialogue(this.$downloadDialogue),this.$settingsDialogue=$('<div class="overlay settings" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$settingsDialogue),this.settingsDialogue=new SettingsDialogue_1.SettingsDialogue(this.$settingsDialogue),this.isHeaderPanelEnabled()&&this.headerPanel.init(),this.isLeftPanelEnabled()&&this.leftPanel.init(),this.isRightPanelEnabled()&&this.rightPanel.init(),this.isFooterPanelEnabled()&&this.footerPanel.init()},Extension.prototype.isLeftPanelEnabled=function(){return!0},Extension.prototype.render=function(){_super.prototype.render.call(this),this.checkForCFIParam()},Extension.prototype.getEmbedScript=function(template,width,height){var iframeSrc=this.getAppUri()+"#?manifest="+this.helper.manifestUri+"&cfi="+this.cfiFragement;return Utils.Strings.format(template,iframeSrc,width.toString(),height.toString())},Extension.prototype.checkForCFIParam=function(){var cfi=this.data.cfi;cfi&&this.component.publish(Events_1.Events.CFI_FRAGMENT_CHANGED,cfi)},Extension}(BaseExtension_1.BaseExtension);exports.Extension=Extension})),define("modules/uv-shared-module/Bookmark",["require","exports"],(function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Bookmark=function(){};exports.Bookmark=Bookmark}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("extensions/uv-mediaelement-extension/DownloadDialogue",["require","exports","../../modules/uv-dialogues-module/DownloadDialogue"],(function(require,exports,DownloadDialogue_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var DownloadDialogue=function(_super){function DownloadDialogue($element){return _super.call(this,$element)||this}return __extends(DownloadDialogue,_super),DownloadDialogue.prototype.create=function(){this.setConfig("downloadDialogue"),_super.prototype.create.call(this)},DownloadDialogue.prototype.open=function(triggerButton){_super.prototype.open.call(this,triggerButton),this.addEntireFileDownloadOptions(),this.updateNoneAvailable(),this.resize()},DownloadDialogue.prototype.isDownloadOptionAvailable=function(option){return _super.prototype.isDownloadOptionAvailable.call(this,option)},DownloadDialogue}(DownloadDialogue_1.DownloadDialogue);exports.DownloadDialogue=DownloadDialogue})),define("extensions/uv-mediaelement-extension/Events",["require","exports"],(function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Events=function(){function Events(){}return Events.namespace="mediaelementExtension.",Events.MEDIA_ENDED=Events.namespace+"mediaEnded",Events.MEDIA_PAUSED=Events.namespace+"mediaPaused",Events.MEDIA_PLAYED=Events.namespace+"mediaPlayed",Events}();exports.Events=Events}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-mediaelementcenterpanel-module/MediaElementCenterPanel",["require","exports","../uv-shared-module/BaseEvents","../../extensions/uv-mediaelement-extension/Events","../uv-shared-module/CenterPanel","../../Utils"],(function(require,exports,BaseEvents_1,Events_1,CenterPanel_1,Utils_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MediaElementCenterPanel=function(_super){function MediaElementCenterPanel($element){return _super.call(this,$element)||this}return __extends(MediaElementCenterPanel,_super),MediaElementCenterPanel.prototype.create=function(){this.setConfig("mediaelementCenterPanel"),_super.prototype.create.call(this);var that=this;this.component.subscribe(BaseEvents_1.BaseEvents.OPEN_EXTERNAL_RESOURCE,(function(resources){that.openMedia(resources)})),this.$container=$('<div class="container"></div>'),this.$content.append(this.$container),this.title=this.extension.helper.getLabel()},MediaElementCenterPanel.prototype.openMedia=function(resources){var _this=this,that=this;this.extension.getExternalResources(resources).then((function(){_this.$container.empty();var canvas=_this.extension.helper.getCurrentCanvas();_this.mediaHeight=_this.config.defaultHeight,_this.mediaWidth=_this.config.defaultWidth,_this.$container.height(_this.mediaHeight),_this.$container.width(_this.mediaWidth);var poster=_this.extension.getPosterImageUri(),sources=[],renderings=canvas.getRenderings();if(renderings&&renderings.length)canvas.getRenderings().forEach((function(rendering){sources.push({type:rendering.getFormat().toString(),src:rendering.id})}));else{var formats=_this.extension.getMediaFormats(_this.extension.helper.getCurrentCanvas());formats&&formats.length&&formats.forEach((function(format){var type=format.getFormat();type&&sources.push({type:type.toString(),src:format.id})}))}_this.isVideo()?(_this.$media=$('<video controls="controls" preload="none"></video>'),_this.$container.append(_this.$media),_this.player=new MediaElementPlayer($("video")[0],{poster:poster,features:["playpause","current","progress","volume"],success:function(mediaElement,originalNode){mediaElement.addEventListener("canplay",(function(){that.resize()})),mediaElement.addEventListener("play",(function(){that.component.publish(Events_1.Events.MEDIA_PLAYED,Math.floor(mediaElement.currentTime))})),mediaElement.addEventListener("pause",(function(){Math.floor(mediaElement.currentTime)!=Math.floor(mediaElement.duration)&&that.component.publish(Events_1.Events.MEDIA_PAUSED,Math.floor(mediaElement.currentTime))})),mediaElement.addEventListener("ended",(function(){that.component.publish(Events_1.Events.MEDIA_ENDED,Math.floor(mediaElement.duration))})),mediaElement.setSrc(sources)}}),_this.player.fullscreenBtn={},_this.player.fullscreenBtn.classList={},_this.player.fullscreenBtn.classList.add=function(){},_this.player.fullscreenBtn.classList.remove=function(){}):(_this.$media=$('<audio controls="controls" preload="none"></audio>'),_this.$container.append(_this.$media),_this.player=new MediaElementPlayer($("audio")[0],{poster:poster,defaultAudioWidth:"auto",defaultAudioHeight:"auto",showPosterWhenPaused:!0,showPosterWhenEnded:!0,success:function(mediaElement,originalNode){mediaElement.addEventListener("canplay",(function(){that.resize()})),mediaElement.addEventListener("play",(function(){that.component.publish(Events_1.Events.MEDIA_PLAYED,Math.floor(mediaElement.currentTime))})),mediaElement.addEventListener("pause",(function(){Math.floor(mediaElement.currentTime)!=Math.floor(mediaElement.duration)&&that.component.publish(Events_1.Events.MEDIA_PAUSED,Math.floor(mediaElement.currentTime))})),mediaElement.addEventListener("ended",(function(){that.component.publish(Events_1.Events.MEDIA_ENDED,Math.floor(mediaElement.duration))})),mediaElement.setSrc(sources)}})),_this.resize()}))},MediaElementCenterPanel.prototype.isVideo=function(){return this.extension.isVideo()},MediaElementCenterPanel.prototype.resize=function(){if(_super.prototype.resize.call(this),"Firefox"===window.browserDetect.browser&&window.browserDetect.version<13)this.$container.width(this.mediaWidth),this.$container.height(this.mediaHeight);else{var size=Utils.Dimensions.fitRect(this.mediaWidth,this.mediaHeight,this.$content.width(),this.$content.height());this.$container.height(size.height),this.$container.width(size.width),this.player&&!this.extension.isFullScreen()&&(this.$media.width(size.width),this.$media.height(size.height))}var left=Math.floor((this.$content.width()-this.$container.width())/2),top=Math.floor((this.$content.height()-this.$container.height())/2);if(this.$container.css({left:left,top:top}),this.title&&this.$title.text(Utils_1.UVUtils.sanitize(this.title)),this.player){this.player.setPlayerSize(),this.player.setControlsSize();var $mejs=$(".mejs__container");$mejs.css({"margin-top":(this.$container.height()-$mejs.height())/2})}},MediaElementCenterPanel}(CenterPanel_1.CenterPanel);exports.MediaElementCenterPanel=MediaElementCenterPanel}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("extensions/uv-mediaelement-extension/SettingsDialogue",["require","exports","../../modules/uv-dialogues-module/SettingsDialogue"],(function(require,exports,SettingsDialogue_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var SettingsDialogue=function(_super){function SettingsDialogue($element){return _super.call(this,$element)||this}return __extends(SettingsDialogue,_super),SettingsDialogue.prototype.create=function(){this.setConfig("settingsDialogue"),_super.prototype.create.call(this)},SettingsDialogue}(SettingsDialogue_1.SettingsDialogue);exports.SettingsDialogue=SettingsDialogue}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("extensions/uv-mediaelement-extension/ShareDialogue",["require","exports","../../modules/uv-dialogues-module/ShareDialogue"],(function(require,exports,ShareDialogue_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ShareDialogue=function(_super){function ShareDialogue($element){return _super.call(this,$element)||this}return __extends(ShareDialogue,_super),ShareDialogue.prototype.create=function(){this.setConfig("shareDialogue"),_super.prototype.create.call(this)},ShareDialogue.prototype.update=function(){_super.prototype.update.call(this),this.code=this.extension.getEmbedScript(this.options.embedTemplate,this.currentWidth,this.currentHeight),this.$code.val(this.code)},ShareDialogue.prototype.resize=function(){_super.prototype.resize.call(this)},ShareDialogue}(ShareDialogue_1.ShareDialogue);exports.ShareDialogue=ShareDialogue}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("extensions/uv-mediaelement-extension/Extension",["require","exports","manifesto.js","../../modules/uv-shared-module/BaseEvents","../../modules/uv-shared-module/BaseExtension","../../modules/uv-shared-module/Bookmark","./DownloadDialogue","./Events","../../modules/uv-shared-module/FooterPanel","../../modules/uv-shared-module/HeaderPanel","../../modules/uv-dialogues-module/HelpDialogue","../../modules/uv-mediaelementcenterpanel-module/MediaElementCenterPanel","../../modules/uv-moreinforightpanel-module/MoreInfoRightPanel","../../modules/uv-resourcesleftpanel-module/ResourcesLeftPanel","./SettingsDialogue","./ShareDialogue","@iiif/vocabulary"],(function(require,exports,Manifesto,BaseEvents_1,BaseExtension_1,Bookmark_1,DownloadDialogue_1,Events_1,FooterPanel_1,HeaderPanel_1,HelpDialogue_1,MediaElementCenterPanel_1,MoreInfoRightPanel_1,ResourcesLeftPanel_1,SettingsDialogue_1,ShareDialogue_1,vocabulary_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Extension=function(_super){function Extension(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Extension,_super),Extension.prototype.create=function(){var _this=this;_super.prototype.create.call(this),$(window).bind("enterfullscreen",(function(){_this.component.publish(BaseEvents_1.BaseEvents.TOGGLE_FULLSCREEN)})),$(window).bind("exitfullscreen",(function(){_this.component.publish(BaseEvents_1.BaseEvents.TOGGLE_FULLSCREEN)})),this.component.subscribe(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,(function(canvasIndex){_this.viewCanvas(canvasIndex)})),this.component.subscribe(BaseEvents_1.BaseEvents.THUMB_SELECTED,(function(thumb){_this.component.publish(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,thumb.index)})),this.component.subscribe(BaseEvents_1.BaseEvents.LEFTPANEL_EXPAND_FULL_START,(function(){_this.shell.$centerPanel.hide(),_this.shell.$rightPanel.hide()})),this.component.subscribe(BaseEvents_1.BaseEvents.LEFTPANEL_COLLAPSE_FULL_FINISH,(function(){_this.shell.$centerPanel.show(),_this.shell.$rightPanel.show(),_this.resize()})),this.component.subscribe(Events_1.Events.MEDIA_ENDED,(function(){_this.fire(Events_1.Events.MEDIA_ENDED)})),this.component.subscribe(Events_1.Events.MEDIA_PAUSED,(function(){_this.fire(Events_1.Events.MEDIA_PAUSED)})),this.component.subscribe(Events_1.Events.MEDIA_PLAYED,(function(){_this.fire(Events_1.Events.MEDIA_PLAYED)}))},Extension.prototype.createModules=function(){_super.prototype.createModules.call(this),this.isHeaderPanelEnabled()?this.headerPanel=new HeaderPanel_1.HeaderPanel(this.shell.$headerPanel):this.shell.$headerPanel.hide(),this.isLeftPanelEnabled()&&(this.leftPanel=new ResourcesLeftPanel_1.ResourcesLeftPanel(this.shell.$leftPanel)),this.centerPanel=new MediaElementCenterPanel_1.MediaElementCenterPanel(this.shell.$centerPanel),this.isRightPanelEnabled()&&(this.rightPanel=new MoreInfoRightPanel_1.MoreInfoRightPanel(this.shell.$rightPanel)),this.isFooterPanelEnabled()?this.footerPanel=new FooterPanel_1.FooterPanel(this.shell.$footerPanel):this.shell.$footerPanel.hide(),this.$helpDialogue=$('<div class="overlay help" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$helpDialogue),this.helpDialogue=new HelpDialogue_1.HelpDialogue(this.$helpDialogue),this.$downloadDialogue=$('<div class="overlay download" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$downloadDialogue),this.downloadDialogue=new DownloadDialogue_1.DownloadDialogue(this.$downloadDialogue),this.$shareDialogue=$('<div class="overlay share" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$shareDialogue),this.shareDialogue=new ShareDialogue_1.ShareDialogue(this.$shareDialogue),this.$settingsDialogue=$('<div class="overlay settings" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$settingsDialogue),this.settingsDialogue=new SettingsDialogue_1.SettingsDialogue(this.$settingsDialogue),this.isLeftPanelEnabled()&&this.leftPanel.init(),this.isRightPanelEnabled()&&this.rightPanel.init()},Extension.prototype.render=function(){_super.prototype.render.call(this)},Extension.prototype.isLeftPanelEnabled=function(){return Utils.Bools.getBool(this.data.config.options.leftPanelEnabled,!0)&&(this.helper.isMultiCanvas()||this.helper.isMultiSequence()||this.helper.hasResources())},Extension.prototype.bookmark=function(){_super.prototype.bookmark.call(this);var canvas=this.extensions.helper.getCurrentCanvas(),bookmark=new Bookmark_1.Bookmark;bookmark.index=this.helper.canvasIndex,bookmark.label=Manifesto.LanguageMap.getValue(canvas.getLabel()),bookmark.thumb=canvas.getProperty("thumbnail"),bookmark.title=this.helper.getLabel(),bookmark.trackingLabel=window.trackingLabel,this.isVideo()?bookmark.type=vocabulary_1.ExternalResourceType.MOVING_IMAGE.toString():bookmark.type=vocabulary_1.ExternalResourceType.SOUND.toString(),this.fire(BaseEvents_1.BaseEvents.BOOKMARK,bookmark)},Extension.prototype.getEmbedScript=function(template,width,height){var iframeSrc=this.getAppUri()+"#?manifest="+this.helper.manifestUri+"&c="+this.helper.collectionIndex+"&m="+this.helper.manifestIndex+"&s="+this.helper.sequenceIndex+"&cv="+this.helper.canvasIndex;return Utils.Strings.format(template,iframeSrc,width.toString(),height.toString())},Extension.prototype.getPosterImageUri=function(){var canvas=this.helper.getCurrentCanvas(),annotations=canvas.getContent();return annotations&&annotations.length?annotations[0].getProperty("thumbnail"):canvas.getProperty("thumbnail")},Extension.prototype.isVideoFormat=function(type){return-1!=[vocabulary_1.MediaType.VIDEO_MP4.toString(),vocabulary_1.MediaType.WEBM.toString()].indexOf(type)},Extension.prototype.isVideo=function(){console.log("isVideo");var canvas=this.helper.getCurrentCanvas(),annotations=canvas.getContent();if(annotations&&annotations.length){for(var formats=this.getMediaFormats(canvas),i=0;i<formats.length;i++){var type;if((type=formats[i].getFormat())&&this.isVideoFormat(type.toString()))return!0}return!1}if(type=canvas.getType())return type.toString()===vocabulary_1.ExternalResourceType.MOVING_IMAGE.toString();throw new Error("Unable to determine media type")},Extension}(BaseExtension_1.BaseExtension);exports.Extension=Extension})),define("modules/uv-shared-module/AnnotationResults",["require","exports"],(function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var AnnotationResults=function(){};exports.AnnotationResults=AnnotationResults})),define("modules/uv-shared-module/Point",["require","exports"],(function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Point=function(x,y){this.x=x,this.y=y};exports.Point=Point})),define("extensions/uv-seadragon-extension/CroppedImageDimensions",["require","exports","../../modules/uv-shared-module/Point"],(function(require,exports,Point_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Size=Utils.Size,CroppedImageDimensions=function(){this.region=new Size(0,0),this.regionPos=new Point_1.Point(0,0),this.size=new Size(0,0)};exports.CroppedImageDimensions=CroppedImageDimensions}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("extensions/uv-seadragon-extension/DownloadDialogue",["require","exports","manifesto.js","../../modules/uv-shared-module/BaseEvents","../../modules/uv-dialogues-module/DownloadDialogue","../../modules/uv-shared-module/DownloadOption"],(function(require,exports,manifesto_js_1,BaseEvents_1,DownloadDialogue_1,DownloadOption_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var DownloadDialogue=function(_super){function DownloadDialogue($element){return _super.call(this,$element)||this}return __extends(DownloadDialogue,_super),DownloadDialogue.prototype.create=function(){var _this=this;this.setConfig("downloadDialogue"),_super.prototype.create.call(this),this.$settingsButton=$('<a class="settings" href="#">'+this.content.editSettings+"</a>"),this.$pagingNote=$('<div class="pagingNote">'+this.content.pagingNote+" </div>"),this.$pagingNote.append(this.$settingsButton),this.$content.append(this.$pagingNote),this.$imageOptionsContainer=$('<li class="group image"></li>'),this.$downloadOptions.append(this.$imageOptionsContainer),this.$imageOptions=$("<ul></ul>"),this.$imageOptionsContainer.append(this.$imageOptions),this.$currentViewAsJpgButton=$('<li class="option single"><input id="'+DownloadOption_1.DownloadOption.CURRENT_VIEW+'" type="radio" name="downloadOptions" tabindex="0" /><label for="'+DownloadOption_1.DownloadOption.CURRENT_VIEW+'"></label></li>'),this.$imageOptions.append(this.$currentViewAsJpgButton),this.$currentViewAsJpgButton.hide(),this.$wholeImageHighResButton=$('<li class="option single"><input id="'+DownloadOption_1.DownloadOption.WHOLE_IMAGE_HIGH_RES+'" type="radio" name="downloadOptions" tabindex="0" /><label id="'+DownloadOption_1.DownloadOption.WHOLE_IMAGE_HIGH_RES+'label" for="'+DownloadOption_1.DownloadOption.WHOLE_IMAGE_HIGH_RES+'"></label></li>'),this.$imageOptions.append(this.$wholeImageHighResButton),this.$wholeImageHighResButton.hide(),this.$wholeImagesHighResButton=$('<li class="option multiple"><input id="'+DownloadOption_1.DownloadOption.WHOLE_IMAGES_HIGH_RES+'" type="radio" name="downloadOptions" tabindex="0" /><label id="'+DownloadOption_1.DownloadOption.WHOLE_IMAGES_HIGH_RES+'label" for="'+DownloadOption_1.DownloadOption.WHOLE_IMAGES_HIGH_RES+'"></label></li>'),this.$imageOptions.append(this.$wholeImagesHighResButton),this.$wholeImageHighResButton.hide(),this.$wholeImageLowResAsJpgButton=$('<li class="option single"><input id="'+DownloadOption_1.DownloadOption.WHOLE_IMAGE_LOW_RES+'" type="radio" name="downloadOptions" tabindex="0" /><label for="'+DownloadOption_1.DownloadOption.WHOLE_IMAGE_LOW_RES+'">'+this.content.wholeImageLowResAsJpg+"</label></li>"),this.$imageOptions.append(this.$wholeImageLowResAsJpgButton),this.$wholeImageLowResAsJpgButton.hide(),this.$canvasOptionsContainer=$('<li class="group canvas"></li>'),this.$downloadOptions.append(this.$canvasOptionsContainer),this.$canvasOptions=$("<ul></ul>"),this.$canvasOptionsContainer.append(this.$canvasOptions),this.$manifestOptionsContainer=$('<li class="group manifest"></li>'),this.$downloadOptions.append(this.$manifestOptionsContainer),this.$manifestOptions=$("<ul></ul>"),this.$manifestOptionsContainer.append(this.$manifestOptions),this.$selectionButton=$('<li class="option"><input id="'+DownloadOption_1.DownloadOption.SELECTION+'" type="radio" name="downloadOptions" tabindex="0" /><label id="'+DownloadOption_1.DownloadOption.SELECTION+'label" for="'+DownloadOption_1.DownloadOption.SELECTION+'"></label></li>'),this.$manifestOptions.append(this.$selectionButton),this.$selectionButton.hide(),this.$downloadButton=$('<a class="btn btn-primary" href="#" tabindex="0">'+this.content.download+"</a>"),this.$buttons.prepend(this.$downloadButton),this.$explanatoryTextTemplate=$('<span class="explanatory"></span>');var that=this;this.$downloadButton.on("click",(function(e){e.preventDefault();var $selectedOption=that.getSelectedOption(),id=$selectedOption.attr("id"),label=$selectedOption.attr("title"),mime=$selectedOption.data("mime"),type=DownloadOption_1.DownloadOption.UNKNOWN,canvas=_this.extension.helper.getCurrentCanvas();if(_this.renderingUrls[id])mime&&(-1!==mime.toLowerCase().indexOf("pdf")?type=DownloadOption_1.DownloadOption.ENTIRE_DOCUMENT_AS_PDF:-1!==mime.toLowerCase().indexOf("txt")&&(type=DownloadOption_1.DownloadOption.ENTIRE_DOCUMENT_AS_TEXT)),(type=DownloadOption_1.DownloadOption.ENTIRE_DOCUMENT_AS_PDF)&&window.open(_this.renderingUrls[id]);else switch(type=id){case DownloadOption_1.DownloadOption.CURRENT_VIEW:var viewer=that.extension.getViewer();window.open(that.extension.getCroppedImageUri(canvas,viewer));break;case DownloadOption_1.DownloadOption.SELECTION:Utils.Async.waitFor((function(){return!_this.isActive}),(function(){_this.component.publish(BaseEvents_1.BaseEvents.SHOW_MULTISELECT_DIALOGUE)}));break;case DownloadOption_1.DownloadOption.WHOLE_IMAGE_HIGH_RES:window.open(_this.getCanvasHighResImageUri(_this.extension.helper.getCurrentCanvas()));break;case DownloadOption_1.DownloadOption.WHOLE_IMAGES_HIGH_RES:for(var indices=_this.extension.getPagedIndices(),i=0;i<indices.length;i++)window.open(_this.getCanvasHighResImageUri(_this.extension.helper.getCanvasByIndex(indices[i])));break;case DownloadOption_1.DownloadOption.WHOLE_IMAGE_LOW_RES:var imageUri=that.extension.getConfinedImageUri(canvas,that.options.confinedImageSize);imageUri&&window.open(imageUri)}_this.component.publish(BaseEvents_1.BaseEvents.DOWNLOAD,{type:type,label:label}),_this.close()})),this.$settingsButton.onPressed((function(){_this.component.publish(BaseEvents_1.BaseEvents.HIDE_DOWNLOAD_DIALOGUE),_this.component.publish(BaseEvents_1.BaseEvents.SHOW_SETTINGS_DIALOGUE)}))},DownloadDialogue.prototype.open=function(triggerButton){_super.prototype.open.call(this,triggerButton);var canvas=this.extension.helper.getCurrentCanvas(),hasNormalDimensions=this.extension.getViewerRotation()%180==0;if(this.isDownloadOptionAvailable(DownloadOption_1.DownloadOption.CURRENT_VIEW)){var $input=this.$currentViewAsJpgButton.find("input"),$label=this.$currentViewAsJpgButton.find("label"),label=this.content.currentViewAsJpg,viewer=this.extension.getViewer(),dimensions=this.extension.getCroppedImageDimensions(canvas,viewer);if(dimensions?(label=hasNormalDimensions?Utils.Strings.format(label,dimensions.size.width.toString(),dimensions.size.height.toString()):Utils.Strings.format(label,dimensions.size.height.toString(),dimensions.size.width.toString()),$label.text(label),$input.prop("title",label),this.$currentViewAsJpgButton.data("width",dimensions.size.width),this.$currentViewAsJpgButton.data("height",dimensions.size.height),this.$currentViewAsJpgButton.show()):this.$currentViewAsJpgButton.hide(),Utils.Bools.getBool(this.options.optionsExplanatoryTextEnabled,!1))if(text=this.content.currentViewAsJpgExplanation)($span=this.$explanatoryTextTemplate.clone()).text(text),$label.append($span)}else this.$currentViewAsJpgButton.hide();if(this.isDownloadOptionAvailable(DownloadOption_1.DownloadOption.WHOLE_IMAGE_HIGH_RES)){$input=this.$wholeImageHighResButton.find("input"),$label=this.$wholeImageHighResButton.find("label");if(mime=(mime=this.getCanvasMimeType(this.extension.helper.getCurrentCanvas()))?Utils.Files.simplifyMimeType(mime):"?",size=this.getCanvasComputedDimensions(this.extension.helper.getCurrentCanvas())){label=hasNormalDimensions?Utils.Strings.format(this.content.wholeImageHighRes,size.width.toString(),size.height.toString(),mime):Utils.Strings.format(this.content.wholeImageHighRes,size.height.toString(),size.width.toString(),mime);$label.text(label),$input.prop("title",label),this.$wholeImageHighResButton.data("width",size.width),this.$wholeImageHighResButton.data("height",size.height),this.$wholeImageHighResButton.show()}else if(canvas.externalResource&&!canvas.externalResource.hasServiceDescriptor()){var label=Utils.Strings.format(this.content.wholeImageHighRes,"?","?",mime);$label.text(label),$input.prop("title",label),this.$wholeImageHighResButton.show()}else this.$wholeImageHighResButton.hide();if(Utils.Bools.getBool(this.options.optionsExplanatoryTextEnabled,!1))if(text=this.content.wholeImageHighResExplanation)($span=this.$explanatoryTextTemplate.clone()).text(text),$label.append($span)}else this.$wholeImageHighResButton.hide();if(this.isDownloadOptionAvailable(DownloadOption_1.DownloadOption.WHOLE_IMAGES_HIGH_RES)){var mime;$input=this.$wholeImagesHighResButton.find("input"),$label=this.$wholeImagesHighResButton.find("label");mime=(mime=this.getCanvasMimeType(this.extension.helper.getCurrentCanvas()))?Utils.Files.simplifyMimeType(mime):"?";label=Utils.Strings.format(this.content.wholeImagesHighRes,mime);if($label.text(label),$input.prop("title",label),this.$wholeImagesHighResButton.show(),Utils.Bools.getBool(this.options.optionsExplanatoryTextEnabled,!1))if(text=this.content.wholeImagesHighResExplanation)($span=this.$explanatoryTextTemplate.clone()).text(text),$label.append($span)}else this.$wholeImagesHighResButton.hide();if(this.isDownloadOptionAvailable(DownloadOption_1.DownloadOption.WHOLE_IMAGE_LOW_RES)){$input=this.$wholeImageLowResAsJpgButton.find("input"),$label=this.$wholeImageLowResAsJpgButton.find("label");var size=this.extension.getConfinedImageDimensions(canvas,this.options.confinedImageSize);label=hasNormalDimensions?Utils.Strings.format(this.content.wholeImageLowResAsJpg,size.width.toString(),size.height.toString()):Utils.Strings.format(this.content.wholeImageLowResAsJpg,size.height.toString(),size.width.toString());if($label.text(label),$input.prop("title",label),this.$wholeImageLowResAsJpgButton.data("width",size.width),this.$wholeImageLowResAsJpgButton.data("height",size.height),this.$wholeImageLowResAsJpgButton.show(),Utils.Bools.getBool(this.options.optionsExplanatoryTextEnabled,!1))if(text=this.content.wholeImageLowResAsJpgExplanation)($span=this.$explanatoryTextTemplate.clone()).text(text),$label.append($span)}else this.$wholeImageLowResAsJpgButton.hide();if(this.isDownloadOptionAvailable(DownloadOption_1.DownloadOption.SELECTION)){var text,$span;$input=this.$selectionButton.find("input");if(($label=this.$selectionButton.find("label")).text(this.content.downloadSelection),$input.prop("title",this.content.downloadSelection),this.$selectionButton.show(),Utils.Bools.getBool(this.options.optionsExplanatoryTextEnabled,!1))if(text=this.content.selectionExplanation)($span=this.$explanatoryTextTemplate.clone()).text(text),$label.append($span)}else this.$selectionButton.hide();if(this.resetDynamicDownloadOptions(),this.isDownloadOptionAvailable(DownloadOption_1.DownloadOption.RANGE_RENDERINGS)&&canvas.ranges&&canvas.ranges.length)for(var i=0;i<canvas.ranges.length;i++){var range=canvas.ranges[i],renderingOptions=this.getDownloadOptionsForRenderings(range,this.content.entireFileAsOriginal,DownloadOption_1.DownloadOption.CANVAS_RENDERINGS);this.addDownloadOptionsForRenderings(renderingOptions)}if(this.isDownloadOptionAvailable(DownloadOption_1.DownloadOption.IMAGE_RENDERINGS)){var images=canvas.getImages();for(i=0;i<images.length;i++){var renderingOptions=this.getDownloadOptionsForRenderings(images[i].getResource(),this.content.entireFileAsOriginal,DownloadOption_1.DownloadOption.IMAGE_RENDERINGS);this.addDownloadOptionsForRenderings(renderingOptions)}}if(this.isDownloadOptionAvailable(DownloadOption_1.DownloadOption.CANVAS_RENDERINGS)){renderingOptions=this.getDownloadOptionsForRenderings(canvas,this.content.entireFileAsOriginal,DownloadOption_1.DownloadOption.CANVAS_RENDERINGS);this.addDownloadOptionsForRenderings(renderingOptions)}this.isDownloadOptionAvailable(DownloadOption_1.DownloadOption.MANIFEST_RENDERINGS)&&(!(renderingOptions=this.getDownloadOptionsForRenderings(this.extension.helper.getCurrentSequence(),this.content.entireDocument,DownloadOption_1.DownloadOption.MANIFEST_RENDERINGS)).length&&this.extension.helper.manifest&&(renderingOptions=this.getDownloadOptionsForRenderings(this.extension.helper.manifest,this.content.entireDocument,DownloadOption_1.DownloadOption.MANIFEST_RENDERINGS)),this.addDownloadOptionsForRenderings(renderingOptions));if(this.isDownloadOptionAvailable(DownloadOption_1.DownloadOption.CURRENT_VIEW)){var currentWidth=parseInt(this.$currentViewAsJpgButton.data("width").toString()),currentHeight=parseInt(this.$currentViewAsJpgButton.data("height").toString()),percentageWidth=currentWidth/parseInt(this.$wholeImageHighResButton.data("width").toString())*100,percentageHeight=currentHeight/parseInt(this.$wholeImageHighResButton.data("height").toString())*100,disabledPercentage=this.options.currentViewDisabledPercentage;percentageWidth>=disabledPercentage&&percentageHeight>=disabledPercentage?this.$currentViewAsJpgButton.hide():this.$currentViewAsJpgButton.show()}var $options=this.$imageOptions.find("li.single");($options=$options.sort((function(a,b){var aWidth=$(a).data("width");aWidth&&(aWidth=parseInt(aWidth.toString()));var aHeight=$(a).data("height");aHeight&&(aHeight=parseInt(aHeight.toString()));var bWidth=$(b).data("width");bWidth&&(bWidth=parseInt(bWidth.toString()));var bHeight=$(b).data("height");bHeight&&(bHeight=parseInt(bHeight.toString()));var aArea=aWidth*aHeight,bArea=bWidth*bHeight;return aArea<bArea?-1:aArea>bArea?1:0}))).detach().appendTo(this.$imageOptions),this.$downloadOptions.find("li.group").each((function(index,group){var $group=$(group);$group.show(),$group.find("li.option:hidden").length===$group.find("li.option").length&&$group.hide()})),this.$downloadOptions.find("li.group:visible").last().addClass("lastVisible"),this.extension.isPagingSettingEnabled()&&this.config.options.downloadPagingNoteEnabled?this.$pagingNote.show():this.$pagingNote.hide(),this.$downloadOptions.find("li.option:visible").length?(this.$downloadOptions.find("li.option input:visible:first").prop("checked",!0),this.$noneAvailable.hide(),this.$downloadButton.show()):(this.$noneAvailable.show(),this.$downloadButton.hide()),this.resize()},DownloadDialogue.prototype.addDownloadOptionsForRenderings=function(renderingOptions){var _this=this;renderingOptions.forEach((function(option){switch(option.type){case DownloadOption_1.DownloadOption.IMAGE_RENDERINGS:_this.$imageOptions.append(option.button);break;case DownloadOption_1.DownloadOption.CANVAS_RENDERINGS:_this.$canvasOptions.append(option.button);break;case DownloadOption_1.DownloadOption.MANIFEST_RENDERINGS:_this.$manifestOptions.append(option.button)}}))},DownloadDialogue.prototype.getCanvasImageResource=function(canvas){var images=canvas.getImages();return images[0]?images[0].getResource():null},DownloadDialogue.prototype.getCanvasHighResImageUri=function(canvas){var size=this.getCanvasComputedDimensions(canvas);if(size){var width=size.width,uri=canvas.getCanonicalImageUri(width);if(canvas.externalResource&&canvas.externalResource.hasServiceDescriptor()){var uri_parts=uri.split("/"),rotation=this.extension.getViewerRotation();uri_parts[uri_parts.length-2]=String(rotation),uri=uri_parts.join("/")}return uri}return canvas.externalResource&&!canvas.externalResource.hasServiceDescriptor()?canvas.externalResource.dataUri:""},DownloadDialogue.prototype.getCanvasMimeType=function(canvas){var resource=this.getCanvasImageResource(canvas);if(resource){var format=resource.getFormat();if(format)return format.toString()}return null},DownloadDialogue.prototype.getCanvasDimensions=function(canvas){if(canvas.externalResource.data){var width=canvas.externalResource.data.width,height=canvas.externalResource.data.height;if(width&&height)return new manifesto_js_1.Size(width,height)}return null},DownloadDialogue.prototype.getCanvasComputedDimensions=function(canvas){var imageSize=this.getCanvasDimensions(canvas),requiredSize=canvas.getMaxDimensions();if(!imageSize)return null;if(!requiredSize)return imageSize;if(imageSize.width<=requiredSize.width&&imageSize.height<=requiredSize.height)return imageSize;var scaleW=requiredSize.width/imageSize.width,scaleH=requiredSize.height/imageSize.height,scale=Math.min(scaleW,scaleH);return new manifesto_js_1.Size(Math.floor(imageSize.width*scale),Math.floor(imageSize.height*scale))},DownloadDialogue.prototype._isLevel0=function(profile){return!(!profile||!profile.length)&&manifesto_js_1.Utils.isLevel0ImageProfile(profile[0])},DownloadDialogue.prototype.isDownloadOptionAvailable=function(option){if(!this.extension.resources)return!1;var canvas=this.extension.helper.getCurrentCanvas();if(!canvas.externalResource.hasServiceDescriptor()||this._isLevel0(canvas.externalResource.data.profile))return!(option!==DownloadOption_1.DownloadOption.WHOLE_IMAGE_HIGH_RES||!(!this.extension.isPagingSettingEnabled()||this.extension.isPagingSettingEnabled()&&this.extension.resources&&1===this.extension.resources.length));switch(option){case DownloadOption_1.DownloadOption.CURRENT_VIEW:case DownloadOption_1.DownloadOption.CANVAS_RENDERINGS:case DownloadOption_1.DownloadOption.IMAGE_RENDERINGS:case DownloadOption_1.DownloadOption.WHOLE_IMAGE_HIGH_RES:if(!this.extension.isPagingSettingEnabled()||this.extension.isPagingSettingEnabled()&&this.extension.resources&&1===this.extension.resources.length){var maxDimensions=canvas.getMaxDimensions();return!maxDimensions||maxDimensions.width<=this.options.maxImageWidth}return!1;case DownloadOption_1.DownloadOption.WHOLE_IMAGES_HIGH_RES:return!!(this.extension.isPagingSettingEnabled()&&this.extension.resources&&this.extension.resources.length>1);case DownloadOption_1.DownloadOption.WHOLE_IMAGE_LOW_RES:var size=this.getCanvasComputedDimensions(canvas);return!!size&&(!this.extension.isPagingSettingEnabled()&&size.width>this.options.confinedImageSize);case DownloadOption_1.DownloadOption.SELECTION:return this.options.selectionEnabled;case DownloadOption_1.DownloadOption.RANGE_RENDERINGS:return!(!canvas.ranges||!canvas.ranges.length)&&canvas.ranges[0].getRenderings().length>0;default:return _super.prototype.isDownloadOptionAvailable.call(this,option)}},DownloadDialogue}(DownloadDialogue_1.DownloadDialogue);exports.DownloadDialogue=DownloadDialogue}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-dialogues-module/ExternalContentDialogue",["require","exports","../uv-shared-module/BaseEvents","../uv-shared-module/Dialogue"],(function(require,exports,BaseEvents_1,Dialogue_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ExternalContentDialogue=function(_super){function ExternalContentDialogue($element){return _super.call(this,$element)||this}return __extends(ExternalContentDialogue,_super),ExternalContentDialogue.prototype.create=function(){var _this=this;this.setConfig("externalContentDialogue"),_super.prototype.create.call(this),this.openCommand=BaseEvents_1.BaseEvents.SHOW_EXTERNALCONTENT_DIALOGUE,this.closeCommand=BaseEvents_1.BaseEvents.HIDE_EXTERNALCONTENT_DIALOGUE,this.component.subscribe(this.openCommand,(function(params){_this.open(),_this.$iframe.prop("src",params.uri)})),this.component.subscribe(this.closeCommand,(function(){_this.close()})),this.$iframe=$("<iframe></iframe>"),this.$content.append(this.$iframe),this.$element.hide()},ExternalContentDialogue.prototype.resize=function(){_super.prototype.resize.call(this),this.$iframe.width(this.$content.width()),this.$iframe.height(this.$content.height())},ExternalContentDialogue}(Dialogue_1.Dialogue);exports.ExternalContentDialogue=ExternalContentDialogue}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-osdmobilefooterpanel-module/MobileFooter",["require","exports","../uv-shared-module/FooterPanel","../../extensions/uv-seadragon-extension/Events"],(function(require,exports,FooterPanel_1,Events_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var FooterPanel=function(_super){function FooterPanel($element){return _super.call(this,$element)||this}return __extends(FooterPanel,_super),FooterPanel.prototype.create=function(){var _this=this;this.setConfig("mobileFooterPanel"),_super.prototype.create.call(this),this.$spacer=$('<div class="spacer"></div>'),this.$options.prepend(this.$spacer),this.$rotateButton=$('\n            <button class="btn imageBtn rotate" title="'+this.content.rotateRight+'">\n                <i class="uv-icon-rotate" aria-hidden="true"></i>'+this.content.rotateRight+"\n            </button>\n        "),this.$options.prepend(this.$rotateButton),this.$zoomOutButton=$('\n            <button class="btn imageBtn zoomOut" title="'+this.content.zoomOut+'">\n                <i class="uv-icon-zoom-out" aria-hidden="true"></i>'+this.content.zoomOut+"\n            </button>\n        "),this.$options.prepend(this.$zoomOutButton),this.$zoomInButton=$('\n            <button class="btn imageBtn zoomIn" title="'+this.content.zoomIn+'">\n                <i class="uv-icon-zoom-in" aria-hidden="true"></i>'+this.content.zoomIn+"\n            </button>\n        "),this.$options.prepend(this.$zoomInButton),this.$zoomInButton.onPressed((function(){_this.component.publish(Events_1.Events.ZOOM_IN)})),this.$zoomOutButton.onPressed((function(){_this.component.publish(Events_1.Events.ZOOM_OUT)})),this.$rotateButton.onPressed((function(){_this.component.publish(Events_1.Events.ROTATE)}))},FooterPanel.prototype.resize=function(){_super.prototype.resize.call(this),this.$options.css("left",Math.floor(this.$element.width()/2-this.$options.width()/2))},FooterPanel}(FooterPanel_1.FooterPanel);exports.FooterPanel=FooterPanel})),define("modules/uv-shared-module/AutoComplete",["require","exports"],(function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var AutoComplete=function(){function AutoComplete(element,autoCompleteFunc,parseResultsFunc,onSelect,delay,minChars,positionAbove,allowWords){void 0===delay&&(delay=300),void 0===minChars&&(minChars=2),void 0===positionAbove&&(positionAbove=!1),void 0===allowWords&&(allowWords=!1);var _this=this;this._$element=element,this._autoCompleteFunc=autoCompleteFunc,this._delay=delay,this._minChars=minChars,this._onSelect=onSelect,this._parseResultsFunc=parseResultsFunc,this._positionAbove=positionAbove,this._allowWords=allowWords,this._$searchResultsList=$('<ul class="autocomplete"></ul>'),this._positionAbove?this._$element.parent().prepend(this._$searchResultsList):this._$element.parent().append(this._$searchResultsList),this._$searchResultTemplate=$('<li class="result"><a href="#" tabindex="-1"></a></li>');var timer,typewatch=(timer=0,function(cb,ms){clearTimeout(timer),timer=setTimeout(cb,ms)}),that=this;this._$element.on("keydown",(function(e){var originalEvent=e.originalEvent,charCode=Utils.Keyboard.getCharCode(originalEvent),cancelEvent=!1;(charCode===KeyCodes.KeyDown.LeftArrow||charCode===KeyCodes.KeyDown.RightArrow)&&(cancelEvent=!0),cancelEvent&&(originalEvent.cancelBubble=!0,originalEvent.stopPropagation&&originalEvent.stopPropagation())})),this._$element.on("keyup",(function(e){if(that._getSelectedListItem().length||e.keyCode!==KeyCodes.KeyDown.Enter){if(that._$searchResultsList.is(":visible")&&that._results.length)if(e.keyCode===KeyCodes.KeyDown.Enter)that._searchForItem(that._getSelectedListItem());else{if(e.keyCode===KeyCodes.KeyDown.DownArrow)return void that._setSelectedResultIndex(1);if(e.keyCode===KeyCodes.KeyDown.UpArrow)return void that._setSelectedResultIndex(-1)}e.keyCode!==KeyCodes.KeyDown.Enter&&typewatch((function(){var val=that._getTerms();val&&val.length>that._minChars&&that._searchForWords(val)?that._search(val):(that._clearResults(),that._hideResults())}),that._delay)}else that._onSelect(that._getTerms())})),$(document).on("mouseup",(function(e){0===_this._$searchResultsList.parent().has($(e.target)[0]).length&&(_this._clearResults(),_this._hideResults())})),this._hideResults()}return AutoComplete.prototype._searchForWords=function(search){return!(!this._allowWords&&search.includes(" "))},AutoComplete.prototype._getTerms=function(){return this._$element.val().trim()},AutoComplete.prototype._setSelectedResultIndex=function(direction){var nextIndex;nextIndex=1===direction?this._selectedResultIndex+1:this._selectedResultIndex-1;var $items=this._$searchResultsList.find("li");nextIndex<0?nextIndex=$items.length-1:nextIndex>$items.length-1&&(nextIndex=0),this._selectedResultIndex=nextIndex,$items.removeClass("selected");var $selectedItem=$items.eq(this._selectedResultIndex);$selectedItem.addClass("selected");var top=$selectedItem.outerHeight(!0)*this._selectedResultIndex;this._$searchResultsList.scrollTop(top)},AutoComplete.prototype._search=function(term){this._results=[],this._clearResults(),this._showResults(),this._$searchResultsList.append('<li class="loading"></li>'),this._updateListPosition();var that=this;this._autoCompleteFunc(term,(function(results){that._listResults(results)}))},AutoComplete.prototype._clearResults=function(){this._$searchResultsList.empty()},AutoComplete.prototype._hideResults=function(){this._$searchResultsList.hide()},AutoComplete.prototype._showResults=function(){this._selectedResultIndex=-1,this._$searchResultsList.show()},AutoComplete.prototype._updateListPosition=function(){this._positionAbove?this._$searchResultsList.css({top:-1*this._$searchResultsList.outerHeight(!0)}):this._$searchResultsList.css({top:this._$element.outerHeight(!0)})},AutoComplete.prototype._listResults=function(results){if(this._results=this._parseResultsFunc(results),this._clearResults(),this._results.length){for(var i=0;i<this._results.length;i++){var result=this._results[i],$resultItem=this._$searchResultTemplate.clone();$resultItem.find("a").text(result),this._$searchResultsList.append($resultItem)}this._updateListPosition();var that=this;this._$searchResultsList.find("li").on("click",(function(e){e.preventDefault(),that._searchForItem($(this))}))}else this._hideResults()},AutoComplete.prototype._searchForItem=function($item){var term=$item.find("a").text();this._$element.val(term),this._hideResults(),this._onSelect(term),this._clearResults(),this._hideResults()},AutoComplete.prototype._getSelectedListItem=function(){return this._$searchResultsList.find("li.selected")},AutoComplete}();exports.AutoComplete=AutoComplete}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-searchfooterpanel-module/FooterPanel",["require","exports","manifesto.js","../uv-shared-module/AutoComplete","../uv-shared-module/BaseEvents","../../extensions/uv-seadragon-extension/Events","../uv-shared-module/FooterPanel","../../extensions/uv-seadragon-extension/Mode","../../Utils"],(function(require,exports,manifesto_js_1,AutoComplete_1,BaseEvents_1,Events_1,FooterPanel_1,Mode_1,Utils_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var FooterPanel=function(_super){function FooterPanel($element){var _this=_super.call(this,$element)||this;return _this.placemarkerTouched=!1,_this}return __extends(FooterPanel,_super),FooterPanel.prototype.create=function(){var _this=this;this.setConfig("searchFooterPanel"),_super.prototype.create.call(this),this.component.subscribe(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,(function(){_this.canvasIndexChanged(),_this.setCurrentSearchResultPlacemarker(),_this.updatePrevButton(),_this.updateNextButton()})),this.component.subscribe(BaseEvents_1.BaseEvents.CLEAR_ANNOTATIONS,(function(){_this.clearSearchResults()})),this.component.subscribe(Events_1.Events.MODE_CHANGED,(function(){_this.settingsChanged()})),this.component.subscribe(Events_1.Events.SEARCH,(function(terms){_this.terms=terms})),this.component.subscribe(BaseEvents_1.BaseEvents.ANNOTATIONS,(function(annotationResults){_this.displaySearchResults(annotationResults.annotations,annotationResults.terms),_this.setCurrentSearchResultPlacemarker(),_this.updatePrevButton(),_this.updateNextButton()})),this.component.subscribe(BaseEvents_1.BaseEvents.ANNOTATIONS_EMPTY,(function(){_this.hideSearchSpinner()})),this.component.subscribe(BaseEvents_1.BaseEvents.ANNOTATION_CHANGED,(function(){_this.updatePrevButton(),_this.updateNextButton()})),this.$printButton=$('\n          <button class="print btn imageBtn" title="'+this.content.print+'" tabindex="0">\n            <i class="uv-icon uv-icon-print" aria-hidden="true"></i>'+this.content.print+"\n          </button>\n        "),this.$options.prepend(this.$printButton),this.$searchContainer=$('<div class="search"></div>'),this.$element.prepend(this.$searchContainer),this.$searchOptions=$('<div class="searchOptions"></div>'),this.$searchContainer.append(this.$searchOptions),this.$searchLabel=$('<span class="label">'+this.content.searchWithin+"</span>"),this.$searchOptions.append(this.$searchLabel),this.$searchTextContainer=$('<div class="searchTextContainer"></div>'),this.$searchOptions.append(this.$searchTextContainer),this.$searchText=$('<input class="searchText" type="text" maxlength="100" value="'+this.content.enterKeyword+'" aria-label="'+this.content.searchWithin+'"/>'),this.$searchTextContainer.append(this.$searchText),this.$searchButton=$('<a class="imageButton searchButton" tabindex="0"></a>'),this.$searchTextContainer.append(this.$searchButton),this.$searchPagerContainer=$('<div class="searchPager"></div>'),this.$element.prepend(this.$searchPagerContainer),this.$searchPagerControls=$('<div class="controls"></div>'),this.$searchPagerContainer.prepend(this.$searchPagerControls),this.$previousResultButton=$('<a class="previousResult" title="'+this.content.previousResult+'">'+this.content.previousResult+"</a>"),this.$searchPagerControls.append(this.$previousResultButton),this.$searchResultsInfo=$('<div class="searchResultsInfo"><span class="info"><span class="number">x</span> <span class="foundFor"></span> \'<span class="terms">y</span>\'</span></div>'),this.$searchPagerControls.append(this.$searchResultsInfo),this.$clearSearchResultsButton=$('<a class="clearSearch" title="'+this.content.clearSearch+'">'+this.content.clearSearch+"</a>"),this.$searchResultsInfo.append(this.$clearSearchResultsButton),this.$nextResultButton=$('<a class="nextResult" title="'+this.content.nextResult+'">'+this.content.nextResult+"</a>"),this.$searchPagerControls.append(this.$nextResultButton),this.$searchResultsContainer=$('<div class="searchResults"></div>'),this.$element.prepend(this.$searchResultsContainer),this.$line=$('<div class="line"></div>'),this.$searchResultsContainer.append(this.$line),this.$pagePositionMarker=$('<div class="positionPlacemarker"></div>'),this.$searchResultsContainer.append(this.$pagePositionMarker),this.$pagePositionLabel=$('<div class="label"></div>'),this.$searchResultsContainer.append(this.$pagePositionLabel),this.$placemarkerDetails=$('<div class="placeMarkerDetails"></div>'),this.$searchResultsContainer.append(this.$placemarkerDetails),this.$placemarkerDetailsTop=$("<h1></h1>"),this.$placemarkerDetails.append(this.$placemarkerDetailsTop),this.$placemarkerDetailsBottom=$("<p></p>"),this.$placemarkerDetails.append(this.$placemarkerDetailsBottom),this.$searchPagerContainer.hide(),this.$placemarkerDetails.hide();var that=this;this.$searchButton.on("click",(function(e){e.preventDefault(),_this.search(_this.$searchText.val())})),this.$searchText.on("focus",(function(){_this.$searchText.val()===_this.content.enterKeyword&&_this.$searchText.val("")})),this.$placemarkerDetails.on("mouseover",(function(){that.component.publish(Events_1.Events.SEARCH_PREVIEW_START,_this.currentPlacemarkerIndex)})),this.$placemarkerDetails.on("mouseleave",(function(){$(this).hide(),that.component.publish(Events_1.Events.SEARCH_PREVIEW_FINISH),that.getSearchResultPlacemarkers().removeClass("hover")})),this.$placemarkerDetails.on("click",(function(){that.component.publish(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,_this.currentPlacemarkerIndex)})),this.$previousResultButton.on("click",(function(e){e.preventDefault(),_this.isPreviousButtonEnabled()&&that.component.publish(Events_1.Events.PREV_SEARCH_RESULT)})),this.$nextResultButton.on("click",(function(e){e.preventDefault(),_this.isNextButtonEnabled()&&that.component.publish(Events_1.Events.NEXT_SEARCH_RESULT)})),this.$clearSearchResultsButton.on("click",(function(e){e.preventDefault(),that.component.publish(BaseEvents_1.BaseEvents.CLEAR_ANNOTATIONS)})),this.isSearchEnabled()||(this.$searchContainer.hide(),this.$searchPagerContainer.hide(),this.$searchResultsContainer.hide(),this.$element.addClass("min")),1===this.extension.helper.getTotalCanvases()&&this.$searchResultsContainer.hide();var autocompleteService=this.extension.getAutoCompleteUri();autocompleteService?new AutoComplete_1.AutoComplete(this.$searchText,(function(terms,cb){$.getJSON(Utils.Strings.format(autocompleteService,terms),(function(results){cb(results)}))}),(function(results){return $.map(results.terms,(function(result){return result.match}))}),(function(terms){_this.search(terms)}),300,2,!0,Utils.Bools.getBool(this.options.autocompleteAllowWords,!1)):this.$searchText.on("keyup",(function(e){e.keyCode===KeyCodes.KeyDown.Enter&&that.search(that.$searchText.val())})),this.$printButton.onPressed((function(){that.component.publish(Events_1.Events.PRINT)})),this.updatePrintButton(),Utils.Bools.getBool(this.config.options.positionMarkerEnabled,!0)||(this.$pagePositionMarker.hide(),this.$pagePositionLabel.hide())},FooterPanel.prototype.isSearchEnabled=function(){return this.extension.isSearchEnabled()},FooterPanel.prototype.isZoomToSearchResultEnabled=function(){return Utils.Bools.getBool(this.extension.data.config.options.zoomToSearchResultEnabled,!0)},FooterPanel.prototype.isPreviousButtonEnabled=function(){var currentCanvasIndex=this.extension.helper.canvasIndex,firstSearchResultCanvasIndex=this.getFirstSearchResultCanvasIndex(),currentSearchResultRectIndex=this.getCurrentSearchResultRectIndex();return this.isZoomToSearchResultEnabled()&&this.extension.currentAnnotationRect?!(currentCanvasIndex<firstSearchResultCanvasIndex)&&(currentCanvasIndex!==firstSearchResultCanvasIndex||0!==currentSearchResultRectIndex):currentCanvasIndex>firstSearchResultCanvasIndex},FooterPanel.prototype.isNextButtonEnabled=function(){var currentCanvasIndex=this.extension.helper.canvasIndex,lastSearchResultCanvasIndex=this.getLastSearchResultCanvasIndex(),currentSearchResultRectIndex=this.getCurrentSearchResultRectIndex();return this.isZoomToSearchResultEnabled()&&this.extension.currentAnnotationRect?!(currentCanvasIndex>lastSearchResultCanvasIndex)&&(currentCanvasIndex!==lastSearchResultCanvasIndex||currentSearchResultRectIndex!==this.getLastSearchResultRectIndex()):currentCanvasIndex<lastSearchResultCanvasIndex},FooterPanel.prototype.getSearchResults=function(){return this.extension.annotations},FooterPanel.prototype.getCurrentSearchResultRectIndex=function(){return this.extension.getCurrentAnnotationRectIndex()},FooterPanel.prototype.getFirstSearchResultCanvasIndex=function(){var searchResults=this.getSearchResults();return searchResults?searchResults[0].canvasIndex:-1},FooterPanel.prototype.getLastSearchResultCanvasIndex=function(){var searchResults=this.getSearchResults();return searchResults?searchResults[searchResults.length-1].canvasIndex:-1},FooterPanel.prototype.getLastSearchResultRectIndex=function(){return this.extension.getLastAnnotationRectIndex()},FooterPanel.prototype.updateNextButton=function(){var searchResults=this.getSearchResults();searchResults&&searchResults.length&&(this.isNextButtonEnabled()?this.$nextResultButton.removeClass("disabled"):this.$nextResultButton.addClass("disabled"))},FooterPanel.prototype.updatePrevButton=function(){var searchResults=this.getSearchResults();searchResults&&searchResults.length&&(this.isPreviousButtonEnabled()?this.$previousResultButton.removeClass("disabled"):this.$previousResultButton.addClass("disabled"))},FooterPanel.prototype.updatePrintButton=function(){Utils.Bools.getBool(this.options.printEnabled,!1)?this.$printButton.show():this.$printButton.hide()},FooterPanel.prototype.search=function(terms){var _this=this;this.terms=terms,""!==this.terms&&this.terms!==this.content.enterKeyword?(this.$searchText.blur(),this.showSearchSpinner(),this.component.publish(Events_1.Events.SEARCH,this.terms)):this.extension.showMessage(this.extension.data.config.modules.genericDialogue.content.emptyValue,(function(){_this.$searchText.focus()}))},FooterPanel.prototype.getSearchResultPlacemarkers=function(){return this.$searchResultsContainer.find(".searchResultPlacemarker")},FooterPanel.prototype.setCurrentSearchResultPlacemarker=function(){this.getSearchResultPlacemarkers().parent().find(".current").removeClass("current"),$('.searchResultPlacemarker[data-index="'+this.extension.helper.canvasIndex+'"]').addClass("current")},FooterPanel.prototype.positionSearchResultPlacemarkers=function(){var searchResults=this.getSearchResults();if(searchResults&&searchResults.length){this.getSearchResultPlacemarkers().remove();for(var pageWidth=this.getPageLineRatio(),lineTop=this.$line.position().top,lineLeft=this.$line.position().left,that=this,i=0;i<searchResults.length;i++){var result=searchResults[i],distance=result.canvasIndex*pageWidth,$placemarker=$('<div class="searchResultPlacemarker" data-index="'+result.canvasIndex+'"></div>');$placemarker[0].ontouchstart=function(e){that.onPlacemarkerTouchStart.call(this,that)},$placemarker.click((function(e){that.onPlacemarkerClick.call(this,that)})),$placemarker.mouseenter((function(e){that.onPlacemarkerMouseEnter.call(this,that)})),$placemarker.mouseleave((function(e){that.onPlacemarkerMouseLeave.call(this,e,that)})),this.$searchResultsContainer.append($placemarker);var top_1=lineTop-$placemarker.height(),left=lineLeft+distance-$placemarker.width()/2;$placemarker.css({top:top_1,left:left})}}},FooterPanel.prototype.onPlacemarkerTouchStart=function(that){that.placemarkerTouched=!0},FooterPanel.prototype.onPlacemarkerClick=function(that){that.placemarkerTouched||(that.placemarkerTouched=!1)},FooterPanel.prototype.onPlacemarkerMouseEnter=function(that){if(!that.placemarkerTouched){var $placemarker=$(this);$placemarker.addClass("hover");var canvasIndex=parseInt($placemarker.attr("data-index"));that.component.publish(Events_1.Events.SEARCH_PREVIEW_START,canvasIndex);var elemIndex=that.getSearchResultPlacemarkers().index($placemarker[0]);that.currentPlacemarkerIndex=canvasIndex,that.$placemarkerDetails.show();var title="{0} {1}";if(that.isPageModeEnabled()){var canvas=that.extension.helper.getCanvasByIndex(canvasIndex),label=manifesto_js_1.LanguageMap.getValue(canvas.getLabel());!label&&that.extension.helper.manifest&&(label=that.extension.helper.manifest.options.defaultLabel),title=Utils.Strings.format(title,that.content.pageCaps,label)}else title=Utils.Strings.format(title,that.content.imageCaps,String(canvasIndex+1));that.$placemarkerDetailsTop.html(title);var searchResults=that.getSearchResults();if(searchResults){var result=searchResults[elemIndex],terms="";that.terms&&(terms=Utils.Strings.ellipsis(that.terms,that.options.elideDetailsTermsCount));var instanceFoundText=that.content.instanceFound,instancesFoundText=that.content.instancesFound,text="";1===result.rects.length?(text=Utils.Strings.format(instanceFoundText,terms),that.$placemarkerDetailsBottom.html(text)):(text=Utils.Strings.format(instancesFoundText,String(result.rects.length),terms),that.$placemarkerDetailsBottom.html(text))}var pos=$placemarker.position(),top=pos.top-that.$placemarkerDetails.height(),left=pos.left;left<that.$placemarkerDetails.width()/2?left=0-$placemarker.width()/2:left>that.$line.width()-that.$placemarkerDetails.width()/2?left=that.$line.width()-that.$placemarkerDetails.width()+$placemarker.width()/2:left-=that.$placemarkerDetails.width()/2,that.$placemarkerDetails.css({top:top,left:left})}},FooterPanel.prototype.onPlacemarkerMouseLeave=function(e,that){that.component.publish(Events_1.Events.SEARCH_PREVIEW_FINISH);var $placemarker=$(this),newElement=e.toElement||e.relatedTarget,isChild=$(newElement).closest(that.$placemarkerDetails).length;newElement!=that.$placemarkerDetails.get(0)&&0===isChild&&(that.$placemarkerDetails.hide(),$placemarker.removeClass("hover"))},FooterPanel.prototype.setPageMarkerPosition=function(){if(null!==this.extension.helper.canvasIndex){var pageLineRatio=this.getPageLineRatio(),top=this.$line.position().top,left=this.$line.position().left+this.extension.helper.canvasIndex*pageLineRatio;this.$pagePositionMarker.css({top:top,left:left});var lineWidth=this.$line.width();left+this.$pagePositionLabel.outerWidth(!0)>lineWidth?(left-=this.$pagePositionLabel.outerWidth(!0),this.$pagePositionLabel.removeClass("right"),this.$pagePositionLabel.addClass("left")):(this.$pagePositionLabel.removeClass("left"),this.$pagePositionLabel.addClass("right")),this.$pagePositionLabel.css({top:top,left:left})}},FooterPanel.prototype.clearSearchResults=function(){this.isSearchEnabled()&&(this.getSearchResultPlacemarkers().remove(),this.$searchText.val(this.content.enterKeyword),this.$searchContainer.show(),this.$searchPagerContainer.hide(),this.$searchText.focus())},FooterPanel.prototype.getPageLineRatio=function(){var lineWidth=this.$line.width();return 1===this.extension.helper.getTotalCanvases()?0:lineWidth/(this.extension.helper.getTotalCanvases()-1)},FooterPanel.prototype.canvasIndexChanged=function(){this.setPageMarkerPosition(),this.setPlacemarkerLabel()},FooterPanel.prototype.settingsChanged=function(){this.setPlacemarkerLabel()},FooterPanel.prototype.setPlacemarkerLabel=function(){var displaying=this.content.displaying,index=this.extension.helper.canvasIndex;if(this.isPageModeEnabled()){var canvas=this.extension.helper.getCanvasByIndex(index),label=manifesto_js_1.LanguageMap.getValue(canvas.getLabel());label||(label=this.content.defaultLabel);var lastCanvasOrderLabel=this.extension.helper.getLastCanvasLabel(!0);lastCanvasOrderLabel&&this.$pagePositionLabel.html(Utils.Strings.format(displaying,this.content.page,Utils_1.UVUtils.sanitize(label),Utils_1.UVUtils.sanitize(lastCanvasOrderLabel)))}else this.$pagePositionLabel.html(Utils.Strings.format(displaying,this.content.image,String(index+1),this.extension.helper.getTotalCanvases().toString()))},FooterPanel.prototype.isPageModeEnabled=function(){return this.config.options.pageModeEnabled&&this.extension.getMode().toString()===Mode_1.Mode.page.toString()&&!Utils.Bools.getBool(this.config.options.forceImageMode,!1)},FooterPanel.prototype.showSearchSpinner=function(){this.$searchText.addClass("searching")},FooterPanel.prototype.hideSearchSpinner=function(){this.$searchText.removeClass("searching")},FooterPanel.prototype.displaySearchResults=function(results,terms){if(this.isSearchEnabled()){this.hideSearchSpinner(),this.positionSearchResultPlacemarkers(),this.$searchContainer.hide(),this.$searchPagerControls.css({left:0});var $info=this.$searchResultsInfo.find(".info"),$number=$info.find(".number"),$foundFor=$info.find(".foundFor"),$terms=$info.find(".terms");terms?($info.show(),$number.text(this.extension.getTotalAnnotationRects()),1===results.length?$foundFor.html(this.content.resultFoundFor):$foundFor.html(this.content.resultsFoundFor),$terms.html(Utils.Strings.ellipsis(terms,this.options.elideResultsTermsCount)),$terms.prop("title",terms)):$info.hide(),this.$searchPagerContainer.show(),this.resize()}},FooterPanel.prototype.resize=function(){_super.prototype.resize.call(this);var searchResults=this.getSearchResults();searchResults&&searchResults.length&&this.positionSearchResultPlacemarkers(),this.setPageMarkerPosition(),this.$searchPagerContainer.width(this.$element.width());var center=this.$element.width()/2;this.$searchPagerControls.css({left:center-this.$searchPagerControls.width()/2}),this.$searchOptions.css({left:center-this.$searchOptions.outerWidth()/2})},FooterPanel}(FooterPanel_1.FooterPanel);exports.FooterPanel=FooterPanel}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-multiselectdialogue-module/MultiSelectDialogue",["require","exports","../uv-shared-module/BaseEvents","../uv-shared-module/Dialogue","../../extensions/uv-seadragon-extension/Mode","@iiif/iiif-gallery-component"],(function(require,exports,BaseEvents_1,Dialogue_1,Mode_1,iiif_gallery_component_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MultiSelectDialogue=function(_super){function MultiSelectDialogue($element){return _super.call(this,$element)||this}return __extends(MultiSelectDialogue,_super),MultiSelectDialogue.prototype.create=function(){var _this=this;this.setConfig("multiSelectDialogue"),_super.prototype.create.call(this);var that=this;this.openCommand=BaseEvents_1.BaseEvents.SHOW_MULTISELECT_DIALOGUE,this.closeCommand=BaseEvents_1.BaseEvents.HIDE_MULTISELECT_DIALOGUE,this.component.subscribe(this.openCommand,(function(){_this.open(),_this.extension.helper.getMultiSelectState().setEnabled(!0),_this.galleryComponent.set(_this.data)})),this.component.subscribe(this.closeCommand,(function(){_this.close(),_this.extension.helper.getMultiSelectState().setEnabled(!1)})),this.$title=$("<h1></h1>"),this.$content.append(this.$title),this.$title.text(this.content.title),this.$gallery=$('<div class="iiif-gallery-component"></div>'),this.$content.append(this.$gallery),this.data={helper:this.extension.helper,chunkedResizingThreshold:this.config.options.galleryThumbChunkedResizingThreshold,content:this.config.content,debug:!1,imageFadeInDuration:300,initialZoom:4,minLabelWidth:20,pageModeEnabled:this.isPageModeEnabled(),searchResults:[],scrollStopDuration:100,sizingEnabled:!0,thumbHeight:this.config.options.galleryThumbHeight,thumbLoadPadding:this.config.options.galleryThumbLoadPadding,thumbWidth:this.config.options.galleryThumbWidth,viewingDirection:this.extension.helper.getViewingDirection()},this.galleryComponent=new iiif_gallery_component_1.GalleryComponent({target:this.$gallery[0]}),this.$gallery.find("a.select").addClass("btn btn-primary"),this.galleryComponent.on("multiSelectionMade",(function(ids){_this.component.publish(BaseEvents_1.BaseEvents.MULTISELECTION_MADE,ids),that.close()}),!1),this.$element.hide()},MultiSelectDialogue.prototype.isPageModeEnabled=function(){return Utils.Bools.getBool(this.config.options.pageModeEnabled,!0)&&this.extension.getMode().toString()===Mode_1.Mode.page.toString()},MultiSelectDialogue.prototype.open=function(){_super.prototype.open.call(this)},MultiSelectDialogue.prototype.close=function(){_super.prototype.close.call(this)},MultiSelectDialogue.prototype.resize=function(){_super.prototype.resize.call(this);var $main=this.$gallery.find(".main"),$header=this.$gallery.find(".header");$main.height(this.$content.height()-this.$title.outerHeight()-this.$title.verticalMargins()-$header.height())},MultiSelectDialogue}(Dialogue_1.Dialogue);exports.MultiSelectDialogue=MultiSelectDialogue})),define("extensions/uv-seadragon-extension/MultiSelectionArgs",["require","exports"],(function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MultiSelectionArgs=function(){};exports.MultiSelectionArgs=MultiSelectionArgs}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-pagingheaderpanel-module/PagingHeaderPanel",["require","exports","../uv-shared-module/AutoComplete","../uv-shared-module/BaseEvents","../../extensions/uv-seadragon-extension/Events","../uv-shared-module/HeaderPanel","../../extensions/uv-seadragon-extension/Mode","../../Utils","@iiif/vocabulary","manifesto.js"],(function(require,exports,AutoComplete_1,BaseEvents_1,Events_1,HeaderPanel_1,Mode_1,Utils_1,vocabulary_1,manifesto_js_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var PagingHeaderPanel=function(_super){function PagingHeaderPanel($element){var _this=_super.call(this,$element)||this;return _this.firstButtonEnabled=!1,_this.lastButtonEnabled=!1,_this.nextButtonEnabled=!1,_this.prevButtonEnabled=!1,_this}return __extends(PagingHeaderPanel,_super),PagingHeaderPanel.prototype.create=function(){var _this=this;if(this.setConfig("pagingHeaderPanel"),_super.prototype.create.call(this),this.component.subscribe(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,(function(canvasIndex){_this.canvasIndexChanged(canvasIndex)})),this.component.subscribe(BaseEvents_1.BaseEvents.SETTINGS_CHANGED,(function(){_this.modeChanged(),_this.updatePagingToggle()})),this.component.subscribe(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGE_FAILED,(function(){_this.setSearchFieldValue(_this.extension.helper.canvasIndex)})),this.component.subscribe(BaseEvents_1.BaseEvents.LEFTPANEL_EXPAND_FULL_START,(function(){_this.openGallery()})),this.component.subscribe(BaseEvents_1.BaseEvents.LEFTPANEL_COLLAPSE_FULL_START,(function(){_this.closeGallery()})),this.$prevOptions=$('<div class="prevOptions"></div>'),this.$centerOptions.append(this.$prevOptions),this.$firstButton=$('\n          <button class="btn imageBtn first" tabindex="0" title="'+this.content.first+'">\n            <i class="uv-icon-first" aria-hidden="true"></i><span>'+this.content.first+"</span>\n          </button>\n        "),this.$prevOptions.append(this.$firstButton),this.$prevButton=$('\n          <button class="btn imageBtn prev" tabindex="0" title="'+this.content.previous+'">\n            <i class="uv-icon-prev" aria-hidden="true"></i><span>'+this.content.previous+"</span>\n          </button>\n        "),this.$prevOptions.append(this.$prevButton),this.$modeOptions=$('<div class="mode"></div>'),this.$centerOptions.append(this.$modeOptions),this.$imageModeLabel=$('<label for="image">'+this.content.image+"</label>"),this.$modeOptions.append(this.$imageModeLabel),this.$imageModeOption=$('<input type="radio" id="image" name="mode" tabindex="0"/>'),this.$modeOptions.append(this.$imageModeOption),this.$pageModeLabel=$('<label for="page"></label>'),this.$modeOptions.append(this.$pageModeLabel),this.$pageModeOption=$('<input type="radio" id="page" name="mode" tabindex="0"/>'),this.$modeOptions.append(this.$pageModeOption),this.$search=$('<div class="search"></div>'),this.$centerOptions.append(this.$search),this.$searchText=$('<input class="searchText" maxlength="50" type="text" tabindex="0" aria-label="'+this.content.pageSearchLabel+'"/>'),this.$search.append(this.$searchText),Utils.Bools.getBool(this.options.autoCompleteBoxEnabled,!0))this.$searchText.hide(),this.$autoCompleteBox=$('<input class="autocompleteText" type="text" maxlength="100" aria-label="'+this.content.pageSearchLabel+'"/>'),this.$search.append(this.$autoCompleteBox),new AutoComplete_1.AutoComplete(this.$autoCompleteBox,(function(term,cb){var results=[],canvases=_this.extension.helper.getCanvases();if(_this.isPageModeEnabled())for(var i=0;i<canvases.length;i++){var canvas=canvases[i],label=manifesto_js_1.LanguageMap.getValue(canvas.getLabel());label&&label.startsWith(term)&&results.push(label)}else for(i=0;i<canvases.length;i++){(canvas=canvases[i]).index.toString().startsWith(term)&&results.push(canvas.index.toString())}cb(results)}),(function(results){return results}),(function(terms){_this.search(terms)}),300,0,Utils.Bools.getBool(this.options.autocompleteAllowWords,!1));else if(Utils.Bools.getBool(this.options.imageSelectionBoxEnabled,!0)){this.$selectionBoxOptions=$('<div class="image-selectionbox-options"></div>'),this.$centerOptions.append(this.$selectionBoxOptions),this.$imageSelectionBox=$('<select class="image-selectionbox" name="image-select" tabindex="0" ></select>'),this.$selectionBoxOptions.append(this.$imageSelectionBox);for(var imageIndex=0;imageIndex<this.extension.helper.getTotalCanvases();imageIndex++){var canvas=this.extension.helper.getCanvasByIndex(imageIndex),label=Utils_1.UVUtils.sanitize(manifesto_js_1.LanguageMap.getValue(canvas.getLabel(),this.extension.helper.options.locale));this.$imageSelectionBox.append("<option value="+imageIndex+">"+label+"</option>")}this.$imageSelectionBox.change((function(){var imageIndex=parseInt(_this.$imageSelectionBox.val());_this.component.publish(Events_1.Events.IMAGE_SEARCH,imageIndex)}))}this.$total=$('<span class="total"></span>'),this.$search.append(this.$total),this.$searchButton=$('<a class="go btn btn-primary" title="'+this.content.go+'" tabindex="0">'+this.content.go+"</a>"),this.$search.append(this.$searchButton),this.$nextOptions=$('<div class="nextOptions"></div>'),this.$centerOptions.append(this.$nextOptions),this.$nextButton=$('\n          <button class="btn imageBtn next" tabindex="0" title="'+this.content.next+'">\n            <i class="uv-icon-next" aria-hidden="true"></i><span>'+this.content.next+"</span>\n          </button>\n        "),this.$nextOptions.append(this.$nextButton),this.$lastButton=$('\n          <button class="btn imageBtn last" tabindex="0" title="'+this.content.last+'">\n            <i class="uv-icon-last" aria-hidden="true"></i><span>'+this.content.last+"</span>\n          </button>\n        "),this.$nextOptions.append(this.$lastButton),this.isPageModeEnabled()?(this.$pageModeOption.attr("checked","checked"),this.$pageModeOption.removeAttr("disabled"),this.$pageModeLabel.removeClass("disabled")):(this.$imageModeOption.attr("checked","checked"),this.$pageModeOption.attr("disabled","disabled"),this.$pageModeLabel.addClass("disabled")),this.extension.helper.getManifestType().toString()===manifesto_js_1.ManifestType.MANUSCRIPT.toString()?this.$pageModeLabel.text(this.content.folio):this.$pageModeLabel.text(this.content.page),this.$galleryButton=$('\n          <button class="btn imageBtn gallery" title="'+this.content.gallery+'" tabindex="0">\n            <i class="uv-icon-gallery" aria-hidden="true"></i>'+this.content.gallery+"\n          </button>\n        "),this.$rightOptions.prepend(this.$galleryButton),this.$pagingToggleButtons=$('<div class="pagingToggleButtons"></div>'),this.$rightOptions.prepend(this.$pagingToggleButtons),this.$oneUpButton=$('\n          <button class="btn imageBtn one-up" title="'+this.content.oneUp+'" tabindex="0">\n            <i class="uv-icon-one-up" aria-hidden="true"></i>'+this.content.oneUp+"\n          </button>"),this.$pagingToggleButtons.append(this.$oneUpButton),this.$twoUpButton=$('\n          <button class="btn imageBtn two-up" title="'+this.content.twoUp+'" tabindex="0">\n            <i class="uv-icon-two-up" aria-hidden="true"></i>'+this.content.twoUp+"\n          </button>\n        "),this.$pagingToggleButtons.append(this.$twoUpButton),this.updatePagingToggle(),this.updateGalleryButton(),this.$oneUpButton.onPressed((function(){_this.updateSettings({pagingEnabled:false}),_this.component.publish(Events_1.Events.PAGING_TOGGLED,false)})),this.$twoUpButton.onPressed((function(){_this.updateSettings({pagingEnabled:true}),_this.component.publish(Events_1.Events.PAGING_TOGGLED,true)})),this.$galleryButton.onPressed((function(){_this.component.publish(BaseEvents_1.BaseEvents.TOGGLE_EXPAND_LEFT_PANEL)})),this.setNavigationTitles(),this.setTotal();var viewingDirection=this.extension.helper.getViewingDirection()||vocabulary_1.ViewingDirection.LEFT_TO_RIGHT;1===this.extension.helper.getTotalCanvases()&&this.$centerOptions.hide(),this.$firstButton.onPressed((function(){switch(viewingDirection.toString()){case vocabulary_1.ViewingDirection.LEFT_TO_RIGHT.toString():case vocabulary_1.ViewingDirection.TOP_TO_BOTTOM.toString():case vocabulary_1.ViewingDirection.BOTTOM_TO_TOP.toString():_this.component.publish(BaseEvents_1.BaseEvents.FIRST);break;case vocabulary_1.ViewingDirection.RIGHT_TO_LEFT.toString():_this.component.publish(BaseEvents_1.BaseEvents.LAST)}})),this.$prevButton.onPressed((function(){switch(viewingDirection.toString()){case vocabulary_1.ViewingDirection.LEFT_TO_RIGHT.toString():case vocabulary_1.ViewingDirection.BOTTOM_TO_TOP.toString():case vocabulary_1.ViewingDirection.TOP_TO_BOTTOM.toString():_this.component.publish(BaseEvents_1.BaseEvents.PREV);break;case vocabulary_1.ViewingDirection.RIGHT_TO_LEFT.toString():_this.component.publish(BaseEvents_1.BaseEvents.NEXT)}})),this.$nextButton.onPressed((function(){switch(viewingDirection.toString()){case vocabulary_1.ViewingDirection.LEFT_TO_RIGHT.toString():case vocabulary_1.ViewingDirection.BOTTOM_TO_TOP.toString():case vocabulary_1.ViewingDirection.TOP_TO_BOTTOM.toString():_this.component.publish(BaseEvents_1.BaseEvents.NEXT);break;case vocabulary_1.ViewingDirection.RIGHT_TO_LEFT.toString():_this.component.publish(BaseEvents_1.BaseEvents.PREV)}})),this.$lastButton.onPressed((function(){switch(viewingDirection.toString()){case vocabulary_1.ViewingDirection.LEFT_TO_RIGHT.toString():case vocabulary_1.ViewingDirection.TOP_TO_BOTTOM.toString():case vocabulary_1.ViewingDirection.BOTTOM_TO_TOP.toString():_this.component.publish(BaseEvents_1.BaseEvents.LAST);break;case vocabulary_1.ViewingDirection.RIGHT_TO_LEFT.toString():_this.component.publish(BaseEvents_1.BaseEvents.FIRST)}})),this.config.options.pageModeEnabled?(this.$imageModeOption.on("click",(function(e){_this.component.publish(Events_1.Events.MODE_CHANGED,Mode_1.Mode.image.toString())})),this.$pageModeOption.on("click",(function(e){_this.component.publish(Events_1.Events.MODE_CHANGED,Mode_1.Mode.page.toString())}))):(this.$imageModeOption.hide(),this.$pageModeLabel.hide(),this.$pageModeOption.hide()),this.$searchText.onEnter((function(){_this.$searchText.blur(),_this.search(_this.$searchText.val())})),this.$searchText.click((function(){$(this).select()})),this.$searchButton.onPressed((function(){_this.options.autoCompleteBoxEnabled?_this.search(_this.$autoCompleteBox.val()):_this.search(_this.$searchText.val())})),!1===this.options.modeOptionsEnabled&&(this.$modeOptions.hide(),this.$centerOptions.addClass("modeOptionsDisabled")),!0===this.options.imageSelectionBoxEnabled&&!0!==this.options.autoCompleteBoxEnabled&&this.$search.hide(),!1===this.options.helpEnabled&&this.$helpButton.hide(),Utils.Bools.getBool(this.options.pagingToggleEnabled,!0)||this.$pagingToggleButtons.hide()},PagingHeaderPanel.prototype.openGallery=function(){this.$oneUpButton.removeClass("on"),this.$twoUpButton.removeClass("on"),this.$galleryButton.addClass("on")},PagingHeaderPanel.prototype.closeGallery=function(){this.updatePagingToggle(),this.$galleryButton.removeClass("on")},PagingHeaderPanel.prototype.isPageModeEnabled=function(){return this.config.options.pageModeEnabled&&this.extension.getMode().toString()===Mode_1.Mode.page.toString()},PagingHeaderPanel.prototype.setNavigationTitles=function(){this.isPageModeEnabled()?this.extension.helper.isRightToLeft()?(this.$firstButton.prop("title",this.content.lastPage),this.$firstButton.find("span").text(this.content.lastPage),this.$prevButton.prop("title",this.content.nextPage),this.$prevButton.find("span").text(this.content.nextPage),this.$nextButton.prop("title",this.content.previousPage),this.$nextButton.find("span").text(this.content.previousPage),this.$lastButton.prop("title",this.content.firstPage),this.$lastButton.find("span").text(this.content.firstPage)):(this.$firstButton.prop("title",this.content.firstPage),this.$firstButton.find("span").text(this.content.firstPage),this.$prevButton.prop("title",this.content.previousPage),this.$prevButton.find("span").text(this.content.previousPage),this.$nextButton.prop("title",this.content.nextPage),this.$nextButton.find("span").text(this.content.nextPage),this.$lastButton.prop("title",this.content.lastPage),this.$lastButton.find("span").text(this.content.lastPage)):this.extension.helper.isRightToLeft()?(this.$firstButton.prop("title",this.content.lastImage),this.$firstButton.find("span").text(this.content.lastPage),this.$prevButton.prop("title",this.content.nextImage),this.$prevButton.find("span").text(this.content.nextImage),this.$nextButton.prop("title",this.content.previousImage),this.$nextButton.find("span").text(this.content.previousImage),this.$lastButton.prop("title",this.content.firstImage),this.$lastButton.find("span").text(this.content.firstImage)):(this.$firstButton.prop("title",this.content.firstImage),this.$firstButton.find("span").text(this.content.firstImage),this.$prevButton.prop("title",this.content.previousImage),this.$prevButton.find("span").text(this.content.previousImage),this.$nextButton.prop("title",this.content.nextImage),this.$nextButton.find("span").text(this.content.nextImage),this.$lastButton.prop("title",this.content.lastImage),this.$lastButton.find("span").text(this.content.lastImage))},PagingHeaderPanel.prototype.updatePagingToggle=function(){this.pagingToggleIsVisible()?this.extension.isPagingSettingEnabled()?(this.$oneUpButton.removeClass("on"),this.$twoUpButton.addClass("on")):(this.$twoUpButton.removeClass("on"),this.$oneUpButton.addClass("on")):this.$pagingToggleButtons.hide()},PagingHeaderPanel.prototype.pagingToggleIsVisible=function(){return Utils.Bools.getBool(this.options.pagingToggleEnabled,!0)&&this.extension.helper.isPagingAvailable()},PagingHeaderPanel.prototype.updateGalleryButton=function(){this.galleryIsVisible()||this.$galleryButton.hide()},PagingHeaderPanel.prototype.galleryIsVisible=function(){return Utils.Bools.getBool(this.options.galleryButtonEnabled,!0)&&this.extension.isLeftPanelEnabled()},PagingHeaderPanel.prototype.setTotal=function(){var of=this.content.of;this.isPageModeEnabled()?this.$total.html(Utils.Strings.format(of,this.extension.helper.getLastCanvasLabel(!0))):this.$total.html(Utils.Strings.format(of,this.extension.helper.getTotalCanvases().toString()))},PagingHeaderPanel.prototype.setSearchFieldValue=function(index){var canvas=this.extension.helper.getCanvasByIndex(index),value=null;if(this.isPageModeEnabled()){var orderLabel=manifesto_js_1.LanguageMap.getValue(canvas.getLabel());value="-"===orderLabel?"":orderLabel}else value=(index+=1).toString();this.options.autoCompleteBoxEnabled?this.$autoCompleteBox.val(value):this.$searchText.val(value)},PagingHeaderPanel.prototype.search=function(value){if(!value)return this.extension.showMessage(this.content.emptyValue),void this.component.publish(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGE_FAILED);if(this.isPageModeEnabled())this.component.publish(Events_1.Events.PAGE_SEARCH,value);else{var index=void 0;if(index=this.options.autoCompleteBoxEnabled?parseInt(this.$autoCompleteBox.val(),10):parseInt(this.$searchText.val(),10),index-=1,isNaN(index))return this.extension.showMessage(this.extension.data.config.modules.genericDialogue.content.invalidNumber),void this.component.publish(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGE_FAILED);if(!this.extension.helper.getCanvasByIndex(index))return this.extension.showMessage(this.extension.data.config.modules.genericDialogue.content.pageNotFound),void this.component.publish(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGE_FAILED);this.component.publish(Events_1.Events.IMAGE_SEARCH,index)}},PagingHeaderPanel.prototype.canvasIndexChanged=function(index){this.setSearchFieldValue(index),!0===this.options.imageSelectionBoxEnabled&&!0!==this.options.autoCompleteBoxEnabled&&this.$imageSelectionBox.val(index),(this.extension.helper.getViewingDirection()||vocabulary_1.ViewingDirection.LEFT_TO_RIGHT).toString()===vocabulary_1.ViewingDirection.RIGHT_TO_LEFT.toString()?(this.extension.helper.isFirstCanvas()?(this.disableLastButton(),this.disableNextButton()):(this.enableLastButton(),this.enableNextButton()),this.extension.helper.isLastCanvas()?(this.disableFirstButton(),this.disablePrevButton()):(this.enableFirstButton(),this.enablePrevButton())):(this.extension.helper.isFirstCanvas()?(this.disableFirstButton(),this.disablePrevButton()):(this.enableFirstButton(),this.enablePrevButton()),this.extension.helper.isLastCanvas()?(this.disableLastButton(),this.disableNextButton()):(this.enableLastButton(),this.enableNextButton()))},PagingHeaderPanel.prototype.disableFirstButton=function(){this.firstButtonEnabled=!1,this.$firstButton.disable()},PagingHeaderPanel.prototype.enableFirstButton=function(){this.firstButtonEnabled=!0,this.$firstButton.enable()},PagingHeaderPanel.prototype.disableLastButton=function(){this.lastButtonEnabled=!1,this.$lastButton.disable()},PagingHeaderPanel.prototype.enableLastButton=function(){this.lastButtonEnabled=!0,this.$lastButton.enable()},PagingHeaderPanel.prototype.disablePrevButton=function(){this.prevButtonEnabled=!1,this.$prevButton.disable()},PagingHeaderPanel.prototype.enablePrevButton=function(){this.prevButtonEnabled=!0,this.$prevButton.enable()},PagingHeaderPanel.prototype.disableNextButton=function(){this.nextButtonEnabled=!1,this.$nextButton.disable()},PagingHeaderPanel.prototype.enableNextButton=function(){this.nextButtonEnabled=!0,this.$nextButton.enable()},PagingHeaderPanel.prototype.modeChanged=function(){this.setSearchFieldValue(this.extension.helper.canvasIndex),this.setNavigationTitles(),this.setTotal()},PagingHeaderPanel.prototype.resize=function(){_super.prototype.resize.call(this),this.extension.width()<this.extension.data.config.options.minWidthBreakPoint?(this.pagingToggleIsVisible()&&this.$pagingToggleButtons.hide(),this.galleryIsVisible()&&this.$galleryButton.hide()):(this.pagingToggleIsVisible()&&this.$pagingToggleButtons.show(),this.galleryIsVisible()&&this.$galleryButton.show())},PagingHeaderPanel}(HeaderPanel_1.HeaderPanel);exports.PagingHeaderPanel=PagingHeaderPanel})),define("extensions/uv-seadragon-extension/Bounds",["require","exports"],(function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Bounds=function(){function Bounds(x,y,w,h){this.x=x,this.y=y,this.w=w,this.h=h}return Bounds.prototype.toString=function(){return this.x+","+this.y+","+this.w+","+this.h},Bounds.fromString=function(bounds){var boundsArr=bounds.split(",");return new Bounds(Number(boundsArr[0]),Number(boundsArr[1]),Number(boundsArr[2]),Number(boundsArr[3]))},Bounds}();exports.Bounds=Bounds}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-seadragoncenterpanel-module/SeadragonCenterPanel",["require","exports","@iiif/vocabulary","../uv-shared-module/BaseEvents","../../extensions/uv-seadragon-extension/Bounds","../uv-shared-module/CenterPanel","../../extensions/uv-seadragon-extension/Events","../../Utils"],(function(require,exports,vocabulary_1,BaseEvents_1,Bounds_1,CenterPanel_1,Events_1,Utils_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var SeadragonCenterPanel=function(_super){function SeadragonCenterPanel($element){var _this=_super.call(this,$element)||this;return _this.controlsVisible=!1,_this.isCreated=!1,_this.isFirstLoad=!0,_this.navigatedFromSearch=!1,_this.nextButtonEnabled=!1,_this.prevButtonEnabled=!1,_this}return __extends(SeadragonCenterPanel,_super),SeadragonCenterPanel.prototype.create=function(){var _this=this;this.setConfig("seadragonCenterPanel"),_super.prototype.create.call(this),this.viewerId="osd"+(new Date).getTime(),this.$viewer=$('<div id="'+this.viewerId+'" class="viewer"></div>'),this.$content.prepend(this.$viewer),this.component.subscribe(BaseEvents_1.BaseEvents.ANNOTATIONS,(function(args){_this.overlayAnnotations(),_this.zoomToInitialAnnotation()})),this.component.subscribe(BaseEvents_1.BaseEvents.SETTINGS_CHANGED,(function(args){_this.viewer.gestureSettingsMouse.clickToZoom=args.clickToZoomEnabled})),this.component.subscribe(BaseEvents_1.BaseEvents.OPEN_EXTERNAL_RESOURCE,(function(resources){_this.whenResized((function(){_this.isCreated||_this.createUI(),_this.openMedia(resources)}))})),this.component.subscribe(BaseEvents_1.BaseEvents.CLEAR_ANNOTATIONS,(function(){_this.whenCreated((function(){_this.extension.currentAnnotationRect=null,_this.clearAnnotations()}))})),this.component.subscribe(Events_1.Events.NEXT_SEARCH_RESULT,(function(){_this.whenCreated((function(){_this.nextAnnotation()}))})),this.component.subscribe(Events_1.Events.PREV_SEARCH_RESULT,(function(){_this.whenCreated((function(){_this.prevAnnotation()}))})),this.component.subscribe(Events_1.Events.ZOOM_IN,(function(){_this.whenCreated((function(){_this.zoomIn()}))})),this.component.subscribe(Events_1.Events.ZOOM_OUT,(function(){_this.whenCreated((function(){_this.zoomOut()}))})),this.component.subscribe(Events_1.Events.ROTATE,(function(){_this.whenCreated((function(){_this.rotateRight()}))})),this.component.subscribe(BaseEvents_1.BaseEvents.METRIC_CHANGED,(function(){_this.whenCreated((function(){_this.updateResponsiveView()}))}))},SeadragonCenterPanel.prototype.whenCreated=function(cb){var _this=this;Utils.Async.waitFor((function(){return _this.isCreated}),cb)},SeadragonCenterPanel.prototype.zoomIn=function(){this.viewer.viewport.zoomTo(2*this.viewer.viewport.getZoom(!0))},SeadragonCenterPanel.prototype.zoomOut=function(){this.viewer.viewport.zoomTo(.5*this.viewer.viewport.getZoom(!0))},SeadragonCenterPanel.prototype.rotateRight=function(){this.viewer.viewport.setRotation(this.viewer.viewport.getRotation()+90)},SeadragonCenterPanel.prototype.updateResponsiveView=function(){this.setNavigatorVisible(),this.extension.isDesktopMetric()?(this.viewer.autoHideControls=!0,this.$viewportNavButtons.show()):(this.viewer.autoHideControls=!1,this.$viewportNavButtons.hide())},SeadragonCenterPanel.prototype.createUI=function(){var _this=this;this.$spinner=$('<div class="spinner"></div>'),this.$content.append(this.$spinner),this.viewer=OpenSeadragon({id:this.viewerId,ajaxWithCredentials:!1,showNavigationControl:!0,showNavigator:!0,showRotationControl:!0,showHomeControl:Utils.Bools.getBool(this.config.options.showHomeControl,!1),showFullPageControl:!1,defaultZoomLevel:this.config.options.defaultZoomLevel||0,maxZoomPixelRatio:this.config.options.maxZoomPixelRatio||2,controlsFadeDelay:this.config.options.controlsFadeDelay||250,controlsFadeLength:this.config.options.controlsFadeLength||250,navigatorPosition:this.config.options.navigatorPosition||"BOTTOM_RIGHT",animationTime:this.config.options.animationTime||1.2,visibilityRatio:this.config.options.visibilityRatio||.5,constrainDuringPan:Utils.Bools.getBool(this.config.options.constrainDuringPan,!1),immediateRender:Utils.Bools.getBool(this.config.options.immediateRender,!1),blendTime:this.config.options.blendTime||0,autoHideControls:Utils.Bools.getBool(this.config.options.autoHideControls,!0),prefixUrl:this.extension.data.root+"/img/",gestureSettingsMouse:{clickToZoom:Utils.Bools.getBool(this.extension.data.config.options.clickToZoomEnabled,!0)},navImages:{zoomIn:{REST:"pixel.gif",GROUP:"pixel.gif",HOVER:"pixel.gif",DOWN:"pixel.gif"},zoomOut:{REST:"pixel.gif",GROUP:"pixel.gif",HOVER:"pixel.gif",DOWN:"pixel.gif"},home:{REST:"pixel.gif",GROUP:"pixel.gif",HOVER:"pixel.gif",DOWN:"pixel.gif"},rotateright:{REST:"pixel.gif",GROUP:"pixel.gif",HOVER:"pixel.gif",DOWN:"pixel.gif"},rotateleft:{REST:"pixel.gif",GROUP:"pixel.gif",HOVER:"pixel.gif",DOWN:"pixel.gif"},next:{REST:"pixel.gif",GROUP:"pixel.gif",HOVER:"pixel.gif",DOWN:"pixel.gif"},previous:{REST:"pixel.gif",GROUP:"pixel.gif",HOVER:"pixel.gif",DOWN:"pixel.gif"}}}),this.$zoomInButton=this.$viewer.find('div[title="Zoom in"]'),this.$zoomInButton.attr("tabindex",0),this.$zoomInButton.prop("title",this.content.zoomIn),this.$zoomInButton.addClass("zoomIn viewportNavButton"),this.$zoomOutButton=this.$viewer.find('div[title="Zoom out"]'),this.$zoomOutButton.attr("tabindex",0),this.$zoomOutButton.prop("title",this.content.zoomOut),this.$zoomOutButton.addClass("zoomOut viewportNavButton"),this.$goHomeButton=this.$viewer.find('div[title="Go home"]'),this.$goHomeButton.attr("tabindex",0),this.$goHomeButton.prop("title",this.content.goHome),this.$goHomeButton.addClass("goHome viewportNavButton"),this.$rotateButton=this.$viewer.find('div[title="Rotate right"]'),this.$rotateButton.attr("tabindex",0),this.$rotateButton.prop("title",this.content.rotateRight),this.$rotateButton.addClass("rotate viewportNavButton"),this.$viewportNavButtonsContainer=this.$viewer.find(".openseadragon-container > div:not(.openseadragon-canvas):first"),this.$viewportNavButtons=this.$viewportNavButtonsContainer.find(".viewportNavButton"),this.$canvas=$(this.viewer.canvas),this.$canvas.on("contextmenu",(function(){return!1})),this.$navigator=this.$viewer.find(".navigator"),this.setNavigatorVisible(),this.$element.on("mousemove",(function(){_this.controlsVisible||(_this.controlsVisible=!0,_this.viewer.setControlsEnabled(!0))})),this.$element.on("mouseleave",(function(){_this.controlsVisible&&(_this.controlsVisible=!1,_this.viewer.setControlsEnabled(!1))})),this.$element.on("mousemove",(function(){if(!_this.$prevButton.ismouseover()&&!_this.$nextButton.ismouseover()&&!_this.$viewer.find(".navigator").ismouseover()){if(!_this.controlsVisible)return;_this.controlsVisible=!1,_this.viewer.setControlsEnabled(!1)}}),this.config.options.controlsFadeAfterInactive),this.viewer.addHandler("tile-drawn",(function(){_this.$spinner.hide()})),this.viewer.addHandler("resize",(function(viewer){_this.component.publish(Events_1.Events.SEADRAGON_RESIZE,viewer),_this.viewerResize(viewer)})),this.viewer.addHandler("animation-start",(function(viewer){_this.component.publish(Events_1.Events.SEADRAGON_ANIMATION_START,viewer)})),this.viewer.addHandler("animation",(function(viewer){_this.component.publish(Events_1.Events.SEADRAGON_ANIMATION,viewer)})),this.viewer.addHandler("animation-finish",(function(viewer){_this.currentBounds=_this.getViewportBounds(),_this.updateVisibleAnnotationRects(),_this.component.publish(Events_1.Events.SEADRAGON_ANIMATION_FINISH,viewer)})),this.viewer.addHandler("rotate",(function(args){_this.component.publish(Events_1.Events.SEADRAGON_ROTATION,args.degrees)})),this.title=this.extension.helper.getLabel(),this.createNavigationButtons(),this.hidePrevButton(),this.hideNextButton(),this.isCreated=!0,this.resize()},SeadragonCenterPanel.prototype.createNavigationButtons=function(){var _this=this,viewingDirection=this.extension.helper.getViewingDirection()||vocabulary_1.ViewingDirection.LEFT_TO_RIGHT;switch(this.$prevButton=$('<div class="paging btn prev" tabindex="0"></div>'),this.extension.helper.isRightToLeft()?this.$prevButton.prop("title",this.content.next):this.$prevButton.prop("title",this.content.previous),this.$nextButton=$('<div class="paging btn next" tabindex="0"></div>'),this.extension.helper.isRightToLeft()?this.$nextButton.prop("title",this.content.previous):this.$nextButton.prop("title",this.content.next),this.viewer.addControl(this.$prevButton[0],{anchor:OpenSeadragon.ControlAnchor.TOP_LEFT}),this.viewer.addControl(this.$nextButton[0],{anchor:OpenSeadragon.ControlAnchor.TOP_RIGHT}),viewingDirection.toString()){case vocabulary_1.ViewingDirection.BOTTOM_TO_TOP.toString():case vocabulary_1.ViewingDirection.TOP_TO_BOTTOM.toString():this.$prevButton.addClass("vertical"),this.$nextButton.addClass("vertical")}var that=this;this.$prevButton.onPressed((function(e){if(e.preventDefault(),OpenSeadragon.cancelEvent(e),that.prevButtonEnabled)switch(viewingDirection.toString()){case vocabulary_1.ViewingDirection.LEFT_TO_RIGHT.toString():case vocabulary_1.ViewingDirection.BOTTOM_TO_TOP.toString():case vocabulary_1.ViewingDirection.TOP_TO_BOTTOM.toString():_this.component.publish(BaseEvents_1.BaseEvents.PREV);break;case vocabulary_1.ViewingDirection.RIGHT_TO_LEFT.toString():_this.component.publish(BaseEvents_1.BaseEvents.NEXT)}})),this.$nextButton.onPressed((function(e){if(e.preventDefault(),OpenSeadragon.cancelEvent(e),that.nextButtonEnabled)switch(viewingDirection.toString()){case vocabulary_1.ViewingDirection.LEFT_TO_RIGHT.toString():case vocabulary_1.ViewingDirection.BOTTOM_TO_TOP.toString():case vocabulary_1.ViewingDirection.TOP_TO_BOTTOM.toString():_this.component.publish(BaseEvents_1.BaseEvents.NEXT);break;case vocabulary_1.ViewingDirection.RIGHT_TO_LEFT.toString():_this.component.publish(BaseEvents_1.BaseEvents.PREV)}})),this.$prevButton.on("focus",(function(){_this.controlsVisible||(_this.controlsVisible=!0,_this.viewer.setControlsEnabled(!0))})),this.$nextButton.on("focus",(function(){_this.controlsVisible||(_this.controlsVisible=!0,_this.viewer.setControlsEnabled(!0))}))},SeadragonCenterPanel.prototype.openMedia=function(resources){var _this=this;this.$spinner.show(),this.items=[],this.extension.getExternalResources(resources).then((function(resources){_this.viewer.close(),resources=_this.getPagePositions(resources);for(var i=0;i<resources.length;i++){var data=resources[i],tileSource=void 0;tileSource=data.hasServiceDescriptor?data:{type:"image",url:data.id,buildPyramid:!1},_this.viewer.addTiledImage({tileSource:tileSource,x:data.x,y:data.y,width:data.width,success:function(item){_this.items.push(item),_this.items.length===resources.length&&_this.openPagesHandler(),_this.resize()}})}}))},SeadragonCenterPanel.prototype.getPagePositions=function(resources){var leftPage,topPage,page;if(resources.length>1)if(2===resources.length)this.extension.helper.isVerticallyAligned()?((topPage=resources[0]).y=0,resources[1].y=topPage.height+this.config.options.pageGap):((leftPage=resources[0]).x=0,resources[1].x=leftPage.width+this.config.options.pageGap);else if(this.extension.helper.isVerticallyAligned())if(this.extension.helper.isTopToBottom())for(var i=0;i<resources.length-1;i++)page=resources[i],resources[i+1].y=(page.y||0)+page.height;else for(i=resources.length;i>0;i--)page=resources[i],resources[i-1].y=(page.y||0)-page.height;else if(this.extension.helper.isLeftToRight())for(i=0;i<resources.length-1;i++)page=resources[i],resources[i+1].x=(page.x||0)+page.width;else for(i=resources.length-1;i>0;i--)page=resources[i],resources[i-1].x=(page.x||0)-page.width;return resources},SeadragonCenterPanel.prototype.openPagesHandler=function(){(this.component.publish(Events_1.Events.SEADRAGON_OPEN),this.extension.helper.isMultiCanvas()&&!this.extension.helper.isContinuous())&&(this.showPrevButton(),this.showNextButton(),$(".navigator").addClass("extraMargin"),(this.extension.helper.getViewingDirection()||vocabulary_1.ViewingDirection.LEFT_TO_RIGHT).toString()===vocabulary_1.ViewingDirection.RIGHT_TO_LEFT.toString()?(this.extension.helper.isFirstCanvas()?this.disableNextButton():this.enableNextButton(),this.extension.helper.isLastCanvas()?this.disablePrevButton():this.enablePrevButton()):(this.extension.helper.isFirstCanvas()?this.disablePrevButton():this.enablePrevButton(),this.extension.helper.isLastCanvas()?this.disableNextButton():this.enableNextButton()));this.setNavigatorVisible(),this.overlayAnnotations(),this.updateBounds(),this.navigatedFromSearch&&(this.navigatedFromSearch=!1,this.zoomToInitialAnnotation()),this.isFirstLoad=!1},SeadragonCenterPanel.prototype.zoomToInitialAnnotation=function(){var annotationRect=this.getInitialAnnotationRect();this.extension.previousAnnotationRect=null,this.extension.currentAnnotationRect=null,annotationRect&&this.isZoomToSearchResultEnabled()&&this.zoomToAnnotation(annotationRect)},SeadragonCenterPanel.prototype.overlayAnnotations=function(){for(var annotations=this.getAnnotationsForCurrentImages(),i=0;i<annotations.length;i++)for(var annotation=annotations[i],overlayRects=this.getAnnotationOverlayRects(annotation),k=0;k<overlayRects.length;k++){var overlayRect=overlayRects[k],div=document.createElement("div");div.id="searchResult-"+overlayRect.canvasIndex+"-"+overlayRect.resultIndex,div.className="searchOverlay",div.title=Utils_1.UVUtils.sanitize(overlayRect.chars),this.viewer.addOverlay(div,overlayRect)}},SeadragonCenterPanel.prototype.updateBounds=function(){var settings=this.extension.getSettings();this.isFirstLoad?(this.initialRotation=this.extension.data.rotation,this.initialRotation&&this.viewer.viewport.setRotation(parseInt(this.initialRotation)),this.initialBounds=this.extension.data.xywh,this.initialBounds&&(this.initialBounds=Bounds_1.Bounds.fromString(this.initialBounds),this.currentBounds=this.initialBounds,this.fitToBounds(this.currentBounds))):settings.preserveViewport?this.fitToBounds(this.currentBounds):this.goHome()},SeadragonCenterPanel.prototype.goHome=function(){this.viewer.viewport.goHome(!0)},SeadragonCenterPanel.prototype.disablePrevButton=function(){this.prevButtonEnabled=!1,this.$prevButton.addClass("disabled")},SeadragonCenterPanel.prototype.enablePrevButton=function(){this.prevButtonEnabled=!0,this.$prevButton.removeClass("disabled")},SeadragonCenterPanel.prototype.hidePrevButton=function(){this.disablePrevButton(),this.$prevButton.hide()},SeadragonCenterPanel.prototype.showPrevButton=function(){this.enablePrevButton(),this.$prevButton.show()},SeadragonCenterPanel.prototype.disableNextButton=function(){this.nextButtonEnabled=!1,this.$nextButton.addClass("disabled")},SeadragonCenterPanel.prototype.enableNextButton=function(){this.nextButtonEnabled=!0,this.$nextButton.removeClass("disabled")},SeadragonCenterPanel.prototype.hideNextButton=function(){this.disableNextButton(),this.$nextButton.hide()},SeadragonCenterPanel.prototype.showNextButton=function(){this.enableNextButton(),this.$nextButton.show()},SeadragonCenterPanel.prototype.fitToBounds=function(bounds,immediate){void 0===immediate&&(immediate=!0);var rect=new OpenSeadragon.Rect;rect.x=Number(bounds.x),rect.y=Number(bounds.y),rect.width=Number(bounds.w),rect.height=Number(bounds.h),this.viewer.viewport.fitBoundsWithConstraints(rect,immediate)},SeadragonCenterPanel.prototype.getCroppedImageBounds=function(){if(!this.viewer||!this.viewer.viewport)return null;var canvas=this.extension.helper.getCurrentCanvas(),dimensions=this.extension.getCroppedImageDimensions(canvas,this.viewer);return dimensions?new Bounds_1.Bounds(dimensions.regionPos.x,dimensions.regionPos.y,dimensions.region.width,dimensions.region.height).toString():null},SeadragonCenterPanel.prototype.getViewportBounds=function(){if(!this.viewer||!this.viewer.viewport)return null;var b=this.viewer.viewport.getBounds(!0);return new Bounds_1.Bounds(Math.floor(b.x),Math.floor(b.y),Math.floor(b.width),Math.floor(b.height))},SeadragonCenterPanel.prototype.viewerResize=function(viewer){if(viewer.viewport){var center=viewer.viewport.getCenter(!0);center&&setTimeout((function(){viewer.viewport.panTo(center,!0)}),1)}},SeadragonCenterPanel.prototype.clearAnnotations=function(){this.$canvas.find(".searchOverlay").hide()},SeadragonCenterPanel.prototype.getAnnotationsForCurrentImages=function(){var annotationsForCurrentImages=[],annotations=this.extension.annotations;if(!annotations||!annotations.length)return annotationsForCurrentImages;for(var indices=this.extension.getPagedIndices(),i=0;i<indices.length;i++)for(var canvasIndex=indices[i],j=0;j<annotations.length;j++)if(annotations[j].canvasIndex===canvasIndex){annotationsForCurrentImages.push(annotations[j]);break}return annotationsForCurrentImages},SeadragonCenterPanel.prototype.getAnnotationRectsForCurrentImages=function(){return this.getAnnotationsForCurrentImages().en().selectMany((function(x){return x.rects})).toArray()},SeadragonCenterPanel.prototype.updateVisibleAnnotationRects=function(){for(var annotationRects=this.getAnnotationRectsForCurrentImages(),i=0;i<annotationRects.length;i++){var rect=annotationRects[i],viewportBounds=this.viewer.viewport.getBounds();rect.isVisible=Utils.Dimensions.hitRect(viewportBounds.x,viewportBounds.y,viewportBounds.width,viewportBounds.height,rect.viewportX,rect.viewportY)}},SeadragonCenterPanel.prototype.getAnnotationRectIndex=function(annotationRect){return this.getAnnotationRectsForCurrentImages().indexOf(annotationRect)},SeadragonCenterPanel.prototype.isZoomToSearchResultEnabled=function(){return Utils.Bools.getBool(this.extension.data.config.options.zoomToSearchResultEnabled,!0)},SeadragonCenterPanel.prototype.prevAnnotation=function(){for(var annotationRects=this.getAnnotationRectsForCurrentImages(),currentAnnotationRect=this.extension.currentAnnotationRect,foundRect=null,i=(currentAnnotationRect?this.getAnnotationRectIndex(currentAnnotationRect):annotationRects.length)-1;i>=0;i--){foundRect=annotationRects[i];break}foundRect&&this.isZoomToSearchResultEnabled()?foundRect.canvasIndex<this.extension.helper.canvasIndex?(this.extension.currentAnnotationRect=foundRect,this.navigatedFromSearch=!0,this.component.publish(BaseEvents_1.BaseEvents.ANNOTATION_CANVAS_CHANGED,foundRect)):this.zoomToAnnotation(foundRect):(this.navigatedFromSearch=!0,this.component.publish(Events_1.Events.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE))},SeadragonCenterPanel.prototype.nextAnnotation=function(){for(var annotationRects=this.getAnnotationRectsForCurrentImages(),currentAnnotationRect=this.extension.currentAnnotationRect,foundRect=null,i=(currentAnnotationRect?this.getAnnotationRectIndex(currentAnnotationRect):-1)+1;i<annotationRects.length;i++){foundRect=annotationRects[i];break}foundRect&&this.isZoomToSearchResultEnabled()?foundRect.canvasIndex>this.extension.helper.canvasIndex?(this.extension.currentAnnotationRect=foundRect,this.navigatedFromSearch=!0,this.component.publish(BaseEvents_1.BaseEvents.ANNOTATION_CANVAS_CHANGED,[foundRect])):this.zoomToAnnotation(foundRect):(this.navigatedFromSearch=!0,this.component.publish(Events_1.Events.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE))},SeadragonCenterPanel.prototype.getAnnotationRectByIndex=function(index){var annotationRects=this.getAnnotationRectsForCurrentImages();return annotationRects.length?annotationRects[index]:null},SeadragonCenterPanel.prototype.getInitialAnnotationRect=function(){var _this=this,annotationRects=this.getAnnotationRectsForCurrentImages();return annotationRects.length?!this.extension.previousAnnotationRect&&this.extension.lastCanvasIndex>this.extension.helper.canvasIndex?annotationRects.en().where((function(x){return x.canvasIndex===_this.extension.helper.canvasIndex})).last():annotationRects.en().where((function(x){return x.canvasIndex===_this.extension.helper.canvasIndex})).first():null},SeadragonCenterPanel.prototype.zoomToAnnotation=function(annotationRect){if(this.extension.previousAnnotationRect=this.extension.currentAnnotationRect||annotationRect,this.extension.currentAnnotationRect=annotationRect,Utils.Bools.getBool(this.extension.data.config.options.zoomToBoundsEnabled,!1))this.fitToBounds(new Bounds_1.Bounds(annotationRect.viewportX,annotationRect.viewportY,annotationRect.width,annotationRect.height),!1);else{var x=annotationRect.viewportX-(.5*this.currentBounds.w-.5*annotationRect.width),y=annotationRect.viewportY-(.5*this.currentBounds.h-.5*annotationRect.height),w=this.currentBounds.w,h=this.currentBounds.h,bounds=new Bounds_1.Bounds(x,y,w,h);this.fitToBounds(bounds)}this.highlightAnnotationRect(annotationRect),this.component.publish(BaseEvents_1.BaseEvents.ANNOTATION_CHANGED)},SeadragonCenterPanel.prototype.highlightAnnotationRect=function(annotationRect){var $rect=$("#searchResult-"+annotationRect.canvasIndex+"-"+annotationRect.index);$rect.addClass("current"),$(".searchOverlay").not($rect).removeClass("current")},SeadragonCenterPanel.prototype.getAnnotationOverlayRects=function(annotationGroup){var newRects=[];if(!this.extension.resources)return newRects;var resource=this.extension.resources.en().where((function(x){return x.index===annotationGroup.canvasIndex})).first(),index=this.extension.resources.indexOf(resource),offsetX=0;index>0&&(offsetX=this.extension.resources[index-1].width);for(var i=0;i<annotationGroup.rects.length;i++){var searchRect=annotationGroup.rects[i],x=searchRect.x+offsetX+(index>0?this.config.options.pageGap:0),y=searchRect.y,w=searchRect.width,h=searchRect.height,rect=new OpenSeadragon.Rect(x,y,w,h);searchRect.viewportX=x,searchRect.viewportY=y,rect.canvasIndex=searchRect.canvasIndex,rect.resultIndex=searchRect.index,rect.chars=searchRect.chars,newRects.push(rect)}return newRects},SeadragonCenterPanel.prototype.resize=function(){var _this=this;if(_super.prototype.resize.call(this),this.$viewer.height(this.$content.height()-this.$viewer.verticalMargins()),this.$viewer.width(this.$content.width()-this.$viewer.horizontalMargins()),this.isCreated){this.title&&this.$title.text(Utils_1.UVUtils.sanitize(this.title)),this.$spinner.css("top",this.$content.height()/2-this.$spinner.height()/2),this.$spinner.css("left",this.$content.width()/2-this.$spinner.width()/2);var viewingDirection=this.extension.helper.getViewingDirection()||vocabulary_1.ViewingDirection.LEFT_TO_RIGHT;if(this.extension.helper.isMultiCanvas()&&this.$prevButton&&this.$nextButton){var verticalButtonPos=Math.floor(this.$content.width()/2);switch(viewingDirection.toString()){case vocabulary_1.ViewingDirection.BOTTOM_TO_TOP.toString():this.$prevButton.addClass("down"),this.$nextButton.addClass("up"),this.$prevButton.css("left",verticalButtonPos-this.$prevButton.outerWidth()/2),this.$prevButton.css("top",this.$content.height()-this.$prevButton.height()),this.$nextButton.css("left",-1*verticalButtonPos-this.$nextButton.outerWidth()/2);break;case vocabulary_1.ViewingDirection.TOP_TO_BOTTOM.toString():this.$prevButton.css("left",verticalButtonPos-this.$prevButton.outerWidth()/2),this.$nextButton.css("left",-1*verticalButtonPos-this.$nextButton.outerWidth()/2),this.$nextButton.css("top",this.$content.height()-this.$nextButton.height());break;default:this.$prevButton.css("top",(this.$content.height()-this.$prevButton.height())/2),this.$nextButton.css("top",(this.$content.height()-this.$nextButton.height())/2)}}setTimeout((function(){if(_this.extension.helper.isContinuous())if(_this.extension.helper.isHorizontallyAligned()){var width=_this.$viewer.width()-_this.$viewer.rightMargin();_this.$navigator.width(width)}else _this.$navigator.height(_this.$viewer.height())}),100)}},SeadragonCenterPanel.prototype.setFocus=function(){this.$canvas.is(":focus")||this.extension.data.config.options.allowStealFocus&&this.$canvas.focus()},SeadragonCenterPanel.prototype.setNavigatorVisible=function(){var navigatorEnabled=Utils.Bools.getBool(this.extension.getSettings().navigatorEnabled,!0)&&this.extension.isDesktopMetric();this.viewer.navigator.setVisible(navigatorEnabled),navigatorEnabled?this.$navigator.show():this.$navigator.hide()},SeadragonCenterPanel}(CenterPanel_1.CenterPanel);exports.SeadragonCenterPanel=SeadragonCenterPanel}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("extensions/uv-seadragon-extension/SettingsDialogue",["require","exports","../../modules/uv-dialogues-module/SettingsDialogue"],(function(require,exports,SettingsDialogue_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var SettingsDialogue=function(_super){function SettingsDialogue($element){return _super.call(this,$element)||this}return __extends(SettingsDialogue,_super),SettingsDialogue.prototype.create=function(){var _this=this;this.setConfig("settingsDialogue"),_super.prototype.create.call(this),this.$navigatorEnabled=$('<div class="setting navigatorEnabled"></div>'),this.$scroll.append(this.$navigatorEnabled),this.$navigatorEnabledCheckbox=$('<input id="navigatorEnabled" type="checkbox" tabindex="0" />'),this.$navigatorEnabled.append(this.$navigatorEnabledCheckbox),this.$navigatorEnabledLabel=$('<label for="navigatorEnabled">'+this.content.navigatorEnabled+"</label>"),this.$navigatorEnabled.append(this.$navigatorEnabledLabel),this.$pagingEnabled=$('<div class="setting pagingEnabled"></div>'),this.$scroll.append(this.$pagingEnabled),this.$pagingEnabledCheckbox=$('<input id="pagingEnabled" type="checkbox" tabindex="0" />'),this.$pagingEnabled.append(this.$pagingEnabledCheckbox),this.$pagingEnabledLabel=$('<label for="pagingEnabled">'+this.content.pagingEnabled+"</label>"),this.$pagingEnabled.append(this.$pagingEnabledLabel),this.$clickToZoomEnabled=$('<div class="setting clickToZoom"></div>'),this.$scroll.append(this.$clickToZoomEnabled),this.$clickToZoomEnabledCheckbox=$('<input id="clickToZoomEnabled" type="checkbox" />'),this.$clickToZoomEnabled.append(this.$clickToZoomEnabledCheckbox),this.$clickToZoomEnabledLabel=$('<label for="clickToZoomEnabled">'+this.content.clickToZoomEnabled+"</label>"),this.$clickToZoomEnabled.append(this.$clickToZoomEnabledLabel),this.$preserveViewport=$('<div class="setting preserveViewport"></div>'),this.$scroll.append(this.$preserveViewport),this.$preserveViewportCheckbox=$('<input id="preserveViewport" type="checkbox" tabindex="0" />'),this.$preserveViewport.append(this.$preserveViewportCheckbox),this.$preserveViewportLabel=$('<label for="preserveViewport">'+this.content.preserveViewport+"</label>"),this.$preserveViewport.append(this.$preserveViewportLabel),this.$navigatorEnabledCheckbox.change((function(){var settings={};_this.$navigatorEnabledCheckbox.is(":checked")?settings.navigatorEnabled=!0:settings.navigatorEnabled=!1,_this.updateSettings(settings)})),this.$clickToZoomEnabledCheckbox.change((function(){var settings={};_this.$clickToZoomEnabledCheckbox.is(":checked")?settings.clickToZoomEnabled=!0:settings.clickToZoomEnabled=!1,_this.updateSettings(settings)})),this.$pagingEnabledCheckbox.change((function(){var settings={};_this.$pagingEnabledCheckbox.is(":checked")?settings.pagingEnabled=!0:settings.pagingEnabled=!1,_this.updateSettings(settings)})),this.$preserveViewportCheckbox.change((function(){var settings={};_this.$preserveViewportCheckbox.is(":checked")?settings.preserveViewport=!0:settings.preserveViewport=!1,_this.updateSettings(settings)}))},SettingsDialogue.prototype.open=function(){_super.prototype.open.call(this);var settings=this.getSettings();settings.navigatorEnabled?this.$navigatorEnabledCheckbox.prop("checked",!0):this.$navigatorEnabledCheckbox.removeAttr("checked"),settings.clickToZoomEnabled?this.$clickToZoomEnabledCheckbox.prop("checked",!0):this.$clickToZoomEnabledCheckbox.removeAttr("checked"),this.extension.helper.isPagingAvailable()?settings.pagingEnabled?this.$pagingEnabledCheckbox.prop("checked",!0):this.$pagingEnabledCheckbox.removeAttr("checked"):this.$pagingEnabled.hide(),settings.preserveViewport?this.$preserveViewportCheckbox.prop("checked",!0):this.$preserveViewportCheckbox.removeAttr("checked")},SettingsDialogue}(SettingsDialogue_1.SettingsDialogue);exports.SettingsDialogue=SettingsDialogue}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("extensions/uv-seadragon-extension/ShareDialogue",["require","exports","./Events","../../modules/uv-dialogues-module/ShareDialogue"],(function(require,exports,Events_1,ShareDialogue_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ShareDialogue=function(_super){function ShareDialogue($element){var _this=_super.call(this,$element)||this;return _this.component.subscribe(Events_1.Events.SEADRAGON_OPEN,(function(){_this.update()})),_this.component.subscribe(Events_1.Events.SEADRAGON_ANIMATION_FINISH,(function(){_this.update()})),_this}return __extends(ShareDialogue,_super),ShareDialogue.prototype.create=function(){this.setConfig("shareDialogue"),_super.prototype.create.call(this)},ShareDialogue.prototype.update=function(){_super.prototype.update.call(this);var xywh=this.extension.getViewportBounds(),rotation=this.extension.getViewerRotation();this.code=this.extension.getEmbedScript(this.options.embedTemplate,this.currentWidth,this.currentHeight,xywh,rotation),this.$code.val(this.code)},ShareDialogue.prototype.resize=function(){_super.prototype.resize.call(this)},ShareDialogue}(ShareDialogue_1.ShareDialogue);exports.ShareDialogue=ShareDialogue}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("extensions/uv-seadragon-extension/Extension",["require","exports","manifesto.js","@iiif/manifold","../../modules/uv-shared-module/AnnotationResults","../../modules/uv-shared-module/BaseEvents","../../modules/uv-shared-module/BaseExtension","../../modules/uv-shared-module/Bookmark","../../modules/uv-contentleftpanel-module/ContentLeftPanel","./CroppedImageDimensions","./DownloadDialogue","./Events","../../modules/uv-dialogues-module/ExternalContentDialogue","../../modules/uv-osdmobilefooterpanel-module/MobileFooter","../../modules/uv-searchfooterpanel-module/FooterPanel","../../modules/uv-dialogues-module/HelpDialogue","./Mode","../../modules/uv-dialogues-module/MoreInfoDialogue","../../modules/uv-moreinforightpanel-module/MoreInfoRightPanel","../../modules/uv-multiselectdialogue-module/MultiSelectDialogue","./MultiSelectionArgs","../../modules/uv-pagingheaderpanel-module/PagingHeaderPanel","../../modules/uv-shared-module/Point","../../modules/uv-seadragoncenterpanel-module/SeadragonCenterPanel","./SettingsDialogue","./ShareDialogue","@iiif/vocabulary"],(function(require,exports,manifesto_js_1,manifold_1,AnnotationResults_1,BaseEvents_1,BaseExtension_1,Bookmark_1,ContentLeftPanel_1,CroppedImageDimensions_1,DownloadDialogue_1,Events_1,ExternalContentDialogue_1,MobileFooter_1,FooterPanel_1,HelpDialogue_1,Mode_1,MoreInfoDialogue_1,MoreInfoRightPanel_1,MultiSelectDialogue_1,MultiSelectionArgs_1,PagingHeaderPanel_1,Point_1,SeadragonCenterPanel_1,SettingsDialogue_1,ShareDialogue_1,vocabulary_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Extension=function(_super){function Extension(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.annotations=[],_this.currentRotation=0,_this.isAnnotating=!1,_this}return __extends(Extension,_super),Extension.prototype.create=function(){var _this=this;_super.prototype.create.call(this),this.component.subscribe(BaseEvents_1.BaseEvents.METRIC_CHANGED,(function(){if(_this.isDesktopMetric())_this.shell.$rightPanel.show();else{var settings={pagingEnabled:!1};_this.updateSettings(settings),_this.component.publish(BaseEvents_1.BaseEvents.UPDATE_SETTINGS),_this.shell.$rightPanel.hide()}})),this.component.subscribe(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,(function(canvasIndex){_this.previousAnnotationRect=null,_this.currentAnnotationRect=null,_this.viewPage(canvasIndex)})),this.component.subscribe(BaseEvents_1.BaseEvents.CLEAR_ANNOTATIONS,(function(){_this.clearAnnotations(),_this.component.publish(BaseEvents_1.BaseEvents.ANNOTATIONS_CLEARED),_this.fire(BaseEvents_1.BaseEvents.CLEAR_ANNOTATIONS)})),this.component.subscribe(BaseEvents_1.BaseEvents.DOWN_ARROW,(function(){_this.useArrowKeysToNavigate()||_this.centerPanel.setFocus()})),this.component.subscribe(BaseEvents_1.BaseEvents.END,(function(){_this.component.publish(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,_this.helper.getLastPageIndex())})),this.component.subscribe(BaseEvents_1.BaseEvents.FIRST,(function(){_this.fire(BaseEvents_1.BaseEvents.FIRST),_this.component.publish(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,_this.helper.getFirstPageIndex())})),this.component.subscribe(BaseEvents_1.BaseEvents.GALLERY_DECREASE_SIZE,(function(){_this.fire(BaseEvents_1.BaseEvents.GALLERY_DECREASE_SIZE)})),this.component.subscribe(BaseEvents_1.BaseEvents.GALLERY_INCREASE_SIZE,(function(){_this.fire(BaseEvents_1.BaseEvents.GALLERY_INCREASE_SIZE)})),this.component.subscribe(BaseEvents_1.BaseEvents.GALLERY_THUMB_SELECTED,(function(){_this.fire(BaseEvents_1.BaseEvents.GALLERY_THUMB_SELECTED)})),this.component.subscribe(BaseEvents_1.BaseEvents.HOME,(function(){_this.component.publish(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,_this.helper.getFirstPageIndex())})),this.component.subscribe(Events_1.Events.IMAGE_SEARCH,(function(index){_this.fire(Events_1.Events.IMAGE_SEARCH,index),_this.component.publish(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,index)})),this.component.subscribe(BaseEvents_1.BaseEvents.LAST,(function(){_this.fire(BaseEvents_1.BaseEvents.LAST),_this.component.publish(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,_this.helper.getLastPageIndex())})),this.component.subscribe(BaseEvents_1.BaseEvents.LEFT_ARROW,(function(){_this.useArrowKeysToNavigate()?_this.component.publish(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,_this.getPrevPageIndex()):_this.centerPanel.setFocus()})),this.component.subscribe(BaseEvents_1.BaseEvents.LEFTPANEL_COLLAPSE_FULL_START,(function(){_this.isDesktopMetric()&&_this.shell.$rightPanel.show()})),this.component.subscribe(BaseEvents_1.BaseEvents.LEFTPANEL_COLLAPSE_FULL_FINISH,(function(){_this.shell.$centerPanel.show(),_this.resize()})),this.component.subscribe(BaseEvents_1.BaseEvents.LEFTPANEL_EXPAND_FULL_START,(function(){_this.shell.$centerPanel.hide(),_this.shell.$rightPanel.hide()})),this.component.subscribe(BaseEvents_1.BaseEvents.MINUS,(function(){_this.centerPanel.setFocus()})),this.component.subscribe(Events_1.Events.MODE_CHANGED,(function(mode){_this.fire(Events_1.Events.MODE_CHANGED,mode),_this.mode=new Mode_1.Mode(mode);var settings=_this.getSettings();_this.component.publish(BaseEvents_1.BaseEvents.SETTINGS_CHANGED,settings)})),this.component.subscribe(BaseEvents_1.BaseEvents.MULTISELECTION_MADE,(function(ids){var args=new MultiSelectionArgs_1.MultiSelectionArgs;args.manifestUri=_this.helper.manifestUri,args.allCanvases=ids.length===_this.helper.getCanvases().length,args.canvases=ids,args.format=_this.data.config.options.multiSelectionMimeType,args.sequence=_this.helper.getCurrentSequence().id,_this.fire(BaseEvents_1.BaseEvents.MULTISELECTION_MADE,args)})),this.component.subscribe(BaseEvents_1.BaseEvents.NEXT,(function(){_this.fire(BaseEvents_1.BaseEvents.NEXT),_this.component.publish(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,_this.getNextPageIndex())})),this.component.subscribe(Events_1.Events.NEXT_SEARCH_RESULT,(function(){_this.fire(Events_1.Events.NEXT_SEARCH_RESULT)})),this.component.subscribe(Events_1.Events.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE,(function(){_this.fire(Events_1.Events.NEXT_IMAGES_SEARCH_RESULT_UNAVAILABLE),_this.nextSearchResult()})),this.component.subscribe(Events_1.Events.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE,(function(){_this.fire(Events_1.Events.PREV_IMAGES_SEARCH_RESULT_UNAVAILABLE),_this.prevSearchResult()})),this.component.subscribe(BaseEvents_1.BaseEvents.OPEN_THUMBS_VIEW,(function(){_this.fire(BaseEvents_1.BaseEvents.OPEN_THUMBS_VIEW)})),this.component.subscribe(BaseEvents_1.BaseEvents.OPEN_TREE_VIEW,(function(){_this.fire(BaseEvents_1.BaseEvents.OPEN_TREE_VIEW)})),this.component.subscribe(BaseEvents_1.BaseEvents.PAGE_DOWN,(function(){_this.component.publish(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,_this.getNextPageIndex())})),this.component.subscribe(Events_1.Events.PAGE_SEARCH,(function(value){_this.fire(Events_1.Events.PAGE_SEARCH,value),_this.viewLabel(value)})),this.component.subscribe(BaseEvents_1.BaseEvents.PAGE_UP,(function(){_this.component.publish(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,_this.getPrevPageIndex())})),this.component.subscribe(Events_1.Events.PAGING_TOGGLED,(function(obj){_this.fire(Events_1.Events.PAGING_TOGGLED,obj)})),this.component.subscribe(BaseEvents_1.BaseEvents.PLUS,(function(){_this.centerPanel.setFocus()})),this.component.subscribe(BaseEvents_1.BaseEvents.PREV,(function(){_this.fire(BaseEvents_1.BaseEvents.PREV),_this.component.publish(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,_this.getPrevPageIndex())})),this.component.subscribe(Events_1.Events.PREV_SEARCH_RESULT,(function(){_this.fire(Events_1.Events.PREV_SEARCH_RESULT)})),this.component.subscribe(Events_1.Events.PRINT,(function(){_this.print()})),this.component.subscribe(BaseEvents_1.BaseEvents.RELOAD,(function(){_this.component.publish(BaseEvents_1.BaseEvents.CLEAR_ANNOTATIONS)})),this.component.subscribe(BaseEvents_1.BaseEvents.RIGHT_ARROW,(function(){_this.useArrowKeysToNavigate()?_this.component.publish(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,_this.getNextPageIndex()):_this.centerPanel.setFocus()})),this.component.subscribe(Events_1.Events.SEADRAGON_ANIMATION,(function(){_this.fire(Events_1.Events.SEADRAGON_ANIMATION)})),this.component.subscribe(Events_1.Events.SEADRAGON_ANIMATION_FINISH,(function(viewer){var bounds=_this.centerPanel.getViewportBounds();_this.centerPanel&&bounds&&(_this.component.publish(Events_1.Events.XYWH_CHANGED,bounds.toString()),_this.data.xywh=bounds.toString(),_this.fire(Events_1.Events.XYWH_CHANGED,_this.data.xywh));var canvas=_this.helper.getCurrentCanvas();_this.fire(Events_1.Events.CURRENT_VIEW_URI,{cropUri:_this.getCroppedImageUri(canvas,_this.getViewer()),fullUri:_this.getConfinedImageUri(canvas,canvas.getWidth())})})),this.component.subscribe(Events_1.Events.SEADRAGON_ANIMATION_START,(function(){_this.fire(Events_1.Events.SEADRAGON_ANIMATION_START)})),this.component.subscribe(Events_1.Events.SEADRAGON_OPEN,(function(){_this.useArrowKeysToNavigate()||_this.centerPanel.setFocus(),_this.fire(Events_1.Events.SEADRAGON_OPEN)})),this.component.subscribe(Events_1.Events.SEADRAGON_RESIZE,(function(){_this.fire(Events_1.Events.SEADRAGON_RESIZE)})),this.component.subscribe(Events_1.Events.SEADRAGON_ROTATION,(function(rotation){_this.data.rotation=rotation,_this.fire(Events_1.Events.SEADRAGON_ROTATION,_this.data.rotation),_this.currentRotation=rotation})),this.component.subscribe(Events_1.Events.SEARCH,(function(terms){_this.fire(Events_1.Events.SEARCH,terms),_this.search(terms)})),this.component.subscribe(Events_1.Events.SEARCH_PREVIEW_FINISH,(function(){_this.fire(Events_1.Events.SEARCH_PREVIEW_FINISH)})),this.component.subscribe(Events_1.Events.SEARCH_PREVIEW_START,(function(){_this.fire(Events_1.Events.SEARCH_PREVIEW_START)})),this.component.subscribe(BaseEvents_1.BaseEvents.ANNOTATIONS,(function(obj){_this.fire(BaseEvents_1.BaseEvents.ANNOTATIONS,obj)})),this.component.subscribe(BaseEvents_1.BaseEvents.ANNOTATION_CANVAS_CHANGED,(function(rect){_this.component.publish(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,rect.canvasIndex)})),this.component.subscribe(BaseEvents_1.BaseEvents.ANNOTATIONS_EMPTY,(function(){_this.fire(BaseEvents_1.BaseEvents.ANNOTATIONS_EMPTY)})),this.component.subscribe(BaseEvents_1.BaseEvents.THUMB_SELECTED,(function(thumb){_this.component.publish(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,thumb.index)})),this.component.subscribe(BaseEvents_1.BaseEvents.TREE_NODE_SELECTED,(function(node){_this.fire(BaseEvents_1.BaseEvents.TREE_NODE_SELECTED,node.data.path),_this.treeNodeSelected(node)})),this.component.subscribe(BaseEvents_1.BaseEvents.UP_ARROW,(function(){_this.useArrowKeysToNavigate()||_this.centerPanel.setFocus()})),this.component.subscribe(BaseEvents_1.BaseEvents.UPDATE_SETTINGS,(function(){_this.component.publish(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,_this.helper.canvasIndex);var settings=_this.getSettings();_this.component.publish(BaseEvents_1.BaseEvents.SETTINGS_CHANGED,settings)}))},Extension.prototype.createModules=function(){_super.prototype.createModules.call(this),this.isHeaderPanelEnabled()?this.headerPanel=new PagingHeaderPanel_1.PagingHeaderPanel(this.shell.$headerPanel):this.shell.$headerPanel.hide(),this.isLeftPanelEnabled()?this.leftPanel=new ContentLeftPanel_1.ContentLeftPanel(this.shell.$leftPanel):this.shell.$leftPanel.hide(),this.centerPanel=new SeadragonCenterPanel_1.SeadragonCenterPanel(this.shell.$centerPanel),this.isRightPanelEnabled()?this.rightPanel=new MoreInfoRightPanel_1.MoreInfoRightPanel(this.shell.$rightPanel):this.shell.$rightPanel.hide(),this.isFooterPanelEnabled()?(this.footerPanel=new FooterPanel_1.FooterPanel(this.shell.$footerPanel),this.mobileFooterPanel=new MobileFooter_1.FooterPanel(this.shell.$mobileFooterPanel)):this.shell.$footerPanel.hide(),this.$helpDialogue=$('<div class="overlay help" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$helpDialogue),this.helpDialogue=new HelpDialogue_1.HelpDialogue(this.$helpDialogue),this.$moreInfoDialogue=$('<div class="overlay moreInfo" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$moreInfoDialogue),this.moreInfoDialogue=new MoreInfoDialogue_1.MoreInfoDialogue(this.$moreInfoDialogue),this.$multiSelectDialogue=$('<div class="overlay multiSelect" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$multiSelectDialogue),this.multiSelectDialogue=new MultiSelectDialogue_1.MultiSelectDialogue(this.$multiSelectDialogue),this.$shareDialogue=$('<div class="overlay share" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$shareDialogue),this.shareDialogue=new ShareDialogue_1.ShareDialogue(this.$shareDialogue),this.$downloadDialogue=$('<div class="overlay download" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$downloadDialogue),this.downloadDialogue=new DownloadDialogue_1.DownloadDialogue(this.$downloadDialogue),this.$settingsDialogue=$('<div class="overlay settings" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$settingsDialogue),this.settingsDialogue=new SettingsDialogue_1.SettingsDialogue(this.$settingsDialogue),this.$externalContentDialogue=$('<div class="overlay externalContent" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$externalContentDialogue),this.externalContentDialogue=new ExternalContentDialogue_1.ExternalContentDialogue(this.$externalContentDialogue),this.isHeaderPanelEnabled()&&this.headerPanel.init(),this.isLeftPanelEnabled()&&this.leftPanel.init(),this.isRightPanelEnabled()&&this.rightPanel.init(),this.isFooterPanelEnabled()&&this.footerPanel.init()},Extension.prototype.render=function(){_super.prototype.render.call(this),this.checkForAnnotations(),this.checkForSearchParam(),this.checkForRotationParam()},Extension.prototype.checkForAnnotations=function(){if(this.data.annotations){var annotations=this.parseAnnotationList(this.data.annotations);this.component.publish(BaseEvents_1.BaseEvents.CLEAR_ANNOTATIONS),this.annotate(annotations)}},Extension.prototype.annotate=function(annotations,terms){this.annotations=annotations,this.annotations=annotations.sort((function(a,b){return a.canvasIndex-b.canvasIndex}));var annotationResults=new AnnotationResults_1.AnnotationResults;annotationResults.terms=terms,annotationResults.annotations=this.annotations,this.component.publish(BaseEvents_1.BaseEvents.ANNOTATIONS,annotationResults)},Extension.prototype.checkForSearchParam=function(){var highlight=this.data.highlight;highlight&&(highlight.replace(/\+/g," ").replace(/"/g,""),this.component.publish(Events_1.Events.SEARCH,highlight))},Extension.prototype.checkForRotationParam=function(){var rotation=this.data.rotation;rotation&&this.component.publish(Events_1.Events.SEADRAGON_ROTATION,rotation)},Extension.prototype.viewPage=function(canvasIndex){if(-1!==canvasIndex){var isReload=!1;if(canvasIndex===this.helper.canvasIndex&&(isReload=!0),this.helper.isCanvasIndexOutOfRange(canvasIndex)&&(this.showMessage(this.data.config.content.canvasIndexOutOfRange),canvasIndex=0),this.isPagingSettingEnabled()&&!isReload)if(this.getPagedIndices(canvasIndex).includes(this.helper.canvasIndex))return void this.viewCanvas(canvasIndex);this.viewCanvas(canvasIndex)}},Extension.prototype.getViewer=function(){return this.centerPanel.viewer},Extension.prototype.getMode=function(){if(this.mode)return this.mode;var manifestType=this.helper.getManifestType();if(!manifestType)return Mode_1.Mode.image;switch(manifestType.toString()){case manifesto_js_1.ManifestType.MONOGRAPH.toString():case manifesto_js_1.ManifestType.MANUSCRIPT.toString():return Mode_1.Mode.page;default:return Mode_1.Mode.image}},Extension.prototype.getViewportBounds=function(){if(!this.centerPanel)return null;var bounds=this.centerPanel.getViewportBounds();return bounds?bounds.toString():null},Extension.prototype.getViewerRotation=function(){return this.centerPanel?this.currentRotation:null},Extension.prototype.viewRange=function(path){var range=this.helper.getRangeByPath(path);if(range){var canvasId=range.getCanvasIds()[0],index=this.helper.getCanvasIndexById(canvasId);this.component.publish(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,index)}},Extension.prototype.viewLabel=function(label){if(!label)return this.showMessage(this.data.config.modules.genericDialogue.content.emptyValue),void this.component.publish(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGE_FAILED);var index=this.helper.getCanvasIndexByLabel(label);-1!=index?this.component.publish(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,index):(this.showMessage(this.data.config.modules.genericDialogue.content.pageNotFound),this.component.publish(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGE_FAILED))},Extension.prototype.treeNodeSelected=function(node){var data=node.data;if(data.type)switch(data.type){case vocabulary_1.IIIFResourceType.MANIFEST.toString():this.viewManifest(data);break;case vocabulary_1.IIIFResourceType.COLLECTION.toString():this.viewCollection(data);break;default:this.viewRange(data.path)}},Extension.prototype.clearAnnotations=function(){this.annotations=null,this.component.publish(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,this.helper.canvasIndex)},Extension.prototype.prevSearchResult=function(){var foundResult;if(this.annotations)for(var i=this.annotations.length-1;i>=0;i--){var result=this.annotations[i];if(result.canvasIndex<=this.getPrevPageIndex()){foundResult=result,this.component.publish(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,foundResult.canvasIndex);break}}},Extension.prototype.nextSearchResult=function(){if(this.annotations)for(var i=0;i<this.annotations.length;i++){var result=this.annotations[i];if(result&&result.canvasIndex>=this.getNextPageIndex()){this.component.publish(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,result.canvasIndex);break}}},Extension.prototype.bookmark=function(){_super.prototype.bookmark.call(this);var canvas=this.helper.getCurrentCanvas(),bookmark=new Bookmark_1.Bookmark;bookmark.index=this.helper.canvasIndex,bookmark.label=manifesto_js_1.LanguageMap.getValue(canvas.getLabel()),bookmark.path=this.getCroppedImageUri(canvas,this.getViewer()),bookmark.thumb=canvas.getCanonicalImageUri(this.data.config.options.bookmarkThumbWidth),bookmark.title=this.helper.getLabel(),bookmark.trackingLabel=window.trackingLabel,bookmark.type=vocabulary_1.ExternalResourceType.IMAGE.toString(),this.fire(BaseEvents_1.BaseEvents.BOOKMARK,bookmark)},Extension.prototype.print=function(){window.print(),this.fire(Events_1.Events.PRINT)},Extension.prototype.getCroppedImageDimensions=function(canvas,viewer){if(!viewer)return null;if(!viewer.viewport)return null;if(!canvas.getHeight()||!canvas.getWidth())return null;var bounds=viewer.viewport.getBounds(!0),dimensions=new CroppedImageDimensions_1.CroppedImageDimensions,width=Math.floor(bounds.width),height=Math.floor(bounds.height),x=Math.floor(bounds.x),y=Math.floor(bounds.y);x+width>canvas.getWidth()?width=canvas.getWidth()-x:x<0&&(width+=x),x<0&&(x=0),y+height>canvas.getHeight()?height=canvas.getHeight()-y:y<0&&(height+=y),y<0&&(y=0);var regionWidth=width=Math.min(width,canvas.getWidth()),regionHeight=height=Math.min(height,canvas.getHeight()),maxDimensions=canvas.getMaxDimensions();if(maxDimensions){if(width>maxDimensions.width){var newWidth=maxDimensions.width;height=Math.round(newWidth*(height/width)),width=newWidth}if(height>maxDimensions.height){var newHeight=maxDimensions.height;width=Math.round(width/height*newHeight),height=newHeight}}return dimensions.region=new manifesto_js_1.Size(regionWidth,regionHeight),dimensions.regionPos=new Point_1.Point(x,y),dimensions.size=new manifesto_js_1.Size(width,height),dimensions},Extension.prototype.getCroppedImageUri=function(canvas,viewer){if(!viewer)return null;if(!viewer.viewport)return null;var dimensions=this.getCroppedImageDimensions(canvas,viewer);if(!dimensions)return null;var baseUri=this.getImageBaseUri(canvas),id=this.getImageId(canvas);if(!id)return null;return baseUri+"/"+id+"/"+(dimensions.regionPos.x+","+dimensions.regionPos.y+","+dimensions.region.width+","+dimensions.region.height)+"/"+(dimensions.size.width+","+dimensions.size.height)+"/"+this.getViewerRotation()+"/default.jpg"},Extension.prototype.getConfinedImageDimensions=function(canvas,width){var dimensions=new manifesto_js_1.Size(0,0);dimensions.width=width;var normWidth=Utils.Maths.normalise(width,0,canvas.getWidth());return dimensions.height=Math.floor(canvas.getHeight()*normWidth),dimensions},Extension.prototype.getConfinedImageUri=function(canvas,width){var baseUri=this.getImageBaseUri(canvas),id=this.getImageId(canvas);if(!id)return null;var dimensions=this.getConfinedImageDimensions(canvas,width);return baseUri+"/"+id+"/full/"+(dimensions.width+","+dimensions.height)+"/"+this.getViewerRotation()+"/default.jpg"},Extension.prototype.getImageId=function(canvas){if(canvas.externalResource){var id=canvas.externalResource.data["@id"];if(id)return id.substr(id.lastIndexOf("/")+1)}return null},Extension.prototype.getImageBaseUri=function(canvas){var uri=this.getInfoUri(canvas);return(uri=uri.substr(0,uri.lastIndexOf("/"))).substr(0,uri.lastIndexOf("/"))},Extension.prototype.getInfoUri=function(canvas){var infoUri=null,images=canvas.getImages();if(images&&images.length)for(var services=images[0].getResource().getServices(),i=0;i<services.length;i++){var service=services[i],id=service.id;id.endsWith("/")||(id+="/"),manifesto_js_1.Utils.isImageProfile(service.getProfile())&&(infoUri=id+"info.json")}return infoUri||(infoUri="lib/imageunavailable.json"),infoUri},Extension.prototype.getEmbedScript=function(template,width,height,zoom,rotation){var config=this.data.config.uri||"",locales=this.getSerializedLocales(),iframeSrc=this.getAppUri()+"#?manifest="+this.helper.manifestUri+"&c="+this.helper.collectionIndex+"&m="+this.helper.manifestIndex+"&s="+this.helper.sequenceIndex+"&cv="+this.helper.canvasIndex+"&config="+config+"&locales="+locales+"&xywh="+zoom+"&r="+rotation;return Utils.Strings.format(template,iframeSrc,width.toString(),height.toString())},Extension.prototype.getPrevPageIndex=function(canvasIndex){var index;if(void 0===canvasIndex&&(canvasIndex=this.helper.canvasIndex),this.isPagingSettingEnabled()){var indices=this.getPagedIndices(canvasIndex);index=this.helper.isRightToLeft()?indices[indices.length-1]-1:indices[0]-1}else index=canvasIndex-1;return index},Extension.prototype.isSearchEnabled=function(){return!!Utils.Bools.getBool(this.data.config.options.searchWithinEnabled,!1)&&!!this.helper.getSearchService()},Extension.prototype.isPagingSettingEnabled=function(){return!!this.helper.isPagingAvailable()&&this.getSettings().pagingEnabled},Extension.prototype.getNextPageIndex=function(canvasIndex){var index;if(void 0===canvasIndex&&(canvasIndex=this.helper.canvasIndex),this.isPagingSettingEnabled()){var indices=this.getPagedIndices(canvasIndex);index=this.helper.isRightToLeft()?indices[0]+1:indices[indices.length-1]+1}else index=canvasIndex+1;return index>this.helper.getTotalCanvases()-1?-1:index},Extension.prototype.getAutoCompleteService=function(){var service=this.helper.getSearchService();return service?service.getService(vocabulary_1.ServiceProfile.SEARCH_1_AUTO_COMPLETE)||service.getService(vocabulary_1.ServiceProfile.SEARCH_0_AUTO_COMPLETE):null},Extension.prototype.getAutoCompleteUri=function(){var service=this.getAutoCompleteService();return service?service.id+"?q={0}":null},Extension.prototype.getSearchServiceUri=function(){var service=this.helper.getSearchService();if(!service)return null;var uri=service.id;return uri+="?q={0}"},Extension.prototype.search=function(terms){var _this=this;if(!this.isAnnotating){this.isAnnotating=!0,this.annotations=[];var that=this,searchUri=this.getSearchServiceUri();searchUri&&(searchUri=Utils.Strings.format(searchUri,encodeURIComponent(terms)),this.getSearchResults(searchUri,terms,this.annotations,(function(annotations){that.isAnnotating=!1,annotations.length?that.annotate(annotations,terms):that.showMessage(that.data.config.modules.genericDialogue.content.noMatches,(function(){_this.component.publish(BaseEvents_1.BaseEvents.ANNOTATIONS_EMPTY)}))})))}},Extension.prototype.getSearchResults=function(searchUri,terms,searchResults,cb){var _this=this;$.getJSON(searchUri,(function(results){results.resources&&results.resources.length&&(searchResults=searchResults.concat(_this.parseAnnotationList(results))),results.next?_this.getSearchResults(results.next,terms,searchResults,cb):cb(searchResults)}))},Extension.prototype.parseAnnotationList=function(annotations){for(var parsed=[],_loop_1=function(i){var resource=annotations.resources[i],canvasIndex=this_1.helper.getCanvasIndexById(resource.on.match(/(.*)#/)[1]),annotationGroup=new manifold_1.AnnotationGroup(resource,canvasIndex),match=parsed.en().where((function(x){return x.canvasIndex===annotationGroup.canvasIndex})).first();match?match.addRect(resource):parsed.push(annotationGroup)},this_1=this,i=0;i<annotations.resources.length;i++)_loop_1(i);return parsed.sort((function(a,b){return a.canvasIndex-b.canvasIndex})),parsed},Extension.prototype.getAnnotationRects=function(){return this.annotations?this.annotations.en().selectMany((function(x){return x.rects})).toArray():[]},Extension.prototype.getCurrentAnnotationRectIndex=function(){var annotationRects=this.getAnnotationRects();return this.currentAnnotationRect?annotationRects.indexOf(this.currentAnnotationRect):-1},Extension.prototype.getTotalAnnotationRects=function(){return this.getAnnotationRects().length},Extension.prototype.isFirstAnnotationRect=function(){return 0===this.getCurrentAnnotationRectIndex()},Extension.prototype.getLastAnnotationRectIndex=function(){return this.getTotalAnnotationRects()-1},Extension.prototype.getPagedIndices=function(canvasIndex){void 0===canvasIndex&&(canvasIndex=this.helper.canvasIndex);var indices=[];return this.helper.isContinuous()?indices=$.map(this.helper.getCanvases(),(function(c,index){return index})):this.isPagingSettingEnabled()?(indices=this.helper.isFirstCanvas(canvasIndex)||this.helper.isLastCanvas(canvasIndex)&&this.helper.isTotalCanvasesEven()?[canvasIndex]:canvasIndex%2?[canvasIndex,canvasIndex+1]:[canvasIndex-1,canvasIndex],this.helper.isRightToLeft()&&(indices=indices.reverse())):indices.push(this.helper.canvasIndex),indices},Extension}(BaseExtension_1.BaseExtension);exports.Extension=Extension}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("extensions/uv-pdf-extension/DownloadDialogue",["require","exports","../../modules/uv-dialogues-module/DownloadDialogue"],(function(require,exports,DownloadDialogue_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var DownloadDialogue=function(_super){function DownloadDialogue($element){return _super.call(this,$element)||this}return __extends(DownloadDialogue,_super),DownloadDialogue.prototype.create=function(){this.setConfig("downloadDialogue"),_super.prototype.create.call(this)},DownloadDialogue.prototype.open=function(triggerButton){_super.prototype.open.call(this,triggerButton),this.addEntireFileDownloadOptions(),this.$downloadOptions.find("li:visible").length?this.$noneAvailable.hide():this.$noneAvailable.show(),this.resize()},DownloadDialogue.prototype.isDownloadOptionAvailable=function(option){return _super.prototype.isDownloadOptionAvailable.call(this,option)},DownloadDialogue}(DownloadDialogue_1.DownloadDialogue);exports.DownloadDialogue=DownloadDialogue})),define("extensions/uv-pdf-extension/Events",["require","exports"],(function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Events=function(){function Events(){}return Events.namespace="pdfExtension.",Events.PDF_LOADED=Events.namespace+"pdfLoaded",Events.PAGE_INDEX_CHANGED=Events.namespace+"pageIndexChanged",Events.SEARCH=Events.namespace+"search",Events}();exports.Events=Events}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-pdfcenterpanel-module/PDFCenterPanel",["require","exports","../uv-shared-module/BaseEvents","../uv-shared-module/CenterPanel","../../extensions/uv-pdf-extension/Events"],(function(require,exports,BaseEvents_1,CenterPanel_1,Events_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var PDFCenterPanel=function(_super){function PDFCenterPanel($element){var _this=_super.call(this,$element)||this;return _this._maxScale=5,_this._minScale=.7,_this._nextButtonEnabled=!1,_this._pageIndex=1,_this._pageIndexPending=null,_this._pageRendering=!1,_this._pdfDoc=null,_this._prevButtonEnabled=!1,_this._scale=.7,_this}return __extends(PDFCenterPanel,_super),PDFCenterPanel.prototype.create=function(){var _this=this;this.setConfig("pdfCenterPanel"),_super.prototype.create.call(this),this._$pdfContainer=$('<div class="pdfContainer"></div>'),this._$canvas=$("<canvas></canvas>"),this._$spinner=$('<div class="spinner"></div>'),this._canvas=this._$canvas[0],this._ctx=this._canvas.getContext("2d"),this._$prevButton=$('<div class="btn prev" tabindex="0"></div>'),this._$nextButton=$('<div class="btn next" tabindex="0"></div>'),this._$zoomInButton=$('<div class="btn zoomIn" tabindex="0"></div>'),this._$zoomOutButton=$('<div class="btn zoomOut" tabindex="0"></div>'),Utils.Bools.getBool(this.extension.data.config.options.usePdfJs,!1)&&(this.$content.append(this._$spinner),this.$content.append(this._$prevButton),this.$content.append(this._$nextButton),this.$content.append(this._$zoomInButton),this.$content.append(this._$zoomOutButton)),this._$pdfContainer.append(this._$canvas),this.$content.prepend(this._$pdfContainer),this.component.subscribe(BaseEvents_1.BaseEvents.OPEN_EXTERNAL_RESOURCE,(function(resources){_this.openMedia(resources)})),this.component.subscribe(BaseEvents_1.BaseEvents.FIRST,(function(){_this._pdfDoc&&(_this._pageIndex=1,_this._queueRenderPage(_this._pageIndex))})),this.component.subscribe(BaseEvents_1.BaseEvents.PREV,(function(){_this._pdfDoc&&(_this._pageIndex<=1||(_this._pageIndex--,_this._queueRenderPage(_this._pageIndex)))})),this.component.subscribe(BaseEvents_1.BaseEvents.NEXT,(function(){_this._pdfDoc&&(_this._pageIndex>=_this._pdfDoc.numPages||(_this._pageIndex++,_this._queueRenderPage(_this._pageIndex)))})),this.component.subscribe(BaseEvents_1.BaseEvents.LAST,(function(){_this._pdfDoc&&(_this._pageIndex=_this._pdfDoc.numPages,_this._queueRenderPage(_this._pageIndex))})),this.component.subscribe(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,(function(){_this._pdfDoc&&(_this._pageIndex=1,_this._queueRenderPage(_this._pageIndex))})),this.component.subscribe(Events_1.Events.SEARCH,(function(pageIndex){_this._pdfDoc&&(pageIndex<1||pageIndex>_this._pdfDoc.numPages||(_this._pageIndex=pageIndex,_this._queueRenderPage(_this._pageIndex)))})),this._$prevButton.onPressed((function(e){e.preventDefault(),_this._prevButtonEnabled&&_this.component.publish(BaseEvents_1.BaseEvents.PREV)})),this.disablePrevButton(),this._$nextButton.onPressed((function(e){e.preventDefault(),_this._nextButtonEnabled&&_this.component.publish(BaseEvents_1.BaseEvents.NEXT)})),this.disableNextButton(),this._$zoomInButton.onPressed((function(e){e.preventDefault();var newScale=_this._scale+.5;newScale<_this._maxScale?_this._scale=newScale:_this._scale=_this._maxScale,_this._render(_this._pageIndex)})),this._$zoomOutButton.onPressed((function(e){e.preventDefault();var newScale=_this._scale-.5;newScale>_this._minScale?_this._scale=newScale:_this._scale=_this._minScale,_this._render(_this._pageIndex)}))},PDFCenterPanel.prototype.disablePrevButton=function(){this._prevButtonEnabled=!1,this._$prevButton.addClass("disabled")},PDFCenterPanel.prototype.enablePrevButton=function(){this._prevButtonEnabled=!0,this._$prevButton.removeClass("disabled")},PDFCenterPanel.prototype.hidePrevButton=function(){this.disablePrevButton(),this._$prevButton.hide()},PDFCenterPanel.prototype.showPrevButton=function(){this.enablePrevButton(),this._$prevButton.show()},PDFCenterPanel.prototype.disableNextButton=function(){this._nextButtonEnabled=!1,this._$nextButton.addClass("disabled")},PDFCenterPanel.prototype.enableNextButton=function(){this._nextButtonEnabled=!0,this._$nextButton.removeClass("disabled")},PDFCenterPanel.prototype.hideNextButton=function(){this.disableNextButton(),this._$nextButton.hide()},PDFCenterPanel.prototype.showNextButton=function(){this.enableNextButton(),this._$nextButton.show()},PDFCenterPanel.prototype.openMedia=function(resources){var _this=this;this._$spinner.show(),this.extension.getExternalResources(resources).then((function(){var mediaUri=null,canvas=_this.extension.helper.getCurrentCanvas(),formats=_this.extension.getMediaFormats(canvas),pdfUri=canvas.id;if(mediaUri=formats&&formats.length?formats[0].id:canvas.id,Utils.Bools.getBool(_this.extension.data.config.options.usePdfJs,!1)){PDFJS.disableWorker=!0;var parameter={url:mediaUri,withCredentials:canvas.externalResource.isAccessControlled()};PDFJS.getDocument(parameter).then((function(pdfDoc){_this._pdfDoc=pdfDoc,_this._render(_this._pageIndex),_this.component.publish(Events_1.Events.PDF_LOADED,pdfDoc),_this._$spinner.hide()}))}else window.PDFObject.embed(pdfUri,".pdfContainer",{id:"PDF"})}))},PDFCenterPanel.prototype._render=function(num){var _this=this;if(Utils.Bools.getBool(this.extension.data.config.options.usePdfJs,!1)){this._pageRendering=!0,this._$zoomOutButton.enable(),this._$zoomInButton.enable();var lowScale=this._scale-.5,highScale=this._scale+.5;lowScale<this._minScale&&this._$zoomOutButton.disable(),highScale>this._maxScale&&this._$zoomInButton.disable(),this._pdfDoc.getPage(num).then((function(page){_this._renderTask&&_this._renderTask.cancel(),_this._viewport=page.getViewport(_this._scale),_this._canvas.height=_this._viewport.height,_this._canvas.width=_this._viewport.width;var divisible_amount=_this._canvas.height/_this.$content.height(),canvas_height=_this._canvas.height/divisible_amount*_this._viewport.scale;canvas_height<_this.$content.height()&&(canvas_height=_this.$content.height()),_this._$canvas.css({height:canvas_height});var renderContext={canvasContext:_this._ctx,viewport:_this._viewport};_this._renderTask=page.render(renderContext),_this._renderTask.promise.then((function(){_this.component.publish(Events_1.Events.PAGE_INDEX_CHANGED,_this._pageIndex),_this._pageRendering=!1,null!==_this._pageIndexPending&&(_this._render(_this._pageIndexPending),_this._pageIndexPending=null),1===_this._pageIndex?_this.disablePrevButton():_this.enablePrevButton(),_this._pageIndex===_this._pdfDoc.numPages?_this.disableNextButton():_this.enableNextButton()})).catch((function(err){}))}))}},PDFCenterPanel.prototype._queueRenderPage=function(num){this._pageRendering?this._pageIndexPending=num:this._render(num)},PDFCenterPanel.prototype.resize=function(){_super.prototype.resize.call(this),this._$pdfContainer.width(this.$content.width()),this._$pdfContainer.height(this.$content.height()),this._$spinner.css("top",this.$content.height()/2-this._$spinner.height()/2),this._$spinner.css("left",this.$content.width()/2-this._$spinner.width()/2),this._$prevButton.css({top:(this.$content.height()-this._$prevButton.height())/2,left:this._$prevButton.horizontalMargins()}),this._$nextButton.css({top:(this.$content.height()-this._$nextButton.height())/2,left:this.$content.width()-(this._$nextButton.width()+this._$nextButton.horizontalMargins())}),this._viewport&&this._render(this._pageIndex)},PDFCenterPanel}(CenterPanel_1.CenterPanel);exports.PDFCenterPanel=PDFCenterPanel}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-pdfheaderpanel-module/PDFHeaderPanel",["require","exports","../uv-shared-module/BaseEvents","../../extensions/uv-pdf-extension/Events","../uv-shared-module/HeaderPanel"],(function(require,exports,BaseEvents_1,Events_1,HeaderPanel_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var PDFHeaderPanel=function(_super){function PDFHeaderPanel($element){var _this=_super.call(this,$element)||this;return _this.firstButtonEnabled=!1,_this.lastButtonEnabled=!1,_this.nextButtonEnabled=!1,_this.prevButtonEnabled=!1,_this._pageIndex=0,_this._pdfDoc=null,_this}return __extends(PDFHeaderPanel,_super),PDFHeaderPanel.prototype.create=function(){var _this=this;this.setConfig("pdfHeaderPanel"),_super.prototype.create.call(this),this.component.subscribe(Events_1.Events.PAGE_INDEX_CHANGED,(function(pageIndex){_this._pageIndex=pageIndex,_this.render()})),this.component.subscribe(Events_1.Events.PDF_LOADED,(function(pdfDoc){_this._pdfDoc=pdfDoc})),this.$prevOptions=$('<div class="prevOptions"></div>'),this.$centerOptions.append(this.$prevOptions),this.$firstButton=$('\n          <button class="btn imageBtn first" tabindex="0" title="'+this.content.first+'">\n            <i class="uv-icon-first" aria-hidden="true"></i>'+this.content.first+"\n          </button>\n        "),this.$prevOptions.append(this.$firstButton),this.$firstButton.disable(),this.$prevButton=$('\n          <button class="btn imageBtn prev" tabindex="0" title="'+this.content.previous+'">\n            <i class="uv-icon-prev" aria-hidden="true"></i>'+this.content.previous+"\n          </button>\n        "),this.$prevOptions.append(this.$prevButton),this.$prevButton.disable(),this.$search=$('<div class="search"></div>'),this.$centerOptions.append(this.$search),this.$searchText=$('<input class="searchText" maxlength="50" type="text" tabindex="0" aria-label="'+this.content.pageSearchLabel+'"/>'),this.$search.append(this.$searchText),this.$total=$('<span class="total"></span>'),this.$search.append(this.$total),this.$searchButton=$('<a class="go btn btn-primary" tabindex="0">'+this.content.go+"</a>"),this.$search.append(this.$searchButton),this.$searchButton.disable(),this.$nextOptions=$('<div class="nextOptions"></div>'),this.$centerOptions.append(this.$nextOptions),this.$nextButton=$('\n          <button class="btn imageBtn next" tabindex="0" title="'+this.content.next+'">\n            <i class="uv-icon-next" aria-hidden="true"></i>'+this.content.next+"\n          </button>\n        "),this.$nextOptions.append(this.$nextButton),this.$nextButton.disable(),this.$lastButton=$('\n          <button class="btn imageBtn last" tabindex="0" title="'+this.content.last+'">\n            <i class="uv-icon-last" aria-hidden="true"></i>'+this.content.last+"\n          </button>\n        "),this.$nextOptions.append(this.$lastButton),this.$lastButton.disable(),this.$firstButton.onPressed((function(){_this.component.publish(BaseEvents_1.BaseEvents.FIRST)})),this.$prevButton.onPressed((function(){_this.component.publish(BaseEvents_1.BaseEvents.PREV)})),this.$nextButton.onPressed((function(){_this.component.publish(BaseEvents_1.BaseEvents.NEXT)})),this.$lastButton.onPressed((function(){_this.component.publish(BaseEvents_1.BaseEvents.LAST)})),this.$searchText.onEnter((function(){_this.$searchText.blur(),_this.search(_this.$searchText.val())})),this.$searchText.click((function(){$(this).select()})),this.$searchButton.onPressed((function(){_this.search(_this.$searchText.val())}))},PDFHeaderPanel.prototype.render=function(){1===this._pdfDoc.numPages?this.$centerOptions.hide():this.$centerOptions.show(),this.$searchText.val(this._pageIndex);var of=this.content.of;this.$total.html(Utils.Strings.format(of,this._pdfDoc.numPages.toString())),this.$searchButton.enable(),1===this._pageIndex?(this.$firstButton.disable(),this.$prevButton.disable()):(this.$firstButton.enable(),this.$prevButton.enable()),this._pageIndex===this._pdfDoc.numPages?(this.$lastButton.disable(),this.$nextButton.disable()):(this.$lastButton.enable(),this.$nextButton.enable())},PDFHeaderPanel.prototype.search=function(value){if(value){var index=parseInt(this.$searchText.val(),10);isNaN(index)?this.extension.showMessage(this.extension.data.config.modules.genericDialogue.content.invalidNumber):this.component.publish(Events_1.Events.SEARCH,index)}else this.extension.showMessage(this.content.emptyValue)},PDFHeaderPanel.prototype.resize=function(){_super.prototype.resize.call(this)},PDFHeaderPanel}(HeaderPanel_1.HeaderPanel);exports.PDFHeaderPanel=PDFHeaderPanel}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("extensions/uv-pdf-extension/SettingsDialogue",["require","exports","../../modules/uv-dialogues-module/SettingsDialogue"],(function(require,exports,SettingsDialogue_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var SettingsDialogue=function(_super){function SettingsDialogue($element){return _super.call(this,$element)||this}return __extends(SettingsDialogue,_super),SettingsDialogue.prototype.create=function(){this.setConfig("settingsDialogue"),_super.prototype.create.call(this)},SettingsDialogue}(SettingsDialogue_1.SettingsDialogue);exports.SettingsDialogue=SettingsDialogue}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("extensions/uv-pdf-extension/ShareDialogue",["require","exports","../../modules/uv-dialogues-module/ShareDialogue"],(function(require,exports,ShareDialogue_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ShareDialogue=function(_super){function ShareDialogue($element){return _super.call(this,$element)||this}return __extends(ShareDialogue,_super),ShareDialogue.prototype.create=function(){this.setConfig("shareDialogue"),_super.prototype.create.call(this)},ShareDialogue.prototype.update=function(){_super.prototype.update.call(this),this.code=this.extension.getEmbedScript(this.options.embedTemplate,this.currentWidth,this.currentHeight),this.$code.val(this.code)},ShareDialogue.prototype.resize=function(){_super.prototype.resize.call(this)},ShareDialogue}(ShareDialogue_1.ShareDialogue);exports.ShareDialogue=ShareDialogue}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("extensions/uv-pdf-extension/Extension",["require","exports","@iiif/vocabulary","manifesto.js","../../modules/uv-shared-module/BaseEvents","../../modules/uv-shared-module/BaseExtension","../../modules/uv-shared-module/Bookmark","./DownloadDialogue","../../modules/uv-shared-module/FooterPanel","../../modules/uv-moreinforightpanel-module/MoreInfoRightPanel","../../modules/uv-pdfcenterpanel-module/PDFCenterPanel","../../modules/uv-pdfheaderpanel-module/PDFHeaderPanel","../../modules/uv-resourcesleftpanel-module/ResourcesLeftPanel","./SettingsDialogue","./ShareDialogue"],(function(require,exports,vocabulary_1,manifesto_js_1,BaseEvents_1,BaseExtension_1,Bookmark_1,DownloadDialogue_1,FooterPanel_1,MoreInfoRightPanel_1,PDFCenterPanel_1,PDFHeaderPanel_1,ResourcesLeftPanel_1,SettingsDialogue_1,ShareDialogue_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Extension=function(_super){function Extension(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Extension,_super),Extension.prototype.create=function(){var _this=this;requirejs.config({paths:{"pdfjs-dist/build/pdf.combined":this.data.root+"/lib/pdf.combined"}}),_super.prototype.create.call(this),this.component.subscribe(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,(function(canvasIndex){_this.viewCanvas(canvasIndex)})),this.component.subscribe(BaseEvents_1.BaseEvents.THUMB_SELECTED,(function(thumb){_this.component.publish(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,thumb.index)})),this.component.subscribe(BaseEvents_1.BaseEvents.LEFTPANEL_EXPAND_FULL_START,(function(){_this.shell.$centerPanel.hide(),_this.shell.$rightPanel.hide()})),this.component.subscribe(BaseEvents_1.BaseEvents.LEFTPANEL_COLLAPSE_FULL_FINISH,(function(){_this.shell.$centerPanel.show(),_this.shell.$rightPanel.show(),_this.resize()})),this.component.subscribe(BaseEvents_1.BaseEvents.SHOW_OVERLAY,(function(){_this.IsOldIE()&&_this.centerPanel.$element.hide()})),this.component.subscribe(BaseEvents_1.BaseEvents.HIDE_OVERLAY,(function(){_this.IsOldIE()&&_this.centerPanel.$element.show()})),this.component.subscribe(BaseEvents_1.BaseEvents.EXIT_FULLSCREEN,(function(){setTimeout((function(){_this.resize()}),10)}))},Extension.prototype.render=function(){_super.prototype.render.call(this)},Extension.prototype.IsOldIE=function(){var browser=window.browserDetect.browser,version=window.browserDetect.version;return"Explorer"===browser&&version<=9},Extension.prototype.isHeaderPanelEnabled=function(){return _super.prototype.isHeaderPanelEnabled.call(this)&&Utils.Bools.getBool(this.data.config.options.usePdfJs,!0)},Extension.prototype.createModules=function(){_super.prototype.createModules.call(this),this.isHeaderPanelEnabled()?this.headerPanel=new PDFHeaderPanel_1.PDFHeaderPanel(this.shell.$headerPanel):this.shell.$headerPanel.hide(),this.isLeftPanelEnabled()&&(this.leftPanel=new ResourcesLeftPanel_1.ResourcesLeftPanel(this.shell.$leftPanel)),this.centerPanel=new PDFCenterPanel_1.PDFCenterPanel(this.shell.$centerPanel),this.isRightPanelEnabled()&&(this.rightPanel=new MoreInfoRightPanel_1.MoreInfoRightPanel(this.shell.$rightPanel)),this.isFooterPanelEnabled()?this.footerPanel=new FooterPanel_1.FooterPanel(this.shell.$footerPanel):this.shell.$footerPanel.hide(),this.$downloadDialogue=$('<div class="overlay download" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$downloadDialogue),this.downloadDialogue=new DownloadDialogue_1.DownloadDialogue(this.$downloadDialogue),this.$shareDialogue=$('<div class="overlay share" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$shareDialogue),this.shareDialogue=new ShareDialogue_1.ShareDialogue(this.$shareDialogue),this.$settingsDialogue=$('<div class="overlay settings" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$settingsDialogue),this.settingsDialogue=new SettingsDialogue_1.SettingsDialogue(this.$settingsDialogue),this.isLeftPanelEnabled()&&this.leftPanel.init(),this.isRightPanelEnabled()&&this.rightPanel.init()},Extension.prototype.isLeftPanelEnabled=function(){return Utils.Bools.getBool(this.data.config.options.leftPanelEnabled,!0)&&(this.helper.isMultiCanvas()||this.helper.isMultiSequence()||this.helper.hasResources())},Extension.prototype.bookmark=function(){_super.prototype.bookmark.call(this);var canvas=this.helper.getCurrentCanvas(),bookmark=new Bookmark_1.Bookmark;bookmark.index=this.helper.canvasIndex,bookmark.label=manifesto_js_1.LanguageMap.getValue(canvas.getLabel()),bookmark.thumb=canvas.getProperty("thumbnail"),bookmark.title=this.helper.getLabel(),bookmark.trackingLabel=window.trackingLabel,bookmark.type=vocabulary_1.ExternalResourceType.DOCUMENT.toString(),this.fire(BaseEvents_1.BaseEvents.BOOKMARK,bookmark)},Extension.prototype.dependencyLoaded=function(index,dep){0===index&&(window.PDFObject=dep)},Extension.prototype.getEmbedScript=function(template,width,height){var iframeSrc=this.getAppUri()+"#?manifest="+this.helper.manifestUri+"&c="+this.helper.collectionIndex+"&m="+this.helper.manifestIndex+"&s="+this.helper.sequenceIndex+"&cv="+this.helper.canvasIndex;return Utils.Strings.format(template,iframeSrc,width.toString(),height.toString())},Extension}(BaseExtension_1.BaseExtension);exports.Extension=Extension}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("extensions/uv-virtex-extension/DownloadDialogue",["require","exports","../../modules/uv-dialogues-module/DownloadDialogue"],(function(require,exports,DownloadDialogue_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var DownloadDialogue=function(_super){function DownloadDialogue($element){return _super.call(this,$element)||this}return __extends(DownloadDialogue,_super),DownloadDialogue.prototype.create=function(){this.setConfig("downloadDialogue"),_super.prototype.create.call(this)},DownloadDialogue.prototype.open=function(triggerButton){_super.prototype.open.call(this,triggerButton),this.addEntireFileDownloadOptions(),this.updateNoneAvailable(),this.resize()},DownloadDialogue.prototype.isDownloadOptionAvailable=function(option){return _super.prototype.isDownloadOptionAvailable.call(this,option)},DownloadDialogue}(DownloadDialogue_1.DownloadDialogue);exports.DownloadDialogue=DownloadDialogue}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("extensions/uv-virtex-extension/SettingsDialogue",["require","exports","../../modules/uv-dialogues-module/SettingsDialogue"],(function(require,exports,SettingsDialogue_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var SettingsDialogue=function(_super){function SettingsDialogue($element){return _super.call(this,$element)||this}return __extends(SettingsDialogue,_super),SettingsDialogue.prototype.create=function(){this.setConfig("settingsDialogue"),_super.prototype.create.call(this)},SettingsDialogue}(SettingsDialogue_1.SettingsDialogue);exports.SettingsDialogue=SettingsDialogue}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("extensions/uv-virtex-extension/ShareDialogue",["require","exports","../../modules/uv-dialogues-module/ShareDialogue"],(function(require,exports,ShareDialogue_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ShareDialogue=function(_super){function ShareDialogue($element){return _super.call(this,$element)||this}return __extends(ShareDialogue,_super),ShareDialogue.prototype.create=function(){this.setConfig("shareDialogue"),_super.prototype.create.call(this)},ShareDialogue.prototype.update=function(){_super.prototype.update.call(this),this.code=this.extension.getEmbedScript(this.options.embedTemplate,this.currentWidth,this.currentHeight),this.$code.val(this.code)},ShareDialogue.prototype.resize=function(){_super.prototype.resize.call(this)},ShareDialogue}(ShareDialogue_1.ShareDialogue);exports.ShareDialogue=ShareDialogue}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("modules/uv-virtexcenterpanel-module/VirtexCenterPanel",["require","exports","../uv-shared-module/BaseEvents","../uv-shared-module/CenterPanel","../../Utils"],(function(require,exports,BaseEvents_1,CenterPanel_1,Utils_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var VirtexCenterPanel=function(_super){function VirtexCenterPanel($element){return _super.call(this,$element)||this}return __extends(VirtexCenterPanel,_super),VirtexCenterPanel.prototype.create=function(){var _this=this;this.setConfig("virtexCenterPanel"),_super.prototype.create.call(this);var that=this;this.component.subscribe(BaseEvents_1.BaseEvents.OPEN_EXTERNAL_RESOURCE,(function(resources){that.openMedia(resources)})),this.$navigation=$('<div class="navigation"></div>'),this.$content.prepend(this.$navigation),this.$zoomInButton=$('\n          <button class="btn imageBtn zoomIn" title="'+this.content.zoomIn+'">\n            <i class="uv-icon-zoom-in" aria-hidden="true"></i>'+this.content.zoomIn+"\n          </button>\n        "),this.$navigation.append(this.$zoomInButton),this.$zoomOutButton=$('\n          <button class="btn imageBtn zoomOut" title="'+this.content.zoomOut+'">\n            <i class="uv-icon-zoom-out" aria-hidden="true"></i>'+this.content.zoomOut+"\n          </button>\n        "),this.$navigation.append(this.$zoomOutButton),this.$vrButton=$('\n          <button class="btn imageBtn vr" title="'+this.content.vr+'">\n            <i class="uv-icon-vr" aria-hidden="true"></i>'+this.content.vr+"\n          </button>\n        "),this.$navigation.append(this.$vrButton),this.$viewport=$('<div class="virtex"></div>'),this.$content.prepend(this.$viewport),this.title=this.extension.helper.getLabel(),this.$zoomInButton.on("click",(function(e){e.preventDefault(),_this.viewport&&_this.viewport.zoomIn()})),this.$zoomOutButton.on("click",(function(e){e.preventDefault(),_this.viewport&&_this.viewport.zoomOut()})),this.$vrButton.on("click",(function(e){e.preventDefault(),_this.viewport&&_this.viewport.toggleVR()})),this._isVREnabled()||this.$vrButton.hide()},VirtexCenterPanel.prototype.openMedia=function(resources){var _this=this;this.extension.getExternalResources(resources).then((function(){_this.$viewport.empty();var mediaUri=null,canvas=_this.extension.helper.getCurrentCanvas(),formats=_this.extension.getMediaFormats(canvas),resourceType=null,fileType=new Virtex.FileType("application/vnd.threejs+json");formats&&formats.length?(mediaUri=formats[0].id,resourceType=formats[0].getFormat()):mediaUri=canvas.id,resourceType&&(fileType=new Virtex.FileType(resourceType.toString()));var isAndroid=navigator.userAgent.toLowerCase().indexOf("android")>-1;_this.viewport=new Virtex.Viewport({target:_this.$viewport[0],data:{antialias:!isAndroid,file:mediaUri,fullscreenEnabled:!1,type:fileType,showStats:_this.options.showStats}}),_this.viewport&&(_this.viewport.on("vravailable",(function(){_this.$vrButton.show()}),!1),_this.viewport.on("vrunavailable",(function(){_this.$vrButton.hide()}),!1)),_this.resize()}))},VirtexCenterPanel.prototype._isVREnabled=function(){return Utils.Bools.getBool(this.config.options.vrEnabled,!1)&&WEBVR.isAvailable()},VirtexCenterPanel.prototype.resize=function(){_super.prototype.resize.call(this),this.title&&this.$title.text(Utils_1.UVUtils.sanitize(this.title)),this.$viewport.width(this.$content.width()),this.$viewport.height(this.$content.height()),this.viewport&&this.viewport.resize()},VirtexCenterPanel}(CenterPanel_1.CenterPanel);exports.VirtexCenterPanel=VirtexCenterPanel}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("extensions/uv-virtex-extension/Extension",["require","exports","manifesto.js","@iiif/vocabulary","../../modules/uv-shared-module/BaseEvents","../../modules/uv-shared-module/BaseExtension","../../modules/uv-shared-module/Bookmark","../../modules/uv-contentleftpanel-module/ContentLeftPanel","./DownloadDialogue","../../modules/uv-shared-module/FooterPanel","../../modules/uv-shared-module/HeaderPanel","../../modules/uv-moreinforightpanel-module/MoreInfoRightPanel","./SettingsDialogue","./ShareDialogue","../../modules/uv-virtexcenterpanel-module/VirtexCenterPanel"],(function(require,exports,manifesto_js_1,vocabulary_1,BaseEvents_1,BaseExtension_1,Bookmark_1,ContentLeftPanel_1,DownloadDialogue_1,FooterPanel_1,HeaderPanel_1,MoreInfoRightPanel_1,SettingsDialogue_1,ShareDialogue_1,VirtexCenterPanel_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Extension=function(_super){function Extension(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(Extension,_super),Extension.prototype.create=function(){var _this=this;_super.prototype.create.call(this),this.component.subscribe(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,(function(canvasIndex){_this.viewCanvas(canvasIndex)})),this.component.subscribe(BaseEvents_1.BaseEvents.THUMB_SELECTED,(function(canvasIndex){_this.component.publish(BaseEvents_1.BaseEvents.CANVAS_INDEX_CHANGED,canvasIndex)}))},Extension.prototype.createModules=function(){_super.prototype.createModules.call(this),this.isHeaderPanelEnabled()?this.headerPanel=new HeaderPanel_1.HeaderPanel(this.shell.$headerPanel):this.shell.$headerPanel.hide(),this.isLeftPanelEnabled()&&(this.leftPanel=new ContentLeftPanel_1.ContentLeftPanel(this.shell.$leftPanel)),this.centerPanel=new VirtexCenterPanel_1.VirtexCenterPanel(this.shell.$centerPanel),this.isRightPanelEnabled()&&(this.rightPanel=new MoreInfoRightPanel_1.MoreInfoRightPanel(this.shell.$rightPanel)),this.isFooterPanelEnabled()?this.footerPanel=new FooterPanel_1.FooterPanel(this.shell.$footerPanel):this.shell.$footerPanel.hide(),this.$downloadDialogue=$('<div class="overlay download" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$downloadDialogue),this.downloadDialogue=new DownloadDialogue_1.DownloadDialogue(this.$downloadDialogue),this.$shareDialogue=$('<div class="overlay share" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$shareDialogue),this.shareDialogue=new ShareDialogue_1.ShareDialogue(this.$shareDialogue),this.$settingsDialogue=$('<div class="overlay settings" aria-hidden="true"></div>'),this.shell.$overlays.append(this.$settingsDialogue),this.settingsDialogue=new SettingsDialogue_1.SettingsDialogue(this.$settingsDialogue),this.isLeftPanelEnabled()?this.leftPanel.init():this.shell.$leftPanel.hide(),this.isRightPanelEnabled()?this.rightPanel.init():this.shell.$rightPanel.hide()},Extension.prototype.render=function(){_super.prototype.render.call(this)},Extension.prototype.dependencyLoaded=function(index,dep){0===index&&(window.THREE=dep)},Extension.prototype.isLeftPanelEnabled=function(){return Utils.Bools.getBool(this.data.config.options.leftPanelEnabled,!0)&&(this.helper.isMultiCanvas()||this.helper.isMultiSequence())},Extension.prototype.bookmark=function(){_super.prototype.bookmark.call(this);var canvas=this.helper.getCurrentCanvas(),bookmark=new Bookmark_1.Bookmark;bookmark.index=this.helper.canvasIndex,bookmark.label=manifesto_js_1.LanguageMap.getValue(canvas.getLabel()),bookmark.thumb=canvas.getProperty("thumbnail"),bookmark.title=this.helper.getLabel(),bookmark.trackingLabel=window.trackingLabel,bookmark.type=vocabulary_1.ExternalResourceType.PHYSICAL_OBJECT.toString(),this.fire(BaseEvents_1.BaseEvents.BOOKMARK,bookmark)},Extension.prototype.getEmbedScript=function(template,width,height){var iframeSrc=this.getAppUri()+"#?manifest="+this.helper.manifestUri+"&c="+this.helper.collectionIndex+"&m="+this.helper.manifestIndex+"&s="+this.helper.sequenceIndex+"&cv="+this.helper.canvasIndex;return Utils.Strings.format(template,iframeSrc,width.toString(),height.toString())},Extension}(BaseExtension_1.BaseExtension);exports.Extension=Extension})),define("PubSub",["require","exports"],(function(require,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var PubSub=function(){function PubSub(){this.events={}}return PubSub.prototype.publish=function(name,args){var _this=this,handlers=this.events[name];void 0!==handlers&&handlers.forEach((function(handler){handler.call(_this,args)}))},PubSub.prototype.subscribe=function(name,handler){var handlers=this.events[name];void 0===handlers&&(handlers=this.events[name]=[]),handlers.push(handler)},PubSub.prototype.unsubscribe=function(name,handler){var handlers=this.events[name];if(void 0!==handlers){var handlerIdx=handlers.indexOf(handler);handlers.splice(handlerIdx)}},PubSub.prototype.dispose=function(){this.events={}},PubSub}();exports.PubSub=PubSub})),Element.prototype.scrollIntoViewIfNeeded||(Element.prototype.scrollIntoViewIfNeeded=function(centerIfNeeded){centerIfNeeded=0===arguments.length||!!centerIfNeeded;var parent=this.parentNode,parentComputedStyle=window.getComputedStyle(parent,void 0),parentBorderTopWidth=parseInt(parentComputedStyle.getPropertyValue("border-top-width")),parentBorderLeftWidth=parseInt(parentComputedStyle.getPropertyValue("border-left-width")),overTop=this.offsetTop-parent.offsetTop<parent.scrollTop,overBottom=this.offsetTop-parent.offsetTop+this.clientHeight-parentBorderTopWidth>parent.scrollTop+parent.clientHeight,overLeft=this.offsetLeft-parent.offsetLeft<parent.scrollLeft,overRight=this.offsetLeft-parent.offsetLeft+this.clientWidth-parentBorderLeftWidth>parent.scrollLeft+parent.clientWidth,alignWithTop=overTop&&!overBottom;(overTop||overBottom)&&centerIfNeeded&&(parent.scrollTop=this.offsetTop-parent.offsetTop-parent.clientHeight/2-parentBorderTopWidth+this.clientHeight/2),(overLeft||overRight)&&centerIfNeeded&&(parent.scrollLeft=this.offsetLeft-parent.offsetLeft-parent.clientWidth/2-parentBorderLeftWidth+this.clientWidth/2),(overTop||overBottom||overLeft||overRight)&&!centerIfNeeded&&this.scrollIntoView(alignWithTop)}),define("Polyfills",(function(){}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();define("UVComponent",["require","exports","@iiif/manifold","@iiif/vocabulary","./modules/uv-shared-module/BaseEvents","./extensions/uv-av-extension/Extension","./extensions/uv-default-extension/Extension","./extensions/uv-ebook-extension/Extension","./extensions/uv-mediaelement-extension/Extension","./extensions/uv-seadragon-extension/Extension","./extensions/uv-pdf-extension/Extension","./extensions/uv-virtex-extension/Extension","./Utils","./PubSub","./Polyfills"],(function(require,exports,manifold_1,vocabulary_1,BaseEvents_1,Extension_1,Extension_2,Extension_3,Extension_4,Extension_5,Extension_6,Extension_7,Utils_1,PubSub_1){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var UVComponent=function(_super){function UVComponent(options){var _this=_super.call(this,options)||this;return _this.isFullScreen=!1,_this._pubsub=new PubSub_1.PubSub,_this._init(),_this._resize(),_this}return __extends(UVComponent,_super),UVComponent.prototype._init=function(){var success=_super.prototype._init.call(this);return success||console.error("UV failed to initialise"),this._extensions={},this._extensions[vocabulary_1.IIIFResourceType.CANVAS.toString()]={type:Extension_5.Extension,name:"uv-seadragon-extension"},this._extensions[vocabulary_1.ExternalResourceType.IMAGE.toString()]={type:Extension_5.Extension,name:"uv-seadragon-extension"},this._extensions[vocabulary_1.ExternalResourceType.MOVING_IMAGE.toString()]={type:Extension_4.Extension,name:"uv-mediaelement-extension"},this._extensions[vocabulary_1.ExternalResourceType.PHYSICAL_OBJECT.toString()]={type:Extension_7.Extension,name:"uv-virtex-extension"},this._extensions.Model={type:Extension_7.Extension,name:"uv-virtex-extension"},this._extensions[vocabulary_1.ExternalResourceType.SOUND.toString()]={type:Extension_4.Extension,name:"uv-mediaelement-extension"},this._extensions[vocabulary_1.RenderingFormat.PDF.toString()]={type:Extension_6.Extension,name:"uv-pdf-extension"},this._extensions[vocabulary_1.MediaType.JPG.toString()]={type:Extension_5.Extension,name:"uv-seadragon-extension"},this._extensions[vocabulary_1.MediaType.PDF.toString()]={type:Extension_6.Extension,name:"uv-pdf-extension"},this._extensions[vocabulary_1.MediaType.VIDEO_MP4.toString()]={type:Extension_1.Extension,name:"uv-av-extension"},this._extensions[vocabulary_1.MediaType.WEBM.toString()]={type:Extension_1.Extension,name:"uv-av-extension"},this._extensions[vocabulary_1.MediaType.THREEJS.toString()]={type:Extension_7.Extension,name:"uv-virtex-extension"},this._extensions["model/gltf+json"]={type:Extension_7.Extension,name:"uv-virtex-extension"},this._extensions["model/gltf+json"]={type:Extension_7.Extension,name:"uv-virtex-extension"},this._extensions["model/gltf-binary"]={type:Extension_7.Extension,name:"uv-virtex-extension"},this._extensions.av={type:Extension_1.Extension,name:"uv-av-extension"},this._extensions.video={type:Extension_1.Extension,name:"uv-av-extension"},this._extensions["audio/mp3"]={type:Extension_1.Extension,name:"uv-av-extension"},this._extensions["audio/mp4"]={type:Extension_1.Extension,name:"uv-av-extension"},this._extensions["application/vnd.apple.mpegurl"]={type:Extension_1.Extension,name:"uv-av-extension"},this._extensions["application/dash+xml"]={type:Extension_1.Extension,name:"uv-av-extension"},this._extensions["application/epub+zip"]={type:Extension_3.Extension,name:"uv-ebook-extension"},this._extensions["application/oebps-package+xml"]={type:Extension_3.Extension,name:"uv-ebook-extension"},this._extensions.default={type:Extension_2.Extension,name:"uv-default-extension"},this.set(this.options.data),success},UVComponent.prototype.data=function(){return{annotations:void 0,root:"./uv",canvasIndex:0,collectionIndex:void 0,config:void 0,configUri:void 0,embedded:!1,iiifResourceUri:"",isLightbox:!1,isReload:!1,limitLocales:!1,locales:[{name:"en-GB"}],manifestIndex:0,rangeId:void 0,rotation:0,sequenceIndex:0,xywh:""}},UVComponent.prototype.set=function(data){if(this.extension)Utils_1.UVUtils.propertiesChanged(data,this.extension.data,["collectionIndex","manifestIndex","config","configUri","domain","embedDomain","embedScriptUri","iiifResourceUri","isHomeDomain","isLightbox","isOnlyInstance","isReload","locales","root"])?(this.extension.data=Object.assign({},this.extension.data,data),this._reload(this.extension.data)):(this.extension.data=Object.assign({},this.extension.data,data),this.extension.render());else{if(!data.iiifResourceUri)return void this._error("iiifResourceUri is required.");data.root&&data.root.endsWith("/")&&(data.root=data.root.substring(0,data.root.length-1)),this._reload(data)}},UVComponent.prototype.get=function(key){if(this.extension)return this.extension.data[key]},UVComponent.prototype.publish=function(event,args){this._pubsub.publish(event,args)},UVComponent.prototype.subscribe=function(event,cb){this._pubsub.subscribe(event,cb)},UVComponent.prototype._reload=function(data){var _this=this;this._pubsub.dispose(),this.subscribe(BaseEvents_1.BaseEvents.RELOAD,(function(data){_this.fire(BaseEvents_1.BaseEvents.RELOAD,data)}));var $elem=$(this.options.target);$elem.empty(),$elem.addClass("loading"),jQuery.support.cors=!0;var that=this;manifold_1.loadManifest({manifestUri:data.iiifResourceUri,collectionIndex:data.collectionIndex,manifestIndex:data.manifestIndex||0,sequenceIndex:data.sequenceIndex||0,canvasIndex:data.canvasIndex||0,rangeId:data.rangeId,locale:data.locales?data.locales[0].name:void 0}).then((function(helper){var canvas,trackingLabel=helper.getTrackingLabel();if(trackingLabel&&(trackingLabel+=(window.location,window.parent.location,document.referrer),window.trackingLabel=trackingLabel),void 0===data.sequenceIndex||helper.getSequenceByIndex(data.sequenceIndex))if(void 0!==data.canvasIndex&&(canvas=helper.getCanvasByIndex(data.canvasIndex)),canvas){var extension=void 0,content=canvas.getContent();if(content.length){var type,body=content[0].getBody();if(body&&body.length)if(format=body[0].getFormat()){if(!(extension=that._extensions[format.toString()]))(type=body[0].getType())&&(extension=that._extensions[type.toString()])}else(type=body[0].getType())&&(extension=that._extensions[type.toString()])}else{var canvasType=canvas.getType();if(canvasType&&(extension=that._extensions[canvasType.toString()]),!extension){var format=canvas.getProperty("format");extension=that._extensions[format]}}var hasRanges=helper.getRanges().length>0;"uv-av-extension"!==extension.name||hasRanges||(extension=that._getExtensionByName("uv-mediaelement-extension")),extension||(extension=that._extensions.default),that._configure(data,extension,(function(config){data.config=config,that._injectCss(data,extension,(function(){that._createExtension(extension,data,helper)}))}))}else that._error("Canvas "+data.canvasIndex+" not found.");else that._error("Sequence "+data.sequenceIndex+" not found.")})).catch((function(){that._error("Failed to load manifest.")}))},UVComponent.prototype._getExtensionByName=function(name){for(var keys=Object.keys(this._extensions),i=0;i<keys.length;i++){var extension=this._extensions[keys[i]];if(extension.name===name)return extension}},UVComponent.prototype._isCORSEnabled=function(){return Modernizr.cors},UVComponent.prototype._error=function(message){this.fire(BaseEvents_1.BaseEvents.ERROR,message)},UVComponent.prototype._configure=function(data,extension,cb){var _this=this;this._getConfigExtension(data,extension,(function(configExtension){if(data.locales){var configPath=data.root+"/lib/"+extension.name+"."+data.locales[0].name+".config.json";$.getJSON(configPath,(function(config){_this._extendConfig(data,extension,config,configExtension,cb)}))}}))},UVComponent.prototype._extendConfig=function(data,extension,config,configExtension,cb){config.name=extension.name,configExtension&&(config.uri=data.configUri,$.extend(!0,config,configExtension)),cb(config)},UVComponent.prototype._getConfigExtension=function(data,extension,cb){if(data.locales){var sessionConfig=sessionStorage.getItem(extension.name+"."+data.locales[0].name),configUri=data.configUri;if(sessionConfig)cb(JSON.parse(sessionConfig));else if(configUri)if(this._isCORSEnabled())$.getJSON(configUri,(function(configExtension){cb(configExtension)}));else{var settings={url:configUri,type:"GET",dataType:"jsonp",jsonp:"callback",jsonpCallback:"configExtensionCallback"};$.ajax(settings),window.configExtensionCallback=function(configExtension){cb(configExtension)}}else cb(null)}},UVComponent.prototype._injectCss=function(data,extension,cb){if(data.locales){var cssPath=data.root+"/themes/"+data.config.options.theme+"/css/"+extension.name+"/theme.css",locale=data.locales[0].name,themeName=extension.name.toLowerCase()+"-theme-"+locale.toLowerCase();$("#"+themeName.toLowerCase()).length||$("head").append('<link rel="stylesheet" id="'+themeName+'" href="'+cssPath.toLowerCase()+'" />'),cb()}},UVComponent.prototype._createExtension=function(extension,data,helper){this.extension=new extension.type,this.extension&&(this.extension.component=this,this.extension.data=data,this.extension.helper=helper,this.extension.name=extension.name,this.extension.create())},UVComponent.prototype.exitFullScreen=function(){this.extension&&this.extension.exitFullScreen()},UVComponent.prototype.resize=function(){this.extension&&this.extension.resize()},UVComponent}(_Components.BaseComponent);exports.default=UVComponent})),"function"==typeof jQuery&&define("jquery",[],(function(){return jQuery})),function(){if("function"==typeof window.CustomEvent)return!1;function CustomEvent(event,params){params=params||{bubbles:!1,cancelable:!1,detail:void 0};var evt=document.createEvent("CustomEvent");return evt.initCustomEvent(event,params.bubbles,params.cancelable,params.detail),evt}CustomEvent.prototype=window.Event.prototype,window.CustomEvent=CustomEvent}(),define("@iiif/manifold",["require","../lib/manifold.js","manifold"],(function(require,m){var manifold=require("manifold");return window.Manifold=manifold,manifold})),define("manifesto.js",["require","./lib/manifesto.js","manifesto"],(function(require,m){var manifesto=require("manifesto");return window.Manifesto=manifesto,window.manifesto=manifesto,manifesto})),define("@iiif/vocabulary",["require","../lib/vocabulary.js","vocabulary"],(function(require,m){return require("vocabulary")})),define("@iiif/iiif-metadata-component",["require","../lib/IIIFMetadataComponent.js","IIIFMetadataComponent"],(function(require,m){return require("IIIFMetadataComponent")})),define("@iiif/iiif-gallery-component",["require","../lib/GalleryComponent.js"],(function(require,m){return m})),define("@iiif/iiif-av-component",["require","../lib/IIIFAVComponent.js","IIIFAVComponent"],(function(require,m){return require("IIIFAVComponent")})),requirejs(["./lib/base64.min.js","./lib/browserdetect.js","./lib/detectmobilebrowser.js","./lib/jquery.xdomainrequest.js","./lib/modernizr.js","./lib/ex.es3.min.js","./lib/BaseComponent.js","./lib/KeyCodes.js","./lib/HTTPStatusCode.js","./lib/jquery-plugins.js","./lib/ba-tiny-pubsub.js","manifesto.js","@iiif/manifold","./lib/Utils.js","./lib/xss.min.js","./lib/fetch.umd.js","URLDataProvider","UVComponent","@iiif/iiif-metadata-component","@iiif/iiif-gallery-component","@iiif/vocabulary","@iiif/iiif-av-component"],(function(base64,browserdetect,detectmobilebrowser,xdomainrequest,modernizr,sanitize,exjs,basecomponent,keycodes,httpstatuscodes,jqueryplugins,pubsub,manifesto,manifold,utils,fetch,URLDataProvider,UVComponent){window.UV=UVComponent.default,window.UV.URLDataProvider=URLDataProvider.default,window.dispatchEvent(new CustomEvent("uvLoaded",{}))})),define("app",(function(){}));